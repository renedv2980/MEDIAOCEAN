*          DATA SET SPOMS09    AT LEVEL 041 AS OF 03/14/16                      
*PHASE T23409C                                                                  
T23409   TITLE 'SPOMS09 - SEND OF DARE ORDERS'                                  
T23409   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 BOXDL+WIDEDL,**3409**,R7,RR=R3,CLEAR=YES                         
         LR    R0,RC               OUR BOX AREA (TO GET 198 CHAR WIDE)          
*                                                                               
         L     RC,0(R1)            STANDARD CODING                              
         USING GEND,RC                                                          
         L     R8,ASPOOLD                                                       
         USING SPOOLD,R8                                                        
         L     RA,ATWA                                                          
         USING CONHEADH-64,RA      BASE SCREEN + OUR SCREEN                     
*                                                                               
         ST    R0,ABOX             OUR BOX AREA (TO GET 198 CHAR WIDE)          
         ST    R0,TWAVBOX                                                       
         LR    R1,R0                                                            
         USING BOXD,R1                                                          
         AH    R0,=Y(BOXDL)                                                     
         ST    R0,BOXAWIDE                                                      
         DROP  R1                                                               
*                                                                               
         L     R9,ASYSD                                                         
         USING SYSD,R9                                                          
         LA    R5,SYSSPARE         R5 = A(OVERLAY STORAGE AREA)                 
         USING MYAREAD,R5                                                       
         ST    R3,RELO                                                          
*                                                                               
         CLC   =C'PQONLY',CONACT                                                
         BNE   *+8                                                              
         MVI   PQONLY,C'Y'                                                      
*                                                                               
         NI    GENSTAT1,X'FF'-RDUPAPPL  <<===  BECAUSE OF SPOMS0A               
         OI    GLSTSTAT,APPLCDSP+RETEXTRA                                       
         BRAS  RE,SETPFKYS         SETUP THE PFKEYS                             
*                                                                               
         L     R1,=A(MOREPTAB-T23409)                                           
         AR    R1,RB                                                            
         ST    R1,AMOREPTB                                                      
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
         L     R1,=A(MOSTATAB-T23409)                                           
         AR    R1,RB                                                            
         ST    R1,AMOSTATB                                                      
*&&                                                                             
         L     R1,=A(WORPDTAB-T23409)                                           
         AR    R1,RB                                                            
         ST    R1,AWORPDTB                                                      
*                                                                               
         L     R1,=A(MORODTAB-T23409)                                           
         AR    R1,RB                                                            
         ST    R1,AMORODTB                                                      
*                                                                               
         L     R1,=A(MOOFSTTB-T23409)                                           
         AR    R1,RB                                                            
         ST    R1,AMOOFTAB                                                      
*                                                                               
*** DON'T CLEAR LIST STANDARD COMMENTS, PREVIOUS LIST KEY BITS, OR FROM         
***    BUY BIT                                                                  
         NI    BITFLAG,BFSHWSCR+BFSTDCOM+BFFRMBUY+BFFRMNWS+BFRCLLNG             
*                                                                               
         NI    BITFLAG2,BF2SHOWR+BF2STAMS+BF2STAOK                              
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(2,CFFDATE)                                    
         XC    CFFDATE,=X'FFFF'                                                 
*                                                                               
         L     RF,ACOMFACS                                                      
         MVC   VGLOBBER,CGLOBBER-COMFACSD(RF)                                   
*                                                                               
         CLI   MODE,VALREC         VALIDATE RECORD?                             
         BE    VR                                                               
         CLI   MODE,VALKEY         VALIDATE KEY?                                
         BNE   XIT                                                              
         EJECT                                                                  
***********************************************************************         
* VALIDATE THE KEY                                                              
***********************************************************************         
VK       MVI   AVNEW,0                                                          
*                                                                               
         TM    GENSTAT6,GES$LINK                                                
         BNZ   VK01                                                             
*                                                                               
         TM    GOTGLOB,GGLBBUY+GGLBNWS+GGLBRCL  NEED TO READ GLOBBER?           
         BZ    VK05                             NO                              
         MVC   SVXFRSID,TMPXFRID                                                
         BRAS  RE,SETDARE          YES, SET UP THE FIELDS                       
*                                                                               
VK01     TM    GENSTAT6,GES$LINK                                                
         BNZ   *+12                                                             
         TM    GOTGLOB,GGLBBUY     COMING FROM BUY VIA GLOBBER?                 
         BZ    *+8                                                              
         OI    BITFLAG,BFFRMBUY                                                 
*                                                                               
         TM    GOTGLOB,GGLBNWS     COMING FROM NWS VIA GLOBBER?                 
         BZ    *+8                                                              
         OI    BITFLAG,BFFRMNWS                                                 
*                                                                               
         TM    GENSTAT6,GES$LINK                                                
         BNZ   *+12                                                             
         TM    GOTGLOB,GGLBRCL     RECALLING FROM BUY/NWS?                      
         BZ    *+8                                                              
         OI    BITFLAG,BFRCLLNG                                                 
*                                  TELL GENCON WE GOT MULTIPLE FILES            
VK05     OI    GENSTAT3,MULTFILS   AND WE MAY NEED TO CLOSE PRINTQ              
         NI    DMINBTS,X'FF'-X'08'                                              
*                                                                               
         TM    BITFLAG,BFSTDCOM    LIST STANDARD COMMENTS MODE?                 
         BZ    VK10                                                             
         BRAS  RE,LSTCMMNT                                                      
         BE    VK10                                                             
         LA    R2,AVCFRSTH                                                      
         J     MAKESELS            YES, PLEASE MAKE YOUR SELECTIONS             
*                                                                               
VK10     TM    BITFLAG2,BF2STAMS   STATION ERROR MESSAGE MODE?                  
         BNZ   XIT                 YES, EXIT                                    
*                                                                               
VK20     MVI   MISCFLG1,0                                                       
         MVI   MISCFLG2,0                                                       
         NI    MISCFLG3,MF3NOOFF+MF3NOFST                                       
         MVI   MISCFLG4,0                                                       
***************                                                                 
* VALIDATE THE MEDIA                                                            
***************                                                                 
VKMED00  LA    R2,ORSMEDH                                                       
         TM    4(R2),X'20'            IF THIS KEY FIELD CHANGE                  
         BNZ   *+8                                                              
         OI    MISCFLG1,MF1KYCHG      THEN INDICATE IT                          
*                                                                               
         GOTOR NOTFYBUY,DMCB,GLOBMED                                            
*                                                                               
         XC    ORSMDXP,ORSMDXP                                                  
         OI    ORSMDXPH+6,X'80'                                                 
*                                                                               
         CLI   5(R2),0             NEED THE MEDIA                               
         BNE   VKMED05                                                          
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'GETF',(R2),,GLVSPMD                                 
         CLI   8(R1),0                                                          
         BE    VKMED05                                                          
         J     NEEDFLDS                                                         
*                                                                               
VKMED05  GOTO1 VALIMED                                                          
         L     R6,AIO                                                           
         USING AGYKEY,R6                                                        
         MVC   SVAGYID,AGYID                                                    
         CLC   =C'SJR',SVAGYID                                                  
         BE    *+8                                                              
         MVI   SVAGYID+2,C' '                                                   
         MVC   SVAGYOFF,=C'NY'     FOR TESTING PURPOSES                         
         DROP  R6                                                               
*                                                                               
         MVC   ORSMDXP,MEDNM                                                    
*                                                                               
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'PUTF',(R2),,GLVSPMD                                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
VKMED10  DS    0H                                                               
         OI    4(R2),X'20'                                                      
         MVC   BYTE,BAGYMD                                                      
         NI    BYTE,X'0F'          ELIMINATE THE AGY PORTION                    
         CLI   BYTE,X'02'                                                       
         BNE   VKMEDX                                                           
         OI    MISCFLG3,MF3RADIO                                                
*                                                                               
VKMEDX   DS    0H                                                               
***************                                                                 
* VALIDATE BUYER                                                                
***************                                                                 
         BRAS  RE,VKBUYR                                                        
***************                                                                 
* VALIDATE THE TRANSMIT METHOD                                                  
***************                                                                 
VKXMT00  DS    0H                                                               
         LA    R2,ORSXMITH                                                      
         TM    4(R2),X'20'                                                      
         BNZ   *+8                                                              
         OI    MISCFLG1,MF1KYCHG      THEN INDICATE IT                          
*                                                                               
         TM    BITFLAG,BFRCLLNG    AUTORECALL FROM BUY/NWS PROGRAM?             
         BZ    VKXMT01                                                          
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'GETD',WORK,8,GLVSPOPT                               
         CLI   8(R1),X'10'         AUTO-RECALL OPTION?                          
         BE    VKXMT01                                                          
         MVI   8(R2),C'C'          RECALLING CASH IS DEFAULT                    
         TM    WORK+1,X'40'        RECALLING TRADE?                             
         BZ    *+8                                                              
         MVI   8(R2),C'T'          YES                                          
         OI    6(R2),X'80'                                                      
*                                                                               
         GOTO1 (RF),DMCB,=C'DELE',,,GLVSPOPT    REMOVE IT                       
         CLI   8(R1),0                                                          
         BE    VKXMT05                                                          
         DC    H'0'                CAN'T HANDLE OTHER ERRORS                    
*                                                                               
VKXMT01  CLI   5(R2),0                                                          
         BNE   VKXMT05                                                          
         MVI   8(R2),C'C'                                                       
         OI    6(R2),X'80'                                                      
         B     VKXMT10                                                          
VKXMT05  CLI   8(R2),C'C'                                                       
         BE    VKXMT10                                                          
         CLI   8(R2),C'T'                                                       
         BE    VKXMT10                                                          
         CLI   8(R2),C'B'                                                       
         BNE   INVLFLD                                                          
*                                                                               
VKXMT10  OI    4(R2),X'20'                                                      
         NI    ORSCOLBH+1,X'FF'-X'0C'                                           
         NI    ORSORDH+1,X'FF'-X'0C'                                            
         NI    ORSCREVH+1,X'FF'-X'0C'                                           
         NI    ORSCCLBH+1,X'FF'-X'0C'                                           
         NI    ORSCONTH+1,X'FF'-X'0C'                                           
         NI    ORSTOLBH+1,X'FF'-X'0C'                                           
         NI    ORSTORDH+1,X'FF'-X'0C'                                           
         NI    ORSTREVH+1,X'FF'-X'0C'                                           
         NI    ORSTCLBH+1,X'FF'-X'0C'                                           
         NI    ORSTCONH+1,X'FF'-X'0C'                                           
         OI    ORSCOLBH+6,X'80'                                                 
         OI    ORSORDH+6,X'80'                                                  
         OI    ORSCREVH+6,X'80'                                                 
         OI    ORSCCLBH+6,X'80'                                                 
         OI    ORSCONTH+6,X'80'                                                 
         OI    ORSTOLBH+6,X'80'                                                 
         OI    ORSTORDH+6,X'80'                                                 
         OI    ORSTREVH+6,X'80'                                                 
         OI    ORSTCLBH+6,X'80'                                                 
         OI    ORSTCONH+6,X'80'                                                 
VKXMTX   DS    0H                                                               
***************                                                                 
* VALIDATE THE CLIENT                                                           
***************                                                                 
VKCLT00  DS    0H                                                               
         LA    R2,ORSCLTH                                                       
         TM    4(R2),X'20'            IF THIS KEY FIELD CHANGE                  
         BNZ   *+8                                                              
         OI    MISCFLG1,MF1KYCHG      THEN INDICATE IT                          
*                                                                               
         GOTOR NOTFYBUY,DMCB,GLOBCLT                                            
*                                                                               
         XC    ORSCLXP,ORSCLXP                                                  
         OI    ORSCLXPH+6,X'80'                                                 
*                                                                               
         GOTO1 VALICLT                                                          
         MVC   ORSCLXP,CLTNM                                                    
         OI    4(R2),X'20'                                                      
*                                                                               
         MVI   CLTFLAG1,0                                                       
         L     R6,AIO                                                           
         USING CLTHDRD,R6                                                       
         TM    COPT4,COP4TRD       IS THIS A TRADE CLIENT                       
         BZ    *+8                                                              
         OI    CLTFLAG1,CLTTRADE                                                
         DROP  R6                                                               
*                                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(4),=C'S0OM'                                                 
         MVC   WORK+4(2),AGENCY                                                 
         GOTO1 GETPROF,DMCB,(X'D0',WORK),PROFOM,DATAMGR                         
         MVC   WORK+32(1),PROFOM+1    SAVE OFF "Uses New Order #'s"             
*                                                                               
         MVC   WORK+6(1),QMED                                                   
         MVC   WORK+7(3),QCLT                                                   
*                                                                               
         CLI   CLTOFFCE,C' '                                                    
         BNH   *+14                                                             
         MVI   WORK+10,C'*'                                                     
         MVC   WORK+11(1),CLTOFFCE                                              
*                                                                               
         GOTO1 GETPROF,DMCB,(X'C0',WORK),PROFOM,DATAMGR                         
         MVC   PROFOM+1(1),WORK+32  ONLY WANT AGY-LVL FOR "Uses New .."         
         NI    ORSDESTH+1,X'FF'-X'20'                                           
         TM    MISCFLG3,MF3RADIO   ARE WE DOING A RADIO ORDER?                  
         BZ    VKCLT05                                                          
         CLI   POMFXRAD,C'N'       ONLY FAX RADIO ORDERS?                       
         BE    *+12                NO, WE WILL BE USING REDI                    
         OI    MISCFLG3,MF3FXRAD   YES!!                                        
         OI    ORSDESTH+1,X'20'    DEST FLD PROTECTED FOR RADIO FAXING          
*                                                                               
VKCLT05  MVC   WORK(4),=X'A2C4C1D9'  MUST HAVE LOWER CASE S                     
         GOTO1 (RF),(R1),(X'C0',WORK),PROFDAR,DATAMGR                           
*                                                                               
         MVC   WORK(4),=C'S0DX'                                                 
         GOTO1 (RF),(R1),(X'C0',WORK),WORK+32,DATAMGR                           
         MVI   NEWFAX,C'Y'         TEST TO USE NEW OM FAX                       
         CLI   WORK+32+2,C'Y'                                                   
         BE    *+8                                                              
         MVI   NEWFAX,C'N'                                                      
*                                                                               
         CLI   ORSINDMH+5,0        DID USER OVERRODE INCL DEMOS?                
         BE    VKCLT20                                                          
         CLI   ORSINDM,C'N'        USER OVERRODE NOT TO INCL DEMOS?             
         BNE   VKCLT10                                                          
         MVI   PDARDEMS,C'N'                                                    
         B     VKCLT30                                                          
*                                                                               
VKCLT10  CLI   ORSINDM,C'Y'        USER JUST WANTS DEMOS SENT                   
         BE    VKCLT25              YES, DEFAULT TO DX PROFILE                  
         CLI   ORSINDM,C'1'        USER WANTS 1-4 DEMOS                         
         BL    INVLFLD                                                          
         CLI   ORSINDM,C'4'                                                     
         BH    INVLFLD                                                          
VKCLT15  MVC   PDARDEMS(1),ORSINDM                                              
         B     VKCLT30                                                          
*                                                                               
VKCLT20  CLI   PDARDEMS,C'Y'                                                    
         BNE   VKCLT30                                                          
VKCLT25  MVI   PDARDEMS,C'1'       A YES WOULD BE DEFAULT AS 1                  
         CLI   WORK+32,1           1-4 DEMOS                                    
         BL    VKCLT30             LOWER THAN 1, WE KEEP AS 1                   
         CLI   WORK+32,4                                                        
         BH    VKCLT30             HIGHER THAN 4, WE KEEP AS 1                  
         MVC   PDARDEMS(1),WORK+32                                              
         OI    PDARDEMS,X'F0'                                                   
VKCLT30  DS    0H                                                               
*                                                                               
***************                                                                 
* VALIDATE THE PRODUCT                                                          
***************                                                                 
VKPRD00  DS    0H                                                               
         LA    R2,ORSPRDH                                                       
         TM    4(R2),X'20'            IF THIS KEY FIELD CHANGE                  
         BNZ   *+8                                                              
         OI    MISCFLG1,MF1KYCHG      THEN INDICATE IT                          
*                                                                               
         OC    ORSPRD,SPACES                                                    
         GOTOR NOTFYBUY,DMCB,GLOBPRD                                            
*                                                                               
         CLI   5(R2),3                                                          
         BH    VKPRD05                                                          
         CLC   GLOBPRD+4(3),SPACES                                              
         BNH   VKPRD05                                                          
*                                                                               
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         XC    BLOCK(12),BLOCK                                                  
         LA    R3,BLOCK                                                         
         MVC   0(6,R3),=C'SPTDAR'  FROM SPOT DARE                               
         OI    6(R3),X'80'         HEADLINE CHANGE IN DARE                      
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK,12,GLVNOTE                              
*                                                                               
VKPRD05  XC    ORSPRXP,ORSPRXP                                                  
         OI    ORSPRXPH+6,X'80'                                                 
*                                                                               
         CLI   5(R2),0                                                          
         BE    MISSFLD                                                          
*                                                                               
         ZIC   RE,5(R2)            CONVERT THE '/' TO '-'                       
         LA    RF,8(R2)                                                         
VKPRD10  CLI   0(RF),C'/'                                                       
         BNE   *+8                                                              
         MVI   0(RF),C'-'                                                       
         LA    RF,1(RF)                                                         
         BCT   RE,VKPRD10                                                       
*                                                                               
         L     RE,AIO2                                                          
         XC    0(256,RE),0(RE)                                                  
         GOTO1 SCANNER,DMCB,(R2),(X'82',AIO2),C',=-='                           
         CLI   DMCB+4,0                                                         
         BE    INVLFLD                                                          
*                                                                               
         L     R3,AIO2                                                          
         CLI   0(R3),0                                                          
         BE    INVLFLD                                                          
         CLI   1(R3),0                                                          
         BNE   INVLFLD                                                          
*                                                                               
         L     R1,ATIOB            SET UP ERROR MESSAGE CURSOR                  
         USING TIOBD,R1                                                         
         OI    TIOBINDS,TIOBSETC                                                
         LR    R0,R2                                                            
         SR    R0,RA                                                            
         STH   R0,TIOBCURD                                                      
         MVC   TIOBCURI,4(R3)                                                   
         DROP  R1                                                               
*                                                                               
         MVC   FAKEFLDH,0(R2)                                                   
         MVC   FAKEFLDH+5(1),0(R3)                                              
         XC    FAKEFLD,FAKEFLD                                                  
         ZIC   R1,0(R3)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   FAKEFLD(0),12(R3)                                                
         OC    FAKEFLD(8),SPACES                                                
*                                                                               
         CLC   =C'***',FAKEFLD     POL ORDER?                                   
         BNE   VKPRD15                                                          
         CLI   ACTNUM,ACTBRNDS     ORDER/BRANDS?                                
         BNE   FEATURNA            NO, NOT AVAILABLE AT THIS TIME               
         MVC   FAKEFLD,=C'POL'     YES, SHOULD HAVE POL PRODUCT                 
         MVC   SVQPRD,=C'***'           SAVE SO THAT WE'LL REMEMBER             
         B     VKPRD17                                                          
*                                                                               
VKPRD15  CLI   ACTNUM,ACTBRNDS     ORDER/BRANDS FOR NON-POL?                    
         BE    FEATURNA            NO, NOT AVAILABLE AT THIS TIME               
VKPRD17  LA    R2,FAKEFLDH                                                      
         GOTO1 VALIPRD                                                          
*                                                                               
         CLI   BPRD,X'FF'          POL PRODUCT?                                 
         BNE   *+14                NO                                           
         CLC   =C'***',SVQPRD      ONLY VALID IF FOR A POL ORDER?               
         BNE   INVLFLD               WE NOW KNOW *** IS BPRD OF X'FF'           
*                                                                               
         MVC   SVBPRD,BPRD         SAVE PRIMARY PRODUCT CODE HERE FIRST         
         MVC   SVQPRD,QPRD             WE KNOW *** IF SVBPRD=X'FF' EVEN         
         MVC   ORSPRXP(L'PRDNM),PRDNM   IF SVQPRD SAYS POL                      
*                                                                               
         MVI   SVBPR2,0            CLEAR PIGGYBACK IF NONE                      
         XC    SVQPR2,SVQPR2                                                    
*                                                                               
         LA    R3,32(R3)           R3 = A(PIGGYBACK PRODUCT) IF ANY             
         CLI   0(R3),0                                                          
         BE    VKPRD20                                                          
         CLI   1(R3),0             PRODUCT CAN'T HAVE SUB-FIELDS                
         BNE   INVLFLD                                                          
*                                                                               
         CLI   BPRD,X'FF'          NO PIGGYBACK IF POL ORDER                    
         BE    INVLFLD                                                          
*                                                                               
         L     R1,ATIOB            SET UP ERROR MESSAGE CURSOR                  
         USING TIOBD,R1                                                         
         MVC   TIOBCURI,4(R3)                                                   
         DROP  R1                                                               
*                                                                               
         ZICM  R0,FAKEFLDH+2,2     CALCULATE COL OF PIGGY                       
         ZIC   R1,4(R3)                                                         
         AR    R0,R1                                                            
         STCM  R0,3,FAKEFLDH+2                                                  
         MVC   FAKEFLDH+5,0(R3)    GIVE IT THE PROPER LENGTH                    
         XC    FAKEFLD,FAKEFLD                                                  
         ZIC   R1,0(R3)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   FAKEFLD(0),12(R3)                                                
         OC    FAKEFLD,SPACES                                                   
*                                                                               
         GOTO1 VALIPRD                                                          
         CLI   BPRD,X'FF'          POL PRODUCT?                                 
         BE    NOPOLPRD            YES, SHOULD NOT BE ACCEPTED                  
         MVC   SVBPR2,BPRD                                                      
         MVC   SVQPR2,QPRD                                                      
         MVC   BPRD,SVBPRD         REESTAB PRIMARY PRODUCT VALUE                
         MVC   QPRD,SVQPRD                                                      
*                                                                               
         MVI   ORSPRXP+L'PRDNM,C'-'   SHOW PIGGY'S NAME TOO                     
         MVC   ORSPRXP+L'PRDNM+1(L'PRDNM),PRDNM                                 
*                                                                               
VKPRD20  L     R1,ATIOB            TAKE OFF ERROR MESSAGE CURSOR                
         USING TIOBD,R1                                                         
         NI    TIOBINDS,X'FF'-TIOBSETC                                          
         DROP  R1                                                               
*                                                                               
         LA    R2,ORSPRDH                                                       
         OI    4(R2),X'20'                                                      
         OI    6(R2),X'80'                                                      
*                                                                               
VKPRDX   DS    0H                                                               
***************                                                                 
* VALIDATE THE ESTIMATE                                                         
***************                                                                 
VKEST00  DS    0H                                                               
         LA    R2,ORSESTH                                                       
         TM    4(R2),X'20'            IF THIS KEY FIELD CHANGE                  
         BNZ   *+8                                                              
         OI    MISCFLG1,MF1KYCHG      THEN INDICATE IT                          
*                                                                               
         GOTOR NOTFYBUY,DMCB,GLOBEST                                            
*                                                                               
         XC    ORSESXP,ORSESXP                                                  
         OI    ORSESXPH+6,X'80'                                                 
*                                                                               
         CLI   5(R2),0                                                          
         BE    MISSFLD                                                          
*                                                                               
         ZIC   RE,5(R2)            CONVERT THE '/' TO '-'                       
         LA    RF,8(R2)                                                         
VKEST10  CLI   0(RF),C'/'                                                       
         BNE   *+8                                                              
         MVI   0(RF),C'-'                                                       
         LA    RF,1(RF)                                                         
         BCT   RE,VKEST10                                                       
*                                                                               
         L     RE,AIO2                                                          
         XC    0(256,RE),0(RE)                                                  
         GOTO1 SCANNER,DMCB,(R2),(X'82',AIO2),C',=-='                           
         CLI   DMCB+4,0                                                         
         BE    INVLFLD                                                          
*                                                                               
         L     R3,AIO2                                                          
         CLI   0(R3),0                                                          
         BE    INVLFLD                                                          
         CLI   1(R3),0                                                          
         BNE   INVLFLD                                                          
*                                                                               
         L     R1,ATIOB            SET UP ERROR MESSAGE CURSOR                  
         USING TIOBD,R1                                                         
         OI    TIOBINDS,TIOBSETC                                                
         LR    R0,R2                                                            
         SR    R0,RA                                                            
         STH   R0,TIOBCURD                                                      
         MVC   TIOBCURI,4(R3)                                                   
         DROP  R1                                                               
*                                                                               
         MVC   FAKEFLDH,0(R2)                                                   
         MVC   FAKEFLDH+5(1),0(R3)                                              
         XC    FAKEFLD,FAKEFLD                                                  
         ZIC   R1,0(R3)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   FAKEFLD(0),12(R3)                                                
*                                                                               
         TM    2(R3),X'80'         NUMERIC FIELD?                               
         BZ    *+8                                                              
         OI    FAKEFLDH+4,X'08'                                                 
*                                                                               
         LA    R2,FAKEFLDH                                                      
         GOTO1 VALIEST                                                          
*                                                                               
         L     R6,AIO              SAVE THE OUT OF WEEK ROTATOR                 
         USING ESTHDRD,R6                                                       
         MVI   ESTFLAG1,0                                                       
*                                                                               
         CLI   EDAILY,C'Y'         DAILY ESTIMATE?                              
         BNE   *+8                                                              
         OI    ESTFLAG1,ESTDAILY   SAVE IF DAILY SCHEDULE                       
*                                                                               
         TM    EFLAG1,EF1TRADE     TRADE ESTIMATE FOR DARE?                     
         BZ    *+8                                                              
         OI    ESTFLAG1,ESTTRADE   YES                                          
*                                                                               
         TM    EFLAG1,EF1SDE       SUPERDESK AUTHORIZATION OPEN?                
         BZ    *+8                                                              
         OI    ESTFLAG1,ESTSDE     YES                                          
*                                                                               
         MVC   SVOOWROT,EOWSDAY                                                 
         CLI   SVOOWROT,0          IF NO OUT OF WEEK ROTATOR                    
         BNE   *+8                                                              
         MVI   SVOOWROT,1          THEN START DAY IS ALWAYS MONDAY              
         DROP  R6                                                               
*                                                                               
         MVC   ORSESXP(15),ESTNM                                                
         MVI   ORSESXP+15,C','                                                  
         GOTO1 DATCON,DMCB,(X'10',ESTSTRT),(11,ORSESXP+16)                      
         MVC   SVBEST,BEST                                                      
*                                                                               
         MVI   SVBFLT,0                                                         
*                                                                               
         OC    SVQPR2,SVQPR2                                                    
         BZ    VKEST20                                                          
         OI    ORSESXPH+6,X'08'+X'04'    DON'T DISPLAY EST NAME YET             
         MVC   QPRD,SVQPR2         VALIDATE AGAINST PIGGYBACK                   
         GOTO1 VALIEST                                                          
*                                                                               
         L     R6,AIO                                                           
         USING ESTHDRD,R6                                                       
         TM    EFLAG1,EF1SDE       SUPERDESK AUTHORIZATION OPEN?                
         BZ    *+12                                                             
         OI    ESTFLAG1,ESTSDE     YES                                          
         B     *+8                                                              
         NI    ESTFLAG1,X'FF'-X'20' IF NOT OPEN, MAKE SURE BIT IS OFF           
         DROP  R6                                                               
*                                                                               
         NI    ORSESXPH+6,X'FF'-X'08'    OKAY TO DISPLAY NOW                    
         MVI   ORSESXP+33,C','           SHOW THE NAME OF 2ND EST               
         MVC   ORSESXP+34(15),ESTNM                                             
*                                                                               
         MVC   QPRD,SVQPRD         REESTABLISH PRIMARY PRODUCT                  
         MVC   BEST,SVBEST                                                      
***********************************                                             
* SEE IF FLIGHT NUMBER IS NEEDED IN THIS FIELD                                  
***********************************                                             
VKEST20  BRAS  RE,GETFLTRC                                                      
***********************************                                             
* SEE IF FLIGHT NUMBER IN THIS FIELD                                            
***********************************                                             
VKEST30  DS    0H                                                               
         LA    R3,32(R3)           CHECK NEXT ESTIMATE IF ANY                   
         L     R1,ATIOB            UPDATE CURSOR POSITION                       
         USING TIOBD,R1                                                         
         MVC   TIOBCURI,4(R3)                                                   
         DROP  R1                                                               
*                                                                               
         CLI   0(R3),0             ANYTHING HERE?                               
         BNE   VKEST32             YES                                          
         CLI   1(R3),0                                                          
         BNE   INVLFLD                                                          
         TM    MISCFLG1,MF1FLTRC   NONE, DO WE NEED A FLIGHT NUMBER?            
         BZ    VKESTX                    NO                                     
         B     MISSFLD                   YES, MISSING                           
*                                                                               
VKEST32  TM    MISCFLG1,MF1FLTRC   DO WE HAVE A FLIGHT REC?                     
         BZ    INVLFLD                                                          
*                                                                               
         TM    2(R3),X'80'         NUMERIC?                                     
         BZ    INVLFLD                                                          
         ZICM  R1,5(R3),3                                                       
         CHI   R1,16               FLIGHT NUMBERS 1-16                          
         BH    INVLFLD                                                          
         STC   R1,SVBFLT           BYTE HOLDS THE FLIGHT NUMBER                 
*                                                                               
         XC    SVFLTEDT,SVFLTEDT   CLEAR OUT 1ST NON-FLIGHT DATE                
         L     R6,AIO                                                           
         USING DFLRECD,R6                                                       
         MVI   ELCODE,DFINFELQ                                                  
         BAS   RE,GETEL                                                         
         BNE   *+10                                                             
         USING DFINFEL,R6                                                       
         MVC   SVFLTEDT,DFINFSDT                                                
*                                                                               
VKEST33  L     R6,AIO                                                           
         USING DFLRECD,R6                                                       
         MVI   ELCODE,DFFLTELQ     GET 1ST FLIGHT ELEMENT                       
         BAS   RE,GETEL                                                         
         BNE   INVLFLD                                                          
*                                                                               
         USING DFFLTEL,R6                                                       
         CLI   SVBFLT,0            PURPOSELY NO FLIGHT? ORIG ORDER?             
         BNE   VKEST34                                                          
         GOTO1 DATCON,DMCB,(0,ESTSTRT),(3,SVFLTSDT)                             
*                                                                               
         OC    SVFLTEDT,SVFLTEDT                                                
         BNZ   VKEST38                                                          
         GOTO1 DATCON,DMCB,(3,DFFLTSTR),(0,WORK)                                
         GOTO1 ADDAY,DMCB,WORK,WORK,-1                                          
         GOTO1 DATCON,DMCB,(0,WORK),(3,SVFLTEDT)                                
         CLC   SVFLTSDT,SVFLTEDT                                                
         BH    NONFLTBD                                                         
         B     VKEST38                                                          
*                                                                               
VKEST34  CLC   SVBFLT,DFFLTNUM                                                  
         BE    VKEST36                                                          
         BAS   RE,NEXTEL                                                        
         BNE   INVLFLD                                                          
         B     VKEST34                                                          
*                                                                               
VKEST36  MVC   SVFLTSDT,DFFLTSTR   SAVE THE FLIGHT DATES                        
         MVC   SVFLTEDT,DFFLTEND                                                
VKEST38  MVI   ORSESXP+33,C','                                                  
         GOTO1 DATCON,DMCB,(X'13',SVFLTSDT),(11,ORSESXP+34)                     
         DROP  R6                                                               
*                                                                               
VKESTX   L     R1,ATIOB            TAKE OFF ERROR MESSAGE CURSOR                
         USING TIOBD,R1                                                         
         NI    TIOBINDS,X'FF'-TIOBSETC                                          
         DROP  R1                                                               
*                                                                               
         LA    R2,ORSESTH                                                       
         OI    4(R2),X'20'                                                      
         EDIT  (B1,BEST),(3,QEST),FILL=0                                        
***************                                                                 
* VALIDATE THE STATION                                                          
***************                                                                 
VKSTA00  DS    0H                                                               
         LA    R2,ORSSTAH                                                       
         TM    MISCFLG1,MF1KYCHG   KEY CHANGED ALREADY?                         
         BNZ   *+12                YES, REDISPLAY DEST                          
         TM    4(R2),X'20'            IF THIS KEY FIELD CHANGE                  
         BNZ   VKSTA10                                                          
         OI    MISCFLG1,MF1KYCHG      THEN INDICATE IT                          
         MVI   ORSDESTH+5,0                                                     
         XC    ORSDEST,ORSDEST                                                  
         OI    ORSDESTH+4,X'20'    VALIDATE THE DEST FIELD FOR DISPLAY          
*                                                                               
VKSTA10  GOTOR NOTFYBUY,DMCB,GLOBSTA                                            
*                                                                               
         XC    ORSMKXP,ORSMKXP                                                  
         OI    ORSMKXPH+6,X'80'                                                 
*                                                                               
         CLI   5(R2),0                                                          
         BE    MISSFLD                                                          
*                                                                               
***      CLI   8(R2),C'0'                                                       
***      BNL   INVLFLD                                                          
         GOTO1 VALISTA                                                          
*                                                                               
         MVC   MKTMIS,QMKT         SAVE FOR GLOBBER SWITCH TO MIS               
         MVC   ORSMKXP(L'QMKT),QMKT                                             
         MVC   ORSMKXP+L'QMKT+1(L'MKTNM),MKTNM                                  
         OI    4(R2),X'20'                                                      
*                                                                               
VKSTAX   DS    0H                                                               
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* CHECK MEDIA OCEAN STATION AND OOW ESTIMATE!                                   
         BRAS  RE,CHKMOSTA                                                      
*&&                                                                             
***                                                                             
* GET SALESPER AND P/N FLAG FROM BATCH REC IF CALLED FROM MARKET LIST           
***                                                                             
         CLI   CALLSTCK,X'EA'      JUST GET CALLED FROM MARKET LIST?            
         BNE   VKBKEY                                                           
         BRAS  RE,RDBATCH          WALTER,I CHANGE RDBATCH                      
*****                                                                           
* BUILD THE ORDER KEY                                                           
*****                                                                           
*                                                                               
VKBKEY   XC    KEY,KEY             CLEAN OUT THE KEY                            
         LA    R4,KEY                                                           
         USING DOKEY,R4            OVERLAY KEY WITH OUR TEMPLATE                
         MVI   DCKTYPE,DCKTYPQ                                                  
         MVI   DCKSUBTY,DCKSTYPQ                                                
         MVC   DCKAGMD,BAGYMD                                                   
         MVC   DCKCLT,BCLT                                                      
         MVC   DCKPRD,SVBPRD                                                    
         MVC   DCKPRD2,SVBPR2                                                   
         MVC   DCKEST,SVBEST                                                    
         MVC   DCKSTA,BSTA                                                      
*                                                                               
         TM    MISCFLG1,MF1FLTRC                                                
         BZ    *+10                                                             
         MVC   DCKFLTNM,SVBFLT                                                  
*                                                                               
         CLI   ORSXMIT,C'T'        IS IT TRADE?                                 
         BNE   *+8                                                              
         OI    DCKFLAG,DCKFTRDE                                                 
*                                                                               
         MVC   SAVEKEY,KEY         SAVE THE KEY                                 
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         NI    KEY+12,X'FF'-DCKFSCSW   CLEAR THE X'01 SSC FLAG                  
         CLC   KEY(L'DOKEY),KEYSAVE DID WE FIND OUR RECORD?                     
         BNE   VKNOREC              NO                                          
***                                                                             
* ORDER EXISTS...IF ORDER IS NOT CONFIRMED, DO NOT PROTECT DESTINE              
*   FIELD.... (PREVIOUSLY FIELD IS PROTECTED IF TRANSMIT EL EXISTS)             
***                                      MHC  07/02/02                          
         BRAS  RE,TRANSEL          GET ORDER REC, AND XMIT DATA                 
*                                                                               
         TM    MISCFLG1,MF1KYCHG   KEY CHANGED?                                 
         BZ    VKXIT               NO, DON'T NEED TO GO TO RD4ROUTE             
*                                                                               
         CLI   PDARPORN,C'Y'       REQUIRES PREV/NEW?                           
         BE    VKBKEY05            YES                                          
         BRAS  RE,HIDEAVN          NO, DON'T DISPLAY AVN FIELD                  
         B     VKBKEY10                                                         
VKBKEY05 BRAS  RE,DISPAVN          PROTECT & DISPLAY AVN FIELD                  
*                                                                               
VKBKEY10 LA    R3,ORSPRNW                                                       
         CLI   ACTNUM,ACTRCALL     AUTORECALL FROM BUY/NWS PROGRAM?             
         BNE   VKBKEY15                                                         
         L     R6,AIO                                                           
         LA    R6,DORFRST-DAREORDD(R6)                                          
         MVI   ELCODE,DOSTELQ                                                   
*                                                                               
VKBKEY12 BAS   RE,NEXTEL                                                        
         JNE   VKBKEY14            THEN LEAVE ROUTE BLANK                       
         USING DOSTELD,R6                                                       
         CLI   DOSTSTAT,DDLVRD                                                  
         JNE   VKBKEY12                                                         
**       LLC   R1,1(R6)                                                         
**       AR    R1,R6                                                            
**       CLI   DOSTSTAT-DOSTELD(R1),DSENT                                       
**       JNE   VKBKEY14            THEN LEAVE ROUTE BLANK                       
         CLI   DOSTLEN,DOSTLNQ2                                                 
         BNE   VKBKEY14                                                         
         GOTOR SHWIDNUM,DMCB,DOSTIDNM,ORSROUTH                                  
         DROP  R6                                                               
*                                                                               
VKBKEY14 L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         JNE   *+2                                                              
         USING DOSPELD,R6                                                       
         MVC   ORSDEST(3),=C'REP'                                               
         CLI   DOSPIDST,C'R'                                                    
         BE    *+10                                                             
         MVC   ORSDEST(3),=C'STA'                                               
         B     VKXIT                                                            
         DROP  R6                                                               
*                                                                               
**BKEY15 BRAS  RE,CALLRD4          CALL RD4ROUTE DIFFERENTLY                    
VKBKEY15 L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         JNE   *+2                                                              
         USING DOSPELD,R6                                                       
         MVC   ORSDEST(3),=C'REP'                                               
         CLI   DOSPDEST,C'R'                                                    
         BE    *+10                                                             
         MVC   ORSDEST(3),=C'STA'                                               
         DROP  R6                                                               
*                                                                               
         MVI   ELCODE,DOWIGELQ                                                  
         BAS   RE,NEXTEL                                                        
         JNE   *+2                                                              
         USING DOWIGELD,R6                                                      
         MVC   ORSROUT(L'DOWIGRPP),DOWIGRPP                                     
         OC    DOWIGRPO,DOWIGRPO                                                
         BZ    VKXIT                                                            
         LA    R1,ORSROUT                                                       
VKBKEY17 CLI   0(R1),C' '                                                       
         JNH   *+12                                                             
         LA    R1,1(R1)                                                         
         B     VKBKEY17                                                         
         MVC   0(L'DOWIGRPO,R1),DOWIGRPO                                        
         B     VKXIT                                                            
*                                                                               
VKBKEY19 LA    R3,ORSPRNW                                                       
         BRAS  RE,CALLRD4          CALL RD4ROUTE DIFFERENTLY                    
         B     VKXIT                                                            
*                                                                               
*                                                                               
* ORDER DOES NOT EXIST                                                          
*                                                                               
VKNOREC  OI    MISCFLG1,MF1RECNF   RECORD NOT FOUND                             
***                                                                             
* IF PREVIOUSLY AVN...IF NO DON'T DISPLAY FIELD                                 
***                                                                             
VKAVN    CLI   PDARPORN,C'Y'       REQUIRES PREV/NEW?                           
         BNE   VKAVN05             NO                                           
         BRAS  RE,SHOWAVN                                                       
*                                                                               
         LA    R2,ORSPRNWH         PRV/NEW MUST BE P/N                          
         CLI   5(R2),0             DID WE JUST DISPLAY OLD REC?                 
         BNE   VKAVN01                                                          
         MVI   8(R2),0             MAYBE...DOESN'T HARM IF WE DIDN'T            
         OI    6(R2),X'80'                                                      
         B     MISSFLD                                                          
VKAVN01  CLI   8(R2),C'N'          DID USER INPUT AN N?                         
         BE    VKAVN02             YES                                          
         CLI   8(R2),C'P'          DID USER INPUT A P?                          
         JNE   ERRAVN              NO...ERROR                                   
         MVI   AVNEW,C'P'                                                       
VKAVN02  OI    1(R2),X'20'                                                      
         LA    R3,AVNEW                                                         
         BRAS  RE,CALLRD4                                                       
         B     VKBKEY20                                                         
*                                                                               
VKAVN05  LA    R2,ORSPRNXH           CHANGE TEXT TO LOW INTENSITY               
         OI    1(R2),X'0C'                                                      
         OI    6(R2),X'80'                                                      
         LA    R2,ORSPRNWH           PROTECTED & LOW INTENSITY                  
         OI    1(R2),X'2C'                                                      
         OI    6(R2),X'80'                                                      
*                                                                               
         TM    MISCFLG1,MF1KYCHG   KEY CHANGED ALREADY?                         
         BZ    VKBKEY20            NO, DON'T NEED TO GO TO RD4ROUTE             
         GOTO1 ,DMCB,ORSDESTH,ORSROUTH,(MISCFLG3,EDIDATE),0                     
*                                     ARE WE RADIO & IS PROFILE SET TO          
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         TM    MISCFLG4,MF4MOFAX   FAXING OOW TO MO                             
         BO    VKNORC10                                                         
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
*                                     ARE WE RADIO & IS PROFILE SET TO          
         TM    MISCFLG3,MF3RADIO+MF3FXRAD   FAX ALL RADIO ORDERS?               
         BNO   *+8                                                              
VKNORC10 MVI   DMCB+4,X'80'        YES...CALL RD4ROUTE WITH HOB=X'80'           
*                                                                               
         GOTO1 RD4ROUTE,DMCB                                                    
         BE    VKNORC20                                                         
         CLC   GERROR,=AL2(NODSTDOV)  DESTINE IS FOR REP, USE DESTOV            
         BE    VKNORC20                                                         
         CLC   GERROR,=AL2(NODRADM)    NO DARADM FAX REC FOR REP?               
         JNE   ERREXIT                 NO, OTHERWISE ALLOW IT                   
         B     VKNORC30                                                         
*                                                                               
VKNORC20 NI    MISCFLG3,X'FF'-MF3NOOFF                                          
         TM    DMCB,X'80'          REP DOES NOT APPEND OFFICE?                  
         BZ    *+8                                                              
         OI    MISCFLG3,MF3NOOFF                                                
VKNORC30 MVC   KEY(L'SAVEKEY),SAVEKEY  RE-READ DARE ORDER REC                   
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
VKBKEY20 MVC   KEY(L'SAVEKEY),SAVEKEY                                           
         CLI   BPRD,X'FF'          POL ORDER?                                   
         BE    VKBKEY30            YES                                          
         CLI   SVBPR2,0            NO, ANY PIGGYBACK?                           
         BE    VKXIT                   NO, THEN IT'S OKAY                       
         MVC   DCKPRD,SVBPR2           YES, SWAP PRODUCTS                       
         MVC   DCKPRD2,SVBPRD                                                   
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE  SWAPPED ORDER EXISTS?                      
         BE    VKBKEY25              YES                                        
         MVC   KEY(L'KEYSAVE),KEYSAVE                                           
         MVC   DCKPRD,SVBPRD         NO, WANT IT THE WAY USER ENTERED           
         MVC   DCKPRD2,SVBPR2                                                   
         B     VKXIT               SAVEKEY HAS PRDS IN ORIGINAL ORDER           
*                                                                               
VKBKEY25 MVC   SAVEKEY,KEY                                                      
         MVC   BYTE,SVBPRD         SWAP BINARY PRODUCT VALUES                   
         MVC   SVBPRD,SVBPR2                                                    
         MVC   SVBPR2,BYTE                                                      
         MVC   FULL(L'SVQPRD),SVQPRD                                            
         MVC   SVQPRD,SVQPR2                                                    
         MVC   SVQPR2,FULL                                                      
         LA    R2,ORSPRDH                                                       
         MVC   8(L'SVQPRD,R2),SVQPRD                                            
         MVI   8+L'SVQPRD(R2),C'-'                                              
         MVC   8+L'SVQPRD+1(L'SVQPR2,R2),SVQPR2                                 
         MVI   5(R2),7                                                          
         CLI   SVQPR2+2,C' '                                                    
         BH    *+8                                                              
         MVI   5(R2),6                                                          
         OI    6(R2),X'80'         TRANSMIT THE PRODUCT FIELD                   
         B     VKXIT                                                            
*                                                                               
VKBKEY30 CLI   ACTNUM,ACTBRNDS                                                  
         BE    VKBKEY50                                                         
         MVI   DCKPRD,0                                                         
*                                                                               
VKBKEY40 GOTO1 HIGH                                                             
         CLC   KEY(DCKPRD-DOKEY),KEYSAVE   SAME AGYMD/CLT?                      
         BE    VKBKEY60                                                         
VKBKEY50 XC    KEY,KEY                     NO, NEED TO ADD POL ORDER            
         MVC   KEY(L'SAVEKEY),SAVEKEY                                           
         B     VKXIT                                                            
*                                          SAME EST/STA?                        
VKBKEY60 CLC   DCKEST(DCKPRD2-DCKEST),SAVEKEY+DCKEST-DOKEY                      
         BNE   VKBKEY70                    NO, CHECK EST,STA, AND FLT           
*                                                                               
         CLC   DCKFLTNM,SVBFLT             SAME FLIGHT?                         
         BNE   VKBKEY70                    NO                                   
         XC    CONACT,CONACT                                                    
         MVC   CONACT(4),=CL4'SEND'                                             
         OI    CONACTH+4,X'20'                                                  
         B     NOPOLODR                    YES, NO POL ORDER ALLOWED            
*                                                                               
VKBKEY70 CLC   DCKEST,SVBEST                                                    
         BE    VKBKEY85                                                         
         BL    VKBKEY80                                                         
*                                                                               
VKBKEY75 CLI   DCKPRD,X'FF'        WE'RE UPTO POL ALREADY?                      
         BE    VKBKEY50                                                         
*                                                                               
         ZIC   R1,DCKPRD             AM/CLT/PRD/EST/STA/PR2/FLT                 
         LA    R1,1(R1)                                                         
         STC   R1,DCKPRD                                                        
VKBKEY80 MVC   DCKEST(DORLEN-DCKEST),SAVEKEY+DCKEST-DOKEY                       
         B     VKBKEY40                                                         
*                                                                               
VKBKEY85 CLC   DCKSTA,BSTA                                                      
         BH    VKBKEY75                                                         
         BL    VKBKEY80                                                         
*                                                                               
         CLC   DCKFLTNM,SVBFLT                                                  
         BH    *+14                                                             
VKBKEY90 MVC   DCKFLTNM,SVBFLT     RESET FLIGHT NUMBER TO WHAT WE HAVE          
         B     VKBKEY40                                                         
*                                                                               
         ZIC   R1,DCKPRD2          GREATER THAN THE FLIGHT # WE'RE              
         LA    R1,1(R1)                LOOKING FOR                              
         STC   R1,DCKPRD2          SO BUMP PIGGYBACK PRD CODE                   
         B     VKBKEY90                                                         
*                                                                               
VKXIT    BRAS  RE,SHWOCOMS                                                      
         CLI   PFKEY,9                    PF TO MIS PROGRAM?                    
         BNE   VKXIT01                    NO                                    
         BRAS  RE,PFMIS                   YES                                   
         B     XIT                                                              
VKXIT01  CLI   PFKEY,7                    PF TO BROWSE PROGRAM?                 
         BNE   XIT                        NO                                    
         BRAS  RE,PFBRW                   YES                                   
         B     XIT                                                              
         DROP  R4                                                               
         EJECT                                                                  
***********************************************************************         
* VALIDATE THE RECORD ON SCREEN (FOR SEND)                                      
***********************************************************************         
VR       XC    KEY,KEY             GETTING THE COMMENTS CLOBBERED               
         MVC   KEY(L'DOKEY),SAVEKEY    KEY, SO RESTORE FROM SAVEKEY             
*                                                                               
         LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         CLI   ORSXMIT,C'C'        SHOWING CASH?                                
         BE    VR01                YES                                          
         OI    ORSTOLBH+1,X'08'    NO, HIGHLIGHT TRADE FIELDS                   
         OI    ORSTORDH+1,X'08'                                                 
         OI    ORSTCLBH+1,X'08'                                                 
         OI    ORSTCONH+1,X'08'                                                 
         OI    ORSTREVH+1,X'08'                                                 
         CLI   ORSXMIT,C'B'        BOTH CASH & TRADE ORDERS                     
         BNE   VR03                NO, JUST TRADE                               
*                                                                               
VR01     OI    ORSCOLBH+1,X'08'        HIGHLIGHT CASH FIELDS                    
         OI    ORSORDH+1,X'08'                                                  
         OI    ORSCCLBH+1,X'08'                                                 
         OI    ORSCONTH+1,X'08'                                                 
         OI    ORSCREVH+1,X'08'                                                 
*                                                                               
VR03     TM    GENSTAT6,GES$LINK   TEST DDLINK UPLOAD                           
         BZ    *+8                                                              
         MVI   PFKEY,6             WE WANT TO RECALL SO BAD                     
*                                                                               
         TM    MISCFLG1,MF1KYCHG   IF THE KEY CHANGED                           
         BZ    VR04                                                             
         XC    ORSORD,ORSORD       CLEAR THESE FIELDS                           
         MVC   ORSCREV+3(3),ZEROS                                               
         XC    ORSCONT,ORSCONT                                                  
         XC    ORSTORD,ORSTORD                                                  
         MVC   ORSTREV+3(3),ZEROS                                               
         XC    ORSTCON,ORSTCON                                                  
*                                                                               
VR04     XI    DCKFLAG,DCKFTRDE    LOOK FOR THE OTHER TYPE FIRST                
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         NI    KEY+12,X'FF'-DCKFSCSW   CLEAR THE X'01 SSC FLAG                  
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   VR09                                                             
*                                                                               
         LA    R2,ORSORDH                                                       
         TM    DCKFLAG,DCKFTRDE    IS OTHER ORDER TRADE FLAG?                   
         BZ    *+12                                                             
         OI    MISCFLG1,MF1TRDRC   WE, HAVE A TRADE ORDER CONDITION             
         LA    R2,ORSTORDH                                                      
*                                                                               
         MVC   DISKADDR,KEY+14                                                  
         GOTO1 GETREC                                                           
         L     R6,AIO              POINT TO THE RECORD                          
         MVC   BINORDER,DOKORDER-DOKEY(R6)                                      
         BRAS  RE,SHWORDER                                                      
         LA    R6,DORFRST-DOKEY(R6)                                             
         USING DOIDELD,R6                                                       
         LA    R0,ORSORDH                                                       
         CR    R2,R0                                                            
         BNE   *+12                                                             
         LA    R2,ORSCONTH                                                      
         B     *+8                                                              
         LA    R2,ORSTCONH                                                      
         MVC   8(L'ORSCONT,R2),DOIDCON                                          
         DROP  R6                                                               
*                                                                               
         LA    R1,ORSCREVH                                                      
         TM    MISCFLG1,MF1TRDRC   ARE WE DISPLAYING THE TRADE ORDER?           
         BZ    *+8                                                              
         LA    R1,ORSTREVH                                                      
         SR    R6,R6               CLEAR R6                                     
         BRAS  RE,SHOWREV                                                       
*                                                                               
VR09     CLI   ORSXMIT,C'T'        ONLY PROCESS TRADE ORDER?                    
         BNE   *+8                                                              
         OI    MISCFLG1,MF1DRTRD   YES, DOING TRADE ORDERS NOW                  
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY  LETS THE OUR ORDER NOW                     
         DROP  R4                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         NI    KEY+12,X'FF'-DCKFSCSW   CLEAR THE X'01 SSC FLAG                  
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BE    VR10                                                             
         OI    MISCFLG1,MF1RECNF   RECORD NOT FOUND                             
*                                                                               
         LA    R2,ORSCONTH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R2,ORSTCONH                                                      
         XC    8(L'ORSCONT,R2),8(R2)   CLEAR OUT THE CONTRACT #                 
         OI    6(R2),X'80'                                                      
         B     VR20                                                             
*                                                                               
VR10     MVC   DISKADDR,KEY+14                                                  
         GOTO1 GETREC                                                           
*&&DO                                                                           
**  COMMENTED OUT TO GET COMMENT PREVIEW TO DISPLAY THE COMMENTS                
**  OTHERWISE THE COMMENTS DON'T SHOW UP WHEN IT AUTO-PFS TO PREVIEW            
         CLI   ACTNUM,ACTCMPRV     COMMENT/PREVIEW ACTION?                      
         BE    VR11                THEN NO NEED TO DIDPLAY FROM SCRATCH         
         CLI   ACTNUM,ACTXMIT      TRANSMIT ACTION?                             
         BE    VR11                THEN NO NEED TO DISPLAY FROM SCRATCH         
**  COMMENTED OUT TO GET COMMENT PREVIEW TO DISPLAY THE COMMENTS                
**  OTHERWISE THE COMMENTS DON'T SHOW UP WHEN IT AUTO-PFS TO PREVIEW            
*&&                                                                             
*                                                                               
         TM    MISCFLG1,MF1KYCHG   IF THE KEY CHANGED                           
         BZ    VR11                                                             
         NI    MISCFLG3,X'FF'-MF3NOFST       FIRST TIME                         
         BRAS  RE,DRSEND           THEN DISPLAY THE RECORD FROM SCRATCH         
*                                                                               
VR11     L     R6,AIO              DO WE HAVE A 2NDARY ID ELEMENT?              
         MVI   ELCODE,DOI2ELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   VR20                                                             
         USING DOI2ELD,R6                                                       
         TM    DOI2FLG1,DOI2FVAR   VAR ORDER NOW (VAR ORDER SENT OUT)?          
         BZ    *+8                                                              
         OI    MISCFLG2,MF2VAROR   YES, ALL SPOTS MUST BE ALLOCATED             
         TM    DOI2FLG1,DOI2FVCN   VAR ORDER CONFIRMED?                         
         BZ    *+8                                                              
         OI    MISCFLG2,MF2VCONF   YES                                          
         DROP  R6                                                               
*                                                                               
VR20     TM    BITFLAG2,BF2STAMS   STATION ERROR MESSAGE MODE?                  
         BZ    VR45                                                             
         CLI   PFKEY,12                                                         
         MVI   PFKEY,0                                                          
         BE    VR40                                                             
         LA    R2,ORBUPDTH                                                      
         CLI   ORBUPDTH+5,0                                                     
         BE    MISSFLD                                                          
         CLI   ORBUPDT,C'N'                                                     
         BE    VR40                                                             
         CLI   ORBUPDT,C'Y'                                                     
         BNE   INVLFLD                                                          
         OI    BITFLAG2,BF2STAOK                                                
         MVI   PFKEY,6                                                          
VR40     BRAS  RE,RSTRTWA                                                       
         NI    BITFLAG2,X'FF'-BF2STAMS                                          
         MVI   IOOPT,C'N'                                                       
         LA    R2,ORSSTD1H                                                      
         ST    R2,ACURFORC                                                      
*                                                                               
VR45     TM    BITFLAG,BFSTDCOM    LIST STANDARD COMMENTS MODE?                 
         BZ    VR50                                                             
         BRAS  RE,LSTCMMNT                                                      
         BE    VR50A                                                            
         LA    R2,AVCFRSTH                                                      
         J     MAKESELS            YES, PLEASE MAKE YOUR SELECTIONS             
*                                                                               
VR50     OI    GENSTAT2,NEXTSEL                                                 
*                                                                               
VR50A    BRAS  RE,INITELEM         SETUP DARE ID ELEMENT                        
***************                                                                 
* VALIDATE THE SALESPERSON                                                      
***************                                                                 
VRSPER00 L     R6,AIO                                                           
         MVI   ELCODE,DOIDELQ      DO WE HAVE PRIMARY ID ELEM ALREADY?          
         BAS   RE,GETEL                                                         
         BNE   VRSPER10            NO, THEN IT'S OKAY                           
         USING DOIDELD,R6                                                       
         MVC   DOIDELEM+DOIDSPER-DOIDELD(L'DOIDSPER),DOIDSPER                   
*                                                                               
VRSPER10 LA    R6,DOIDELEM                                                      
         USING DOIDELD,R6                                                       
*                                                                               
         LA    R2,ORSSALEH         SALESPERSON                                  
         XC    BLOCK(GLBRWLNQ),BLOCK                                            
         NI    PFKFLAG,X'FF'-PFKBRW2-PFKPPER                                    
*                                                                               
         TM    PFKFLAG,PFKBRW      COMING FROM BROWSE?                          
         BO    VRSPER30            YES                                          
*                                                                               
         TM    4(R2),X'20'         PREVIOUSLY VALIDATED?                        
         BO    VRSPER90            YES                                          
*                                                                               
         CLI   5(R2),0             IS THERE ANYTHING ON THE SCREEN?             
         BE    *+16                NO                                           
         MVC   DOIDSPER,8(R2)      YES - MOVE FROM SCREEN TO RECORD             
         OC    DOIDSPER,SPACES     SPACE PAD IT                                 
*                                                                               
         BRAS  RE,CHKPNDNG                                                      
         JE    PNDNGORD            CAN NOT CHANGE, PENDING ORDER                
*                                                                               
         CLI   5(R2),0             ANY INPUT THIS TIME?                         
         BNE   VRSPER20            YES                                          
*                                                                               
         OC    BATCHSLP,BATCHSLP   SALESPERSON FROM BATCH RECORD?               
         BNZ   VRSPER15            YES                                          
*                                                                               
         BRAS  RE,ISBRAND          RADIO + ORD/BRAND + REP INBOX?               
         JE    MISSFLD             YES                                          
         B     VRSPER70            NO, UPDATE BATCH & LAST METHOD RECS          
*                                                                               
* ONLY COME HERE IF SALESPERSON PASSED FROM BATCH RECORD                        
*                                                                               
VRSPER15 MVC   ORSSALE,BATCHSLP    MOVE SALEPERSON FROM BATCH TO SCREEN         
         OI    6(R2),X'80'         XMIT                                         
         MVC   DOIDSPER,8(R2)      YES - MOVE FROM SCREEN TO RECORD             
         OC    DOIDSPER,SPACES     SPACE PAD IT                                 
*                                                                               
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3                                                       
         TM    BATCHFLG,DBSALPT    POINTPERSON?                                 
         BZ    VRSPER85            NO                                           
         OI    PFKFLAG,PFKPPER     POINTPERSON                                  
         B     VRSPER85                                                         
*                                                                               
VRSPER20 CLC   =C'!VARORD=',8(R2)    SPECIFIC LINK TO ANOTHER ORDER?            
         BNE   VRSPER25                                                         
         MVC   ORSOORD,16(R2)                                                   
         OI    ORSOORDH+6,X'80'                                                 
         B     VRSPER80                                                         
*                                                                               
VRSPER25 CLI   8(R2),C'='            WANT TO GO TO BROWSE?                      
         BNE   VRSPER45                                                         
         MVI   PFKEY,7                                                          
         BRAS  RE,PFBRW              SWITCH TO BROWSE                           
         J     XIT                   AND EXIT                                   
*                                                                               
* ONLY COME HERE IF COMING BACK FROM BROWSE!!                                   
*                                                                               
VRSPER30 NI    PFKFLAG,X'FF'-PFKBRW  TURN OFF COMING FROM BROWSE                
         BRAS  RE,GLOBSALE           DID WE SELECT A SALESPERSON?               
         BE    VRSPER35              YES                                        
         BRAS  RE,ISBRAND                                                       
         JE    MISSFLD                                                          
*                                                                               
         TM    MISCFLG1,MF1RECNF   RECORD NOT FOUND                             
         JO    NOSALES                                                          
         L     R6,AIO                NO, MOVE IT ON SCREEN FROM THE REC         
         MVI   ELCODE,DOIDELQ                                                   
         BRAS  RE,GETEL                                                         
         MVC   8(25,R2),DOIDSPER                                                
         OI    ORSSALEH+4,X'20'      PREVIOUSLY VALIDATED                       
         OI    ORSSPTXH+6,X'80'      TRANSMIT                                   
         J     NOSALES               GIVE ERROR MESSAGE                         
*                                                                               
VRSPER35 OI    PFKFLAG,PFKBRW2     INDICATE WE CHANGED REC VIA BROWSE           
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3                                                       
         MVC   8(20,R2),GLBRWKW    MOVE SALESPERSON TO SCREEN                   
         XC    28(5,R2),28(R2)     CLEAR LAST 5 BYTES                           
         OI    6(R2),X'80'         TRANSMIT                                     
         TM    GLBRWFLG,X'80'      GOT A POINTPERSON VIA GLOBBER?               
         BZ    *+8                 NO                                           
         OI    PFKFLAG,PFKPPER     POINTPERSON                                  
         B     VRSPER70                                                         
*                                                                               
VRSPER45 CLI   QMED,C'R'                                                        
         BNE   VRSPER65                                                         
*                                                                               
         CLC   =C'FAX:',ORSROUT    ROUTE = FAX?                                 
         BE    VRSPER65                                                         
         CLC   =C'EML:',ORSROUT    ROUTE = EMAIL?                               
         BE    VRSPER65                                                         
*                                                                               
         CLC   8(3,R2),=C'SP;'                                                  
         BE    VRSPER50                                                         
         CLC   8(3,R2),=C'PP;'                                                  
         BNE   VRSPER65                                                         
         OI    PFKFLAG,PFKPPER     POINTPERSON                                  
*                                                                               
VRSPER50 LA    R1,ORSCONTH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R1,ORSTCONH                                                      
         CLC   8(L'ORSCONT,R1),ZEROS  DO WE HAVE A CONTRACT?                    
         BNH   VRSPER56                                                         
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         BNE   VRSPER54                                                         
         TM    PFKFLAG,PFKPPER         YES, CHANGE TO POINTPERSON?              
         BZ    INVLFLD                 NO, ERROR                                
         B     VRSPER56                                                         
VRSPER54 TM    PFKFLAG,PFKPPER         NO, CHANGE TO SALESPERSON?               
         BO    INVLFLD                 NO, ERROR                                
*                                                                               
VRSPER56 OI    MISCFLG3,MF3MSALP                                                
         MVC   WORK(L'ORSSALE),8(R2)                                            
         LA    R0,WORK+26                                                       
         LA    R1,WORK+3                                                        
VRSPER57 CR    R1,R0                                                            
         JNL   INVLFLD                                                          
         CLI   0(R1),C' '                                                       
         BH    VRSPER60                                                         
         AHI   R1,1                                                             
         B     VRSPER57                                                         
VRSPER60 XC    ORSSALE,ORSSALE                                                  
         MVC   ORSSALE(20),0(R1)                                                
         OI    6(R2),X'80'         XMIT                                         
         B     VRSPER70                                                         
*                                                                               
VRSPER65 DS    0H                                                               
         CLC   =C'NOTDARE',ORSSALE                                              
         BE    VRSPER75                                                         
         CLC   =C'APPROVE',ORSSALE                                              
         BE    VRSPER75                                                         
         CLC   =C'REJECT',ORSSALE                                               
         BE    VRSPER75                                                         
         CLC   =C'CONFIRM',ORSSALE                                              
         BE    VRSPER75                                                         
         CLC   =C'UNDARE',ORSSALE                                               
         BE    VRSPER75                                                         
*                                                                               
         CLI   QMED,C'T'           RADIO?                                       
         BE    VRSPER70                                                         
         CLC   =C'FAX:',ORSROUT    ROUTE = FAX?                                 
         BE    VRSPER70                                                         
         CLC   =C'EML:',ORSROUT    ROUTE = EMAIL?                               
         BE    VRSPER70                                                         
         J     INVLFLD                                                          
*                                                                               
VRSPER70 BRAS  RE,UPDSALES         UPDATE SALESPERSON IN DR BATCH               
         BRAS  RE,UPDLMREC         UPDATE SALESPERSON IN LAST METHOD            
VRSPER75 MVC   DOIDSPER,8(R2)      MOVE FROM SCREEN TO RECORD                   
         OC    DOIDSPER,SPACES     SPACE PAD IT                                 
         DROP  R6                                                               
*                                                                               
VRSPER80 TM    MISCFLG3,MF3MSALP   SALESPERSON MANUALLY ENTERED?                
         BNZ   VRSPER85            YES                                          
*                                                                               
VRSPER81 TM    PFKFLAG,PFKBRW2     DID WE CHANGED REC VIA BROWSE                
         BZ    VRSPER90                                                         
*                                                                               
* UPDATE THE SCREEN FIELDS WITH SALESPERSON/POINTPERSON                         
*                                                                               
VRSPER85 MVC   ORSSPTX,=X'E2819385A2978599A29695'                               
         TM    PFKFLAG,PFKPPER     POINTPERSON?                                 
         BZ    *+10                NO                                           
         MVC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         OI    ORSSALEH+4,X'20'    PREVIOUSLY VALIDATED                         
         OI    ORSSPTXH+6,X'80'                                                 
         DROP  R3                                                               
***********************************************************************         
* IF RADIO EDI AND GOING TO REP/INBOX, THEN WE NEED TO VALIDATE THE             
* SALESPERSON TO SEE IF IT IS STILL VALID AND TO PULL THE SALESPERSON           
* CODE THAT REPPAK USES                                                         
***********************************************************************         
VRSPER90 CLI   QMED,C'R'                                                        
         BNE   VRSPERX                                                          
         CLI   PFKEY,6                                                          
         BNE   VRSPERX                                                          
         CLI   ACTNUM,ACTSEND                                                   
         BE    *+12                                                             
         CLI   ACTNUM,ACTXMIT                                                   
         BNE   VRSPERX                                                          
         TM    MISCFLG3,MF3FXRAD   FAX ALL RADIO ORDERS?                        
         BNZ   VRSPERX             YES, SALESPERSON NOT REQUIRED                
         CLC   =C'FAX:',ORSROUT                                                 
         BE    VRSPERX                                                          
         CLC   =C'EML:',ORSROUT                                                 
         BE    VRSPERX                                                          
         CLI   ORSDEST,C'R'        GOING TO REP?                                
         BNE   VRSPERX                                                          
         CLC   8(25,R2),SPACES                                                  
         JNH   MISSFLD             REP/INBOX, THEN SALESPERSON REQUIRED         
         GOTOR CHKRPSAL,DMCB,ORSSALEH                                           
         BE    VRSPERX                                                          
*                                                                               
         MVI   BLOCK,L'ORSSPTX+1                                                
         MVC   BLOCK+1(L'ORSSPTX),ORSSPTX   MESSAGE                             
         MVI   BLOCK+1+L'ORSSPTX,0          TERMINATING 0                       
         J     SALPNTAS            SALESPERSON NOT VALID ANYMORE                
*                                                                               
VRSPERX  DS    0H                                                               
***************                                                                 
* VALIDATE THE STANDARD COMMENTS                                                
***************                                                                 
VRSTD00  CLI   CALLSP,0            DID WE PFKEY TO HERE?                        
         BE    VRSTD10                                                          
         CLI   CALLSTCK,X'EA'      DID WE COME FROM MARKET/LIST?                
         BNE   VRSTD10                                                          
         L     RF,ACOMFACS         YES, DID IT PASS A STANDARD COMMENT?         
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'GETF',ORSSTD1H,,GLVBUY1   USE IT IF IT DID          
         OI    ORSSTD1H+6,X'80'                                                 
         CLI   8(R1),GLEGNF                                                     
         BE    VRSTD10                                                          
*                                                                               
         GOTO1 (RF),DMCB,=C'DELE',,,GLVBUY1     REMOVE IT                       
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                CAN'T HANDLE OTHER ERRORS                    
*                                                                               
VRSTD10  LA    R6,DOIDELEM                                                      
         USING DOIDELD,R6                                                       
         LA    R3,DOISCOM1                                                      
         LA    R2,ORSSTD1H                                                      
VRSTD20  CLI   5(R2),0                                                          
         BE    VRSTD30                                                          
         GOTO1 VALISCOM,DMCB,8(R2)                                              
         BNE   INVLFLD                                                          
         MVC   0(L'DOISCOM1,R3),8(R2)                                           
         OC    0(L'DOISCOM1,R3),SPACES                                          
*                                                                               
VRSTD30  XR    R0,R0               NEXT STANDARD COMMENT FLDHDR                 
         IC    R0,0(R2)                                                         
         AR    R2,R0                                                            
         AHI   R3,L'DOISCOM1       BUMP TO NEXT FIELD IN ELEM                   
         LA    R0,ORSSTD3H         MAKE SURE WE DON'T DO MORE THAN 3            
         CR    R2,R0                                                            
         BNH   VRSTD20                                                          
         DROP  R6                                                               
*                                                                               
VRSTDX   DS    0H                                                               
*********                                                                       
* VALIDATE THE DESTINATION FIELD                                                
*********                                                                       
VRDST00  LA    R2,ORSDESTH                                                      
***      BRAS  RE,VALIDEST                                                      
***      BNE   INVLFLD                                                          
         LA    R1,ORSCREVH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R1,ORSTREVH                                                      
         SR    R6,R6               CLEAR R6                                     
         BRAS  RE,SHOWREV         IF DEST CHANGES, REVISION MAY CHANGE!         
         OI    6(R1),X'80'         TRANSMIT FIELD                               
*********                                                                       
* JUST VALIDATE THE INCLUDE DEMO OVERRIDE INPUT FOR NOW                         
*********                                                                       
VRDEM00  LA    R2,ORSINDMH                                                      
         CLI   5(R2),0                                                          
         BE    VRDEMX                                                           
         CLI   8(R2),C'Y'                                                       
         BE    VRDEMX                                                           
         CLI   8(R2),C'N'                                                       
         BE    VRDEMX                                                           
         CLI   8(R2),C'1'                                                       
         BL    INVLFLD                                                          
         CLI   8(R2),C'4'                                                       
         BH    INVLFLD                                                          
VRDEMX   DS    0H                                                               
*********                                                                       
* JUST VALIDATE THE RESEND OPTION IS Y/N OR BLANK                               
*********                                                                       
VRSND00  DS    0H                                                               
         LA    R2,ORSRSNDH                                                      
         CLI   5(R2),0                                                          
         BE    VRSND00X                                                         
         CLI   NEWFAX,C'N'                                                      
         BE    INVLFLD                                                          
         CLI   8(R2),C'Y'                                                       
         BE    VRSND00X                                                         
         CLI   8(R2),C'N'                                                       
         BE    VRSND00X                                                         
         B     INVLFLD                                                          
VRSND00X DS    0H                                                               
         EJECT                                                                  
*********                                                                       
* BUILD THE RECORD                                                              
*********                                                                       
         XC    CASHFLGS,CASHFLGS                                                
         XC    TRDEFLGS,TRDEFLGS                                                
*                                                                               
         TM    MISCFLG1,MF1DRTRD   YES, DOING TRADE ORDERS NOW                  
         BO    BRX180              SKIP CASH ORDER PROCESSING                   
*                                                                               
BR       CLI   ACTNUM,ACTBRNDS                                                  
         BNE   BRX005                                                           
         CLI   TWAOFFC,C'*'        DDS TERMINAL?                                
         BE    BRX003              ONLY WE CAN RESEND AGAIN IF NEED BE          
*                                                                               
         XC    KEY,KEY             SEE IF WE HAVE THE BATCH RECORD              
         LA    R6,KEY                                                           
         USING DBTKEY,R6                                                        
         MVI   DBTKTYP,DBTKTYPQ                                                 
         MVI   DBTKSTYP,DBTKSTYQ                                                
         MVC   DBTKAGMD,BAGYMD                                                  
         MVC   DBTKCLT,BCLT                                                     
         MVC   DBTKPRD,SVBPRD                                                   
         MVC   DBTKEST,SVBEST                                                   
         MVC   DBTKMKT,BMKT                                                     
         MVC   DBTKSTA,BSTA                                                     
         MVC   DBTKPRD2,SVBPR2                                                  
         MVI   RDUPDATE,C'N'       TO ELIMINATE DEADLY EMBRACES                 
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'DBTKEY),KEYSAVE                                            
         BNE   BRX195              BATCH RECORD GONE, JUST SHOW MESSAGE         
         TM    KEY+13,X'80'                                                     
         BNZ   BRX195              BATCH REC DELETED, JUST SHOW MESSAGE         
*                                                                               
BRX003   BRAS  RE,SPAWNOUT         SPAWN OUT THE BRAND ORDERS                   
*                                                                               
         MVI   SVBPRD,X'FF'                                                     
         MVI   SVBPR2,0                                                         
         MVC   SVQPRD,=C'POL'                                                   
         XC    SVQPR2,SVQPR2                                                    
         BRAS  RE,DELBATCH                                                      
         B     BRX170                                                           
*                                                                               
BRX005   BRAS  RE,BLDREC                                                        
         BNE   BRX170                                                           
*                                                                               
         CLI   PFKEY,11            SHOW REP COMMENTS?                           
         BNE   BRX010                                                           
         TM    BITFLAG2,BF2SHOWR   SHOW REP COMMENTS?                           
         BNZ   BRX008                                                           
BRX007   BRAS  RE,SHWCMNTS            NO, SHOW ORDER COMMENTS                   
         B     BRX010                                                           
BRX008   BRAS  RE,SHWRCMNT            YES                                       
*                                                                               
BRX010   XC    CONHED2,CONHED2                                                  
         OI    CONHED2H+6,X'88'    TRANSMIT FOR HIGH INTENSITY                  
         CLI   TWAOFFC,C'*'        DDS TERMINAL?                                
         BNE   BRX012                                                           
         MVC   CONHED2+50(4),=CL4'D/A='                                         
         GOTO1 HEXOUT,DMCB,DISKADDR,CONHED2+54,4                                
*                                                                               
BRX012   CLI   PFKEY,6             TRANSMIT NOW?                                
         BE    BRX025                                                           
*                                                                               
         CLI   ACTNUM,ACTCMPRV     ACTION COMMENT/PREVIEW?                      
         BNE   BRX015                                                           
         MVI   PFKEY,20            YES, FORCE THIS ACTION                       
         B     BRX020                                                           
*                                                                               
BRX015   CLI   PFKEY,5             DESTOV MAINT?                                
         BE    BRX017                                                           
         CLI   PFKEY,8             COMMENT PREVIEW?                             
         BNE   BRX023                                                           
*                                                                               
BRX017   ZIC   R1,PFKEY            YES, THEN INC BY 12                          
         AHI   R1,12                                                            
         STC   R1,PFKEY                                                         
BRX020   BRAS  RE,SETPFKYS         SETUP THE PFKEYS                             
         B     XIT                                                              
*                                                                               
BRX023   TM    BITFLAG,BFFRMBUY    NO, FROM THE BUY PROGRAM?                    
         BZ    VRXIT                                                            
         MVC   CONHED2(35),=CL35'** TRANSMISSION IS STILL PENDING **'           
         B     VRXIT                                                            
*                                                                               
* IF WE GET HERE, BUYER WANTS TO TRANSMIT THE ORDER                             
*                                                                               
BRX025   DS    0H                                                               
***                                                                             
         TM    GENSTAT6,GES$LINK                                                
         BNZ   BRX026                                                           
         TM    OMBASFL2,OM2DACT    AGENCY DEACTIVATED?                          
         JNZ   AGYDACT              - YUP, ERROR                                
***                                                                             
BRX026   LA    R2,ORSMEDH                                                       
         CLI   DARPTNER,C' '                                                    
         BNH   NTDARAGY                                                         
         CLC   DARROUTE,SPACES                                                  
         BNH   NTDARAGY                                                         
*                                                                               
******   BAS   RE,RDSTA            READ DARE STATION RECORD                     
* NEED TO SEE IF IT'S OKAY TO SEND                                              
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         GOTO1 GETREC                                                           
*                                                                               
         CLI   ACTNUM,ACTRCALL     ARE WE RECALLING?                            
         BNE   BRX035              NO                                           
         TM    MISCFLG2,MF2PRSNT   YES, WAS IT PREVIOUSLY SENT?                 
         BNZ   BRX030              - YES                                        
         TM    MISCFLG1,MF1DRTRD   - NO, DOING TRADE NOW?                       
         BNZ   *+12                                                             
         OI    CASHFLG2,RCALCANT     CASH ORDER CANNOT BE RECALLED              
         B     BRX170                                                           
         OI    TRDEFLG2,RCALCANT     TRADE ORDER CANNOT BE RECALLED             
         B     BRX170                                                           
*                                                                               
BRX030   BRAS  RE,PRRECALL         RECALL IT                                    
         TM    BITFLAG,BFRCLLNG    AUTORECALL FROM BUY/NWS PROGRAM?             
         BZ    BRX170                                                           
         LA    R1,BLOCK            YES                                          
         USING GLVXFRSY,R1                                                      
         XC    BLOCK(14),BLOCK                                                  
         MVC   GLVXFRSY,=C'SPO'                                                 
         MVC   GLVXFRPR,=C'OM '                                                 
         MVC   GLVXTOSY,=C'SPO'                                                 
         MVC   GLVXTOPR,=C'BUY'                                                 
         TM    BITFLAG,BFFRMBUY                                                 
         BNZ   *+10                                                             
         MVC   GLVXTOPR,=C'NWS'                                                 
         OI    GLVXFLG1,GLV1RETN+GLV1SEPS                                       
         MVC   GLVXSESR,SVXFRSID            SET CALLER/CALLEE SESSIONS          
         OI    GLVXFLG1,GLV1SIDR+GLV1SIDE   NEED THIS SO RCRI KNOWS             
         DROP  R1                                                               
*                                                                               
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK,14,GLVXCTL                              
         CLI   8(R1),0                                                          
         BE    BRX170              GO BACK FOR MESSAGES AND TRADE               
         DC    H'0'                                                             
*                                                                               
BRX035   CLI   ACTNUM,ACTNTDAR               ARE WE NOTDARING?                  
         BNE   BRX037                                                           
         BRAS  RE,PRNODARE         YES                                          
*                                                                               
BRX037   NI    MISCFLG1,X'FF'-MF1DRREV   NOT DOING DARE REVISIONS YET           
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   BRX040              ANY SUPPLEMENTARY ID ELEMENT?                
         USING DOSPELD,R6                                                       
*                                                                               
         TM    DOSPFLG2,DOSPMOCN   SENDING TO MEDIAOCEAN?                       
         BZ    *+8                                                              
         OI    MISCFLG2,MF2MOORD                                                
*                                                                               
         TM    DOSPFLG2,DOSPNTDR   ORDER WAS PREVIUOSLY NOTDARED?               
         BNZ   BRX046                                                           
*                                                                               
         TM    DOSPFLG1,DOSPAVN    AVN MUST BE FAXED                            
         BZ    *+8                                                              
         OI    SVDARSTA,DARPORNQ   INDICATE PREV AVN ORDER                      
         CLI   DOSPREVN,0                                                       
         BE    BRX040                                                           
         OI    MISCFLG1,MF1DRREV   DOING DARE REVISIONS                         
         DROP  R6                                                               
*                                                                               
BRX040   L     R6,AIO                                                           
*                                  IF EMPTY, NOT PREVIOUSLY SENT                
         NI    MISCFLG2,X'FF'-MF2RCLNG                                          
         MVI   ELCODE,DOXMTELQ     TRANSMISSION ELEMENT (X'11')                 
         BAS   RE,GETEL                                                         
         BE    BRX045                                                           
         TM    MISCFLG1,MF1DRTRD   THIS                                         
         BNZ   *+12                                                             
         OI    CASHFLG1,NEVERSNT        CASH ORDER WAS NEVER SENT               
         B     BRX100                                                           
         OI    TRDEFLG1,NEVERSNT        TRADE ORDER WAS NEVER SENT              
         B     BRX100                                                           
*                                                                               
         USING DOXMTELD,R6                                                      
BRX045   LA    R2,ORSMEDH          FOR THE ERRORS                               
         CLI   DOXMTSTA,QUNDARE    UNDARED OR NODARED?                          
         BE    BRX046                                                           
         CLI   DOXMTSTA,QNODARE                                                 
         BNE   BRX050                                                           
BRX046   TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG1,ORDUNDRD     CASH ORDER IS UNDARED                      
         B     BRX170                                                           
         OI    TRDEFLG1,ORDUNDRD     TRADE ORDER IS UNDARED                     
         B     BRX170                                                           
*                                                                               
BRX050   CLI   DOXMTSTA,QCFMD      CONFIRMED?                                   
         BE    BRX060                                                           
         CLI   DOXMTSTA,QSNTXCNF     AUTOSEND AFTER A PARTIAL CONFIRM?          
         BE    BRX060                                                           
         CLI   DOXMTSTA,QBYRCNFM     AUTOSEND AFTER A PARTIAL CONFIRM?          
         BE    BRX060                                                           
         CLI   DOXMTSTA,QTOBESNT     TO BE SENT AFTER A CONFIRM?                
         BNE   BRX075                                                           
         LR    R0,R6                                                            
         BAS   RE,NEXTEL                                                        
         BE    BRX057                                                           
BRX055   LR    R6,R0                                                            
         B     BRX075                                                           
*                                                                               
BRX057   CLI   DOXMTSTA,QCFMD                                                   
         BNE   BRX055                                                           
         LR    R6,R0                                                            
*                                                                               
BRX060   CLI   SVBPRD,X'FF'        IF POL, THEN NOT A REVISION                  
         BE    BRX065                                                           
         OI    MISCFLG1,MF1DRREV   DOING A DARE REVISION                        
*** WHOA - DISABLING BDE AT THE MOMENT UNTIL WE CAN REPLACE EMAIL SERVR         
         CLC   =C'EML:',ORSROUT    GOING EMAIL?                                 
         BNE   BRX100              NO, WE'RE OKAY TO SEND AGY REVISIONS         
         LA    R2,ORSROUTH                                                      
         B     EMLNOTAV                                                         
*                                                                               
BRX065   TM    MISCFLG2,MF2VCONF   VAR ORDER CONFIRMED ALREADY?                 
         BZ    BRX070                                                           
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG1,CSNDCONF     CASH ORDER IS VAR CONFIRMED                
         B     BRX170                                                           
         OI    TRDEFLG1,CSNDCONF     TRADE ORDER IS VAR CONFIRMED               
         B     BRX170                                                           
*                                                                               
BRX070   OI    MISCFLG2,MF2VAROR   NO, POL ORDER NOW A VAR ORDER                
         B     BRX100              SEND OUT VAR ORDER                           
*                                                                               
BRX075   CLI   DOXMTSTA,QRJCT      CAN ONLY SEND ORDER THAT HAS BEEN            
         BE    BRX100                  REJECTED OR IN ERROR                     
         CLI   DOXMTSTA,QERRORED                                                
         BE    BRX100                                                           
         CLI   DOXMTSTA,QEMPTY                                                  
         BE    BRX100                                                           
*                                                                               
         CLI   DOXMTSTA,QRCLAPPR   OR CERTAIN RECALL STATUSES                   
         BE    BRX100                                                           
         CLI   DOXMTSTA,QRCLDELN                                                
         BE    BRX100                                                           
         CLI   DOXMTSTA,QRCLWIP                                                 
         BE    BRX100                                                           
         CLI   DOXMTSTA,QRCLTRNS                                                
         BE    BRX100                                                           
         CLI   DOXMTSTA,QTOBESNT   TO BE SENT VIA SCRIPT                        
         BE    BRX100                                                           
         CLI   DOXMTSTA,QSNTXCNF   SENT PENDING CANCELLED, CONFIRMED            
         BE    BRX100                                                           
         CLI   DOXMTSTA,QSNTXREJ   SENT PENDING CANCELLED, REJECTED             
         BE    BRX100                                                           
*                                                                               
         CLI   DOXMTSTA,QRECALL    IN MIDST OF RECALLING?                       
         BNE   BRX080                                                           
         OI    MISCFLG2,MF2RCLNG                                                
         B     BRX100                                                           
*** HWON - RULES TO ALLOW RESENDING A PREVIOUSLY SEND ORDER 10/30/02***         
BRX080   TM    SVDARSTA,DARPORNQ   PREV/AVN??                                   
         BO    BRX100              YES, ALLOW IT TO SEND                        
*                                                                               
         CLC   =C'FAX:',ORSROUT   GOING FAX?                                    
         BNE   BRX083                                                           
         CLC   =X'FFFF',DOXMTDID   PREVIOUSLY FAXED?                            
         BE    BRX085              YES, ALLOW IT TO SEND                        
                                                                                
BRX083   CLC   =C'EML:',ORSROUT   GOING EMAIL?                                  
         BNE   BRX090                                                           
*** WHOA - DISABLING BDE AT THE MOMENT UNTIL WE CAN REPLACE EMAIL SERVR         
         LA    R2,ORSROUTH                                                      
         B     EMLNOTAV                                                         
*                                                                               
         CLC   =X'FFFD',DOXMTDID   PREVIOUSLY EMAILED?                          
         BNE   BRX097              NO                                           
BRX085   OI    SVDARSTA,DARFXNGQ   YES, ALLOW IT TO SEND                        
         B     BRX100                                                           
*                                                                               
BRX090   CLC   =X'FFFD',DOXMTDID   WAS IT PREVIOUSLY SENT EMAIL?                
         BE    BRX095                                                           
         CLC   =X'FFFF',DOXMTDID   OR FAX?                                      
         BNE   BRX097              NO                                           
BRX095   CLI   DOXMTSTA,0          YES, ANY RESPONSE TO THE FAX/EMAIL           
         BNE   BRX100                                                           
*** HWON - RULES TO ALLOW RESENDING A PREVIOUSLY SEND ORDER 10/30/02***         
*                                                                               
BRX097   TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG1,SNTALRDY     CASH ORDER WAS SENT ALREADY                
         B     BRX170                                                           
         OI    TRDEFLG1,SNTALRDY     TRADE ORDER WAS SENT ALREADY               
         B     BRX170                                                           
         DROP  R6                                                               
*                                                                               
BRX100   TM    MISCFLG1,MF1DRREV   DOING DARE REVISIONS?                        
         BZ    BRX105                                                           
         BRAS  RE,ANYOUTMG         ANY OUTSTANDING MAKEGOODS?                   
         BE    BRX105                                                           
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG1,GOTSMMGS     CASH ORDER HAS SOME MAKEGOODS              
         B     BRX170                                                           
         OI    TRDEFLG1,GOTSMMGS     TRADE ORDER HAS SOME MAKEGOODS             
         B     BRX170                                                           
*                                                                               
BRX105   MVC   AIO,AIO2            SO WE DON'T KILL OUR ORDER RECORD            
         BRAS  RE,FRSTAIRD         FIND THE FIRST AIR DATE                      
         MVC   AIO,AIO1                                                         
         BE    BRX135              WE HAVE A BUYLINE                            
*                                                                               
         TM    MISCFLG1,MF1DRREV   DOING A DARE REVISION?                       
         BNZ   BRX135              YES, SEND ORDER W/O BUYLINES                 
         TM    MISCFLG2,MF2PRSNT   NO CASH/TRADE BUYS.  PREV SENT?              
         BNZ   BRX135                  YES, SEND ORDER W/O BUYLINES             
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    *+12                                                             
         OI    TRDEFLG1,NOBYSEXS   YES, NO BUYS EXIST FOR TRADE ORDER           
         B     BRX170                                                           
*                                                                               
         OI    CASHFLG1,NOBYSEXS   NO, NO BUYS EXIST FOR CASH ORDER             
         TM    MISCFLG1,MF1TRDRC   NO, CAN WE DO TRADE?                         
         BNZ   BRX110                                                           
         OI    TRDEFLG1,NOBYSEXS   YES, NO BUYS EXIST FOR TRADE ORDER           
         TM    MISCFLG2,MF2PRSNT   NO CASH/TRADE BUYS.  PREV SENT?              
         BZ    BRX170                  NO, SO NO DATA TO SEND                   
*                                                                               
BRX110   LA    R2,DOXMELEM                                                      
         USING DOXMTELD,R2                                                      
         MVC   DOXMTOID,TWAORIG                                                 
         MVC   DOXMTDID,=X'FFFE'   SET DESTID=NOBODY                            
         BRAS  RE,BLDDAYTM                                                      
         MVC   DOXMTSTD,DOXMTYMD                                                
         MVC   DOXMTSTT,DOXMTTIM                                                
         MVI   DOXMTSTA,QEMPTY     NO BUYS                                      
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
BRX112   CLI   0(R6),0               NEW TRANSMISSION ELEMENT GOES              
         BE    BRX125                  AFTER ALL THE ID ELEMENTS                
         CLI   0(R6),DORPELQ                                                    
         BNL   BRX125                                                           
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     BRX112                                                           
*                                                                               
BRX125   BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)                              
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ                                                  
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,QEMPTY                                                  
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
BRX127   CLI   0(R6),0          ADD AFTER ALL TRANSMISSION ELEMENTS             
         BE    BRX130           AND BEFORE AN AUDIT ELEMENT                     
         CLI   0(R6),DOSTELQ                                                    
         BNL   BRX130                                                           
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     BRX127                                                           
*                                                                               
BRX130   GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         L     RF,AIO                                                           
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),0(RF)                                               
         GOTO1 READ                                                             
         MVI   RDUPDATE,C'Y'                                                    
         MVC   AIO,AIO2                                                         
         GOTO1 GETREC                                                           
         MVC   AIO,AIO1                                                         
*                                                                               
         GOTOR COLPASKY,DMCB,(C'K',0)                                           
         BRAS  RE,MYPUTREC                                                      
*                                                                               
         BRAS  RE,UPSALREC         UPDATE THE X'04' SALESPERSON RECORD          
*                                                                               
         B     BRX170                                                           
*                                                                               
BRX135   TM    MISCFLG1,MF1TRDRC   WE HAVE TRADE CONDITION?                     
         BNZ   *+8                                                              
         OI    TRDEFLG1,NOBYSEXS   NO BUYS EXIST FOR TRADE EITHER               
*                                                                               
         CLC   =C'FAX:',ORSROUT   FAX OR EMAIL GOES TO THE FAX ROUTINE          
         BE    BRX150                                                           
         CLC   =C'EML:',ORSROUT                                                 
         BE    BRX150              YES                                          
         TM    SVDARSTA,DARPORNQ   PREV AVN ORDER?                              
         BNZ   BRX150              YES, DEFINITELY GO FAX                       
*                                                                               
         LA    RF,TESTIDS                                                       
BRX140   CLI   0(RF),X'FF'         EOT?                                         
         BE    BRX150                                                           
         CLC   AGENCY,0(RF)        ARE WE SENDING FROM A TEST ID?               
         BE    BRX145                                                           
         AHI   RF,L'TESTIDS                                                     
         B     BRX140                                                           
BRX145   CLC   =C'YY',ORSSTA       ONLY ALLOW SENDING TO TEST STATIONS          
         BNE   SNDFSJD6                                                         
*                                                                               
BRX150   CLI   ORSXMIT,C'B'        TRANSMIT BOTH CASH AND TRADE?                
         BE    BRX160                                                           
         CLI   ORSXMIT,C'C'        TRANSMIT CASH ONLY?                          
         BE    BRX155              YES                                          
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    BRX170                                                           
         B     BRX160                                                           
*                                                                               
       ++INCLUDE DDTSTIDTAB                                                     
*                                                                               
BRX155   TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   BRX170                                                           
BRX160   CLC   =C'FAX:',ORSROUT   FAX OR EMAIL GOES TO THE FAX ROUTINE          
         BE    BRX200                                                           
         CLC   =C'EML:',ORSROUT                                                 
         BE    BRX200              YES                                          
*                                                                               
         TM    BITFLAG2,BF2STAOK   OK TO SEND TO THIS STATION?                  
         BNZ   BRX165              YES                                          
         TM    SVDARSTA,DARDRKST   ARE THERE ANY DARK STATIONS                  
         BZ    BRX165              NO                                           
         BRAS  RE,STATMSSG                                                      
         B     XIT                                                              
*                                                                               
BRX165   TM    SVDARSTA,DARPORNQ   PREV AVN ORDER?                              
         BNZ   BRX200              YES, DEFINITELY GO FAX                       
*                                                                               
         BRAS  RE,PR               TRANSMIT NOW VIA EDI                         
*                                                                               
BRX170   TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   BRX190                                                           
         TM    MISCFLG1,MF1TRDRC   WE HAVE TRADE CONDITION?                     
         BZ    BRX190                                                           
         CLI   ACTNUM,ACTRCALL     ARE WE RECALLING?                            
         BNE   BRX175                                                           
         CLI   ORSXMIT,C'C'        ONLY RECALL CASH?                            
         BE    BRX190              YES, THEN WE'RE DONE                         
BRX175   OI    MISCFLG1,MF1DRTRD   YES, WE SHOULD DO TRADE NOW                  
***********************************                                             
* PROCESS  TRADE  ORDER AS WELL                                                 
***********************************                                             
BRX180   BRAS  RE,STRPPHNE                                                      
*                                                                               
         LA    R6,DOXMELEM         SETUP TRANSMISSION ELEMENT                   
         USING DOXMTEL,R6                                                       
         XC    DOXMELEM,DOXMELEM                                                
         MVI   DOXMTEL,DOXMTELQ                                                 
         MVI   DOXMTLEN,DOXMTLNQ                                                
         DROP  R6                                                               
*                                                                               
         LA    R6,KEY                                                           
         USING DOKEY,R6                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(L'SAVEKEY),SAVEKEY    USING THE CASH KEY                     
         OI    DCKFLAG,DCKFTRDE    LOOK FOR TRADE ORDER NOW                     
*                                                                               
         MVC   SAVEKEY,KEY         SAVE THE TRADE KEY NOW                       
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         NI    KEY+12,X'FF'-DCKFSCSW   CLEAR THE X'01 SSC FLAG                  
*                                                                               
         NI    MISCFLG2,X'FF'-MF2PRSNT                                          
         NI    MISCFLG3,X'FF'-MF3PRVCF                                          
         NI    MISCFLG1,X'FF'-MF1RECNF   RECORD NOT FOUND                       
         MVC   OLDSPERT,ORSSPTX                                                 
         MVC   OLDSPER,ORSSALE                                                  
         OC    OLDSPER,SPACES                                                   
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BE    BRX185                                                           
         BRAS  RE,INITELEM                                                      
         MVC   DOIDELEM+DOIDSPER-DOIDELD(L'DOIDSPER),OLDSPER                    
         OI    MISCFLG1,MF1RECNF   RECORD NOT FOUND                             
         B     BR                                                               
*                                                                               
BRX185   BRAS  RE,TRANSEL          READ RECORD AND UPDATE FLAGS                 
*                                                                               
BRX187   CLI   ORSXMIT,C'T'        ONLY PROCESS TRADE ORDER?                    
         BE    BR                  ITS OK, GO AND SEND IT                       
         L     R6,AIO                                                           
         LA    R6,24(R6)                                                        
         USING DOIDELD,R6                                                       
         OC    DOIDSPER,DOIDSPER                                                
         BNZ   BRX189                                                           
         MVC   DOIDSPER,ORSSALE                                                 
         B     BR                                                               
BRX189   MVC   DOIDELEM,0(R6)      MUST SAVE THE CORRECT PRIMARY ELEM           
*        MVC   FAKEFLDH,ORSSALEH                                                
         MVC   ORSSALE(L'DOIDSPER),DOIDSPER                                     
*                                                                               
         CLI   QMED,C'R'           IS IT RADIO?                                 
         BNE   BR                  NO, SKIP THIS                                
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,NEXTEL                                                        
         USING DOSPELD,R6                                                       
         TM    DOSPFLG1,DOSPPPER    POINTPERSON?                                
         BZ    *+14                 NO, SALESPERSON                             
         MVC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         B     BRX189A                                                          
         MVC   ORSSPTX,=X'E2819385A2978599A29695'                               
BRX189A  GOTOR CHKRPSAL,DMCB,ORSSALEH                                           
         B     BR                                                               
*                                                                               
BRX190   LA    R2,ORSORDH                                                       
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    *+8                                                              
         LA    R2,ORSTORDH                                                      
         MVC   8(L'ORSORD,R2),SVQCORDR                                          
         OI    6(R2),X'80'                                                      
*                                                                               
         CLI   ORSXMIT,C'B'        TRANSMIT BOTH CASH AND TRADE?                
         BNE   BRX192                                                           
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    BRX192                                                           
         MVC   ORSSALE,OLDSPER                                                  
         CLI   OLDSPERT,C'P'                                                    
         BNE   *+14                 NO, SALESPERSON                             
         MVC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON                  
         B     BRX192                                                           
         MVC   ORSSPTX,=X'E2819385A2978599A29695'                               
*                                                                               
BRX192   CLI   ACTNUM,ACTXMIT      DONE WITH THE TRANSMIT?                      
         BNE   BRX195                                                           
         XC    CONACT,CONACT                                                    
         MVC   CONACT(4),=CL4'SEND'                                             
         OI    CONACTH+6,X'80'                                                  
         MVI   ACTNUM,ACTSEND                                                   
         NI    BITFLAG,X'FF'-BFRCLLNG  YES, RETURN                              
         MVI   PFKEY,12                                                         
         BRAS  RE,SETPFKYS         SETUP THE PFKEYS                             
         B     XIT                                                              
*                                                                               
BRX195   LA    R2,ORSMEDH          PLACE CURSOR HERE                            
         BRAS  RE,SHWMESGE                                                      
         J     OURMESGE                                                         
***********************************                                             
* FAX STATION                                                                   
***********************************                                             
BRX200   CLC   =C'D6',AGENCY       DDSU                                         
         BNE   BRX205                                                           
*                                                                               
         CLC   =C'REP',ORSROUT     THEN IT CAN ONLY SEND TO THE REPS            
         BE    BRX205                "REP" AND "WHO"                            
         CLC   =C'FAX: SENDAFAX',ORSROUT                                        
         BE    BRX205                                                           
****                                                                            
         CLI   ORSSTA,C'W'         IF WE'RE SENDING TO A REAL STATION           
         BE    NSFAXREP             (THAT BEING STATIONS WHOSE CALL             
         CLI   ORSSTA,C'K'           LETTERS BEGIN WITH A "W" OR "K")           
         BE    NSFAXREP            THEN GIVE AN ERROR                           
****                                                                            
BRX205   BRAS  RE,FAX                                                           
         B     BRX170              GO BACK FOR MESSAGES AND TRADE               
*                                                                               
*                                                                               
VRXIT    DS    0H                                                               
         LA    R2,ORSMEDH                                                       
         TM    MISCFLG1,MF1RECNF   ADDING THE RECORD?                           
         JNZ   RECADDED            YES, CAN'T HAVE ERROR YET                    
*                                                                               
         BRAS  RE,CHKORERR         SEE IF ORDER IS IN ERR                       
         JNE   RECCHNGD            NONE                                         
         J     OURMESGE            SHOW OUR MESSAGE                             
         EJECT                                                                  
         EJECT                                                                  
ZEROS    DC    12C'0'                                                           
RELO     DS    A                                                                
*                                                                               
NOTHING  DC    H'0'                                                             
*                                                                               
         GETEL R6,DATADISP,ELCODE  USED FOR THE GETEL OPERATIONS                
         EJECT                                                                  
YES      SR    RC,RC                                                            
NO       LTR   RC,RC                                                            
XIT      XIT1                                                                   
         SPACE 2                                                                
HEADING  SSPEC H2,55,RUN                                                        
         DC    X'00'                                                            
         EJECT                                                                  
***********************************************************************         
* GENERAL ERROR MESSAGES                                                        
***********************************************************************         
MISSFLD  MVI   GERROR1,MISSING                                                  
         J     UGERROR1                                                         
*                                                                               
INVLFLD  MVI   GERROR1,INVALID                                                  
         J     UGERROR1                                                         
*                                                                               
INVLDATE MVI   GERROR1,INVDATE                                                  
         J     UGERROR1                                                         
*                                                                               
INVLDEST MVI   GERROR1,INVDEST                                                  
         J     UGERROR1                                                         
*                                                                               
RECXISTS MVI   GERROR1,RECEXIST    RECORD ALREADY EXISTS                        
         J     UGERROR1                                                         
*                                                                               
RECNTFND MVI   GERROR1,NOTFOUND    RECORD NOT FOUND                             
         J     UGERROR1                                                         
*                                                                               
CANTSWTC MVI   GERROR1,3           CAN'T SWITCH TO THE MIS PROGRAM              
*                                                                               
UGERROR1 MVI   GERROR,0           IN CASE THERE WAS GARBAGE FROM BEFORE         
         J     ERREXIT                                                          
***********************************************************************         
* SYSTEM 71 ERROR MESSAGES                                                      
***********************************************************************         
SALPNTAS MVC   GERROR,=Y(184)                                                   
ER71EXIT MVI   GETMSYS,71                                                       
         J     ERRRTEXT                                                         
***********************************************************************         
* ERROR MESSAGES (SYSTEM 2)                                                     
***********************************************************************         
UNKNDEST LA    R2,ORSROUTH                                                      
         LHI   RF,784              DESTINATION ID IS NOT VALID                  
         J     ER2EXIT1                                                         
*                                                                               
NOPOLPRD MVI   GERROR1,CNTBEPOL    PRODUCT CAN'T BE POL                         
         MVI   GERROR,0                                                         
         J     ER2EXIT                                                          
*                                                                               
NODATASN LA    R2,ORSMEDH          NO DATA TO SEND                              
         LHI   RF,NODATA                                                        
         J     ER2EXIT1                                                         
*                                                                               
ALLOCERR LHI   RF,NOTALLAL         NOT ALL SPOTS ALLOCATED                      
*                                                                               
ER2EXIT1 STCM  RF,3,GERROR                                                      
ER2EXIT  MVI   GETMSYS,2           SPOT MESSAGES                                
         J     ERREXIT                                                          
*                                                                               
MISSCOS2 MVC   GERROR,=Y(1251)                                                  
         MVI   GETMSYS,2           SPOT MESSAGES                                
         J     ERRRTEXT                                                         
***********************************************************************         
* ERROR MESSAGES (SYSTEM 23)                                                    
***********************************************************************         
NEEDRJCT MVI   GERROR1,GETRJCTD    ORDER HAS TO BE REJECTED FIRST BY...         
         J     UGERROR1                                                         
*                                                                               
NTDARAGY MVI   GERROR1,NOTDARAG    AGENCY IS NOT A VALID DARE TRADING..         
         J     UGERROR1                                                         
*                                                                               
NWACTION MVI   GERROR1,RCNTACTN    RECALL AND NOTDARE ARE NOW ACTIONS           
         J     UGERROR1                                                         
*                                                                               
TWOMNYRV MVI   GERROR1,TOOMNYRV    TOO MANY REVISIONS FOR THIS ORDER!           
         J     UGERROR1                                                         
*                                                                               
NOPOLODR MVI   GERROR1,POLORDER    POL ORDER CANNOT BE ADDED                    
         J     UGERROR1                                                         
*                                                                               
NONFLTBD MVI   GERROR1,208         NON-FLIGHT PERIOD IS INVALID, CHECK          
         J     UGERROR1               FLIGHT RECORD                             
*                                                                               
NSFAXREP MVI   GERROR1,209         ORDER CANNOT BE SENT TO THIS FAX REP         
         J     UGERROR1               FROM THIS ID!!                            
*                                                                               
SNDFSJD6 MVI   GERROR1,210         ORDER CANNOT BE SENT FOR THIS                
         J     UGERROR1               STATION FROM THIS ID!!                    
*                                                                               
NOTRDRCL MVI   GERROR1,212         NO TRADE ORDER TO RECALL!!                   
         J     UGERROR1                                                         
*                                                                               
CANTBREV LHI   RF,258              ORDER CAN'T BE A REVISION ORDER              
         J     ER23EXIT                                                         
*                                                                               
FEATURNA LHI   RF,263              FEATURE NOT AVAILABLE AT THIS TIME           
         J     ER23EXIT                                                         
*                                                                               
EMLNOTAV LHI   RF,272              EMAIL NOT AVAILABLE, USE DESTOV              
         J     ER23EXIT                                                         
*                                                                               
NONOTDAR LHI   RF,NONTDARE          NOTDARE INVALID FOR REVISED ORDER           
         J     ER23EXIT                                                         
*                                                                               
CANTOMGS LHI   RF,OUTSTMGS          THERE ARE OUTSTANING MGS FOR ORDER          
         J     ER23EXIT                                                         
*                                                                               
NODESTOV LHI   RF,265              ORDER CONFIRMED, DESTOV NOT ALLOWED          
         J     ER23EXIT                                                         
*                                                                               
WRNGOFF  LHI   RF,217             USERID AND BUYER OFFICE DO NOT MATCH!         
         J     ER23EXIT                                                         
*                                                                               
PNDNGORD LHI   RF,218              PENDING ORDER CANNOT BE CHANGED              
         J     ER23EXIT                                                         
*                                                                               
INVBSCOM LHI   RF,271              INVALID BUYER STANDARD COMMENT               
ER23EXIT STCM  RF,3,GERROR                                                      
         J     ERREXIT                                                          
***********************************************************************         
         LTORG                                                                  
*                                                                               
***********************************************************************         
* ERRORS WITH REPLACEMENT TEXT (&1)                                             
***********************************************************************         
BYRALRDY MVI   GERROR1,GOTBYRAL    BUYER &1 ALREADY ASSIGNED TO THIS ..         
         MVI   GERROR,0                                                         
         J     ERRRTEXT                                                         
***********************************************************************         
* GENERAL INFO MESSAGES                                                         
***********************************************************************         
NEEDFLDS MVI   GERROR1,REQFIELD    PLEASE ENTER FIELDS AS REQUIRED              
         J     INFERR1                                                          
*                                                                               
NTRCHNGS MVI   GERROR1,RCDSPCHA    RECORD DISPLAYED - NOW ENTER CHANGES         
         J     INFERR1                                                          
*                                                                               
RECCHNGD MVI   GERROR1,RCWASCHA    RECORD WAS CHANGED - ENTER NEXT RE..         
         J     INFERR1                                                          
*                                                                               
RECADDED MVI   GERROR1,NEWRECRD    NEW RECORD HAS BEEN ADDED TO THE F..         
         J     INFERR1                                                          
*                                                                               
MAKESELS MVI   GERROR1,LSTDISPL    LIST DISPLAYED - SELECT OR HIT ENT..         
*                                                                               
INFERR1  MVI   GERROR,0                                                         
INFEXIT  MVI   GETMSYS,255         GENERAL MESSAGES                             
MYINFXIT MVI   GMSGTYPE,C'I'       INFO MESSAGES                                
ERREXIT  GOTO1 MYERR                                                            
*                                                                               
***********************************************************************         
* INFO MESSAGES (SYSTEM 23)                                                     
***********************************************************************         
ONITSWAY MVI   GERROR1,ODRONWAY    ** DARE ORDER &1 IS ON ITS WAY! **           
         CLI   RESEND,C'Y'                                                      
         JNE   *+8                                                              
         MVI   GERROR1,ODRESENT                                                 
         J     INFRTEXT                                                         
*                                                                               
OURMESGE MVI   GERROR,0                                                         
         MVI   GERROR1,INFOMESS    &1                                           
*                                                                               
INFRTEXT LAY   R1,MYINFXIT                                                      
         J     *+10                                                             
ERRRTEXT LAY   R1,ERREXIT                                                       
         OI    GENSTAT2,USGETTXT                                                
         XC    GETTXTCB,GETTXTCB                                                
         LA    RF,GETTXTCB                                                      
         USING GETTXTD,RF                                                       
         MVI   GTMSYS,23                                                        
         LA    RE,BLOCK                                                         
         STCM  RE,7,GTASUBST                                                    
         DROP  RF                                                               
         BR    R1                                                               
***********************************************************************         
* 2 BYTE ERROR MESSAGES                                               *         
***********************************************************************         
ERRAVN   LHI   RF,963               PREV/NEW MUST BE FILLED IN                  
         J     SPERREX                                                          
*                                                                               
ERRDEST  LHI   RF,981               DEST MUST BE STA OR REP                     
         J     SPERREX                                                          
*                                                                               
NOSALES  LHI   RF,1160              DID NOT SELECT SALESPERSON                  
         J     SPERREX                                                          
*                                                                               
NOTREP   LHI   RF,1163              NOT REP CAN'T SELECT SALEPERSON             
         J     SPERREX                                                          
*                                                                               
ERRROUTE LHI   RF,1165              CANT SEL SALEP IF ROUTE = EML/FAX           
         J     SPERREX                                                          
*                                                                               
NOIDREC  LHI   RF,1166              NO ID REC                                   
         J     SPERREX                                                          
*                                                                               
NOIDREC2 LHI   RF,1167              NO AGY ID ELEM                              
         J     SPERREX                                                          
*                                                                               
ERRBROW  LHI   RF,1171              CAN'T GO TO BROWSE WITH MEDIA T             
         J     SPERREX                                                          
*                                                                               
AGYDACT  LHI   RF,1328              AGENCY HAS BEEN DEACTIVATED                 
*                                                                               
SPERREX  STCM  RF,3,ERRNUM                                                      
         OI    GENSTAT2,USGETTXT                                                
         LA    RF,GETTXTCB                                                      
         USING GETTXTD,RF                                                       
         MVC   GTMSGNO,ERRNUM                                                   
         MVI   GTMTYP,GTMERR                                                    
         MVI   GTMSYS,2                                                         
         MVC   AIO,AIO1                                                         
         GOTO1 ERREX                                                            
         DROP  RF                                                               
***********************************************************************         
* INITIALIZE THE DARE ELEMENTS                                                  
***********************************************************************         
INITELEM NTR1  BASE=*,LABEL=*                                                   
         LA    R6,DOIDELEM         SETUP DARE ID ELEMENT                        
         USING DOIDELD,R6                                                       
         XC    DOIDELEM,DOIDELEM                                                
         MVI   DOIDEL,DOIDELQ                                                   
         MVI   DOIDLEN,DOIDLNQ                                                  
         MVC   DOIDFLTN,SVBFLT     FLIGHT NUMBER                                
         DROP  R6                                                               
*                                                                               
         LA    R6,DOI2ELEM         SETUP DARE 2NDARY ID ELEMENT                 
         USING DOI2ELD,R6                                                       
         XC    DOI2ELEM,DOI2ELEM                                                
         MVI   DOI2EL,DOI2ELQ                                                   
         MVI   DOI2LEN,DOI2LNQ                                                  
         DROP  R6                                                               
*                                                                               
         LA    R6,DOXMELEM         SETUP TRANSMISSION ELEMENT                   
         USING DOXMTEL,R6                                                       
         XC    DOXMELEM,DOXMELEM                                                
         MVI   DOXMTEL,DOXMTELQ                                                 
         MVI   DOXMTLEN,DOXMTLNQ                                                
         DROP  R6                                                               
*                                                                               
         LA    R6,DOBYELEM         SETUP BUYLINE ELEMENT                        
         USING DOBUYEL,R6                                                       
         XC    DOBYELEM,DOBYELEM                                                
         MVI   DOBUYEL,DOBUYELQ                                                 
         MVI   DOBUYLEN,DOBUYLNQ                                                
         B     XIT                                                              
         DROP  R6                                                               
         EJECT                                                                  
***********************************************************************         
* NOTIFYS THE BUY PROGRAM THAT A HEADLINE CHANGE OCCURED                        
*                                                                               
* ON ENTRY:    (R2)                A(FIELD HEADER)                              
*              PARAM 1             THE SAVED GLOBBER VARIABLE                   
***********************************************************************         
NOTFYBUY NTR1  BASE=*,LABEL=*                                                   
         TM    BITFLAG,BFFRMBUY    FROM THE BUY PROGRAM?                        
         BZ    NFYBUYX             NO, NO NEED TO NOTIFY BUY PROGRAM            
*                                                                               
         L     R3,0(R1)            R3 = A(GLOBBER VARIABLE)                     
*                                                                               
         ZIC   R1,5(R2)                                                         
         CLI   5(R2),0                                                          
         BE    NFYBUY10                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   8(0,R2),0(R3)                                                    
         BE    NFYBUYX                                                          
*                                                                               
NFYBUY10 L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         XC    BLOCK(12),BLOCK                                                  
         LA    R2,BLOCK                                                         
         MVC   0(6,R2),=C'SPTDAR'  FROM SPOT DARE                               
         OI    6(R2),X'80'         HEADLINE CHANGE IN DARE                      
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK,12,GLVNOTE                              
*                                                                               
NFYBUYX  B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* MARKS THE DAYS OF THE WEEK IN THE FORMAT MTWTFSS.                             
* IE:  'XX X  X' = MONDAY,TUESDAY,THURSDAY, & SUNDAY                            
*                                                                               
* ON ENTRY:    PARAM 1  BYTE  0    BYTE WHICH CONTAINS THE DAYS                 
*                       BYTES 1-3  A(WHERE TO DISPLAY THE FORMAT)               
***********************************************************************         
SHWDAYS  NTR1  BASE=*,LABEL=*                                                   
         ZICM  R0,0(R1),(8)        WE KNOW (BIT 0 == 0)                         
         L     RF,0(R1)            FIGURE OUT WHICH DAYS ARE ON                 
         LA    R1,7                7 BITS TO SHIFT                              
*                                                                               
SHWDAY10 SLA   R0,1                IF (BIT 1 = 1) AND IT IS SHIFTED OUT         
         BNO   *+8                                                              
         MVI   0(RF),C'X'          THEN WE KNOW THE DAY IS SET                  
         LA    RF,1(RF)                                                         
         BCT   R1,SHWDAY10                                                      
*                                                                               
SHWDAYX  B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECKS TO SEE IF THERE ARE ANY OUTSTANDING MAKEGOODS FOR THIS ORDER           
* NUMBER.  A MAKEGOOD IS NOT OUTSTANDING IF IT IS:                              
* ==>    OKAYED                                                                 
* ==>    REJECTED                                                               
* ==>    CANCELLED                                                              
* ==>    CANCELLED WITH MORE TO FOLLOW                                          
*                                                                               
* NOTE:  SAVEKEY STILL HAS THE KEY FOR ORDER RECORD (PASSIVE BY CLT)            
*        'BYTE'  WILL GET CLOBBERED                                             
***********************************************************************         
ANYOUTMG NTR1  BASE=*,LABEL=*                                                   
         LA    R4,KEY                                                           
         XC    KEY,KEY                                                          
         USING MNKEY,R4                                                         
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         MVI   MNKTYPE,MNKTYPQ                                                  
         MVI   MNKSUBTY,MNKSTYPQ                                                
         MVC   MNKAGMD,BAGYMD                                                   
         MVC   MNKORDER,DOKORDER                                                
*                                                                               
         LA    R6,DORFRST                                                       
         USING DOIDELD,R6                                                       
         MVC   MNKBYR,DOIDBYR                                                   
         DROP  R4,R6                                                            
*                                                                               
         MVI   BYTE,C'Y'           DEFAULT IS TO RETURN WITH AN EQ              
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
ANYOMG10 CLC   KEY(MNKGROUP-MNKEY),KEYSAVE                                      
         BNE   ANYOMG99                                                         
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         USING MNKEY,R6                                                         
         MVI   ELCODE,MNSTELQ                                                   
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING MNSTELD,R6                                                       
         CLI   MNSTSTAT,MNSTDELV                                                
         BNE   *+12                                                             
         BAS   RE,NEXTEL                                                        
         B     *-12                                                             
         CLI   MNSTSTAT,MNSTCANM                                                
         BE    ANYOMG20                                                         
         CLI   MNSTSTAT,MNSTCAN                                                 
         BE    ANYOMG20                                                         
         CLI   MNSTSTAT,MNSTOKAY                                                
         BE    ANYOMG20                                                         
         CLI   MNSTSTAT,MNSTREJ                                                 
         BE    ANYOMG20                                                         
         MVI   BYTE,C'N'                                                        
         B     ANYOMG99            CAN'T SEND REVISION                          
*                                                                               
ANYOMG20 MVI   RDUPDATE,C'N'                                                    
         GOTO1 SEQ                                                              
         B     ANYOMG10                                                         
*                                                                               
ANYOMG99 XC    KEY,KEY             RESTORE THE DARE ORDER RECORD                
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
ANYOMGX  CLI   BYTE,C'Y'                                                        
         BE    YES                                                              
         B     NO                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAYS THE ID NAME BASED ON AN ID NUMBER                                    
*                                                                               
* ON ENTRY:    PARAM 1             A(ID NUMBER)                                 
*              PARAM 2             A(FIELD HEADER OF USER ID)                   
*                                                                               
* ON EXIT:     'KEY' & 'KEYSAVE' GOT CLOBBERED                                  
*              AIO2 WAS USED                                                    
*              'ELCODE' GOT CLOBBERED                                           
***********************************************************************         
SHWIDNUM NTR1  BASE=*,LABEL=*                                                   
         L     R3,0(R1)            SET UP VARIABLES                             
         L     R2,4(R1)                                                         
         OC    0(2,R3),0(R3)       ANY ID NUMBER?                               
         BZ    SIDNX               NONE, THEN EXIT                              
         CLC   =X'FFFE',0(R3)                                                   
         BE    SIDNX                                                            
         CLC   =X'FFFB',0(R3)                                                   
         BE    SIDNX                                                            
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CTIKEY,R4                                                        
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKNUM,0(R3)                                                    
         DROP  R4                                                               
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMREAD'),=C'CTFILE',(R4),AIO2                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R6,AIO2                                                          
         USING CTIREC,R6                                                        
         LA    R6,CTIDATA                                                       
         MVI   ELCODE,X'02'        LOOK FOR THE DESCRIPTION ELEMENT             
         BAS   RE,NEXTEL                                                        
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING CTDSCD,R6           COPY USER ID TO SCREEN                       
         ZIC   R1,CTDSCLEN                                                      
         SH    R1,=Y(CTDSC-CTDSCD+1)                                            
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),CTDSC                                                    
         DROP  R6                                                               
*                                                                               
SIDNX    OI    6(R2),X'80'         TRANSMIT THE FIELD                           
         B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* GETS THE ID NUMBER BASED ON AN ID NAME                                        
*                                                                               
* ON ENTRY:    PARAM 1             A(ID NAME)                                   
*                                                                               
* ON EXIT:     BDESTID             ID NUMBER                                    
*              'KEY' & 'KEYSAVE' GOT CLOBBERED                                  
*              AIO2 WAS USED                                                    
*              'ELCODE' GOT CLOBBERED                                           
***********************************************************************         
GETIDNUM NTR1  BASE=*,LABEL=*                                                   
         L     R3,0(R1)                                                         
         MVC   BDESTID,=X'FFFF'                                                 
         CLC   =C'FAX:',ORSROUT    ROUTE = FAX?                                 
         BE    GIDNX               YES                                          
         MVC   BDESTID,=X'FFFD'                                                 
         CLC   =C'EML:',ORSROUT    ROUTE = EMAIL?                               
         BE    GIDNX               YES                                          
         XC    BDESTID,BDESTID                                                  
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CTIKEY,R4                                                        
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKID,0(R3)                                                     
         OC    CTIKID,SPACES                                                    
         DROP  R4                                                               
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMREAD'),=C'CTFILE',(R4),AIO2                 
         CLI   8(R1),0                                                          
         BNE   GIDNX               NOT FOUND, JUST EXIT                         
*                                                                               
         L     R6,AIO2                                                          
         USING CTIREC,R6                                                        
         LA    R6,CTIDATA                                                       
         MVI   ELCODE,X'02'        LOOK FOR THE DESCRIPTION ELEMENT             
         BAS   RE,NEXTEL                                                        
         MVC   BDESTID,2(R6)                                                    
         DROP  R6                                                               
*                                                                               
GIDNX    B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET THE PFKEY INFORMATION                                                     
***********************************************************************         
SETPFKYS NTR1  BASE=*,LABEL=*                                                   
         SR    R2,R2               NO PFKEY AT TABLE FIRST                      
*                                                                               
STP05A00 CLI   PFKEY,17            DESTOV/MAINT?                                
         BNE   STP08A00                                                         
         CLC   ORSROUT(5),=C'EML: '   IF EMAIL ALWAYS CAN USE DESTOV            
         BE    STP05A10                                                         
         CLC   ORSEML(3),=C'EML'                                                
         BE    STP05A10                                                         
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         TM    MISCFLG4,MF4MOFAX   FAX OOW TO MO                                
         BO    STP05A10                                                         
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
         TM    MISCFLG3,MF3PRVCF   PREV CONFIRMED?                              
         BNZ   NODESTOV            YES, ERROR!                                  
STP05A10 MVC   OLDSPER(L'ORSORD),SVQCORDR   PASS ORD# TO DESTOV/MAINT           
         NI    ORSMEDH+4,X'FF'-X'20'  FORCE KEY CHANGE ON RETURN                
         LA    R1,PFKY17                                                        
         USING PFTABD,R1                                                        
         OI    PFTSTAT,PFTCPROG    DEFAULT TO SAVE TWA & WRKING STO             
         CLI   CALLSP,0            COME FROM SOMEWHERE?                         
         BE    STPFKS30            NO, GO AHEAD                                 
         CLI   CALLSTCK,X'E9'      YES, COME FROM ORDER LIST?                   
         BE    *+12                                                             
         CLI   CALLSTCK,X'EA'                 OR  MARKET LIST?                  
         BNE   STPFKS30                 NO, IGNORE WHERE WE CAME FROM           
         NI    PFTSTAT,X'FF'-PFTCPROG  DON'T SAVE SO RETURN TO LIST             
         B     STPFKS30            YES                                          
         DROP  R1                                                               
*                                                                               
STP08A00 CLI   PFKEY,20            COMMENT/PREVIEW?                             
         BNE   STP06A00                                                         
*                                                                               
STP08A10 MVC   OLDSPER(L'ORSORD),SVQCORDR USING  OLDSPER  SO WE CAN             
*        CLI   ORSXMIT,C'T'                  PASS TO COMMENT/PREVIEW            
*        BNE   *+10                                                             
*        MVC   OLDSPER(L'ORSORD),ORSTORD                                        
*                                                                               
         LA    R1,PFKY20                                                        
         USING PFTABD,R1                                                        
         OI    PFTSTAT,PFTCPROG    DEFAULT TO SAVE TWA & WRKING STO             
         CLI   CALLSP,0            COME FROM SOMEWHERE?                         
         BE    STPFKS30            NO, GO AHEAD                                 
         CLI   CALLSTCK,X'E9'      YES, COME FROM ORDER LIST?                   
         BE    *+12                                                             
         CLI   CALLSTCK,X'EA'                 OR  MARKET LIST?                  
         BNE   STPFKS30                 NO, IGNORE WHERE WE CAME FROM           
         NI    PFTSTAT,X'FF'-PFTCPROG  DON'T SAVE SO RETURN TO LIST             
         B     STPFKS30            YES                                          
         DROP  R1                                                               
*                                                                               
STP06A00 CLI   PFKEY,6             TRANSMIT DARE ORDER?                         
         BE    STPFINIT            YES                                          
*                                                                               
         CLI   PFKEY,5             DESTOV WHILE IN RECALL ACTION?               
         BNE   STP06A02                                                         
         CLI   ACTNUM,ACTRCALL                                                  
         BNE   STP06A02                                                         
         MVI   GERROR1,ERINVPFK                                                 
         J     ERREXIT                                                          
*                                                                               
STP06A02 TM    BITFLAG,BFRCLLNG    AUTORECALL FROM BUY PROGRAM?                 
         BZ    STP06A03            NO                                           
         CLI   ACTNUM,ACTRCALL     YES, MAKE SURE ACTION IS RECALL              
         BNE   STP06A10                 NOT, WE HAVE GARBAGE IN SYSPARE         
         B     STP06A05                                                         
*                                                                               
STP06A03 CLI   ACTNUM,ACTXMIT      TRANSMIT ACTION?                             
         BNE   STP06A10                                                         
         CLI   PFKEY,7             BROWSE?                                      
         BE    STPFINIT            YES, LET THEM BROWSE                         
STP06A05 MVI   PFKEY,6             YES, MAKE IT LOOK LIKE A TRANSMIT            
         B     STPFINIT                                                         
*                                                                               
STP06A10 CLI   PFKEY,11            DISPLAY REP COMMENTS?                        
         BE    STPFINIT            YES                                          
*                                                                               
STPFKS10 CLI   PFKEY,10            LIST THE STANDARD COMMENTS?                  
         BNE   STPFKS20                                                         
         TM    BITFLAG2,BF2STAMS   STATION ERROR MESSAGE MODE?                  
         BNZ   STPFINIT                                                         
         TM    BITFLAG,BFSTDCOM    YES, ALREADY LISTED?                         
         BNZ   STPFINIT                                                         
         OI    BITFLAG,BFSHWSCR+BFSTDCOM  NO, SET BITS TO LIST STANDARD         
         B     STPFINIT                       COMMENTS                          
*                                                                               
STPFKS20 CLI   PFKEY,12            RETURN FROM STANDARD COMMENTS LIST?          
         BNE   STPFKS30                                                         
         TM    BITFLAG,BFSTDCOM    YES                                          
         BNZ   STPFINIT                                                         
         TM    BITFLAG2,BF2STAMS   STATION ERROR MESSAGE MODE?                  
         BNZ   STPFINIT                                                         
*                                                                               
STPFKS30 LA    R2,SPFTABLE         USE PREDEFINED PFKEYS                        
*                                                                               
STPFINIT GOTO1 INITIAL,DMCB,(R2)   INITIALIZE THE PFKEYS                        
***************                                                                 
* SETUP THE PFKEY LINE                                                          
***************                                                                 
STPFL00  TM    BITFLAG,BFSTDCOM    YES, STILL IN STANDARD COMMENTS?             
         BNZ   STPFX                    YES                                     
         TM    MISCFLG3,MF3NOFST   IS IT THE FIRST TIME THROUGH?                
         BNZ   STPFX                                                            
*                                                                               
         TM    BITFLAG2,BF2STAMS   STILL IN STATION ERROR MESSAGE?              
         BNZ   STPFX                                                            
*                                                                               
         NI    BITFLAG2,X'FF'-BF2SHOWR                                          
*                                                                               
         MVC   ORSPFLN,SPACES                                                   
         CLI   ORSMED,C'R'         MEDIA = R?                                   
         BNE   SETPFL05            NOPE                                         
         MVC   ORSPFLN(PFTEXTLQ),PFTEXT                                         
         B     SETPFL10                                                         
SETPFL05 MVC   ORSPFLN(PFTXT2LQ),PFTEXT2                                        
*                                                                               
SETPFL10 CLI   CALLSP,0            ANYTHING TO RETURN TO?                       
         BE    SETPFL15            NO                                           
         LA    R3,ORSPFLN+64                                                    
         CLI   ORSMED,C'R'         MEDIA = R?                                   
         BNE   SETPFL12            NOPE                                         
         LA    R3,ORSPFLN+70                                                    
SETPFL12 MVC   0(7,R3),=C'12=Rtrn'                                              
*                                                                               
SETPFL15 CLI   ACTNUM,ACTRCALL     YES, MAKE SURE ACTION IS RECALL              
         BNE   STPFL20                                                          
         MVC   WORK(L'ORSPFLN),ORSPFLN                                          
         XC    ORSPFLN,ORSPFLN                                                  
         MVC   ORSPFLN(2),WORK                                                  
         MVC   ORSPFLN+2(67),WORK+11                                            
*                                                                               
STPFL20  OI    ORSPFLNH+6,X'80'                                                 
*                                                                               
STPFX    B     XIT                                                              
PFTEXT   DC    C'PF5=Destov 6=Transmit 7=Brw 8=Cmntprv 9=Mis 10=Std CmnX        
               ts 11=Rep Cmnts'                                                 
PFTEXTLQ EQU   *-PFTEXT                                                         
*                                                                               
PFTEXT2  DC    C'PF5=Destov 6=Transmit 8=Cmntprv 9=Mis 10=Std Cmnts 11=X        
               Rep Cmnts'                                                       
PFTXT2LQ EQU   *-PFTEXT2                                                        
         LTORG                                                                  
***********************************************************************         
* PFKEY TABLE DEFINITIONS                                                       
***********************************************************************         
SPFTABLE  DS    0C                                                              
*                                                                               
* DESTOV - RETURN TO CALLER                                                     
         DC    AL1(SPF05X-*,5,0,0,0,PFTRETRN)                                   
         DC    CL3' ',CL8' ',CL8' '                                             
SPF05X   EQU   *                                                                
*                                                                               
* BROWSE                                                                        
         DC    AL1(PF07X-*,7,0,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8' ',CL8' '                                             
PF07X    EQU   *                                                                
*                                                                               
* COMMENT PREVIEW -RETURN TO CALLER                                             
         DC    AL1(SPF08X-*,8,0,0,0,PFTRETRN)                                   
         DC    CL3' ',CL8' ',CL8' '                                             
SPF08X   EQU   *                                                                
*                                                                               
* MIS                                                                           
         DC    AL1(PF09X-*,9,0,0,0,PFTRETRN)                                    
         DC    CL3' ',CL8' ',CL8' '                                             
PF09X    EQU   *                                                                
*                                                                               
* RETURN TO CALLER                                                              
         DC    AL1(SPF12X-*,12,PFTRPROG,0,0,0)                                  
         DC    CL3' ',CL8' ',CL8' '                                             
SPF12X   EQU   *                                                                
*                                                                               
* DESTOV                                                                        
PFKY17   DC    AL1(SPF17X-*,17,PFTCPROG,0,(SPF17X-SPF17)/KEYLNQ,0)              
         DC    CL3' ',CL8'DESTOV',CL8'MAINT'                                    
SPF17    DC    AL1(KEYTYTWA,L'ORSMED-1),AL2(ORSMED-T234FFD)                     
         DC    AL1(KEYTYTWA,L'ORSBUYR-1),AL2(ORSBUYR-T234FFD)                   
         DC    AL1(KEYTYTWA,L'ORSSTA-1),AL2(ORSSTA-T234FFD)                     
         DC    AL1(KEYTYTWA,L'ORSCLT-1),AL2(ORSCLT-T234FFD)                     
         DC    AL1(KEYTYWS,L'ORSORD-1),AL2(OLDSPER-MYAREAD)                     
         DC    AL1(KEYTYTWA,L'ORSDEST-1),AL2(ORSDEST-T234FFD)                   
SPF17X   EQU   *                                                                
*                                                                               
* COMMENT PREVIEW                                                               
PFKY20   DC    AL1(SPF20X-*,20,PFTCPROG,0,(SPF20X-SPF20)/KEYLNQ,0)              
         DC    CL3' ',CL8'COMMENT',CL8'PREVIEW'                                 
SPF20    DC    AL1(KEYTYTWA,L'ORSMED-1),AL2(ORSMED-T234FFD)                     
         DC    AL1(KEYTYWS,L'ORSORD-1),AL2(OLDSPER-MYAREAD)                     
SPF20X   EQU   *                                                                
*                                                                               
         DC    X'FF'                                                            
         EJECT                                                                  
***********************************************************************         
* CHECK MEDIA OCEAN REP TABLE                                                   
*                                                                               
* ON ENTRY: PARAM1   A(ORIGIN ID IN EDICT HEADER)                               
*           PARAM2   A(ORDER # IN EDICT HEADER)                                 
*                                                                               
* ON EXIT : CC       EQ = UPDATED ORIGIN ID!!                                   
*                                                                               
***********************************************************************         
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 09/23/02                 
CHKMOREP NTR1  BASE=*,LABEL=*                                                   
         L     R2,0(R1)            A(ORIGIN ID)                                 
         L     R3,4(R1)            A(ORDER #)                                   
*                                                                               
         BAS   RE,CLCORDDT         CALCULATE ORDRDATE FROM BINORDER             
*                                                                               
         L     R1,AMOREPTB                                                      
MEDOA10  CLI   0(R1),X'FF'         EOT?                                         
         BE    GTDI010             YES                                          
         LLC   R4,1(R1)            LENGTH OF REP ENTRY                          
         BCTR  R4,0                MINUS 1 FOR EX!                              
         EX    R4,*+8              MATCH ON REP?                                
         BE    MEDOA15             YES, CHECK OFFICE                            
         CLC   2(0,R1),0(R2)                                                    
         ZIC   R4,0(R1)            NO, BUMP TO NEXT REP                         
         AR    R1,R4                                                            
         B     MEDOA10                                                          
*                                                                               
***  POINT TO OFFICE FOR COMPARE                                                
MEDOA15  LLC   R4,1(R1)                                                         
         LA    R6,0(R2)                                                         
         LA    R6,0(R4,R6)         R6=A(OFFICE CODE IN EDICT)                   
         LA    R1,2(R4,R1)         R1=A(OFFICE CODE IN TABLE)                   
*                                                                               
MEDOA20  CLI   0(R1),0             END OF REP/OFFICE LIST?                      
         BE    MEDOANO             DO NOTHING                                   
         CLC   0(2,R1),0(R6)       MATCH ON OFFICE?                             
         BE    MEDOA25             YES                                          
         LA    R1,5(R1)            NO, BUMP TO NEXT OFFICE IN TABLE             
         B     MEDOA20                                                          
*                                                                               
MEDOA25  CLC   ORDRDATE,2(R1)      ON/AFTER THE CUTOFF DATE?                    
         BNL   MEDOANO             YES, NO CHANGE TO THE RECEIVING ID           
         MVC   2(3,R6),=C'-DS'     MOVE IT IN                                   
         B     MEDOAYES                                                         
****                                                                            
****                                                                            
****                                                                            
****                                                                            
****                                                                            
***********************************                                             
* WIDE ORBIT:  REP-DATE   or  LOCAL STATION-DATE                                
***********************************                                             
GTDI010  L     R1,AWORPDTB                                                      
GTDI020  CLI   0(R1),X'FF'         EOT?                                         
         BE    MEDOA30             YES                                          
         LLC   R4,3(R1)            L(REP/STATION) ENTRY                         
         BCTR  R4,0                MINUS 1 FOR EX!                              
         EX    R4,*+8              MATCH ON REP/STATION                         
         BE    GTDI023             YES, CHECK DATE                              
         CLC   4(0,R1),0(R2)                                                    
         LLC   R4,3(R1)            NO, BUMP TO NEXT REP                         
         LA    R1,4(R1,R4)                                                      
         B     GTDI020                                                          
*                                                                               
***  POINT TO DATE FOR COMPARE                                                  
GTDI023  LLC   R4,3(R1)                                                         
         LA    R6,0(R2)                                                         
         CLC   =C'NBC',0(R2)       IS IT A REP?                                 
         BE    GTDI026                                                          
         CLC   =C'MON',0(R2)                                                    
         BNE   *+12                                                             
GTDI026  LA    R6,2(R4,R6)         R6=A(AFTER OFFICE CODE IN EDICT)             
         B     GTDI028                                                          
*                                                                               
         BCTR  R4,0                TO ACCOUNT FOR SPACE IN ENTRY                
         LA    R6,0(R4,R6)         R6=A(AFTER LOCAL STATION IN EDICT)           
*                                                                               
GTDI028  CLC   ORDRDATE,0(R1)      ON/AFTER THE CUTOFF DATE?                    
         BL    MEDOANO             NO, NO CHANGE TO THE RECEIVING ID            
         MVC   0(3,R6),=C'-WO'     GOES TO WIDEORBIT                            
         B     MEDOAYES                                                         
****                                                                            
****                                                                            
****                                                                            
****                                                                            
****                                                                            
***********************************                                             
* REP-OFFICE-DATE                                                               
*                                                                               
* WE HAVE OTHER REP-OFFICE THAT ARE GOING TO MEDIAOCEAN BY DATE                 
* **NOTE**                                                                      
* IF WE MATCH ON REP-OFFICE BUT NOT DATE, ORDER STAYS ON REPPAK                 
***********************************                                             
MEDOA30  L     R1,AMORODTB                                                      
MEDOA35  CLI   0(R1),X'FF'         EOT?                                         
         BE    MEDOA50             YES                                          
         LLC   R4,3(R1)            L(REP-OFFICE) ENTRY                          
         BCTR  R4,0                MINUS 1 FOR EX!                              
         EX    R4,*+8              MATCH ON REP-OFFICE?                         
         BE    MEDOA40             YES, CHECK DATE                              
         CLC   4(0,R1),0(R2)                                                    
         LLC   R4,3(R1)            NO, BUMP TO NEXT REP                         
         LA    R1,4(R1,R4)                                                      
         B     MEDOA35                                                          
*                                                                               
***  POINT TO DATE FOR COMPARE                                                  
MEDOA40  LLC   R4,3(R1)                                                         
         LA    R6,0(R2)                                                         
         LA    R6,0(R4,R6)         R6=A(AFTER OFFICE CODE IN EDICT)             
*                                                                               
         CLC   ORDRDATE,0(R1)      ON/AFTER THE CUTOFF DATE?                    
         BNL   MEDOANO             NO, NO CHANGE TO THE RECEIVING ID            
MEDOA45  MVC   0(3,R6),=C'-MO'     GOES TO MEDIAOCEAN                           
         B     MEDOAYES                                                         
***********************************                                             
* REP-OFFICE-STATION-DATE                                                       
*                                                                               
* WE HAVE OTHER REP-OFFICE THAT ARE GOING TO MEDIAOCEAN BY STATION/DATE         
* **NOTE**                                                                      
* IF WE MATCH ON REP-OFFICE BUT NOT STATION/DATE, ORDER STAYS ON REPPAK         
***********************************                                             
MEDOA50  L     R1,AMOOFTAB                                                      
MEDOA60  CLI   0(R1),X'FF'         EOT?                                         
         BE    MEDOANO             YES                                          
         LLC   R4,2(R1)            L(REP-OFFICE) ENTRY                          
         BCTR  R4,0                MINUS 1 FOR EX!                              
         EX    R4,*+8              MATCH ON REP-OFFICE?                         
         BE    MEDOA70             YES, CHECK STATION AND DATE                  
         CLC   3(0,R1),0(R2)                                                    
         XR    R4,R4               NO, BUMP TO NEXT REP                         
         ICM   R4,3,0(R1)                                                       
         AR    R1,R4                                                            
         B     MEDOA60                                                          
*                                                                               
***  POINT TO STATION/DATE FOR COMPARE                                          
MEDOA70  LLC   R4,2(R1)                                                         
         LA    R6,0(R2)                                                         
         LA    R6,0(R4,R6)         R6=A(AFTER OFFICE CODE IN EDICT)             
         LA    R1,3(R4,R1)         R1=A(OFFICE CODE IN TABLE)                   
*                                                                               
MEDOA80  CLI   0(R1),0             END OF STATION/DATE LIST?                    
         BE    MEDOANO             THEN STAYS ON REPPAK                         
*                                                                               
         CLC   QSTA,0(R1)          MATCHES THIS STATION?                        
         BE    MEDOA90                                                          
MEDOA85  LA    R1,14(R1)           NO, NEXT STATION/DATE FOR REP-OFFICE         
         B     MEDOA80                                                          
*                                                                               
MEDOA90  OC    5(3,R1),5(R1)       WAS THE STATION ALREADY CONVERTED?           
         BZ    MEDOA95             YES, AUTOMATICALLY GO TO MEDIAOCEAN          
         CLC   ORDRDATE,5(R1)      ON/AFTER THE CUTOFF DATE?                    
         BL    MEDOANO             NO, NO CHANGE TO THE RECEIVING ID            
*                                                                               
         OC    8(3,R1),8(R1)       ANY END DATE?                                
         BZ    MEDOA95             NONE, GOES TO MEDIAOCEAN                     
         CLC   ORDRDATE,8(R1)      ON/AFTER THE END DATE (REPPAK)?              
         BL    MEDOA95             NO, STAYS ON MEDIAOCEAN                      
*                                                                               
         CLC   0(3,R3),11(R1)      ON/AFTER NEW START DATE (-MO AGAIN)?         
         BL    MEDOANO             NO, NO CHANGE TO THE RECEIVING ID            
MEDOA95  MVC   0(3,R6),=C'-MO'     STAYS ON REPPAK                              
*                                                                               
MEDOAYES B     YES                                                              
*                                                                               
MEDOANO  B     NO                                                               
***********************************************************************         
* CALCULATE ORDRDATE PWOS JULIAN DATE                                           
*  ON ENTRY :  ORDER RECORD IN AIO3                                             
*                                                                               
*   ON EXIT :  ORDRDATE IS THE ORDER CREATION DATE IN PWOS JULIAN               
***********************************************************************         
CLCORDDT NTR1                                                                   
         TM    BINORDER,X'80'      NEW STYLE ORDER NUMBER?                      
         BNZ   CLCOD20             NO, REMEMBER, BINORDER IS FF'D               
*                                                                               
         L     R1,AIO              YES                                          
         CLC   0(2,R1),=X'0D34'                                                 
         BNE   CLCODDIE                                                         
         USING DOKEY,R1                                                         
         LA    R1,DORFRST                                                       
CLCOD10  CLI   0(R1),0                                                          
         BE    CLCODDIE                                                         
         CLI   0(R1),DOSPELQ       X'03' - SUPP ELEM?                           
         BE    CLCOD15                                                          
         LLC   R0,1(R1)                                                         
         AR    R1,R0                                                            
         B     CLCOD10                                                          
*                                                                               
         USING DOSPELD,R1                                                       
CLCOD15  MVC   ORDRDATE,DOSPCDAT                                                
         J     MEDOAYES                                                         
         DROP  R1                                                               
*                                                                               
CLCODDIE DC    H'0'                                                             
*                                                                               
CLCOD20  MVC   HALF,BINORDDT       THE 1ST 2 BYTES OF ORDER #                   
         XC    HALF,=X'FFFF'                                                    
         SR    R1,R1                                                            
         ICM   R1,3,HALF           CONTAINS THE DATE OF CREATION                
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         MVC   HALF,DUB+6          SAVE OFF THE DDDF                            
         SRP   DUB,64-3,0          ISOLATE # OF YEARS FROM 1990                 
         AP    DUB,=P'90'           AS ORDER #'S BASED OFF 1990                 
         SRP   DUB,3,0                                                          
         MVC   DUB+6(2),HALF       PUT BACK  DDDF TO GET A FULL DATE            
         SRP   DUB,1,0                                                          
         MVC   ORDRDATE,DUB+4      WE NOW HAVE PWOS JULIAN                      
         J     MEDOAYES                                                         
         LTORG                                                                  
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
***********************************************************************         
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*                                                                               
* ON EXIT : CC       EQ  - MUST GO FAX                                          
*                                                                               
***********************************************************************         
CHKMOSTA NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         NI    MISCFLG4,X'FF'-MF4MOFAX                                          
         MVC   WORK(L'ORSSTA),ORSSTA                                            
         OC    WORK(L'ORSSTA),SPACES                                            
*                                                                               
         L     R4,AMOSTATB                                                      
CKMOS05  CLI   0(R4),X'FF'         END OF TABLE?                                
         BE    CKMOSX              YES                                          
*                                                                               
CKMOS10  ZIC   R1,0(R4)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         CLC   1(0,R4),WORK        MATCH ON STATION?                            
         BE    CKMOS20             YES                                          
         LA    R4,L'MOSTATAB(R4)   NO, BUMP TO NEXT ENTRY                       
         B     CKMOS05                                                          
*                                                                               
CKMOS20  CLI   SVOOWROT,1          IS IT AN OOW ESTIMATE?                       
         BE    CKMOSX              NO                                           
         OI    MISCFLG4,MF4MOFAX   YES, MUST GO FAX!!!                          
*                                                                               
CKMOSX   J     XIT                                                              
         LTORG                                                                  
*&&                                                                             
***********************************************************************         
* DISPLAYS THE ORDER NUMBER                                                     
*                                                                               
* ON ENTRY:    (R2)                A(SCREEN FIELD HEADER)                       
*              BINORDER            ORDER NUMBER AS STORED IN RECORD             
***********************************************************************         
SHWORDER NTR1  BASE=*,LABEL=*                                                   
         MVC   FULL,BINORDER       SHOW THE ORDER NUMBER                        
         XC    FULL,=4X'FF'                                                     
         TM    FULL,X'80'          NEW ORDER # STYLE?                           
         BNZ   SORD20                                                           
*                                                                               
         L     R1,FULL                                                          
         AHI   R1,1                                                             
         ZICM  R1,FULL,2                                                        
         CVD   R1,DUB                                                           
         UNPK  8(4,R2),DUB                                                      
         OI    8+3(R2),X'F0'                                                    
*                                                                               
         ZICM  R3,FULL+2,2                                                      
         CVD   R3,DUB                                                           
         UNPK  12(4,R2),DUB                                                     
         OI    12+3(R2),X'F0'      SEQUENCE NUMBER                              
         B     SORDX                                                            
*                                                                               
SORD20   NI    FULL,X'FF'-X'80'                                                 
         ICM   R1,15,FULL                                                       
         CVD   R1,DUB                                                           
         AP    DUB,=P'04000000'                                                 
         OI    DUB+7,X'0F'                                                      
         UNPK  8(8,R2),DUB                                                      
*                                                                               
SORDX    OI    6(R2),X'80'                                                      
         B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* VALIDATE THE RECORD ON SCREEN (PFKEY TO MIS PROGRAM)                *         
***********************************************************************         
PFMIS    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
*MEDIA                                                                          
         GOTO1 VGLOBBER,DMCB,=C'PUTF',ORSMEDH,,GLVSPMD                          
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC            CAN'T SWITCH TO BUY PROGRAM                  
* CLIENT                                                                        
         GOTO1 VGLOBBER,DMCB,=C'PUTF',ORSCLTH,,GLVSPCLT                         
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
* PRODUCT                                                                       
         GOTO1 VGLOBBER,DMCB,=C'PUTF',ORSPRDH,,GLVSPPRD                         
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
* ESTIMATE                                                                      
         MVC   ESTMIS,ORSEST                                                    
         LA    R1,3                                                             
         LA    R2,ESTMIS                                                        
*                                                                               
PFMIS01  CLI   0(R2),C'-'          ESTIMATE/FLIGHT?                             
         BNE   PFMIS02             NO                                           
         BCTR  R1,0                YES...CLEAR IT AND EVERYTHING AFTER          
         EX    R1,*+8                                                           
         B     *+10                                                             
         XC    0(0,R2),0(R2)                                                    
         AHI   R1,1                                                             
PFMIS02  LA    R2,1(R2)                                                         
         BCT   R1,PFMIS01                                                       
*                                                                               
         CLI   ESTMIS+2,X'40'      ENTERED 2 DIGITS FOR EST?                    
         BH    PFMIS05             NO...HAVE 3 DIGITS                           
         CLI   ESTMIS+1,X'40'      ENTERED 1 DIGIT FOR EST?                     
         BH    PFMIS04             NO...HAVE 2 DIGITS                           
*                                                                               
         MVC   ESTMIS+2(1),ESTMIS  ONLY 1 DIGIT...MOVE TO 3RD POSITION          
         MVC   ESTMIS(2),ZEROS     2 LEADING ZEROS                              
         B     PFMIS05                                                          
*                                                                               
PFMIS04  MVC   ESTMIS+2(1),ESTMIS+1                                             
         MVC   ESTMIS+1(1),ESTMIS                                               
         MVI   ESTMIS,C'0'         LEADING ZERO                                 
PFMIS05  GOTO1 VGLOBBER,DMCB,=C'PUTD',ESTMIS,L'ESTMIS,GLVSPEST                  
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
* MARKET                                                                        
         GOTO1 VGLOBBER,DMCB,=C'PUTD',MKTMIS,L'MKTMIS,GLVSPMKT                  
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
* STATION                                                                       
         GOTO1 VGLOBBER,DMCB,=C'PUTF',ORSSTAH,,GLVSPSTA                         
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
*                                                                               
         BRAS  RE,PFSWITCH         SWITCH TO MIS PROGRAM                        
PFMISX   J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* VALIDATE THE RECORD ON SCREEN (PFKEY TO BROWSE PROGRAM)             *         
***********************************************************************         
PFBRW    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         BRAS  RE,CHKPNDNG                                                      
         JE    PNDNGORD            CAN NOT CHANGE, PENDING ORDER                
*                                                                               
         LA    R2,ORSSALEH         SALESPERSON                                  
         CLI   ORSMED,C'R'         MEDIA = R?                                   
         JNE   ERRBROW             NO, ERROR                                    
         CLI   ORSSALE,C'='        DID WE PUT IN '=' MANUALLY?                  
         BE    PFBRW05             YES                                          
         XC    ORSSALE,ORSSALE     CLEAR SALESPERSON FOR NOW                    
         MVI   ORSSALE,C'='        ACT AS IF WE PUT IT IN MANUALLY              
         MVI   ORSSALEH+5,1        ACT AS IF WE PUT IT IN MANUALLY              
         OI    ORSSALEH+6,X'80'    TRANSMIT                                     
         NI    ORSSALEH+4,X'FF'-X'20'  VALIDATED NEXT TIME                      
         J     XIT                                                              
*                                                                               
PFBRW05  CLC   =C'REP',ORSDEST     DESTINATION REP?                             
         JNE   NOTREP              NO, CANT SEL SALESPERSON VIA BROWSE          
         CLC   =C'FAX:',ORSROUT    ROUTE = FAX?                                 
         JE    ERRROUTE            YES, ERROR                                   
         CLC   =C'EML:',ORSROUT    ROUTE = EMAIL?                               
         JE    ERRROUTE            YES, ERROR                                   
***                                                                             
* READ CTFILE FOR ID RECORDS                                                    
***                                                                             
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING CTIREC,R6                                                        
         MVI   CTIKTYP,CTIKTYPQ    C'I'                                         
         MVC   CTIKID,ORSROUT      REP NAME                                     
         OC    CTIKID,SPACES       SPACE PADDED                                 
         MVC   KEYSAVE,KEY                                                      
*                                                                               
         GOTO1 DATAMGR,DMCB,=CL8'DMRDHI',=C'CTFILE',KEY,AIO3,(0,DMWORK)         
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R6,AIO3             CTFILE ID REC                                
         CLC   KEY(CTIKNUM-CTIKEY),0(R6)                                        
         JNE   NOIDREC             NO ID RECORD                                 
*                                                                               
         MVC   DATADISP,=H'28'     CHANGE DATADISP FOR GETEL                    
         MVI   ELCODE,CTAGYELQ     X'06'                                        
         BRAS  RE,GETEL                                                         
         MVC   DATADISP,=H'24'     RESTORE DATADISP                             
         JNE   NOIDREC2            NO ID RECORD                                 
         USING CTAGYD,R6                                                        
***                                                                             
* CREATE BROWSE ELEMENT FOR GLOBBER                                             
***                                                                             
         XC    BLOCK(GLBRWLNQ),BLOCK                                            
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3                                                       
         MVC   GLBRWKW(9),ORSSALE+1   KEYWORD FOR BROWSE                        
         MVC   GLBRWREC,=C'SAL'                                                 
*                                                                               
         LA    R2,ORSCONTH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R2,ORSTCONH                                                      
         CLC   8(L'ORSCONT,R2),ZEROS                                            
         BNH   PFBRW30                 NO                                       
         MVC   GLBRWREC,=C'LSP'                                                 
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON                  
         BNE   PFBRW45                                                          
         MVC   GLBRWREC,=C'LPP'                                                 
         B     PFBRW45                                                          
*                                                                               
PFBRW30  CLI   BRWPREF,0                                                        
         BE    PFBRW45                                                          
         MVC   GLBRWREC,=C'BSP'                                                 
         CLI   BRWPREF,C'P'                                                     
         BNE   PFBRW45                                                          
         MVC   GLBRWREC,=C'BPP'                                                 
*                                                                               
PFBRW45  MVC   GLBRWADV(2),CTAGYID    2-BYTE AGENCY ID                          
         MVC   GLBRWADV+2(2),DARROUTE+3      OFFICE CODE                        
         TM    MISCFLG3,MF3NOOFF                                                
         BNZ   PFBRW50                                                          
         BRAS  RE,GTREPOFF                                                      
         MVC   GLBRWADV+2(2),SVREPOFF                                           
*                                                                               
PFBRW50  GOTO1 VGLOBBER,DMCB,=C'PUTD',BLOCK,GLBRWLNQ,GLRBRWSE                   
         CLI   8(R1),0                                                          
         JNE   CANTSWTC                                                         
*                                                                               
         OI    PFKFLAG,PFKBRW                                                   
         BAS   RE,PFSWITCH         SWITCH TO BROWSE PROGRAM                     
PFBRWX   J     XIT                                                              
         DROP  R3,R6                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SWITCH TO MIS OR BROWSE DEPENDING ON THE PFKEY                      *         
***********************************************************************         
PFSWITCH NTR1  BASE=*,LABEL=*                                                   
         XC    BLOCK(12),BLOCK                                                  
         LA    R1,BLOCK                                                         
         MVC   0(6,R1),=C'SPODAR'  FROM THE SPOT SYSTEM                         
         OI    6(R1),X'80'         HEADLINE CHANGE IN DARE                      
         GOTO1 VGLOBBER,DMCB,=C'PUTD',BLOCK,12,GLVNOTE                          
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
*                                                                               
         XC    BLOCK(14),BLOCK                                                  
         LA    R1,BLOCK                                                         
         USING GLVXFRSY,R1                                                      
         MVC   GLVXFRSY,=C'SPO'    FROM THE SPOT SYSTEM                         
         MVC   GLVXFRPR,=C'DAR'    DARE PROGRAM                                 
         MVC   GLVXTOSY,=C'SPO'    TO THE SPOT SYSTEM                           
         MVC   GLVXTOPR,=C'MIS'    MIS PROGRAM                                  
         OI    GLVXFLG1,GLV1SEPS   CALL BASE ON TRANSFER                        
*                                                                               
         CLI   PFKEY,9             MIS PROGRAM?                                 
         BE    PFS10               YES                                          
         MVC   GLVXTOPR,=C'BRO'    NO, BROWSE PROGRAM                           
         DROP  R1                                                               
*                                                                               
PFS10    GOTO1 VGLOBBER,DMCB,=C'PUTD',BLOCK,14,GLVXCTL                          
         CLI   DMCB+8,0                                                         
         JNE   CANTSWTC                                                         
*                                                                               
         MVC   CONHEAD(23),=CL23'** BACK TO SPOT/DARE **'                       
         OI    CONHEADH+6,X'80'                                                 
*                                                                               
         SR    R0,R0                                                            
         LA    R1,ORSPFLNH                                                      
*                                                                               
PFS20    ICM   R0,1,0(R1)                                                       
         BZ    PFS30                                                            
         AR    R1,R0                                                            
         B     PFS20                                                            
*                                                                               
PFS30    MVC   1(2,R1),=X'0101'    RETRANSMIT SCREEN                            
*                                                                               
PFS      J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET CC TO EQUAL IF WE A SALESPERSON WAS SELECTED FROM BROWSE        *         
***********************************************************************         
GLOBSALE NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    BLOCK(GLBRWLNQ),BLOCK                                            
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3          LOOK FOR GLOBBER BROWSE ELEM                 
*                                                                               
         GOTO1 VGLOBBER,DMCB,=C'GETD',(R3),GLBRWLNQ,GLRBRWSE                    
         CLI   8(R1),0             GLOBBER ERRORS?                              
         JNE   NO                  YES, DON'T HAVE SALESPERSON                  
         OC    GLBRWKW,GLBRWKW     SALESPERSON FIELD BLANK?                     
         JZ    NO                  YES, ERROR RETURN CC NOT EQUAL               
         J     YES                                                              
         DROP  R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* UPDATE SALESPERSON IN BATCH REC (FROM =BRW GLOBBER) AND ORD REC FLAG*         
***********************************************************************         
UPDSALES NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3                                                       
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY              FIND THE APPR DARE BATCH RECORD              
         USING DBTKEY,R6                                                        
         MVI   DBTKTYP,DBTKTYPQ                                                 
         MVI   DBTKSTYP,DBTKSTYQ                                                
         MVC   DBTKAGMD,BAGYMD                                                  
         MVC   DBTKCLT,BCLT                                                     
         MVC   DBTKPRD,SVBPRD                                                   
         MVC   DBTKEST,SVBEST                                                   
         MVC   DBTKMKT,BMKT                                                     
         MVC   DBTKSTA,BSTA                                                     
         MVC   DBTKPRD2,SVBPR2                                                  
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DBTKEY),KEYSAVE                                            
         BNE   UPDX                                                             
*                                                                               
         MVC   AIO,AIO3                                                         
         MVI   RDUPDATE,C'Y'              UPDATE SALESPER IN DR BATCH           
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         USING DBSLPELD,R6                                                      
         MVI   ELCODE,DBSLPELQ            GET SALESPERSON ELEMENT               
         BRAS  RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
UPD01    BRAS  RE,NEXTEL                                                        
         BNE   UPD10                      MAKE SURE SAME FLIGHT #               
*                                                                               
         CLC   DBSLPFLT,SVBFLT            MATCH FLIGHT                          
         BNE   UPD01                                                            
         TM    MISCFLG1,MF1DRTRD      DOING TRADE ORDER NOW?                    
         BZ    UPD04                                                            
         TM    DBSALFL1,DBSTRADE                                                
         BO    UPD05                                                            
         B     UPD01                                                            
UPD04    TM    DBSALFL1,DBSTRADE                                                
         BO    UPD01                                                            
*                                                                               
UPD05    XC    DBSALESP,DBSALESP                                                
         CLC   8(25,R2),SPACES            ANYTHING ON THE SCREEN?               
         BNH   UPD06                      NO                                    
         MVC   DBSALESP,8(R2)             CLOBBER WITH NEW SALESPERSON          
         OC    DBSALESP,SPACES            SPACE PAD IT                          
UPD06    NI    DBSALFL1,X'FF'-DBSALPT     TURN OFF POINTPERSON                  
         TM    GLBRWFLG,X'80'             POINTPERSON VIA GLOBBER?              
         BZ    *+8                        NO                                    
         OI    DBSALFL1,DBSALPT           YES, SET POINTPERSON FLAG             
         B     UPD20                                                            
         DROP  R6                                                               
UPD10    XC    ELEM,ELEM                                                        
         LA    R1,ELEM                                                          
         USING DBSLPELD,R1                                                      
         MVI   DBSLPEL,DBSLPELQ                                                 
         MVI   DBSLPLEN,DBSLPLNQ                                                
         MVC   DBSLPFLT,SVBFLT            FLIGHT                                
         CLC   8(25,R2),SPACES            ANYTHING ON THE SCREEN?               
         BNH   UPD15                      NO                                    
         MVC   DBSALESP,8(R2)             SALESPERSON                           
         OC    DBSALESP,SPACES            SPACE PAD IT                          
*                                                                               
UPD15    TM    MISCFLG1,MF1DRTRD          UPDATE TRADE ORDER?                   
         BZ    *+8                                                              
         OI    DBSALFL1,DBSTRADE                                                
         NI    DBSALFL1,X'FF'-DBSALPT     TURN OFF POINTPERSON                  
         TM    GLBRWFLG,X'80'             POINTPERSON VIA GLOBBER?              
         BZ    *+8                        NO                                    
         OI    DBSALFL1,DBSALPT           YES, SET POINTPERSON FLAG             
         DROP  R1,R3                                                            
         GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)  ADD NEW ELEMENT                 
UPD20    BRAS  RE,MYPUTREC                                                      
         MVC   AIO,AIO1                                                         
*                                                                               
UPDX     J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* UPDATE POINTPERSON FLAG IN ORDER REC                                          
***********************************************************************         
ORDPFLAG NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ      SUPPLEMENTARY ID ELEMENT                     
         BAS   RE,GETEL            SHOULD HAVE HAD IT ON THE ADD                
         BE    ORD20               OTHERWISE THIS IS AN ADD                     
*                                                                               
ORD10    LA    R6,DOSPELEM         MODIFY DOSPELEM, WILL BE ADDED               
         USING DOSPELD,R6                                                       
ORD20    NI    DOSPFLG1,X'FF'-DOSPPPER                                          
*****    TM    PFKFLAG,PFKPPER     HAVE A POINTPERSON?                          
*****    BZ    ORDX                NO                                           
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         BNE   ORDX                NO                                           
         OI    DOSPFLG1,DOSPPPER   POINTPERSON                                  
*                                                                               
ORDX     J     XIT                                                              
         LTORG                                                                  
         DROP  R6                                                               
***********************************************************************         
* ROUTINE TO CHECK WHETHER THIS IS A POINTPERSON OR NOT               *         
***********************************************************************         
ISPPER   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ      SUPPLEMENTARY ID ELEMENT                     
         BRAS  RE,GETEL            SHOULD HAVE HAD IT ON THE ADD                
         BNE   ISP01               OTHERWISE THIS IS AN ADD                     
         USING DOSPELD,R6                                                       
         TM    DOSPFLG1,DOSPPPER   POINTPERSON?                                 
         JNZ   YES                 YES                                          
         DROP  R6                                                               
*                                                                               
ISP01    LA    R6,DOSPELEM                                                      
         USING DOSPELD,R6                                                       
         TM    DOSPFLG1,DOSPPPER   POINTPERSON?                                 
         JNZ   YES                 YES                                          
         J     NO                                                               
         DROP  R6                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO UPDATE A LAST METHOD RECORD                              *         
***********************************************************************         
UPDLMREC NTR1  BASE=*,LABEL=*                                                   
         CLI   PQONLY,C'Y'                                                      
         JE    XIT                                                              
*                                                                               
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3                                                       
*                                                                               
         LA    R6,KEY              LET'S SEE IF WE HAVE LSTM                    
         XC    KEY,KEY                                                          
         USING DMTHKEY,R6                                                       
         MVI   DMTHTYPE,DMTHTYPQ   X'0D3E'                                      
         MVI   DMTHSBTY,DMTHSBTQ                                                
         MVC   DMTHAGMD,BAGYMD     A/M                                          
         MVC   DMTHBYR,QBYR        BUYER                                        
         MVC   DMTHSTA,BSTA        STATION                                      
         MVC   DMTHCLT,BCLT        CLIENT                                       
*                                                                               
*~~~~~~~    temporary code to handle deleted last method records                
         OI    DMINBTS,X'08'                                                    
         MVI   RDUPDATE,C'N'                                                    
*~~~~~~~    temporary code to handle deleted last method records                
         GOTO1 HIGH                                                             
         MVC   AIO,AIO3            USE AIO3 FOR LAST METHOD                     
         CLC   KEY(13),KEYSAVE     ANY LAST METHOD BY THIS CLIENT?              
         BE    UPDLM10             YES                                          
***                                                                             
* SET CURSOR POSITION BEFORE ADDING THE LAST METHOD RECORD                      
***                                                                             
         BRAS  RE,ADDLMREC         ADD A LAST METHOD RECORD                     
         B     UPDLMX              AND EXIT                                     
***                                                                             
* BUILD A SALESPERSON ELEMENT IN ELEM                                           
***                                                                             
*~~~~~~~    temporary code to handle deleted last method records                
*UPDLM10  XC    ELEM,ELEM                                                       
UPDLM10  MVI   RDUPDATE,C'Y'       RE-READ NOW SO WE CAN UPDATE                 
         GOTO1 HIGH                                                             
*                                                                               
         TM    KEY+13,X'80'        WAS KEY DELETED?                             
         BZ    UPDLM13                                                          
         NI    KEY+13,X'FF'-X'80'                                               
         GOTO1 WRITE                                                            
*~~~~~~~    temporary code to handle deleted last method records                
UPDLM13  XC    ELEM,ELEM                                                        
         LA    R6,ELEM                                                          
         USING DMSPELD,R6                                                       
         MVI   DMSPEL,DMSPELQ      X'20'                                        
         MVI   DMSPLEN,DMSPLENQ    LENGTH                                       
         CLC   8(25,R2),SPACES     ANYTHING ON THE SCREEN?                      
         BNH   UPDLM16             NO                                           
         MVC   DMSPNAME,8(R2)      SALESPERSON NAME                             
         OC    DMSPNAME,SPACES     SPACE PADDED                                 
UPDLM16  NI    DMSPFLAG,X'FF'-DMSPPPER                                          
         TM    GLBRWFLG,X'80'      GOT A POINTPERSON VIA GLOBBER?               
         BZ    *+8                 NO                                           
         OI    DMSPFLAG,DMSPPPER   POINTPERSON                                  
*                                                                               
*~~~~~~~    temporary code to handle deleted last method records                
         OI    DMINBTS,X'08'                                                    
*~~~~~~~    temporary code to handle deleted last method records                
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
*~~~~~~~    temporary code to handle deleted last method records                
         NI    15(R6),X'FF'-X'80'                                               
*~~~~~~~    temporary code to handle deleted last method records                
         MVI   ELCODE,DMSPELQ      SALESPERSON ELEMENT                          
         BRAS  RE,GETEL            HAVE ONE?                                    
         BNE   UPDLM20             NO                                           
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6) DELETE OLD SALESPERSON           
         B     UPDLM40             AND ADD A NEW ONE                            
*                                                                               
UPDLM20  L     R6,AIO                                                           
         MVI   ELCODE,DMFXELQ      X'10'                                        
         BRAS  RE,GETEL            HAVE ONE?                                    
         BE    UPDLM30             YES                                          
*                                                                               
         L     R6,AIO              NO, PUT SALESPERSON AFTER X'01'              
         MVI   ELCODE,DMTHELQ                                                   
         BRAS  RE,GETEL                                                         
*                                                                               
UPDLM30  ZIC   R1,1(R6)            ELEM LENGTH                                  
         AR    R6,R1               INSERT SALESPERSON RECORD HERE               
UPDLM40  GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)                                  
*                                                                               
         BRAS  RE,UPDATTIM                                                      
*                                                                               
         BRAS  RE,MYPUTREC                                                      
UPDLMX   MVC   AIO,AIO1            RESTORE AIO                                  
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
         DROP  R3,R6                                                            
***********************************************************************         
* ROUTINE TO ADD A LAST METHOD RECORD                                 *         
***********************************************************************         
ADDLMREC NTR1                                                                   
*                                                                               
         LA    R3,BLOCK                                                         
         USING GLBRWKW,R3                                                       
*                                                                               
         L     R6,AIO                                                           
         XC    0(250,R6),0(R6)          SO WE DONT GET GARBAGE                  
         USING DMTHKEY,R6                                                       
         MVI   DMTHTYPE,DMTHTYPQ        X'0D3E'                                 
         MVI   DMTHSBTY,DMTHSBTQ                                                
         MVC   DMTHAGMD,BAGYMD                                                  
         MVC   DMTHBYR,QBYR                                                     
         MVC   DMTHSTA,BSTA                                                     
         MVC   DMTHCLT,BCLT                                                     
         MVC   DMTHAGY,AGENCY                                                   
         LA    R1,DMSPLENQ+DMTHLNQ+DMTHFRST-DMTHKEY+1                           
         STCM  R1,3,DMTHLEN            L(REC) W/O THE ACTVD                     
*                                                                               
         L     R6,AIO                                                           
         LA    R6,24(R6)                                                        
         USING DMTHELD,R6                                                       
         MVI   DMTHEL,DMTHELQ                                                   
         MVI   DMTHELLN,DMTHLNQ                                                 
         MVC   DMTHDEST,ORSDEST    COPY 1ST LETTER OF DEST                      
         MVI   DMTHMTHD,C'I'                                                    
*                                                                               
         CLC   =C'FAX:',ORSROUT   WAS IT FAXING?                                
         BE    *+14                                                             
         CLC   =C'NEED SPECIAL FAX#- USE PF5',ORSROUT  WAS IT FAXING?           
         BNE   *+12                                                             
         MVI   DMTHMTHD,C'F'                                                    
         B     LASTM10                                                          
*                                                                               
         CLC   =C'EML:',ORSROUT   WAS IT EMAILING?                              
         BNE   LASTM10                                                          
         MVI   DMTHMTHD,C'E'                                                    
         MVC   DMTHBDEC,ORSROUT+5  PICK OFF THE SCREEN                          
         DROP  R6                                                               
*                                                                               
LASTM10  AHI   R6,DMTHLNQ                                                       
         USING DMSPELD,R6                                                       
         MVI   DMSPEL,DMSPELQ      X'20'                                        
         MVI   DMSPLEN,DMSPLENQ    LENGTH                                       
         CLC   8(25,R2),SPACES     ANYTHING ON THE SCREEN?                      
         BNH   LASTM15             NO                                           
         MVC   DMSPNAME,8(R2)      SALESPERSON NAME                             
         OC    DMSPNAME,SPACES     SPACE PADDED                                 
LASTM15  NI    DMSPFLAG,X'FF'-DMSPPPER                                          
         TM    GLBRWFLG,X'80'      GOT A POINTPERSON VIA GLOBBER?               
         BZ    *+8                 NO                                           
         OI    DMSPFLAG,DMSPPPER   POINTPERSON                                  
*&&DO                                                                           
         AHI   R6,DMSPLENQ                                                      
         XC    0(2,R6),0(R6)       CLEAR THE END                                
*&&                                                                             
         BRAS  RE,UPDATTIM                                                      
*                                                                               
         MVI   ACTELOPT,C'Y'                                                    
         BRAS  RE,MYADDREC                                                      
         MVI   ACTELOPT,C'N'                                                    
         J     XIT                                                              
         DROP  R3,R6                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* FOR ORDER BRAND MUST HAVE SALESPERSON IF MED=R AND REP INBOX        *         
***********************************************************************         
ISBRAND  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         CLI   QMED,C'R'           RADIO?                                       
         JNE   NO                  NO                                           
*                                                                               
         CLI   ACTNUM,ACTBRNDS     ORDER/BRANDS?                                
         JNE   NO                  NO                                           
*                                                                               
         CLC   =C'FAX:',ORSROUT    FAX?                                         
         JE    NO                  YES                                          
         CLC   =C'EML:',ORSROUT    EMAIL?                                       
         JE    NO                  YES                                          
         J     YES                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECKS IF POOL ORIGINAL ELEM MATCHES OUR ORDER                                
*                                                                               
* ON ENTRY:    R6                  A(POOL ORIGINAL ELEMENT)                     
*              MISCFLG2.MF2VPRDS   ON = LOOK FOR VAR PRODUCTS                   
*                                                                               
* ON EXIT:     PR1TIMSH            PRODUCT 1 TIME SHARE                         
*              (CC)                EQ = YES                                     
*                                                                               
* NOTE:  WORK  GETS CLOBBERED                                                   
***********************************************************************         
CHKPOLEL NTR1  BASE=*,LABEL=*                                                   
         USING REGELEM,R6                                                       
         CLI   1(R6),RPALLOC-REGELEM  ANY PRODUCT ALLOCATION?                   
         BH    CPOL10                 YES                                       
***********************************                                             
* PRODUCT NOT ALLOCATED                                                         
***********************************                                             
         CLI   SVBPRD,X'FF'        POL ORDER?                                   
         BNE   CPOLNO              NO, NOTHING TO CHECK                         
*                                                                               
         CLI   SVBFLT,0            ANY FLIGHT?                                  
         BE    CPOL05              NO, WE GOT AN UNALLOCATED BUY                
*                                                                               
         GOTO1 DATCON,DMCB,(2,RDATE),(3,FULL)                                   
         CLC   FULL(3),SVFLTSDT    IN OUR FLIGHT?                               
         BL    CPOLNO                                                           
         CLC   FULL(3),SVFLTEDT                                                 
         BH    CPOLNO              NO, NOTHING TO CHECK                         
*                                                                               
CPOL05   OI    MISCFLG2,MF2UNALL   WE HAVE AN UNALLOCATED BUY                   
         B     CPOLYES                                                          
***********************************                                             
* PRODUCT ALLOCATED                                                             
***********************************                                             
CPOL10   TM    RSTATUS,RSMINUSQ+RSMINSDQ  IGNORE THESE -OTO                     
         BNZ   CPOLNO                                                           
*                                                                               
         ZIC   R0,1(R6)                                                         
         SH    R0,=Y(RPALLOC-REGELEM)                                           
         LA    R1,RPALLOC                                                       
*                                                                               
         CLI   SVBPRD,X'FF'        POL ORDER?                                   
         BNE   CPOL18              NO, WON'T HAVE VAR PRODUCTS                  
*                                                                               
         TM    MISCFLG2,MF2VAROR   ALREADY A VAR ORDER?                         
         BNZ   *+12                YES                                          
         TM    MISCFLG2,MF2PRSNT   NO, PREVIOUSLY SENT?                         
         BNZ   CPOLYES                 YES, NEED TO BE VAR ORDER 1ST            
*                                                                               
         TM    MISCFLG2,MF2VPRDS   LOOKING FOR VAR PRODUCTS?                    
         BZ    CPOLYES             NO                                           
*                                                                               
         XC    WORK(2),WORK        YES                                          
         MVC   WORK(1),0(R1)                                                    
         SH    R0,=Y(L'RPALLOC)                                                 
         BNP   *+14                                                             
         LA    R1,L'RPALLOC(R1)                                                 
         MVC   WORK+1(1),0(R1)                                                  
*                                                                               
         LA    RE,PRDSLIST                                                      
         LA    R0,PRDSLIST+L'PRDSLIST                                           
CPOL12   OC    0(2,RE),0(RE)       EMPTY ENTRY?                                 
         BNZ   *+14                                                             
         MVC   0(2,RE),WORK        YES, WE'RE GOING TO NEED MORE ROOM!          
         B     CPOLYES                                                          
*                                                                               
         CLC   WORK(2),0(RE)       MATCHED THE ENTRY?                           
         BE    CPOLYES             YES, OKAY                                    
         CLC   WORK+1(1),0(RE)     NO, CHECK SWITCHED PIGGYBACK PAIR            
         BNE   CPOL14                                                           
         CLC   WORK(1),1(RE)                                                    
         BE    CPOLYES                 YES, IT WAS SWITCHED                     
*                                                                               
CPOL14   LA    RE,2(RE)            BUMP TO NEXT ENTRY                           
         CR    RE,R0               EXCEEDED THE VAR PRD LIST?                   
         BL    CPOL12                                                           
         DC    H'0'                YES, NEED TO INCREASE PRDSLIST               
*                                                                               
CPOL18   CLC   SVBPRD,0(R1)        MATCH ON PRODUCT?                            
         BNE   CPOL40              NO, SEE IF OUR P/B IS BUY'S PRD              
*                                                                               
         SH    R0,=Y(L'RPALLOC)    ANY PIGGYBACK?                               
         BNP   CPOL20              NO PIGGYBACK                                 
         CLI   SVBPR2,0            DOES ORDER HAVE P/B?                         
         BE    CPOLNO              NO, SKIP THIS SPOT                           
         LA    R1,L'RPALLOC(R1)                                                 
         CLC   SVBPR2,0(R1)        PIGGYBACKS MATCH?                            
         BNE   CPOLNO              NO, NEXT SPOT                                
         MVC   PR1TIMSH,RPTIME     YES, SAVE PRODUCT 1 TIME SHARE               
         B     CPOLYES                                                          
*                                                                               
CPOL20   CLI   SVBPR2,0            DOES ORDER HAVE P/B?                         
         BE    CPOLYES             NO, WE CAN USE THIS SPOT                     
         B     CPOLNO                                                           
*********                                                                       
* REVERSED, PRD IS P/B & P/B IS PRD                                             
*********                                                                       
CPOL40   CLI   SVBPR2,0            DOES THE ORDER HAVE PIGGYBACK?               
         BE    CPOLNO              NO, CHECK NEXT ELEM                          
         CLC   SVBPR2,0(R1)        YES, PIGGYBACK IS PRD?                       
         BNE   CPOLNO                   NO, OUR P/B IS NOT PRD EITHER           
*                                                                               
         SH    R0,=Y(L'RPALLOC)    SEE IF ANY PIGGYBACK                         
         BNP   CPOLNO              NEED ONE NOW                                 
         LA    R1,L'RPALLOC(R1)                                                 
         CLC   SVBPRD,0(R1)                                                     
         BNE   CPOLNO                                                           
         MVC   PR1TIMSH,RPTIME-RPALLOC(R1)    SAVE PRD 1 TIME SHARE             
*                                                                               
CPOLYES  B     YES                                                              
*                                                                               
CPOLNO   B     NO                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAY THE RECORD WITH ACTION SEND                                           
***********************************************************************         
DRSEND   NTR1  BASE=*,LABEL=*                                                   
         TM    MISCFLG1,MF1KYCHG   DID THE KEY CHANGED?                         
         BZ    *+8                                                              
         MVI   RCOMLINE,0          YES, NO PREVIOUS REP COMMENT                 
*                                                                               
         TWAXC ORSSALEH,ORSBCOMH   LEAVE DEST FIELD ALONE                       
         TWAXC ORSCOM1H                                                         
*                                                                               
         L     R6,AIO              POINT TO THE RECORD                          
         USING DOKEY,R6                                                         
         MVC   BINORDER,DOKORDER                                                
         DROP  R6                                                               
***                                                                             
* IF IT IS TRULY A SALEPERSON THEN LEAVE THE HEADING ALONE,                     
* OTHERWISE, MOVE IN 'POINTPERSON'                                              
***                                                                             
         XC    ORSEML,ORSEML                                                    
         OI    ORSEMLH+6,X'80'                                                  
         CLI   TWAOFFC,C'*'        DDS TERMINAL?                                
         BNE   *+8                                                              
         NI    ORSEMLH+1,X'FF'-X'04'   FROM ZERO TO HIGH INTENSITY              
*                                                                               
         MVI   ELCODE,DOSPELQ       SUPPLEMENTARY ID ELEMENT                    
         BAS   RE,GETEL                                                         
         BNE   DRSEND04             NOT THERE YET, DEFAULT=SALESPERSON          
         USING DOSPELD,R6                                                       
*                                                                               
         CLI   DOSPIMTH,C'E'       LAST SEND OF ORDER WAS TO EMAIL?             
         BNE   DRSEND03                                                         
         MVC   ORSEML,=C'EML'                                                   
         TM    DOSPFLG1,DOSPEML    PREV EMAIL ALREADY ON?                       
         BNZ   DRSEND02            YES, DON'T NEED TO UPDATE RECORD             
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
         OI    DOSPFLG1,DOSPEML    REGS DON'T CHANGE SO I CAN DO THIS           
         BRAS  RE,MYPUTREC                                                      
*                                                                               
DRSEND02 OI    MISCFLG3,MF3PRVEM                                                
*                                                                               
DRSEND03 TM    DOSPFLG1,DOSPPPER    POINTPERSON?                                
         BZ    DRSEND04             NO, SALESPERSON                             
         MVC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         B     *+10                                                             
DRSEND04 MVC   ORSSPTX,=X'E2819385A2978599A29695'                               
         OI    ORSSPTXH+6,X'80'                                                 
*&&DO                                                                           
***********************************                                             
* COMMENTED BLOCK UNTIL PC-RELEASE IS READY FOR THIS FIELD                      
* HWON - CODE FOR THE CHANGED DEST OR METHOD                                    
***********************************                                             
         MVI   ORSFLG1,C' '                                                     
         CLC   DOSPDEST,DOSPIDST                                                
         BNE   DRSEND05                                                         
         CLC   DOSPMTHD,DOSPIMTH                                                
         BE    DRSEND5A                                                         
DRSEND05 MVI   ORSFLG1,C'*'                                                     
DRSEND5A OI    ORSFLG1H+6,X'80'    TRANSMIT IT                                  
         DROP  R6                                                               
***********************************                                             
* COMMENTED BLOCK UNTIL PC-RELEASE IS READY FOR THIS FIELD                      
* HWON - CODE FOR THE CHANGED DEST OR METHOD                                    
***********************************                                             
*&&                                                                             
         L     R6,AIO              POINT TO THE RECORD                          
         MVI   ELCODE,DOIDELQ      GET DARE ID ELEMENT                          
         BAS   RE,GETEL                                                         
         USING DOIDELD,R6                                                       
         OC    ORSBUYR,SPACES      SEE IF BUYER IS THE SAME                     
         CLC   DOIDBYR,ORSBUYR                                                  
         BE    DRSEND10                                                         
         LA    R2,ORSBUYRH         ERROR IF NOT                                 
         NI    4(R2),X'FF'-X'20'   UNVALIDATE THIS FIELD                        
         MVI   BLOCK,L'DOIDBYR+1            L'LENGTH + L'MESSAGE                
         MVC   BLOCK+1(L'DOIDBYR),DOIDBYR   MESSAGE                             
         MVI   BLOCK+1+L'DOIDBYR,0          TERMINATING 0                       
         J     BYRALRDY                                                         
*                                                                               
DRSEND10 LA    R2,ORSORDH                                                       
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R2,ORSTORDH                                                      
         ST    R2,DMCB                                                          
         BRAS  RE,SHWORDER                                                      
*                                                                               
         LA    R2,ORSCONTH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R2,ORSTCONH                                                      
         MVC   8(L'ORSCONT,R2),DOIDCON                                          
*                                                                               
         MVC   ORSSALE,DOIDSPER                                                 
         OC    DOIDSPER,DOIDSPER                                                
         BZ    *+8                                                              
         MVI   ORSSALEH+5,20                                                    
         OI    ORSSALEH+6,X'80'                                                 
         OI    ORSSALEH+4,X'20'    PREVIOUSLY VALIDATED                         
*                                                                               
         LA    RE,DOISCOM1                                                      
         LA    RF,ORSSTD1H                                                      
DRSEND11 OC    0(L'DOISCOM1,RE),0(RE)  ANYTHING HERE?                           
         BZ    DRSEND12                                                         
         MVC   8(L'ORSSTD1,RF),0(RE)                                            
         MVI   5(RF),L'ORSSTD1     STD CMNT IS ALWAYS SPACE PADDED              
         OI    6(RF),X'80'                                                      
DRSEND12 AHI   RE,L'DOISCOM1                                                    
         ZIC   R0,0(RF)                                                         
         AR    RF,R0                                                            
         LA    R0,ORSSTD3H                                                      
         CR    RF,R0                                                            
         BNH   DRSEND11                                                         
*                                                                               
         OI    ORSOPORH+1,X'0C'                                                 
         OI    ORSOPORH+6,X'80'                                                 
         XC    ORSOORD,ORSOORD                                                  
         OI    ORSOORDH+6,X'80'                                                 
         CLI   DOIDPRD,X'FF'       POL ORDER?                                   
         BE    DRSND12A            YES, NO ORIGINAL ORDER #                     
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOI2ELQ      GET DARE I2 ELEMENT                          
         BAS   RE,GETEL                                                         
         BNE   DRSND12A                                                         
         USING DOI2ELD,R6                                                       
         MVC   WORK(4),BINORDER                                                 
         MVC   BINORDER,DOI2OORD                                                
         LA    R2,ORSOORDH                                                      
         BRAS  RE,SHWORDER                                                      
         MVC   BINORDER,WORK                                                    
         NI    ORSOPORH+1,X'FF'-X'04'                                           
         DROP  R6                                                               
*                                                                               
DRSND12A LA    R1,ORSCREVH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R1,ORSTREVH                                                      
         SR    R6,R6               CLEAR R6                                     
         BRAS  RE,SHOWREV                                                       
*                                                                               
DRSEND13 TM    BITFLAG,BFRCLLNG    AUTORECALL FROM BUY PROGRAM?                 
         BNZ   XIT                 GOING TO VR15                                
         CLI   ACTNUM,ACTRCALL     RECALL ACTION?                               
         BE    XIT                                                              
***  NEED TO DISPLAY REP COMMENTS IF REJECTED/PARTIAL CONFIRM                   
*                           (FIRST TIME ONLY)   -MHC 10/25/02                   
         L     R6,AIO                                                           
         MVI   ELCODE,DOSTELQ      GET DARE I2 ELEMENT                          
         BAS   RE,GETEL                                                         
         BNE   DRSEND14                                                         
         USING DOSTELD,R6                                                       
*                                                                               
         CLI   DOSTSTAT,QRJCT      IS IT REJECTED BY REP?                       
         BE    DRREPCHK                                                         
         CLI   DOSTSTAT,QSNTXCNF   SENT CANCELLED, RECALL CONFIRMED?            
         BE    DRREPCHK                                                         
         CLI   DOSTSTAT,QSNTXREJ   SENT CANCELLED, RECALL REJECTED?             
         BE    DRREPCHK                                                         
         CLI   DOSTSTAT,QCFMD      IS IT CONFIRMED?                             
         BNE   DRSEND14             - NO, SKIP                                  
         TM    DOSTTYPE,DCNFMCOM   IS IT PARTIAL CONFIRM?                       
         BNO   DRSEND14             - NO, SKIP, MUST BE PARTIAL CONFIRM         
*                                                                               
DRREPCHK TM    MISCFLG3,MF3NOFST   IS IT THE FIRST TIME THROUGH?                
         BZ    DRSEND15             - YES, SHOW REP COMMENTS                    
*                                                                               
DRSEND14 TM    MISCFLG3,MF3NOFST   IS IT THE FIRST TIME THROUGH?                
         BZ    DRSND14A                                                         
         CLI   PFKEY,11                                                         
         BNE   DRSEND20                                                         
         TM    BITFLAG2,BF2SHOWR   SHOW REP COMMENTS?                           
         BNZ   DRSEND15                                                         
DRSND14A BRAS  RE,SHWCMNTS            NO, SHOW ORDER COMMENTS                   
         B     DRSEND20                                                         
DRSEND15 BRAS  RE,SHWRCMNT            YES                                       
*                                                                               
DRSEND20 DS    0H                                                               
         OI    MISCFLG3,MF3NOFST                                                
         BRAS  RE,SHWOCOMS                                                      
*                                                                               
         XC    CONHED2,CONHED2                                                  
         OI    CONHED2H+6,X'88'    TRANSMIT FOR HIGH INTENSITY                  
*                                                                               
         TM    BITFLAG,BFFRMBUY    JUST FROM THE BUY PROGRAM?                   
         BZ    *+10                                                             
         MVC   CONHED2(35),=CL35'** TRANSMISSION IS STILL PENDING **'           
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL?                                
         BNE   DRSENDX                                                          
         MVC   CONHED2+50(4),=CL4'D/A='                                         
         GOTO1 HEXOUT,DMCB,DISKADDR,CONHED2+54,4                                
*                                                                               
DRSENDX  CLI   ACTNUM,ACTCMPRV     COMMENT/PREVIEW ACTION?                      
         JE    XIT                 THEN NO NEED TO DIDPLAY FROM SCRATCH         
         CLI   ACTNUM,ACTXMIT      TRANSMIT ACTION?                             
         JE    XIT                 THEN NO NEED TO DISPLAY FROM SCRATCH         
*                                                                               
         MVC   AIO,AIO2            KEEP ORDER RECORD IN AIO1                    
         BRAS  RE,CMTBATCH                                                      
         MVC   AIO,AIO1                                                         
*                                                                               
         GOTO1 ,DMCB,ORSDESTH,ORSROUTH,(MISCFLG3,EDIDATE),0                     
*                                                                               
DRSNDX07 L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         USING DOSPELD,R6                                                       
*****                                                                           
         CLI   DOSPMTHD,C'E'       TRYING TO EMAIL?                             
         BNE   DRSNDX10                                                         
         LR    R0,R6                                                            
         L     R6,AIO                                                           
         MVI   ELCODE,DOEMLELQ     BDE COMMON NAME STORED IN RECORD?            
         BAS   RE,GETEL                                                         
         BNE   DRSNDX09                                                         
         USING DOEMLD,R6                                                        
         MVC   ORSROUT(5),=C'EML: '                                             
         MVC   ORSROUT+5(40),DOEMLBDE                                           
         B     DRSNDX47                                                         
         DROP  R6                                                               
*                                                                               
         USING DOSPELD,R6                                                       
DRSNDX09 LR    R6,R0               RESTORE R6                                   
DRSNDX10 CLI   DOSPDEST,0          SAVED HOW IT WENT BEFORE?                    
         BNE   DRSNDX15            YES                                          
         TM    MISCFLG3,MF3PRVCF   NO, PREVIOUSLY CONFIRMED ORDER?              
         BZ    DRSNDX14                YES, LET RULES TAKE OVER                 
         MVI   ORSDESTH+5,0                                                     
         XC    ORSDEST,ORSDEST                                                  
DRSNDX12 BRAS  RE,FAKELMRC         BUILD A FAKE LAST METHOD RECORD              
         GOTO1 ,DMCB,ORSDESTH,ORSROUTH,(MISCFLG3,EDIDATE),0                     
         OI    DMCB,X'40'          USE LAST METHOD I BUILT IN AIO3              
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
         TM    MISCFLG4,MF4MOFAX   FAXING OOW TO MO?                            
         BZ    DRSNDX40            NO, LET RULES TAKE OVER                      
         MVI   DOSPMTHD,C'F'                                                    
         MVI   DOSPIMTH,C'F'                                                    
         B     DRSNDX35                                                         
*&&                                                                             
         B     DRSNDX40                                                         
*                                                                               
DRSNDX14 TM    MISCFLG3,MF3RADIO+MF3FXRAD   FAX ALL RADIO ORDERS?               
         BO    DRSNDX35                                                         
         B     DRSNDX30                NO, NEVER                                
*                                                                               
DRSNDX15 TM    MISCFLG3,MF3PRVCF   PREVIOUSLY CONFIRMED ORDER?                  
         BO    DRSNDX12            YES, USE FAKELMRC                            
*                                                                               
         TM    MISCFLG3,MF3RADIO+MF3FXRAD   FAX ALL RADIO ORDERS?               
         BO    DRSNDX12            YES, USE FAKELMRC                            
*                                                                               
         CLC   DOSPDEST,ORSDEST    SAME DEST AS ON SCREEN?                      
         BE    DRSNDX22            YES, DONE PREV/NEW LONG AGO                  
*                                                                               
DRSNDX20 NI    ORSDESTH+4,X'FF'-X'20'   NOT PREV VALIDATED                      
         MVI   ORSDESTH+5,3                                                     
         MVC   ORSDEST(3),=C'REP'                                               
         CLI   DOSPDEST,C'R'                                                    
         BE    *+10                                                             
         MVC   ORSDEST(3),=C'STA'                                               
*                                                                               
DRSNDX22 CLI   DOSPMTHD,C'I'       WAS IT INBOX? CAN'T CHECK 1ST LETTER         
         BNE   DRSNDX25            NO                                           
         CLC   =C'EML:',ORSROUT    IS IT EMAIL?                                 
         BE    DRSNDX12            DOESNT'T MATCH PREV SENT METH                
         CLC   =C'FAX:',ORSROUT    OR FAX?                                      
         BE    DRSNDX12            DOESNT'T MATCH PREV SENT METH                
         B     DRSNDX30            MIGHT NEED PREV BIT IN RD4R                  
*                                                                               
DRSNDX25 TM    MISCFLG2,MF2PRSNT   ROUTE ON SCREEN IS INBOX, PREV SENT?         
         BNZ   DRSNDX12                YES, DON'T NEED PREV BIT IN RD4R         
         CLC   =C'EML:',ORSROUT    CAN'T JUST CHECK ONE LETTER BECAUSE          
         BE    DRSNDX27               IF REP INBOX'S 1ST LETTER BEGINS          
         CLC   =C'FAX:',ORSROUT       WITH AN 'E' OR AN 'F' THEN THIS           
         BE    DRSNDX27               CHECK IS NO GOOD                          
         B     DRSNDX30                NO, USER MIGHT WANT FAX OR EMAIL         
*                                                                               
DRSNDX27 CLC   DOSPMTHD,ORSROUT    SAME ROUTE AS ON SCREEN?                     
         BNE   DRSNDX12            NO                                           
***************                                                                 
* HOW CAN WE OVERRIDE INTERREP CODE?                                            
***************                                                                 
DRSNDX30 CLI   DOSPDEST,0                                                       
         BE    DRSNDX33            NO                                           
*                                                                               
         CLI   DOSPMTHD,C'F'       USER WANTS TO FAX?                           
         BE    DRSNDX35            THEN LET THEM HAVE IT                        
         DROP  R6                                                               
***************                                                                 
* HOW CAN WE OVERRIDE INTERREP CODE?                                            
***************                                                                 
DRSNDX33 TM    ORSPRNWH+1,X'0C'    FIELD DISPLAYED                              
         BO    DRSNDX40            NO                                           
         CLI   ORSPRNW,C'P'        PREVIOUS?                                    
         BNE   DRSNDX40            YES...PASS INFO TO RD4ROUTE                  
         MVI   ORSDESTH+5,0                                                     
         XC    ORSDEST,ORSDEST                                                  
DRSNDX35 MVI   DMCB+4,X'80'        FAXING BIT                                   
*                                                                               
DRSNDX40 GOTO1 RD4ROUTE,DMCB                                                    
         BE    DRSNDX45                                                         
         LA    R2,ORSROUTH                                                      
****     CLI   ORSPRNW,C'P'        PREVIOUS?                                    
****     JNE   ERREXIT                                                          
         CLC   GERROR,=AL2(NODSTDOV)  DESTINE IS FOR REP, USE DESTOV            
         BE    DRSNDX41                                                         
         CLC   GERROR,=AL2(NODRADM)                                             
         JNE   ERREXIT                                                          
DRSNDX41 CLI   PFKEY,5             THEY'RE TRYING TO GET INTO DESTOV            
         BE    DRSNDX45                                                         
         CLC   GERROR,=AL2(NODSTDOV)  DESTINE IS FOR REP, USE DESTOV            
         JE    ERREXIT                                                          
         MVC   GERROR,=AL2(264)    PLEASE USE DESTOV!                           
         J     ERREXIT                                                          
*                                                                               
DRSNDX45 NI    MISCFLG3,X'FF'-MF3NOOFF                                          
         TM    DMCB,X'80'          REP DOES NOT APPEND OFFICE?                  
         BZ    *+8                                                              
         OI    MISCFLG3,MF3NOOFF                                                
*                                                                               
DRSNDX47 OI    ORSDESTH+4,X'20'                                                 
         OI    ORSDESTH+6,X'80'                                                 
*                                                                               
         CLI   ACTNUM,ACTRCALL     ARE WE RECALLING?                            
         BNE   DRSNDX50                                                         
         CLI   ORSXMIT,C'C'        CASH WON'T BE A PROBLEM                      
         BE    DRSNDX50                                                         
         OC    ORSTORD,ORSTORD     ANY TRADE ORDER?                             
         BNZ   DRSNDX50            YES, NOT A PROBLEM                           
         LA    R2,ORSXMITH                                                      
         J     NOTRDRCL            NO TRADE ORDER TO RECALL                     
*                                                                               
DRSNDX50 DS    0H                                                               
         LA    R2,ORSMEDH                                                       
         BRAS  RE,CHKORERR         SEE IF ORDER IS IN ERR                       
         JNE   NTRCHNGS            RECORD DISPLAYED - NOW ENTER CHANGES         
         J     OURMESGE            SHOW OUR MESSAGE                             
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* VALIDATE THE DESTINATION FIELD                                                
***********************************************************************         
VALIDEST NTR1  BASE=*,LABEL=*                                                   
         TM    MISCFLG3,MF3PRVCF   PREVIOUSLY CONFIRMED?                        
         BNZ   VRDSTYES                                                         
*                                                                               
         LA    R2,ORSDESTH                                                      
         TM    4(R2),X'20'         PREVIOUSLY VALIDATED                         
         BNZ   VRDSTYES                                                         
*                                                                               
         BRAS  RE,CHKPNDNG                                                      
         JE    PNDNGORD                                                         
*                                                                               
         CLC   =C'REP',8(R2)                                                    
         BE    *+14                                                             
         CLC   =C'STA',8(R2)                                                    
         BNE   VRDSTNO                                                          
*                                                                               
         LA    RE,ORSROUTH                                                      
         ST    RE,DMCB+4           <=== WE'RE OVERWRITING 2ND PARAM             
*                                                                               
         CLI   ORSPRNW,C'P'        PREVIOUSLY AVN?                              
         BE    VRDST25                                                          
*                                                                               
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         TM    MISCFLG4,MF4MOFAX   FAXING OOW TO MO                             
         BO    VRDST25                                                          
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
         TM    MISCFLG3,MF3RADIO+MF3FXRAD   FAX ALL RADIO ORDERS?               
         BNO   VRDST30                                                          
VRDST25  MVI   DMCB+4,X'80'        YES...CALL RD4ROUTE WITH HOB=X'80'           
VRDST30  GOTO1 RD4ROUTE,DMCB,(X'10',ORSDESTH),,(MISCFLG3,EDIDATE),0             
         BE    VRDST35                                                          
         CLC   GERROR,=AL2(NODSTDOV)  DESTINE IS FOR REP, USE DESTOV            
         BE    VRDST31                                                          
         CLC   GERROR,=AL2(NODRADM)   NO DARADM FAX RECORD FOR REP?             
         JNE   ERREXIT                                                          
VRDST31  CLI   PFKEY,5                THEY'RE TRYING TO GET INTO DESTOV         
         BE    VRDST35                                                          
         CLC   GERROR,=AL2(NODSTDOV)  DESTINE IS FOR REP, USE DESTOV            
         JE    ERREXIT                                                          
         MVC   GERROR,=AL2(264)       PLEASE USE DESTOV!                        
         J     ERREXIT                                                          
*                                                                               
VRDST35  NI    MISCFLG3,X'FF'-MF3NOOFF                                          
         TM    DMCB,X'80'          REP DOES NOT APPEND OFFICE?                  
         BZ    *+8                                                              
         OI    MISCFLG3,MF3NOOFF                                                
*                                                                               
         LA    R6,KEY              LET'S SEE IF WE HAVE LSTM                    
         XC    KEY,KEY                                                          
         USING DMTHKEY,R6                                                       
         MVI   DMTHTYPE,DMTHTYPQ        X'0D3E'                                 
         MVI   DMTHSBTY,DMTHSBTQ                                                
         MVC   DMTHAGMD,BAGYMD                                                  
         MVC   DMTHBYR,QBYR                                                     
         MVC   DMTHSTA,BSTA                                                     
         MVC   DMTHCLT,BCLT                                                     
*                                                                               
         OI    DMINBTS,X'08'        PASS BACK DELETED                           
         MVI   RDUPDATE,C'N'        NEED IF DELETED TO WRITE BACK               
         GOTO1 HIGH                                                             
         MVC   AIO,AIO2                                                         
         CLC   KEY(13),KEYSAVE     ANY LAST METHOD BY THIS CLIENT?              
         BE    VRDST50             YES                                          
*                                                                               
         L     RE,AIO                                                           
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
*                                                                               
         L     R6,AIO                                                           
         MVI   DMTHTYPE,DMTHTYPQ        X'0D3E'                                 
         MVI   DMTHSBTY,DMTHSBTQ                                                
         MVC   DMTHAGMD,BAGYMD                                                  
         MVC   DMTHBYR,QBYR                                                     
         MVC   DMTHSTA,BSTA                                                     
         MVC   DMTHCLT,BCLT                                                     
         MVC   DMTHAGY,AGENCY                                                   
         LA    R1,DMTHLNQ+DMTHFRST-DMTHKEY+1                                    
         STCM  R1,3,DMTHLEN            L(REC) W/O THE ACTVD                     
*                                                                               
         L     R6,AIO                                                           
         LA    R6,24(R6)                                                        
         USING DMTHELD,R6                                                       
         MVI   DMTHEL,DMTHELQ                                                   
         MVI   DMTHELLN,DMTHLNQ                                                 
         MVC   DMTHDEST,ORSDEST    COPY 1ST LETTER OF DEST                      
         MVI   DMTHMTHD,C'I'                                                    
         CLC   =C'FAX:',ORSROUT    WAS IT FAXING?                               
         BNE   *+12                                                             
         MVI   DMTHMTHD,C'F'                                                    
         B     VRDST40                                                          
         CLC   =C'EML:',ORSROUT    WAS IT EMAILING?                             
         BNE   VRDST40                                                          
         MVI   DMTHMTHD,C'E'                                                    
         MVC   DMTHBDEC,ORSROUT+5                                               
         DROP  R6                                                               
*                                                                               
VRDST40  BRAS  RE,UPDATTIM                                                      
*                                                                               
         MVI   ACTELOPT,C'Y'                                                    
         BRAS  RE,MYADDREC                                                      
         MVI   ACTELOPT,C'N'                                                    
         B     VRDSTYES                                                         
*                                                                               
VRDST50  MVI   RDUPDATE,C'Y'        NEED IF DELETED TO WRITE BACK               
         GOTO1 HIGH                                                             
         TM    KEY+13,X'80'         DELETED KEY?                                
         BZ    VRDST55              NO, NO NEED TO WRITE BACK                   
         NI    KEY+13,X'FF'-X'80'                                               
         CLI   PQONLY,C'Y'                                                      
         BE    VRDST55                                                          
         GOTO1 WRITE                                                            
*                                                                               
VRDST55  MVC   DISKADDR,KEY+14                                                  
         OI    DMINBTS,X'08'        PASS BACK DELETED                           
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC              UPDATE THE LAST METHOD RECORD                
         L     R6,AIO                                                           
         NI    15(R6),X'FF'-X'80'   ALWAYS REMOVE DELETED BIT                   
         LA    R6,24(R6)                                                        
         USING DMTHELD,R6                                                       
         MVI   DMTHMTHD,C'I'                                                    
         CLC   =C'FAX:',ORSROUT    WAS IT FAXING?                               
         BNE   *+12                                                             
         MVI   DMTHMTHD,C'F'                                                    
         B     VRDST60                                                          
*                                                                               
         CLC   =C'EML:',ORSROUT    WAS IT EMAILING?                             
         BNE   VRDST60                                                          
         MVI   DMTHMTHD,C'E'                                                    
         MVC   DMTHBDEC,ORSROUT+5                                               
*                                                                               
VRDST60  CLC   DMTHDEST,ORSDEST                                                 
         BE    VRDST70                                                          
         MVC   DMTHDEST,ORSDEST    COPY 1ST LETTER OF DEST                      
         DROP  R6                                                               
         MVI   ELCODE,DMFXELQ        X'10' - TEMP FAX OVERRIDE ELEM             
         BAS   RE,NEXTEL                                                        
         BNE   VRDST70                                                          
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)    DELETE THIS                   
*                                                                               
VRDST70  BRAS  RE,UPDATTIM                                                      
*                                                                               
         MVI   ACTELOPT,C'Y'                                                    
         XC    KEY,KEY                                                          
         L     R6,AIO                                                           
         MVC   KEY(13),0(R6)                                                    
         BRAS  RE,MYPUTREC                                                      
         MVI   ACTELOPT,C'N'                                                    
*                                                                               
VRDSTYES DS    0H                                                               
*                                                                               
         MVC   KEY,SAVEKEY                                                      
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   VRDSTY90                                                         
         MVC   AIO,AIO1                                                         
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   VRDSTY90                                                         
         USING DOSPELD,R6                                                       
*                                                                               
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         TM    MISCFLG4,MF4MOFAX   FAXING OOW TO MO                             
         BZ    VRDSTY04                                                         
         OI    DOSPFLG1,DOSPAVN                                                 
         MVI   DOSPMTHD,C'F'                                                    
         MVI   DOSPIMTH,C'F'                                                    
         B     VRDSTY80                                                         
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
VRDSTY04 CLI   DOSPDEST,0          DO WE KNOW HOW IT WAS SENT BEFORE?           
         BNE   VRDSTY05            YES, CHECK IF IT CHANGED?                    
*                                                                               
         TM    MISCFLG2,MF2PRSNT   NO, WAS IT EVER SENT?                        
         BZ    VRDSTY90            NO, DON'T UPDATE!                            
         B     VRDSTY10            DON'T KNOW, UPDATE IT                        
*                                                                               
VRDSTY05 CLC   DOSPDEST,8(R2)      ARE WE THE SAME?                             
         BE    VRDSTY90            YES, DON'T UPDATE DEST/METH                  
*                                                                               
VRDSTY10 MVC   DOSPDEST,ORSDEST                                                 
         MVI   DOSPMTHD,C'E'                                                    
         CLC   =C'EML:',ORSROUT                                                 
         BE    VRDSTY15                                                         
         MVI   DOSPMTHD,C'F'                                                    
         CLC   =C'FAX:',ORSROUT                                                 
         BE    VRDSTY15                                                         
         MVI   DOSPMTHD,C'I'                                                    
*                                                                               
VRDSTY15 L     R6,AIO                                                           
         LA    R6,24(R6)                                                        
VRDSTY17 CLI   0(R6),0             END OF RECORD?                               
         BE    VRDSTY80                                                         
         CLI   0(R6),DOWIGELQ                                                   
         BE    VRDSTY20                                                         
         CLI   0(R6),DOEMLELQ                                                   
         BE    VRDSTY20                                                         
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     VRDSTY17                                                         
VRDSTY20 GOTO1 RECUP,DMCB,(C'S',AIO),(R6)   DELETE IT                           
         B     VRDSTY17                                                         
*                                                                               
VRDSTY80 BRAS  RE,MYPUTREC                                                      
*                                                                               
VRDSTY90 OI    ORSDESTH+4,X'20'                                                 
         CR    R1,R1                                                            
         B     VRDSTX                                                           
VRDSTNO  LTR   RB,RB                                                            
VRDSTX   MVC   AIO,AIO1                                                         
         B     XIT                                                              
         LTORG                                                                  
***********************************************************************         
* BUILD LAST METHOD RECORD BASED ON THE CONFIRMED ORDER INFO                    
*                                                                               
* ON ENTRY:    AIO                 A(ORDER RECORD)                              
*                                                                               
* ON EXIT:     AIO3                A(FAKE LAST METHOD RECORD)                   
*                                                                               
* *** WARNING ***                                                               
*   ELEM GETS CLOBBERED                                                         
***********************************************************************         
FAKELMRC NTR1  BASE=*,LABEL=*                                                   
         L     RE,AIO3                                                          
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
*                                                                               
         L     R2,AIO3                                                          
         USING DMTHKEY,R2                                                       
         MVI   DMTHTYPE,DMTHTYPQ   X'0D3E'                                      
         MVI   DMTHSBTY,DMTHSBTQ                                                
         MVC   DMTHAGMD,BAGYMD                                                  
         MVI   DMTHLEN+1,DMTHFRST-DMTHKEY                                       
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         LA    R6,DORFRST                                                       
         USING DOIDELD,R6                                                       
         MVC   DMTHBYR,DOIDBYR                                                  
         MVC   DMTHSTA,DOISTA                                                   
         MVC   DMTHCLT,DOIDCLT                                                  
*                                                                               
         XC    ELEM,ELEM                                                        
         LA    R3,ELEM                                                          
         USING DMTHELD,R3                                                       
         MVI   DMTHEL,DMTHELQ                                                   
         MVI   DMTHELLN,DMTHLNQ                                                 
*                                                                               
         L     R6,AIO              SEE IF ORDER HAS DEST/METH                   
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   FLMR10              NONE                                         
         USING DOSPELD,R6                                                       
         CLI   DOSPDEST,0                                                       
         BE    FLMR10                                                           
*                                                                               
         CLI   DOSPIMTH,C'E'       ORIGINALLY SENT EMAIL?                       
         BNE   FLMR05                                                           
FLMR04   MVC   DMTHDEST,DOSPDEST   YES, USER MIGHT HAVE CHANGED SINCE           
         MVC   DMTHMTHD,DOSPMTHD       OVERRIDE IF EMAIL/CONFIRMED              
         B     FLMR10                                                           
*                                                                               
FLMR05   TM    MISCFLG3,MF3PRVCF   PREVIOUSLY CONFIRMED ORDER?                  
         BZ    FLMR04              NO                                           
         MVC   DMTHDEST,DOSPIDST   USE DEST/MTHD OF SEND BEFORE CONFIRM         
         MVC   DMTHMTHD,DOSPIMTH                                                
*                                                                               
FLMR10   LA    R4,DMTHFRST         ADD LAST METHOD ELEM                         
         GOTO1 RECUP,DMCB,(C'S',AIO3),ELEM,(R4)                                 
         LR    R3,R4               R3 = A(LAST METHOD ELEM IN AIO3)             
*                                                                               
         CLI   DMTHMTHD,C'I'       WENT TO AN INBOX?                            
         BE    FLMRX               SHOULDN'T BE A PROBLEM                       
*                                                                               
         L     R6,AIO              LET'S SEE IF WE CAN FIND OUT WHERE           
         MVI   ELCODE,DOWIGELQ      THE ORDER WENT                              
         BAS   RE,GETEL                                                         
         BNE   FLMRX                                                            
         USING DOWIGELD,R6                                                      
         CLI   DOWIGMTH,C'E'                                                    
         BNE   FLMR20                                                           
         L     R6,AIO              LET'S SEE IF WE CAN FIND OUT WHERE           
         MVI   ELCODE,DOEMLELQ      THE ORDER WENT                              
         BAS   RE,GETEL                                                         
         BNE   FLMRX                                                            
         USING DOEMLD,R6                                                        
         MVC   DMTHBDEC,DOEMLBDE                                                
         LA    R1,DMTHBDEC+L'DMTHBDEC-1                                         
FLMR15   CLI   0(R1),C' '                                                       
         BH    FLMRX                                                            
         MVI   0(R1),C' '                                                       
         BCTR  R1,0                                                             
         B     FLMR15                                                           
         DROP  R6                                                               
*                                                                               
         USING DOWIGELD,R6                                                      
FLMR20   CLI   DOWIGMTH,C'F'                                                    
         BNE   FLMRX                                                            
         CLC   DOWIGFXN(10),=10C'0'   MESSED UP FAX NUMBER?                     
         BH    FLMR25                                                           
         L     RE,AIO3             YES, DON'T BOTHER USING IT                   
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
         B     FLMRX                                                            
FLMR25   OI    DMTHFLG1,DMF1KFAX   KEEP FAX METHOD, SKIP BDE                    
*****                                                                           
         CLI   DMTHDEST,0          NOTHING HERE? (DOSPDEST=0)                   
         BNE   FLMR30              WE GOT SOMETHING                             
         MVI   DMTHDEST,C'S'       COULDN'T FAX BACK THEN TO REP BEFORE         
         MVI   DMTHMTHD,C'F'           KEEPING DOSPDEST (DESTOV)                
*&&DO                                                                           
FLMR30   CLC   DOWIGFXA(L'DOWIGFXA+L'DOWIGFXT),SPACES                           
         BH    FLMRX               NEED ATTENTION AND PHONE FOR LATER           
*&&                                                                             
FLMR30   XC    ELEM,ELEM                                                        
         LA    R3,ELEM                                                          
         USING DMFXELD,R3                                                       
         MVI   DMFXEL,DMFXELQ                                                   
         MVI   DMFXLEN,DMFXLENQ                                                 
         MVC   DMFXOVRD,DOWIGFXN   TREAT AS A FAX OVERRIDE #                    
         MVC   DMFXDATE,JDTTODAY   SAVE ACTIVE DATE                             
         DROP  R3                                                               
         XR    R0,R0                                                            
         IC    R0,1(R4)            WHERE TO INSERT TEMP FAX OVRDE ELEM          
         AR    R4,R0                                                            
         GOTO1 RECUP,DMCB,(C'S',AIO3),ELEM,(R4)                                 
*                                                                               
FLMRX    B     XIT                                                              
         DROP  R2,R6                                                            
         LTORG                                                                  
***********************************************************************         
* THIS IS WHERE WE DISPLAY THE RESULTS OF THE SEND BASED ON THE FLAGS           
* SET IN CASHFLG1 & TRDEFLG1                                                    
***********************************************************************         
SHWMESGE NTR1  BASE=*,LABEL=*                                                   
         XC    BLOCK(61),BLOCK                                                  
         CLI   ACTNUM,ACTRCALL     ARE WE RECALLING?                            
         BE    SHMSG300            USE OTHER SET OF BIT FLAGS                   
*                                                                               
         CLI   ACTNUM,ACTBRNDS                                                  
         BNE   SHWMSG05            BRANDED ORDERS WILL BE ON THEIR WAY          
         MVC   BLOCK+1(35),=C'Branded Orders will be on their way'              
         LA    RF,BLOCK+36                                                      
         B     SHMSG350                                                         
*                                                                               
SHWMSG05 TM    MISCFLG4,MF4UNWMG   MAKEGOOD WAS UNWOUND IN THE PAST?            
         BZ    SHWMSG07                                                         
         NI    MISCFLG4,X'FF'-MF4UNWMG                                          
         MVC   BLOCK+1(30),=C'Order sent. Makegoods changed '                   
         MVC   BLOCK+31(20),=C'since last transmit.'                            
         MVI   BLOCK+51,0                                                       
         MVI   BLOCK,52                                                         
         LA    R2,ORSMEDH                                                       
*                                                                               
         TM    BITFLAG,BFFRMBUY    CAME FROM THE $BUY PROGRAM?                  
         BZ    SHWMSGX             NO, JUST SHOW THIS MESSAGE                   
*                                                                               
         L     RF,ACOMFACS         PASS MESSAGE BACK TO $BUY                    
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK+1,60,GLVSPORD                           
         CLI   8(R1),0                                                          
         BE    SHWMSGX                                                          
         DC    H'0'                                                             
*                                                                               
SHWMSG07 CLI   ORSXMIT,C'B'        BOTH ORDERS REQUESTED TO BE SENT             
         BE    SHMSG100                                                         
*                                                                               
         LA    R4,CASHFLG1                                                      
         MVC   BLOCK+1(14),=CL14'** CASH ORDER '  CASH OR TRADE?                
         MVC   BLOCK+15(8),ORSORD                                               
         CLI   ORSXMIT,C'C'                                                     
         BE    SHWMSG10                                                         
         TM    CASHFLG1,NOBYSEXS   TRADE ONLY AND NO CASH BUYS?                 
         BNZ   SHMSG100            ONLY SET BY SETMETHD                         
         LA    R4,TRDEFLG1                                                      
         MVC   BLOCK+1(14),=CL14'**TRADE ORDER '                                
         MVC   BLOCK+15(8),ORSTORD                                              
*                                                                               
SHWMSG10 MVI   BLOCK+23,C' '                                                    
         LA    RF,BLOCK+24                                                      
         TM    0(R4),ONTHEWAY                                                   
         BZ    SHWMSG15                                                         
         MVC   0(17,RF),=CL17'IS ON ITS WAY !**'                                
         CLI   RESEND,C'Y'                                                      
         BNE   *+10                                                             
         MVC   0(17,RF),=CL17'WAS RESENT **'                                    
         LA    RF,17(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHWMSG15 TM    0(R4),SNTALRDY                                                   
         BZ    SHWMSG20                                                         
         MVC   0(34,RF),=CL34'SENT ALREADY! WAITING FOR RESPONSE'               
         LA    RF,34(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHWMSG20 TM    0(R4),ORDUNDRD                                                   
         BZ    SHWMSG25                                                         
         MVC   0(28,RF),=CL28'UNDARED AND CANNOT BE RESENT'                     
         LA    RF,28(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHWMSG25 TM    0(R4),CSNDCONF                                                   
         BZ    SHWMSG30                                                         
         MVC   0(30,RF),=CL30'CONFIRMED AND CANNOT BE RESENT'                   
         LA    RF,30(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHWMSG30 TM    0(R4),NTDARENV                                                   
         BZ    SHWMSG35                                                         
         MVC   0(19,RF),=CL19'CANNOT BE NOTDARE''D'                             
         LA    RF,19(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHWMSG35 TM    0(R4),GOTSMMGS                                                   
         BZ    SHWMSG40                                                         
         MVC   0(18,RF),=CL18'HAS SOME MAKEGOODS'                               
         LA    RF,18(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHWMSG40 TM    0(R4),NOBYSEXS                                                   
         BZ    SHWMSG45                                                         
         MVC   0(19,RF),=CL19'HAS NO DATA TO SEND'                              
         LA    RF,19(RF)                                                        
*                                                                               
         TM    MISCFLG1,MF1DRTRD   MESSAGE FOR TRADE ORDER?                     
         BNZ   SHWMSG50            YES, JUST TRADE MSG THEN                     
         TM    MISCFLG1,MF1TRDRC   CASH ORDER, WE HAVE TRADE BUYS?              
         BZ    SHWMSG50                        NOPE, JUST THE MSG THEN          
         MVC   BLOCK+1(13),=CL13'* EMPTY CASH '                                 
         MVC   BLOCK+14(8),ORSORD                                               
         MVC   BLOCK+22(8),=CL8', TRADE '                                       
         MVC   BLOCK+30(8),ORSTORD                                              
         MVC   BLOCK+38(11),=CL11' NOT SENT *'                                  
         LA    RF,BLOCK+49                                                      
         B     SHWMSG50                                                         
*                                                                               
SHWMSG45 DS    0H                  JUST IN CASE WE HAVE MORE MESSAGES           
*                                                                               
SHWMSG50 MVI   0(RF),0             TERMINATING 0                                
         LA    RF,1(RF)                                                         
         LA    R0,BLOCK+1                                                       
         SR    RF,R0                                                            
         STC   RF,BLOCK                                                         
         LA    R2,ORSMEDH          PLACE CURSOR HERE                            
*                                                                               
         TM    BITFLAG,BFFRMBUY    CAME FROM BUY PROGRAM?                       
         BZ    SHWMSGX             NO, JUST SHOW MESSAGE                        
*                                                                               
         TM    CASHFLG1,ONTHEWAY                                                
         BNZ   *+12                                                             
         TM    TRDEFLG1,ONTHEWAY                                                
         BZ    SHWMSGX             ERR IF NO MSG "ON ITS WAY"                   
         L     RF,ACOMFACS         PASS MESSAGE BACK TO BUY                     
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK+1,60,GLVSPORD                           
         CLI   8(R1),0                                                          
         BE    SHWMSGX                                                          
         DC    H'0'                                                             
***********************************                                             
* BOTH ORDERS WERE REQUESTED TO BE SENT                                         
***********************************                                             
SHMSG100 TM    CASHFLG1,ONTHEWAY   CASH ORDER ON ITS WAY?                       
         BZ    SHMSG150                                                         
         TM    TRDEFLG1,ONTHEWAY   TRADE ORDER ON ITS WAY?                      
         BZ    SHMSG105                                                         
* BOTH CASH AND TRADE ARE ON THEIR WAY                                          
         MVC   BLOCK+1(7),=CL7'* CASH '                                         
         MVC   BLOCK+8(8),ORSORD                                                
         MVC   BLOCK+16(9),=CL9' && TRADE '                                     
         MVC   BLOCK+25(8),ORSTORD                                              
         MVC   BLOCK+33(21),=CL21' ARE ON THEIR WAY! **'                        
         LA    RF,BLOCK+54                                                      
         B     SHWMSG50                                                         
***********************************                                             
* CASH IS ON ITS WAY, BUT TRADE ISN'T                                           
***********************************                                             
SHMSG105 MVC   BLOCK+1(5),=CL5'CASH '                                           
         MVC   BLOCK+6(8),ORSORD                                                
         MVC   BLOCK+14(13),=CL13' ON ITS WAY! '                                
         LA    RF,BLOCK+27                                                      
*                                                                               
         LA    R4,TRDEFLG1                                                      
         TM    0(R4),NOBYSEXS      ANY TRADE BUYS?                              
         BZ    SHMSG110                                                         
         MVC   0(21,RF),=CL21'NO TRADE BUYS TO SEND'                            
         LA    RF,21(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHMSG110 MVC   0(6,RF),=C'TRADE '                                               
         MVC   6(8,RF),ORSTORD                                                  
         MVI   14(RF),C' '                                                      
         LA    RF,15(RF)                                                        
*                                                                               
         BAS   R3,OTHERMSG                                                      
         B     SHWMSG50                                                         
************************************************                                
* THE CASH ORDER DID NOT GO OUT                                                 
************************************************                                
SHMSG150 DS    0H                                                               
         TM    TRDEFLG1,ONTHEWAY   TRADE ORDER ON ITS WAY?                      
         BZ    SHMSG200                                                         
***********************************                                             
* CASH DIDN'T, BUT TRADE WENT OUT!                                              
***********************************                                             
         LA    R4,CASHFLG1                                                      
         MVC   BLOCK+1(5),=CL5'CASH '                                           
         MVC   BLOCK+6(8),ORSORD                                                
         MVI   BLOCK+14,C' '                                                    
         LA    RF,BLOCK+15                                                      
*                                                                               
         TM    0(R4),NOBYSEXS      ANY CASH BUYS?                               
         BZ    SHMSG160                                                         
         MVC   0(8,RF),=CL8'IS EMPTY'                                           
         LA    RF,8(RF)                                                         
         B     SHMSG195                                                         
*                                                                               
SHMSG160 BAS   R3,OTHERMSG                                                      
*                                                                               
SHMSG195 MVC   0(8,RF),=C', TRADE '                                             
         MVC   8(8,RF),ORSTORD                                                  
         MVC   16(12,RF),=CL12' ON ITS WAY!'                                    
         LA    RF,29(RF)                                                        
         B     SHWMSG50                                                         
***********************************                                             
* NEITHER ORDER WENT OUT                                                        
***********************************                                             
SHMSG200 MVC   HALF(1),CASHFLG1                                                 
         MVC   HALF+1(1),TRDEFLG1                                               
         NI    HALF,X'FF'-NEVERSNT      DON'T CARE IF EVER SENT                 
         NI    HALF+1,X'FF'-NEVERSNT                                            
         CLC   HALF(1),HALF+1                                                   
         BNE   SHMSG250            SAME PROBLEM FOR BOTH ORDERS                 
         LA    R4,HALF                                                          
         MVC   BLOCK+1(7),=CL7'* CASH '                                         
         MVC   BLOCK+8(8),ORSORD                                                
         MVC   BLOCK+16(9),=CL9' && TRADE '                                     
*                                                                               
         LA    RF,BLOCK+24                                                      
         CLC   ORSTORD,SPACES                                                   
         BNH   SHMSG205                                                         
         LA    RF,1(RF)                                                         
         MVC   0(8,RF),ORSTORD                                                  
         MVI   8(RF),C' '                                                       
         LA    RF,9(RF)                                                         
*                                                                               
SHMSG205 TM    0(R4),NOBYSEXS      ANY CASH BUYS?                               
         BZ    SHMSG210                                                         
         MVC   0(21,RF),=CL21' HAVE NO BUYS TO SEND'                            
         LA    RF,21(RF)                                                        
         B     SHWMSG50                                                         
*                                                                               
SHMSG210 BAS   R3,OTHERMSG                                                      
         B     SHWMSG50                                                         
***********************************                                             
* CASH AND TRADE DO NOT HAVE SAME PROBLEM                                       
***********************************                                             
SHMSG250 MVC   BLOCK+1(8),ORSORD                                                
         MVI   BLOCK+9,C' '                                                     
         LA    RF,BLOCK+10                                                      
         LA    R4,CASHFLG1         START WITH CASH ORDER                        
*                                                                               
SHMSG255 TM    0(R4),NOBYSEXS      ALREADY SENT?                                
         BZ    SHMSG260                                                         
         MVC   0(11,RF),=CL11'HAS NO DATA'                                      
         LA    RF,11(RF)                                                        
         B     SHMSG280                                                         
*                                                                               
SHMSG260 BAS   R3,OTHERMSG                                                      
*                                                                               
SHMSG280 LA    R0,TRDEFLG1                                                      
         CR    R4,R0                                                            
         BE    SHMSG299                                                         
         LA    R4,TRDEFLG1                                                      
*                                                                               
         MVC   0(2,RF),=C', '                                                   
         MVC   2(8,RF),ORSTORD                                                  
         MVC   10(5,RF),=C'(TR) '                                               
         LA    RF,15(RF)                                                        
         B     SHMSG255                                                         
*                                                                               
SHMSG299 B     SHWMSG50                                                         
***********************************                                             
* RECALL SECTION                                                                
***********************************                                             
SHMSG300 DS    0H                                                               
         CLI   ORSXMIT,C'B'        BOTH ORDERS REQUESTED TO BE RECALLED         
         BE    SHMSG400                                                         
*                                                                               
         LA    R4,CASHFLG2                                                      
         MVC   BLOCK+1(14),=CL14'** CASH ORDER '  CASH OR TRADE?                
         MVC   BLOCK+15(8),ORSORD                                               
         CLI   ORSXMIT,C'C'                                                     
         BE    SHMSG310                                                         
         LA    R4,TRDEFLG2                                                      
         MVC   BLOCK+1(14),=CL14'**TRADE ORDER '                                
         MVC   BLOCK+15(8),ORSTORD                                              
*                                                                               
SHMSG310 MVI   BLOCK+23,C' '                                                    
         LA    RF,BLOCK+24                                                      
         TM    0(R4),RCALONIT                                                   
         BZ    SHMSG315                                                         
         MVC   0(17,RF),=CL17'BEING RECALLED!**'                                
         LA    RF,17(RF)                                                        
         B     SHMSG350                                                         
*                                                                               
SHMSG315 TM    0(R4),RCALCANT                                                   
         BZ    SHMSG320                                                         
         MVC   0(18,RF),=CL18'CANNOT BE RECALLED!'                              
         LA    RF,18(RF)                                                        
         B     SHMSG350                                                         
*                                                                               
SHMSG320 TM    0(R4),RCALWOFF                                                   
         BZ    SHMSG325                                                         
         MVC   0(28,RF),=CL28'RECALLING FROM WRONG OFFICE'                      
         LA    RF,28(RF)                                                        
         B     SHMSG350                                                         
*                                                                               
SHMSG325 DS    0H                  JUST IN CASE WE HAVE MORE MESSAGES           
*                                                                               
SHMSG350 MVI   0(RF),0             TERMINATING 0                                
         LA    RF,1(RF)                                                         
         LA    R0,BLOCK+1                                                       
         SR    RF,R0                                                            
         STC   RF,BLOCK                                                         
         LA    R2,ORSMEDH          PLACE CURSOR HERE                            
         B     SHWMSGX             SHOW MESSAGE                                 
***********************************                                             
* BOTH ORDERS WERE REQUESTED TO BE SENT                                         
***********************************                                             
SHMSG400 TM    CASHFLG2,RCALONIT   CASH RECALL ON ITS WAY?                      
         BZ    SHMSG450                                                         
         TM    TRDEFLG2,RCALONIT   TRADE RECALL ON ITS WAY?                     
         BZ    SHMSG410                                                         
* BOTH CASH AND TRADE ARE BEING RECALLED                                        
         MVC   BLOCK+1(7),=CL7'* CASH '                                         
         MVC   BLOCK+8(8),ORSORD                                                
         MVC   BLOCK+16(9),=CL9' && TRADE '                                     
         MVC   BLOCK+25(8),ORSTORD                                              
         MVC   BLOCK+33(23),=CL23' ARE BEING RECALLED! **'                      
         LA    RF,BLOCK+56                                                      
         B     SHMSG350                                                         
***********************************                                             
* CASH IS BEING RECALLED, BUT TRADE ISN'T                                       
***********************************                                             
SHMSG410 MVC   BLOCK+1(8),ORSORD                                                
         MVC   BLOCK+9(16),=CL16' BEING RECALLED!'                              
         MVI   BLOCK+25,C' '                                                    
         MVC   BLOCK+26(8),ORSTORD                                              
         MVC   BLOCK+34(5),=C'(TR) '                                            
         LA    RF,BLOCK+39                                                      
*                                                                               
         LA    R4,TRDEFLG2                                                      
         BAS   R3,OTHERMS2                                                      
         B     SHMSG350                                                         
************************************************                                
* THE CASH RECALL DID NOT GO OUT                                                
************************************************                                
SHMSG450 DS    0H                                                               
         TM    TRDEFLG2,RCALONIT   TRADE RECALL ON ITS WAY?                     
         BZ    SHMSG500                                                         
***********************************                                             
* CASH DIDN'T, BUT TRADE RECALL WENT OUT!                                       
***********************************                                             
         MVC   BLOCK+1(8),ORSORD                                                
         MVI   BLOCK+9,C' '                                                     
         LA    RF,BLOCK+10                                                      
*                                                                               
         LA    R4,CASHFLG2                                                      
         BAS   R3,OTHERMS2                                                      
*                                                                               
         MVI   0(RF),C' '                                                       
         MVC   1(8,RF),ORSTORD                                                  
         MVC   9(5,RF),=C'(TR) '                                                
         MVC   14(16,RF),=CL16' BEING RECALLED!'                                
         LA    RF,30(RF)                                                        
         B     SHMSG350                                                         
***********************************                                             
* NEITHER ORDER WENT OUT                                                        
***********************************                                             
SHMSG500 CLC   CASHFLG2,TRDEFLG2                                                
         BNE   SHMSG550            SAME PROBLEM FOR BOTH ORDERS                 
         LA    R4,CASHFLG2         YES                                          
         MVC   BLOCK+1(7),=CL7'* CASH '                                         
         MVC   BLOCK+8(8),ORSORD                                                
         MVC   BLOCK+16(9),=CL9' && TRADE '                                     
         MVC   BLOCK+25(8),ORSTORD                                              
         MVI   BLOCK+33,C' '                                                    
         LA    RF,BLOCK+34                                                      
*                                                                               
         BAS   R3,OTHERMS2                                                      
         B     SHMSG350                                                         
***********************************                                             
* CASH AND TRADE DO NOT HAVE SAME PROBLEM                                       
***********************************                                             
SHMSG550 MVC   BLOCK+1(8),ORSORD                                                
         MVI   BLOCK+9,C' '                                                     
         LA    RF,BLOCK+10                                                      
         LA    R4,CASHFLG2         START WITH CASH ORDER                        
SHMSG560 BAS   R3,OTHERMS2                                                      
*                                                                               
         LA    R0,TRDEFLG2                                                      
         CR    R4,R0                                                            
         BE    SHMSG599                                                         
         LA    R4,TRDEFLG2                                                      
*                                                                               
         MVC   0(2,RF),=C', '                                                   
         MVC   2(8,RF),ORSTORD                                                  
         MVC   10(5,RF),=C'(TR) '                                               
         LA    RF,15(RF)                                                        
         B     SHMSG560                                                         
*                                                                               
SHMSG599 B     SHMSG350                                                         
*                                                                               
SHWMSGX  B     XIT                                                              
         EJECT                                                                  
***********************************                                             
* THE OTHER MESSAGES FOR 1ST SET OF FLAGS                                       
*                                                                               
* RETURN REGISTER IS (R3)                                                       
***********************************                                             
OTHERMSG DS    0H                                                               
         TM    0(R4),SNTALRDY      ALREADY SENT?                                
         BZ    OTHRMS05                                                         
         MVC   0(12,RF),=CL12'SENT ALREADY'                                     
         LA    RF,12(RF)                                                        
         B     OTHRMSX                                                          
*                                                                               
OTHRMS05 TM    0(R4),ORDUNDRD      UNDARED?                                     
         BZ    OTHRMS10                                                         
         MVC   0(7,RF),=CL7'UNDARED'                                            
         LA    RF,7(RF)                                                         
         B     OTHRMSX                                                          
*                                                                               
OTHRMS10 TM    0(R4),CSNDCONF      CAN'T SEND THIS CONFIRMED ORDER              
         BZ    OTHRMS15                                                         
         MVC   0(20,RF),=CL20'CONFIRMED-CAN''T SEND'                            
         LA    RF,20(RF)                                                        
         B     OTHRMSX                                                          
*                                                                               
OTHRMS15 TM    0(R4),NTDARENV      NOTDARE NOT VALID                            
         BZ    OTHRMS20                                                         
         MVC   0(19,RF),=CL19'CANNOT BE NOTDARE''D'                             
         LA    RF,19(RF)                                                        
         B     OTHRMSX                                                          
*                                                                               
OTHRMS20 TM    0(R4),GOTSMMGS      GOT SOME MAKEGOODS                           
         BZ    OTHRMS25                                                         
         MVC   0(15,RF),=CL15'HAS MAKEGOOD(S)'                                  
         LA    RF,15(RF)                                                        
         B     OTHRMSX                                                          
*                                                                               
OTHRMS25 DS    0H                                                               
*                                                                               
OTHRMSX  BR    R3                                                               
***********************************                                             
* THE OTHER MESSAGES FOR 2ND SET OF FLAGS                                       
*                                                                               
* RETURN REGISTER IS (R3)                                                       
***********************************                                             
OTHERMS2 DS    0H                                                               
         TM    0(R4),RCALCANT                                                   
         BZ    OTHRMS50                                                         
         MVC   0(19,RF),=CL19'CANNOT BE RECALLED!'                              
         LA    RF,19(RF)                                                        
         B     OTHRMS2X                                                         
*                                                                               
OTHRMS50 TM    0(R4),RCALWOFF                                                   
         BZ    OTHRMS60                                                         
         MVC   0(20,RF),=CL20'RECALL-WRONG OFFICE!'                             
         LA    RF,20(RF)                                                        
         B     OTHRMS2X                                                         
*                                                                               
OTHRMS60 DS    0H                                                               
*                                                                               
OTHRMS2X BR    R3                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* REMOVES ANY DARE BATCH RECORDS FOR THE MED/CLT/PRD/EST/STA/PRD2               
***********************************************************************         
DELBATCH NTR1  BASE=*,LABEL=*                                                   
         XC    KEY,KEY                                                          
         LA    R6,KEY              FIND THE APPR DARE BATCH RECORD              
         USING DBTKEY,R6                                                        
         MVI   DBTKTYP,DBTKTYPQ                                                 
         MVI   DBTKSTYP,DBTKSTYQ                                                
         MVC   DBTKAGMD,BAGYMD                                                  
         MVC   DBTKCLT,BCLT                                                     
         MVC   DBTKPRD,SVBPRD                                                   
         MVC   DBTKEST,SVBEST                                                   
         MVC   DBTKMKT,BMKT                                                     
         MVC   DBTKSTA,BSTA                                                     
         MVC   DBTKPRD2,SVBPR2                                                  
         MVI   RDUPDATE,C'N'       TO ELIMINATE DEADLY EMBRACES                 
         GOTO1 HIGH                                                             
         CLC   KEY(L'DBTKEY),KEYSAVE                                            
         BNE   DBTCHX                                                           
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 HIGH                                                             
*                                                                               
DBTCH10  GOTO1 GETREC              DELETE THE BATCH RECORD                      
         L     R6,AIO                                                           
         MVI   ELCODE,DBFLTELQ     GET INFO ELEMENT (X'20')                     
         BAS   RE,GETEL                                                         
         BNE   DBTCH30                                                          
         USING DBFLTELD,R6                                                      
DBTCH23  CLC   DBFLTFLT,SVBFLT     NEEDS TO MATCH THE FLIGHT WE SENT            
         BNE   DBTCH25                                                          
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDER NOW?                       
         BZ    DBTCH24                                                          
         TM    DBFLTFL1,DBFLTTRD   YES, DO WE HAVE A TRADE FLIGHT?              
         BZ    DBTCH25               NO                                         
         B     DBTCH26               YES, MARK IT SENT                          
DBTCH24  TM    DBFLTFL1,DBFLTTRD   NO, DO WE HAVE A TRADE FLIGHT?               
         BZ    DBTCH26               NO, ITS CASH, MARK IT SENT                 
DBTCH25  BAS   RE,NEXTEL                                                        
         BE    DBTCH23                                                          
         B     DBTCH30                                                          
*                                                                               
DBTCH26  OI    DBFLTFL1,DBFLTSNT   MARK THIS FLIGHT AS SENT                     
         B     DBTCHPUT            PUT OUT THE RECORD                           
         DROP  R6                                                               
*                                                                               
DBTCH30  XC    ELEM,ELEM                                                        
         LA    R1,ELEM                                                          
         USING DBFLTELD,R1                                                      
         MVI   DBFLTEL,DBFLTELQ                                                 
         MVI   DBFLTLEN,DBFLTOVH                                                
         MVC   DBFLTFLT,SVBFLT                                                  
         OI    DBFLTFL1,DBFLTDAR+DBFLTSNT                                       
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDER NOW?                       
         BZ    *+8                                                              
         OI    DBFLTFL1,DBFLTTRD                                                
         DROP  R1                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)                                  
DBTCHPUT BRAS  RE,MYPUTREC                                                      
*                                                                               
DBTCHX   B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SET UP THE DARE FIELDS                                                        
***********************************************************************         
SETDARE  NTR1  BASE=*,LABEL=*                                                   
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'GETF',ORSMEDH,,GLVSPMD                              
         GOTO1 (RF),DMCB,,ORSBUYRH,,GLVSPBYR                                    
         GOTO1 (RF),DMCB,,ORSCLTH,,GLVSPCLT                                     
         GOTO1 (RF),DMCB,,ORSPRDH,,GLVDRPRD                                     
         MVI   ORSPRDH+5,3                                                      
         CLC   ORSPRD+3(L'QMED),SPACES                                          
         BNH   SDARE10                                                          
         MVC   QPRD,ORSPRD+3                                                    
         MVI   ORSPRD+3,C'-'                                                    
         MVC   ORSPRD+4(L'QPRD),QPRD                                            
         MVI   ORSPRDH+5,7                                                      
*                                                                               
SDARE10  GOTO1 (RF),DMCB,,ORSESTH,,GLVSPEST                                     
         GOTO1 (RF),DMCB,=C'GETD',BINFLTNM,1,GLVSPEFL                           
         TM    8(R1),GLEGNF        NOT FOUND?                                   
         BNZ   SDARE15             NO FLIGHT INFO                               
         CLI   ORSESTH+5,3         ALREADY HAVE 3 BYTES FOR ESTIMATE?           
         BE    SDARE13                                                          
         CLI   ORSESTH+5,1                                                      
         BNE   SDARE11                                                          
         MVC   ORSEST+2(1),ORSEST                                               
         MVC   ORSEST(2),ZEROS                                                  
         B     SDARE13                                                          
*                                                                               
SDARE11  MVC   ORSEST+2(1),ORSEST+1                                             
         MVC   ORSEST+1(1),ORSEST                                               
         MVI   ORSEST,C'0'                                                      
*                                                                               
SDARE13  MVI   ORSEST+3,C'-'                                                    
         EDIT  (B1,BINFLTNM),(2,ORSEST+4),FILL=0                                
         MVI   ORSESTH+5,6                                                      
         OI    ORSESTH+6,X'80'                                                  
*                                                                               
SDARE15  GOTO1 (RF),DMCB,=C'GETF',ORSSTAH,,GLVSPSTA                             
*                                                                               
         MVC   GLOBMED,ORSMED                                                   
         MVC   GLOBCLT,ORSCLT                                                   
         MVC   GLOBPRD,ORSPRD                                                   
         MVC   GLOBEST,ORSEST                                                   
         MVC   GLOBSTA,ORSSTA                                                   
*                                                                               
SDAREX   B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SPAWNS OUT THE BRAND ORDERS                                                   
***********************************************************************         
SPAWNOUT NTR1  BASE=*,LABEL=*                                                   
         BRAS  RE,FRSTAIRD                                                      
*                                                                               
         OC    PRDSLIST(2),PRDSLIST  AT LEAST ONE ENTRY?                        
         BZ    SPWNX                                                            
*                                                                               
         L     RE,ATIA                                                          
         LH    RF,=Y(TWAMXLEN)                                                  
         L     R0,ATWA                                                          
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
         LA    R2,X'81'            WRITE TWA RECORD #1                          
         GOTO1 GETTWA,DMCB,((R2),ATIA)                                          
*                                                                               
         BAS   RE,WRKRCREA                                                      
*                                                                               
         L     R2,AIO2                                                          
         XC    0(256,R2),0(R2)                                                  
         LA    R2,4(R2)                                                         
         MVC   0(4,R2),=F'2101'                                                 
         MVC   4(6,R2),=C'SCRIPT'                                               
         MVC   10(8,R2),=C'SPVARORD'                                            
         MVI   18(R2),C'I'                                                      
         MVC   30(5,R2),=C'00006'    HEADER LENGTH                              
         MVC   35(5,R2),=C'00100'    INPUT  DATA LENGTH                         
         MVC   40(5,R2),=C'00020'    OUTPUT DATA LENGTH                         
         MVI   45(R2),C'Y'                                                      
         L     R2,AIO2                                                          
         MVC   0(2,R2),=H'50'        46 + 4 BYTES FOR QSAM                      
*                                                                               
         GOTO1 WRKRSEND,DMCB,AIO2                                               
*                                                                               
         L     R2,AIO2                                                          
         XC    0(256,R2),0(R2)                                                  
         LA    R2,4(R2)                                                         
         MVC   0(4,R2),=F'2102'                                                 
         MVC   4(6,R2),=C'000001'                                               
         MVC   10(20,R2),=CL20'SIGN-ON INFORMATION '                            
         MVC   30(8,R2),SVUSERID                                                
         MVC   38(8,R2),=CL8'OM'    SIGN ON TO THE OM PROGRAM                   
*                                                                               
         TM    OMBASFLG,OMFLPSWD   PASSWORD REQUIRED FOR SPOT SYSTEM?           
         BZ    *+10                                                             
         MVC   46(3,R2),=C'DDS'    YES, THEN USE THE EVER USEFUL DDS            
*                                                                               
         CLC   =C'TMNY',SVUSERID   TMNY ID?                                     
         BNE   *+10                                                             
         MVC   46(3,R2),=C'ANN'    YES, DDS PASSWORD DOESN'T WORK               
*                                                                               
         L     R2,AIO2                                                          
         MVC   0(2,R2),=H'58'        54 + 4 BYTES FOR QSAM                      
*                                                                               
         GOTO1 WRKRSEND,DMCB,AIO2                                               
*                                                                               
         MVI   FULL,2                                                           
*                                                                               
         LA    R2,PRDSLIST                                                      
SPWN10   OC    0(2,R2),0(R2)       EMPTY ENTRY?                                 
         BNZ   SPWN15              NOPE                                         
         BAS   RE,WRKRCLOS                                                      
*                                                                               
         LA    R2,1                READ TWA RECORD #1                           
         GOTO1 GETTWA,DMCB,((R2),ATIA)                                          
         L     RE,ATIA                                                          
         LH    RF,=Y(TWAMXLEN)                                                  
         L     R0,ATWA                                                          
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
         B     SPWNX               THEN WE'RE DONE                              
*                                                                               
SPWN15   XC    SVQPR2,SVQPR2                                                    
         CLI   1(R2),0             ANY PIGGYBACK?                               
         BE    SPWN20              NONE                                         
         MVC   BPRD,1(R2)                                                       
         GOTO1 GETQPRD                                                          
         MVC   SVQPR2,QPRD                                                      
SPWN20   MVC   BPRD,0(R2)                                                       
         GOTO1 GETQPRD                                                          
*                                                                               
         BAS   RE,AUTOSCRP                                                      
*                                                                               
         LA    R2,2(R2)            NEXT BRAND ALLOCATION                        
         ZIC   RF,FULL                                                          
         AHI   RF,1                                                             
         STC   RF,FULL                                                          
         B     SPWN10                                                           
*                                                                               
SPWNX    B     XIT                                                              
***********************************************************************         
* THIS GENERATES THE SCRIPT REC IN =NWK SO THAT IT WILL AUTOMATICALLY           
* SEND ORDERS FOR QPRD1,QPRD2                                                   
***********************************************************************         
AUTOSCRP NTR1                                                                   
         L     R2,AIO2                                                          
         XC    0(256,R2),0(R2)                                                  
         LA    R2,4(R2)                                                         
         MVC   0(4,R2),=F'2102'                                                 
         EDIT  (B1,FULL),(6,4(R2)),FILL=0   NTH RECORD IN THIS FILE             
*****    MVC   4(6,R2),=C'000002'                                               
         MVC   10(20,R2),=CL20'SEND OUT THE BRANDS'                             
*                                                                               
         LA    R2,30(R2)                                                        
         USING LAYOUT2D,R2                                                      
         MVC   LAY2MED,QMED                                                     
         MVC   LAY2BYR,QBYR                                                     
*                                                                               
         CLI   PDAROROM,C'Y'                                                    
         BNE   *+10                                                             
         MVC   LAY2MTHD,ORSXMIT                                                 
*                                                                               
         MVC   LAY2CLT,QCLT                                                     
         MVC   LAY2STA(L'QSTA),QSTA                                             
         MVC   LAY2OORD,SPACES      NO POL ORDER NUMBER, SO LEAVE BLANK         
         MVC   LAY2SALP,ORSSALE     SALESPERSON FOR ALL THE ALLOCATIONS         
*                                                                               
         CLI   QMED,C'R'           IF RADIO MUST ADD EXTRA INPUT                
         BNE   ASCRPT10                                                         
         MVC   LAY2RPRF,=C'SP;'                                                 
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         BNE   *+10                                                             
         MVC   LAY2RPRF,=C'PP;'                                                 
         MVC   LAY2RSAL,ORSSALE                                                 
*                                                                               
ASCRPT10 MVC   LAY2PRDS(3),QPRD                                                 
         CLI   SVQPR2,C' '          ANY PIGGYBACK?                              
         BNH   *+14                                                             
         MVI   LAY2PRDS+3,C'-'     YES                                          
         MVC   LAY2PRDS+4(3),SVQPR2                                             
*                                                                               
         MVC   LAY2EST(L'QEST),QEST                                             
         CLI   SVBFLT,0                                                         
         BNH   ASCRPT20                                                         
         MVI   LAY2EST+3,C'-'                                                   
         XR    R1,R1                                                            
         IC    R1,SVBFLT                                                        
         CVD   R1,DUB                                                           
         UNPK  LAY2EST+4(2),DUB                                                 
         OI    LAY2EST+5,X'F0'                                                  
*                                                                               
ASCRPT20 LA    R2,LAY2END                                                       
         DROP  R2                                                               
         L     RE,AIO2                                                          
         SR    R2,RE                                                            
         STH   R2,0(RE)            L'DATA + 4 BYTES FOR QSAM                    
*                                                                               
         GOTO1 WRKRSEND,DMCB,AIO2                                               
*                                                                               
ASCRPX   B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* OPENS A NEW WORKER FILE FOR CREATE                                            
***********************************************************************         
WRKRCREA NTR1                                                                   
         L     R4,AIO2                                                          
         XC    0(256,R4),0(R4)     CLEAR SFH                                    
         USING WLHDRD,R4                                                        
         MVC   WLSOFLAB,=C'*SOFSOF*'                                            
         MVC   WLUSRID,TWAORIG                                                  
         MVC   WLSYSPRG,=C'DAR'                                                 
         MVI   WLDAY,0                                                          
*                                                                               
         MVI   WLCLASS,C'T'        CLASS 'T'                                    
         MVI   WLTYPE,C'A'         TYPE A FOR IMMEDIATE EXECUTION               
         MVI   WLATTB,WLATOBJ      SET OBJECT CODED DATA FLAG                   
         MVC   WLDESC,=CL16' '     FILL IN DESC '$MAD LUIDLUID   '              
         MVC   WLDESC(4),=C'$DAR'                                               
*                                                                               
         GOTO1 GETFACT,DMCB,(X'80',0),F#UTLD                                    
         L     R1,0(R1)                                                         
         USING F@UTLD,R1                                                        
         MVC   WLDESC+5(8),F@TSYM                                               
         DROP  R1                                                               
*                                                                               
* WHEN GETFACTS PASSES F@SAFID=A(FACIDTAB) REMOVE LA FACIDTAB & TABLE           
*                                                                               
         GOTO1 GETFACT,DMCB,(X'80',0),F#SSBD                                    
         L     R1,0(R1)                                                         
         USING F@SSBD,R1                                                        
         ZIC   RE,F@SSYSID         GET FACPAK ID NUMBER                         
         CHI   RE,6                CONVERT FACMEL=6 TO FACTST=1                 
         BNE   *+8                                                              
         LHI   RE,1                                                             
         L     R1,F@SAFID          GET A(FACPAK ID TABLE)                       
         DROP  R1                                                               
         LA    R1,FACIDTAB         POINT TO FACIDTAB IN THIS MODULE             
         MHI   RE,L'FACITAB        INDEX INTO ENTRY                             
         AR    R1,RE                                                            
         MVC   WLSUBPRG,FACISN1-FACITABD(R1) GET ONE CHR FACPAK ID              
*                                                                               
         GOTO1 WRKRSEND,DMCB,AIO2                                               
*                                                                               
         MVC   WRKFILNO,WLREPRNO   EXTRACT FILE NUMBER                          
*                                                                               
WCREAX   B     YES                                                              
         DROP  R4                                                               
         SPACE 2                                                                
***********************************************************************         
* SEND DIRECTLY TO WORKER FILE                                                  
*                                                                               
* ON ENTRY:    PARAM 1             A(RECORD TO BE SENT)                         
***********************************************************************         
WRKRSEND NTR1                                                                   
         L     R4,0(R1)                                                         
*                                                                               
         LA    R3,ELEM             FILL INDEX KEY WITH USER ID                  
         USING UKRECD,R3                                                        
         XC    ELEM,ELEM                                                        
         MVC   UKUSRID,TWAORIG     OF THE AGENCY                                
         DROP  R3                                                               
*                                  CALL DATAMGR TO CREATE FILE                  
         GOTO1 DATAMGR,DMCB,=C'DMPRINT',=C'WRKFILE',(R3),(R4),ATIA              
         CLI   8(R1),0                                                          
         BE    YES                                                              
         DC    H'0'                                                             
         SPACE 2                                                                
***********************************************************************         
* CLOSE THE WORKER FILE                                                         
***********************************************************************         
WRKRCLOS NTR1                                                                   
         L     R4,AIO2                                                          
         USING WLHDRD,R4                                                        
         XC    0(WLSOFEND-WLHDRD,R4),0(R4)                                      
         MVC   WLSOFLAB,=C'*EOFEOF*'                                            
*                                                                               
         GOTO1 WRKRSEND,DMCB,AIO2                                               
*                                                                               
         B     YES                                                              
         DROP  R4                                                               
         LTORG                                                                  
       ++INCLUDE FACIDTAB          NEED FOR SYS NUMBER TO LETTER CONV           
         EJECT                                                                  
***********************************************************************         
* BUILDS THE RECORD TO BE ADDED OR CHANGED                                      
***********************************************************************         
BLDREC   NTR1  BASE=*,LABEL=*                                                   
         MVC   AIO,AIO1            EVERYTHING SHOULD GET BUILT IN AIO1          
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
*                                                                               
         TM    MISCFLG1,MF1RECNF   ADDING THE RECORD?                           
         BZ    BR10                NO INCLUDE FACIDT                            
* EJECT                                                                         
         CLI   ACTNUM,ACTRCALL     ARE WE RECALLING?                            
         BNE   BR05                                                             
         CLI   ORSXMIT,C'C'        CASH WON'T BE A PROBLEM                      
         BE    BR05                                                             
         OC    ORSTORD,ORSTORD     ANY TRADE ORDER?                             
         BNZ   BR05                YES, NOT A PROBLEM                           
         LA    R2,ORSXMITH                                                      
         B     NOTRDRCL            NO TRADE ORDER TO RECALL                     
*                                                                               
BR05     BAS   RE,NXTORDNM         FIND WHAT NEXT ORDER NUMBER IS               
*                                                                               
         L     RE,AIO              CLEAR THE RECORD AREA                        
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,BAGYMD                                                   
         MVC   DOKORDER,BINORDER                                                
         MVC   DOKSTA,BSTA                                                      
         MVC   DORLEN,=Y(DORFRST-DOKEY)                                         
         MVC   DORAGY,AGENCY                                                    
*                                                                               
BR10     MVC   BINORDER,DOKORDER                                                
         LA    R2,FAKEFLDH                                                      
         BRAS  RE,SHWORDER                                                      
         MVC   SVQCORDR,FAKEFLD    SO PR WILL GET CORRECT ORDER #               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT)                        
         DROP  R6                                                               
*                                                                               
         LA    R2,DOIDELEM                                                      
         USING DOIDELD,R2                                                       
         MVC   DOIDBYR,ORSBUYR                                                  
         OC    DOIDBYR,SPACES                                                   
         MVC   DOIDCLT,BCLT                                                     
         MVC   DOIDPRD,SVBPRD                                                   
         MVC   DOIDPRD2,SVBPR2                                                  
         MVC   DOIDEST,SVBEST                                                   
         MVC   DOISTA,BSTA                                                      
         MVC   DOIDFLTN,SVBFLT                                                  
         DROP  R2                                                               
*                                                                               
         XC    SAVEKEY,SAVEKEY     CLEAN OUT THE KEY                            
         LA    R4,SAVEKEY                                                       
         USING DOKEY,R4            OVERLAY KEY WITH OUR TEMPLATE                
         MVI   DCKTYPE,DCKTYPQ                                                  
         MVI   DCKSUBTY,DCKSTYPQ                                                
         MVC   DCKAGMD,BAGYMD                                                   
         MVC   DCKCLT,BCLT                                                      
         MVC   DCKPRD,SVBPRD                                                    
         MVC   DCKPRD2,SVBPR2                                                   
         MVC   DCKEST,SVBEST                                                    
         MVC   DCKSTA,BSTA                                                      
*                                                                               
         TM    MISCFLG1,MF1FLTRC                                                
         BZ    *+10                                                             
         MVC   DCKFLTNM,SVBFLT                                                  
*                                                                               
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         OI    DCKFLAG,DCKFTRDE    LOOK FOR TRADE ORDER NOW                     
         DROP  R4                                                               
*                                                                               
         CLI   PQONLY,C'Y'                                                      
         JE    XIT                                                              
         TM    MISCFLG1,MF1RECNF   ADDING THE RECORD?                           
         BZ    BRCHAO00            NO, CHANGING IT                              
*****                                                                           
* ADDING THE ORDER RECORD                                                       
*****                                                                           
BRADDO00 DS    0H                                                               
         TM    OMBASFL2,OM2DACT    AGNENCY DEACTIVATED?                         
         JNZ   AGYDACT              - YUP, ERROR                                
*                                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),DOIDELEM,(R6)                              
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
*                                                                               
         CLC   =C'!VARORD=',ORSSALE   ANY SPECIFIED ORIGINAL POL ORD #?         
         BNE   BRADD03                                                          
*                                                                               
         ZAP   FULL,JDTTODAY       CENTURY/YEAR FROM TODAY'S DATE               
         SRP   FULL,61,0                                                        
*                                                                               
         GOTO1 HEXIN,DMCB,ORSSALE+8,FAKEFLD,8    IF HEX                         
         MVC   PACKOF4B,FAKEFLD    CONVERT IT TO PACK                           
         OI    PACKOF4B+3,X'0F'                                                 
         SRP   PACKOF4B,58,0       ISOLATE THE YEAR                             
         MVC   PACKOF4B+2(1),FULL+2 COPY TODAY'S CENTURY                        
*                                                                               
         CP    PACKOF4B+3(1),FULL+3(1) LESS 10 YEARS?                           
         BNH   *+10                                                             
         SP    PACKOF4B,=P'10'     YEAR DIGIT>TODAY'S YEAR DIGIT                
*                                                                               
         SP    PACKOF4B,=P'90'     CALCULATE FROM 1990                          
         SRP   PACKOF4B,4,0                                                     
         OC    PACKOF4B+1(2),FAKEFLD   STICK IN DAYS IN YEAR                    
         SRP   PACKOF4B,63,0                                                    
*                                                                               
         ZAP   DUB,PACKOF4B        SAVE DATE PORTION                            
         CVB   R0,DUB                                                           
         LA    RF,DOI2ELEM                                                      
         USING DOI2ELD,RF                                                       
         STCM  R0,3,DOI2OORD                                                    
         XC    DOI2OORD,=X'FFFF'                                                
*                                                                               
         PACK  DUB,ORSSALE+12(4)                                                
         CVB   R1,DUB                                                           
         STH   R1,HALF                                                          
         XC    HALF,=X'FFFF'                                                    
         MVC   DOI2OORD+2(2),HALF                                               
         B     BRADD06                                                          
         DROP  RF                                                               
*                                                                               
BRADD03  CLI   SVBPRD,X'FF'                                                     
         BNE   BRADD08                                                          
BRADD06  GOTO1 RECUP,DMCB,(C'S',AIO),DOI2ELEM,(R6)                              
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
*                                                                               
BRADD08  DS    0H                                                               
         XC    DOSPELEM,DOSPELEM                                                
         LA    R2,DOSPELEM                                                      
         USING DOSPELD,R2                                                       
         MVI   DOSPEL,DOSPELQ                                                   
         MVI   DOSPLEN,DOSPLNQ2    <===  SPECIAL LENGTH                         
         ZAP   DOSPTOTL,=P'0'                                                   
         MVC   DOSPMKT,BMKT                                                     
         GOTO1 DATCON,DMCB,(5,0),(19,DOSPCDAT)                                  
*                                                                               
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    BRADD08A                                                         
         OI    DOSPFLG1,DOSPTRDE   THIS IS THE TRADE ORDER                      
         MVI   DOSPTMTH,TRDESREP     USING SPECIAL REP CODE FOR TRADE           
         B     BRADD09                                                          
*                                                                               
BRADD08A OC    PDARTSRP(3),PDARTSRP ANY SPECIAL REP IN DARE PROFILE?            
         BZ    BRADD09C             NONE                                        
         CLC   PDARTSRP(3),ZEROS                                                
         BE    BRADD09C             NONE                                        
         TM    MISCFLG1,MF1TRDRC                                                
         BZ    BRADD09C                                                         
         MVI   DOSPTMTH,TRDESREP-X'40'  LOWERCASE FOR CASH (X'99')              
*                                                                               
BRADD09  MVC   DOSPTDAT(3),PDARTSRP  SPECIAL REP CODE USED STORED HERE          
*                                                                               
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
BRADD09A TM    MISCFLG4,MF4MOFAX   FAXING OOW FOR MO?                           
         BZ    BRADD09C                                                         
         MVC   DOSPDEST,ORSDEST                                                 
         MVI   DOSPMTHD,C'F'                                                    
         MVI   DOSPIMTH,C'F'                                                    
         B     BRADD09F                                                         
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
BRADD09C CLI   AVNEW,C'P'          IS AVN OPTION ON?                            
         BNE   *+8                 NO                                           
BRADD09F OI    DOSPFLG1,DOSPAVN                                                 
         MVC   DOSPCRTR,TWAORIG    SAVE THE CREATOR OF THE ORDER                
         MVC   DOSPFSTA,BSTA                                                    
         BRAS  RE,ORDPFLAG                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOSPELEM,(R6)                              
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         DROP  R2                                                               
*                                                                               
BRADD010 LA    R2,COLOELEM                                                      
         USING COLOREL,R2                                                       
         XC    COLOELEM,COLOELEM                                                
         MVI   COLEL,COLELQ                                                     
         MVI   COLELLEN,COLLENQ                                                 
         MVI   COLCOL,C'G'                                                      
         MVC   COLDATE,CFFDATE                                                  
         GOTO1 RECUP,DMCB,(C'S',AIO),COLOELEM,(R6)                              
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),0(R6)                                               
         BRAS  RE,MYADDREC         DIRECTORY KEY AUTOMATICALLY ADDED            
*                                                                               
         MVC   KEY+14(4),KEY       SAVE THE DISK ADDRESS                        
         MVC   DISKADDR,KEY                                                     
         LA    R4,KEY              BUILD THE PASSIVE KEY FOR BUYER              
         USING DOKEY,R4                                                         
         XC    DOKEY,DOKEY                                                      
         MVI   DBKTYPE,DBKTYPQ                                                  
         MVI   DBKSUBTY,DBKSTYPQ                                                
         MVC   DBKAGMD,BAGYMD                                                   
         MVC   DBKBYR,ORSBUYR                                                   
         OC    DBKBYR,SPACES                                                    
         MVC   DBKORD,BINORDER                                                  
         MVC   DBKSTA,BSTA                                                      
         GOTO1 ADD                                                              
*                                                                               
         LA    R4,KEY              BUILD THE PASSIVE KEY FOR BYR/STA            
         USING DOKEY,R4                                                         
         XC    DOKEY,DOKEY                                                      
         MVI   DSKTYPE,DSKTYPQ                                                  
         MVI   DSKSUBTY,DSKSTYPQ                                                
         MVC   DSKAGMD,BAGYMD                                                   
         MVC   DSKBYR,ORSBUYR                                                   
         OC    DSKBYR,SPACES                                                    
         MVC   DSKSTA,BSTA                                                      
         MVC   DSKORD,BINORDER                                                  
         GOTO1 ADD                                                              
*                                                                               
         XC    DOKEY,DOKEY         BUILD THE PASSIVE KEY FOR CLIENT             
         MVI   DCKTYPE,DCKTYPQ                                                  
         MVI   DCKSUBTY,DCKSTYPQ                                                
         MVC   DCKAGMD,BAGYMD                                                   
         MVC   DCKCLT,BCLT                                                      
         MVC   DCKPRD,SVBPRD                                                    
         MVC   DCKPRD2,SVBPR2                                                   
         MVC   DCKEST,SVBEST                                                    
         MVC   DCKSTA,BSTA                                                      
*                                                                               
         TM    MISCFLG1,MF1FLTRC                                                
         BZ    *+10                                                             
         MVC   DCKFLTNM,SVBFLT                                                  
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDERS NOW?                      
         BZ    *+8                                                              
         OI    DCKFLAG,DCKFTRDE    TRADE FLAG                                   
*                                                                               
         MVI   RDUPDATE,C'Y'                                                    
         OI    DMINBTS,X'08'       READ FOR DELETED                             
         GOTO1 HIGH                                                             
         NI    DMINBTS,X'FF'-X'08'                                              
         MVC   SAVEKEY,KEY             SAVE ORIGINAL KEY READ                   
         NI    KEY+12,X'FF'-DCKFSCSW   CLEAR THE X'01 SSC FLAG                  
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         MVC   KEY+14(4),DISKADDR                                               
         BNE   BRADDO45                                                         
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         GOTO1 WRITE                                                            
         B     BRADDO50                                                         
*                                                                               
BRADDO45 MVC   KEY(L'DOKEY),KEYSAVE                                             
         GOTO1 ADD                                                              
*                                                                               
BRADDO50 XC    DOKEY,DOKEY         PASSIVE KEY FOR POL ORD/BRAND ORD            
         MVI   DVKTYPE,DVKTYPQ                                                  
         MVI   DVKSUBTY,DVKSTYPQ                                                
         MVC   DVKAGMD,BAGYMD                                                   
         LA    RF,DOI2ELEM                                                      
         USING DOI2ELD,RF                                                       
         OC    DOI2OORD,DOI2OORD                                                
         BZ    BRADDO60                                                         
         MVC   DVKPORD,DOI2OORD    POL   ORDER #                                
         DROP  RF                                                               
         MVC   DVKBORD,BINORDER    BRAND ORDER #                                
         GOTO1 ADD                                                              
*                                                                               
BRADDO60 DS    0H                                                               
         LA    R4,KEY              BUILD THE COLOR PASSIVE KEY                  
         USING DOKEY,R4                                                         
         XC    DOKEY,DOKEY                                                      
         MVI   DSCKTYPE,DSCKTYPQ   X'0D'                                        
         MVI   DSCKSTYP,DSCKSTYQ   X'B8'                                        
         MVC   DSCKAGMD,BAGYMD                                                  
         MVC   DSCKBYR,ORSBUYR                                                  
         OC    DSCKBYR,SPACES                                                   
         MVI   DSCKSTAT,C'G'                                                    
         MVC   DSCKDATE,CFFDATE                                                 
         MVC   DSCKORDR,BINORDER                                                
         GOTO1 ADD                                                              
*                                                                               
         XC    DOKEY,DOKEY         ADD CLT/PRD/EST/MKT/ORD# PASSIVE KEY         
         MVI   DCMKTYPE,DCMKTYPQ   X'0D'                                        
         MVI   DCMKSTYP,DCMKSTYQ   X'BD'                                        
         MVC   DCMKAGMD,BAGYMD                                                  
         MVC   DCMKCLT,BCLT                                                     
         MVC   DCMKPRD,SVBPRD                                                   
         MVC   DCMKEST,SVBEST                                                   
         MVC   DCMKMKT,BMKT                                                     
         MVC   DCMKORDR,BINORDER                                                
         GOTO1 ADD                                                              
*                                                                               
         XC    DOKEY,DOKEY         ADD BYR/CLT/MKT/ORD# PASSIVE KEY             
         MVI   DBCKTYPE,DBCKTYPQ   X'0D'                                        
         MVI   DBCKSTYP,DBCKSTYQ   X'BE'                                        
         MVC   DBCKAGMD,BAGYMD                                                  
         GOTO1 RCPACK,DMCB,(C'P',ORSBUYR),DBCKBYR                               
         MVC   DBCKCLT,BCLT                                                     
         MVC   DBCKMKT,BMKT                                                     
         MVC   DBCKORDR,BINORDER                                                
         GOTO1 ADD                                                              
*                                                                               
         XC    DOKEY,DOKEY         ADD BYR/MKT/CLT/ORD# PASSIVE KEY             
         MVI   DBMKTYPE,DBMKTYPQ   X'0D'                                        
         MVI   DBMKSTYP,DBMKSTYQ   X'BF'                                        
         MVC   DBMKAGMD,BAGYMD                                                  
         GOTO1 RCPACK,DMCB,(C'P',ORSBUYR),DBMKBYR                               
         MVC   DBMKMKT,BMKT                                                     
         MVC   DBMKCLT,BCLT                                                     
         MVC   DBMKORDR,BINORDER                                                
         GOTO1 ADD                                                              
*                                                                               
         XC    KEY,KEY             ADD THE XSPOT PASSIVE KEY                    
         MVI   DODKTYPE,DODKTYPQ   X'0D'                                        
         MVI   DODKSTYP,DODKSTYQ   X'BC'                                        
         MVC   DODKAGMD,BAGYMD     AGENCY MEDIA                                 
         MVC   DODKCLT,BCLT        CLIENT                                       
         MVC   DODKMKT,BMKT        MARKET                                       
         MVC   DODKBYR,ORSBUYR     BUYER                                        
         MVC   DODKEST,SVBEST      ESTIMATE                                     
         MVC   DODKPRD,SVBPRD      PRODUCT                                      
         MVC   DODKORDR,BINORDER   ORDER NUMBER                                 
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(2,DODKDATE)                                   
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    BRADDO65                                                         
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
         GOTO1 DATCON,DMCB,(0,DUB),(2,DODKDATE)                                 
*                                                                               
BRADDO65 TIME  TU                  GET THE TIME IN 38400TH OF A SEC             
         STCM  R0,15,DODKTIME                                                   
         XC    DODKTIME,=X'FFFFFFFF'                                            
*                                                                               
         MVC   KEY+36(4),DISKADDR  DISK ADDRESS                                 
         GOTO1 DATAMGR,DMCB,(0,=C'DMADD'),=C'XSPDIR',KEY                        
*                                                                               
BRADDO70 LA    R2,ORSORDH                                                       
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    *+8                                                              
         LA    R2,ORSTORDH                                                      
         CLI   ORSXMIT,C'T'                                                     
         BNE   *+8                                                              
         LA    R2,ORSTORDH                                                      
         BRAS  RE,SHWORDER         SHOW THE ORDER NUMBER                        
         MVC   SVQCORDR,8(R2)                                                   
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'COMMIT'),0  COMMIT                            
*                                                                               
BRADDOX  B     BR20                                                             
         DROP  R4                                                               
*****                                                                           
* CHANGING THE ORDER RECORD                                                     
*****                                                                           
BRCHAO00 DS    0H                                                               
         L     R6,AIO                    ID ELEMENT CHANGED?                    
         MVI   ELCODE,DOIDELQ                                                   
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING DOIDELD,R6                                                       
         CLC   DOIDBYR,DOIDELEM+DOIDBYR-DOIDELD  BUYER SHOULDN'T CHANGE         
         BE    BRCHAO01                                                         
         LA    R2,ORSBUYRH         ERROR IF NOT                                 
         NI    4(R2),X'FF'-X'20'   UNVALIDATE THIS FIELD                        
         MVI   BLOCK,L'DOIDBYR+1            L'LENGTH + L'MESSAGE                
         MVC   BLOCK+1(L'DOIDBYR),DOIDBYR   MESSAGE                             
         MVI   BLOCK+1+L'DOIDBYR,0          TERMINATING 0                       
         J     BYRALRDY                                                         
*                                                                               
BRCHAO01 MVC   DOIDELEM+DOIDCON-DOIDELD(L'DOIDCON),DOIDCON                      
         CLC   DOIDELEM,0(R6)      SOMETHING CHANGED HERE?                      
         BNE   BRCHAO05            YES                                          
*                                                                               
         TM    MISCFLG3,MF3MSALP   DID WE MANUALLY ENTER A SALESPERSON?         
         BO    BRCHAO05            NO                                           
***                                                                             
* THIS CODE IS TO FIX A SMALL BUG WHERE THE USER WOULD SELECT                   
* SALESPERSON ALLEN KATZ, AND THEN SELECT POINTPERSON ALLEN KATZ                
* THE FLAG NEVER GETS TURNED ON (OR OFF) IN THE SUPPLEMENTARY                   
* ID ELEMENT BECAUSE IT WILL JUST GO TO BRCHAOX AND NOT UPDATE IT               
***                                                                             
BRCHAO04 TM    PFKFLAG,PFKBRW2     WENT TO BROWSE?                              
         BO    BRCHAO05            YES INDEEDIO                                 
*                                                                               
         CLI   ACTNUM,ACTRCALL     NO, IF RECALLING OR NOTDARING LET            
         BE    BRCHAO05              IT PROCEED                                 
         CLI   ACTNUM,ACTNTDAR                                                  
         BNE   BRCHAOX             OTHERWISE NOTHING TO SAVE                    
*                                                                               
BRCHAO05 MVC   OLDSPER,DOIDSPER    SAVE PREVIOUS SALESPERSON                    
*                                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6)                                       
*                                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),DOIDELEM,(R6)                              
*        MVC   DOIDSPER,OLDSPER                                                 
         DROP  R6                                                               
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         L     R6,AIO                    SUPP ELEMENT                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING DOSPELD,R6                                                       
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         TM    MISCFLG4,MF4MOFAX   FAXING OOW FOR MO?                           
         BZ    BRCHAO06                                                         
         MVC   DOSPDEST,ORSDEST                                                 
         MVI   DOSPMTHD,C'F'                                                    
         MVI   DOSPIMTH,C'F'                                                    
         OI    DOSPFLG1,DOSPAVN                                                 
         DROP  R6                                                               
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
BRCHAO06 BRAS  RE,ORDPFLAG         UPDATE PPER FLAG IN ORDER REC                
*                                                                               
***********************************                                             
* SPECIAL CODE FOR RECALL AND NOTDARE                                           
***********************************                                             
         CLI   ACTNUM,ACTRCALL     RECALL OR NOTDARE ACTION?                    
         BE    BRCHAO35                                                         
         CLI   ACTNUM,ACTNTDAR                                                  
         BE    BRCHAO35                                                         
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL?                                
         BNE   BRCHAO99            NO                                           
***********************************                                             
* SPECIAL CODE FOR DDS TERMINALS ONLY                                           
***********************************                                             
BRCHAO20 CLC   =C'UNDARE!@#$%!@#$%!@#$%!@#$',ORSSALE   SPECIAL UNDARE?          
         BE    BRCHAO30                                                         
*                                                                               
         CLI   ORSSALE+24,C'!'     SPECIAL CHARACTER TO BYPASS                  
         BE    BRCHAO25               TST SYSTEM CHECK                          
*                                                                               
         GOTO1 GETFACT,DMCB,0                                                   
         L     RE,DMCB                                                          
         USING FACTSD,RE                                                        
         CLI   FASYSID,1           ALLOW THESE PATCHES TO WORK ONLY             
         BNE   BRCHAO99             ON THE TST SYSTEM                           
         DROP  RE                                                               
*                                                                               
BRCHAO25 CLC   =C'NOTDARE',ORSSALE                                              
         BE    BRCHAO30                                                         
         CLC   =C'APPROVE',ORSSALE                                              
         BE    BRCHAO30                                                         
         CLC   =C'REJECT',ORSSALE                                               
         BE    BRCHAO30                                                         
         CLC   =C'CONFIRM',ORSSALE                                              
         BE    BRCHAO30                                                         
         CLC   =C'UNDARE',ORSSALE                                               
         BNE   BRCHAO99                                                         
*                                                                               
BRCHAO30 DS    0H                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOIDELQ                                                   
         BAS   RE,GETEL                                                         
         USING DOIDELD,R6                                                       
         MVC   DOIDSPER,OLDSPER    KEEP OLD SALESPERSON (DID IT ABOVE!)         
         DROP  R6                                                               
*                                                                               
BRCHAO35 MVI   ELCODE,DOXMTELQ     LOOK FOR FIRST TRANSMISSION ELEM             
         L     R6,AIO                                                           
         BAS   RE,GETEL                                                         
         BE    BRCHAO40            YES                                          
         CLI   ACTNUM,ACTRCALL     NO, ARE WE RECALLING?                        
         BE    BRCHAO71            - YES, SET MESSAGE                           
         B     BRXNO                                                            
*                                                                               
         USING DOXMTELD,R6                                                      
BRCHAO40 CLC   =C'APPROVE',ORSSALE                                              
         BNE   BRCHAO41                                                         
         MVI   DOXMTSTA,QAPP                                                    
         MVI   BYTE,C'R'                                                        
         B     BRCHAO60                                                         
*                                                                               
BRCHAO41 CLC   =C'REJECT',ORSSALE                                               
         BNE   BRCHAO42                                                         
         MVI   DOXMTSTA,QRJCT                                                   
         MVI   BYTE,C'G'                                                        
         B     BRCHAO60                                                         
*                                                                               
BRCHAO42 CLC   =C'CONFIRM',ORSSALE                                              
         BNE   BRCHAO43                                                         
         MVI   DOXMTSTA,QCFMD                                                   
         L     R1,AIO                                                           
         OI    DORSTAT-DOKEY(R1),X'01'     SET CONFIRMED BIT ON                 
         B     BRCHAO45                                                         
*                                                                               
BRCHAO43 CLC   =C'UNDARE',ORSSALE                                               
         BNE   BRCHAO44                                                         
         MVI   DOXMTSTA,QUNDARE                                                 
         B     BRCHAO45                                                         
*                                                                               
BRCHAO44 CLC   =C'NOTDARE',ORSSALE                                              
         BNE   BRCHAO70                                                         
         MVI   DOXMTSTA,QNODARE                                                 
BRCHAO45 MVI   BYTE,C'K'                                                        
*                                                                               
BRCHAO60 GOTOR COLPASKY,DMCB,(BYTE,0)                                           
         XC    DOXMTSTT,DOXMTSTT                                                
         B     BRCHAO90                                                         
*********                                                                       
* RECALL SECTION                                                                
*********                                                                       
BRCHAO70 CLI   ACTNUM,ACTRCALL                                                  
         BNE   BRCHAO80                                                         
*                                                                               
         OC    DOXMTDID,DOXMTDID   NO DESTINATION TO SEND RECALL TO?            
         BZ    BRCHAO73            NONE, ERROR, WAITING FOR DELNOT              
*                                                                               
         CLC   =X'FFFF',DOXMTDID   FAX CAN NOT BE RECALLED                      
         BE    BRCHAO73                                                         
         CLC   =X'FFFD',DOXMTDID   NOR EMAIL                                    
         BE    BRCHAO73                                                         
*                                                                               
         OC    ORSOORD,ORSOORD                                                  
         BZ    BRCHAO72                                                         
BRCHAO71 TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG2,RCALCANT     CASH ORDER CANNOT BE RECALLED              
         B     BRXNO                                                            
         OI    TRDEFLG2,RCALCANT     TRADE ORDER CANNOT BE RECALLED             
         B     BRXNO                                                            
*                                                                               
BRCHAO72 OC    DOXMTSTD,DOXMTSTD   IF NO STATUS                                 
         BZ    BRCHAO74            THEN OKAY TO RECALL                          
*                                                                               
         CLI   DOXMTSTA,QAPP       IF ONLY APPROVED                             
         BE    *+12                THEN OKAY TO RECALL                          
BRCHAO73 LA    R2,CONACTH          CAN'T RECALL                                 
         B     BRCHAO71                                                         
*                                                                               
BRCHAO74 CLI   PFKEY,6             TRANSMITTING THE RECALL?                     
         BNE   BRCHAO99                                                         
         B     BRCHAO95            THEN WE CAN DELETE THE ERRORS                
*********                                                                       
* NOTDARE SECTION                                                               
*********                                                                       
BRCHAO80 CLI   ACTNUM,ACTNTDAR     TRYING TO NOTDARE?                           
         BNE   BRCHAO90                                                         
*                                                                               
         LR    R0,R6               IS THIS ORDER A REVISION?                    
         SR    RE,RE                                                            
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)                                             
*                                                                               
BRCHAO81 CLI   0(R6),0                                                          
         BE    BRCHAO82                                                         
         CLI   0(R6),DOSPELQ                                                    
         BE    *+14                                                             
         IC    RE,1(R6)                                                         
         AR    R6,RE                                                            
         B     BRCHAO81                                                         
*                                                                               
         USING DOSPELD,R6                                                       
         CLI   DOSPREVN,0                                                       
         BE    BRCHAO82            NO                                           
         J     NONOTDAR            NOTDARE IS INVALID FOR REVISED ORDER         
BRCHAO82 LR    R6,R0                                                            
*                                                                               
         USING DOXMTELD,R6                                                      
         CLI   DOXMTSTA,QRJCT      TRYING TO NOTDARE A REJECTED ORDER?          
         BE    BRCHAO83                                                         
         CLI   DOXMTSTA,QRCLAPPR     OR RECALL WITH APPROVED?                   
         BE    BRCHAO83                                                         
         CLI   DOXMTSTA,QRCLDELN     OR RECALL WITH DELIVERED?                  
         BE    BRCHAO83                                                         
         CLI   DOXMTSTA,QRCLREJD     OR RECALL WITH REJECTED?                   
         BE    BRCHAO83                                                         
         CLI   DOXMTSTA,QRCLTRNS     OR RECALL WITH REP TRANSMITTED?            
         BE    BRCHAO83            YES                                          
         LA    R2,CONACTH          HAS TO BE REJECTED FIRST BY REP              
         B     NEEDRJCT                                                         
         DROP  R6                                                               
*                                                                               
BRCHAO83 CLI   PFKEY,6             TRANSMITTING THE NOTDARE?                    
         BNE   BRCHAO99                                                         
         B     BRCHAO95            THEN WE CAN DELETE THE ERRORS                
*                                                                               
         USING DOXMTELD,R6                                                      
BRCHAO90 ICM   R1,15,JDTTODAY                                                   
         SRL   R1,4                                                             
         STCM  R1,7,DOXMTSTD                                                    
*                                                                               
BRCHAO95 MVI   ELCODE,DOCOMELQ     REMOVE ALL ERROR ELEMENTS IN ORDER           
         L     R6,AIO                                                           
         BAS   RE,GETEL                                                         
         BNE   BRCHAO99                                                         
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6)                                       
         B     BRCHAO95            <==== LOOP FOR ERRORS,NOT BRCHAO90           
*                                                                               
BRCHAO99 CLI   ACTNUM,ACTNTDAR     FOR ACTION NOT DARE                          
         BE    BRCHAOX             PUT REC CALLED LATER IN PRNODARE             
         CLI   ACTNUM,ACTRCALL               ARE WE RECALLING?                  
         BE    BRCHAOX                                                          
         L     R6,AIO              ORDER IN AIO1                                
         XC    KEY,KEY                                                          
         MVC   KEY(13),0(R6)       TO KEEP FROM OVERWRITING LSTM RECORD         
         GOTO1 HIGH                                                             
         MVC   AIO,AIO3                                                         
         GOTO1 GETREC                                                           
         MVC   AIO,AIO1                                                         
         BRAS  RE,MYPUTREC                                                      
*                                                                               
BRCHAOX  DS    0H                                                               
***************                                                                 
* BUILD AGENCY COMMENT RECORD                                                   
***************                                                                 
BR20     L     RE,AIO              CLEAR THE RECORD AREA                        
         LA    RF,2000                                                          
         XCEFL                                                                  
*                                                                               
         CLC   =C'Rep Comments',ORSCOMH    IF WE HAVE REP COMMENTS OUT          
         BE    BRXYES                      THEN DON'T CHANGE COMMENTS           
         TM    MISCFLG1,MF1DRTRD   HANDLING TRADE NOW?                          
         BZ    *+12                NO                                           
         CLI   ORSXMIT,C'B'        BOTH CASH & TRADE ORDERS                     
         BE    BRXYES              YES, TRADE COMMENTS DON'T APPEAR             
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,BAGYMD                                                   
         MVC   DOKORDER,BINORDER                                                
         MVC   DOKSTA,BSTA                                                      
         MVI   DOKCMT,X'01'                                                     
         MVC   DORLEN,=Y(DORFRST-DOKEY)                                         
         MVC   DORAGY,AGENCY                                                    
*                                                                               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT)                        
         DROP  R6                                                               
*                                                                               
         CLI   CALLSP,0            DID WE PFKEY TO HERE?                        
         BE    BR25                                                             
         CLI   CALLSTCK,X'EA'      DID WE COME FROM MARKET/LIST?                
         BNE   BR25                                                             
         L     RF,ACOMFACS         YES, DID IT PASS A STANDARD COMMENT?         
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'GETF',ORSSTD1H,,GLVBUY1   USE IT IF IT DID          
         OI    ORSSTD1H+6,X'80'                                                 
         CLI   8(R1),GLEGNF                                                     
         BE    BR23                                                             
*                                                                               
         GOTO1 (RF),DMCB,=C'DELE',,,GLVBUY1     REMOVE IT                       
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                CAN'T HANDLE OTHER ERRORS                    
*                                                                               
BR23     GOTO1 (RF),DMCB,=C'GETF',ORSCOM1H,,GLVSMSG   USE IT IF IT DID          
         OI    ORSCOM1H+6,X'80'                                                 
         CLI   8(R1),GLEGNF                                                     
         BE    BR25                                                             
*                                                                               
         GOTO1 (RF),DMCB,=C'DELE',,,GLVSMSG     REMOVE IT                       
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                CAN'T HANDLE OTHER ERRORS                    
*                                                                               
BR25     LA    R2,ORSCOM1H                                                      
BR30     LA    R0,ORSCOM9H                                                      
         CR    R2,R0                                                            
         BH    BR40                                                             
*                                                                               
         CLI   5(R2),0                                                          
         BE    BR35                                                             
*                                                                               
         LR    R1,R2               CALCULATE LINE NUMBER OF COMMENT             
         LA    R0,ORSCOM1H                                                      
         SR    R1,R0                                                            
         SR    R0,R0                                                            
         D     R0,=A(ORSCOM2H-ORSCOM1H)                                         
         LA    R1,1(R1)                                                         
*                                                                               
         LA    R3,ELEM                                                          
         XC    ELEM,ELEM                                                        
         USING DOCOMELD,R3                                                      
         MVI   DOCOMEL,DOCOMELQ                                                 
         STC   R1,DOCOMLIN         STORE THE LINE NUMBER                        
         ZIC   R1,5(R2)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   DOCOMTXT(0),8(R2)                                                
         LA    R1,1+DOCOMOVH(R1)                                                
         STC   R1,DOCOMLEN             LENGTH OF THE ELEMENT                    
         DROP  R3                                                               
*                                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)                                  
*                                                                               
         ZIC   R0,ELEM+1           CALCULATE NEXT INSERTION ADDRESS             
         AR    R6,R0                                                            
*                                                                               
BR35     AH    R2,=Y(ORSCOM2H-ORSCOM1H)                                         
         B     BR30                                                             
*                                                                               
BR40     TM    MISCFLG1,MF1RECNF   NEW RECORD?                                  
         BZ    BRCHAC00                                                         
***************                                                                 
* ADD COMMENT RECORD                                                            
***************                                                                 
BRADDC00 L     R6,AIO              SEE IF ANY COMMENTS                          
         USING DOKEY,R6                                                         
         CLC   DORLEN,=Y(DORFRST-DOKEY)                                         
         BE    BRADDCX             NONE, NOTHING TO ADD HERE                    
         DROP  R6                                                               
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),0(R6)                                               
         BRAS  RE,MYADDREC         DIRECTORY KEY AUTOMATICALLY ADDED            
*                                                                               
BRADDCX  B     BR50                                                             
***************                                                                 
* CHANGE COMMENT RECORD                                                         
***************                                                                 
BRCHAC00 DS    0H                  CHECK IF WE HAD A COMMENT REC BEFORE         
         L     R6,AIO                                                           
BRCHACD1 USING DOKEY,R6            R6 = A(OUR PROPOSED COMMENT RECORD)          
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),0(R6)                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE    COMMENT RECORD EXISTED BEFORE?           
         BNE   BRADDC00                NO, SEE IF WE NEED TO ADD                
*                                                                               
         MVC   AIO,AIO2                YES                                      
         GOTO1 GETREC                                                           
         L     R2,AIO              R2 = A(COMMENT RECORD ON FILE)               
BRCHACD2 USING DOKEY,R2                                                         
         MVC   AIO,AIO1                YES                                      
*                                                                               
         CLC   BRCHACD1.DORLEN,BRCHACD2.DORLEN                                  
         BNE   BRCHAC10            COMMENT RECORD DIFFERS IN LENGTH             
*                                                                               
         LR    R0,R6               COMMENTS WEREN'T CHANGED?                    
         ZICM  R1,BRCHACD1.DORLEN,2                                             
         LR    RE,R2                                                            
         LR    RF,R1                                                            
         CLCL  R0,RE                                                            
         BE    BRCHACX             NOTHING CHANGED                              
         DROP  BRCHACD1,BRCHACD2                                                
*                                                                               
BRCHAC10 BRAS  RE,MYPUTREC         SOMETHING WAS CHANGED                        
*                                                                               
BRCHACX  DS    0H                                                               
***************                                                                 
* DONE WITH THE COMMENTS                                                        
***************                                                                 
BR50     MVC   AIO,AIO2                                                         
         BRAS  RE,CMTBATCH         HANDLE THE BATCH RECORD COMMENT              
         MVC   AIO,AIO1                                                         
***************                                                                 
* DONE BUILDING THE RECORD                                                      
***************                                                                 
BRXYES   SR    RC,RC                                                            
BRXNO    LTR   RC,RC                                                            
         B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* CALCULATES WHAT THE NEXT ORDER NUMBER SHOULD BE                               
*                                                                               
* ON EXIT:     BINORDER            WHAT NEXT ORDER NUMBER WILL BE               
***********************************************************************         
NXTORDNM NTR1                                                                   
         XC    KEY,KEY             SET UP THE KEY                               
         LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,BAGYMD                                                   
*                                                                               
         CLI   POMUSENW,C'Y'       USING NEW ORDER NUMBERS?                     
         BE    NXTORD20            YES                                          
*                                                                               
         MVC   FULL,JDTTODAY       COPY TODAY'S JULIAN DATE                     
         XC    BINORDER,BINORDER                                                
*                                                                               
         ZAP   DUB,FULL            DIVIDE JULIAN DATE BY 1000 TO                
         SRP   DUB,61,0                ISOLATE THE CENTURY AND THE YEAR         
*                                                                               
         SP    DUB,=P'090'         CALCULATE NUMBER OF YEARS FROM 1990          
*                                                                               
         SRP   DUB,3,0             MULTIPLY BY 1000                             
         AP    DUB,FULL+2(2)       ADD NUMBER OF DAYS INTO THAT YEAR            
*                                                                               
         CVB   R0,DUB              CONVERT TO BINARY                            
         STCM  R0,3,BINORDDT                                                    
         XC    BINORDDT,=X'FFFF'                                                
*                                                                               
         MVC   DOKORDDT,BINORDDT                                                
*********                                                                       
* READ FOR UPDATE SO WE DON'T GET TWO ORDERS WITH THE SAME ORDER #              
*********                                                                       
         OI    DMINBTS,X'88'       ALSO READ FOR DELETE AS IT MIGHT BE          
         GOTO1 HIGH                WE DON'T WANT TO REUSE AN ORD #              
         NI    DMINBTS,X'FF'-X'88'                                              
*                                                                               
         CLC   KEY(DOKORDSQ-DOKEY),KEYSAVE    SAME DATE?                        
         BE    *+14                                                             
         MVC   BINORDSQ,=X'FFFF'                                                
         B     NXTORDX                                                          
*                                                                               
         ZICM  R0,DOKORDSQ,2                                                    
         LTR   R0,R0                                                            
         BNZ   *+6                                                              
         DC    H'0'                NO MORE SEQUENCE NUMBERS AVAILABLE           
         SHI   R0,1                                                             
         CHI   R0,-9999                                                         
         BNL   *+6                                                              
         DC    H'0'                                                             
         STCM  R0,3,BINORDSQ                                                    
         B     NXTORDX                                                          
*********                                                                       
* NEW ORDER NUMBERS SCHEME IS 04000000 (X'80000000') AND INCREMENTS             
*********                                                                       
NXTORD20 OI    DMINBTS,X'88'       ALSO READ FOR DELETE AS IT MIGHT BE          
         GOTO1 HIGH                WE DON'T WANT TO REUSE AN ORD #              
         NI    DMINBTS,X'FF'-X'88'                                              
*                                                                               
         CLC   KEY(DOKORDER-DOKEY),KEYSAVE    SAME AGY/MED?                     
         BNE   NXTORD70                       NOTHING FOR AGY/MED               
         CLC   DOKORDER,=X'7FFFFFFF'  WE HAVE OLD STYLE NUMBER?                 
         BH    NXTORD70               YES, AGY STARTS WITH 04000000             
         ICM   R0,15,DOKORDER                                                   
         SHI   R0,1                                                             
         STCM  R0,15,BINORDER                                                   
         B     NXTORDX                                                          
*                                                                               
NXTORD70 MVC   BINORDER,=X'7FFFFFFF'  BINORDER IS XC'D WITH EFFS                
*                                                                               
NXTORDX  B     XIT                                                              
         DROP  R4                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAYS THE OCOM LEVELS                                                      
***********************************************************************         
SHWOCOMS NTR1  BASE=*,LABEL=*                                                   
         XC    ORSOCMS,ORSOCMS                                                  
         OI    ORSOCMSH+6,X'80'                                                 
*                                                                               
         LA    R2,ORSOCMS                                                       
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING OM$COMKEY,R6                                                     
         MVC   OM$COMKTYPE,=X'0D0C'   OCOM TYPE                                 
         MVC   OM$COMKAGY,BAGYMD                                                
         MVI   OM$COMCTYPE,C'O'       OCOM RECORDS                              
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM CLIENT LEVEL?                    
         BNE   *+14                                                             
         MVC   0(3,R2),=C'MED'                                                  
         LA    R2,4(R2)                                                         
*                                                                               
         MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKCLT,BCLT                                                  
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM CLIENT LEVEL?                    
         BNE   *+14                                                             
         MVC   0(3,R2),=C'CLT'                                                  
         LA    R2,4(R2)                                                         
*                                                                               
         MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKPRD+2(1),BPRD                                             
         CLI   BPRD,X'FF'          IF PRODUCT IS POL                            
         BNE   *+10                                                             
         MVC   OM$COMKPRD,=C'POL'  THEN USE CHARACTER REPRESENTATION            
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM PRD LEVEL?                       
         BNE   *+14                                                             
         MVC   0(3,R2),=C'PRD'                                                  
         LA    R2,4(R2)                                                         
*                                                                               
         MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKEST(1),BEST                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM EST LEVEL?                       
         BNE   *+14                                                             
         MVC   0(3,R2),=C'EST'         YES                                      
         B     SOCOM10                                                          
*                                                                               
         MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKPRD,=C'ALL'      NO, TRY WITH PRODUCT  'ALL'              
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM EST LEVEL WITH PRD  ALL?         
         BNE   *+14                                                             
         MVC   0(3,R2),=C'EST'         YES                                      
         B     SOCOM10                                                          
*                                                                               
SOCOM10  CLI   SVBFLT,0            ANY FLIGHT?                                  
         BE    SOCOMSX             NONE, DON'T BOTHER                           
         MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKFLT(1),SVBFLT                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM PRD LEVEL?                       
         BNE   *+10                                                             
         MVC   0(3,R2),=C'FLT'                                                  
         DROP  R6                                                               
*                                                                               
SOCOMSX  B     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAYS THE AGENCY COMMENTS                                                  
***********************************************************************         
SHWCMNTS NTR1  BASE=*,LABEL=*                                                   
         MVC   AIO,AIO2                                                         
         MVC   ORSCOMH(14),=CL14'Order Comments'                                
         OI    ORSCOMHH+6,X'80'                                                 
*                                                                               
         LA    R2,ORSCOM1H                                                      
SCMNTS10 LA    R0,ORSCOM9H                                                      
         CR    R2,R0                                                            
         BH    SCMNTS20                                                         
         XC    8(L'ORSCOM1,R2),8(R2)   CLEAR THIS COMMENT LINE                  
         OI    6(R2),X'80'                                                      
         NI    1(R2),X'FF'-X'20'-X'0C'   UNPROTECTED & NORMAL INTENSITY         
         ZIC   R0,0(R2)                                                         
         AR    R2,R0                                                            
         B     SCMNTS10                                                         
*                                                                               
SCMNTS20 XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,BAGYMD                                                   
         MVC   DOKORDER,BINORDER                                                
         MVC   DOKSTA,BSTA                                                      
         MVI   DOKCMT,X'01'        LOOK UP AGENCY COMMENT RECORD                
         DROP  R4                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   SCMNTSX                                                          
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOCOMELQ                                                  
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
SCMNTS30 BAS   RE,NEXTEL                                                        
         BNE   SCMNTSX                                                          
*                                                                               
         USING DOCOMELD,R6                                                      
         ZIC   R1,DOCOMLIN                                                      
         BCTR  R1,0                                                             
         MH    R1,=Y(ORSCOM2H-ORSCOM1H)                                         
         LA    R2,ORSCOM1H                                                      
         AR    R2,R1                                                            
         ZIC   R1,DOCOMLEN                                                      
         SH    R1,=Y(DOCOMOVH+1)                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),DOCOMTXT                                                 
         AHI   R1,1                                                             
         STC   R1,5(R2)                                                         
         OI    6(R2),X'80'                                                      
         B     SCMNTS30                                                         
         DROP  R6                                                               
*                                                                               
SCMNTSX  MVC   AIO,AIO1                                                         
         LA    R1,ORSPFLN+54                                                    
         CLI   ORSMED,C'R'         MEDIA = R?                                   
         BNE   *+8                 NOPE                                         
         LA    R1,ORSPFLN+60                                                    
*                                                                               
         CLI   ACTNUM,ACTRCALL     ACTION RECALL?                               
         BNE   *+8                                                              
         AHI   R1,-9                                                            
*                                                                               
         MVC   0(3,R1),=C'Rep'                                                  
         OI    ORSPFLNH+6,X'80'    TRANSMIT                                     
*                                                                               
         MVI   RCOMLINE,0          NO PREVIOUS LINE FOR NEXT TIME               
         OI    BITFLAG2,BF2SHOWR   SHOW REP COMMENTS                            
         B     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAYS THE REP COMMENTS                                                     
***********************************************************************         
SHWRCMNT NTR1  BASE=*,LABEL=*                                                   
         MVC   AIO,AIO2                                                         
         MVC   ORSCOMH(14),=CL14'Rep Comments'                                  
         OI    ORSCOMHH+6,X'80'                                                 
*                                                                               
         LA    R2,ORSCOM1H                                                      
SRCMNT10 LA    R0,ORSCOM9H                                                      
         CR    R2,R0                                                            
         BH    SRCMNT20                                                         
         XC    8(L'ORSCOM1,R2),8(R2)   CLEAR THIS COMMENT LINE                  
         OI    6(R2),X'80'                                                      
         OI    1(R2),X'20'+X'08'   PROTECTED AND HIGH INTENSITY                 
         ZIC   R0,0(R2)                                                         
         AR    R2,R0                                                            
         B     SRCMNT10                                                         
*                                                                               
SRCMNT20 XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,BAGYMD                                                   
         MVC   DOKORDER,BINORDER                                                
         MVC   DOKSTA,BSTA                                                      
         MVI   DOKCMT,X'02'        LOOK UP REP COMMENT RECORD                   
         DROP  R4                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   SRCMNT40                                                         
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         LA    R2,ORSCOM1H                                                      
         L     R6,AIO                                                           
         MVI   ELCODE,DOCOMELQ                                                  
         BAS   RE,GETEL                                                         
         B     *+8                                                              
*                                                                               
SRCMNT30 BAS   RE,NEXTEL                                                        
         BE    SRCMNT60                                                         
*                                                                               
SRCMNT40 LA    R1,ORSPFLN+54                                                    
         CLI   ORSMED,C'R'         MEDIA = R?                                   
         BNE   *+8                 NOPE                                         
         LA    R1,ORSPFLN+60                                                    
*                                                                               
         CLI   ACTNUM,ACTRCALL     ACTION RECALL?                               
         BNE   *+8                                                              
         AHI   R1,-9                                                            
         MVC   0(3,R1),=C'Byr'                                                  
         OI    ORSPFLNH+6,X'80'    TRANSMIT                                     
*                                                                               
SRCMNT50 MVI   RCOMLINE,0          NO PREVIOUS LINE FOR NEXT TIME               
         NI    BITFLAG2,X'FF'-BF2SHOWR                                          
         B     SRCMNTX                                                          
*                                                                               
         USING DOCOMELD,R6                                                      
SRCMNT60 CLI   RCOMLINE,0          ANY PREVIOUS LINE TO CHECK FOR?              
         BE    SRCMNT70                                                         
         CLC   RCOMLINE,DOCOMLIN                                                
         BNE   SRCMNT30                                                         
         MVI   RCOMLINE,0          NO PREVIOUS LINE FOR NEXT TIME               
*                                                                               
SRCMNT70 LA    R0,ORSCOM9H         ANYMORE LINES LEFT ON SCREEN?                
         CR    R2,R0                                                            
         BL    *+14                YES                                          
         MVC   ORSCOM9(50),=C'** MORE REP COMMENTS.  PRESS PF11 FOR NEXX        
               T PAGE **'                                                       
         B     SRCMNT80            NO                                           
*                                                                               
         ZIC   R1,DOCOMLEN                                                      
         SH    R1,=Y(DOCOMOVH+1)                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),DOCOMTXT                                                 
         OI    6(R2),X'80'                                                      
*                                                                               
         ZIC   R0,0(R2)            BUMP TO NEXT LINE AND NEXT COMMENT           
         AR    R2,R0                                                            
         B     SRCMNT30                                                         
*                                                                               
SRCMNT80 MVC   RCOMLINE,DOCOMLIN                                                
         OI    BITFLAG2,BF2SHOWR   SHOW MORE REP COMMENTS                       
         DROP  R6                                                               
*                                                                               
SRCMNTX  MVC   AIO,AIO1                                                         
         B     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* NOW THAT THE ORDER IS ADDED, WE WILL USE THE COMMENT IN THE ORDER FOR         
* THE BATCH RECORD                                                              
***********************************************************************         
CMTBATCH NTR1  BASE=*,LABEL=*                                                   
         MVI   SVFLTFLG,0                                                       
         XC    KEY,KEY                                                          
         LA    R6,KEY              FIND THE APPR DARE BATCH RECORD              
         USING DBTKEY,R6                                                        
         MVI   DBTKTYP,DBTKTYPQ                                                 
         MVI   DBTKSTYP,DBTKSTYQ                                                
         MVC   DBTKAGMD,BAGYMD                                                  
         MVC   DBTKCLT,BCLT                                                     
         MVC   DBTKPRD,SVBPRD                                                   
         MVC   DBTKEST,SVBEST                                                   
         MVC   DBTKMKT,BMKT                                                     
         MVC   DBTKSTA,BSTA                                                     
         MVC   DBTKPRD2,SVBPR2                                                  
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'DBTKEY),KEYSAVE                                            
         BNE   CBTCHX                                                           
*                                                                               
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         MVI   ELCODE,DBFLTELQ                                                  
         BAS   RE,GETEL                                                         
         BNE   CBTCH30                                                          
         USING DBFLTELD,R6                                                      
CBTCH10  CLC   DBFLTFLT,SVBFLT                                                  
         BNE   CBTCH15                                                          
         TM    MISCFLG1,MF1DRTRD      DOING TRADE ORDER NOW?                    
         BZ    CBTCH14                                                          
         TM    DBFLTFL1,DBFLTTRD                                                
         BO    CBTCH20                                                          
         B     CBTCH15                                                          
CBTCH14  TM    DBFLTFL1,DBFLTTRD                                                
         BZ    CBTCH20                                                          
CBTCH15  BAS   RE,NEXTEL                                                        
         BE    CBTCH10                                                          
         B     CBTCH30                                                          
*                                                                               
CBTCH20  MVC   SVFLTFLG,DBFLTFL1   COPY FOR COMPARE!                            
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
         TM    MISCFLG4,MF4MOFAX   FAXING OOW TO MO?                            
         BZ    *+8                                                              
         OI    DBFLTFL1,DBFLTPRV   FORCE FAX!                                   
*&&                                                                             
         TM    DBFLTFL1,DBFLTDAR   ALREADY LINKED?                              
         BZ    CBTCH25             YES, NOTHING TO CHANGE                       
         CLC   SVFLTFLG,DBFLTFL1                                                
         BE    CBTCHX                                                           
CBTCH25  MVC   SVFLTFLG,DBFLTFL1   KEEP THE CHANGES!                            
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)                                  
         DROP  R6                                                               
*                                                                               
CBTCH30  XC    ELEM,ELEM           NEED A FLIGHT ELEMENT NOW!                   
         LA    R1,ELEM                                                          
         USING DBFLTELD,R1                                                      
         MVI   DBFLTEL,DBFLTELQ                                                 
         MVI   DBFLTLEN,DBFLTOVH                                                
         MVC   DBFLTFLT,SVBFLT                                                  
         MVC   DBFLTFL1,SVFLTFLG   SAVE P/N FLAGS MARKET/LIST MAY SET           
         OI    DBFLTFL1,DBFLTDAR                                                
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDER NOW?                       
         BZ    *+8                                                              
         OI    DBFLTFL1,DBFLTTRD                                                
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
         TM    MISCFLG4,MF4MOFAX                                                
         BO    CBTCH35                                                          
* ADDED CODE FOR FAXING OOW TO MO  HWON 01/20/04                                
*&&                                                                             
         CLI   PDARPORN,C'Y'       REQUIRES PREV/NEW??                          
         BNE   CBTCH40                                                          
         CLI   AVNEW,C'P'          IS AVN OPTION ON?                            
         BNE   *+12                NO                                           
CBTCH35  OI    DBFLTFL1,DBFLTPRV   MARK AS PREV                                 
         B     CBTCH40                                                          
         OI    DBFLTFL1,DBFLTNEW   MARK AS NEW                                  
         DROP  R1                                                               
CBTCH40  GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)                                  
*                                                                               
CBTCH50  BRAS  RE,MYPUTREC                                                      
*                                                                               
CBTCHX   J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* GET THE FLIGHT RECORD                                                         
*                                                                               
* ON EXIT:     MISCFLG1.MF1FLTRC   1 = FLIGHT EXISTS FOR THE EST                
*                                  0 = NO FLIGHT RECORD EXISTS                  
***********************************************************************         
GETFLTRC NTR1  BASE=*,LABEL=*                                                   
         NI    MISCFLG1,X'FF'-MF1FLTRC  DIDN'T GET A FLIGHT REC YET             
*                                                                               
         XC    KEY,KEY             SEE IF WE HAVE THE FLIGHT REC USING          
         LA    R4,KEY                 POL ON THE ESTIMATE                       
         USING DFLRECD,R4                                                       
         MVI   DFLKTYP,DFLKTYPQ                                                 
         MVI   DFLKSUB,DFLKSUBQ                                                 
         MVC   DFLKAGMD,BAGYMD                                                  
         MVC   DFLKCLT,BCLT                                                     
         MVC   DFLKPRD,=C'POL'                                                  
         MVC   DFLKEST,BEST                                                     
         DROP  R4                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'DFLKEY),KEYSAVE    FLIGHT REC EXISTS FOR POL EST?          
         BE    GFLTRC10                 YES                                     
*                                                                               
         XC    KEY,KEY             SEE IF WE HAVE THE FLIGHT REC USING          
         LA    R4,KEY                 PRIMARY PRODUCT ON THE ESTIMATE           
         USING DFLRECD,R4                                                       
         MVI   DFLKTYP,DFLKTYPQ                                                 
         MVI   DFLKSUB,DFLKSUBQ                                                 
         MVC   DFLKAGMD,BAGYMD                                                  
         MVC   DFLKCLT,BCLT                                                     
         MVC   DFLKPRD,QPRD                                                     
         MVC   DFLKEST,BEST                                                     
         DROP  R4                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'DFLKEY),KEYSAVE    FLIGHT REC EXISTS FOR PRD/EST?          
         BE    GFLTRC10                 YES                                     
*                                                                               
         XC    KEY,KEY             SEE IF WE HAVE THE FLIGHT REC FOR            
         LA    R4,KEY                 'ALL' PRODUCTS ON THIS ESTIMATE           
         USING DFLRECD,R4                                                       
         MVI   DFLKTYP,DFLKTYPQ                                                 
         MVI   DFLKSUB,DFLKSUBQ                                                 
         MVC   DFLKAGMD,BAGYMD                                                  
         MVC   DFLKCLT,BCLT                                                     
         MVC   DFLKPRD,=C'ALL'                                                  
         MVC   DFLKEST,BEST                                                     
         DROP  R4                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'DFLKEY),KEYSAVE    FLIGHT REC EXISTS FOR EST?              
         BNE   GFLTRCX                  NO                                      
*                                                                               
GFLTRC10 OI    MISCFLG1,MF1FLTRC        YES, PULL THE RECORD OUT ALSO           
         MVI   RDUPDATE,C'N'              SO WE CAN VALIDATE THE FLT #          
         GOTO1 GETREC              PUT THE FLIGHT RECORD IN AIO                 
*                                                                               
GFLTRCX  B     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* READ DARE BATCH TO SEE IF WE SHOULD POPULATE PRV/NEW FIELD                    
***********************************************************************         
RDBATCH  NTR1  BASE=*,LABEL=*                                                   
         XC    BATCHSLP,BATCHSLP      SALESPERSON                               
*                                                                               
         XC    KEY,KEY                                                          
         LA    R3,KEY                                                           
         USING DBTKEY,R3                                                        
         MVI   DBTKTYP,DBTKTYPQ       TYPE                                      
         MVI   DBTKSTYP,DBTKSTYQ      SUB-TYPE                                  
         MVC   DBTKAGMD,BAGYMD        AGENCY/MEDIA                              
         MVC   DBTKMKT,BMKT           MARKET                                    
         MVC   DBTKSTA,BSTA           STATION                                   
         MVC   DBTKCLT,BCLT           CLIENT                                    
         MVC   DBTKPRD,SVBPRD         PRODUCT                                   
         MVC   DBTKEST,BEST           ESTIMATE                                  
         MVC   DBTKPRD2,SVBPR2        PRODUCT2                                  
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DBTKEY),KEYSAVE  FOUND BATCH RECORD?                       
         JNE   NO                     NO                                        
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         LA    R2,ORSPRNWH                                                      
*                                                                               
         L     R6,AIO                                                           
         USING DBFLTELD,R6            FLIGHT ELEMENT                            
         MVI   ELCODE,DBFLTELQ                                                  
         BAS   RE,GETEL                                                         
         B     *+8                                                              
RDBTH10  BAS   RE,NEXTEL                                                        
         BNE   RDBTH20                                                          
         CLC   DBFLTFLT,SVBFLT        MATCH ON FLIGHT?                          
         BNE   RDBTH10                NO                                        
         TM    MISCFLG1,MF1DRTRD      DOING TRADE ORDER NOW?                    
         BZ    RDBTH12                                                          
         TM    DBFLTFL1,DBFLTTRD                                                
         BO    RDBTH13                                                          
         B     RDBTH10                                                          
RDBTH12  TM    DBFLTFL1,DBFLTTRD                                                
         BO    RDBTH10                                                          
*                                                                               
RDBTH13  TM    DBFLTFL1,DBFLTPRV      MARK AS PREVIOUSLY SENT?                  
         BNO   RDBTH14                NO                                        
         MVI   5(R2),1                INPUT LENGTH                              
         MVI   8(R2),C'P'             MOVE IN A 'P'                             
         OI    6(R2),X'80'                                                      
         B     RDBTH15                                                          
*                                                                               
RDBTH14  TM    DBFLTFL1,DBFLTNEW      MARK AS PREVIOUSLY SENT?                  
         BNO   RDBTH15                NO                                        
         MVI   5(R2),1                                                          
         MVI   8(R2),C'N'                                                       
         OI    6(R2),X'80'                                                      
*                                                                               
RDBTH15  TM    DBFLTFL1,DBFLTDAR      LINKED TO DARE ORDER?                     
         BO    RDBTHX                 YES                                       
         DROP  R6                                                               
*                                                                               
RDBTH20  L     R6,AIO                                                           
         USING DBSLPELD,R6            SALESPERSON ELEMENT                       
         MVI   ELCODE,DBSLPELQ                                                  
         BAS   RE,GETEL                                                         
         B     *+8                                                              
RDBTH30  BAS   RE,NEXTEL                                                        
         BNE   RDBTHX                                                           
         CLC   DBSLPFLT,SVBFLT        MATCH ON FLIGHT?                          
         BNE   RDBTH30                NO                                        
         TM    MISCFLG1,MF1DRTRD      DOING TRADE ORDER NOW?                    
         BZ    RDBTH35                                                          
         TM    DBSALFL1,DBSTRADE                                                
         BO    RDBTH40                                                          
         B     RDBTH30                                                          
RDBTH35  TM    DBSALFL1,DBSTRADE                                                
         BO    RDBTH30                                                          
*                                                                               
RDBTH40  MVC   BATCHSLP,DBSALESP      SAVE SALESPERSON FROM BATCH REC           
         MVI   BATCHFLG,0             FOR POINTPERSON FLAG                      
         TM    DBSALFL1,DBSALPT       POINTPERSON                               
         BZ    *+8                                                              
         OI    BATCHFLG,DBSALPT       SAVE POINTPERSON FLAG                     
RDBTHX   B     XIT                                                              
         DROP  R6                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CALL RD4ROUTE WITH HOB OF PARM2 = TO X'80' IF PREVIOUSLY SENT                 
*                                                                               
* ON ENTRY:    (R3)                  A(1 BYTE FIELD = P OR N)                   
***********************************************************************         
CALLRD4  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         GOTO1 ,DMCB,ORSDESTH,ORSROUTH,(MISCFLG3,EDIDATE),0                     
*                                                                               
         TM    MISCFLG3,MF3RADIO+MF3FXRAD   FAX ALL RADIO ORDERS?               
         BO    CARD4_35              YES, IGNORE PREV SENT!                     
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         USING DOSPELD,R6                                                       
*                                                                               
         TM    MISCFLG2,MF2PRSNT   PREVIOUSLY SENT?                             
         BZ    CARD4_30            NO                                           
         CLI   DOSPDEST,0          DO I HAVE LAST SENT?                         
         BNE   CARD4_02            YES                                          
         TM    MISCFLG3,MF3PRVCF   NO, PREVIOUSLY CONFIRMED ORDER?              
         BZ    CARD4_30                NO, NEVER                                
         MVI   ORSDESTH+5,0                                                     
         XC    ORSDEST,ORSDEST                                                  
CARD4_01 BRAS  RE,FAKELMRC         BUILD A FAKE LAST METHOD RECORD              
         GOTO1 ,DMCB,ORSDESTH,ORSROUTH,(MISCFLG3,EDIDATE),0                     
         OI    DMCB,X'40'          USE LAST METHOD I BUILT IN AIO3              
         B     CARD4_40                YES, LET RULES TAKE OVER                 
*                                                                               
CARD4_02 TM    ORSDESTH+1,X'20'    PROTECTED BECAUSE PREV CONFIRMED?            
         BNZ   CARD4_06            YES, DON'T CARE IF NOT THE SAME              
         CLC   DOSPDEST,ORSDEST     SAME DEST AS ON SCREEN?                     
         BE    CARD4_40             YES, DONE PREV/NEW LONG AGO                 
*                                                                               
CARD4_05 NI    ORSDESTH+4,X'FF'-X'20'   NOT PREV VALIDATED                      
CARD4_06 MVI   ORSDESTH+5,3                                                     
         MVC   ORSDEST(3),=C'REP'                                               
         CLI   DOSPDEST,C'R'                                                    
         BE    *+10                                                             
         MVC   ORSDEST(3),=C'STA'                                               
*                                                                               
         MVI   DMCB,X'80'          IGNORE LAST METHOD                           
         TM    ORSDESTH+1,X'20'    PROTECTED BECAUSE PREV CONFIRMED?            
         BZ    CARD4_40            NO                                           
         CLI   DOSPMTHD,C'I'       INBOX?                                       
         BE    CARD4_01            YES, THEN LET THE RULES TAKE OVER            
*                                                                               
         MVI   ELCODE,DOWIGELQ     WHERE'D IT GO ELEM                           
         BAS   RE,NEXTEL                                                        
         BNE   CARD4_40            THAT'S STRANGE, OH WELL                      
         USING DOWIGELD,R6                                                      
         CLI   DOWIGMTH,C'F'                                                    
         BE    CARD4_35                                                         
         CLI   DOWIGMTH,C'E'                                                    
         BE    CARD4_35                                                         
         B     CARD4_40                                                         
         DROP  R6                                                               
*                                                                               
CARD4_30 TM    ORSPRNWH+1,X'0C'    FIELD DISPLAYED                              
         BO    CARD4_40                                                         
         MVI   ORSDESTH+5,0                                                     
         XC    ORSDEST,ORSDEST                                                  
CARD4_32 CLI   0(R3),C'P'            PREVIOUSLY SENT?                           
         BNE   CARD4_40                                                         
CARD4_35 MVI   DMCB+4,X'80'          YES...CALL RD4ROUTE WITH HOB=X'80'         
*                                                                               
CARD4_40 GOTO1 RD4ROUTE,DMCB                                                    
         BE    CARD4X                                                           
         LA    R2,ORSROUTH                                                      
         CLC   GERROR,=AL2(NODSTDOV)  DESTINE IS FOR REP, USE DESTOV            
         BE    CARD4_45                                                         
         CLC   GERROR,=AL2(NODRADM)                                             
         JNE   ERREXIT                                                          
CARD4_45 CLI   PFKEY,5             THEY'RE TRYING TO GET INTO DESTOV            
         BE    CARD4X                                                           
         CLC   GERROR,=AL2(NODSTDOV) DESTINE IS FOR REP, USE DESTOV             
         JE    ERREXIT                                                          
         MVC   GERROR,=AL2(264)    PLEASE USE DESTOV!                           
         J     ERREXIT                                                          
*                                                                               
CARD4X   NI    MISCFLG3,X'FF'-MF3NOOFF                                          
         TM    DMCB,X'80'          REP DOES NOT APPEND OFFICE?                  
         BZ    *+8                                                              
         OI    MISCFLG3,MF3NOOFF                                                
         B     XIT                                                              
***********************************************************************         
*                            FRSTXMIT                                 *         
***********************************************************************         
FRSTXMIT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ      ALREADY ADDED OR CHANGED X'03' ELEM          
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING DOSPELD,R6                                                       
         LA    R2,ORSDESTH                                                      
         CLC   =C'REP',ORSDEST     DESINATION REP?                              
         BE    FIRSTX01            YES                                          
         CLC   =C'STA',ORSDEST     DESTINATION STATION?                         
         JNE   ERRDEST             NO...WHAT THE FUCK???                        
*                                                                               
FIRSTX01 MVC   DOSPDEST,ORSDEST                                                 
         MVC   DOSPIDST,ORSDEST                                                 
         MVI   DOSPMTHD,C'E'                                                    
         MVI   DOSPIMTH,C'E'                                                    
         CLC   =C'EML:',ORSROUT                                                 
         BE    FIRSTXX                                                          
         MVI   DOSPMTHD,C'F'                                                    
         MVI   DOSPIMTH,C'F'                                                    
         CLC   =C'FAX:',ORSROUT                                                 
         BE    FIRSTXX                                                          
         MVI   DOSPMTHD,C'I'                                                    
         MVI   DOSPIMTH,C'I'                                                    
FIRSTXX  NI    DOSPFLG2,X'FF'-DOSPOMDT    TURN OFF DESKTOP FLAG                 
         B     XIT                                                              
         DROP  R6                                                               
         EJECT                                                                  
***********************************************************************         
*                            TRANSEL                                  *         
***********************************************************************         
TRANSEL  NTR1  BASE=*,LABEL=*                                                   
         LA    R2,ORSDESTH           DESTINATION FIELD HEADER                   
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         XC    EDIDATE,EDIDATE                                                  
         L     R6,AIO                                                           
         MVI   ELCODE,DOSTELQ      X'12' - TRANSMISSION ELEMENT                 
         BAS   RE,GETEL            IS THERE IF WE TRANSMITTED ORDER             
         B     *+8                                                              
TRANS05  BAS   RE,NEXTEL                                                        
         BNE   TRANS20                                                          
         USING DOSTELD,R6                                                       
*                                                                               
         CLI   DOSTSTAT,DSENT      WAS IT SENT EDI?                             
         BNE   *+10                - NO                                         
         MVC   EDIDATE,DOSTDATE    - YES, SAVE THE DATE                         
*                                                                               
         TM    MISCFLG2,MF2PRSNT   PREVIOUSLY SENT?                             
         BO    TRANS10             - YES, FLAG ALREADY SET                      
         CLI   DOSTSTAT,QEMPTY     - NO, IS IT EMPTY AND UNSENT?                
         BE    TRANS20               - YES                                      
         OI    MISCFLG2,MF2PRSNT     - NO, SET PREVIOSLY SENT FLAG              
*                                                                               
TRANS10  TM    MISCFLG3,MF3PRVCF   PREVIOUSLY CONFIRMED?                        
         BO    TRANS05             - YES, FLAG ALREADY SET                      
         CLI   DOSTSTAT,QCFMD      - NO, CONFIRMED?                             
         BE    TRANS15               - YES                                      
         CLI   DOSTSTAT,QBYRCNFM   - NO, BUYER CONFIRMED?                       
         BNE   TRANS05               - NO                                       
TRANS15  OI    MISCFLG3,MF3PRVCF   SET PREVIOUSLY CONFIRMED FLAG                
         B     TRANS05                                                          
*                                                                               
TRANS20  TM    MISCFLG3,MF3PRVCF   PREVIOUSLY CONFIRMED?                        
         BZ    TRANS25             NO                                           
         OI    1(R2),X'20'         YES, PROTECT DESTINATION FIELD               
         B     TRANSX                                                           
*                                                                               
TRANS25  CLI   QMED,C'R'           RADIO?                                       
         BE    TRANSX              YES, LEAVE AS PROTECTED                      
         NI    1(R2),X'FF'-X'20'   UN-PROTECT DESTINATION FIELD                 
TRANSX   OI    6(R2),X'80'         TRANSMIT                                     
         B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* VALIDATE BUYER                                                                
***********************************************************************         
VKBUYR   NTR1  BASE=*,LABEL=*                                                   
         LA    R2,ORSBUYRH         BUYER                                        
         TM    4(R2),X'20'         VALIDATED PREVIOUSLY?                        
         BNZ   *+8                                                              
         OI    MISCFLG1,MF1KYCHG   KEY CHANGED, REDISPLAY LIST                  
*                                                                               
         XC    ORSBYXP,ORSBYXP                                                  
         OI    ORSBYXPH+6,X'80'                                                 
         XC    ORSBCOM,ORSBCOM                                                  
         OI    ORSBCOMH+6,X'80'                                                 
*                                                                               
         CLI   5(R2),0                                                          
         BE    MISSFLD                                                          
         GOTO1 VALIBUYR,DMCB,8(R2)  YES, VALIDATE IT                            
         BNE   INVLFLD                                                          
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,BYRDCDQ                                                   
         BAS   RE,GETEL                                                         
         USING BYRDSCD,R6                                                       
*&&DO                                                                           
* TEST IF BUYER OFFICE AND SIGN ON OFFICE MATCH                                 
         CLC   BYROFFID,DARROUTE+3                                              
         JNE   WRNGOFF             SALESPERSON NOT VALID ANYMORE                
*&&                                                                             
         MVI   BRWPREF,0                                                        
         L     R6,AIO                                                           
         MVI   ELCODE,BYRDCD2Q                                                  
         BAS   RE,GETEL                                                         
         BNE   VKBUYR10                                                         
         USING BYRDSCD2,R6                                                      
         CLI   BYRBRWPF,0                                                       
         BE    VKBUYR10                                                         
         MVC   BRWPREF,BYRBRWPF                                                 
*                                                                               
VKBUYR10 L     R6,AIO                                                           
         MVI   ELCODE,BYRCMCDQ        X'15' - COMMENT ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   VKBUYR30                                                         
         USING BYRCMTD,R6                                                       
         CLC   BYROCMT1,SPACES                                                  
         BH    VKBUYR13                                                         
         CLC   BYROCMT2,SPACES                                                  
         BNH   VKBUYR15                                                         
VKBUYR13 MVI   ORSBCOM,C'*'                                                     
*                                                                               
VKBUYR15 CLC   BYRSCMNT,SPACES                                                  
         BNH   VKBUYR30                                                         
         MVC   ORSBCOM+1(L'BYRSCMNT),BYRSCMNT                                   
*                                                                               
         XC    FAKEFLD,FAKEFLD                                                  
         MVC   FAKEFLDH,ORSBCOMH                                                
         MVI   FAKEFLDH+5,8                                                     
         MVC   FAKEFLD(8),BYRSCMNT                                              
         OC    FAKEFLD(8),SPACES                                                
         LA    R2,FAKEFLDH                                                      
*                                                                               
         GOTO1 VALISCOM,DMCB,8(R2)                                              
         JNE   INVBSCOM                                                         
         DROP  R6                                                               
*                                                                               
VKBUYR30 OC    QBUYER,SPACES                                                    
*                                                                               
         BRAS  RE,STRPPHNE                                                      
*                                                                               
         MVC   ORSBYXP,QBUYER      DISPLAY THE BUYER NAME                       
*                                                                               
         OI    ORSBUYRH+4,X'20'         VALIDATED                               
*                                                                               
VKBUYRX  B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* HIDE AVN FIELD                                                                
***********************************************************************         
HIDEAVN  NTR1  BASE=*,LABEL=*                                                   
         LA    R2,ORSPRNXH           CHANGE TEXT TO LOW INTENSITY               
         OI    1(R2),X'0C'                                                      
         OI    6(R2),X'80'                                                      
         LA    R2,ORSPRNWH           PROTECTED & LOW INTENSITY                  
         OI    1(R2),X'2C'                                                      
         OI    6(R2),X'80'                                                      
         B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* DISPLAY VALUE OF AVN FIELD AND PROTECT FIELD                        *         
***********************************************************************         
DISPAVN  NTR1  BASE=*,LABEL=*                                                   
         LA    R2,ORSPRNXH         CHANGE TEXT TO NORMAL INTENSITY              
         NI    1(R2),X'F3'         TURN OFF X'08' & X'04'                       
         OI    6(R2),X'80'                                                      
*                                                                               
         LA    R2,ORSPRNWH         CHANGE TO PROTECTED                          
         OI    1(R2),X'20'         AND CHANGE TO NORMAL INTENSITY               
         NI    1(R2),X'F3'         TURN OFF X'08' & X'04'                       
         MVI   8(R2),C'N'          DEFAULT                                      
*                                                                               
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   DPAVNX                                                           
*                                                                               
         GOTO1 GETREC              DID A HIGH ON A DARE ORDER REC               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ      ELEMENT X'03'                                
         BAS   RE,GETEL                                                         
         BE    DPAVN10                                                          
         L     R6,AIO                                                           
         MVI   ELCODE,DOXMTELQ     ELEMENT X'11' - EVER TRANSMITTED?            
         BAS   RE,GETEL                                                         
         BE    DPAVNX              YES, WE'RE OKAY                              
         DC    H'0'                THIS ELEMENT SHOULD BE HERE                  
         USING DOSPELD,R6                                                       
DPAVN10  TM    DOSPFLG1,DOSPAVN    AVN?                                         
         BZ    DPAVNX              NO                                           
         MVI   8(R2),C'P'                                                       
         OI    6(R2),X'80'                                                      
*                                                                               
DPAVNX   B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* DISPLAY VALUE OF AVN FIELD AND PROTECT FIELD                        *         
***********************************************************************         
SHOWAVN  NTR1  BASE=*                                                           
         B     *+12                                                             
         DC    CL8'*SHOWAV*'                                                    
*                                                                               
         LA    R2,ORSPRNXH         CHANGE TEXT TO HIGH INTENSITY                
         NI    1(R2),X'FB'         MAKE SURE X'04' IS OFF                       
         OI    1(R2),X'08'                                                      
         OI    6(R2),X'80'                                                      
*                                                                               
         LA    R2,ORSPRNWH         NOT PROTECTED                                
         NI    1(R2),X'DF'                                                      
         OI    6(R2),X'80'                                                      
         B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* LIST THE STANDARD COMMENTS FOR THE USER TO SELECT.  MAXIMUM OF 3.             
*                                                                               
* NOTE:  UPON SELECTING THE THIRD ONE, IT WILL RETURN BACK WITH THE 3.          
*        IT WILL ALSO OVERWRITE WHAT WAS ALREADY INPUTTED ON SCREEN.            
***********************************************************************         
LSTCMMNT NTR1  BASE=*,LABEL=*                                                   
         MVC   AIO,AIO2                                                         
         XC    SAVEKEY,SAVEKEY                                                  
         MVC   SAVEKEY,KEY                                                      
         MVI   IOOPT,C'Y'                                                       
*                                                                               
LSC05    TM    BITFLAG,BFSHWSCR    FIRST TIME IN?                               
         BZ    LSC10               NO                                           
         BRAS  RE,SAVETWA          SAVE TWA                                     
*                                                                               
         GOTO1 CALLOV,DMCB,(X'C3',CONTAGH),0,0                                  
         LA    R4,CMMNTKEY                                                      
         USING COMKEY,R4                                                        
         XC    COMKEY,COMKEY                                                    
         MVI   COMKTYP,COMKTYPQ                                                 
         MVI   COMKSUB,COMKSUBQ                                                 
         MVC   COMKAM,BAGYMD                                                    
         DROP  R4                                                               
         MVI   CMMNTCNT,0          NO COMMENTS IN LIST                          
         XC    CMMNTLST,CMMNTLST                                                
         NI    BITFLAG,X'FF'-BFSHWSCR   NOT FIRST TIME ANYMORE                  
         B     LSC90                                                            
*                                                                               
LSC10    LA    R2,AVCFRSTH                                                      
         USING LSCDSECT,R2                                                      
LSC10LP  LA    R0,AVCTAGH          LAST LINE CHECKED?                           
         CR    R2,R0                                                            
         BE    LSC80               YES                                          
*                                                                               
         CLI   CMMNTCNT,0          ANY SELECTIONS?                              
         BE    LSC13               NO                                           
         LA    R1,CMMNTLST                                                      
         ZIC   R0,CMMNTCNT                                                      
LSC12    CLC   LSCCOMCD,0(R1)      A SELECTED COMMENT?                          
         BNE   LSC12A              NO                                           
         CLI   LSCSEL,C'S'         IF STILL SELECTED                            
         BE    LSC15               THEN GO TO NEXT LINE                         
*                                                                               
         ZIC   RE,CMMNTCNT         DECREMENT # OF SELECTED COMMENTS             
         BCTR  RE,0                                                             
         STC   RE,CMMNTCNT                                                      
*                                                                               
         BCTR  R0,0                ANY MORE SELECTED AFTER THIS ONE?            
         LTR   R0,R0                                                            
         BZ    LSC15               NO                                           
*                                                                               
         LR    RE,R0               YES, MOVE THEM FORWARD                       
         MH    RE,=Y(L'COMKCOM)                                                 
         BCTR  RE,0                                                             
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),L'COMKCOM(R1)                                            
         B     LSC15                                                            
*                                                                               
LSC12A   LA    R1,L'COMKCOM(R1)                                                 
         BCT   R0,LSC12                                                         
*                                                                               
LSC13    CLI   LSCSEL,C'S'         NOT SELECTED?                                
         BNE   LSC15               NO, CHECK NEXT LINE                          
*                                                                               
         ZIC   R1,CMMNTCNT                                                      
         MH    R1,=Y(L'COMKCOM)                                                 
         LA    R0,CMMNTLST                                                      
         AR    R1,R0                                                            
         MVC   0(L'COMKCOM,R1),LSCCOMCD                                         
         OC    0(L'COMKCOM,R1),SPACES                                           
         ZIC   R1,CMMNTCNT                                                      
         LA    R1,1(R1)                                                         
         STC   R1,CMMNTCNT                                                      
         CLI   CMMNTCNT,3          FIFTH ONE ALREADY?                           
         BE    LSC80A              YES, RETURN TO THE AVAIL SCREEN              
*                                                                               
LSC15    LA    R2,LSCNEXTL         CHECK THE NEXT LINE                          
         B     LSC10LP                                                          
         DROP  R2                                                               
*                                                                               
LSC80    CLI   PFKEY,12            RETURN TO THE AVAIL SCREEN?                  
         BNE   LSC90                                                            
LSC80A   NI    BITFLAG,X'FF'-BFSTDCOM  DON'T LIST STANDARD COMMENTS             
         BRAS  RE,RSTRTWA          RESTORE THE TWA                              
*                                                                               
         LA    R2,ORSSTD1H                                                      
         ST    R2,ACURFORC                                                      
         MVI   PFKEY,0                                                          
         MVI   IOOPT,C'N'                                                       
*                                                                               
         CLI   CMMNTCNT,0          NO COMMENTS?                                 
         BE    LSCYES                                                           
*                                                                               
         TWAXC ORSSTD1H,ORSSTD3H,TRNS=N                                         
         MVI   ORSSTD1H+5,0        CLEAR OLD COMMENTS                           
         MVI   ORSSTD2H+5,0            AND THE LENGTH IN THE FIELDS             
         MVI   ORSSTD3H+5,0                                                     
*                                                                               
         ZIC   R1,CMMNTCNT                                                      
         LA    R3,CMMNTLST                                                      
LSC80LP  MVC   8(L'COMKCOM,R2),0(R3)                                            
         MVI   5(R2),L'COMKCOM                                                  
         ZIC   R0,0(R2)                                                         
         AR    R2,R0                                                            
         LA    R3,L'COMKCOM(R3)                                                 
         BCT   R1,LSC80LP                                                       
         B     LSCYES                                                           
*                                                                               
LSC90    TWAXC AVCFRSTH,AVCTAGH,PROT=Y    CLEAR SCREEN FOR NEXT PAGE            
         LA    R2,AVCFRSTH                                                      
         XC    KEY,KEY                                                          
         MVC   KEY(L'CMMNTKEY),CMMNTKEY                                         
         GOTO1 HIGH                                                             
*                                                                               
LSC90TST LA    R0,AVCTAGH          NO MORE ROOM TO LIST?                        
         CR    R2,R0                                                            
         BE    LSCNO               YES                                          
         USING LSCDSECT,R2                                                      
*                                                                               
         CLC   KEY(COMKCOM-COMKEY),KEYSAVE   SAME AGENCY MEDIA?                 
         BE    LSC95                                                            
         LA    R4,CMMNTKEY         NO, START LIST FROM BEGINNING                
         USING COMKEY,R4                                                        
         XC    COMKEY,COMKEY                                                    
         MVI   COMKTYP,COMKTYPQ                                                 
         MVI   COMKSUB,COMKSUBQ                                                 
         MVC   COMKAM,BAGYMD                                                    
         B     LSCNO                                                            
         DROP  R4                                                               
*                                                                               
LSC95    GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         USING COMRECD,R6                                                       
         OI    LSCSELH+6,X'01'                                                  
*                                                                               
         CLI   CMMNTCNT,0          NO NEED TO CHECK FOR DUPLICATES              
         BE    LSC96                                                            
         LA    R1,CMMNTLST                                                      
         ZIC   R0,CMMNTCNT                                                      
LSC95A   CLC   COMKCOM,0(R1)       DISREGARD ANY DUPLICATES                     
         BNE   *+12                                                             
         MVI   LSCSEL,C'S'                                                      
         B     LSC96                                                            
         LA    R1,L'COMKCOM(R1)                                                 
         BCT   R0,LSC95A                                                        
*                                                                               
LSC96    MVC   LSCCOMCD,COMKCOM                                                 
         MVI   ELCODE,COMTXTEQ                                                  
         BAS   RE,GETEL                                                         
         USING COMTXTD,R6                                                       
         CLI   COMTXTLN,L'LSCLINE+COMTXTOV                                      
         BL    *+14                                                             
         MVC   LSCLINE,COMTXTTX                                                 
         B     LSC97                                                            
         ZIC   R1,COMTXTLN                                                      
         SH    R1,=Y(COMTXTOV+1)                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   LSCLINE(0),COMTXTTX                                              
*                                                                               
LSC97    L     R6,AIO                                                           
         USING COMRECD,R6                                                       
         MVC   CMMNTKEY,COMKEY                                                  
         DROP  R6                                                               
         LA    R2,LSCNEXTL                                                      
         GOTO1 SEQ                                                              
         B     LSC90TST                                                         
         DROP  R2                                                               
*                                                                               
LSCNO    MVC   AIO,AIO1                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(L'SAVEKEY),SAVEKEY                                           
         B     NO                                                               
*                                                                               
LSCYES   MVC   AIO,AIO1                                                         
         XC    KEY,KEY                                                          
         MVC   KEY(L'SAVEKEY),SAVEKEY                                           
         B     YES                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SEND DARE ORDER                                                               
***********************************************************************         
PR       NTR1  BASE=*,LABEL=*                                                   
         MVI   WHEN,X'40'          SET REPORT TO PRINT NOW                      
         MVI   TWAWHEN,0                                                        
         B     PR00                                                             
*&&DO                                                                           
*   !!!** MOVED SO PR AND PRNTOCOM CAN SHARE **!!!                              
***************                                                                 
* AFTER EVERY CALL TO PRTLINE, R1 WILL CONTAIN A(198 CHAR PRINT LINE)           
***************                                                                 
PRTLINE  LR    R0,RE                                                            
         L     R1,AGYNMRCS         INCREMENT NUMBER OF RECORDS PRINTED          
         AHI   R1,1                                                             
         ST    R1,AGYNMRCS                                                      
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
*&&                                                                             
PR00     LA    R1,NOTHING                                                       
         ST    R1,SPECS                                                         
* BUILD DAY/TIME ELEMENT                                                        
         BRAS  RE,BLDDAYTM                                                      
*                                                                               
         TM    MISCFLG2,MF2RCLNG   RECALLING, SO ADD A SENT PENDING?            
         BZ    PR10                                                             
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         LA    R3,DOXMELEM         ADD A NEW TRANSMISSION ELEM                  
         USING DOXMTELD,R3                                                      
         MVC   DOXMTOID,TWAORIG                                                 
         GOTO1 DATCON,DMCB,(5,0),(19,DOXMTYMD)    SET THE CURRENT DATE          
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    PR02                                                             
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
         GOTO1 DATCON,DMCB,(0,DUB),(19,DOXMTYMD)                                
*                                                                               
PR02     ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DOXMTTIM                                                    
*                                                                               
         MVC   DOXMTSTD,DOXMTYMD                                                
         MVC   DOXMTSTT,DOXMTTIM                                                
         MVI   DOXMTSTA,QSNTPNDG   SENT PENDING RECALL ACKNOWLEDGEMENT          
         DROP  R3                                                               
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
*                                                                               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT IN RECORD)              
         DROP  R6                                                               
PR04     CLI   0(R6),0             NEW TRANSMISSION ELEMENT GOES                
         BE    PR06                    AFTER ID ELEMENTS                        
         CLI   0(R6),DORPELQ                                                    
         BNL   PR06                                                             
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PR04                                                             
*                                                                               
PR06     BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)                              
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ                                                  
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,QSNTPNDG   SENT PENDING RECALL ACKNOWLEDGEMENT          
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
PR06A10  CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS            
         BE    PR06A20           AND BEFORE AN AUDIT ELEMENT                    
         CLI   0(R6),DOSTELQ                                                    
         BNL   PR06A20                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PR06A10                                                          
*                                                                               
PR06A20  GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         GOTOR COLPASKY,DMCB,(C'G',0)                                           
*                                                                               
         BRAS  RE,MYPUTREC                                                      
*                                                                               
         BRAS  RE,UPSALREC         UPDATE THE X'04' SALESPERSON RECORD          
*                                                                               
         BRAS  RE,UPDEXTRA         UPDATE THE X'05' EXTRA RECORD                
*                                                                               
         B     PRXIT                                                            
*                                                                               
PR10     L     R1,ABOX             TO GET 198 CHAR WIDE REPORTS                 
         ST    R1,TWAVBOX                                                       
         USING BOXD,R1                                                          
         MVC   BOXWIDTH,=F'198'                                                 
         DROP  R1                                                               
*                                                                               
         BRAS  RE,OPENSPQ                                                       
***************                                                                 
* PUT OUT EDICT HEADER RECORD                                                   
***************                                                                 
         L     RE,ABOX                                                          
         USING BOXD,RE                                                          
         AH    RE,=Y(BOXDL)                                                     
         ST    RE,BOXAWIDE                                                      
         USING WIDED,RE                                                         
         LA    R0,XP1              FILL XP1 - XSPACES WITH SPACES               
         LA    R1,L'XP1*5                                                       
         LR    R2,R0                                                            
         XR    R3,R3                                                            
         MVI   BYTE,C' '                                                        
         ICM   R3,8,BYTE                                                        
         MVCL  R0,R2                                                            
         LA    R0,XHEAD1           FILL XHEAD - XHEAD14 WITH SPACES             
         LA    R1,L'XHEAD1*14                                                   
         MVCL  R0,R2                                                            
         LA    R0,XMID1            FILL XMID1 - XMID2 WITH SPACES               
         LA    R1,L'XMID1*2                                                     
         MVCL  R0,R2                                                            
         MVC   XMID1,XSPACES                                                    
         MVC   XMID2,XSPACES                                                    
*                                                                               
         LA    R1,XP                                                            
         ST    R1,APRTLINE                                                      
         DROP  RE                                                               
*                                                                               
         MVC   4(5,R1),=C'*HDR*'   HEADER RECORD                                
         MVC   9(14,R1),=CL14'EDICT=*DDSDARA'                                   
         MVI   34(R1),C'W'         WIDE REPORT                                  
         MVI   35(R1),C'P'         /PAGE FOR EASYLINK AND SUPRESS TOP           
*                                                                               
*                                     1ST 8 BYTES IS AGENCY BY DAVID            
         MVC   54+8(L'QMED+L'QCLT,R1),QMED                                      
         BRAS  RE,PRTLINE                                                       
*                                                                               
         L     R3,APRTLINE                                                      
         USING EDICTD,R3                                                        
         MVC   EDIDDSID,=C'++DDS'                                               
         MVC   EDISYST,=C'DA'      DARE                                         
         MVC   EDIPROG,=C'ORD'     ORDER                                        
         MVC   EDIIDEN,=C'TRN'     TRANSACTION DATA                             
*                                                                               
         MVC   EDIRDRAG,SVUSERID                                                
         MVC   EDIRDRST,QSTA                                                    
         MVC   EDIRDRMD,ORSMED                                                  
         MVC   EDIRDRCL(L'QCLT),ORSCLT                                          
         MVC   EDIRDRP1(L'QPRD),SVQPRD                                          
*                                                                               
         CLI   SVBPRD,X'FF'        POL ORDER?                                   
         BNE   *+10                                                             
         MVC   EDIRDRP1(L'QPRD),=C'***'                                         
*                                                                               
         MVC   EDIRDRP2(L'QPRD),SVQPR2                                          
         MVC   EDIRDRES,ORSEST                                                  
         MVC   EDIRDRAN,SVQCORDR                                                
*                                                                               
         LA    R2,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    R2,ORSTCONH                                                      
*                                                                               
         CLI   7(R2),0             ANY CONTRACT NUMBER?                         
         BE    PR11                NONE                                         
         ZIC   R1,7(R2)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         PACK  DUB,8(0,R2)                                                      
         UNPK  EDIRDRCN(8),DUB     RIGHT-ALIGN AND FILL WITH ZEROS              
         B     *+10                                                             
PR11     MVC   EDIRDRCN,8(R2)                                                   
*                                                                               
         MVC   EDIRDRBY,ORSBUYR                                                 
         MVC   EDIRDRSP,ORSSALE                                                 
*                                                                               
         BRAS  RE,PRTLINE                                                       
***************                                                                 
* PUT OUT AGENCY HEADER LINE                                                    
***************                                                                 
         XC    AGYNMRCS,AGYNMRCS   START COUNTING FROM HERE                     
*                                                                               
         L     R2,APRTLINE                                                      
         USING PAGYHDRD,R2                                                      
         MVC   PAHDTID,=C'AGYHDR'     TRANSMISSION ID                           
* CODE IS NO LONGER NEEDED SINCE VAR DOESN'T EXIST ANYMORE                      
*&&DO                                                                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PAHDTID(3),=C'VAR'                                               
*&&                                                                             
         LA    R1,JDSREPS          DETERMINE IF WE HAVE A JDS REP               
PR11A00  CLI   0(R1),0                                                          
         BE    PR11A02                                                          
         CLC   0(L'JDSREPS,R1),SVREP                                            
         BE    *+12                                                             
         LA    R1,L'JDSREPS(R1)                                                 
         B     PR11A00                                                          
         OI    OMBASFLG,OMFJDSRP   WE HAVE A JDS REP                            
         B     PR11A03                                                          
*                                                                               
PR11A02  OC    EDIDATE,EDIDATE                                                  
         BZ    PR11A03                                                          
         GOTO1 DATCON,DMCB,(8,EDIDATE),(X'20',PAHDFSNT)                         
*                                                                               
PR11A03  DS    0H                                                               
         MVC   PAHDORDR,SVQCORDR                                                
         MVI   PAHDVERS,C'0'                                                    
         MVC   PAHDFRID,SVUSERID                                                
         MVC   PAHDTOID,ORSROUT    YES, DARE DISPATCHER WON'T FIND              
         OC    PAHDTOID,SPACES       THE RIGHT ONE IF NOT HOME MKT              
*                                                                               
         CLC   =C'EJOR',PAHDTOID   GOING TO EJOR (VSG)?                         
         BE    *+14                                                             
         CLC   =C'SB3VS',PAHDTOID  GOING TO VSG?                                
         BNE   PR11A04                                                          
*                                                                               
         LA    RF,VSSTATAB                                                      
PR11A03A CLI   0(RF),X'FF'         EOT?                                         
         BE    PR11A04             YES, NO  -VS  REQUIRED                       
         CLC   QSTA(4),0(RF)                                                    
         BE    *+12                                                             
         AHI   RF,L'VSSTATAB                                                    
         B     PR11A03A                                                         
         CLC   =C'EJOR',PAHDTOID       GOING TO EJOR (VSG)?                     
         BNE   *+14                                                             
         MVC   PAHDTOID+4(3),=C'-VS'   YES                                      
         B     PR11A04                                                          
         MVC   PAHDTOID+7(3),=C'-VS'   THESE ORDERS WILL STAY WITH VSG          
         B     PR11A04                                                          
*                                                                               
       ++INCLUDE DDVSREPTAB                                                     
*                                                                               
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
*                                                                               
PR11A04  MVC   WORK,ORSROUT                                                     
         GOTOR CHKMOREP,DMCB,WORK,PAHDORDR                                      
         BNE   PR11A05                                                          
         MVC   PAHDTOID,WORK       YES, DARE DISPATCHER WON'T FIND              
*                                                                               
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
*                                                                               
PR11A05  MVC   PAHDROUT,DARROUTE                                                
*                                                                               
         XC    BUYLINES,BUYLINES   NO BUYLINES USED YET                         
         L     R6,AIO                                                           
         MVI   ELCODE,DOBUYELQ     FIND BUYLINE ELEMENTS                        
         BAS   RE,GETEL                                                         
PR11A10  BNE   PR11A00X            NONE -OR- NO MORE                            
         USING DOBUYELD,R6                                                      
         SR    RF,RF                                                            
         ZIC   RE,DOBUYSPT         GET THE BUYLINE NUMBER                       
         BCTR  RE,0                                                             
         SRDL  RE,3                                                             
         LA    RE,BUYLINES(RE)     RE=A(APPROPRIATE BYTE IN BUYLINES)           
         SRL   RF,5                                                             
         STCM  RF,8,BYTE           BYTE=BIT # FOR BUYLINE FROM LEFT             
*                                                                               
         LA    R0,X'80'                                                         
         ZIC   R1,BYTE                                                          
         SRL   R0,0(R1)                                                         
         STC   R0,BYTE                                                          
         OC    0(L'BYTE,RE),BYTE                                                
*                                                                               
         BAS   RE,NEXTEL                                                        
         B     PR11A10                                                          
*                                                                               
       ++INCLUDE SPDARJDSRP                                                     
*                                                                               
PR11A00X DS    0H                                                               
*                                                                               
         L     R6,AIO              POINT TO THE RECORD                          
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         XC    DOSPELEM,DOSPELEM   COULD BE A 'REALLY' OLD ORDER                
         TM    MISCFLG1,MF1DRREV   ARE WE DOING A DARE REVISION?                
         BZ    PR11B30                                                          
***********************************                                             
* CHECKS FOR REVISION INFORMATION                                               
***********************************                                             
         MVC   DOSPELEM,0(R6)                                                   
         BRAS  RE,CHECKCNF         WAS LAST STATUS OF ORDER CONFIRMED?          
         BNE   PR11B25                                                          
*                                                                               
         USING DOSPELD,R6                                                       
PR11B20  LA    R6,DOSPELEM         MODIFY OUR OWN ELEMENT                       
         ZIC   R0,DOSPREVN         GET THE REVISION NUMBER                      
         AHI   R0,1                BUMP IT UP BY ONE VERSION                    
         CHI   R0,255                                                           
         BH    TWOMNYRV            TOO MANY REVISIONS FOR THIS ORDER!           
         STC   R0,DOSPREVN                                                      
*                                                                               
         LA    R1,ORSCREVH                                                      
         TM    MISCFLG1,MF1DRTRD   CASH REVISION?                               
         BZ    *+8                 YES                                          
         LA    R1,ORSTREVH         NO, TRADE REVISION                           
         BRAS  RE,SHOWREV                                                       
*                                                                               
PR11B25  EDIT  (B1,DOSPREVN),(3,PAHDREVN),FILL=0                                
*                                                                               
         CLI   DOSPREVN,0          REVISION ORDER?                              
         BE    PR11B99                                                          
*                                                                               
         LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         CLC   8(L'ORSCONT,RF),ZEROS       ANY CONTRACT NUMBER?                 
         BNH   CANTBREV                    NONE, CAN'T BE A REVISION            
*                                                                               
PR11B30  OC    DOSPFSTA,DOSPFSTA   ANY EDI FIRST SEND STATION?                  
         BZ    PR11B90                                                          
         XC    WORK,WORK                                                        
         MVC   WORK+2(L'DOSPFSTA),DOSPFSTA                                      
         GOTO1 MSUNPK,DMCB,WORK,WORK+5,PAHDFSTA                                 
         CLI   PAHDFSTA+4,C' '                                                  
         BNE   *+8                                                              
         MVI   PAHDFSTA+4,C'T'                                                  
*                                                                               
PR11B90  CLI   DOSPDEST,C'R'       AM I REP?                                    
         BNE   PR11K                                                            
         CLI   DOSPMTHD,C'I'       INBOX?                                       
         BNE   PR11K                                                            
*                                                                               
PR11B99  L     R6,AIO              POINT TO THE RECORD                          
         LA    R6,DORFRST-DOKEY(R6)                                             
PR11D    CLI   0(R6),0             LOOKING WHERE TO SEND ORDER                  
         BE    PR11K                                                            
         CLI   0(R6),DORPELQ       IF WE HAVE A REP CHANGED ELEM                
         BE    PR11F                                                            
* NO LONGER MATTERS!!                                                           
*        CLI   0(R6),DOXMTELQ        OR A TRANSMISSION ELEM                     
*        BE    PR11G                                                            
*                                                                               
         SR    R0,R0                                                            
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PR11D                                                            
*                                                                               
         USING DOREPELD,R6                                                      
PR11F    GOTOR SHWIDNUM,DMCB,DORPNREP,FAKEFLDH                                  
         B     PR11H                                                            
*&&DO                                                                           
         USING DOXMTELD,R6                                                      
PR11G    OC    DOXMTDID,DOXMTDID                                                
         BZ    PR11K                                                            
         CLC   =X'FFFF',DOXMTDID   PREVIOUSLY SENT AS FAX?                      
         BE    PR11K               YES                                          
         CLC   =X'FFFD',DOXMTDID   PREVIOUSLY SENT AS EMAIL?                    
         BE    PR11K               YES                                          
         GOTOR SHWIDNUM,DMCB,DOXMTDID,FAKEFLDH                                  
*&&                                                                             
PR11H    MVC   PAHDTOID,FAKEFLD                                                 
         DROP  R6                                                               
*                                                                               
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
         GOTOR CHKMOREP,DMCB,PAHDTOID,PAHDORDR                                  
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 09/23/02                 
*                                                                               
PR11K    LA    R6,DOXMELEM                                                      
         USING DOXMTELD,R6                                                      
         GOTO1 DATCON,DMCB,(8,DOXMTYMD),(X'20',PAHDDATE)                        
         GOTO1 HEXOUT,DMCB,DOXMTTIM,PAHDTIME,L'DOXMTTIM                         
         DROP  R6                                                               
*                                                                               
         MVC   PAHDQMED,QMED                                                    
         MVC   PAHDQCLT(L'QCLT),QCLT                                            
         MVC   PAHDQSTA(L'QSTA),QSTA                                            
         MVC   PAHDQPRD(L'SVQPRD),SVQPRD                                        
*                                                                               
         CLI   SVBPRD,X'FF'        POL ORDER?                                   
         BNE   *+10                                                             
         MVC   PAHDQPRD(L'SVQPRD),=C'***'                                       
*                                                                               
         MVC   PAHDQPR2(L'SVQPR2),SVQPR2                                        
         OC    PAHDQPR2,SPACES                                                  
         MVC   PAHDQEST(L'QEST),QEST                                            
*                                                                               
         MVC   PAHDESTS,ESTSTRT                                                 
         CLI   PAHDESTS,X'F9'                                                   
         BNH   PR11L00                                                          
         ZIC   R1,PAHDESTS                                                      
         SHI   R1,10                                                            
         STC   R1,PAHDESTS                                                      
PR11L00  MVC   PAHDESTN,ESTEND                                                  
         CLI   PAHDESTN,X'F9'                                                   
         BNH   PR11L10                                                          
         ZIC   R1,PAHDESTN                                                      
         SHI   R1,10                                                            
         STC   R1,PAHDESTN                                                      
PR11L10  TM    MISCFLG1,MF1FLTRC   USING FLIGHT RECS?                           
         BZ    PR11M                                                            
***********************************************************************         
* THE X'20' IS TO ALLOW YEAR 2000 TO SHOW AS C'00' INSTEAD OF X'FAF0'           
***********************************************************************         
         GOTO1 DATCON,DMCB,(3,SVFLTSDT),(X'20',PAHDESTS)                        
         GOTO1 DATCON,DMCB,(3,SVFLTEDT),(X'20',PAHDESTN)                        
*&&DO                                                                           
PR11M    LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         OC    8(L'ORSCONT,RF),8(RF)  IF NO REP CONTRACT NUMBER                 
         BZ    PR12                                                             
         CLI   7(RF),0                                                          
         BE    PR12                   NONE                                      
         ZIC   R1,7(RF)                                                         
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         PACK  DUB,8(0,RF)                                                      
         UNPK  PAHDRPCN(8),DUB     RIGHT-ALIGN AND FILL WITH ZEROS              
         B     *+10                                                             
*&&                                                                             
PR11M    L     RF,AIO                                                           
         AHI   RF,DORFRST-DOKEY    1ST ELEMENT IS ALWAYS X'01'                  
         USING DOIDELD,RF                                                       
         MVC   PAHDRPCN,DOIDCON                                                 
         DROP  RF                                                               
         CLC   PAHDRPCN,ZEROS                                                   
         BH    *+10                                                             
PR12     MVC   PAHDRPCN,ZEROS      THEN '0' FOR NEW REP CONTRACT                
*                                                                               
         GOTO1 GETFACT,DMCB,0                                                   
         LA    R4,PAHDRTRN                                                      
         USING RTN2SNDR,R4                                                      
         MVC   RTNBUYER,ORSBUYR    NEED THIS FOR DARE NOTIFICATIONS             
         L     R6,DMCB                                                          
         USING FACTSD,R6                                                        
         GOTO1 HEXOUT,DMCB,FASYSID,RTNSYSID,1                                   
         DROP  R6                                                               
*                                                                               
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         CLC   RTNSYSID,=C'06'     ARE WE ON FACMEL?                            
         BNE   *+10                                                             
PR15     MVC   RTNSYSID,=C'01'     MAKE IT LOOK LIKE WE'RE ON FACTST            
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         MVC   RTNPWRCD,AGENCY                                                  
         GOTO1 HEXOUT,DMCB,BAGYMD,RTNAGYMD,1                                    
         MVC   RTNDDS,=C'D=Y'      THIS IS A DDS ORDER                          
         DROP  R4                                                               
*                                                                               
         MVI   PAHDCTRD,C'C'       SET CASH OR TRADE INDICATOR                  
         TM    ESTFLAG1,ESTTRADE                                                
         BZ    *+8                                                              
         MVI   PAHDCTRD,C'T'       TRADE                                        
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE?                                 
         BZ    *+8                                                              
         MVI   PAHDCTRD,C'T'       TRADE                                        
*                                                                               
         MVI   PAHDSTYP,C'W'       DEFAULT IS WEEKLY SCHEDULE                   
         TM    ESTFLAG1,ESTDAILY   DAILY SCHEDULE?                              
         BZ    *+8                                                              
         MVI   PAHDSTYP,C'D'       YES                                          
*                                                                               
PR20     TM    MISCFLG2,MF2UNALL   ANY UNALLOCATED SPOTS?                       
         BZ    PR22                YES, CAN'T HAVE VAR ORDER THEN               
****  NOT ALL SPOTS ALLOCATED                                                   
         TM    MISCFLG2,MF2VAROR   CURRENTLY A VAR ORDER?                       
         BZ    PR30                                                             
         MVI   PQSW,X'FE'          FOOL GENCON TO THINK PQ IS                   
         LA    R2,ORSMEDH              NOT OPENED                               
         B     ALLOCERR            ALL SPOTS MUST BE ALLOCATED FOR              
****  ALL SPOTS ALLOCATED                                                       
PR22     TM    MISCFLG2,MF2PRSNT   PREVIOUSLY SENT ORDER?                       
         BZ    PR24                NO, BRAND NEW, SEND A VAR ORDER              
         TM    MISCFLG2,MF2VAROR   PREVIOUSLY CONFIRMED                         
         BZ    PR30                                                             
*                                                                               
PR24     CLI   SVBPRD,X'FF'           ORDER WITH PRODUCT POL?                   
         BNE   PR30                   NO                                        
         MVC   PAHDTID(3),=C'VAR'     TRANSMISSION ID                           
         OI    MISCFLG2,MF2VAROR      VAR ORDER                                 
*                                                                               
PR30     CLC   =X'FFFF',SVAIRDAT   NO FIRST AIR DATE?                           
         BE    PR35                NONE, SKIP IT                                
***********************************************************************         
* THE X'20' IS TO ALLOW YEAR 2000 TO SHOW AS C'00' INSTEAD OF X'FAF0'           
***********************************************************************         
         GOTO1 DATCON,DMCB,(2,SVAIRDAT),(X'20',PAHDAIRD)                        
*                                                                               
PR35     EDIT  (B1,SVOOWROT),(1,PAHDSDAY)     OUT-OF-WEEK ROTATOR               
********************************************************************            
* TEST FOR PHANTOM CONTRACT                                                     
********************************************************************            
         L     R6,AIO              POINT TO THE RECORD                          
         MVI   ELCODE,DOIDELQ      GET DARE TRANSMISSION ELEMENT                
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING DOIDELD,R6                                                       
         OC    DOIDCON,DOIDCON     NEW ORDER?                                   
         BNZ   TANKGIRL            NO, SKIP CHECK                               
         DROP  R6                                                               
                                                                                
         CLC   PAHDRPCN,ZEROS      YES, THIS BETTER BE PRINTABLE ZEROS!         
         BE    *+6                                                              
         DC    H'0'                DIE! DIE! DIE!                               
*                                                                               
TANKGIRL DS    0H                                                               
*                                                                               
         DROP  R2                                                               
*                                                                               
         BRAS  RE,PRTLINE                                                       
*                                                                               
         XC    AGYNSPTS,AGYNSPTS   CLEAR AGENCY TOTAL AMOUNTS                   
         ZAP   AGYDOLRS,=P'0'                                                   
         EJECT                                                                  
         BRAS  RE,PRTDESCS         PUT OUT THE AGENCY DESCRIPTIONS              
*********                                                                       
* STANDARD COMMENT FROM BUYER                                                   
*********                                                                       
PRBSC00  L     R4,APRTLINE                                                      
         USING PAGYSTDD,R4                                                      
         GOTO1 VALIBUYR,DMCB,ORSBUYR                                            
         L     R6,AIO                                                           
         MVI   ELCODE,BYRCMCDQ        X'15' - COMMENT ELEMENT                   
         NI    MISCFLG2,X'FF'-MF2BSCOM  NO BUYER STND COMMENT                   
         BAS   RE,GETEL                                                         
         BNE   PRBSCX                                                           
         USING BYRCMTD,R6                                                       
         CLC   BYRSCMNT,SPACES                                                  
         BNH   PRBSCX                                                           
         OI    MISCFLG2,MF2BSCOM   BUYER STND COMMENT                           
         XC    FAKEFLD,FAKEFLD                                                  
         MVC   FAKEFLDH,ORSSTD1H   FOOL THE STANDARD COMMENT SECTION TO         
         MVI   FAKEFLDH+5,8         THINK WE HAVE 1 MORE STANDARD COM           
         MVC   FAKEFLD(8),BYRSCMNT                                              
         OC    FAKEFLD(8),SPACES                                                
         LA    R2,FAKEFLDH                                                      
         B     PRSTC10                                                          
         DROP  R6                                                               
*                                                                               
PRBSCX   DS    0H                                                               
*********                                                                       
* STANDARD COMMENTS                                                             
*********                                                                       
PRSTC00  L     R4,APRTLINE                                                      
         USING PAGYSTDD,R4                                                      
*                                                                               
PRSTC05  LA    R2,ORSSTD1H         GO THROUGH THE STANDARD COMMENTS             
PRSTC10  LA    R0,ORSSTD3H                                                      
         CR    R2,R0                                                            
         BH    PRSTCX                                                           
*                                                                               
         CLI   5(R2),0                                                          
         BE    PRSTC50                                                          
*                                                                               
         LA    R6,KEY              LOOK UP THE STANDARD COMMENT                 
         USING COMKEY,R6                                                        
         XC    COMKEY,COMKEY                                                    
         MVI   COMKTYP,COMKTYPQ                                                 
         MVI   COMKSUB,COMKSUBQ                                                 
         MVC   COMKAM,BAGYMD                                                    
         MVC   COMKCOM,8(R2)                                                    
         OC    COMKCOM,SPACES                                                   
         DROP  R6                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'COMKEY),KEYSAVE                                            
         BNE   INVLFLD                                                          
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
*                                                                               
         MVI   ELCODE,COMTXTEQ                                                  
         BAS   RE,GETEL                                                         
         BNE   PRSTC20                                                          
         MVI   BYTE,1              CURRENT LINE NUMBER OF RECORD                
*                                                                               
         USING COMTXTD,R6                                                       
PRSTC20  CLC   0(L'SPACES,R4),SPACES    A LINE TO PRINT FROM BEFORE?            
         BE    PRSTC30                                                          
         BRAS  RE,PRTLINE          YES                                          
*                                                                               
PRSTC30  MVC   PASTTID,=C'AGYSTD'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PASTTID(3),=C'VAR'                                               
*                                                                               
         MVC   PASTORDR,SVQCORDR                                                
         MVI   PASTCONT,C'*'       MORE LINES FOLLOW                            
         CLC   BYTE,COMTXTSQ       MAKE SURE WE GET THE RIGHT LINE              
         BE    PRSTC40                                                          
         BRAS  RE,PRTLINE                                                       
         ZIC   R1,BYTE                                                          
         AHI   R1,1                                                             
         STC   R1,BYTE                                                          
         B     PRSTC30                                                          
*                                                                               
PRSTC40  ZIC   R1,COMTXTLN                                                      
         SH    R1,=Y(COMTXTOV+1)                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PASTTEXT(0),COMTXTTX                                             
         ZIC   R1,BYTE                                                          
         AHI   R1,1                                                             
         STC   R1,BYTE                                                          
*                                                                               
         BAS   RE,NEXTEL                                                        
         BE    PRSTC20             MORE LINES FOLLOW                            
***************                                                                 
*  DONE WITH THIS STANDARD COMMENT                                              
***************                                                                 
PRSTC50  TM    MISCFLG2,MF2BSCOM   FROM BUYER STANDARD COMMENT?                 
         BZ    PRSTC55                                                          
         NI    MISCFLG2,X'FF'-MF2BSCOM  NOT ANYMORE                             
         B     PRSTC05             LOOK AT 1ST STANDARD COMMENT ON SCR          
*                                                                               
PRSTC55  ZIC   R0,0(R2)            CHECK IF ANY MORE STANDARD COMMENTS          
         AR    R2,R0                                                            
         B     PRSTC10                                                          
*                                                                               
PRSTCX   DS    0H                                                               
         DROP  R6                                                               
***************                                                                 
*  ANY OCOM RECORDS?                                                            
***************                                                                 
PROCM00  DS    0H                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING OM$COMKEY,R6                                                     
         MVC   OM$COMKTYPE,=X'0D0C'   OCOM TYPE                                 
         MVC   OM$COMKAGY,BAGYMD                                                
         MVI   OM$COMCTYPE,C'O'       OCOM RECORDS                              
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM MEDIA LEVEL?                     
         BNE   PROCM05                                                          
         BRAS  RE,PRNTOCOM                                                      
*                                                                               
PROCM05  MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKCLT,BCLT                                                  
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM CLIENT LEVEL?                    
         BNE   PROCM10                                                          
         BRAS  RE,PRNTOCOM                                                      
*                                                                               
PROCM10  MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKPRD+2(1),BPRD                                             
         CLI   BPRD,X'FF'          IF PRODUCT IS POL                            
         BNE   *+10                                                             
         MVC   OM$COMKPRD,=C'POL'  THEN USE CHARACTER REPRESENTATION            
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM PRD LEVEL?                       
         BNE   PROCM20                                                          
         BRAS  RE,PRNTOCOM                                                      
*                                                                               
PROCM20  DS    0H                                                               
         MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKEST,BEST                                                  
         MVC   OM$COMKFLT,SVBFLT                                                
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM EST/FLT LEVEL?                   
         BE    PROCM40                                                          
*                                                                               
         CLI   SVBFLT,0            ANY FLIGHT NUMBER?                           
         BE    PROCM30             NONE, LOOK UNDER THE 'ALL' PRODUCT           
         MVC   KEY,KEYSAVE         YES, MAYBE ONLY THE ESTIMATE LEVEL           
         MVI   OM$COMKFLT,0                                                     
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM EST/FLT LEVEL?                   
         BE    PROCM40                                                          
*                                                                               
PROCM30  MVC   KEY,KEYSAVE                                                      
         MVC   OM$COMKPRD,=C'ALL'  TRY WITH PRODUCT  'ALL'                      
         MVC   OM$COMKFLT,SVBFLT   AND THE FLIGHT AGAIN                         
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM EST LEVEL WITH PRD  ALL?         
         BE    PROCM40                                                          
*                                                                               
         CLI   SVBFLT,0            ANY FLIGHT NUMBER?                           
         BE    PROCM60             NONE, NOTHING FOR ESTIMATE OR FLIGHT         
         MVC   KEY,KEYSAVE         YES, MAYBE ONLY THE ESTIMATE LEVEL           
         MVI   OM$COMKFLT,0                                                     
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'OM$COMKEY),KEYSAVE   OCOM EST/FLT LEVEL?                   
         BNE   PROCM60                                                          
*                                                                               
PROCM40  BRAS  RE,PRNTOCOM                                                      
         DROP  R6                                                               
***************                                                                 
* DONE WITH OCOM RECORDS                                                        
***************                                                                 
PROCM60  CLC   0(L'SPACES,R4),SPACES    A LINE TO PRINT FROM BEFORE?            
         BE    PROCMX                                                           
         MVI   PASTCONT,C' '       YES                                          
         BRAS  RE,PRTLINE                                                       
*                                                                               
PROCMX   DS    0H                                                               
         DROP  R4                                                               
*********                                                                       
* BUYER FREE-FORM COMMENTS                                                      
*********                                                                       
PRBFF00  L     R4,APRTLINE                                                      
         USING PAGYCOMD,R4                                                      
         GOTO1 VALIBUYR,DMCB,ORSBUYR                                            
         L     R6,AIO                                                           
         MVI   ELCODE,BYRCMCDQ        X'15' - COMMENT ELEMENT                   
         BAS   RE,GETEL                                                         
         BNE   PRBFFX                                                           
*                                                                               
         USING BYRCMTD,R6                                                       
         CLC   BYROCMT1,SPACES                                                  
         BNH   PRBFF30                                                          
         MVC   PACMTID,=C'AGYCOM'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PACMTID(3),=C'VAR'                                               
*                                                                               
         MVC   PACMORDR,SVQCORDR                                                
         MVI   PACMCONT,C'*'       MORE LINES FOLLOW                            
         MVC   PACMTEXT(L'BYROCMT1),BYROCMT1                                    
*                                                                               
PRBFF30  CLC   BYROCMT2,SPACES                                                  
         BNH   PRBFFX                                                           
*                                                                               
         CLC   0(L'SPACES,R4),SPACES    A LINE TO PRINT FROM BEFORE?            
         BE    *+8                                                              
         BRAS  RE,PRTLINE                                                       
*                                                                               
         MVC   PACMTID,=C'AGYCOM'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PACMTID(3),=C'VAR'                                               
*                                                                               
         MVC   PACMORDR,SVQCORDR                                                
         MVI   PACMCONT,C'*'       MORE LINES FOLLOW                            
         MVC   PACMTEXT(L'BYROCMT2),BYROCMT2                                    
*                                                                               
PRBFFX   DS    0H                                                               
         DROP  R6                                                               
*********                                                                       
* AGENCY COMMENT                                                                
*********                                                                       
PRAGC00  LA    R6,KEY              LOOK UP THE ORDER COMMENT                    
         USING DOKEY,R6                                                         
         XC    KEY,KEY                                                          
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,BAGYMD                                                   
         MVC   DOKORDER,BINORDER                                                
         MVC   DOKSTA,BSTA                                                      
         MVI   DOKCMT,X'01'                                                     
         DROP  R6                                                               
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   PRAGC40                                                          
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
*                                                                               
         MVI   ELCODE,DOCOMELQ                                                  
         BAS   RE,GETEL                                                         
         BNE   PRAGC40                                                          
         MVI   BYTE,1              CURRENT LINE NUMBER OF RECORD                
*                                                                               
         CLC   0(L'SPACES,R4),SPACES    A LINE TO PRINT FROM BEFORE?            
         BNH   *+8                                                              
         BRAS  RE,PRTLINE                                                       
*                                                                               
         USING DOCOMELD,R6                                                      
PRAGC10  L     R4,APRTLINE                                                      
         USING PAGYCOMD,R4                                                      
*                                                                               
PRAGC20  MVC   PACMTID,=C'AGYCOM'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PACMTID(3),=C'VAR'                                               
*                                                                               
         MVC   PACMORDR,SVQCORDR                                                
         MVI   PACMCONT,C'*'       MORE LINES FOLLOW                            
         CLC   BYTE,DOCOMLIN       MAKE SURE WE GET THE RIGHT LINE              
         BE    PRAGC30                                                          
         BRAS  RE,PRTLINE                                                       
         ZIC   R1,BYTE                                                          
         AHI   R1,1                                                             
         STC   R1,BYTE                                                          
         B     PRAGC20                                                          
*                                                                               
PRAGC30  ZIC   R1,DOCOMLEN                                                      
         SH    R1,=Y(DOCOMOVH+1)                                                
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PACMTEXT(0),DOCOMTXT                                             
*                                                                               
         BAS   RE,NEXTEL                                                        
         BE    PRAGC10                                                          
*                                                                               
PRAGC40  CLC   0(L'SPACES,R4),SPACES    A LINE TO PRINT FROM BEFORE?            
         BNH   PRAGCX                                                           
         MVI   PACMCONT,C' '            NO MORE ORDER COMMENTS                  
         BRAS  RE,PRTLINE                                                       
*                                                                               
PRAGCX   DS    0H                                                               
         DROP  R4,R6                                                            
*********                                                                       
* DO THE AGENCY HIATUS WEEKS                                                    
*********                                                                       
PRHIATUS CLI   SVBPRD,X'FF'        POL ORDERS DON'T HAVE HIATUS WEEKS           
         BE    PRHIATX                                                          
         CLI   SVCXTRA+8,C'Y'      GOAL REQD FOR BUY?                           
         BNE   PRHIATX             NO, DON'T BOTHER WITH HIATUS WEEKS           
         CLC   =C'WI',AGENCY       WESTERN?                                     
         BE    PRHIATX             YES, DON'T SHOW HIATUS WEEKS                 
         BRAS  RE,PRTHIATS                                                      
PRHIATX  DS    0H                                                               
*********                                                                       
* DO THE VAR PRODUCTS                                                           
*********                                                                       
PRVPRODS CLI   SVBPRD,X'FF'        REG ORDERS DON'T HAVE VAR PRODUCTS           
         BNE   PRVPRODX                                                         
         TM    MISCFLG2,MF2VAROR                                                
         BZ    PRVPRODX                                                         
         BRAS  RE,PRVPRDS                                                       
PRVPRODX DS    0H                                                               
***************                                                                 
* DO THE BUYS NOW                                                               
***************                                                                 
         BRAS  RE,PRTBUYS                                                       
         BE    PRCLOSE                                                          
         TM    MISCFLG1,MF1DRREV   DOING DARE REVISIONS?                        
         BNZ   PRCLOSE             YES, SEND ORDER W/O BUYLINES                 
         TM    MISCFLG2,MF2PRSNT   PREVIOUSLY SENT?                             
         BNZ   PRCLOSE             YES, SHOW TO REP 'NO SPOTS'                  
         MVI   PQSW,X'FE'          FOOL GENCON TO THINK PQ IS                   
         LA    R2,ORSMEDH              NO OPENED                                
         B     NODATASN            NO DATA TO SEND                              
***************                                                                 
* DONE WITH OUR REPORT                                                          
***************                                                                 
PRCLOSE  L     R4,APRTLINE                                                      
         MVC   0(26,R4),=CL26'*** END OF DDS MESSAGE ***'                       
         BRAS  RE,PRTLINE                                                       
*                                                                               
         MVI   SPMODE,X'FF'        CLOSE THE PRINTQ                             
         BRAS  RE,PRTLINE                                                       
*                                                                               
         BRAS  RE,APRCLOSE                                                      
*********                                                                       
* TO GUARD AGAINST SPAWNING A HUGE NUMBER OF ORDERS AND DUMPING BECAUSE         
* THERE IS NO MORE ROOM IN DATAMGR'S LOCKTABLE                                  
*                                                                               
* BEGIN                                                                         
*********                                                                       
         GOTO1 DATAMGR,DMCB,=C'DMUNLK',=C'SPTFILE'                              
*********                                                                       
* END                                                                           
*                                                                               
* TO GUARD AGAINST SPAWNING A HUGE NUMBER OF ORDERS AND DUMPING BECAUSE         
* THERE IS NO MORE ROOM IN DATAMGR'S LOCKTABLE                                  
*********                                                                       
PRAUTH   BRAS  RE,CHKAUTH                                                       
*                                                                               
PRXIT    TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         TM    MISCFLG1,MF1TRDRC   WE HAVE A TRADE CONDITION?                   
         BNZ   PRXIT1              YES, GO BACK AND DO TRADE                    
*                                                                               
         TM    BITFLAG,BFRCLLNG    AUTORECALL FROM BUY PROGRAM?                 
         BNZ   *+12                                                             
         CLI   ACTNUM,ACTXMIT      DONE WITH THE TRANSMIT?                      
         BNE   PRXIT1                                                           
         XC    CONACT,CONACT                                                    
         MVC   CONACT(4),=CL4'SEND'                                             
         OI    CONACTH+6,X'80'                                                  
         MVI   ACTNUM,ACTSEND                                                   
         NI    BITFLAG,X'FF'-BFRCLLNG  YES, RETURN                              
         MVI   PFKEY,12                                                         
         BRAS  RE,SETPFKYS         SETUP THE PFKEYS                             
         B     XIT                                                              
*                                                                               
PRXIT1   TM    MISCFLG1,MF1DRTRD   PRINTED TRADE ORDER?                         
         BNZ   *+12                                                             
         OI    CASHFLG1,ONTHEWAY     CASH ORDER IS ON ITS WAY                   
         B     XIT                                                              
         OI    TRDEFLG1,ONTHEWAY     TRADE ORDER IS ON ITS WAY                  
         B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* ROUTINE FOR THE OCOM RECORDS                                                  
*                                                                               
* ON ENTRY: R4  APRTLINE                                                        
*                                                                               
***********************************************************************         
PRNTOCOM NTR1  BASE=*,LABEL=*                                                   
         USING PAGYSTDD,R4                                                      
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
*                                                                               
         MVI   ELCODE,X'05'        COMMENT TEXT ELEMENT?                        
         BAS   RE,GETEL                                                         
         BNE   PRTOCMX                                                          
PRTOCM10 CLC   0(L'SPACES,R4),SPACES    A LINE TO PRINT FROM BEFORE?            
         BNH   *+8                                                              
         BRAS  RE,PRTLINE                                                       
*                                                                               
         MVC   PASTTID,=C'AGYSTD'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PASTTID(3),=C'VAR'                                               
*                                                                               
         MVC   PASTORDR,SVQCORDR                                                
         MVI   PASTCONT,C'*'       MORE LINES FOLLOW                            
         ZIC   R1,1(R6)                                                         
         SHI   R1,3                OVERHEAD AND 1 MORE FOR EX                   
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   PASTTEXT(0),2(R6)                                                
*                                                                               
         BAS   RE,NEXTEL                                                        
         BE    PRTOCM10                                                         
*                                                                               
PRTOCMX  B     XIT                                                              
         DROP  R4                                                               
***************                                                                 
* AFTER EVERY CALL TO PRTLINE, R1 WILL CONTAIN A(198 CHAR PRINT LINE)           
* ROUTINE IS SHARED BTWM PR AND PRNTOCOM                                        
***************                                                                 
PRTLINE  LR    R0,RE                                                            
         L     R1,AGYNMRCS         INCREMENT NUMBER OF RECORDS PRINTED          
         AHI   R1,1                                                             
         ST    R1,AGYNMRCS                                                      
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SETS UP THE PRINT QUEUE FOR US                                                
***********************************************************************         
OPENSPQ  NTR1  BASE=*,LABEL=*                                                   
         MVC   REMUSER,=C'DAR'                                                  
         LA    R1,SPOOLKEY                                                      
         USING PQPLD,R1                                                         
         XC    SPOOLKEY,SPOOLKEY                                                
         MVC   PLDESC,=CL11'DARE ORDER'                                         
         OI    GENSTAT3,NOCLRSPK   DON'T CLEAR SPOOL KEY IN OPENPQ              
         MVI   PLCLASS,C'G'                                                     
         OI    SPOOLIND,SPUINIT    ALLOWS ME TO SET THE CLASS                   
         DROP  R1                                                               
         XC    BIGSPLKY,BIGSPLKY                                                
         LA    R1,BIGSPLKY                                                      
         ST    R1,SPOOLQLK                                                      
         USING PQPLD,R1                                                         
         MVC   QLRETNL,=H'48'      SET PRINTQ RETAIN TIMES  48 ACTIVE           
         MVC   QLRETND,=H'24'                               24 PRINTED          
         MVI   QLLINET,X'C0'       SET WIDTH TO WHAT IS IN QLLINEW              
         MVI   QLLINEW,198                                                      
         DROP  R1                                                               
*                                                                               
         GOTO1 OPENPQ              OPEN PRINTQ MYSELF                           
*                                                                               
         LA    R6,DOXMELEM         SAVE THE REPORT NUMBER IN ORIGIN ID          
         USING DOXMTELD,R6                                                      
         MVC   DOXMTOID,TWAORIG                                                 
         DROP  R6                                                               
*                                                                               
         OI    BITFLAG,X'20'                                                    
*                                                                               
OPQX     B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PUTS OUT THE AGENCY DESCRIPTION RECORDS                                       
***********************************************************************         
PRTDESCS NTR1  BASE=*,LABEL=*                                                   
***************                                                                 
* PUT OUT AGENCY DESCRIPTION LINE 1                                             
***************                                                                 
         L     R2,APRTLINE                                                      
         USING PAGYDS1D,R2                                                      
         MVC   PAD1TID,=C'AGYDS1'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PAD1TID(3),=C'VAR'                                               
*                                                                               
         MVC   PAD1ORDR,SVQCORDR                                                
         MVC   PAD1AGNM(L'USERNAME),USERNAME                                    
         MVC   PAD1AGAD(L'USERADDR),USERADDR                                    
         DROP  R2                                                               
*                                                                               
         BRAS   RE,PRTLINE                                                      
***************                                                                 
* PUT OUT AGENCY DESCRIPTION LINE 2                                             
***************                                                                 
         L     R2,APRTLINE                                                      
         USING PAGYDS2D,R2                                                      
         MVC   PAD2TID,=C'AGYDS2'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PAD2TID(3),=C'VAR'                                               
*                                                                               
         MVC   PAD2ORDR,SVQCORDR                                                
         MVC   PAD2CLTN(L'CLTNM),CLTNM                                          
         MVC   PAD2ESTN(L'ESTNM),ESTNM                                          
         OC    ESTDEMOS(3),ESTDEMOS                                             
         BZ    PRDS2100                                                         
*                                                                               
         CLI   ORSINDMH+5,0                                                     
         BE    PRDS230                                                          
         CLI   ORSINDM,C'N'                                                     
         BE    PRDS2100                                                         
         B     PRDS240                                                          
*                                                                               
PRDS230  CLI   PDARDEMS,C'Y'                                                    
         BE    PRDS240                                                          
         CLI   PDARDEMS,C'1'        CAN HAVE C'N' OR UPTO 4 DEMOS               
         BL    PRDS2100                                                         
         CLI   PDARDEMS,C'4'                                                    
         BH    PRDS2100                                                         
*                                                                               
PRDS240  L     R2,APRTLINE                                                      
         USING PAGYDS2D,R2                                                      
         LA    R1,ESTDEMOS                                                      
         LA    R3,PAD2TDEM                                                      
*                                                                               
         LA    R4,ESTDEMOS+12       ONLY FOUR DEMOS NEEDED                      
*        CLI   ORSINDM,C'1'         DID USER ENTER 1-4?                         
*        BL    PRDS250                                                          
         MVC   BYTE,PDARDEMS                                                    
         NI    BYTE,X'0F'                                                       
         XR    RE,RE                                                            
         IC    RE,BYTE                                                          
         MHI   RE,3                                                             
         LA    R4,0(R1,RE)                                                      
*                                                                               
PRDS250  OC    0(3,R1),0(R1)                                                    
         BZ    PRDS2100                                                         
         CR    R1,R4                                                            
         BNL   PRDS2100                                                         
         MVC   0(1,R3),1(R1)                                                    
         EDIT  (B1,2(R1)),(3,1(R3)),ALIGN=RIGHT,ZERO=NOBLANK,          *        
               FILL=0                                                           
         LA    R3,4(R3)                                                         
         LA    R1,3(R1)                                                         
         B     PRDS250                                                          
*                                                                               
         DROP  R2                                                               
*                                                                               
PRDS2100 BRAS  RE,PRTLINE                                                       
***************                                                                 
* PUT OUT AGENCY DESCRIPTION LINE 3                                             
***************                                                                 
         L     R2,APRTLINE                                                      
         USING PAGYDS3D,R2                                                      
         MVC   PAD3TID,=C'AGYDS3'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PAD3TID(3),=C'VAR'                                               
*                                                                               
         MVC   PAD3ORDR,SVQCORDR                                                
         MVC   PAD3PRDN(L'PRDNM),ORSPRXP                                        
         MVC   PAD3PR2N(L'PRD2NM),ORSPRXP+L'PRDNM+1                             
         DROP  R2                                                               
*                                                                               
         BRAS  RE,PRTLINE                                                       
***************                                                                 
* PUT OUT AGENCY DESCRIPTION LINE 4                                             
***************                                                                 
         L     R2,APRTLINE                                                      
         USING PAGYDS4D,R2                                                      
         MVC   PAD4TID,=C'AGYDS4'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PAD4TID(3),=C'VAR'                                               
*                                                                               
         MVC   PAD4ORDR,SVQCORDR                                                
         MVC   PAD4BUYR(L'ORSBUYR),ORSBUYR                                      
         MVC   PAD4BYRN(L'QBUYER),QBUYER                                        
         MVC   PAD4BYRT(L'QPHONE),QPHONE                                        
         MVC   PAD4BYRX(L'QPHONEXT),QPHONEXT                                    
         DROP  R2                                                               
*                                                                               
         BRAS  RE,PRTLINE                                                       
***************                                                                 
* PUT OUT AGENCY DESCRIPTION LINE 5                                             
***************                                                                 
         CLI   QMED,C'R'           DATA RECORD IS MEANT ONLY FOR RADIO          
         BNE   PRTDSCX                                                          
         L     R2,APRTLINE                                                      
         USING PAGYDS5D,R2                                                      
         MVC   PAD5TID,=C'AGYDS5'     TRANSMISSION ID                           
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PAD5TID(3),=C'VAR'                                               
*                                                                               
         MVC   PAD5ORDR,SVQCORDR                                                
         MVC   PAD5SALP,SALESCOD   SALESPERSON CODE                             
         MVI   PAD5UNWR,C'N'                                                    
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING DOSPELD,R6                                                       
         TM    DOSPFLG1,DOSPPPER                                                
         BZ    *+8                                                              
         MVI   PAD5UNWR,C'Y'                                                    
         DROP  R2,R6                                                            
*                                                                               
         BRAS  RE,PRTLINE                                                       
PRTDSCX  J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* STRIP THE PHONE NUMBER OF HYPENS AND PARENTHESIS                              
***********************************************************************         
STRPPHNE NTR1  BASE=*,LABEL=*                                                   
         LA    RE,QPHONE           STRIP PHONE NUMBER OF HYPHENS                
         LA    RF,L'QPHONE             AND PARENTHESIS                          
STPH10   CLI   0(RE),C'('                                                       
         BE    STPH20                                                           
         CLI   0(RE),C')'                                                       
         BE    STPH20                                                           
         CLI   0(RE),C'-'                                                       
         BNE   STPH30                                                           
STPH20   LR    R1,RF                                                            
         SHI   R1,2                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RE),1(RE)                                                    
         LA    R1,0(RF,RE)                                                      
         BCTR  R1,0                                                             
         MVI   0(R1),C' '                                                       
         B     *+8                                                              
STPH30   LA    RE,1(RE)                                                         
         BCT   RF,STPH10                                                        
         B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* WRITE/ADD COLOR PASSIVE KEY                                                   
*                                                                               
* ON ENTRY: PARAM1                 NEW COLOR(1 CHAR)                            
*           DISKADDR IS SET                                                     
*                                                                               
***********************************************************************         
COLPASKY NTR1  BASE=*,LABEL=*                                                   
         MVC   BYTE,0(R1)                                                       
         CLI   PQONLY,C'Y'                                                      
         JE    XIT                                                              
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         MVC   PREVKEY,DOKEY                                                    
         MVI   ELCODE,COLELQ                                                    
         BAS   RE,GETEL                                                         
         BE    CPK020                                                           
*                                                                               
* ADD NEW COLOR ELEMENT THEN ADD PASSIVE KEY                                    
*                                                                               
         LA    R2,COLOELEM                                                      
         USING COLOREL,R2                                                       
         XC    COLOELEM,COLOELEM                                                
         MVI   COLEL,COLELQ                                                     
         MVI   COLELLEN,COLLENQ                                                 
         MVC   COLCOL,BYTE                                                      
         MVC   COLDATE,CFFDATE                                                  
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         LA    R6,DORFRST                                                       
CPK005   CLI   0(R6),0             IF NO MORE ELEMENTS                          
         BE    CPK010              ADD AT TO THE END                            
         CLI   0(R6),COLELQ        ELSE ADD AFTER ALL ELEMENTS                  
         BNL   CPK010              < X'13'                                      
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     CPK005                                                           
CPK010   GOTO1 RECUP,DMCB,(C'S',AIO),COLOELEM,(R6)                              
         DROP  R6                                                               
*                                                                               
         LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         MVI   DSCKTYPE,DSCKTYPQ   X'0D'                                        
         MVI   DSCKSTYP,DSCKSTYQ   X'B8'                                        
         MVC   DSCKAGMD,BAGYMD                                                  
         MVC   DSCKBYR,ORSBUYR                                                  
         OC    DSCKBYR,SPACES                                                   
         MVC   DSCKSTAT,BYTE                                                    
         MVC   DSCKDATE,CFFDATE                                                 
         MVC   DSCKORDR,BINORDER                                                
         OI    DMINBTS,X'08'       PASS BACK DELETED RECORDS                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BE    CPKUNDEL                                                         
         B     CPKADD                                                           
         DROP  R4                                                               
*                                                                               
* FROM HERE, COLOR ELEMENT EXISTS                                               
*                                                                               
         USING COLOREL,R6                                                       
CPK020   LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         MVI   DSCKTYPE,DSCKTYPQ   X'0D'                                        
         MVI   DSCKSTYP,DSCKSTYQ   X'B8                                         
         MVC   DSCKAGMD,BAGYMD                                                  
         MVC   DSCKBYR,ORSBUYR                                                  
         OC    DSCKBYR,SPACES                                                   
         MVC   DSCKSTAT,COLCOL                                                  
         MVC   DSCKDATE,COLDATE                                                 
         MVC   DSCKORDR,BINORDER                                                
*                                                                               
         OI    DMINBTS,X'08'       PASS BACK DELETED RECORDS                    
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   CPKUPDAT            NO PASSIVE KEY (MUST RESTORE KEY)            
*                                                                               
         OI    DMINBTS,X'08'       PASS BACK DELETED RECORDS                    
         MVI   RDUPDATE,C'Y'       NOW WE CAN UPDATE                            
         GOTO1 HIGH                                                             
         CLC   DSCKSTAT,BYTE                                                    
         BNE   CPKDELET            TURN DELETE BIT ON                           
         CLC   DSCKDATE,CFFDATE                                                 
         BNE   CPKDELET            TURN DELETE BIT ON                           
*                                                                               
* UNDELETE THE KEY AND UPDATE                                                   
*                                                                               
CPKUNDEL TM    KEY+13,X'80'                                                     
         BZ    CPKXIT              JUST EXIT                                    
CPKWRITE NI    KEY+13,X'FF'-X'80'  ELSE UNDELETE,                               
         GOTO1 WRITE               UPDATE KEY THEN                              
         B     CPKXIT              EXIT                                         
*                                                                               
CPKDELET DS    0H                                                               
         TM    KEY+13,X'80'        DELETE BIT ON?                               
         BNZ   CPKUPDAT            NO                                           
         OI    KEY+13,X'80'        YES: TURN DELETE BIT ON                      
         GOTO1 WRITE               AND UPDATE KEY                               
*                                                                               
*  UPDATE COLOR ELEMENT AND WRITE/ADD PASSIVE KEY                               
CPKUPDAT DS    0H                                                               
         MVC   COLCOL,BYTE                                                      
         MVC   COLDATE,CFFDATE                                                  
*                                                                               
         MVC   KEY,KEYSAVE         RESTORE THE KEY                              
         MVC   DSCKSTAT,BYTE                   NEW COLOR                        
         MVC   DSCKDATE,CFFDATE                TODAYS DATE                      
*                                                                               
         OI    DMINBTS,X'08'       PASS BACK DELETED RECORDS                    
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   CPKADD              KEY DOESN'T EXISTS, ADD IT                   
         OI    DMINBTS,X'08'       PASS BACK DELETED RECORDS                    
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 HIGH                                                             
         CLC   DISKADDR,KEY+14     SAME DISK ADDRESS AS WELL?                   
         BE    CPKUNDEL            KEY EXISTS, UNDELETE IT                      
         MVC   KEY+14(4),DISKADDR  SAME DISK ADDRESS AS WELL?                   
         B     CPKWRITE                                                         
*                                  ELSE ADD                                     
CPKADD   DS    0H                                                               
         LA    R4,KEY                                                           
         USING DOKEY,R4                                                         
         MVC   KEY,KEYSAVE                                                      
         MVC   DSCKSTAT,BYTE                                                    
         MVC   DSCKDATE,CFFDATE                                                 
         MVC   KEY+14(4),DISKADDR                                               
         GOTO1 ADD                                                              
         DROP  R4                                                               
*                                                                               
CPKXIT   L     R6,AIO              RESTORE KEY BECAUSE A WRITE CLOBBERS         
         USING DOKEY,R6                WHAT IS IN AIO                           
         MVC   DOKEY,PREVKEY                                                    
         B     XIT                                                              
         DROP  R6                                                               
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO SET THE TRADE METHOD IN THE CASH ORDER                             
***********************************************************************         
SETMETHD NTR1  BASE=*,LABEL=*                                                   
         XC    KEY,KEY                                                          
         LA    R6,KEY              FIND THE CASH ORDER RECORD                   
         USING DOKEY,R6                                                         
         MVI   DCKTYPE,DCKTYPQ                                                  
         MVI   DCKSUBTY,DCKSTYPQ                                                
         MVC   DCKAGMD,BAGYMD                                                   
         MVC   DCKCLT,BCLT                                                      
         MVC   DCKPRD,SVBPRD                                                    
         MVC   DCKEST,SVBEST                                                    
         MVC   DCKSTA,BSTA                                                      
         MVC   DCKPRD2,SVBPR2                                                   
         MVC   DCKFLTNM,SVBFLT                                                  
         GOTO1 HIGH                                                             
         CLC   KEY(L'DBTKEY),KEYSAVE                                            
         BNE   STMTHX              NO CASH ORDER, FORGETABOUTIT                 
         MVC   DISKADDR,KEY+14                                                  
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         MVC   SVDORDER,BINORDER                                                
         MVC   BINORDER,DOKORDER   GET BINARY ORDER NUMBER OF CASH              
*                                                                               
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   STMTH20                                                          
*                                                                               
         USING DOSPELD,R6                                                       
         TM    DOSPTMTH,X'40'      CASH HAS UPPER CASE?                         
         BZ    STMTH05                                                          
         NI    DOSPTMTH,X'FF'-X'40'   MAKE LOWER CASE FOR CASH                  
         B     STMTH50                                                          
STMTH05  CLI   DOSPTMTH,0             ACTUALLY NON-ZERO?                        
         BNE   STMTH50                YES, NO NEED TO WRITE RECORD OUT          
*                                                                               
N        USING DOSPELD,DOSPELEM                                                 
         MVC   N.DOSPFLG1(DOSPTMTH-DOSPFLG1),DOSPFLG1                           
         NI    DOSPELEM+DOSPTMTH-DOSPELD,X'FF'-X'40'   LOWER FOR CASH           
*        NI    N.DOSPTMTH,X'FF'-X'40' LOWER FOR CASH                            
         MVC   N.DOSPDEST(DOSPFAID-DOSPDEST+2),DOSPDEST                         
         MVC   N.DOSPFAID,DOSPFAID                                              
         B     STMTH35                                                          
         DROP  N,R6                                                             
*                                                                               
STMTH20  LA    R6,DOSPELEM                                                      
         USING DOSPELD,R6                                                       
         MVI   DOSPEL,DOSPELQ                                                   
         MVI   DOSPLEN,DOSPLNQ2                                                 
         XC    DOSPFLG1(DOSPTMTH-DOSPFLG1),DOSPFLG1                             
         CLI   AVNEW,C'P'                                                       
         BNE   *+8                                                              
         OI    DOSPFLG1,DOSPAVN                                                 
         NI    DOSPTMTH,X'FF'-X'40'   MAKE LOWER CASE FOR CASH                  
         MVC   DOSPCRTR,TWAORIG    SAVE THE CREATOR OF THE ORDER                
         XC    DOSPDEST(DOSPFAID-DOSPDEST+2),DOSPDEST                           
         MVC   DOSPFSTA,BSTA                                                    
         DROP  R6                                                               
         L     R6,AIO              WHERE TO INSERT THIS BABY?                   
         USING DOKEY,R6                                                         
         LA    R6,DORFRST                                                       
         XR    R0,R0                                                            
STMTH30  CLI   0(R6),0                                                          
         BE    STMTH40                                                          
         CLI   0(R6),DOSPELQ                                                    
         BH    STMTH40                                                          
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     STMTH30                                                          
         DROP  R6                                                               
*                                                                               
STMTH35  GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)      DELETE OLD DOSPEL           
STMTH40  GOTO1 RECUP,DMCB,(C'S',AIO),DOSPELEM,(R6)  ADD NEW DOSPEL              
*                                                                               
STMTH50  CLI   ORSXMIT,C'T'        JUST SENDING TRADE?                          
         BNE   STMTH60                                                          
         TM    MISCFLG1,MF1CSHRC   DO WE HAVE A CASH BUYLINE?                   
         BNZ   STMTH60                YES, DON'T CARE                           
*                                                                               
STMTH53  CLI   0(R6),0                                                          
         BE    STMTH56                                                          
         CLI   0(R6),X'11'         EVER SENT BEFORE?                            
         BE    STMTH60             YES, WE'RE DONE                              
         BH    STMTH56             NO                                           
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     STMTH53                                                          
*                                                                               
STMTH56  GOTOR COLPASKY,DMCB,(C'K',0)                                           
*                                                                               
         LA    R2,DOXMELEM                                                      
         USING DOXMTELD,R2                                                      
         MVC   DOXMTOID,TWAORIG                                                 
         MVC   DOXMTDID,=X'FFFE'   SET DESTID=NOBODY                            
         MVC   DOXMTSTD,DOXMTYMD                                                
         MVC   DOXMTSTT,DOXMTTIM                                                
         MVI   DOXMTSTA,QEMPTY     NO BUYS                                      
         DROP  R2                                                               
         BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)  CASH IS EMPTY               
         OI    CASHFLG1,NOBYSEXS                                                
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ                                                  
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,QEMPTY     NO BUYS                                      
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
STMTH57  CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS            
         BE    STMTH58           AND BEFORE AN AUDIT ELEMENT                    
         CLI   0(R6),DOSTELQ                                                    
         BNL   STMTH58                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     STMTH57                                                          
*                                                                               
STMTH58  GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
STMTH60  BRAS  RE,MYPUTREC                                                      
         MVC   BINORDER,SVDORDER                                                
STMTHX   B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
*---------------------------------------------------------------------*         
* CREATE A SOON JOB TO FAX THE SDX REPORT TO NON-DARE REP             *         
*---------------------------------------------------------------------*         
         SPACE 1                                                                
FAX      NTR1  BASE=*,LABEL=*                                                   
         TM    MISCFLG2,MF2RCLNG   RECALLING, SO ADD A SENT PENDING?            
         BZ    FAX05                                                            
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         LA    R3,DOXMELEM         ADD A NEW TRANSMISSION ELEM                  
         USING DOXMTELD,R3                                                      
         MVC   DOXMTOID,TWAORIG                                                 
         GOTO1 DATCON,DMCB,(5,0),(19,DOXMTYMD)    SET THE CURRENT DATE          
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    FAX00                                                            
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
         GOTO1 DATCON,DMCB,(0,DUB),(19,DOXMTYMD)                                
*                                                                               
FAX00    ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DOXMTTIM                                                    
*                                                                               
         MVC   DOXMTSTD,DOXMTYMD                                                
         MVC   DOXMTSTT,DOXMTTIM                                                
         MVI   DOXMTSTA,QSNTPNDG   SENT PENDING RECALL ACKNOWLEDGEMENT          
         DROP  R3                                                               
*                                                                               
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
*                                                                               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT IN RECORD)              
         DROP  R6                                                               
FAX01    CLI   0(R6),0             NEW TRANSMISSION ELEMENT GOES                
         BE    FAX02                   AFTER ID ELEMENTS                        
         CLI   0(R6),DORPELQ                                                    
         BNL   FAX02                                                            
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     FAX01                                                            
*                                                                               
FAX02    BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)                              
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ                                                  
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,QSNTPNDG   SENT PENDING RECALL ACKNOWLEDGEMENT          
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
FAX03    CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS            
         BE    FAX04             AND BEFORE AN AUDIT ELEMENT                    
         CLI   0(R6),DOSTELQ                                                    
         BNL   FAX04                                                            
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     FAX03                                                            
*                                                                               
FAX04    GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         GOTOR COLPASKY,DMCB,(C'G',0)                                           
*                                                                               
         BRAS  RE,MYPUTREC         THIS PUTREC IS FOR THE ORDER RECORD          
*                                                                               
         BRAS  RE,UPDEXTRA         UPDATE THE X'05' EXTRA RECORD                
*                                                                               
         B     FAXXIT                                                           
***********************************                                             
* WE NEED REVISION NUMBER AND DATES TO PUT ON THE SECOND REQUEST CARD           
* WE'LL SAVE WHAT WE NEED INTO SVREVDAT                                         
***********************************                                             
FAX05    XC    SVREVDAT,SVREVDAT                                                
         MVI   WORK,1              IF ORIG, THEN CURRENT IS 1 & PREV 0          
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOXMTELQ     ANY X'11' ELEM (TRANSMISSION)?               
         BAS   RE,GETEL                                                         
         BNE   FAX08               NONE, NEVER BEEN SENT                        
         USING DOXMTELD,R6                                                      
         GOTO1 DATCON,DMCB,(8,DOXMTYMD),(2,SVPRVDAT)                            
         DROP  R6                                                               
*                                                                               
FAX08    L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         USING DOSPELD,R6                                                       
         MVC   SVCURREV,DOSPREVN   SAVE CURR REV NUMBER                         
         MVC   SVPREREV,DOSPREVN   SAVE PREV REV NUMBER                         
*                                                                               
         CLI   NEWFAX,C'Y'         TEST NEW FAX                                 
         BNE   FAX08A                                                           
         MVC   SVCURREV,DOSPFXRV   SAVE CURR REV NUMBER                         
         MVC   SVPREREV,DOSPFXRV   SAVE PREV REV NUMBER                         
*                                                                               
FAX08A   SR    R0,R0                                                            
         IC    R0,DOSPREVN         GET THE REVISION NUMBER                      
         BRAS  RE,CHECKCNF         WAS LAST STATUS OF ORDER CONFIRMED?          
         BNE   FAX08B              NO, DON'T INC REVISION                       
*        IC    R0,DOSPREVN         GET THE REVISION NUMBER                      
         AHI   R0,1                                                             
         STC   R0,DOSPREVN         BUMP IT UP BY ONE                            
         CHI   R0,255                                                           
         BH    TWOMNYRV            TOO MANY REVISIONS FOR THIS ORDER!           
*                                                                               
FAX08B   CLI   NEWFAX,C'Y'         TEST NEW FAX?                                
         BNE   FAX08D              NO, DISPLAY REV                              
         TM    MISCFLG2,MF2PRSNT   TEST FIRST TIME                              
         BZ    FAX09               YES - IGNORE RESEND/REV=0                    
         CLI   ORSRSND,C'Y'        TEST RESEND                                  
         BE    FAX09                                                            
         IC    R0,DOSPFXRV         GET THE NEWFAX REVISION NUMBER               
         AHI   R0,1                BUMP IT UP BY ONE VERSION                    
         STC   R0,DOSPFXRV                                                      
         CHI   R0,255                                                           
         BH    TWOMNYRV            TOO MANY REVISIONS FOR THIS ORDER!           
FAX08D   STC   R0,SVCURREV         SAVE CURR REV NUMBER                         
*                                                                               
         LA    R1,ORSCREVH                                                      
         TM    MISCFLG1,MF1DRTRD   CASH REVISION?                               
         BZ    *+8                 YES                                          
         LA    R1,ORSTREVH         NO, TRADE REVISION                           
         SR    R6,R6               CLEAR R6                                     
         BRAS  RE,SHOWREV                                                       
         OI    6(R1),X'80'         TRANSMIT FIELD                               
*                                                                               
FAX09    L     R6,AIO                                                           
         USING DOKEY,R6                                                         
* BUILD DAY/TIME ELEMENT                                                        
         BRAS  RE,BLDDAYTM                                                      
         LA    R2,DOXMELEM                                                      
         USING DOXMTELD,R2                                                      
         MVC   DOXMTDID,=X'FFFF'   SET DESTID=FAX                               
         MVC   DOXMTOID,TWAORIG    WHY DID I LEAVE THIS OUT????                 
         CLC   =C'EML:',ORSROUT                                                 
         BNE   *+10                                                             
         MVC   DOXMTDID,=X'FFFD'   SET DESTID=EML                               
         DROP  R2                                                               
*                                                                               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT IN RECORD)              
         DROP  R6                                                               
FAX10    CLI   0(R6),0             EOR?                                         
         BE    FAX15               YES                                          
         CLI   0(R6),DOSPELQ       NEW TRANSMISSION ELEMENT GOES                
         BH    FAX15                   AFTER ALL ID ELEMENTS                    
         BL    FAX14                                                            
*                                                                               
         USING DOSPELD,R6                                                       
         MVC   DOSPELEM,DOSPEL     MAKE A COPY OF THE DOSP                      
         XC    DOSPFAID,DOSPFAID                                                
         CLC   SVAIRDAT,=X'FFFF'                                                
         BE    *+10                                                             
         MVC   DOSPFAID,SVAIRDAT   SAVE THE FIRST AIR DATE                      
         CLI   DOSPTMTH,0          ALREADY HAVE TRADE METHOD IN?                
         BNE   FAX14                                                            
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    FAX12                                                            
         OI    DOSPFLG1,DOSPTRDE                                                
         MVI   DOSPTMTH,TRDESREP     USING SPECIAL REP CODE FOR TRADE           
         B     FAX13                                                            
*                                                                               
FAX12    OC    PDARTSRP(3),PDARTSRP ANY SPECIAL REP IN DARE PROFILE?            
         BZ    FAX14                NONE                                        
         CLC   PDARTSRP(3),ZEROS                                                
         BE    FAX14                NONE                                        
*                                                                               
         TM    MISCFLG1,MF1TRDRC   NO TRADE CONDITION?                          
         BZ    FAX14               NONE, LEAVE EVERYTHING ALONE                 
         MVI   DOSPTMTH,TRDESREP-X'40'   LOWERCASE FOR CASH (X'99')             
*                                                                               
FAX13    MVC   DOSPTDAT(3),PDARTSRP  SPECIAL REP CODE USED STORED HERE          
         DROP  R6                                                               
*                                                                               
FAX14    ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     FAX10                                                            
*                                                                               
FAX15    BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)                              
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ2                                                 
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,DFXSENT    FAX SENT                                     
         CLI   ORSRSND,C'Y'                                                     
         BNE   *+8                                                              
         MVI   DOSTSTAT,DFXRSNT    SET FAX RESENTED                             
         CLC   =C'EML:',ORSROUT                                                 
         BNE   *+8                                                              
         MVI   DOSTSTAT,DEMSENT    EMAIL SENT                                   
         MVC   DOSTIDNM,TWAORIG                                                 
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
FAX20    CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS            
         BE    FAX25             AND BEFORE AN AUDIT ELEMENT                    
         CLI   0(R6),DOSTELQ                                                    
         BNL   FAX25                                                            
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     FAX20                                                            
*                                                                               
FAX25    GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         L     R6,AIO              LOOK FOR SAVED BDE COMMON                    
         MVI   ELCODE,DOEMLELQ                                                  
         BAS   RE,GETEL                                                         
         BNE   FAX27               NONE, MIGHT NEED TO ADD ONE                  
         CLC   =C'EML:',ORSROUT    NEED TO SAVE BDE COMMON?                     
         BE    FAX26               YES, WE MIGHT HAVE A NEW ONE                 
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6)     DON'T NEED THIS ANYMORE           
         B     FAX30                                                            
*                                                                               
         USING DOEMLD,R6                                                        
FAX26    MVC   DOEMLBDE,ORSROUT+5  SAVE THE CURRENT BDE COMMON NAME             
         B     FAX30                                                            
         DROP  R6                                                               
*                                                                               
FAX27    CLC   =C'EML:',ORSROUT    NEED TO SAVE BDE COMMON?                     
         BNE   FAX30               NOT EMAIL                                    
*                                                                               
         LA    R4,DOEMELEM                                                      
         USING DOEMLD,R4                                                        
         XC    DOEMELEM,DOEMELEM                                                
         MVI   DOEMLEL,DOEMLELQ                                                 
         MVI   DOEMLLEN,DOEMLLNQ                                                
         MVC   DOEMLBDE,ORSROUT+5  SAVE THE BDE COMMON NAME                     
         GOTO1 RECUP,DMCB,(C'S',AIO),DOEMELEM,(R6)                              
         DROP  R4                                                               
*                                                                               
FAX30    TM    MISCFLG3,MF3PRVCF   PREVIOUSLY CONFIRMED?                        
         BNZ   FAX33                                                            
         TM    MISCFLG2,MF2PRSNT   PREVIOUSLY SENT?                             
         BZ    FAX35                                                            
*                                                                               
FAX33    BRAS  RE,FAKELMRC                                                      
*                         >>>     <<<  USE LAST METHOD I BUILT IN AIO3          
         GOTO1 ,DMCB,(X'40',ORSDESTH),ORSROUTH,(MISCFLG3,EDIDATE),0             
*&&DO                                                                           
* REMOVING FORCING FAX TO MEDIAOCEAN BECAUSE OF OOW  WHOA  2007-05-21           
         TM    MISCFLG4,MF4MOFAX      FAXING OOW TO MO                          
         BZ    *+8                                                              
         OI    DMCB+4,X'80'        MUST FAX                                     
*&&                                                                             
         GOTO1 RD4ROUTE,DMCB                                                    
*                                                                               
         CLC   GERROR,=AL2(NODRADM)   REP DOESN'T HAVE A FAX # ANYMORE?         
         JE    ERREXIT                YES, USE WHAT WE HAD LAST                 
         CLC   GERROR,=AL2(NODESTN)   NO DESTINE RECORD?                        
         JE    ERREXIT                YES, USE WHAT WE HAD LAST                 
*                                                                               
         NI    MISCFLG3,X'FF'-MF3NOOFF                                          
         TM    DMCB,X'80'          REP DOES NOT APPEND OFFICE?                  
         BZ    *+8                                                              
         OI    MISCFLG3,MF3NOOFF                                                
         B     FAX40                                                            
*                                                                               
FAX35    GOTO1 RD4ROUTE,DMCB,ORSDESTH,(X'80',ORSROUTH),(MISCFLG3,EDIDATX        
               E),0                                                             
         CLC   GERROR,=AL2(NODRADM)   REP DOESN'T HAVE A FAX # ANYMORE?         
         BE    FAX33                  YES, USE WHAT WE HAD LAST                 
         CLC   GERROR,=AL2(NODESTN)   NO DESTINE RECORD?                        
         BE    FAX33                  YES, USE WHAT WE HAD LAST                 
*                                                                               
*   DON'T CARE ABOUT RETURN CODE HERE                                           
*                                                                               
FAX40    L     R6,AIO2             SOME RECORD FROM RD4ROUTE                    
         XC    ELEM,ELEM                                                        
         LA    R1,ELEM                                                          
         USING DOWIGELD,R1                                                      
         MVI   DOWIGEL,DOWIGELQ    X'50' - WHERE'D IT GO ELEM                   
         MVI   DOWIGLEN,DOWIGLNQ                                                
         CLC   =C'EML:',ORSROUT                                                 
         BNE   FAX45                                                            
         MVI   DOWIGMTH,C'E'                                                    
         LA    R6,GBDRFST(R6)                                                   
         MVI   ELCODE,GBEIDQ       X'02' - EMAIL ID ELEMENT                     
         BAS   RE,NEXTEL                                                        
         BNE   FAX83                                                            
         USING GBEELD,R6                                                        
         MVC   DOWIGEML,GBEEMAIL   COPY EMAIL ADDRESS                           
         B     FAX83                                                            
         DROP  R6                                                               
*                                                                               
FAX45    MVI   DOWIGMTH,C'F'                                                    
         L     RE,AIO3                                                          
         OC    0(2,RE),0(RE)                                                    
         BZ    FAX65                                                            
         LA    RE,24(RE)                                                        
         XR    R0,R0                                                            
FAX48    CLI   0(RE),0                                                          
         BE    FAX65                                                            
         CLI   0(RE),DMTHELQ       X'01' - LAST METHOD ELEMENT                  
         BE    FAX55                                                            
         CLI   0(RE),DMFXELQ       X'10' - TEMPORARY FAX NUMBER                 
         BE    FAX60                                                            
FAX50    IC    R0,1(RE)                                                         
         AR    RE,R0                                                            
         B     FAX48                                                            
*                                                                               
         USING DMTHELD,RE                                                       
FAX55    CLC   DMTHDEST,ORSDEST    DO THE DESTINATIONS MATCH?                   
         BNE   FAX65               NO, DON'T BOTHER                             
         B     FAX50               YES, CHECK DATE NEXT                         
         DROP  RE                                                               
*                                                                               
         USING DMFXELD,RE                                                       
FAX60    CLC   DMFXDATE,JDTTODAY   IS IT STILL EFFECTIVE?                       
         BNE   FAX65               NO                                           
         MVC   DOWIGFXT,SPACES     TEMPORARY WON'T HAVE TELEPHONE               
         MVC   DOWIGFXN,DMFXOVRD       JUST OVERRIDE FAX NUMBER AND             
         MVC   DOWIGFXA,ORSSALE        SALESPERSON FROM SCREEN                  
         B     FAX83                                                            
         DROP  RE                                                               
*                                                                               
FAX65    CLI   0(R6),C'9'          DO WE HAVE A CONTROL FAX RECORD?             
         BNE   FAX80               NO, WE HAVE A DESTINE RECORD                 
         USING CTFXREC,R6          YES                                          
****************************************                                        
* CONTROL FAX RECORD IN AIO2                                                    
****************************************                                        
FAX70    MVC   DOWIGFXA,ORSSALE                                                 
         LA    R6,CTFXEL1                                                       
         XR    R0,R0                                                            
FAX73    CLI   0(R6),0                                                          
         BE    FAX83                                                            
         CLI   0(R6),CTFX1ELQ      X'01' - FAX NUMBER ELEM?                     
         BNE   FAX75                                                            
         USING CTFX1EL,R6                                                       
         XR    RF,RF                                                            
         IC    RF,CTFX1LEN                                                      
         SHI   RF,CTFX1NUM-CTFX1EL+1                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DOWIGFXN(0),CTFX1NUM     SAVE THE NUMBER FOR THE DX              
         B     FAX78                                                            
*                                                                               
         USING CTFX2EL,R6                                                       
FAX75    CLI   0(R6),CTFX2ELQ      X'02' - ATTENTION ELEM?                      
         BNE   FAX76                                                            
         CLC   DOWIGFXA,SPACES     IF WE HAVE A SALESPERSON ON SCREEN           
         BH    FAX78               THEN DON'T BOTHER WITH THIS ELEM             
         MVC   DOWIGFXA,CTFX2ATT                                                
         B     FAX78                                                            
*                                                                               
         USING CTFX4EL,R6                                                       
FAX76    CLI   0(R6),CTFX4ELQ      X'04' - TELEPHONE ELEM?                      
         BNE   FAX78                                                            
         XR    RF,RF                                                            
         IC    RF,CTFX4LEN                                                      
         SHI   RF,CTFX4TEL-CTFX4EL+1                                            
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DOWIGFXT(0),CTFX4TEL     SAVE THE NUMBER FOR THE DX              
         DROP  R6                                                               
*                                                                               
FAX78    IC    R0,1(R6)            BUMP TO THE NEXT ELEM                        
         AR    R6,R0                                                            
         B     FAX73                                                            
****************************************                                        
* DESTINE RECORD IN AIO2                                                        
****************************************                                        
FAX80    LA    R6,DSRFRST-DSRKEY(R6)    DESTINE RECORD                          
         USING DSRIDELD,R6                                                      
         MVC   DOWIGFXN,DSRIDFAX                                                
         MVC   DOWIGFXT,DSRIDPHN                                                
*                                                                               
         MVC   DOWIGFXA,ORSSALE                                                 
         CLC   ORSSALE,SPACES                                                   
         BH    *+10                                                             
         MVC   DOWIGFXA,DSRIDATT                                                
         DROP  R1,R6                                                            
*                                                                               
FAX83    MVI   ELCODE,DOWIGELQ    X'50' - WHERE'D IT GO ELEM                    
         L     R6,AIO                                                           
         BAS   RE,GETEL              ANY HERE?                                  
         BNE   FAX85                 NO, ADD IT                                 
         USING DOWIGELD,R6                                                      
         XC    WORK,WORK                                                        
         MVC   WORK(L'ORSSALE),DOWIGFXA                                         
         DROP  R6                                                               
*                                                                               
         LA    R1,ELEM                                                          
         USING DOWIGELD,R1                                                      
         CLC   DOWIGFXA,SPACES     DON'T HAVE ANYTHING HERE FOR THE DX?         
         BH    *+10                                                             
         MVC   DOWIGFXA,WORK                                                    
         DROP  R1                                                               
*                                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)  REMOVE IT THEN ADD              
*                                                                               
FAX85    GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)                                  
*                                                                               
         CLC   ORSSALE,SPACES      DO WE HAVE SALESPERSON ALREADY?              
         BH    FAX87               NOTHING TO DO THEN                           
         OI    ORSSALEH+6,X'80'    SHOW USER WHO IT WENT TO                     
         L     R6,AIO                                                           
         AHI   R6,DORFRST-DOKEY                                                 
         USING DOIDELD,R6                                                       
         LA    R1,ELEM                                                          
         USING DOWIGELD,R1                                                      
         MVC   DOIDSPER,DOWIGFXA   SO NEXT TIME SALESPERSON IS THE SAME         
         MVC   ORSSALE,DOWIGFXA       FOR PREV SENT OVERRIDE FAX                
         DROP  R1,R6                                                            
*                                                                               
FAX87    GOTOR COLPASKY,DMCB,(C'G',0)                                           
         XC    KEY,KEY                                                          
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         MVC   KEY(L'DOKEY),DOKEY                                               
         GOTO1 HIGH                                                             
         MVI   RDUPDATE,C'Y'                                                    
         MVC   AIO,AIO3                                                         
         GOTO1 GETREC                                                           
         MVC   AIO,AIO1                                                         
         BRAS  RE,MYPUTREC                                                      
*                                                                               
* MAKESURE SVQCORDR MATCHES WHATS IN AIO                                        
*                                                                               
         LA    R2,FAKEFLDH                                                      
         MVC   BINORDER,DOKORDER-DOKEY(R6)                                      
         BRAS  RE,SHWORDER                                                      
         CLC   SVQCORDR,FAKEFLD    IF THE ORDERS DON'T MATCH                    
         BE    FAX88                                                            
         CLI   PQONLY,C'Y'         UNLESS WE DIDN'T ADD ON PURPOSE              
         BE    FAX88                                                            
         DC    H'0'                CAN'T CONTINUE SO DIE!!!!                    
                                                                                
***********************************                                             
* CREATE THE REQUEST CARDS NOW AND USE WHAT WAS SAVED IN SVREVDAT               
* FOR SECOND REQUEST CARD                                                       
***********************************                                             
                                                                                
FAX88    L     R4,AIO                                                           
         XC    0(80,R4),0(R4)                                                   
         USING SPOOK,R4                                                         
*                                                                               
         MVC   SPOOKUID,TWAORIG                                                 
         MVC   SPOOKDES,TWAORIG                                                 
         MVC   SPOOKAGY,AGENCY                                                  
         MVC   SPOOKDID,=C'DFX'    DARE FAX                                     
         MVC   SPOOKSYS,=C'SP'                                                  
         MVC   SPOOKEOD,=C'DX'                                                  
         MVC   SPOOKJCL,=C'DX'                                                  
         MVI   SPOOKWEN,2          SOON                                         
         MVC   SPOOKRLD(3),=C'LD='                                              
         MVC   SPOOKRLD+3(2),=H'48'                                             
         MVC   SPOOKRLD+5(2),=H'24'                                             
         DROP  R4                                                               
*                                                                               
         LA    R6,80(R4)                                                        
         USING RQD,R6                                                           
         XC    REQHDR,REQHDR                                                    
         MVC   RQAREA,SPACES                                                    
         MVC   RQAREA2,SPACES                                                   
*                                                                               
         MVC   RQPROG,=C'DX'                                                    
         MVC   RQAGY,AGENCY                                                     
         MVC   RQMED,QMED                                                       
         MVC   RQCLT,QCLT                                                       
         MVC   RQPRD,QPRD                                                       
         MVC   RQMKT,QMKT                                                       
         MVC   RQSTA,QSTA                                                       
         MVC   RQEST,QEST                                                       
         MVI   RQCONT,C'*'         SET FOR SECOND REQ CARD                      
         MVC   RQSTAUTO(2),=C'ES'  TEMPORARY   <==========                      
*                                                                               
         TM    MISCFLG1,MF1FLTRC   FLIGHT?                                      
         BZ    FAX90                                                            
         MVC   RQSTAUTO(2),SPACES  YES, THEN USE FLIGHT DATES                   
***********************************************************************         
* THE X'20' IS TO ALLOW YEAR 2000 TO SHOW AS C'00' INSTEAD OF X'FAF0'           
***********************************************************************         
         GOTO1 DATCON,DMCB,(3,SVFLTSDT),(0,RQSTART)                             
         GOTO1 DATCON,DMCB,(3,SVFLTEDT),(0,RQEND)                               
*                                                                               
FAX90    MVI   RQOPT1,C'D'         INDICATE DARE REQUEST                        
         MVC   RQUESTOR(3),ORSBUYR                                              
         LA    RE,SYSSPARE                                                      
         MVC   RQPTNR,SVQPR2-MYAREAD(RE)                                        
         OC    RQPTNR,SPACES                                                    
*                                                                               
         CLI   ORSINDM,C'N'        SHOW DEMOS?                                  
         BE    FAX91               NO                                           
         CLI   PDARDEMS,C'4'       CAN HAVE 1-4 DEMOS (FROM DX PROFILE)         
         BH    FAX91                                                            
         CLI   PDARDEMS,C'1'                                                    
         BNL   FAX93                                                            
FAX91    MVI   RQ2DEMO,C'N'        LIKE THE DX FROM $REQ                        
         B     FAX95                                                            
FAX93    MVC   RQ2DEMO(1),PDARDEMS                                              
*                                                                               
FAX95    MVC   RQ2RSND,ORSRSND     SET RESEND OPTION                            
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    FAX97                                                            
         TM    CLTFLAG1,CLTTRADE   IS IT A TRADE CLIENT?                        
         BZ    *+8                                                              
         MVI   RQCOST2,C'Y'                                                     
*                                                                               
FAX97    MVC   RQ2DRORD,SVQCORDR   DARE ORDER NUMBER                            
         MVC   RQ2CVRGN(4),SVREVDAT COPY ALL VIRGIN DATA WE GOT ABOVE           
*                                                                               
         GOTO1 GETFACT,DMCB,0                                                   
         L     RE,DMCB                                                          
         USING FACTSD,RE                                                        
         MVC   DUB(1),FASYSID      MOVE VALUE                                   
         MVC   DUB+1(1),BAGYMD                                                  
         DROP  RE                                                               
         GOTO1 HEXOUT,DMCB,DUB,RQ2DRSID,1                                       
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         CLC   RQ2DRSID,=C'06'     ARE WE ON FACMEL?                            
         BNE   *+10                                                             
FAX99    MVC   RQ2DRSID,=C'01'     MAKE IT LOOK LIKE WE'RE ON FACTST            
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         GOTO1 (RF),(R1),DUB+1,RQ2AGYMD,1                                       
*                                                                               
         MVI   REQFLAG,X'10'       SET N'CARDS-1 (LEFT ALIGNED)                 
         CLI   NEWFAX,C'Y'         TEST USING NEW OM FAX                        
         BE    FAX105                                                           
* OLD FAX                                                                       
         L     RF,ACOMFACS                                                      
         MVC   DMCB+8(4),CDATAMGR-COMFACSD(RF)                                  
         ST    RF,DMCB+12                                                       
         L     RF,CREQTWA-COMFACSD(RF)                                          
         GOTO1 (RF),DMCB,(5,(RA)),REQHDR,,,(R4)                                 
         B     FAX108                                                           
*                                                                               
FAX105   GOTO1 VGOTO29,DMCB,(RC)   CALL X'29' OVERLAY TO PRINT FAX              
         MVC   RESEND,ORSRSND      MOVE INPUT TO WORKING STORAGE                
         CLI   ORSRSNDH+5,0        TEST INPUT IN RESEND FIELD                   
         BE    FAX108              NO                                           
         MVI   ORSRSND,C'*'        OVERWRITE IT SO CAN'T DO AGAIN               
         OI    ORSRSNDH+6,X'80'    XMT                                          
*                                                                               
FAX108   BRAS  RE,UPDEXTRA         UPDATE THE X'05' EXTRA RECORD                
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDER NOW?                       
         BZ    FAX110                                                           
         BRAS  RE,SETMETHD                                                      
*                                                                               
FAX110   BRAS  RE,DELBATCH         DELETE BATCH RECORD FOR MED/CLT..PR2         
*                                                                               
         BRAS  RE,CHKAUTH                                                       
*                                                                               
FAXXIT   TM    MISCFLG1,MF1DRTRD   PRINTED TRADE ORDER?                         
         BNZ   *+12                                                             
         OI    CASHFLG1,ONTHEWAY     CASH ORDER IS ON ITS WAY                   
         B     FAXXIT10                                                         
         OI    TRDEFLG1,ONTHEWAY     TRADE ORDER IS ON ITS WAY                  
*                                                                               
FAXXIT10 TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         TM    MISCFLG1,MF1TRDRC   WE HAVE A TRADE CONDITION?                   
         BNZ   XIT                 YES, GO BACK AND DO TRADE                    
* NO LONGER NEED TO DELETE FAX OVERRIDE # SINCE WE HAVE ACTIVE DATE             
*&&DO                                                                           
         CLC   =C'FAX:',ORSROUT    DO WE NEED TO DELETE FAX OVERRIDE #?         
         BNE   FAXXIT30            NO                                           
         LA    R6,KEY              LET'S SEE IF WE HAVE LSTM                    
         XC    KEY,KEY                                                          
         USING DMTHKEY,R6                                                       
         MVI   DMTHTYPE,DMTHTYPQ        X'0D3E'                                 
         MVI   DMTHSBTY,DMTHSBTQ                                                
         MVC   DMTHAGMD,BAGYMD                                                  
         MVC   DMTHBYR,QBYR                                                     
         MVC   DMTHSTA,BSTA                                                     
         MVC   DMTHCLT,BCLT                                                     
*                                                                               
         GOTO1 HIGH                                                             
         CLC   KEY(13),KEYSAVE     ANY LAST METHOD BY THIS CLIENT?              
         BNE   FAXXIT30            YES                                          
*                                                                               
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DMFXELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   FAXXIT30                                                         
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)                                  
         BRAS  RE,MYPUTREC                                                      
*&&                                                                             
FAXXIT30 CLI   ACTNUM,ACTXMIT      DONE WITH THE TRANSMIT?                      
         BNE   FAXXIT90                                                         
         MVI   ACTNUM,ACTSEND                                                   
         MVI   PFKEY,12            YES, RETURN                                  
         BRAS  RE,SETPFKYS         SETUP THE PFKEYS                             
*                                                                               
FAXXIT90 TM    BITFLAG,BFFRMBUY    CAME FROM BUY PROGRAM?                       
         BZ    FAXXIT99                                                         
         LA    R1,BLOCK            YES                                          
         USING GLVXFRSY,R1                                                      
         XC    BLOCK(14),BLOCK                                                  
         MVC   GLVXFRSY,=C'SPO'                                                 
         MVC   GLVXFRPR,=C'OM '                                                 
         MVC   GLVXTOSY,=C'SPO'                                                 
         MVC   GLVXTOPR,=C'BUY'                                                 
         OI    GLVXFLG1,GLV1RETN+GLV1SEPS                                       
         MVC   GLVXSESR,SVXFRSID            SET CALLER/CALLEE SESSIONS          
         OI    GLVXFLG1,GLV1SIDR+GLV1SIDE   NEED THIS SO RCRI KNOWS             
         DROP  R1                                                               
*                                                                               
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK,14,GLVXCTL                              
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
FAXXIT99 B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CLOSES THE PRINT QUEUE ENTRY                                                  
***********************************************************************         
APRCLOSE NTR1  BASE=*,LABEL=*                                                   
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
*                                                                               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT IN RECORD)              
         DROP  R6                                                               
***************                                                                 
* SAVE THE TOTAL NUMBER OF SPOTS AND DOLLARS                                    
***************                                                                 
PRCLS00  CLI   0(R6),0             NEW SUPPLEMENTAL ELEMENT GOES                
         BE    PRCLS02                 AFTER I2 ELEMENT                         
         CLI   0(R6),DOSPELQ                                                    
         BNL   PRCLS02                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCLS00                                                          
*                                                                               
PRCLS02  CLI   0(R6),DOSPELQ       WE FOUND SUPPLEMENTAL ELEMENT?               
         BE    PRCLS04             YES, CHANGE THE ELEMENT                      
         LA    R1,DOSPELEM         DON'T CLEAR, SET UP SOMETHING ABOVE          
         USING DOSPELD,R1                                                       
         MVI   DOSPEL,DOSPELQ                                                   
         MVI   DOSPLEN,DOSPLNQ2                                                 
         MVC   DOSPSPTS,AGYNSPTS                                                
         ZAP   DOSPTOTL,AGYDOLRS                                                
         MVC   DOSPCRTR,TWAORIG    SAVE THE CREATOR OF THE ORDER                
         MVC   DOSPFSTA,BSTA                                                    
         XC    DOSPFAID,DOSPFAID                                                
         CLC   SVAIRDAT,=X'FFFF'                                                
         BE    *+10                                                             
         MVC   DOSPFAID,SVAIRDAT                                                
         CLI   AVNEW,C'P'          IS AVN OPTION ON?                            
         BNE   *+8                 NO                                           
         OI    DOSPFLG1,DOSPAVN                                                 
         XC    DOSPTDAT,DOSPTDAT                                                
         MVC   DOSPMKT,BMKT                                                     
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    PRCLS02A                                                         
         OI    DOSPFLG1,DOSPTRDE                                                
         MVI   DOSPTMTH,TRDESREP     USING SPECIAL REP CODE FOR TRADE           
         B     PRCLS03                                                          
*                                                                               
PRCLS02A OC    PDARTSRP(3),PDARTSRP ANY SPECIAL REP IN DARE PROFILE?            
         BZ    PRCLS05H             NONE                                        
         CLC   PDARTSRP(3),ZEROS                                                
         BE    PRCLS05H             NONE                                        
                                                                                
         TM    MISCFLG1,MF1TRDRC   NO TRADE CONDITION?                          
         BZ    PRCLS05H            NONE, LEAVE EVERYTHING ALONE                 
         MVI   DOSPTMTH,TRDESREP-X'40'   LOWERCASE FOR CASH (X'99')             
*                                                                               
PRCLS03  MVC   DOSPTDAT(3),PDARTSRP  SPECIAL REP CODE USED STORED HERE          
         B     PRCLS05H                                                         
         DROP  R1                                                               
*                                                                               
         USING DOSPELD,R6                                                       
PRCLS04  MVC   DOSPSPTS,AGYNSPTS   MODIFY THESE VALUES IN THE RECORD            
         ZAP   DOSPTOTL,AGYDOLRS                                                
         MVC   DOSPREVN,DOSPELEM+DOSPREVN-DOSPELD                               
*                                                                               
         CLI   DOSPREVN,0                                                       
         BE    PRCLS05                                                          
*                                                                               
         LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         CLC   8(L'ORSCONT,RF),ZEROS                                            
         BH    *+6                                                              
         DC    H'0'                WHAT IS PUTTING REVISION NUMBERS IN?         
*                                                                               
N        USING DOSPELD,DOSPELEM                                                 
PRCLS05  MVC   DOSPELEM,0(R6)                                                   
***  SAVE TRADE METHOD AND MADNESS                                              
         MVI   N.DOSPLEN,DOSPLNQ2  USE NEW LENGTH                               
         XC    N.DOSPFAID,N.DOSPFAID                                            
         CLC   SVAIRDAT,=X'FFFF'                                                
         BE    *+10                                                             
         MVC   N.DOSPFAID,SVAIRDAT SAVE THE FIRST ARID ATE                      
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDER NOW?                       
         BZ    PRCLS05B            NO, CASH NOW                                 
         MVI   N.DOSPTMTH,TRDESREP                                              
         B     PRCLS05D                                                         
*                                                                               
PRCLS05B OC    PDARTSRP(3),PDARTSRP ANY SPECIAL REP IN DAR PROFILE?             
         BZ    PRCLS05G             NONE                                        
         CLC   PDARTSRP(3),ZEROS                                                
         BE    PRCLS05G             NONE                                        
*                                                                               
         TM    MISCFLG1,MF1TRDRC   NO TRADE CONDITION?                          
         BZ    PRCLS05G            NONE, LEAVE EVERYTHING ALONE                 
         MVI   N.DOSPTMTH,TRDESREP-X'40'                                        
*                                                                               
PRCLS05D MVC   N.DOSPTDAT(3),PDARTSRP                                           
         DROP  N                                                                
*                                                                               
PRCLS05G GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)      DELETE OLD DOSPEL           
PRCLS05H GOTO1 RECUP,DMCB,(C'S',AIO),DOSPELEM,(R6)  ADD NEW DOSPEL              
*                                                                               
         MVC   DOSPELEM,0(R6)      MAKE A COPY                                  
         DROP  R6                                                               
***************                                                                 
* PUT OUT A NEW TRANSMINSSION ELEMENT                                           
***************                                                                 
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
*                                                                               
         LA    R6,DORFRST          R6 = A(FIRST ELEMENT IN RECORD)              
         DROP  R6                                                               
PRCLS10  CLI   0(R6),0             NEW TRANSMISSION ELEMENT GOES                
         BE    PRCLS15                 AFTER ID ELEMENTS                        
         CLI   0(R6),DORPELQ                                                    
         BNL   PRCLS15                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCLS10                                                          
*                                                                               
PRCLS15  BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)                              
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ2                                                 
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,DSENT      SENT                                         
         MVC   DOSTIDNM,TWAORIG                                                 
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
         SR    R0,R0                                                            
PRCLS17  CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS..          
         BE    PRCLS18                                                          
         CLI   0(R6),DORPELQ2    AND BEFORE A X'09' REP CHANGE ELEMENT          
         BE    PRCLS18                                                          
         CLI   0(R6),DOSTELQ     OR AUDIT X'12' ELEMENT                         
         BNL   PRCLS18                                                          
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCLS17                                                          
*                                                                               
PRCLS18  GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
         SR    R0,R0                                                            
PRCLS19  CLI   0(R6),0           LOOK FOR THE SUPP ELEMENT                      
         BE    PRCLS19B                                                         
         CLI   0(R6),DOSPELQ                                                    
         BE    PRCLS19A                                                         
         IC    R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCLS19                                                          
*                                                                               
         USING DOSPELD,R6                                                       
PRCLS19A TM    DOSPFLG1,DOSPUWMG   USER UNWOUND A MAKEGOOD IN THE PAST?         
         BZ    PRCLS19B                                                         
         NI    DOSPFLG1,X'FF'-DOSPUWMG   RESET FLAG                             
         OI    MISCFLG4,MF4UNWMG         WE NEED TO SHOW THIS MESSAGE           
*                                                                               
PRCLS19B GOTOR COLPASKY,DMCB,(C'G',0)                                           
*                                                                               
***************                                                                 
* REMOVE THE BUYLINE ELEMENTS                                                   
***************                                                                 
         MVI   BYTE,DOBUYELQ       REMOVE ALL BUYLINE ELEMENTS                  
PRCLS20  MVC   ELCODE,BYTE                                                      
         L     R6,AIO                                                           
         BAS   RE,GETEL                                                         
         BNE   PRCLS23                                                          
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6)                                       
         B     PRCLS20                                                          
*                                                                               
PRCLS23  CLI   BYTE,DOCOMELQ       DID THIS ALREADY?                            
         BE    PRCLS25             YES                                          
         MVI   BYTE,DOCOMELQ       NO, REMOVE THE ERRORS ALSO                   
         B     PRCLS20                                                          
*                                                                               
PRCLS25  LA    R2,BLOCK                                                         
PRCLS30  CLI   0(R2),0             END OF BUYLINE LIST?                         
         BE    PRCLS50                                                          
*                                                                               
         L     R6,AIO              NO                                           
         LA    R6,DORFRST-DOKEY(R6)                                             
PRCLS33  CLI   0(R6),0             END OF THE RECORD?                           
         BE    PRCLS40                                                          
         CLI   0(R6),DOBUYELQ      SEE IF IT IS A BUYLINE ELEMENT               
         BL    PRCLS36                                                          
         BH    PRCLS40                                                          
*                                                                               
         USING DOBUYELD,R6                                                      
         CLC   DOBUYSPT,0(R2)      BUYLINE EXIST IN RECORD ALREADY?             
         BL    PRCLS36                                                          
         BH    PRCLS40                                                          
         CLC   DOBUYFLG,1(R2)      ALSO SAME FLAG?                              
         BNE   PRCLS36                                                          
         LA    R2,2(R2)            YES, CHECK THE NEXT BUYLINE                  
         B     PRCLS30                                                          
*                                                                               
PRCLS36  ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCLS33                                                          
*                                                                               
PRCLS40  DS    0H                                                               
PRCLOSED USING DOBUYELD,DOBYELEM                                                
         MVC   PRCLOSED.DOBUYSPT,0(R2)                                          
         MVC   PRCLOSED.DOBUYFLG,1(R2)                                          
         GOTO1 RECUP,DMCB,(C'S',AIO),DOBYELEM,(R6)                              
         DROP  PRCLOSED                                                         
         LA    R2,2(R2)            CHECK THE NEXT BUYLINE                       
         B     PRCLS30                                                          
*                                                                               
PRCLS50  TM    MISCFLG2,MF2VAROR   SENDING A VAR ORDER?                         
         BZ    PRCLS60             NO                                           
***********************************                                             
* THE FOLLOWING CODE IS FOR VAR ORDERS ONLY                                     
***********************************                                             
         L     R6,AIO              MARK THE I2 ELEMENT THAT IT'S VAR            
         MVI   ELCODE,DOI2ELQ                                                   
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         USING DOI2ELD,R6                                                       
         OI    DOI2FLG1,DOI2FVAR                                                
         DROP  R6                                                               
*                                                                               
         L     R6,AIO              REMOVE ANY OLD VAR PRD ELEMS                 
         MVI   ELCODE,DOVPRELQ                                                  
         BAS   RE,GETEL                                                         
         BNE   PRCLS52             R6 = END-OF-RECORD                           
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6)                                       
         B     PRCLS50                                                          
*                                                                               
PRCLS52  LA    R2,PRDSLIST         ADD ALL THE NEW VAR PRD ELEMS                
         MVI   BYTE,1              SET NUMBER                                   
*                                                                               
PRCLS54  XC    ELEM,ELEM                                                        
         LA    RE,ELEM                                                          
         USING DOVPRELD,RE                                                      
         MVI   DOVPREL,DOVPRELQ                                                 
         MVC   DOVPRSET,BYTE       PUT IN THE CURRENT SET NUMBER                
         LA    RE,DOVPRPRD         RE = A(1ST PRODUCT PAIR)                     
         DROP  RE                                                               
*                                                                               
PRCLS56  CLI   0(R2),0             ANYTHING IN THIS ENTRY?                      
         BE    PRCLS58             NONE                                         
         MVC   0(2,RE),0(R2)                                                    
*                                                                               
         LA    RE,2(RE)            BUMP TO NEXT POSITION IN ELEMENT             
         LR    R1,RE                                                            
         LA    R0,ELEM                                                          
         SR    R1,R0                                                            
*                                                                               
         CH    R1,=Y(DOVPROVH+64*2) 64 PAIRS IN THIS ELEM?                      
         BL    PRCLS58                                                          
         STC   R1,ELEM+1           STORE ELEMENT LENGTH                         
         GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)   ADD ELEM TO RECORD             
*                                                                               
         ZIC   R0,1(R6)            NEXT ELEM POSITION IN RECORD                 
         AR    R6,R0                                                            
*                                                                               
         ZIC   R1,BYTE             BUMP SET NUMBER                              
         LA    R1,1(R1)                                                         
         STC   R1,BYTE                                                          
*                                                                               
         XC    ELEM,ELEM           NEW ELEMENT TO BUILD                         
         LA    RE,ELEM                                                          
         USING DOVPRELD,RE                                                      
         MVI   DOVPREL,DOVPRELQ                                                 
         MVC   DOVPRSET,BYTE       PUT IN THE CURRENT SET NUMBER                
         LA    RE,DOVPRPRD         RE = A(1ST PRODUCT PAIR)                     
         DROP  RE                                                               
*                                                                               
PRCLS58  LA    R2,2(R2)                                                         
         LA    R0,PRDSLIST+L'PRDSLIST                                           
         CR    R2,R0                                                            
         BL    PRCLS56                                                          
*                                                                               
PRCLS59  LA    R0,ELEM+DOVPRPRD-DOVPRELD  ANYTHING IN THE ELEMENT?              
         CR    RE,R0                                                            
         BE    PRCLS60                    NOTHING, WRITE OUT THE RECORD         
*                                                                               
         LA    R0,ELEM                                                          
         SR    RE,R0                                                            
         STC   RE,ELEM+1                                                        
         GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)   ADD ELEM TO RECORD             
*                                                                               
PRCLS60  BRAS  RE,MYPUTREC                                                      
*                                                                               
         BRAS  RE,UPSALREC         UPDATE THE X'04' SALESPERSON RECORD          
*                                                                               
         BRAS  RE,UPDEXTRA         UPDATE THE X'05' EXTRA RECORD                
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE ORDER NOW?                       
         BZ    PRCLS70                                                          
         BRAS  RE,SETMETHD                                                      
*                                                                               
PRCLS70  BRAS  RE,DELBATCH         DELETE BATCH RECORD FOR MED/CLT..PR2         
*                                                                               
         TM    MISCFLG1,MF1FLTRC                                                
         BZ    PRCLS90                                                          
         BRAS  RE,GETFLTRC                                                      
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
         USING DFLRECD,R6                                                       
         MVI   ELCODE,DFFLTELQ                                                  
         BAS   RE,GETEL                                                         
*                                                                               
         USING DFFLTEL,R6                                                       
PRCLS80  CLC   SVBFLT,DFFLTNUM                                                  
         BE    *+12                                                             
         BAS   RE,NEXTEL                                                        
         B     PRCLS80                                                          
         OI    DFFLTSTA,DFFLTSLK   LOCKED THIS FLIGHT BY DARE                   
         BRAS  RE,MYPUTREC                                                      
*                                                                               
PRCLS90  TM    BITFLAG,BFFRMBUY    CAME FROM BUY PROGRAM?                       
         BZ    PRCLSX                                                           
         LA    R1,BLOCK            YES                                          
         USING GLVXFRSY,R1                                                      
         XC    BLOCK(14),BLOCK                                                  
         MVC   GLVXFRSY,=C'SPO'                                                 
         MVC   GLVXFRPR,=C'OM '                                                 
         MVC   GLVXTOSY,=C'SPO'                                                 
         MVC   GLVXTOPR,=C'BUY'                                                 
         OI    GLVXFLG1,GLV1RETN+GLV1SEPS                                       
         MVC   GLVXSESR,SVXFRSID            SET CALLER/CALLEE SESSIONS          
         OI    GLVXFLG1,GLV1SIDR+GLV1SIDE   NEED THIS SO RCRI KNOWS             
         DROP  R1                                                               
*                                                                               
         L     RF,ACOMFACS                                                      
         L     RF,CGLOBBER-COMFACSD(RF)                                         
         GOTO1 (RF),DMCB,=C'PUTD',BLOCK,14,GLVXCTL                              
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
PRCLSX   XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF AN AUTHORIZATION STATION RECORD EXISTS                     *         
***********************************************************************         
CHKAUTH  NTR1  BASE=*,LABEL=*                                                   
         CLI   SVCPROF+0,C'0'      POL BUYING?                                  
         BNE   CAUT02              NO                                           
*                                                                               
         LA    R6,KEY                                                           
         USING CLTHDRD,R6                                                       
         XC    KEY,KEY                                                          
         MVI   CKEYTYPE,0                                                       
         MVC   CKEYAM,BAGYMD                                                    
         MVC   CKEYCLT,BCLT                                                     
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'CKEY),KEYSAVE                                              
         BE    *+6                                                              
         DC    H'00'                                                            
*                                                                               
         MVC   AIO,AIO3                                                         
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO3                                                          
         CLI   CPOLONLY,C'Y'       TRUE POL?                                    
         BNE   CAUT02                                                           
         DROP  R6                                                               
*                                                                               
         LA    R6,KEY              READ ESTIMATE RECORD                         
         USING ESTHDR,R6                                                        
         XC    KEY,KEY             IF CLIENT IS TRUE POL                        
         MVI   EKEYTYPE,0                                                       
         MVC   EKEYAM,BAGYMD                                                    
         MVC   EKEYCLT,BCLT                                                     
         MVC   EKEYPRD,=C'POL'                                                  
         MVC   EKEYEST,SVBEST                                                   
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'EKEY),KEYSAVE                                              
         BE    *+6                                                              
         DC    H'00'                                                            
*                                                                               
         L     R6,AIO3                                                          
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         TM    EFLAG1,EF1SDE       SDESK AUTH OPEN FOR POL ESTIMATE?            
         BNO   CHKAUTHX            NO                                           
         B     CAUT04                                                           
         DROP  R6                                                               
*                                                                               
CAUT02   TM    ESTFLAG1,ESTSDE     SUPERDESK AUTHORIZATION OPEN?                
         BNO   CHKAUTHX            NO                                           
*                                                                               
         PUSH  USING                                                            
CAUT04   XC    ELEM,ELEM           CALL SPAUTH                                  
         USING SPAUTHD,ELEM                                                     
         MVC   SPACOM,ACOMFACS                                                  
         L     RF,AIO3                                                          
         ST    RF,SPAIO                                                         
         MVC   SPAKAM,BAGYMD                                                    
         MVC   SPAKCLT,BCLT                                                     
         MVC   SPAKPRD,SVBPRD                                                   
         MVC   SPAKPRD2,SVBPR2                                                  
         MVC   SPAKEST,SVBEST                                                   
*                                                                               
         CLI   SVBPR2,0            ANY PIGGYBACKS?                              
         BE    CAUT06                                                           
         CLC   SVQPRD,SVQPR2       IF PRODUCTS NOT IN ALPHABETICAL              
         BL    CAUT06              ORDER, SWAP THEM                             
         XC    SPAKPRD2,SPAKPRD                                                 
         XC    SPAKPRD,SPAKPRD2                                                 
         XC    SPAKPRD2,SPAKPRD                                                 
*                                                                               
CAUT06   GOTO1 DATCON,DMCB,ESTSTRT,(2,SPASDTE)                                  
         GOTO1 (RF),DMCB,ESTEND,(2,SPAEDTE)                                     
         CLI   SVBFLT,0            IF FLIGHT NUMBER = 0, USE EST DATES          
         BE    CAUT08                                                           
         GOTO1 (RF),DMCB,(3,SVFLTSDT),(2,SPASDTE)                               
         GOTO1 (RF),DMCB,(3,SVFLTEDT),(2,SPAEDTE)                               
*                                                                               
CAUT08   MVC   SPAKMKT(5),BMKTSTA                                               
         MVI   SPAUPDT,SPAUPDSN    UPDATE DARE SENT DATE                        
         GOTO1 SPAUTH,ELEM                                                      
         CLI   SPAERR,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
         POP   USING                                                            
*                                                                               
CHKAUTHX MVC   AIO,AIO1            CAN'T TOUCH THIS                             
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PUTS TODAY'S DATE AND TIME IN THE NEW AUDIT HISTORY ELEMENT                   
***********************************************************************         
GETDAYTM NTR1  BASE=*,LABEL=*                                                   
         LA    R2,DOSTELEM                                                      
         USING DOSTELD,R2                                                       
         GOTO1 DATCON,DMCB,(5,0),(19,DOSTDATE)                                  
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    GETDAYT2                                                         
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
         GOTO1 DATCON,DMCB,(0,DUB),(19,DOSTDATE)                                
*                                                                               
GETDAYT2 ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DOSTTIME                                                    
         DROP  R2                                                               
         XIT1                                                                   
         LTORG                                                                  
***********************************************************************         
* UPDATE THE NEW TIME STAMP ELEMENT                                             
***********************************************************************         
UPDATTIM NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    ELEM,ELEM                                                        
         LA    R2,ELEM                                                          
         USING DATTIMD,R2                                                       
         MVI   DATTIM,DATTIMLQ     X'D1'                                        
         MVI   DATTIMLN,DATTMLNQ                                                
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(19,DATTMGDT)                                  
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    UPDT10                                                           
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
         GOTO1 DATCON,DMCB,(0,DUB),(19,DATTMGDT)                                
*                                                                               
UPDT10   ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DATTMGTM                                                    
         MVC   DATTMCDT,DATTMGDT                                                
         MVC   DATTMCTM,DATTMGTM                                                
*                                                                               
         L     R6,AIO              WE DON'T KNOW CREATION DATE SO WE'LL         
         MVI   ELCODE,X'F1'           USE THE X'F1' ELEM TO GET IT              
         BAS   RE,GETEL                                                         
         BNE   UPDT15                                                           
         USING ACTVD,R6                                                         
         GOTO1 DATCON,DMCB,(3,ACTVADDT),(19,DATTMCDT)                           
         DROP  R6                                                               
*                                                                               
UPDT15   L     R6,AIO                                                           
         MVI   ELCODE,DATTIMLQ     X'D1'                                        
         BAS   RE,GETEL            DO WE HAVE ONE?                              
         BNE   UPDT20              NO, ADD IT                                   
OLD      USING DATTIMD,R6                                                       
         MVC   DATTMCDT,OLD.DATTMCDT                                            
         MVC   DATTMCTM,OLD.DATTMCTM                                            
         GOTO1 RECUP,DMCB,(C'S',AIO),(R6),(R6)    DELETE OLD DATTIMELEM         
UPDT20   GOTO1 RECUP,DMCB,(C'S',AIO),ELEM,(R6)    ADD NEW DATTIMELEM            
         DROP  OLD,R2                                                           
         XIT1                                                                   
         LTORG                                                                  
***********************************************************************         
* PUTS TODAY'S DATE AND TIME IN THE TRANSMISSION ELEMENT                        
***********************************************************************         
BLDDAYTM NTR1  BASE=*,LABEL=*                                                   
         LA    R2,DOXMELEM                                                      
         USING DOXMTELD,R2                                                      
         GOTO1 DATCON,DMCB,(5,0),(19,DOXMTYMD)    SET THE CURRENT DATE          
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    BLDDAYT2                                                         
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
         GOTO1 DATCON,DMCB,(0,DUB),(19,DOXMTYMD)                                
*                                                                               
BLDDAYT2 ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DOXMTTIM                                                    
         DROP  R2                                                               
         XIT1                                                                   
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* FIND THE FIRST AIR DATE OF THE BUYS                                           
*                                                                               
* ON EXIT:     SVAIRDAT            FIRST AIR DATE (COMPRESSED FORMAT)           
***********************************************************************         
FRSTAIRD NTR1  BASE=*,LABEL=*                                                   
         XCEFL BLOCK,480           SAVE LIST OF BUYLINES USED                   
         MVC   SVAIRDAT,=X'FFFF'                                                
*                                                                               
         XCEFL PRDSLIST,512           CLEAR LIST OF POL PRODUCTS                
         OI    MISCFLG2,MF2VPRDS                                                
*                                                                               
         LA    R6,KEY              SET UP THE BUY KEY                           
         USING BUYKEY,R6                                                        
         XC    KEY,KEY                                                          
         MVC   BUYKAM,BAGYMD                                                    
         MVC   BUYKCLT,BCLT                                                     
         MVC   BUYKPRD,SVBPRD                                                   
         MVC   BUYMSTA,BMKTSTA                                                  
         MVC   BUYKEST,SVBEST                                                   
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
FSTA10   CLC   BUYKAM(BUYKPRD-BUYKAM),BAGYMD  SAME BASE KEY?                    
         BNE   FSTA110                                                          
         CLC   BUYKPRD,SVBPRD                                                   
         BNE   FSTA110                                                          
         CLC   BUYMSTA,BMKTSTA                                                  
         BNE   FSTA110                                                          
         CLC   BUYKEST,SVBEST                                                   
         BNE   FSTA110             NO, DONE                                     
*********                                                                       
* BRAND-POL BUY                                                                 
*********                                                                       
         CLI   BUYKBUY,X'FF'       POL-BRAND TYPE OF BUY?                       
         BE    FSTA20              YES, CAN'T DETERMINE IF PIGGY YET            
*********                                                                       
* OUR PRD USED AS A PIGGYBACK AND OUR PIGGYBACK USED AS THE PRODUCT             
*********                                                                       
         CLI   BUYKBUY,0           OUR PRODUCT IS USED AS A PIGGYBACK?          
         BE    FSTA13              NO, AS A MASTER PRODUCT                      
         CLI   SVBPR2,0            YES, DO WE HAVE A PIGGYBACK?                 
         BE    FSTA100                  NO, SKIP THIS RECORD                    
         CLC   SVBPR2,BUYKBUY           YES, OUR P/B USED AS PRD?               
         BNE   FSTA100                       NO, SKIP THIS RECORD               
         B     FSTA20                                                           
*********                                                                       
* OUR PRD IS USED AS THE MASTER PRODUCT OF BUY (POSSIBLE PIGGYBACK)             
*********                                                                       
FSTA13   CLI   SVBPR2,0            ORDER HAS PIGGYBACK?                         
         BNE   FSTA16                                                           
         CLI   BUYKBUY+2,X'01'     NO, REGULAR BUY (NO PIGGYBACK)?              
         BE    FSTA20                  YES                                      
         B     FSTA100                 NO, GET NEXT BUY RECORD                  
*                                                                               
FSTA16   CLI   BUYKBUY+2,X'02'     YES, PIGGYBACK BUY, ACTIVE PRODUCT?          
         BNE   FSTA100                  NO, GET NEXT BUY RECORD                 
***************                                                                 
* WE CAN READ THE BUY NOW                                                       
***************                                                                 
FSTA20   MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
*                                                                               
         TM    BUYRCNTL,X'80'      RECORD DELETED?                              
         BNZ   FSTA100             YES, SKIP THIS RECORD                        
*                                                                               
         BRAS  RE,CHKIFTRD                                                      
         BE    FSTA22                                                           
         OI    MISCFLG1,MF1CSHRC      SO WE KNOW LATER THAT WE HAD CASH         
         TM    MISCFLG1,MF1DRTRD      NO, DOING TRADE NOW?                      
         BNZ   FSTA100                    YES, SKIP THIS RECORD                 
         B     FSTA24                                                           
*                                                                               
FSTA22   TM    MISCFLG1,MF1DRTRD   YES, DOING TRADE NOW?                        
         BNZ   FSTA23                YES                                        
         OI    MISCFLG1,MF1TRDRC     NO, WE ENCOUNTERED A TRADE BUY             
         B     FSTA100                   SKIP THIS RECORD                       
FSTA23   TM    CLTFLAG1,CLTTRADE   TRADE CLIENT                                 
         BZ    FSTA24                NO                                         
         MVI   ELCODE,X'71'        YES,                                         
         BAS   RE,GETEL            DO WE HAVE A COS2?                           
         BE    FSTA24              YES                                          
*                                  NO, ERROR                                    
         L     R6,AIO                                                           
         EDIT  (B1,KEY+12),(3,BLOCK+1),0,ALIGN=LEFT                             
         MVI   BLOCK,5             L'LENGTH + L'MESSAGE                         
         MVI   BLOCK+4,0           TERMINATING 0                                
         J     MISSCOS2                                                         
*                                                                               
FSTA24   MVI   PR1TIMSH,0          0 MEANS USE BDTIME                           
         L     R6,AIO                                                           
         CLI   BUYKPRD,X'FF'       POL-BRAND TYPE OF BUY?                       
         BE    FSTA50              YES                                          
*********                                                                       
* REGULAR BUY                                                                   
*********                                                                       
         L     R6,AIO                                                           
         MVI   ELCODE,X'04'        NO, ANY PIGGYBACK ELEM?                      
         BAS   RE,GETEL                                                         
         BE    FSTA25                                                           
         CLI   SVBPR2,0                NO, SHOULD WE HAVE ONE?                  
         BE    FSTA50                      NO, ORDER DOESN'T HAVE P/B           
         B     FSTA100                     YES, CHECK NEXT RECORD               
*                                                                               
FSTA25   CLI   SVBPR2,0                YES, DOES ORDER HAVE A P/B?              
         BE    FSTA100                      NO, CHECK NEXT RECORD               
         USING PBELEM,R6                                                        
         CLC   SVBPR2,PBPROD       ORDER PIGGYBACK MATCHS BUY'S P/B?            
         BE    FSTA50              YES                                          
*                                                                               
         CLC   SVBPR2,KEY+BUYKBUY-BUYKEY   BUY PIGGYBACK PASSIVE KEY?           
         BNE   FSTA100                                                          
         L     R1,AIO                                                           
         CLC   SVBPR2,BUYKPRD-BUYKEY(R1)   MAKING SURE                          
         BNE   FSTA100                                                          
         CLC   SVBPRD,PBPROD       ORDER PRODUCT MATCHS BUY'S P/B?              
         BNE   FSTA100                 NO, CHECK NEXT BUY                       
         MVC   PR1TIMSH,PBTIME                                                  
         B     FSTA50                  YES                                      
         DROP  R6                                                               
         EJECT                                                                  
*********                                                                       
* DOES THIS BUY HAVE ANY SPOTS FOR OUR PRD(S)?                                  
*********                                                                       
FSTA50   SR    R0,R0                                                            
         L     R6,AIO                                                           
         USING BUYKEY,R6                                                        
         LA    R6,BDELEM                                                        
*                                                                               
         USING REGELEM,R6                                                       
FSTA52   BAS   RE,VLDREGEL         ANY MORE ORIGINAL ELEMS?                     
         BNE   FSTA100             NO MORE, CHECK NEXT BUY RECORD               
*                                                                               
         CLI   0(R6),X'09'                                                      
         BNH   FSTA56                                                           
         BRAS  RE,CHKPOLEL                                                      
         BE    FSTA56              NO, THIS BUY HAS AN ACTUAL SPOT              
*                                                                               
FSTA54   IC    R0,1(R6)            CHECK NEXT ELEMENT                           
         AR    R6,R0                                                            
         B     FSTA52                                                           
*                                                                               
FSTA56   TM    MISCFLG1,MF1FLTRC   USING FLIGHT RECS?                           
         BZ    FSTA60              NO                                           
         GOTO1 DATCON,DMCB,(2,RDATE),(3,WORK)                                   
         CLC   WORK(3),SVFLTSDT    MAKE SURE BUY DATE IN FLIGHT WEEKS           
         BL    FSTA54                                                           
         CLC   WORK(3),SVFLTEDT                                                 
         BH    FSTA54                                                           
         B     FSTA60                                                           
         DROP  R6                                                               
         EJECT                                                                  
*********                                                                       
* CHECK FOR VALID BUY ELEMENT (REGELEM)                                         
*********                                                                       
VLDREGEL NTR1                                                                   
         USING REGELEM,R6                                                       
VLDREG10 CLI   0(R6),0             ANY MORE ORIGINAL ELEMS?                     
         BE    VLDREGNO            NO MORE                                      
*                                                                               
         CLI   0(R6),X'06'         ORIGINAL ELEM?                               
         BE    VLDREGYS                                                         
         CLI   0(R6),X'07'         OTO ELEM?                                    
         BE    VLDREGYS                                                         
         CLI   0(R6),X'0B'         POOL ORIGINAL ELEM?                          
         BE    VLDREGYS                                                         
         CLI   0(R6),X'0C'         POOL OTO ELEM?                               
         BE    VLDREGYS                                                         
*                                                                               
VLDREG15 ZIC   R0,1(R6)            NO, CHECK NEXT ELEMENT                       
         AR    R6,R0                                                            
         B     VLDREG10                                                         
*                                                                               
VLDREG20 TM    RSTATUS,X'C0'                                                    
         BNZ   VLDREG15                                                         
*                                                                               
VLDREGYS SR    RC,RC                                                            
VLDREGNO LTR   RC,RC                                                            
         XIT1  REGS=(R6)           RETURN R6 TO USER                            
         DROP  R6                                                               
         EJECT                                                                  
*********                                                                       
* WE'RE GOING TO USE THIS RECORD                                                
*********                                                                       
FSTA60   LR    R0,R6               SAVE A(FIRST SPOT ELEMENT)                   
         L     R6,AIO                                                           
         USING BUYKEY,R6                                                        
*                                                                               
         MVC   BYTE,BUYKBUY        SAVE THE LINE NUMBER                         
         LA    RE,BLOCK            STORE BUYLINE IN OUR LIST FOR LATER          
FSTA65   CLI   0(RE),0                                                          
         BE    *+12                                                             
         LA    RE,2(RE)            2 BYTES/BUYLINE, STATUS IS 2ND BYTE          
         B     FSTA65                                                           
         MVC   0(1,RE),BYTE                                                     
*                                                                               
         CLI   KEY+BUYKBUY-BUYKEY+2,2    BUY PIGGY, ACTIVE PRODUCT              
         BNE   *+8                                                              
         OI    1(RE),DOBUYFPA            YES                                    
*                                                                               
         CLC   SVBPRD,BUYKPRD      PRODUCT THE SAME?                            
         BE    *+8                                                              
         OI    1(RE),DOBUYFPG      NO, MUST BE A PIGGYBACK PASSIVE KEY          
*********                                                                       
* HANDLE THE BUY DETAILS                                                        
*********                                                                       
FABDT00  LR    R6,R0               RESTORE POINTER TO FIRST DETAIL              
*                                                                               
FABDT10  BAS   RE,VLDREGEL         END OF RECORD?                               
         BNE   FABDT100            YES, PRINT OUT THE DETAILS NOW               
         B     FABDT20                                                          
*                                                                               
FABDT15  ZIC   R1,1(R6)            NEITHER, ADVANCE TO NEXT ELEMENT             
         AR    R6,R1                                                            
         B     FABDT10                                                          
*                                                                               
         USING REGELEM,R6                                                       
FABDT20  CLI   0(R6),X'09'         NON-POOL ELEMENT?                            
         BNH   FABDT30             YES                                          
*                                                                               
         BRAS  RE,CHKPOLEL         POOL ORIGINAL ELEMENT MATCHES ORDER?         
         BNE   FABDT15             NO, SKIP TO NEXT ELEMENT                     
*                                                                               
FABDT30  CLC   SVAIRDAT,RDATE      GOT AN EARLIER DATE?                         
         BL    FABDT15             NO                                           
*                                                                               
         TM    MISCFLG1,MF1FLTRC   USING FLIGHT RECS?                           
         BZ    FABDT40             NO                                           
         GOTO1 DATCON,DMCB,(2,RDATE),(3,WORK)                                   
         CLC   WORK(3),SVFLTSDT    MAKE SURE BUY DATE IN FLIGHT WEEKS           
         BL    FABDT15                                                          
         CLC   WORK(3),SVFLTEDT                                                 
         BH    FABDT15                                                          
*                                                                               
FABDT40  MVC   SVAIRDAT,RDATE      YES, EARLIER AIR DATE                        
         B     FABDT15                                                          
*                                                                               
FABDT100 DS    0H                                                               
*                                                                               
FABDTX   DS    0H                                                               
         DROP  R6                                                               
*********                                                                       
* GET NEXT BUY RECORD                                                           
*********                                                                       
FSTA100  MVI   RDUPDATE,C'N'       ANY MORE BUYS FOR THIS ORDER?                
         GOTO1 SEQ                                                              
         LA    R6,KEY                                                           
         B     FSTA10                                                           
*********                                                                       
* NO MORE BUY RECORDS                                                           
*********                                                                       
FSTA110  NI    MISCFLG2,X'FF'-MF2VPRDS   DON'T LOOK FOR VAR PRDS ANYMOR         
*                                                                               
         CLI   BLOCK,0             ANY BUYLINES?                                
         BE    FSTANO              NONE                                         
*                                                                               
FSTAYES  B     YES                                                              
*                                                                               
FSTANO   B     NO                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SEND A RECALL TO THE REP                                                      
***********************************************************************         
PRRECALL NTR1  BASE=*                                                           
         B     PRCAL00                                                          
         DC    CL8'**PRRC**'                                                    
*                                                                               
PRCALPRT LR    R0,RE                                                            
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
PRCAL00  DS    0H                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)                                             
PRCAL05  CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   0(R6),DORPELQ                                                    
         BE    PRCAL10                                                          
         CLI   0(R6),DOXMTELQ      WE CHECK FOR THIS BEFORE IN BLDREC           
         BE    PRCAL15                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCAL05                                                          
*                                                                               
         USING DOREPELD,R6                                                      
PRCAL10  MVC   HALF,DORPNREP       COPY THE NEW REP ID NUMBER                   
         B     PRCAL18             NO, DIE                                      
*                                                                               
PRCAL13  TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG2,RCALCANT     CASH ORDER CANNOT BE RECALLED              
         B     XIT                                                              
         OI    TRDEFLG2,RCALCANT     TRADE ORDER CANNOT BE RECALLED             
         B     XIT                                                              
*                                                                               
         USING DOXMTELD,R6                                                      
PRCAL15  OC    DOXMTDID,DOXMTDID   ANY DESTINATION ID?                          
         BZ    PRCAL13                                                          
         MVC   HALF,DOXMTDID                                                    
*                                                                               
         CLC   =X'FFFF',DOXMTDID                                                
         BE    PRCAL13                                                          
         CLC   =X'FFFD',DOXMTDID                                                
         BE    PRCAL13                                                          
         CLC   =X'FFFB',DOXMTDID                                                
         BE    PRCAL13                                                          
         DROP  R6                                                               
*                                                                               
PRCAL18  GOTOR SHWIDNUM,DMCB,HALF,FAKEFLDH                                      
*                                                                               
         OC    FAKEFLD,SPACES                                                   
         OC    ORSROUT,SPACES                                                   
         ZIC   RE,ORSROUTH+7                                                    
         BCTR  RE,0                TEST FOR LENGTH ON SCREEN                    
*                                                                               
         EX    RE,PRCAL18A         COMPARING  SELNY  TO  SELNY4                 
         BE    PRCAL19             SAME, SEND RECALL                            
*                                                                               
         AHI   RE,-2               -2 FOR THE OFFICE                            
         EX    RE,PRCAL18A         DIFFERENT REP THEN CURRENT                   
         BNE   PRCAL19             YES, SEND RECALL TO OLD REP                  
PRCAL18A CLC   ORSROUT(0),FAKEFLD                                               
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG2,RCALWOFF     CASH ORDER RECALL FROM WRONG OFF           
         B     XIT                                                              
         OI    TRDEFLG2,RCALWOFF     TRADE ORDER RECALL FROM WRONG OFF          
         B     XIT                                                              
*                                                                               
PRCAL19  BAS   RE,PRCOPNPQ                                                      
*                                                                               
         MVC   P+4(5),=C'*HDR*'      HEADER RECORD                              
         MVC   P+9(14),=CL14'EDICT=*DDSDARA'                                    
         MVI   P+34,C'W'             WIDE REPORT                                
         MVI   P+35,C'P'             /PAGE FOR EASYLINK AND SUPRESS TOP         
         MVC   P+54+8(L'QMED),QMED   1ST 8 BYTES IS AGENCY BY DAVID             
         MVC   P+54+8+L'QMED(L'QCLT),QCLT                                       
         BAS   RE,PRCALPRT                                                      
*                                                                               
         LA    R3,P                                                             
         USING EDICTD,R3                                                        
         MVC   EDIDDSID,=C'++DDS'                                               
         MVC   EDISYST,=C'DA'      DARE                                         
         MVC   EDIPROG,=C'RCL'     RECALL                                       
         MVC   EDIIDEN,=C'TRN'     TRANSACTION DATA                             
*                                                                               
         MVC   EDIRDRAG,SVUSERID                                                
         MVC   EDIRDRST,ORSSTA                                                  
         MVC   EDIRDRMD,ORSMED                                                  
         MVC   EDIRDRCL(L'QCLT),ORSCLT                                          
         MVC   EDIRDRP1(L'QPRD),SVQPRD                                          
         MVC   EDIRDRP2(L'QPRD),SVQPR2                                          
         MVC   EDIRDRES,ORSEST                                                  
         MVC   EDIRDRAN,SVQCORDR                                                
         MVC   EDIRDRBY,ORSBUYR                                                 
         MVC   EDIRDRSP,ORSSALE                                                 
*                                                                               
         LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         MVC   EDIRDRCN,8(RF)                                                   
*                                                                               
         BAS   RE,PRCALPRT                                                      
*                                                                               
         LA    R2,P                                                             
         USING PAGYCAND,R2                                                      
         MVC   PACNTID,=C'AGYRCL'  ORDER RECALL (AGYRCL)                        
         MVC   PACNORDR,SVQCORDR                                                
         MVC   PACNFRID,SVUSERID                                                
*                                                                               
         MVC   PACNTOID,FAKEFLD                                                 
         MVC   PACNROUT,DARROUTE                                                
*                                                                               
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
         GOTOR CHKMOREP,DMCB,PACNTOID,PACNORDR                                  
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
*                                                                               
***********************************************************************         
* THE X'20' IS TO ALLOW YEAR 2000 TO SHOW AS C'00' INSTEAD OF X'FAF0'           
***********************************************************************         
         GOTO1 DATCON,DMCB,(5,0),(X'20',PACNDATE)                               
*                                                                               
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'     PAST MIDNIGHT?                           
         BL    PRCAL30                                                          
         SP    PACKOF4B,=P'240000'     YES, BUMP TO NEXT DAY AND ADJUST         
         GOTO1 ADDAY,DMCB,PACNDATE,(X'20',PACNDATE),F'1'                        
*                                                                               
PRCAL30  ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STH   R1,HALF                                                          
         GOTO1 HEXOUT,DMCB,HALF,PACNTIME,L'HALF                                 
*                                                                               
         MVC   PACNQSTA(L'QSTA),QSTA                                            
         LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         MVC   PACNRPCN,8(RF)                                                   
*                                                                               
         GOTO1 GETFACT,DMCB,0      SETUP 'RETURN TO SENDER' DATA                
         LA    R4,PACNRTRN                                                      
         USING RTN2SNDR,R4                                                      
         MVC   RTNBUYER,ORSBUYR    NEED THIS FOR DARE NOTIFICATIONS             
         L     R6,DMCB                                                          
         USING FACTSD,R6                                                        
         GOTO1 HEXOUT,DMCB,FASYSID,RTNSYSID,1                                   
         DROP  R6                                                               
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         CLC   RTNSYSID,=C'06'     ARE WE ON FACMEL?                            
         BNE   *+10                                                             
PRCAL40  MVC   RTNSYSID,=C'01'     MAKE IT LOOK LIKE WE'RE ON FACTST            
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         MVC   RTNPWRCD,AGENCY                                                  
         GOTO1 HEXOUT,DMCB,BAGYMD,RTNAGYMD,1                                    
         DROP  R4                                                               
         BAS   RE,PRCALPRT                                                      
*                                                                               
         MVC   P(26),=CL26'*** END OF DDS MESSAGE ***'                          
         BAS   RE,PRCALPRT                                                      
*                                                                               
         MVI   SPMODE,X'FF'        CLOSE THE PRINTQ                             
         BAS   RE,PRCALPRT                                                      
*                                                                               
PRCALX   DS    0H                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 HIGH                                                             
         GOTO1 GETREC                                                           
*                                                                               
         MVI   ELCODE,DOXMTELQ     LOOK FOR FIRST TRANSMISSION ELEM             
         L     R6,AIO                                                           
         BAS   RE,GETEL                                                         
*                                                                               
         USING DOXMTELD,R6                                                      
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    PRCALX10                                                         
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
*                                                                               
PRCALX10 GOTO1 DATCON,DMCB,(0,DUB),(19,DOXMTSTD)                                
         ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DOXMTSTT                                                    
*                                                                               
         MVI   DOXMTSTA,QRECALL                                                 
         DROP  R6                                                               
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ                                                  
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,QRECALL    RECALL                                       
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
PRCALX20 CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS            
         BE    PRCALX25          AND BEFORE AN AUDIT ELEMENT OR NEW             
         CLI   0(R6),DORPELQ2    REP CHANGE ELEMENTS                            
         BE    PRCALX25                                                         
         CLI   0(R6),DOSTELQ                                                    
         BNL   PRCALX25                                                         
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PRCALX20                                                         
*                                                                               
PRCALX25 GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         GOTOR COLPASKY,DMCB,(C'R',0)                                           
*                                                                               
         BRAS  RE,MYPUTREC                                                      
*                                                                               
         BRAS  RE,UPSALREC         UPDATE THE X'04' SALESPERSON RECORD          
*                                                                               
         BRAS  RE,UPDEXTRA         UPDATE THE X'05' EXTRA RECORD                
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BNZ   *+12                                                             
         OI    CASHFLG2,RCALONIT     CASH ORDER BEING RECALLED                  
         B     XIT                                                              
         OI    TRDEFLG2,RCALONIT     TRADE ORDER BEING RECALLED                 
         B     XIT                                                              
         EJECT                                                                  
***********************************************************************         
* SETS UP THE PRINT QUEUE FOR US                                                
***********************************************************************         
PRCOPNPQ NTR1                                                                   
         MVC   REMUSER,=C'DAR'                                                  
         LA    R1,SPOOLKEY                                                      
         USING PQPLD,R1                                                         
         XC    SPOOLKEY,SPOOLKEY                                                
         MVC   PLDESC,=CL11'RECALL'                                             
         OI    GENSTAT3,NOCLRSPK   DON'T CLEAR SPOOL KEY IN OPENPQ              
         MVI   PLCLASS,C'G'                                                     
         OI    SPOOLIND,SPUINIT    ALLOWS ME TO SET THE CLASS                   
         DROP  R1                                                               
         XC    BIGSPLKY,BIGSPLKY                                                
         LA    R1,BIGSPLKY                                                      
         ST    R1,SPOOLQLK                                                      
         USING PQPLD,R1                                                         
         MVC   QLRETNL,=H'48'      SET PRINTQ RETAIN TIMES  48 ACTIVE           
         MVC   QLRETND,=H'24'                               24 PRINTED          
         DROP  R1                                                               
         GOTO1 OPENPQ              OPEN PRINTQ MYSELF                           
*                                                                               
         OI    BITFLAG,X'20'                                                    
*                                                                               
PRCOPQX  B     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SEND A NOTDARE TO THE REP                                                     
***********************************************************************         
PRNODARE NTR1  BASE=*,LABEL=*                                                   
         B     PNDAR00                                                          
*                                                                               
PNDARPRT LR    R0,RE                                                            
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
PNDAR00  DS    0H                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)                                             
PNDAR05  CLI   0(R6),0                                                          
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         CLI   0(R6),DORPELQ                                                    
         BE    PNDAR10                                                          
         CLI   0(R6),DOXMTELQ      WE CHECK FOR THIS BEFORE IN BLDREC           
         BE    PNDAR15                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PNDAR05                                                          
*                                                                               
         USING DOREPELD,R6                                                      
PNDAR10  MVC   HALF,DORPNREP       COPY NEW REP ID NUMBER                       
         B     PNDAR18                                                          
*                                                                               
         USING DOXMTELD,R6                                                      
PNDAR15  OC    DOXMTDID,DOXMTDID   ANY DESTINATION ID?                          
         BNZ   *+6                                                              
         DC    H'0'                NO, DIE                                      
         MVC   HALF,DOXMTDID                                                    
         DROP  R6                                                               
*                                                                               
PNDAR18  GOTOR SHWIDNUM,DMCB,HALF,FAKEFLDH                                      
*                                                                               
         BAS   RE,PNDOPNPQ                                                      
*                                                                               
         MVC   P+4(5),=C'*HDR*'      HEADER RECORD                              
         MVC   P+9(14),=CL14'EDICT=*DDSDARA'                                    
         MVI   P+34,C'W'             WIDE REPORT                                
         MVI   P+35,C'P'             /PAGE FOR EASYLINK AND SUPRESS TOP         
         MVC   P+54+8(L'QMED),QMED   1ST 8 BYTES IS AGENCY BY DAVID             
         MVC   P+54+8+L'QMED(L'QCLT),QCLT                                       
         BAS   RE,PNDARPRT                                                      
*                                                                               
         LA    R3,P                                                             
         USING EDICTD,R3                                                        
         MVC   EDIDDSID,=C'++DDS'                                               
         MVC   EDISYST,=C'DA'      DARE                                         
         MVC   EDIPROG,=C'NOT'     NOTDARE                                      
         MVC   EDIIDEN,=C'TRN'     TRANSACTION DATA                             
*                                                                               
         MVC   EDIRDRAG,SVUSERID                                                
         MVC   EDIRDRST,ORSSTA                                                  
         MVC   EDIRDRMD,ORSMED                                                  
         MVC   EDIRDRCL(L'QCLT),ORSCLT                                          
         MVC   EDIRDRP1(L'QPRD),SVQPRD                                          
         MVC   EDIRDRP2(L'QPRD),SVQPR2                                          
         MVC   EDIRDRES,ORSEST                                                  
         MVC   EDIRDRAN,SVQCORDR                                                
         MVC   EDIRDRBY,ORSBUYR                                                 
         MVC   EDIRDRSP,ORSSALE                                                 
*                                                                               
         LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         MVC   EDIRDRCN,8(RF)                                                   
*                                                                               
         BAS   RE,PNDARPRT                                                      
*                                                                               
         LA    R2,P                                                             
         USING PAGYCAND,R2                                                      
         MVC   PACNTID,=C'AGYCAN'  ORDER CANCELLATION (NOTDARE)                 
         MVC   PACNORDR,SVQCORDR                                                
         MVC   PACNFRID,SVUSERID                                                
*                                                                               
         MVC   PACNTOID,FAKEFLD                                                 
*                                                                               
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
         GOTOR CHKMOREP,DMCB,PACNTOID,PACNORDR                                  
**** SPECIAL CODE FOR MEDIA OCEAN CUTOFF DATE *** HWON 11/07/02                 
         MVC   PACNROUT,DARROUTE                                                
***********************************************************************         
* THE X'20' IS TO ALLOW YEAR 2000 TO SHOW AS C'00' INSTEAD OF X'FAF0'           
***********************************************************************         
         GOTO1 DATCON,DMCB,(5,0),(X'20',PACNDATE)                               
*                                                                               
*        GOTO1 TICTOC,DMCB,C'SGET'     GET THE CURRENT TIME                     
*        ZAP   PACKOF4B,DMCB(4)                                                 
*        AP    PACKOF4B,=P'60000'      DDS TIME IS OFFSET FROM 6AM              
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         CP    PACKOF4B,=P'240000'     PAST MIDNIGHT?                           
         BL    PNDAR20                                                          
         SP    PACKOF4B,=P'240000'     YES, BUMP TO NEXT DAY AND ADJUST         
         GOTO1 ADDAY,DMCB,PACNDATE,(X'20',PACNDATE),F'1'                        
*                                                                               
PNDAR20  ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STH   R1,HALF                                                          
         GOTO1 HEXOUT,DMCB,HALF,PACNTIME,L'HALF                                 
         MVC   PACNQSTA(L'QSTA),QSTA                                            
*                                                                               
         LA    RF,ORSCONTH                                                      
         TM    MISCFLG1,MF1DRTRD                                                
         BZ    *+8                                                              
         LA    RF,ORSTCONH                                                      
         MVC   PACNRPCN,8(RF)                                                   
*                                                                               
         GOTO1 GETFACT,DMCB,0      SETUP 'RETURN TO SENDER' DATA                
         LA    R4,PACNRTRN                                                      
         USING RTN2SNDR,R4                                                      
         MVC   RTNBUYER,ORSBUYR    NEED THIS FOR DARE NOTIFICATIONS             
         L     R6,DMCB                                                          
         USING FACTSD,R6                                                        
         GOTO1 HEXOUT,DMCB,FASYSID,RTNSYSID,1                                   
         DROP  R6                                                               
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         CLC   RTNSYSID,=C'06'     ARE WE ON FACMEL?                            
         BNE   *+10                                                             
PNDAR25  MVC   RTNSYSID,=C'01'     MAKE IT LOOK LIKE WE'RE ON FACTST            
*********                                                                       
* SPECIAL CODE FOR FACMEL                                                       
*********                                                                       
         MVC   RTNPWRCD,AGENCY                                                  
         GOTO1 HEXOUT,DMCB,BAGYMD,RTNAGYMD,1                                    
         DROP  R4                                                               
         BAS   RE,PNDARPRT                                                      
*                                                                               
         MVC   P(26),=CL26'*** END OF DDS MESSAGE ***'                          
         BAS   RE,PNDARPRT                                                      
*                                                                               
         MVI   SPMODE,X'FF'        CLOSE THE PRINTQ                             
         BAS   RE,PNDARPRT                                                      
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),SAVEKEY                                             
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 HIGH                                                             
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOXMTELQ                                                  
         BAS   RE,GETEL                                                         
*                                                                               
         LA    R2,DOXMELEM                           PREV TRAN ELEM             
         USING DOXMTELD,R2                                                      
         XC    DOXMELEM,DOXMELEM                                                
         MVC   DOXMELEM(DOXMTDND-DOXMTELD),0(R6)  COPY ID INFO FROM OLD         
*                                                                               
         THMS  DDSTIME=YES                                                      
         STCM  R0,15,PACKOF4B                                                   
         ST    R1,FULL                                                          
         AP    PACKOF4B,FULL                                                    
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(0,DUB)   THE TIME                             
         CP    PACKOF4B,=P'240000'    PAST MIDNIGHT?                            
         BL    PNDAR30                                                          
         SP    PACKOF4B,=P'240000'    YES, BUMP TO NEXT DAY AND ADJUST          
         GOTO1 ADDAY,DMCB,DUB,DUB,F'1'                                          
*                                                                               
PNDAR30  GOTO1 DATCON,DMCB,(0,DUB),(19,DOXMTYMD)                                
*                                                                               
         ICM   R1,15,PACKOF4B                                                   
         SRL   R1,12               GET RID OF SECONDS AND SIGN                  
         STCM  R1,3,DOXMTTIM                                                    
*                                                                               
         MVC   DOXMTSTD,DOXMTYMD                                                
         MVC   DOXMTSTT,DOXMTTIM                                                
         MVI   DOXMTSTA,QNODARE                                                 
         DROP  R2                                                               
*                                                                               
         BRAS  RE,FRSTXMIT                                                      
         GOTO1 RECUP,DMCB,(C'S',AIO),DOXMELEM,(R6)   ADD THIS ELEMENT           
*                                                                               
         LA    R2,DOSTELEM         NEW STATUS ELEMENT (AUDIT TRAIL)             
         USING DOSTELD,R2                                                       
         XC    DOSTELEM,DOSTELEM                                                
         MVI   DOSTEL,DOSTELQ                                                   
         MVI   DOSTLEN,DOSTLNQ                                                  
         BRAS  RE,GETDAYTM                                                      
         MVI   DOSTSTAT,QNODARE    NODARE                                       
         DROP  R2                                                               
*                                                                               
         L     R6,AIO                                                           
         LA    R6,DORFRST-DOKEY(R6)  R6 = A(FIRST ELEMENT IN RECORD)            
PNDAR40  CLI   0(R6),0           ADD AFTER ALL TRANSMISSION ELEMENTS            
         BE    PNDAR45           AND BEFORE AN AUDIT ELEMENT                    
         CLI   0(R6),DOSTELQ                                                    
         BNL   PNDAR45                                                          
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         B     PNDAR40                                                          
*                                                                               
PNDAR45  GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R6)                              
*                                                                               
         GOTOR COLPASKY,DMCB,(C'K',0)                                           
*                                                                               
         BRAS  RE,MYPUTREC                                                      
*                                                                               
         BRAS  RE,UPSALREC         UPDATE THE X'04' SALESPERSON RECORD          
*                                                                               
         BRAS  RE,UPDEXTRA         UPDATE THE X'05' EXTRA RECORD                
*                                                                               
         LA    R2,ORSMEDH                                                       
         MVC   BLOCK+1(7),=C'NOTDARE'                                           
         MVI   BLOCK,8                    L(MESSAGE WITH TERMINATING 0)         
         MVI   BLOCK+8,0                  TERMINATING 0                         
         J     ONITSWAY                                                         
         EJECT                                                                  
***********************************************************************         
* SETS UP THE PRINT QUEUE FOR US                                                
***********************************************************************         
PNDOPNPQ NTR1                                                                   
         MVC   REMUSER,=C'DAR'                                                  
         LA    R1,SPOOLKEY                                                      
         USING PQPLD,R1                                                         
         XC    SPOOLKEY,SPOOLKEY                                                
         MVC   PLDESC,=CL11'NOTDARE'                                            
         OI    GENSTAT3,NOCLRSPK   DON'T CLEAR SPOOL KEY IN OPENPQ              
         MVI   PLCLASS,C'G'                                                     
         OI    SPOOLIND,SPUINIT    ALLOWS ME TO SET THE CLASS                   
         DROP  R1                                                               
         XC    BIGSPLKY,BIGSPLKY                                                
         LA    R1,BIGSPLKY                                                      
         ST    R1,SPOOLQLK                                                      
         USING PQPLD,R1                                                         
         MVC   QLRETNL,=H'48'      SET PRINTQ RETAIN TIMES  48 ACTIVE           
         MVC   QLRETND,=H'24'                               24 PRINTED          
         DROP  R1                                                               
         GOTO1 OPENPQ              OPEN PRINTQ MYSELF                           
*                                                                               
         OI    BITFLAG,X'20'                                                    
*                                                                               
PNDOPQX  B     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* TIME TO READ THE BUYS                                                         
***********************************************************************         
PRTBUYS  NTR1  BASE=*,LABEL=*                                                   
         B     PRBUY00                                                          
*                                                                               
PRBLINE  LR    R0,RE                                                            
         L     R1,AGYNMRCS         INCREMENT NUMBER OF RECORDS PRINTED          
         AHI   R1,1                                                             
         ST    R1,AGYNMRCS                                                      
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
PRBUY00  XCEFL BLOCK,480           SAVE THE LIST OF BUYLINES USED               
***********************************                                             
         L     RE,AIO2             CLEAR OUT AIO2 FOR MAKEGOODS                 
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
***********************************                                             
         LA    R6,KEY              SET UP THE BUY KEY                           
         USING BUYKEY,R6                                                        
         XC    KEY,KEY                                                          
         MVC   BUYKAM,BAGYMD                                                    
         MVC   BUYKCLT,BCLT                                                     
         MVC   BUYKPRD,SVBPRD                                                   
         MVC   BUYMSTA,BMKTSTA                                                  
         MVC   BUYKEST,SVBEST                                                   
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
PRBUY10  CLC   BUYKAM(L'BUYKAM+L'BUYKCLT),BAGYMD       SAME BASE KEY?           
         BNE   PRBUY110                                                         
         CLC   BUYKPRD,SVBPRD                                                   
         BNE   PRBUY110                                                         
         CLC   BUYMSTA,BMKTSTA                                                  
         BNE   PRBUY110                                                         
         CLC   BUYKEST,SVBEST                                                   
         BNE   PRBUY110            NO, DONE                                     
*********                                                                       
* BRAND-POL BUY                                                                 
*********                                                                       
         CLI   BUYKBUY,X'FF'       POL-BRAND TYPE OF BUY?                       
         BE    PRBUY20             YES, CAN'T DETERMINE IF PIGGY YET            
*********                                                                       
* OUR PRD USED AS A PIGGYBACK AND OUR PIGGYBACK USED AS THE PRODUCT             
*********                                                                       
         CLI   BUYKBUY,0           OUR PRODUCT IS USED AS A PIGGYBACK?          
         BE    PRBUY13             NO, AS A MASTER PRODUCT                      
         CLI   SVBPR2,0            YES, DO WE HAVE A PIGGYBACK?                 
         BE    PRBUY100                 NO, SKIP THIS RECORD                    
         CLC   SVBPR2,BUYKBUY           YES, OUR P/B USED AS PRD?               
         BNE   PRBUY100                      NO, SKIP THIS RECORD               
         B     PRBUY20                                                          
*********                                                                       
* OUR PRD IS USED AS THE MASTER PRODUCT OF BUY (POSSIBLE PIGGYBACK)             
*********                                                                       
PRBUY13  CLI   SVBPR2,0            ORDER HAS PIGGYBACK?                         
         BNE   PRBUY16                                                          
         CLI   BUYKBUY+2,X'01'     NO, REGULAR BUY (NO PIGGYBACK)?              
         BE    PRBUY20                 YES                                      
         B     PRBUY100                NO, GET NEXT BUY RECORD                  
*                                                                               
PRBUY16  CLI   BUYKBUY+2,X'02'     YES, PIGGYBACK BUY, ACTIVE PRODUCT?          
         BNE   PRBUY100                 NO, GET NEXT BUY RECORD                 
***************                                                                 
* WE CAN READ THE BUY NOW                                                       
***************                                                                 
PRBUY20  MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
*                                                                               
         L     R6,AIO                                                           
*                                                                               
         TM    BUYRCNTL,X'80'      RECORD DELETED?                              
         BNZ   PRBUY100            YES, SKIP THIS RECORD                        
*                                                                               
         TM    MISCFLG1,MF1FLTRC   DOING FLIGHT?                                
         BZ    PRBUY22                                                          
*&&DO                                                                           
         CLI   SVBFLT,0            SENDING ORIGINAL ORDER BEFORE                
         BNE   PRBUY20G               FLIGHTS WERE ESTABLISHED                  
         CLC   BDSTART,SVFLTEDT    YES, HAVE A BUY ON OR BEFORE 1ST             
         BH    PRBUY22                      NON-FLIGHT DATE?                    
         BNL   PRBUY100                 YES                                     
*                                                                               
PRBUY20A CLC   BDSTART,SVFLTSDT    NO, HAVE A BUY BEFORE 1ST FLIGHT?            
         BNL   PRBUY22                                                          
         B     PRBUY100                YES                                      
*&&                                                                             
PRBUY20G CLC   BDSTART,SVFLTSDT    MAKE SURE BUY IS IN FLIGHT                   
         BL    PRBUY21                                                          
         CLC   BDSTART,SVFLTEDT                                                 
         BH    PRBUY100                                                         
         B     PRBUY22                                                          
*                                                                               
PRBUY21  CLC   BDEND,SVFLTSDT                                                   
         BL    PRBUY100                                                         
*                                                                               
PRBUY22  MVI   PR1TIMSH,0          0 MEANS USE BDTIME                           
         CLI   BUYKPRD,X'FF'       POL-BRAND TYPE OF BUY?                       
         BE    PRBUY30             YES                                          
*********                                                                       
* REGULAR BUY                                                                   
*********                                                                       
         MVI   ELCODE,X'04'        NO, ANY PIGGYBACK ELEM?                      
         BAS   RE,GETEL                                                         
         BE    PRBUY25                                                          
         CLI   SVBPR2,0                NO, SHOULD WE HAVE ONE?                  
         BE    PRBUY50                     NO, ORDER DOESN'T HAVE P/B           
         B     PRBUY100                    YES, CHECK NEXT RECORD               
*                                                                               
PRBUY25  CLI   SVBPR2,0                YES, DOES ORDER HAVE A P/B?              
         BE    PRBUY100                     NO, CHECK NEXT RECORD               
         USING PBELEM,R6                                                        
         CLC   SVBPR2,PBPROD       ORDER PIGGYBACK MATCHS BUY'S P/B?            
         BE    PRBUY50             YES                                          
*                                                                               
         CLC   SVBPR2,KEY+BUYKBUY-BUYKEY   BUY PIGGYBACK PASSIVE KEY?           
         BNE   PRBUY100                                                         
         L     R1,AIO                                                           
         CLC   SVBPR2,BUYKPRD-BUYKEY(R1)   MAKING SURE                          
         BNE   PRBUY100                                                         
         CLC   SVBPRD,PBPROD       ORDER PRODUCT MATCHS BUY'S P/B?              
         BNE   PRBUY100                NO, CHECK NEXT BUY                       
         MVC   PR1TIMSH,PBTIME                                                  
         B     PRBUY50                 YES                                      
         DROP  R6                                                               
*********                                                                       
* BRAND-POL BUY                                                                 
*********                                                                       
PRBUY30  SR    R0,R0               USE ANY SPOTS THAT MATCH                     
         USING BUYKEY,R6                                                        
         LA    R6,BDELEM                                                        
*                                                                               
PRBUY32  CLI   0(R6),0             NO MORE POOL ORIGINAL ELEMS?                 
         BNE   PRBUY34             NO, GOT MORE                                 
         TM    MISCFLG1,MF1DRREV   DOING ORDER REVISION?                        
         BZ    PRBUY100            NO, CHECK NEXT BUY RECORD                    
         L     R6,AIO              YES, CHECK IF THIS BUY IS ONE OF OUR         
         SR    RF,RF                   ORIGINAL WE SENT OVER FIRST TIME         
         ZIC   RE,BUYKBUY-BUYRECD(R6)                                           
         BCTR  RE,0                                                             
         SRDL  RE,3                                                             
         LA    RE,BUYLINES(RE)                                                  
         SRL   RF,5                                                             
         STCM  RF,8,BYTE                                                        
*                                                                               
         LA    R0,X'80'                                                         
         ZIC   R1,BYTE                                                          
         SRL   R0,0(R1)                                                         
         STC   R0,HALF                                                          
*                                                                               
         NC    HALF(1),0(RE)                                                    
         BNZ   PRBUY50             ONE OF THE ORIGINAL BUYLINES                 
         OC    BDMGDATE,BDMGDATE   IS THIS MAKING GOOD SOEMTHING?               
         BNZ   PRBUY50             YES, THIS LINE IS IMPORTANT                  
         B     PRBUY100            NO, THEN WHO CARES                           
*                                                                               
PRBUY34  CLI   0(R6),X'0B'         POOL ORIGINAL ELEM?                          
         BE    *+12                                                             
         CLI   0(R6),X'0C'         POOL OTO ELEM?                               
         BNE   PRBUY30N            NO, CHECK NEXT ELEMENT                       
*                                                                               
         BRAS  RE,CHKPOLEL         ONE THAT MATCHES ORDER?                      
         BE    PRBUY50             YES                                          
         DC    X'0700'             WHY IS THERE A NOP HERE?                     
*                                                                               
PRBUY30N IC    R0,1(R6)            CHECK NEXT ELEMENT                           
         AR    R6,R0                                                            
         B     PRBUY32                                                          
         EJECT                                                                  
*********                                                                       
* DOES THIS BUY HAVE ANY SPOTS?                                                 
*********                                                                       
PRBUY50  SR    R0,R0                                                            
         L     R6,AIO                                                           
         USING BUYKEY,R6                                                        
         LA    R6,BDELEM                                                        
*                                                                               
         USING REGELEM,R6                                                       
PRBUY52  CLI   0(R6),0             NO MORE POOL ORIGINAL ELEMS?                 
         BNE   PRBUY54             NO, GOT MORE                                 
         TM    MISCFLG1,MF1DRREV   DOING ORDER REVISION?                        
         BZ    PRBUY100            NO, CHECK NEXT BUY RECORD                    
         B     PRBUY60                                                          
*                                                                               
PRBUY54  CLI   0(R6),X'06'         ORIGINAL ELEM?                               
         BE    PRBUY56                                                          
         CLI   0(R6),X'07'         OTO ELEM?                                    
         BE    PRBUY56                                                          
         CLI   0(R6),X'0B'         POOL ORIGINAL ELEM?                          
         BE    PRBUY56                                                          
         CLI   0(R6),X'0C'         POOL OTO ELEM?                               
         BNE   PRBUY58             NO, CHECK NEXT ELEMENT                       
*                                                                               
PRBUY56  TM    RSTATUS,X'C0'       MINUSED?                                     
         BNZ   PRBUY58             YES, NOT AN ACTUAL SPOT                      
         TM    MISCFLG1,MF1FLTRC   NO, DOING AN ORDER W/ FLIGHT?                
         BZ    PRBUY60                 NO, NORMAL ORDER                         
         GOTO1 DATCON,DMCB,(3,SVFLTSDT),(2,FULL)                                
         GOTO1 DATCON,DMCB,(3,SVFLTEDT),(2,FULL+2)                              
         CLC   RDATE,FULL                                                       
         BL    PRBUY58                                                          
         CLC   RDATE,FULL+2                                                     
         BNH   PRBUY60                                                          
*                                                                               
PRBUY58  IC    R0,1(R6)            CHECK NEXT ELEMENT                           
         AR    R6,R0                                                            
         B     PRBUY52                                                          
         DROP  R6                                                               
*********                                                                       
* WE'RE GOING TO USE THIS RECORD                                                
*********                                                                       
PRBUY60  L     R6,AIO                                                           
         USING BUYKEY,R6                                                        
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    PRBUY61             NO, LET'S SEE IF WE HAVE TRADE BUYS          
         BRAS  RE,CHKIFTRD                                                      
         BNE   PRBUY100                                                         
         B     PRBUY61A                                                         
*                                                                               
PRBUY61  BRAS  RE,CHKIFTRD                                                      
         BNE   PRBUY61A                                                         
         OI    MISCFLG1,MF1TRDRC   WE HAVE A TRADE CONDITION                    
         B     PRBUY100                                                         
*                                                                               
PRBUY61A MVC   BYTE,BUYKBUY        SAVE THE LINE NUMBER                         
         LA    RE,BLOCK            STORE BUYLINE IN OUR LIST FOR LATER          
PRBUY62  CLI   0(RE),0                                                          
         BE    *+12                                                             
         LA    RE,2(RE)            2 BYTES/BUYLINE, STATUS IS 2ND BYTE          
         B     PRBUY62                                                          
         MVC   0(1,RE),BYTE                                                     
*                                                                               
         CLI   KEY+BUYKBUY-BUYKEY+2,2    BUY PIGGY, ACTIVE PRODUCT              
         BNE   *+8                                                              
         OI    1(RE),DOBUYFPA            YES                                    
*                                                                               
         CLC   SVBPRD,BUYKPRD      PRODUCT THE SAME?                            
         BE    *+8                                                              
         OI    1(RE),DOBUYFPG      NO, MUST BE A PIGGYBACK PASSIVE KEY          
*                                                                               
         MVI   ELCODE,X'01'        R6 = A(BUY DESCRIPTION ELEMENT)              
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING BDELEM,R6                                                        
         L     R4,APRTLINE                                                      
         USING PBUYHDRD,R4                                                      
*                                                                               
         GOTOR GTMYRATE,DMCB,(0,WORK)                                           
         L     R1,WORK+4           GROSS DOLLARS                                
         L     R0,WORK+12          TAXED DOLLARS                                
         SR    R1,R0                                                            
         STCM  R1,15,SVBDCOST      GROSS-TAX                                    
         MVC   SVBDNOWK,BDNOWK     PER WEEK FOR LATER                           
*                                                                               
         MVC   PBHDTID,=C'BUYHDR'                                               
         MVC   PBHDORDR,SVQCORDR                                                
         EDIT  (B1,BYTE),(4,PBHDBLIN),0,FILL=0                                  
*********                                                                       
         OC    BDMGDATE,BDMGDATE   ANY MAKEGOOD GROUP CODE?                     
         BZ    PRBUY68             NONE                                         
         TM    MISCFLG1,MF1DRREV   DOING DARE REVISIONS?                        
         BZ    PRBUY69                                                          
         TM    OMBASFLG,OMFJDSRP   STATION HAS A JDS REP?                       
         BNZ   PRBUY69             YES, THEY DON'T WANT MAKEGOOD LINK           
*                                                                               
         L     RE,AIO2                                                          
PRBUY65  CLI   0(RE),0                                                          
         BE    PRBUY68                                                          
         CLC   1(2,RE),BDMGDATE    MATCHES ALPHA MAKEGOOD CODE?                 
         BE    PRBUY67             YES, SHOW BUYLINE MAKEGOOD IS FOR            
         LA    RE,3(RE)                                                         
         L     R1,AIO2                                                          
         AHI   R1,LIOS                                                          
         CR    RE,R1                                                            
         BL    PRBUY65                                                          
         DC    H'0'                                                             
*                                                                               
PRBUY67  MVC   BYTE,0(RE)                                                       
         EDIT  (B1,BYTE),(3,PBHDMGBL),FILL=0                                    
         B     PRBUY69                                                          
*********                                                                       
* NOT A MAKEGOOD BUY, LOOK TO SEE IF SENDING A DARE BONUS BUYLINE               
*********                                                                       
PRBUY68  TM    MISCFLG1,MF1DRREV   DOING DARE REVISIONS?                        
         B     PRBUY69         *** DO NOT SEND THE BONUS FLAG!! ***             
         XR    R1,R1                                                            
         L     RE,AIO              LOOK AT THE BUY                              
         LA    RE,24(RE)                                                        
PRBUY68A CLI   0(RE),0             ANY DARE MAKEGOOD TRACE ELEMENT?             
         BE    PRBUY69                                                          
         CLI   0(RE),BDARCODQ      X'9E'                                        
         BE    PRBUY68B            THIS LINE MUST BE A BONUS FROM DARE          
         IC    R1,1(RE)                                                         
         AR    RE,R1                                                            
         B     PRBUY68A                                                         
*                                                                               
PRBUY68B MVI   PBHDMGBL,C'B'       LET SELLER KNOW BONUS                        
*********                                                                       
PRBUY69  GOTOR SHWDAYS,DMCB,(BDDAY,PBHDROTN)                                    
*                                                                               
         CLI   BDSEDAY,0           =====> ACCORDING TO MEL <=====               
         BNE   PRBUY70             USE BDSEDAY'S START DAY # UNLESS 0           
         GOTO1 DATCON,DMCB,(3,BDSTART),(0,DUB)   OTHERWISE USE START            
         GOTO1 GETDAY,DMCB,(0,DUB),FULL          DAY'S DAY #                    
         MVC   BYTE,0(R1)                                                       
         B     PRBUY72                                                          
*                                                                               
PRBUY70  ZIC   R1,BDSEDAY                                                       
         SRL   R1,4                                                             
         STC   R1,BYTE                                                          
*                                                                               
PRBUY72  EDIT  (B1,BYTE),(1,PBHDRSDT)     OUT-OF-WEEK ROTATOR                   
*                                                                               
         MVI   PBHDSTYP,C'W'                                                    
*****    TM    ESTFLAG1,ESTDAILY   DAILY SCHEDULE?                              
         TM    BDSTAT2,X'80'       DAILY SCHEDULE IN BUY?                       
         BZ    *+8                                                              
         MVI   PBHDSTYP,C'D'                                                    
*                                                                               
         OC    BDTIMST,BDTIMST                                                  
         BNZ   *+14                                                             
         MVC   PBHDSTIM,ZEROS                                                   
         B     PRBUY75                                                          
*                                                                               
         ZICM  R3,BDTIMST,2                                                     
         CHI   R3,600                                                           
         BNL   *+8                                                              
         AHI   R3,2400                                                          
         EDIT  (R3),(4,PBHDSTIM),FILL=0                                         
*                                                                               
PRBUY75  OC    BDTIMEND,BDTIMEND                                                
         BNZ   *+14                                                             
*****    MVC   PBHDETIM,ZEROS                                                   
         MVC   PBHDETIM,PBHDSTIM    <=== FOR THOSE OTHER SYSTEMS                
         B     PRBUY80                                                          
*                                                                               
         ZICM  R3,BDTIMEND,2                                                    
         CHI   R3,600                                                           
         BNL   *+8                                                              
         AHI   R3,2400                                                          
         EDIT  (R3),(4,PBHDETIM),FILL=0                                         
*                                                                               
PRBUY80  EDIT  (B1,BDSEC),(3,PBHDTSLN),FILL=0                                   
*                                                                               
         MVI   PBHDLUNT,C'S'                                                    
*                                                                               
         MVC   PBHDPGNM(L'BDPROGRM),BDPROGRM                                    
         EDIT  (B4,SVBDCOST),(9,PBHDCOST),FILL=0                                
*                                                                               
         MVI   PBHDCSQL,C'C'       COMMISSION ONLY                              
         TM    BDCIND2,X'80'                                                    
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C' '       GROSS                                        
         TM    BDCIND,X'20'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'F'       FEE                                          
         TM    BDCIND,X'80'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'Q'       Q-RATE                                       
         TM    BDCIND,X'40'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'N'       17.65 NET                                    
         TM    BDCIND,X'10'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'V'       15.00 NET                                    
         TM    BDCIND,X'08'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'S'       SPECIAL - NO COMMISSION                      
         TM    BDCIND,X'04'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'X'       X RATE - 10% COMMISSION                      
         TM    BDCIND,X'02'                                                     
         BO    PRBUY83                                                          
         MVI   PBHDCSQL,C'P'                                                    
*                                                                               
PRBUY83  MVC   BYTE,PR1TIMSH       COPY PRODUCT 1 TIME SHARE                    
         CLI   PR1TIMSH,0          USE BDTIME?                                  
         BNE   PRBUY85                                                          
         CLI   BDTIME,0                         ANY PRODUCT TIME SHARE?         
         BE    PRBUY90                                                          
         MVC   BYTE,BDTIME                                                      
PRBUY85  EDIT  (B1,BYTE),(3,PBHDTMSH),FILL=0  YES                               
*                                                                               
PRBUY90  BAS   RE,PRBLINE                                                       
         XC    BDNTAX,BDNTAX       IGNORE ANY TAX                               
         DROP  R4,R6                                                            
************************************************************                    
* HANDLE BUY DEMOS                                                              
************************************************************                    
PBDEM00  CLI   ORSINDMH+5,0        ANY INCLUDE DEMO OVERRIDE?                   
         BE    PBDEM02             NO, USE DARE PROFILE                         
         CLI   ORSINDM,C'N'        YES, INCLUDE DEMOS IN ORDER?                 
         BE    PBDEMX                   NO                                      
         B     PBDEM06                  YES                                     
*                                                                               
PBDEM02  CLI   PDARDEMS,C'Y'       INCLUDE DEMOS IN ORDER?                      
         BE    PBDEM06             YES                                          
         CLI   PDARDEMS,C'4'        CAN HAVE 1-4 DEMOS                          
         BH    PBDEMX        <====    OR C'N'                                   
         CLI   PDARDEMS,C'1'        CAN HAVE UPTO 4 DEMOS                       
         BL    PBDEMX                                                           
*                                                                               
PBDEM06  L     R2,APRTLINE                                                      
         USING PBUYDEMD,R2                                                      
         L     R6,AIO                                                           
         MVC   PBDMTID,=C'BUYDEM'     TRANSMISSION ID                           
         MVC   PBDMORDR,SVQCORDR                                                
         MVI   ELCODE,X'02'                                                     
         BAS   RE,GETEL                                                         
         BNE   PBDEMX                                                           
         USING NDELEM,R6                                                        
         LA    R4,ESTDEMOS                                                      
         OC    0(3,R4),0(R4)                                                    
         BZ    PBDEMX                                                           
         LA    R1,PBDMVAL                                                       
PBDEM10  LA    R3,NDEMNO        CHECK I ORDER OF ESTIMATE DEMOS                 
PBDEM20  OC    0(3,R4),0(R4)                                                    
         BZ    PBDEM40                                                          
         LA    RE,ESTDEMOS+12                                                   
         CR    R4,RE            ONLY FOUR DEMOS NEEDED                          
         BNL   PBDEM40                                                          
         CLC   0(3,R4),0(R3)                                                    
         BE    PBDEM30                                                          
         LA    R3,8(R3)         SKIP DEMO NUM,HUT ADJUSTMENT AND DEMO           
         ZIC   R0,1(R6)                                                         
         AR    R0,R6                                                            
         CR    R3,R0                                                            
         BNH   PBDEM20          VAL                                             
         MVI   0(R1),C'0'                                                       
         MVC   1(L'PBDMVAL-1,R1),0(R1)                                          
         B     PBDEM35          NEXT DEMO CATEGORY                              
*                                                                               
PBDEM30  DS    0H               FOUND DEMO VAL R3 NOW POINTS TO DEMO            
         MVC   FULL,4(R3)       MOVE IN DEMO VALUE                              
         NI    FULL,X'3F'       GET RID OF OVERRIDE AND 2 DECIMAL BITS          
*                                                                               
         TM    4(R3),X'40'      2 DECIMAL PRECISION FLAG ON?                    
         BZ    PBDEM34          NO                                              
         XR    RE,RE                                                            
         L     RF,FULL          YES, ADJUST 2 DECIMAL PRECISION TO 1            
         M     RE,=F'2'                                                         
         D     RE,=F'10'                                                        
         AHI   RF,1                                                             
         SRA   RF,1                                                             
         ST    RF,FULL                                                          
*                                                                               
PBDEM34  EDIT  (B4,FULL),(7,0(R1)),ALIGN=RIGHT,FILL=0                           
PBDEM35  LA    R1,7(R1)                                                         
         LA    R4,3(R4)         GET NEXT EST DEMO                               
         B     PBDEM10                                                          
*                                                                               
PBDEM40  BAS   RE,PRBLINE                                                       
         DROP  R2                                                               
PBDEMX   DS    0H                                                               
*********                                                                       
* HANDLE THE BUY ORBITS                                                         
*********                                                                       
PRBOR00  L     R6,AIO                                                           
         MVI   ELCODE,X'67'                                                     
         BAS   RE,GETEL                                                         
         BNE   PRBORX                                                           
*                                                                               
         GOTO1 ,BINPARMS,,AIO3,0,PBUYORBL,PBORPGNM-PBORTID,10                   
         L     RE,AIO3             CLEAR OUT OUR BINSRCH TABLE                  
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
*                                                                               
         L     R4,APRTLINE                                                      
         USING PBUYORBD,R4                                                      
         USING ORBELEM,R6                                                       
         ZIC   R3,ORBLEN                                                        
         SH    R3,=Y(ORBDAY-ORBELEM)                                            
         SRL   R3,4                R3 = NUMBER OF SHOWS                         
         LTR   R3,R3                                                            
         BZ    PRBORX              EXIT IF NONE                                 
*                                                                               
         LA    R6,ORBDAY                                                        
         USING ORBDAY,R6                                                        
*                                                                               
PRBOR10  MVC   PBORTID,=C'BUYORB'                                               
         MVC   PBORORDR,SVQCORDR                                                
         MVI   PBORCONT,C'*'                                                    
         GOTOR SHWDAYS,DMCB,(ORBDAY,PBORROTN)                                   
         EDIT  (B1,SVOOWROT),(1,PBORRSDT)                                       
*                                                                               
         OC    ORBTIME(2),ORBTIME                                               
         BNZ   *+14                                                             
         MVC   PBORSTIM,ZEROS                                                   
         B     PRBOR20                                                          
*                                                                               
         ZICM  R2,ORBTIME,2                                                     
         CHI   R2,600                                                           
         BNL   *+8                                                              
         AHI   R2,2400                                                          
         EDIT  (R2),(4,PBORSTIM),FILL=0                                         
*                                                                               
PRBOR20  OC    ORBTIME+2(2),ORBTIME+2                                           
         BNZ   *+14                                                             
         MVC   PBORETIM,ZEROS                                                   
         B     PRBOR30                                                          
*                                                                               
         ZICM  R2,ORBTIME+2,2                                                   
         CHI   R2,600                                                           
         BNL   *+8                                                              
         AHI   R2,2400                                                          
         EDIT  (R2),(4,PBORETIM),FILL=0                                         
*                                                                               
PRBOR30  MVC   PBORPGNM(L'ORBDESC),ORBDESC                                      
*                                                                               
         GOTO1 BINSRCH,BINPARMS,(X'01',PBORTID)                                 
*                                                                               
         LA    R6,16(R6)           R6 = A(NEXT ORBIT)                           
         MVC   PBORTID(PBUYORBL),SPACES                                         
         BCT   R3,PRBOR10                                                       
*****************************************                                       
* NOW WE CAN START PRINTING BUYORB'S (WE HAVE TO GO BACKWARDS THOUGH)           
*****************************************                                       
         L     R6,AIO3             R6 = A(FIRST ENTRY IN TABLE)                 
         L     R3,BINPARMS+8                                                    
         LR    RF,R3                                                            
         BCTR  RF,0                                                             
         MHI   RF,PBUYORBL                                                      
         AR    R6,RF               R6 = A(LAST ENTRY IN TABLE)                  
         B     *+8                                                              
PRBOR40  BAS   RE,PRBLINE                                                       
         MVC   PBORTID(PBUYORBL),0(R6)                                          
         SHI   R6,PBUYORBL         R6 = A(NEXT ORBIT)                           
         BCT   R3,PRBOR40                                                       
*                                                                               
         MVI   PBORCONT,C' '                                                    
         BAS   RE,PRBLINE                                                       
*                                                                               
PRBORX   DS    0H                                                               
         DROP  R4,R6                                                            
*********                                                                       
* HANDLE THE BUY COMMENTS                                                       
*********                                                                       
PRBCM00  CLI   PDARBCOM,C'N'       DEFAULT IS 'Y'                               
         BE    PRBCMX                                                           
         L     R6,AIO                                                           
         MVI   ELCODE,X'66'                                                     
         BAS   RE,GETEL                                                         
         BNE   PRBCMX                                                           
*                                                                               
         L     R4,APRTLINE                                                      
         USING PBUYCOMD,R4                                                      
         USING COMELEM,R6                                                       
PRBCM10  CLC   0(L'SPACES,R4),SPACES                                            
         BE    *+8                                                              
         BAS   RE,PRBLINE                                                       
*                                                                               
         MVC   PBCMTID,=C'BUYCOM'                                               
         MVC   PBCMORDR,SVQCORDR                                                
         MVI   PBCMCONT,C'*'                                                    
         EDIT  (B1,CMNUM),(1,PBCMTEXT)                                          
         MVI   PBCMTEXT+1,C'-'                                                  
         ZIC   R2,CMLEN                                                         
         SH    R2,=Y(CMDATA-COMELEM)                                            
         CHI   R2,68               MAKE SURE WE DON'T GO BEYOND 70 CHAR         
         BNH   *+8                                                              
         LHI   R2,68                                                            
         BCTR  R2,0                                                             
         EX    R2,*+8                                                           
         B     *+10                                                             
         MVC   PBCMTEXT+2(0),CMDATA                                             
*                                                                               
         BAS   RE,NEXTEL                                                        
         BE    PRBCM10                                                          
*                                                                               
         MVI   PBCMCONT,C' '                                                    
         BAS   RE,PRBLINE                                                       
*                                                                               
PRBCMX   DS    0H                                                               
         DROP  R4,R6                                                            
*********                                                                       
* HANDLE THE BUY DETAILS                                                        
*********                                                                       
         BRAS  RE,PRBYDTL          PRINT THE BUY DETAILS                        
*********                                                                       
* GET NEXT BUY RECORD                                                           
*********                                                                       
PRBUY100 MVI   RDUPDATE,C'N'       ANY MORE BUYS FOR THIS ORDER?                
         GOTO1 SEQ                                                              
         LA    R6,KEY                                                           
         B     PRBUY10                                                          
*********                                                                       
* NO MORE BUY RECORDS                                                           
*********                                                                       
PRBUY110 L     R4,APRTLINE         PRINT THE TRAILER                            
         USING PAGYTLRD,R4                                                      
         MVC   PATLTID,=C'AGYTLR'                                               
         TM    MISCFLG2,MF2VAROR                                                
         BZ    *+10                                                             
         MVC   PATLTID(3),=C'VAR'                                               
*                                                                               
         MVC   PATLORDR,SVQCORDR                                                
         EDIT  (B4,AGYNSPTS),(6,PATLSPTS),FILL=0                                
         EDIT  (P6,AGYDOLRS),(10,PATLTOTL),FILL=0                               
         L     R2,AGYNMRCS         ADD ONE FOR ITSELF                           
         AHI   R2,1                                                             
         EDIT  (R2),(6,PATLNMRC),FILL=0                                         
         BAS   RE,PRBLINE                                                       
         DROP  R4                                                               
*                                                                               
         CLI   BLOCK,0             NO BUYLINES?                                 
         BE    PRBUYNO             NONE                                         
*                                                                               
PRBUYYES B     YES                                                              
*                                                                               
PRBUYNO  B     NO                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PRINT OUT THE BUY DETAILS                                                     
*                                                                               
* ON ENTRY:    (R6)                A(BUY RECORD)                                
***********************************************************************         
PRBYDTL  NTR1  BASE=*,LABEL=*                                                   
PRBDT00  GOTO1 ,BINPARMS,,AIO3,0,BSRCRLEN,BSRCKLEN,165                          
         L     RE,AIO3             CLEAR OUT BINSRCH TABLE                      
         LHI   RF,LIOS                                                          
         XCEFL                                                                  
*                                                                               
         L     R6,AIO                                                           
         AH    R6,DATADISP                                                      
*                                                                               
PRBDT10  CLI   0(R6),0             END OF RECORD?                               
         BE    PRBDT100            YES, PRINT OUT THE DETAILS NOW               
         CLI   0(R6),X'06'         ORIGINAL ELEMENT?                            
         BE    PRBDT20                                                          
         CLI   0(R6),X'07'         OTO ELEMENT?                                 
         BE    PRBDT20                                                          
         CLI   0(R6),X'0B'         POOL ORIGINAL?                               
         BE    PRBDT20                                                          
         CLI   0(R6),X'0C'         POOL OTO ELEMENT?                            
         BE    PRBDT20                                                          
PRBDT15  ZIC   R1,1(R6)            NEITHER, ADVANCE TO NEXT ELEMENT             
         AR    R6,R1                                                            
         B     PRBDT10                                                          
*                                                                               
         USING REGELEM,R6                                                       
PRBDT20  TM    RSTATUS,X'80'       MINUS SPOT?                                  
         BZ    PRBDT20A            NO                                           
         TM    MISCFLG1,MF1DRREV   DOING REVISIONS?                             
         BNZ   PRBDT20C            YES, CAPTURE ALL THE COSTS & WEEKS           
         CLI   0(R6),X'0B'                                                      
         BNL   PRBDT15                                                          
         B     PRBDT20C                                                         
*                                                                               
PRBDT20A TM    RSTATUS,X'42'       SPOT HAS BEEN MINUSED AND MKGD?              
         BZ    PRBDT20C            NO, NEITHER ONE                              
*****    BNO   PRBDT15                                                          
         TM    MISCFLG1,MF1DRREV   DOING REVISIONS?                             
         BZ    PRBDT15             NO                                           
*                                                                               
PRBDT20C TM    MISCFLG1,MF1FLTRC   USING FLIGHT RECORDS?                        
         BZ    PRBDT21                                                          
         GOTO1 DATCON,DMCB,(3,SVFLTSDT),(2,FULL)                                
         GOTO1 DATCON,DMCB,(3,SVFLTEDT),(2,FULL+2)                              
         CLC   RDATE,FULL                                                       
         BL    PRBDT15                                                          
         CLC   RDATE,FULL+2                                                     
         BH    PRBDT15                                                          
*                                                                               
PRBDT21  LA    R2,BINSREC                                                       
         USING BINSRECD,R2                                                      
         GOTO1 DATCON,DMCB,(2,RDATE),(0,BSRCDATE)                               
*                                                                               
         CLI   0(R6),X'06'         ORIGINAL ELEMENT?                            
         BE    *+12                                                             
         CLI   0(R6),X'07'         OTO ELEMENT?                                 
         BNE   PRBDT30                                                          
*                                                                               
         GOTOR GTMYRATE,DMCB,(SVBPRD,WORK)                                      
         MVC   BSRCCOST,WORK+4                                                  
*                                                                               
         CLI   SVBPR2,0                                                         
         BE    PRBDT25                                                          
         GOTOR GTMYRATE,DMCB,(SVBPR2,WORK)                                      
         L     R1,WORK+4                                                        
         ICM   R0,15,BSRCCOST                                                   
         AR    R1,R0                                                            
         STCM  R1,15,BSRCCOST                                                   
*                                                                               
PRBDT25  ICM   R1,15,BSRCCOST      BSRCCOST = COST FOR ALL THE SPOTS            
         CVD   R1,DUB                                                           
         AP    AGYDOLRS,DUB                                                     
PRBDT26  MVC   BSRCCOST,SVBDCOST   NOW ->  BSRCCOST = COST FOR 1 SPOT           
*                                                                               
         MVC   BSRCNSPT,RNUM                                                    
         MVC   BSRCTSPT,RNUM                                                    
         B     PRBDT40                                                          
*                                                                               
PRBDT30  TM    MISCFLG1,MF1DRREV   DOING DARE REVISIONS?                        
         BZ    PRBDT35             NO, DON'T WORRY ABOUT MAKEGOODS              
         TM    RSTATUS,X'02'       MAKEGOOD ON NEW LINE?                        
         BZ    PRBDT35                                                          
         CLI   RLEN,RPALLOC-REGELEM    ANYTHING ALLOCATED?                      
         BNH   PRBDT35                                                          
         MVC   BYTE,RPSTAT2                                                     
         NI    BYTE,X'FF'-X'80'    MAKEGOOD SEQUENCE NUMBER                     
*                                                                               
**** COPIED FROM SPBLDMGA ON 10/15/97                                           
         ZIC   R0,BYTE             CONVERT BINARY TO ALPHA MKGD CODE            
         BCTR  R0,0                                                             
         SRDA  R0,32                                                            
         D     R0,=F'10'                                                        
         IC    R1,ALPHATAB(R1)                                                  
         STC   R1,HALF                                                          
         STC   R0,HALF+1                                                        
         OI    HALF+1,X'F0'                                                     
**** COPIED FROM SPBLDMGA ON 10/15/97                                           
*                                                                               
         L     RF,AIO                                                           
         L     RE,AIO2             RE=A(BUYLINE/MAKEGOOD LIST)                  
         MVC   FULL(1),BUYKBUY-BUYRECD(RF)                                      
         MVC   FULL+1(L'HALF),HALF                                              
*                                                                               
PRBDT32  CLI   0(RE),0                                                          
         BE    PRBDT34                                                          
         CLC   0(3,RE),FULL        MATCH BOTH THE BUYLINE/MAKEGOOD?             
         BE    PRBDT34                                                          
         LA    RE,3(RE)            BUMP TO THE NEXT ENTRY                       
         L     R1,AIO2             MAKE SURE WE DON'T PASS TABLE                
         AHI   R1,LIOS                                                          
         CR    RE,R1                                                            
         BL    PRBDT32             CHECK THIS NEXT ENTRY                        
         DC    H'0'                                                             
*                                                                               
**** COPIED FROM SPBLDMGA ON 10/15/97                                           
*                                                                               
ALPHATAB DC    C'ABCDEFGHJKLMNP'                                                
OTHRTAB  DC    C'UVWXYZQRSTZZZZ'                                                
*                                                                               
**** COPIED FROM SPBLDMGA ON 10/15/97                                           
*                                                                               
PRBDT34  MVC   0(3,RE),FULL        SAVE THIS BUYLINE/MAKEGOOD                   
*****    B     PRBDT15             DON'T INCLUDE AS COUNT THOUGH                
*                                                                               
PRBDT35  BRAS  RE,CHKPOLEL         POOL ORIGINAL ELEMENT MATCHES ORDER?         
         BNE   PRBDT15             NO, SKIP TO NEXT ELEMENT                     
*                                                                               
         GOTOR GTMYRATE,DMCB,(SVBPRD,WORK)                                      
         MVC   BSRCCOST,WORK+4                                                  
*                                                                               
         CLI   SVBPR2,0                                                         
         BE    PRBDT36                                                          
         GOTOR GTMYRATE,DMCB,(SVBPR2,WORK)                                      
         L     R1,WORK+4                                                        
         ICM   R0,15,BSRCCOST                                                   
         AR    R1,R0                                                            
         STCM  R1,15,BSRCCOST                                                   
*                                                                               
PRBDT36  ICM   R1,15,BSRCCOST      BSRCCOST = COST FOR ALL THE SPOTS            
         CVD   R1,DUB                                                           
         AP    AGYDOLRS,DUB                                                     
*****                                                                           
         TM    RSTATUS,X'80'       MINUS SPOT?                                  
         BZ    PRBDT37             NO                                           
         ICM   R1,15,BSRCCOST      NEGATE THE NEGATIVE COST RETURNED BY         
         LPR   R1,R1                   GETRATE                                  
         STCM  R1,15,BSRCCOST                                                   
*****                                                                           
PRBDT37  MVI   BSRCNSPT,1          MULTI-SPOT ARE SPLIT TO MULTI-ELEMS          
         MVI   BSRCTSPT,1            7 SPOTS/WEEK = 7 X'0B' ELEMS/WEEK          
         L     R1,AIO                                                           
         USING BUYRECD,R1                                                       
         TM    BDSTAT,BDSPRECQ     X'80' - POL NPW DATA IN REC                  
         BZ    PRBDT40                                                          
         DROP  R1                                                               
         XR    R1,R1                                                            
         IC    R1,RPCOST           1ST 6 BITS OF RPCOST HAS NPW                 
         SRL   R1,2                                                             
         STC   R1,BSRCNSPT                                                      
         STC   R1,BSRCTSPT                                                      
         ICM   RF,15,BSRCCOST      DIVIDE AS GETRATE GOT $$/WK                  
         XR    RE,RE                  WHEN WE WANT PER SPOT                     
         DR    RE,R1                                                            
         STCM  RF,15,BSRCCOST                                                   
*                                                                               
PRBDT40  GOTO1 BINSRCH,BINPARMS,(X'01',BINSREC)                                 
         OC    BINPARMS,BINPARMS   TABLE FULL?                                  
         BNZ   *+6                                                              
         DC    H'0'                YES, DIE                                     
*                                                                               
PRBDT49  CLI   BINPARMS,X'01'      RECORD NOT FOUND?                            
         BE    PRBDT15             NOT FOUND, WEEK IS IN TABLE NOW              
*                                                                               
PRBDT50  L     R1,BINPARMS         FOUND, UPDATE NUMBER OF SPOTS                
         ZIC   RE,BSRCTSPT                                                      
*                                                                               
         TM    RSTATUS,X'80'       MINUS SPOT                                   
         BZ    *+6                                                              
         LNR   RE,RE                                                            
*                                                                               
         ZIC   RF,BSRCTSPT-BINSRECD(R1)   UPDATE NUMBER OF SPOTS                
         AR    RE,RF                                                            
         STC   RE,BSRCTSPT-BINSRECD(R1)                                         
*                                                                               
         CHI   RE,0                IF NO SPOTS, THEN DELETE                     
         BNE   PRBDT15                                                          
         TM    MISCFLG1,MF1DRREV   DOING DARE REVISIONS?                        
         BNZ   PRBDT15             YES, DON'T DELETE THIS ENTRY                 
*                                                                               
         LR    R2,R1                                                            
         GOTO1 BINSRCH,BINPARMS,(X'80',(R2))                                    
         L     RE,AIO3                                                          
         OC    BINPARMS+8(4),BINPARMS+8   ANY RECORDS?                          
         BZ    PRBDT60                                                          
         L     R1,BINPARMS+8                                                    
         MHI   R1,BSRCRLEN                                                      
         AR    RE,R1                                                            
PRBDT60  XC    0(BSRCRLEN,RE),0(RE)   CLEAR THE RECORD HERE                     
         LA    R2,BINSREC                                                       
         B     PRBDT15                                                          
         DROP  R2,R6                                                            
*                                                                               
PRBDT100 L     R6,AIO3                                                          
         USING BINSRECD,R6                                                      
         L     R4,APRTLINE                                                      
         USING PBUYDTLD,R4                                                      
*                                                                               
PRBDT110 MVC   PBDTTID,=C'BUYDTL'                                               
         MVC   PBDTORDR,SVQCORDR                                                
         MVI   PBDTCONT,C'*'                                                    
*                                                                               
         L     R1,AIO                                                           
         CLI   BUYKPRD-BUYRECD(R1),X'FF'          POL-BUY?                      
         BE    PRBDT113                                                         
PRBDT111 EDIT  (B4,SVBDCOST),(9,PBDTCOST),FILL=0  NO, FROM HEADER               
         B     PRBDT116                                                         
PRBDT113 OC    BINPARMS+8(4),BINPARMS+8       NO ENTRIES?                       
         BZ    PRBDT111                       NONE, USE BUY COST                
         EDIT  (B4,BSRCCOST),(9,PBDTCOST),FILL=0                                
*                                                                               
PRBDT116 MVC   PBDTSTDT,BSRCDATE                                                
         CLI   PBDTSTDT,X'F9'                                                   
         BNH   PRBDT117                                                         
         ZIC   R1,PBDTSTDT                                                      
         SHI   R1,10                                                            
         STC   R1,PBDTSTDT                                                      
PRBDT117 EDIT  (B1,BSRCTSPT),(2,PBDTSPTS),FILL=0                                
*                                                                               
         L     R1,AGYNSPTS                                                      
         ZIC   R0,BSRCTSPT                                                      
         AR    R1,R0                                                            
         ST    R1,AGYNSPTS                                                      
*                                                                               
         MVI   BYTE,1              BYTE = NUMBER OF WEEKS                       
         MVC   CURRDATE,BSRCDATE                                                
********                                                                        
         CLC   CURRDATE,SPACES     WE HAVE A SPOT?                              
         BH    PRBDT119            YES                                          
*                                                                               
         L     RF,AIO                                                           
**   USE THE BUY START DATE                                                     
         GOTO1 DATCON,DMCB,(3,BDSTART-BUYRECD(RF)),(0,CURRDATE)                 
         MVC   PBDTSTDT,CURRDATE                                                
         CLI   PBDTSTDT,X'F9'                                                   
         BNH   PRBDT119                                                         
         ZIC   R1,PBDTSTDT                                                      
         SHI   R1,10                                                            
         STC   R1,PBDTSTDT                                                      
********                                                                        
PRBDT119 LA    R3,BSRCRLEN(R6)     R3 = A(NEXT BINSRCH RECORD)                  
PRBDTDS1 USING BINSRECD,R3                                                      
*                                                                               
PRBDT120 OC    0(BSRCRLEN,R3),0(R3)   ANY RECORD HERE?                          
         BZ    PRBDT150               NO MORE RECORDS                           
*                                                                               
         CLC   BSRCCOST,PRBDTDS1.BSRCCOST    IS THE COST THE SAME?              
         BNE   PRBDT150                                                         
         CLC   BSRCTSPT,PRBDTDS1.BSRCTSPT    IS # OF SPOTS THE SAME?            
         BNE   PRBDT150                                                         
*                                                                               
         TM    ESTFLAG1,ESTDAILY           DAILY ESTIMATE?                      
         BNZ   PRBDT150                                                         
         L     RF,AIO                                                           
         TM    BDSTAT2-BUYRECD(RF),X'80'   OR BUYLINE IS DAILY?                 
         BNZ   PRBDT150                      YES, PRINT OUT THE DETAIL          
*                                                                               
         GOTO1 ADDAY,DMCB,CURRDATE,CURRDATE,F'7'  THE NEXT WEEK?                
         CLC   CURRDATE,PRBDTDS1.BSRCDATE                                       
         BNE   PRBDT150                      NO, PRINT OUT THE DETAIL           
*                                                                               
         ZIC   R1,BYTE             INCREMENT NUMBER OF WEEKS FOR A              
         AHI   R1,1                    SPECIFIC DOLLAR AND # OF SPOTS           
         STC   R1,BYTE                                                          
*                                                                               
         L     R1,AGYNSPTS         INCREMENT NUMBER OF SPOTS                    
         ZIC   R0,PRBDTDS1.BSRCTSPT                                             
         AR    R1,R0                                                            
         ST    R1,AGYNSPTS                                                      
*                                                                               
         LA    R3,BSRCRLEN(R3)     R3 = A(NEXT BINSRCH RECORD)                  
         B     PRBDT120                                                         
*                                                                               
PRBDT150 EDIT  (B1,BYTE),(2,PBDTNOWK),FILL=0                                    
         LR    R6,R3               R6 = A(NEXT SET OF ELEMENTS)                 
*                                                                               
         OC    BSRCCOST(BSRCRLEN),BSRCCOST   ANY MORE BUY DETAILS?              
         BZ    *+12                          NO MORE                            
         BRAS  RE,PRBLINE                                                       
         B     PRBDT110            NEXT BUY DETAIL                              
*                                                                               
         MVI   PBDTCONT,C' '       NO MORE FOLLOW                               
         BRAS  RE,PRBLINE                                                       
*                                                                               
PRBDTX   J     XIT                                                              
         DROP  R4,R6                                                            
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* GET MY GROSS COST AND TAX                                                     
*   RETRUN COST2 IF THIS IS A TRADE CLIENT BUT                                  
*   RETURN ZERO COST IF ZERO COST TRADE PROFILE IS SET                          
*                                                                               
*   ON ENTRY :  PARAM1 BYTE 0   PRODUCT CODE                                    
*                                                                               
*   ON EXIT  :  WORK+4(4)       GROSS DOLLARS                                   
*               WORK+12(4)      TAX DOLLARS                                     
*   HALF GET CLOBBERED                                                          
***********************************************************************         
GTMYRATE NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVC   HALF(1),0(R1)       SAVE PRODUCT CODE                            
         L     R4,0(R1)                                                         
         XC    0(16,R4),0(R4)                                                   
*                                                                               
         TM    MISCFLG1,MF1DRTRD   DOING TRADE NOW?                             
         BZ    GMR10                                                            
         CLI   PDAR0TRD,C'Y'       TRADE ORDER $0 COST?                         
         BE    GMRX                                                             
*                                                                               
         TM    CLTFLAG1,CLTTRADE                                                
         BZ    GMR10                                                            
         MVC   0(4,R4),=C'COS2'    NOW GET COST2                                
*                                                                               
GMR10    GOTO1 GETRATE,DMCB,(HALF,(R4)),(0,AIO),(0,(R6)),(SVAPROF+7,0)          
*                                                                               
GMRX     J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF THE BUY IS A TRADE BUY                                               
*                                                                               
* ON ENTRY:    (R6)                A(BUY RECORD)                                
*                                                                               
* ON EXIT:     (CC)                CONDITION CODE                               
***********************************************************************         
CHKIFTRD NTR1  BASE=*,LABEL=*                                                   
         USING BUYKEY,R6                                                        
***************                                                                 
* TRADE USING  SPECIAL REP                                                      
***************                                                                 
ITRDSR00 OC    PDARTSRP(3),PDARTSRP ANY DARE SPECIAL REP IN PROFILE?            
         BZ    IFTRDNO              NO, NOT A TRADE BUY                         
         CLC   PDARTSRP(3),ZEROS                                                
         BE    IFTRDNO              NO, NOT A TRADE BUY                         
*                                                                               
         GOTO1 RCPACK,DMCB,(C'U',BDREP),DUB                                     
*                                                                               
         CLI   PDARMTRD,C'Y'       USING MULTIPLE TRADE CODES?                  
         BE    *+14                                                             
         CLC   PDARTSRP(3),DUB     IF IT MATCHES THEN TRADE                     
         B     IFTRDX                                                           
         CLC   PDARTSRP(2),DUB                                                  
*                                                                               
IFTRDX   B     XIT                                                              
IFTRDYES B     YES                                                              
IFTRDNO  B     NO                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PRINT HIATUS WEEK DEFINITIONS                                                 
***********************************************************************         
PRTHIATS NTR1  BASE=*,LABEL=*                                                   
         B     PRHIA00                                                          
*                                                                               
PRHIALNE LR    R0,RE                                                            
         L     R1,AGYNMRCS         INCREMENT NUMBER OF RECORDS PRINTED          
         AHI   R1,1                                                             
         ST    R1,AGYNMRCS                                                      
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
*                                                                               
PRHIA00  XC    BLOCK(53),BLOCK     53 WEEKS/DAYS                                
*                                                                               
         LA    R6,KEY              LOOK UP THE GOALS                            
         USING GKEY,R6                                                          
         XC    KEY,KEY                                                          
         MVI   GKEYTYPE,X'02'                                                   
         MVC   GKEYAM,BAGYMD                                                    
         MVC   GKEYCLT,BCLT                                                     
*                                                                               
         MVC   GOALPRD,SVBPRD                                                   
         MVC   GOALPR2,SVBPR2                                                   
*                                                                               
         MVC   GKEYPRD,SVBPRD                                                   
         CLI   SVBPR2,0            ANY PIGGYBACK?                               
         BE    PRHIA04             NO                                           
         CLC   SVQPR2,SVQPRD       PB IS ALPHABETICALLY < PRODUCT?              
         BNL   PRHIA04                                                          
         MVC   GKEYPRD,SVBPR2      GOALS ARE ALPHABETICALLY BY PRODUCT          
         MVC   GOALPRD,SVBPR2      WE SWAPPED THEM                              
         MVC   GOALPR2,SVBPRD                                                   
*                                                                               
PRHIA04  MVC   GKEYMKT,BMKT                                                     
         MVC   GKEYEST,SVBEST      WE HAVE ONLY UP TO ESTIMATE                  
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
PRHIA10  CLC   GKEYAM,BAGYMD       SAME BASE KEY?                               
         BNE   PRHIA100                                                         
         CLC   GKEYCLT,BCLT                                                     
         BNE   PRHIA100                                                         
         CLC   GKEYPRD,GOALPRD                                                  
         BNE   PRHIA100                                                         
         CLC   GKEYMKT,BMKT                                                     
         BNE   PRHIA100                                                         
         CLC   GKEYEST,SVBEST                                                   
         BNE   PRHIA100            NO, DONE                                     
*                                                                               
         CLC   GKEYPRD2,GOALPR2    PIGGYBACKS MATCH?                            
         BNE   PRHIANXT                                                         
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
*                                                                               
         MVI   ELCODE,X'21'        LOOK FOR GOAL WEEK ELEMENTS                  
         BAS   RE,GETEL                                                         
         BNE   PRHIANXT                                                         
*                                                                               
         USING GLEMENT,R6                                                       
         MVC   BLOCK+100(L'ESTSTRT),ESTSTRT                                     
         GOTO1 GETDAY,DMCB,(0,ESTSTRT),BLOCK+110                                
*                                                                               
         TM    ESTFLAG1,ESTDAILY   DAILY                                        
         BNZ   PRHIA15                                                          
         CLC   SVOOWROT,DMCB       START DAY IS SAME AS ROTATOR?                
         BE    PRHIA15             YES                                          
*                                                                               
         ZIC   R1,DMCB             THIS WOULD BE NOT OUT OF WEEK                
         ZIC   R0,SVOOWROT            BUT EST START DAY DOESN'T START           
         SR    R0,R1                  ON MONDAY (ALIGN IT TO PREV MON)          
         GOTO1 ADDAY,DMCB,BLOCK+100,BLOCK+100,(R0)  FIND OUT THE MONDAY         
*                                                                               
PRHIA15  XC    FAKEFLD,FAKEFLD                                                  
         GOTO1 DATCON,DMCB,(0,BLOCK+100),(8,FAKEFLD)                            
         MVI   FAKEFLD+8,C'-'                                                   
PRHIA20  GOTO1 DATCON,DMCB,(2,GLWEEK),(8,FAKEFLD+9)                             
         GOTO1 PERVAL,DMCB,(17,FAKEFLD),PERVALST                                
*                                                                               
PRHIAPVD USING PERVALD,PERVALST                                                 
         ZICM  R1,PRHIAPVD.PVALNDYS,2                                           
         TM    ESTFLAG1,ESTDAILY                                                
         BNZ   PRHIA30                                                          
         ZICM  R1,PRHIAPVD.PVALNWKS,2                                           
         DROP  PRHIAPVD                                                         
*                                                                               
PRHIA30  BCTR  R1,0                DISP(FROM EST START DATE)                    
         LA    R2,BLOCK(R1)                                                     
         OI    0(R2),X'80'         WE HAVE GOALS FOR THIS WEEK/DAY              
*                                                                               
         BAS   RE,NEXTEL           GO THROUGH ALL GOAL WEEK ELEMENTS            
         BE    PRHIA20                                                          
*                                                                               
PRHIANXT MVI   RDUPDATE,C'N'       READ NEXT GOAL RECORD                        
         LA    R6,KEY                                                           
         GOTO1 SEQ                                                              
         B     PRHIA10                                                          
         DROP  R6                                                               
*                                                                               
PRHIA100 L     R4,APRTLINE                                                      
         USING PAGYHIAD,R4                                                      
*                                                                               
         MVC   DUB(L'ESTSTRT),BLOCK+100   DUB IS THE START DATE                 
         LA    R2,BLOCK                   R2 = A(FIRST WEEK/DAY)                
*                                                                               
         OC    BLOCK(53),BLOCK     ANY GOALS AT ALL?                            
         BZ    PRHIAX              NONE, DON'T SEND ANY AGYHIA RECORDS          
*                                                                               
         TM    MISCFLG1,MF1FLTRC   USING FLIGHT RECORDS?                        
         BZ    PRHIA110                                                         
         GOTO1 DATCON,DMCB,(3,SVFLTSDT),(0,BLOCK+120)                           
         GOTO1 DATCON,DMCB,(3,SVFLTEDT),(0,BLOCK+126)                           
*                                                                               
PRHIA110 MVC   PAHITID,=C'AGYHIA'                                               
         MVC   PAHIORDR,SVQCORDR                                                
         MVI   PAHICONT,C'*'                                                    
         LA    R3,PAHIWKDT         R2 = A(FIRST WEEK/DAY IN AGYHIA)             
*                                                                               
PRHIA120 TM    0(R2),X'80'         DO WE HAVE A GOAL FOR THIS WEEK/DAY          
         BZ    PRHIA130                                                         
*                                                                               
PRHIA125 LA    R2,1(R2)            YES, R2 = A(NEXT GOAL WEEK/DAY)              
         LR    R1,R2                                                            
         LA    R0,BLOCK                                                         
         SR    R1,R0                                                            
         CHI   R1,53               LOOK AT ALL THE 53 WEEKS/DAYS?               
         BL    PRHIA128                                                         
         MVI   PAHICONT,C' '       YES                                          
         LA    R1,PAHIWKDT                                                      
         CR    R3,R1                                                            
         BNE   PRHIA140                                                         
         B     PRHIAX                                                           
*                                                                               
PRHIA128 MVC   DMCB+8(4),=F'7'        ASSUME WEEK FIRST                         
         TM    ESTFLAG1,ESTDAILY   IF DAILY                                     
         BZ    *+8                                                              
         MVI   DMCB+11,X'01'       THEN BUMP BY 1 ONLY                          
         GOTO1 ADDAY,DMCB,DUB,DUB,,0                                            
         CLC   DUB(L'ESTEND),ESTEND   PAST THE ESTIMATE END?                    
         BNH   PRHIA120               NO, KEEP CHECKING                         
         MVI   PAHICONT,C' '          YES                                       
         LA    R1,PAHIWKDT                                                      
         CR    R3,R1                                                            
         BNE   PRHIA140                                                         
         B     PRHIAX                                                           
*                                                                               
PRHIA130 LR    R1,R3                                                            
         LA    R0,PAHIWKDT                                                      
         SR    R1,R0                                                            
         CHI   R1,60               HIT MAX OF 10 WEEKS/DAYS PER AGYHIA?         
         BL    *+12                NO                                           
         BAS   RE,PRHIALNE         YES, PRINT THIS LINE                         
         B     PRHIA110            SET UP THE AGYHIA RECORD AGAIN               
*                                                                               
         CLC   DUB,ESTSTRT              IF WE ADJUSTED THE DATE                 
         BNL   PRHIA132                                                         
         MVC   0(L'ESTSTRT,R3),ESTSTRT  THEN FIRST DATE IS EST START            
         B     PRHIA136                                                         
*                                                                               
PRHIA132 TM    MISCFLG1,MF1FLTRC   USING FLIGHT RECORDS                         
         BZ    PRHIA133                                                         
         CLC   DUB,BLOCK+120       WE STORED THE FLIGHT START AND END           
         BL    PRHIA125               HERE IN THE YYMMDD FORM                   
         CLC   DUB,BLOCK+126                                                    
         BH    PRHIA125                                                         
*                                                                               
PRHIA133 MVC   0(L'ESTSTRT,R3),DUB                                              
PRHIA136 CLI   0(R3),C'9'                                                       
         BNH   PRHIA139                                                         
         ZIC   R1,0(R3)                                                         
         SHI   R1,10                                                            
         STC   R1,0(R3)                                                         
PRHIA139 LA    R3,L'ESTSTRT(R3)                                                 
         B     PRHIA125                                                         
*                                                                               
PRHIA140 BAS   RE,PRHIALNE                                                      
*                                                                               
PRHIAX   B     XIT                                                              
         DROP  R4                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* PRINT VAR PRODUCTS                                                            
***********************************************************************         
PRVPRDS  NTR1  BASE=*,LABEL=*                                                   
         B     PRVPR00                                                          
***************                                                                 
* PRINTS THE CURRENT LINE                                                       
***************                                                                 
PRVPRLNE LR    R0,RE                                                            
         L     R1,AGYNMRCS         INCREMENT NUMBER OF RECORDS PRINTED          
         AHI   R1,1                                                             
         ST    R1,AGYNMRCS                                                      
         MVI   LINE,1                                                           
         GOTO1 SPOOL,DMCB,(R8)                                                  
         LR    RE,R0                                                            
         BR    RE                                                               
***************                                                                 
* FINDS THE A(PRODUCT ENTRY) IN SVCLIST ASSOCIATED WITH CODE IN BYTE            
***************                                                                 
PRVFPRD  LA    R1,SVCLIST                                                       
PRVFPRD5 CLI   0(R1),0                                                          
         BNE   *+6                                                              
         DC    H'0'                CAN'T FIND PRODUCT!!!!                       
*                                                                               
         CLC   BYTE,3(R1)          MATCH ON PRODUCT CODE?                       
         BER   RE                  YES                                          
         LA    R1,4(R1)            NO, SKIP TO NEXT ENTRY IN LIST               
         B     PRVFPRD5                                                         
*                                                                               
PRVPR00  LA    R2,PRDSLIST         R2 = A(1ST ENTRY IN VAR PRD LIST)            
         L     R4,APRTLINE                                                      
         USING PAGYPROD,R4                                                      
         B     PRVPR30             1ST TIME                                     
*                                                                               
PRVPR10  LA    R0,PRDSLIST+L'PRDSLIST                                           
         CR    R2,R0               HIT END OF LIST?                             
         BNL   *+14                YES                                          
         OC    0(2,R2),0(R2)       ANY MORE ENTRIES?                            
         BNZ   PRVPR20                                                          
         MVI   PAPDCONT,C' '       NO MORE TO FOLLOW                            
         BAS   RE,PRVPRLNE                                                      
         B     PRVPRX                                                           
*                                                                               
PRVPR20  BAS   RE,PRVPRLNE                                                      
PRVPR30  MVC   PAPDTID,=C'VARPRD'                                               
         MVC   PAPDORDR,SVQCORDR                                                
         MVI   PAPDCONT,C'*'                                                    
*                                                                               
         MVC   BYTE,0(R2)          GET THE PRIMARY PRODUCT                      
         BAS   RE,PRVFPRD                                                       
         MVC   QPRD,0(R1)                                                       
         MVC   PAPDCOD1(3),0(R1)                                                
         BAS   RE,GETPRREC                                                      
*                                                                               
         L     R6,AIO                                                           
         USING PKEY,R6                                                          
         MVC   PAPDNAM1(L'PNAME),PNAME                                          
*                                                                               
         CLI   1(R2),0             ANY PIGGYBACK PRODUCT?                       
         BE    PRVPR40             NONE                                         
         MVC   BYTE,1(R2)          GET THE PRIMARY PRODUCT                      
         BAS   RE,PRVFPRD                                                       
         MVC   QPRD,0(R1)                                                       
         MVC   PAPDCOD2(3),0(R1)                                                
         BAS   RE,GETPRREC                                                      
*                                                                               
         L     R6,AIO                                                           
         USING PKEY,R6                                                          
         MVC   PAPDNAM2(L'PNAME),PNAME                                          
*                                                                               
PRVPR40  LA    R2,2(R2)            LOOP UNTIL ALL PRODUCT ARE DONE              
         B     PRVPR10                                                          
*                                                                               
PRVPRX   B     XIT                                                              
         DROP  R4,R6                                                            
***********************************************************************         
* READS THE PRODUCT RECORD                                                      
***********************************************************************         
GETPRREC NTR1                                                                   
         LA    R6,KEY              LOOK UP THE PRODUCT NAMES                    
         USING PKEY,R6                                                          
         XC    KEY,KEY                                                          
         MVC   PKEYAM,BAGYMD                                                    
         MVC   PKEYCLT,BCLT                                                     
         MVC   PKEYPRD,QPRD                                                     
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
*                                                                               
         CLC   KEY(L'PKEY),KEYSAVE    FOUND THE PRODUCT RECORD?                 
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         B     XIT                                                              
         DROP  R6                                                               
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECKS TO SEE IF THE ORDER HAS ANY ERRORS                                     
***********************************************************************         
CHKORERR NTR1  BASE=*                                                           
         B     *+12                                                             
         DC    CL8'**CKER**'                                                    
*                                                                               
         L     RA,ATWA                                                          
         L     R9,ASYSD                                                         
         L     R8,ASPOOLD                                                       
         LA    R5,SYSSPARE                                                      
*                                                                               
         L     R6,AIO              POINT TO THE RECORD                          
         USING DOKEY,R6                                                         
         CLI   DOKCMT,0            STILL LOOKING AT DARE ORDER RECORD?          
         BE    CKOER10             YES, NO NEED TO FETCH IT                     
*                                                                               
         XC    KEY,KEY             NO, GET THE DARE ORDER RECORD                
         MVC   KEY(L'DOKEY),0(R6)                                               
         LA    R6,KEY                                                           
         MVI   DOKCMT,0                                                         
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 READ                                                             
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         DROP  R6                                                               
*                                                                               
CKOER10  MVI   ELCODE,DOCOMELQ     GET DARE COMMENT ELEMENT                     
         BAS   RE,GETEL                                                         
         BNE   CKOERNO                                                          
*                                                                               
         USING DOCOMELD,R6                                                      
         ZIC   R1,DOCOMLEN                                                      
         SHI   R1,DOCOMOVH-1                                                    
         CHI   R1,4                MORE THAN 3 BYTES?                           
         BNH   CKOER15             NO, OLD SPDARERROR                           
         XC    CONHEAD,CONHEAD                                                  
         SHI   R1,3                YES, NEW STYLE AND NO 3 BYTE ERR #           
         CHI   R1,L'CONHEAD-1      MAKE SURE WE DON'T KILL THIS FIELD           
         BNH   *+8                                                              
         LHI   R1,L'CONHEAD-1                                                   
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   BLOCK+1(0),DOCOMTXT+3                                            
         AHI   R1,1                                                             
         STC   R1,BLOCK                                                         
         B     CKOERYES                                                         
*                                                                               
CKOER15  STC   R1,BLOCK                L(MESSAGE WITH TERMINATING 0)            
         LA    RE,BLOCK(R1)                                                     
         MVI   0(RE),0                 TERMINATING 0                            
         SHI   R1,2                                                             
         EX    R1,*+8                                                           
         B     *+10                WE CAN SHOW OUR MESSAGE NOW                  
         MVC   BLOCK+1(0),DOCOMTXT     MESSAGE                                  
*                                                                               
         LA    RE,ERRORLST         FIND OUR ERROR                               
         USING ERRDSECT,RE                                                      
         SR    R0,R0                                                            
CKOER20  CLI   ERRLNGTH,0          END OF ERROR LIST?                           
         BE    CKOERYES            ERROR NUMBER NOT IN LIST                     
*                                                                               
         CLC   ERRNUMBR,BLOCK+1    MATCH ON THIS ERROR NUMBER?                  
         BE    CKOER30                                                          
         IC    R0,0(RE)            NO, CHECK NEXT ENTRY                         
         AR    RE,R0                                                            
         B     CKOER20                                                          
*                                                                               
CKOER30  ZIC   R1,ERRLNGTH                                                      
         SH    R1,=Y(ERRTEXT-ERRDSECT-1)                                        
         STC   R1,BLOCK                L(MESSAGE WITH TERMINATING 0)            
         LA    RF,BLOCK(R1)                                                     
         MVI   0(RF),0                 TERMINATING 0                            
         SHI   R1,2                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   BLOCK+1(0),ERRTEXT                                               
*                                                                               
CKOERYES MVC   CONHED2(28),=CL28'** Order came back with the '                  
         MVC   CONHED2+28(14),=CL14'above error **'                             
         B     YES                                                              
*                                                                               
CKOERNO  B     NO                                                               
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
       ++INCLUDE SPOMSERROR                                                     
         EJECT                                                                  
       ++INCLUDE DDMOREPTAB                                                     
         EJECT                                                                  
***********************************************************************         
* CHECKS TO SEE IF THE SALESPERSON FOR THE REP IS STILL VALID                   
*                                                                               
* ON EXIT:     SALESCOD            SALESPERSON CODE USED BY REPPAK              
*              REPALPHA            ALPHA CODE OF REP'S MASTER REP               
***********************************************************************         
CHKRPSAL NTR1  BASE=*,LABEL=*                                                   
         L     R3,DMCB                                                          
         CLI   5(R3),20            SALESPERSON LONGER THAN 20 BYTES?            
*        CLI   ORSSALEH+5,20                                                    
         BH    CKRSPNO             CAN'T BE VALID                               
*                                                                               
         CLC   =C'FAX:',ORSROUT    SO WE DONT DIE AND IN CASE OUTPUT            
         BE    CKRSPNO               TRANSLATOR REMOVES SPACE FROM              
         CLC   =C'EML:',ORSROUT      "FAX: " AND "EML: "                        
         BE    CKRSPNO                                                          
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CTIKEY,R4                                                        
         MVI   CTIKTYP,CTIKTYPQ    C'I' - ID RECORD TO GET POWER CODE           
         MVC   CTIKID,ORSROUT                                                   
         OC    CTIKID,SPACES                                                    
         DROP  R4                                                               
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMRDHI'),=C'CTFILE',(R4),AIO2                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R6,AIO2                                                          
         USING CTIREC,R6                                                        
*                                                                               
         CLC   KEY(L'CTIKEY),0(R6) DID I GET MY RECORD?                         
         BNE   UNKNDEST            NO, UNKNOWN DESTINATION ID!!!                
*                                                                               
         LA    R6,CTIDATA                                                       
         MVI   ELCODE,X'06'        LOOK FOR THE AGENCY ALPHA                    
         BRAS  RE,NEXTEL                                                        
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING CTAGYD,R6                                                        
         MVC   REPALPH1,CTAGYID    SAVE THE REP AGENCY ALPHA CODE               
         MVC   REPALPHA,CTAGYID    SAVE THE REP AGENCY ALPHA CODE               
         DROP  R6                                                               
***********************************************************************         
* WITH THE REP ALPHA CODE, WE CAN SEE IF IT IS A SUBSIDIARY OF A MASTER         
***********************************************************************         
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING GSPLKEY,R6                                                       
         MVI   GSPLKTYP,GSPLRECQ   X'71'                                        
         MVC   GSPLKREP,REPALPHA                                                
*                                                                               
         GOTO1 DATAMGR,DMCB,(0,=C'DMRDHI'),=C'GENDIR',(R6),AIO2                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R6,AIO2                                                          
         CLC   0(GSPLMREP-GSPLKEY,R6),KEY   REP HAS A MASTER REP?               
         BNE   *+10                         NO                                  
         MVC   REPALPHA,GSPLMREP   USE MASTER REP'S POWER CODE INSTEAD          
***********************************************************************         
* FIND THE SALESPERSON CODE                                                     
***********************************************************************         
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING GSPLKEY,R6                                                       
         MVI   GSPLPTYP,GSPLPTYQ   X'F1' - PASSIVE FOR SALESPERSON              
         MVI   GSPLPSTP,X'01'                                                   
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         BNE   *+8                                                              
         MVI   GSPLPSTP,X'02'                                                   
         MVC   GSPLKREP,REPALPHA                                                
         MVC   GSPLPNAM,8(R3)                                                   
         OC    GSPLPNAM,SPACES                                                  
*&&DO                                                                           
         MVC   GSP2POFF,DARROUTE+3                                              
*                                                                               
         TM    MISCFLG3,MF3NOOFF                                                
         BNZ   CKRSP10                                                          
         BRAS  RE,GTREPOFF                                                      
         MVC   GSP2POFF,SVREPOFF                                                
*&&                                                                             
CKRSP10  GOTO1 DATAMGR,DMCB,(0,=C'DMRDHI'),=C'GENDIR',(R6),AIO2                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     R6,AIO2                                                          
         CLC   0(GSPLPCOD-GSPLKEY,R6),KEY   REP HAS A MASTER REP?               
         BNE   CKRSPNO                      NO                                  
         MVC   SALESCOD,GSPLPCOD            SAVE THE SALESPERSON CODE           
*                                                                               
         LA    R2,36(R6)                                                        
*                                                                               
         GOTO1 (RF),DMCB,=C'GETREC',=C'GENFIL',(R2),AIO2,DMWORK                 
         CLI   8(R1),0                                                          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVI   ELCODE,X'01'                                                     
         MVC   DATADISP,=H'42'                                                  
         BAS   RE,GETEL                                                         
         MVC   DATADISP,=H'24'                                                  
         USING GSPLSPCD,R6                                                      
*                                                                               
         CLI   1(R6),GSPLSALL                                                   
         BL    CKRSPYES                                                         
         CLC   GSPLSPPC,SPACES                                                  
         BNH   CKRSPYES                                                         
         TM    GSPLSPFL,X'10'      POWER CODE MINUS?                            
         BZ    CKRSP40                                                          
* YES, TO MINUS, SHOW SALESPEOPLE NOT OF THIS REP                               
         CLC   GSPLSPPC,REPALPH1                                                
         BE    CKRSPNO                                                          
         B     CKRSPYES                                                         
* NO, TO MINUS, SHOW SALESPEOPLE OF THIS REP ONLY                               
CKRSP40  CLC   GSPLSPPC,REPALPH1                                                
         BNE   CKRSPNO                                                          
*                                                                               
         DROP  R6                                                               
*                                                                               
CKRSPYES J     YES                                                              
CKRSPNO  J     NO                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* ADD/CHANGE THE SALESPERSON RECORD                                             
***********************************************************************         
UPSALREC NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         TM    MISCFLG3,MF3RADIO   IF NOT RADIO, DON'T UPDATE                   
         BZ    USRX                                                             
*                                                                               
         L     R6,AIO                                                           
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),0(R6)                                               
         MVI   KEY+12,X'04'        SALESPERSON RECORD                           
*                                                                               
         MVI   ELCODE,DOSTELQ                                                   
         BAS   RE,GETEL                                                         
         MVC   DOSAELEM(DOSTLNQ),0(R6)                                          
*                                                                               
         MVC   AIO,AIO2                                                         
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   USR20                                                            
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
         L     R6,AIO                                                           
         B     USR40                                                            
*                                                                               
USR20    OI    MISCFLG3,MF3SALNF                                                
         L     RE,AIO                                                           
         LA    RF,2000                                                          
         XCEFL                                                                  
                                                                                
         L     R6,AIO              NOTE: SALESPERSON REASSIGNMENT REC           
         USING DOKEY,R6                                                         
         MVC   DOKEY,KEYSAVE                                                    
         MVC   DORLEN,=Y(DORFRST-DOKEY)                                         
         MVC   DORAGY,AGENCY                                                    
         DROP  R6                                                               
*                                                                               
USR40    LA    R6,DORFRST-DOKEY(R6)                                             
         CLI   0(R6),0                                                          
         BE    USR70                                                            
*                                                                               
OLD      USING DOSALPRD,R6                                                      
         CLI   OLD.DOSALEN,DOSALNQ           OLD VERSION, NO S/P CODE           
         BE    USR70                         YES, ADD                           
         CLC   SALESCOD,OLD.DOSASALC         SAME S/P CODE?                     
         BNE   USR70                         NO, ADD ONE                        
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         BNE   USR47                                                            
         TM    OLD.DOSAFLAG,DOSAPPER         PREV WAS P/P?                      
         BO    USR50                         YES                                
         B     USR70                         NO, ADD                            
USR47    TM    OLD.DOSAFLAG,DOSAPPER         PREV WAS S/P?                      
         BO    USR70                         NO, ADD                            
*                                                                               
USR50    CLC   ORSSALE,OLD.DOSASALP                                             
         BE    USRX                                                             
         MVC   OLD.DOSASALP,ORSSALE                                             
         OC    OLD.DOSASALP,SPACES                                              
         B     USRPUT                                                           
*                                                                               
USR70    LA    R3,DOSAELEM                                                      
         USING DOSALPRD,R3                                                      
         MVI   DOSAPEL,DOSAPELQ    X'60'                                        
         MVI   DOSALEN,DOSALNQ2                                                 
         MVC   DOSASALP,ORSSALE    S/P NAME                                     
         OC    DOSASALP,SPACES                                                  
         MVC   DOSASALC,SALESCOD   S/P CODE                                     
         MVI   DOSAFLAG,0                                                       
         OI    DOSAFLAG,DOSABUYR   BUYER CHANGED                                
         CLC   ORSSPTX,=X'D7968995A3978599A29695'  POINTPERSON?                 
         BNE   *+8                                                              
         OI    DOSAFLAG,DOSAPPER   YES                                          
         GOTO1 RECUP,DMCB,(C'S',AIO),DOSAELEM,(R6)                              
*                                                                               
         TM    MISCFLG3,MF3SALNF   ADDING OR WRITING?                           
         BNZ   USRWRT              ADDING                                       
USRPUT   BRAS  RE,MYPUTREC         WRITING                                      
         B     USRX                                                             
*                                                                               
USRWRT   XC    KEY,KEY             ADDING                                       
         L     R6,AIO                                                           
         MVC   KEY(L'DOKEY),0(R6)                                               
         BRAS  RE,MYADDREC         DIRECTORY KEY AUTOMATICALLY ADDED            
*                                                                               
         NI    MISCFLG3,X'FF'-MF3SALNF                                          
USRX     MVC   AIO,AIO1            RESTORE AIO TO AIO1                          
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* GET THE REP OFFICE FROM THE ROUTE FIELD                                       
*                                                                               
* ON EXIT: SVREPOFF HAS 2 BYTE CHAR REP DESTINATION OFFICE                      
*                                                                               
***********************************************************************         
GTREPOFF NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         XC    SVREPOFF,SVREPOFF                                                
         LA    R2,ORSROUTH                                                      
         ZIC   R1,ORSROUTH                                                      
         AR    R2,R1               POINT TO NEXT FIELD                          
*                                                                               
         TM    ORSROUTH+1,X'02'    EXTENDED FIELD HEADER?                       
         BZ    *+8                                                              
         AHI   R2,-8               YES, SUBTRACT 8                              
*                                                                               
         LA    R0,ORSROUT          R0 = A(ROUTE FIELD)                          
GRPOF10  AHI   R2,-1               BUMP BACK ONE BYTE                           
*                                                                               
         CR    R2,R0               DID I FIND ANYTHING?                         
         BL    GRPOFX              NO                                           
*                                                                               
         CLI   0(R2),X'40'         LESS THAN SPACES?                            
         BNH   GRPOF10                                                          
         AHI   R2,-1                                                            
         MVC   SVREPOFF,0(R2)                                                   
*                                                                               
GRPOFX   J     XIT                                                              
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK FOR SEND PENDING, TOBESENT, RECALLING STATUS                            
*   IF NOT THESE STATUSES, WE CAN CHANGE ROUTE, DEST, S/P, P/P                  
*                                                                               
* ON ENTRY:  AIO    ORDER RECORD                                                
*                                                                               
*  ON EXIT:  CC     E - TRUE                                                    
*                   NE - OTHERWISE, OR ORDER RECORD NOW IN AIO                  
*                                                                               
***********************************************************************         
CHKPNDNG NTR1  BASE=*,LABEL=*                                                   
         L     R6,AIO                                                           
         USING DOKEY,R6                                                         
         CLC   =X'0D34',0(R6)      MAKE SURE WE HAVE AN ORDER RECORD            
         BNE   CHKPNDNO                                                         
         CLI   12(R6),0                                                         
         BNE   CHKPNDNO                                                         
*                                                                               
         CLC   =C'FAX:',ORSROUT    ROUTE = FAX?                                 
         BE    CHKPNDNO            YES, CAN CHANGE                              
         CLC   =C'EML:',ORSROUT    ROUTE = EMAIL?                               
         BE    CHKPNDNO            YES, CAN CHANGE                              
*                                                                               
         MVI   ELCODE,DOSTELQ      LETS LOOK AT THE STATUS                      
         BAS   RE,GETEL                                                         
         BNE   CHKPNDNO            UNSENT, CAN CHANGE                           
         USING DOSTELD,R6                                                       
         CLI   DOSTSTAT,DSENT                                                   
         BE    CHKPNDYS                                                         
         CLI   DOSTSTAT,DDLVRD                                                  
         BNE   CHKPND20                                                         
         ZIC   R0,1(R6)                                                         
         AR    R6,R0                                                            
*                                                                               
CHKPND20 CLI   DOSTSTAT,QRECALL                                                 
         BE    CHKPNDYS                                                         
         CLI   DOSTSTAT,QSNTPNDG                                                
         BE    CHKPNDYS                                                         
         CLI   DOSTSTAT,QTOBESNT                                                
         BNE   CHKPNDNO                                                         
CHKPNDYS J     YES                 YES, ITS PENDING, DON'T CHANGE               
CHKPNDNO J     NO                  NO, WE CAN CHANGE                            
         DROP  R6                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* SHOW THE REVISION NUMBER                                                      
* ON ENTRY   R1     A(REVISION FIELD HEADER)                                    
*            R6     A(DOSPELEM)                                                 
*            AIO    A(ORDER RECORD)                                             
***********************************************************************         
SHOWREV  NTR1  BASE=*,LABEL=*                                                   
         LTR   R6,R6                                                            
         BNZ   SHWREV05                                                         
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         BNE   SHWREVX                                                          
         USING DOSPELD,R6                                                       
SHWREV05 SR    R0,R0                                                            
         IC    R0,DOSPREVN         NON-FAX REVISION NUMBER                      
         CLI   DOSPMTHD,C'F'                                                    
         BE    *+14                                                             
         CLC   =C'FAX:',ORSROUT    ROUTE = FAX?                                 
         BNE   SHWREV10                                                         
         CLI   NEWFAX,C'Y'         TEST NEW FAX                                 
         BNE   SHWREV10                                                         
         IC    R0,DOSPFXRV                                                      
SHWREV10 EDIT  (R0),(3,11(R1)),FILL=0                                           
         OI    6(R1),X'80'         TRANSMIT FIELD                               
         DROP  R6                                                               
*                                                                               
SHWREVX  J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* CHECK IF THE LAST STATUS IS CONFIRM SO WE KNOW TO INC DOSPREVN                
* ON ENTRY   AIO    A(ORDER RECORD)                                             
***********************************************************************         
CHECKCNF NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         L     R6,AIO                                                           
         MVI   ELCODE,DOSTELQ                                                   
         BAS   RE,GETEL                                                         
         B     *+8                                                              
CHKCNF10 BAS   RE,NEXTEL                                                        
         BNE   CHKCNFNO                                                         
         USING DOSTELD,R6                                                       
         CLI   DOSTSTAT,DDLVRD     IS IT DELIVERED?                             
         BE    CHKCNF10                                                         
         CLI   DOSTSTAT,QTOBESNT   IS IT SENT PENDING?                          
         BE    CHKCNF10            YES, SKIP IT                                 
         CLI   DOSTSTAT,QSNTXCNF   IS IT SEND CANCELLED, PARTIAL CONFRM         
         BE    CHKCNF10            YES, SKIP IT                                 
         CLI   DOSTSTAT,QSNTPNDG   IS IT SENT PENDING?                          
         BE    CHKCNF10            YES, SKIP IT                                 
         CLI   DOSTSTAT,QBYRCNFM   IS IT BUYER CONFIRMED?                       
         BE    CHKCNFYS                                                         
         CLI   DOSTSTAT,QCFMD      LAST STATUS IS CONFIRMED?                    
         BNE   CHKCNFNO                                                         
CHKCNFYS J     YES                                                              
CHKCNFNO J     NO                                                               
         DROP  R6                                                               
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* UPDATE THE EXTRA RECORD FOR OM DESKTOP                                        
*                                                                               
*  ON ENTRY: DARE RECORD IN AIO1                                                
*                                                                               
***********************************************************************         
UPDEXTRA NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         GOTOR GETIDNUM,DMCB,ORSROUT                                            
*                                                                               
         L     R6,AIO                                                           
         XC    KEY,KEY                                                          
         MVC   KEY(L'DOKEY),0(R6)                                               
         MVI   KEY+12,X'05'        UPDATE EXTRA X'05' RECORD                    
*                                                                               
         MVI   ELCODE,DOSTELQ                                                   
         BAS   RE,GETEL                                                         
         USING DOSTELD,R6                                                       
         CLI   DOSTSTAT,DSENT                                                   
         BE    UEX10                                                            
         CLI   DOSTSTAT,DFXSENT                                                 
         BE    UEX10                                                            
         CLI   DOSTSTAT,QRECALL                                                 
         BE    UEX10                                                            
         CLI   DOSTSTAT,QSNTPNDG                                                
         BE    UEX10                                                            
         CLI   DOSTSTAT,QNODARE                                                 
         BNE   UEXX                                                             
UEX10    MVC   DOSTELEM(DOSTLNQ),0(R6)                                          
         L     R6,AIO                                                           
         DROP  R6                                                               
*                                                                               
         MVC   AIO,AIO2                                                         
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 HIGH                                                             
         CLC   KEY(L'DOKEY),KEYSAVE                                             
         BNE   UEX20                                                            
         MVI   RDUPDATE,C'Y'                                                    
         GOTO1 GETREC                                                           
         L     R4,AIO                                                           
         B     UEX40                                                            
*                                                                               
UEX20    OI    MISCFLG4,MF4XTRNF                                                
         L     RE,AIO                                                           
         LA    RF,2000                                                          
         XCEFL                                                                  
                                                                                
         L     R4,AIO                        NOTE: EXTRA REC                    
         USING DOKEY,R4                                                         
         MVC   DOKEY,KEYSAVE                                                    
         MVC   DORLEN,=Y(DORFRST-DOKEY)                                         
         MVC   DORAGY,AGENCY                                                    
         DROP  R4                                                               
*                                                                               
UEX40    LA    R4,DORFRST-DOKEY(R4)                                             
         LA    R3,DOSTELEM                                                      
         USING DOSTELD,R3                                                       
         MVI   DOSTLEN,DOSTLNQ4                                                 
         XC    DOSTPID(DOSTLNQ4-DOSTLNQ),DOSTPID                                
*                                                                               
         GOTO1 GETFACT,DMCB,0                                                   
         L     R1,0(R1)                                                         
         USING FACTSD,R1                                                        
         MVC   DOSTPID,FAPASSWD                                                 
         DROP  R1                                                               
*                                                                               
         MVI   ELCODE,DOSPELQ                                                   
         BAS   RE,GETEL                                                         
         USING DOSPELD,R6                                                       
         MVC   DOSTDEST,DOSPDEST   SAVE DESTINATION                             
         MVC   DOSTMTHD,DOSPMTHD   SAVE METHOD                                  
         MVC   DOSTDID,BDESTID     BINARY DEST ID                               
         MVC   DOSTSPTS,DOSPSPTS   SAVE SPOTS                                   
         MVC   DOSTTOTL,DOSPTOTL   SAVE TOTAL DOLLARS                           
         MVC   DOSTREVN,DOSPREVN   SAVE REVISION                                
         MVI   ELCODE,DOWIGELQ                                                  
         BAS   RE,NEXTEL           DO WE HAVE A FAX?                            
         BNE   *+10                NO                                           
         USING DOWIGELD,R6                                                      
         MVC   DOSTFXN,DOWIGFXN    SAVE FAX                                     
         DROP  R6                                                               
*                                                                               
         GOTO1 RECUP,DMCB,(C'S',AIO),DOSTELEM,(R4)                              
*                                                                               
         TM    MISCFLG4,MF4XTRNF   ADDING OR WRITING?                           
         BNZ   UEXWRT              ADDING                                       
UEXPUT   BRAS  RE,MYPUTREC         WRITING                                      
         B     UEXX                                                             
*                                                                               
UEXWRT   XC    KEY,KEY             ADDING                                       
         L     R4,AIO                                                           
         MVC   KEY(L'DOKEY),0(R4)                                               
         BRAS  RE,MYADDREC         DIRECTORY KEY AUTOMATICALLY ADDED            
*                                                                               
         NI    MISCFLG4,X'FF'-MF4XTRNF                                          
UEXX     MVC   AIO,AIO1                                                         
         J     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
***********************************************************************         
* STATION ERROR MESSAGE                                                         
***********************************************************************         
STATMSSG NTR1  BASE=*,LABEL=*                                                   
         L     RF,AIO                                                           
         MVC   SAVEKEY,0(RF)                                                    
         MVC   AIO,AIO2                                                         
         MVI   IOOPT,C'Y'                                                       
         OI    BITFLAG2,BF2STAMS                                                
*                                                                               
         BRAS  RE,SAVETWA          SAVE TWA                                     
*                                                                               
* THERE IS A DARK STATION, THIS IS THE 1ST TIME SENDING                         
* THIS ORDER EDI, MUST PROMPT USER WITH WARNING                                 
         GOTO1 CALLOV,DMCB,(X'FA',CONTAGH),0,0                                  
*                                                                               
         XC    BLOCK,BLOCK                                                      
         MVC   BLOCK(L'QSTA),QSTA                                               
         MVI   BLOCK+5,C'/'                                                     
         MVC   BLOCK+6(5),=5C'?'                                                
*                                                                               
         LA    R4,KEY                                                           
         USING CT9ARECD,R4                                                      
         XC    KEY,KEY                                                          
         MVI   CT9AKTYP,CT9AKTYQ                                                
         MVC   CT9AKMED,QMED                                                    
         MVC   CT9AKCLL,QSTA                                                    
         DROP  R4                                                               
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',KEY,AIO                       
         L     R6,AIO                                                           
         CLC   KEY(25),0(R6)       DID I GET MY RECORD?                         
         BNE   STMS04              DON'T DIE, JUST SHOW ????                    
         USING CT9ARECD,R6                                                      
         LA    R6,CT9ADATA                                                      
         USING CT9AEL,R6                                                        
*                                                                               
         LA    R4,KEY                                                           
         USING CT99RECD,R4                                                      
         XC    KEY,KEY                                                          
         MVI   CT99KTYP,CT99KTYQ                                                
         MVC   CT99KUID,CT9AUID                                                 
         DROP  R4,R6                                                            
         GOTO1 DATAMGR,DMCB,=C'DMRDHI',=C'CTFILE',KEY,AIO                       
         L     R6,AIO                                                           
         CLC   KEY(25),0(R6)       DID WE FIND IT?                              
         BE    *+6                                                              
         DC    H'0'                                                             
         USING CT99RECD,R6                                                      
         LA    R6,CT99DATA                                                      
         USING CRCLD,R6                                                         
*                                                                               
         MVC   BLOCK+6(L'CRCLCTY),CRCLCTY                                       
STMS04   LA    R1,BLOCK+30                                                      
STMS05   CLI   0(R1),C' '                                                       
         BH    STMS10                                                           
         BCT   R1,STMS05                                                        
STMS10   LA    R1,1(R1)                                                         
         MVI   0(R1),C','                                                       
         MVC   2(L'CRCLSTE,R1),CRCLSTE                                          
         MVC   5(34,R1),=C'has recently changed call letters.'                  
*                                                                               
         MVC   ORBMESS,BLOCK                                                    
         OI    ORBMESSH+6,X'80'                                                 
*                                                                               
         MVC   AIO,AIO1                                                         
         B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
SAVETWA  NTR1  BASE=*,LABEL=*                                                   
         L     RE,ATIA                                                          
         LH    RF,=Y(TWAMXLEN)                                                  
         L     R0,ATWA                                                          
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
         LA    R2,X'81'            WRITE TWA RECORD #1                          
         GOTO1 GETTWA,DMCB,((R2),ATIA)                                          
         B     XIT                                                              
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
RSTRTWA  NTR1  BASE=*,LABEL=*                                                   
         LA    R2,1                READ TWA RECORD #1                           
         GOTO1 GETTWA,DMCB,((R2),ATIA)                                          
         L     RE,ATIA                                                          
         LH    RF,=Y(TWAMXLEN)                                                  
         L     R0,ATWA                                                          
         LR    R1,RF                                                            
         MVCL  R0,RE                                                            
         L     R2,ATWA             MUST SET INDICATOR TO XMIT FIELDS            
         LA    R2,64(R2)               OR SCREEN WILL BE MESSED UP              
         CLI   0(R2),0                                                          
         BE    *+16                FIND END OF TWA                              
         SR    R0,R0                                                            
         IC    R0,0(R2)                                                         
         AR    R2,R0                                                            
         B     *-16                                                             
         MVC   1(2,R2),=X'0101'    SET INDICATOR TO XMIT ALL FIELDS             
         B     XIT                                                              
         LTORG                                                                  
*                                                                               
MYPUTREC NTR1                                                                   
         CLI   PQONLY,C'Y'                                                      
         JE    MYPUTREX                                                         
         GOTO1 PUTREC                                                           
MYPUTREX XIT1                                                                   
*                                                                               
MYADDREC NTR1                                                                   
         CLI   PQONLY,C'Y'                                                      
         JE    MYADDREX                                                         
         GOTO1 ADDREC                                                           
MYADDREX XIT1                                                                   
         EJECT                                                                  
* FAGETTXTD                                                                     
* DDGLOBEQUS                                                                    
* DDGLVXCTLD                                                                    
* DDCOMFACSD                                                                    
* DMPRTQL                                                                       
* FAFACTS                                                                       
* FACIDTABD                                                                     
* CTGENFILE                                                                     
* DDSPOOLD                                                                      
* DDSPLWORKD                                                                    
* DDPERVALD                                                                     
* CTGENEDICT                                                                    
* FATIOB                                                                        
* SPGENAGY                                                                      
* SPGENCLT                                                                      
* SPGENEST                                                                      
* SPGENMKT                                                                      
* SPGENPRD                                                                      
* SPADAVCOM                                                                     
         PRINT OFF                                                              
       ++INCLUDE SPGENAUTH                                                      
       ++INCLUDE FAGETTXTD                                                      
       ++INCLUDE DDGLOBEQUS                                                     
       ++INCLUDE DDGLVXCTLD                                                     
       ++INCLUDE DDCOMFACS                                                      
       ++INCLUDE DMPRTQL                                                        
       ++INCLUDE DDBIGBOX                                                       
BOXDL    EQU   *-BOXD                                                           
       ++INCLUDE DDWIDED                                                        
WIDEDL   EQU   *-WIDED                                                          
       ++INCLUDE FAFACTS                                                        
       ++INCLUDE FACIDTABD                                                      
       ++INCLUDE CTGENFILE                                                      
       ++INCLUDE DDSPOOLD          (GENERAL PRINT AREAS)                        
       ++INCLUDE DDSPLWORKD        (GENERAL CONTROLLER AREAS)                   
       ++INCLUDE DDSPOOK           SOON JOB PARAMETER BLOCK                     
       ++INCLUDE DDPERVALD                                                      
       ++INCLUDE FATIOB                                                         
       ++INCLUDE CTGENEDICT                                                     
*PREFIX=CT$                                                                     
       ++INCLUDE CTGENSTAD                                                      
*PREFIX=                                                                        
       ++INCLUDE GEGENBDE                                                       
       ++INCLUDE CTGENAGRD                                                      
       ++INCLUDE SPAUTHD                                                        
AGYHDRD  DSECT                                                                  
       ++INCLUDE SPGENAGY                                                       
CLTHDRD  DSECT                                                                  
       ++INCLUDE SPGENCLT                                                       
ESTHDRD  DSECT                                                                  
       ++INCLUDE SPGENEST                                                       
MKTHDRD  DSECT                                                                  
       ++INCLUDE SPGENMKT                                                       
PRDHDRD  DSECT                                                                  
       ++INCLUDE SPGENPRD                                                       
BUYRECD  DSECT                                                                  
       ++INCLUDE SPGENBUY                                                       
GOALRECD DSECT                                                                  
       ++INCLUDE SPGENGOAL                                                      
       ++INCLUDE SPADAVCOM                                                      
       ++INCLUDE SPADBUYER                                                      
DBLOCKD  DSECT                                                                  
       ++INCLUDE DEDBLOCK                                                       
         PRINT ON                                                               
       ++INCLUDE SPOMSFFD          (BASE SCREEN FOR SYSTEM)                     
         EJECT                                                                  
         ORG   CONTAGH                                                          
       ++INCLUDE SPOMSF9D                                                       
         EJECT                                                                  
         ORG   CONTAGH                                                          
       ++INCLUDE SPOMSE9D          (OUR LIST SCREEN)                            
         EJECT                                                                  
         ORG   CONTAGH                                                          
       ++INCLUDE SPOMSD9D          (OUR DISPLAY SCREEN)                         
         EJECT                                                                  
         ORG   CONTAGH                                                          
       ++INCLUDE SPOMSC3D          (OUR STANDARD COMMENTS LIST SCREEN)          
         EJECT                                                                  
         ORG   CONTAGH                                                          
       ++INCLUDE SPOMSFAD                                                       
         EJECT                                                                  
       ++INCLUDE DDGENTWA                                                       
         EJECT                                                                  
       ++INCLUDE SPOMSWORKD        (SYSTEM AREAS)                               
         EJECT                                                                  
       ++INCLUDE SPGENDRORD                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDESTN                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDRMKN                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDRMTH                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDRFLT                                                     
         EJECT                                                                  
       ++INCLUDE SPGENDRBTC                                                     
         EJECT                                                                  
*PREFIX=OM$                                                                     
COMHDRD  DSECT                                                                  
       ++INCLUDE SPGENCOM                                                       
*PREFIX=                                                                        
       ++INCLUDE CTGENRAD                                                       
         EJECT                                                                  
***********************************************************************         
* MY STORAGE AREA                                                               
***********************************************************************         
*                                                                               
MYAREAD  DSECT                                                                  
APRTLINE DS    A                   A(EXTENDED PRINT LINE)                       
REPCODE  DS    A                   ADDRESS OF REPCODE (FOR REGENDRB)            
VGLOBBER DS    A                                                                
BINPARMS DS    6F                  BINSRCH PARAMETERS                           
AMOSTATB DS    A                   A(MO STATION CUTOFF TABLE)                   
AMOREPTB DS    A                   A(MO REP/OFFICE CUTOFF TABLE)                
AWORPDTB DS    A                   A(NBC WIDEORBIT CUTOVER TABLE)               
AMORODTB DS    A                   A(MO REP/OFFICE/DATE CUTOFF TBL)             
AMOOFTAB DS    A                   A(MO REP/OFF/STA/DATE CUTOFF TBL)            
AGYNSPTS DS    F                   NUMBER OF SPOTS                              
AGYNMRCS DS    F                   NUMBER OF RECORDS PRINTED                    
ELEMDISP DS    H                   ELEMENT DISPLACEMENT (USED FOR DIS)          
*                                  HOB = X'80' = AT THE DELNOT                  
*                                  HOB = X'40' = AT THE STATUS                  
*                                                                               
WRKFILNO DS    XL2                 WORKER FILE NUMBER                           
PACKOF4B DS    PL4                 PACKED OF 4 BYTES                            
AGYDOLRS DS    PL6                 NUMBER OF DOLLARS                            
ERRNUM   DS    XL2                 FOR 2-BYTE ERROR MESSAGES                    
AVNEW    DS    C                   AVN/NEW                                      
BATCHSLP DS    CL(L'ORSSALE)       SALESPERSON SAVED FROM BATCH REC             
BATCHFLG DS    XL1                 FOR POINTPERSON FLAG FROM BATCH REC          
*                                                                               
PROFDAR  DS    CL16                DARE PROFILE                                 
PDARDEMS EQU   PROFDAR+1             INCLUDE DEMOS IN ORDER? (N,Y,1-4)          
PDARBCOM EQU   PROFDAR+2             INCLUDE BUY COMMENTS IN ORDER?             
PDARTSRP EQU   PROFDAR+6   3 BYTES   TRADE SPECIAL REP DIGITS                   
PDARPORN EQU   PROFDAR+9             REQUIRES PREV/NEW?                         
PDAR0TRD EQU   PROFDAR+12            TRADE ORDER $0 COST                        
PDARMTRD EQU   PROFDAR+14            MULTIPLE TRADE CODES                       
PDAROROM EQU   PROFDAR+15            USES ORDER MANAGER? (FROM OM PROF)         
*                                                                               
PROFOM   DS    CL16                OM PROFILE                                   
POMUSEOM EQU   PROFOM               - USES ORDER MANAGER?                       
POMUSENW EQU   PROFOM+1             - USES NEW ORDER #'S?                       
POMAUCFM EQU   PROFOM+2             - PARITAL CONFIRM WORKFLOW                  
POMFXRAD EQU   PROFOM+3             - FAX RADIO ALL RADIO ORDERS?               
POMMGREP EQU   PROFOM+15            - CREATE MKGD TRANSACTION REPORT?           
*                                                                               
BITFLAG  DS    XL1                 VARIOUS FLAGS                                
BFSHWSCR EQU   X'80'                 SHOW ME LIST COMMENTS SCREEN               
BFSTDCOM EQU   X'40'                 LISTING STANDARD COMMENTS MODE             
BFPREVKY EQU   X'20'                 PREVIOUS KEY TO BE USE IN LIST             
BFLNOMOR EQU   X'10'                 NO MORE RECORDS FOR LIST                   
BFFRMBUY EQU   X'08'                 FROM THE BUY PROGRAM VIA GLOBBER           
BFFRMNWS EQU   X'04'                 FROM THE NWS PROGRAM VIA GLOBBER           
BFRCLLNG EQU   X'02'                 RECALLING FROM BUY/NWS PROGRAM             
*                                                                               
BITFLAG2 DS    XL1                 VARIOUS FLAGS 2                              
BF2SHOWR EQU   X'80'                 SHOW REP COMMENTS                          
BF2STAMS EQU   X'40'                 IN STATION ERROR MESSAGE MODE              
BF2STAOK EQU   X'20'                 OK TO SEND TO THIS STATION                 
*                                                                               
MISCFLG1 DS    XL1                 MISCELLANEOUS FLAGS SET 1                    
MF1KYCHG EQU   X'80'                 A KEY FIELD HAS BEEN CHANGED               
MF1RECNF EQU   X'40'                 RECORD WAS NOT FOUND                       
MF1CHNGD EQU   X'20'                 RECORD WAS CHANGED                         
MF1FLTRC EQU   X'10'                 FLIGHT RECORD EXISTS FOR ESTIMATE          
MF1DRTRD EQU   X'08'                 DOING TRADE ORDERS NOW                     
MF1CSHRC EQU   X'04'                 WE HAVE A CASH CONDITION                   
MF1TRDRC EQU   X'02'                 WE HAVE A TRADE CONDITION                  
MF1DRREV EQU   X'01'                 DOING A DARE REVISION                      
*                                                                               
MISCFLG2 DS    XL1                 MISCELLANEOUS FLAGS SET 2                    
MF2PRSNT EQU   X'80'                 ORDER WAS PREVIOUSLY SENT                  
MF2UNALL EQU   X'40'                 WE HAVE AN UNALLOCATED                     
MF2VAROR EQU   X'20'                 NOW A VAR ORDER                            
MF2VCONF EQU   X'10'                 VAR ORDER CONFIRMED                        
MF2MOORD EQU   X'08'                 ORDER GOING TO MEDIAOCEAN                  
MF2RCLNG EQU   X'04'                 ORDER IS IN RECALLING STATUS               
MF2BSCOM EQU   X'02'                 BUYER HAS A STANDARD COMMENT               
MF2VPRDS EQU   X'01'                 LOOKING FOR THE VAR PRODUCTS               
*                                                                               
MISCFLG3 DS    XL1                 MISCELLANEOUS FLAGS SET 3                    
MF3RADIO EQU   X'80'                 THIS IS FOR RADIO ORDERS!!                 
MF3FXRAD EQU   X'40'                 ONLY FAX RADIO ORDERS!!!                   
MF3PRVCF EQU   X'20'                 PREVIOUSLY CONFIRMED                       
MF3NOFST EQU   X'10'                 NOT THE FIRST TIME THROUGH                 
MF3NOOFF EQU   X'08'                 REP DOES NOT APPEND OFFICE                 
MF3SALNF EQU   X'04'                 SALESPERSON RECORD NOT FOUND               
MF3MSALP EQU   X'02'                 MANUAL SALESPERSON ENTERED                 
MF3PRVEM EQU   X'01'                 PREVIOUSLY EMAILED                         
*                                                                               
MISCFLG4 DS    XL1                 MISCELLANEOUS FLAGS SET 4                    
MF4MOFAX EQU   X'80'                 MO, CAN'T SEND OOW EST, GO FAX!            
MF4UNWMG EQU   X'40'                 A MAKEGOOD WAS UNWOUND IN THE PAST         
MF4XTRNF EQU   X'20'                 EXTRA RECORD NOT FOUND                     
*                                                                               
CASHFLGS DS    0XL2                                                             
CASHFLG1 DS    XL1                 BIT FLAGS SET #1 FOR CASH  ORDERS            
CASHFLG2 DS    XL1                               #2                             
TRDEFLGS DS    0XL2                                                             
TRDEFLG1 DS    XL1                 BIT FLAGS SET #1 FOR TRADE ORDERS            
TRDEFLG2 DS    XL1                               #2                             
***********************************                                             
* BITS FOR CASHFLG1 & TRDEFLG1                                                  
***********************************                                             
NEVERSNT EQU   X'80'                - WAS NEVER SENT                            
SNTALRDY EQU   X'40'                - SENT ALREADY, CAN'T SEND AGAIN            
NOBYSEXS EQU   X'20'                - NO BUYS EXISTS                            
ORDUNDRD EQU   X'10'                - ORDER HAS BEEN UNDARED                    
CSNDCONF EQU   X'08'                - CAN'T SEND THIS CONFIRMED ORDER           
NTDARENV EQU   X'04'                - NOTDARE IS NOT VALID                      
GOTSMMGS EQU   X'02'                - GOT SOME MAKEGOODS FOR THIS ORDER         
ONTHEWAY EQU   X'01'                - ON ITS WAY                                
***********************************                                             
* BITS FOR CASHFLG2 & TRDEFLG2                                                  
***********************************                                             
RCALCANT EQU   X'80'                - CANNOT BE RECALLED                        
RCALWOFF EQU   X'40'                - RECALLING FROM WRONG OFFICE               
RCALONIT EQU   X'01'                - RECALL ON ITS WAY                         
*                                                                               
RCOMLINE DS    XL1                 LINE NUMBER OF NEXT REP COMMENT              
CURRDATE DS    CL6                 BUY START DATE                               
*                                                                               
OLDSPERT DS    C                   PREVIOUS SALESPERSON TYPE                    
OLDSPER  DS    CL(L'DOIDSPER)      PREVIOUS SALESPERSON                         
BRWPREF  DS    C                   BROWSE PREFERENCE                            
*                                                                               
CMMNTCNT DS    XL1                 # OF COMMENTS SELECTED FROM LIST             
CMMNTLST DS    3CL8                SELECTED COMMENTS LIST                       
*                                                                               
REPMEDIA DS    CL1                 REP'S MEDIA TYPE                             
*                                                                               
SVAGYID  DS    CL3                 AGENCY ID                                    
SVAGYOFF DS    CL2                 AGENCY OFFICE                                
SVREPOFF DS    CL2                 REP OFFICE                                   
SVBPRD   DS    XL1                 SAVED BINARY PRODUCT                         
SVBPR2   DS    XL1                 SAVED BINARY PIGGYBACK                       
GOALPRD  DS    XL1                 GOAL PRODUCT 1                               
GOALPR2  DS    XL1                 GOAL PIGGYBACK                               
SVQPRD   DS    CL3                 SAVED EBCDIC PRODUCT                         
SVQPR2   DS    CL3                 SAVED EBCDIC PIGGYBACK                       
SVBEST   DS    XL1                 SAVED ESTIMATE                               
SVBFLT   DS    XL1                 SAVED FLIGHT NUMBER                          
SVFLTSDT DS    XL3                 SAVED FLIGHT START DATE                      
SVFLTEDT DS    XL3                              END   DATE                      
SVAIRDAT DS    XL2                 SAVED FIRST AIR DATE                         
SVOOWROT DS    XL1                 SAVED OUT OF WEEK ROTATOR START DAY          
SVBDCOST DS    XL4                 SAVED BUY COST                               
SVBDNOWK DS    XL1                 SAVED BUY NUMBER OF WEEKS                    
BDESTID  DS    XL2                 BINARY DESTINATION ID                        
BINSREC  DS    XL(BSRCRLEN)        BINSRCH RECORD                               
CLTFLAG1 DS    XL1                                                              
CLTTRADE EQU   X'80'               THIS IS A TRADE CLIENT                       
ESTFLAG1 DS    XL1                 ESTIMATE FLAG SET 1                          
ESTDAILY EQU   X'80'                - DAILY SCHEDULE                            
ESTTRADE EQU   X'40'                - TRADE ESTIMATE                            
ESTSDE   EQU   X'20'                - SUPERDESK AUTHORIZATION OPEN              
PR1TIMSH DS    XL1                 PRODUCT 1 TIME SHARE, 0 - USE BDTIME         
NEWFAX   DS    C                                                                
RESEND   DS    C                                                                
*                                                                               
BINORDER DS    0XL4                BINARY ORDER NUMBER                          
BINORDDT DS    XL2                     DATE PORTION                             
BINORDSQ DS    XL2                     SEQUENCE PORTION                         
BINFLTNM DS    XL1                 BINARY FLIGHT NUMBER                         
ORDRDATE DS    XL3                 ORDER'S CREATION DATE PWOS JULIAN            
*                                                                               
SVDORDER DS    XL4                 SAVED ORDER NUMBER                           
SVREVDAT DS    0XL4                SAVED REVISION NUMBERS AND SENT DATE         
SVCURREV DS    XL1                 SAVED CURRENT REVISION NUMBER                
SVPREREV DS    XL1                 SAVED PREVIOUS REVISIN NUMBER                
SVPRVDAT DS    XL2                 SAVED PREVIOUS DATE OF LAST SEND             
*                                                                               
CFFDATE  DS    XL2                 TODAY'S DATE COMPRESSED X'FF' COMPL.         
EDIDATE  DS    CL3                 DATE OF FIRST EDI TRANSMISSION               
PQONLY   DS    C                   SET TO Y FOR ACTION PQONLY                   
*                                                                               
GLOBMED  DS    XL(L'ORSMED)        FIELDS FROM SPT/BUY                          
GLOBCLT  DS    XL(L'ORSCLT)                                                     
GLOBPRD  DS    XL(L'ORSPRD)                                                     
GLOBEST  DS    XL(L'ORSEST)                                                     
GLOBSTA  DS    XL(L'ORSSTA)                                                     
*                                                                               
PREVKEY  DS    XL(L'DOKEY)         SAVED KEYS                                   
CMMNTKEY DS    XL(L'COMKEY)                                                     
SAVEKEY  DS    XL(L'DOKEY)                                                      
*                                                                               
SVQCORDR DS    CL8                 SAVED EBCDIC ORDER NUMBER                    
REPALPH1 DS    CL2                 SAVED SALESPERSON CODE                       
REPALPHA DS    CL2                 SAVED SALESPERSON CODE                       
SALESCOD DS    CL3                 SAVED SALESPERSON CODE                       
DISKADDR DS    XL4                 DISK ADDRESS                                 
*                                                                               
PERVALST DS    XL(L'PVALOUTB)      PERVAL STORAGE AREA                          
*                                                                               
FAKEFLDH DS    CL8                 FAKE FIELD HEADER AND FIELD DATA             
FAKEFLD  DS    CL64                                                             
*                                                                               
DOIDELEM DS    XL(DOIDLNQ)         COPY OF DARE ID ELEMENT                      
DOI2ELEM DS    XL(DOI2LNQ)                      2NDARY ID ELEMENT               
DOSPELEM DS    XL(DOSPLNQ2)                     SUPPLEMENTAL ID ELEMENT         
DOXMELEM DS    XL(DOXMTLNQ)                     TRANSMISSION ELEMENT            
DOBYELEM DS    XL(DOBUYLNQ)                     BUYLINE ELEMENT                 
COLOELEM DS    XL(COLLENQ)                  NEW COLOR STATUS ELEMENT            
DOSTELEM DS    XL(DOSTLNQ4)                 NEW STATUS ELEMENT                  
DOEMELEM DS    XL(DOEMLLNQ)                 NEW BDE COMMON NAME ELEM            
DOSAELEM DS    XL(DOSALNQ2)                                                     
*                                                                               
BUYLINES DS    XL32                WHAT BUYLINES DARE ORDER USED                
*                                                                               
BIGSPLKY DS    XL144    WAS 128   BIG SPOOLKEY (QLSOFEND IN DMPRTQL)            
*                                                                               
PRDSLIST DS    XL512               PRD LIST FOR POL BUYS                        
MKTMIS   DS    CL(L'QMKT)          FOR SWITCH TO MIS PROGRAM                    
ESTMIS   DS    CL3                 FOR SWITCH TO MIS PROGRAM                    
SVFLTFLG DS    CL1                 SAVE FLIGHT ELEM FLAG SET IN MKT/LST         
*                                                                               
PFKFLAG  DS    CL1                 FLAGS FOR PFKEYS                             
PFKBRW   EQU   X'80'               GOING TO BROWSE                              
PFKBRW2  EQU   X'40'               WENT TO BROWSE                               
PFKPPER  EQU   X'20'               HAVE A POINTPERSON                           
         EJECT                                                                  
***********************************************************************         
* STANDARD COMMENTS LIST LINE DSECT                                             
***********************************************************************         
LSCDSECT DSECT                                                                  
LSCSELH  DS    CL8                                                              
LSCSEL   DS    CL1                                                              
         DS    CL8                                                              
LSCCOMCD DS    CL8                                                              
         DS    CL8                                                              
LSCLINE  DS    CL60                                                             
LSCNEXTL DS    0C                                                               
         EJECT                                                                  
***********************************************************************         
* BINSRCH RECORD DSECT                                                          
***********************************************************************         
BINSRECD DSECT                                                                  
BSRCCOST DS    XL4                 COST                                         
BSRCDATE DS    CL6                 DATE   YYMMDD                                
BSRCNSPT DS    XL1                 NUMBER OF SPOTS                              
BSRCKLEN EQU   *-BINSRECD          LEN OF THE KEY                               
BSRCTSPT DS    XL1                 TOTAL NUMBER OF SPOTS FOR THIS WEEK          
BSRCRLEN EQU   *-BINSRECD          LEN OF THE RECORD                            
         EJECT                                                                  
       ++INCLUDE SPDARDARED                                                     
       ++INCLUDE GEGENSPSAL                                                     
         EJECT                                                                  
***********************************************************************         
* ERROR LIST DSECT                                                              
***********************************************************************         
ERRDSECT DSECT                                                                  
ERRLNGTH DS    XL1                 LENGTH OF ERROR ENTRY                        
ERRNUMBR DS    CL3                 ERROR NUMBER (EBCDIC NUMERIC)                
ERRTEXT  DS    0C                  NUMBER OF SPOTS                              
         SPACE 2                                                                
***********************************************************************         
* FILTER TABLE DSECT                                                            
***********************************************************************         
FLTRDSCT DSECT                                                                  
FLTRNLEN DS    XL1                 LENGTH OF FILTER ENTRY                       
FLTRAROU DS    XL4                 A(ROUTINE FOR THE FILTER)                    
FLTRLTXT DS    XL1                 LENGTH OF FILTER TEXT                        
FLTRTEXT DS    0C                  FILTER TEXT                                  
         EJECT                                                                  
***********************************************************************         
* EDICT CHUNKY DSECT                                                            
***********************************************************************         
EDICTD   DSECT                                                                  
       ++INCLUDE EDIDDSHD                                                       
       ++INCLUDE EDILINKD                                                       
         EJECT                                                                  
RQD      DSECT                                                                  
REQHDR   DS    0XL26                                                            
       ++INCLUDE DMREQHDR                                                       
RQAREA   DS    0CL80   COLUMN                                                   
RQPROG   DS    0CL2    ------                                                   
RQCODE   DS    CL2        1        PROGRAM CODE                                 
RQAGY    DS    CL2        3        AGENCY CODE                                  
RQMED    DS    CL1        5        MEDIA CODE (R/T)                             
RQCLT    DS    CL3        6        CLIENT CODE                                  
RQPGR    DS    CL1        9        PROCESS BY DIVISION                          
RQMGR    DS    CL1       10        PROCESS BY DISTRICT                          
RQCLOFF DS     CL1       11        CLIENT OFFICE FILTER                         
RQPRD    DS    CL3       12        PRODUCT MNEMONIC                             
RQMKT    DS    CL4       15        MARKET NUMBER                                
RQSTA    DS    CL5       19        STATION CALL LETTERS                         
RQEST    DS    CL3       24        ESTIMATE NUMBER                              
RQESTEND DS    CL3       27        LAST NUMBER IN ESTIMATE GROUP                
RQDEMOVR DS    CL1       30        Y=DEMO OVERRIDE ACTIVE                       
RQCONT   DS    CL1       31        C'*' ==> DATA IN QAREA2                      
RQSTAUTO DS    CL3       32        AUTO REQUEST START DATE                      
RQENAUTO DS    CL3       35        AUTO REQUEST END DATE                        
RQSTART  DS    CL6       38        REQUEST START DATE                           
RQEND    DS    CL6       44        REQUEST END DATE                             
         DS    CL12      50                                                     
RQOPT1   DS    CL1       62        OPTION 1                                     
RQOPT2   DS    CL1       63        OPTION 2                                     
RQOPT3   DS    CL1       64        OPTION 3                                     
RQOPT4   DS    CL1       65        OPTION 4                                     
RQOPT5   DS    CL1       66        OPTION 5                                     
RQGRP    DS    CL2       67        GROUP                                        
RQUESTOR DS    CL12      69        REQUESTOR NAME                               
*                                                                               
RQAREA2  DS    0CL80               REQUEST CARD 2 DATA AREA                     
RQCRRNCY DS    CL1     COL 01      CURRENCY OVRD - U=US,C=CANADA                
RQLANG   DS    CL1         02      LANGUAGE (C'F' FOR FRENCH)                   
RQGST    DS    CL1         03      C'I OR Y' = INCLUDE INPUT GST                
*                                  C'O'      = INCLUDE OUTPUT GST               
RQDEMADJ DS    CL1         04      C'N' = SUPPRESS SPCL DEMO ADJ FCTR           
RQCLGID  DS    CL1         05      CLTGRP ID                                    
RQCLGRP  DS    CL4         06      CLTGRP NUMBER                                
RQPTNR   DS    CL3         10      PARTNER PRODUCT                              
RQCBLNET DS    CL3         13      CABLE NETWORK                                
RQCOST2  DS    CL1         16      REPORT COST2 DOLLARS                         
RQSGR    DS    CL1         17      C'Y' = STATION IS A STATION GROUP            
RQMGA    DS    CL1         18      PRINT MAKEGOOD ANALYSIS                      
RQPWCV   DS    CL1         19      PW CLIENT VERSION                            
         DS    CL1         20      THIS FIELD FOR COMMON USE                    
RQ2CVRGN DS    XL1         21      CURRENT VIRGIN NUMBER                        
RQ2PVRGN DS    XL1         22      PREVIOUS VIRGIN NUMBER                       
RQ2PVRGD DS    XL2         23-24   PREVIOUS VIRGIN DATE                         
RQ2RSND  DS    CL1         25      C'Y' = RESEND                                
         ORG   RQ2CVRGN                                                         
RQ2USER  DS    CL50        21      THESE ARE FOR USE BY PROGRAMS                
         DS    CL10                RESERVED FOR COMMON USE                      
         ORG   RQAREA2+38                                                       
RQ2DEMO  DS    CL1         39      INCL DEMOS                                   
RQ2DRORD DS    CL8         40      DARE ORDER NUMBER                            
RQ2DRSID DS    CL2         48      SYSTEM ID                                    
RQ2AGYMD DS    CL2         50      EBCDIC AGENCY/MEDIA                          
*                                                                               
LAYOUT2D DSECT                                                                  
LAY2MED  DS    CL1                 FIELDS MADE UP IN THE DARE SCREEN            
LAY2BYR  DS    CL3                                                              
LAY2MTHD DS    CL1                 - CASH OR TRADE                              
LAY2CLT  DS    CL3                                                              
LAY2PRDS DS    CL7                                                              
LAY2EST  DS    CL6                                                              
LAY2STA  DS    CL8                                                              
LAY2OORD DS    CL8                                                              
LAY2SALP DS    0CL25                SALESPERSON                                 
LAY2RPRF DS    CL3                  RADIO PREFIX                                
LAY2RSAL DS    CL23                                                             
LAY2END  EQU   *                                                                
*                                                                               
       ++INCLUDE DMWRKFL                                                        
       ++INCLUDE DMWRKRK                                                        
       ++INCLUDE FASSB                                                          
       ++INCLUDE REGLBRW                                                        
       ++INCLUDE DDACTIVD                                                       
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'041SPOMS09   03/14/16'                                      
         END                                                                    

*          DATA SET RENWRGENS  AT LEVEL 041 AS OF 12/17/03                      
*PHASE T00AADA,*                                                                
*          TITLE 'T00AAD - REPPAK WRITER CONTROLLER'                            
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER'                            
***********************************************************************         
*                                                                     *         
*          TITLE  T00AAD - REPPAK WRITER CONTROLLER                   *         
*  COMMENTS: REPPAK WRITER CONTROLLER                                 *         
*                                                                     *         
*  LOCALS: REGISTER USAGE                                             *         
*          R2 - POINTER TO SCREEN FLDH, ERREX WILL POSITION CUSOR     *         
*          R3 - WORK REG                                              *         
*          R4 - WORK REG, KEY DSECT POINTER, SCANNER POINTER          *         
*          R5 - POINTER TO VLPARMS                                    *         
*          R6 - POINTER TO RECORD ELEMENTS                            *         
*          R7 - POINTER TO RENWRIOD                                   *         
*          R8 - POINTER TO SPOOLD                                     *         
*          R9 - POINTER TO SYSD                                       *         
*          RA - POINTER TO ATWA                                       *         
*          RB - FIRST BASE                                            *         
*          RC - POINTER TO GEND                                       *         
* AIO USAGE - AIO1 - VALI RTNS IN CONTROLLER (RENWR00-T23000)         *         
*                  - IN AIO FROM HYPER CONTROLLER (T00A30)            *         
*             AIO2 -                                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
***********************************************************************         
*                                                                     *         
*                                                                     *         
*  HISTORY OF CHANGES                                                 *         
*                                                                     *         
*                    ***  END TOMBSTONE  ***                          *         
***********************************************************************         
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - INIT'                       
***********************************************************************         
*                                                                     *         
*        INITIALIZATION                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
RENWRGEN CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,RENWRGEN,R6,RR=RE,CLEAR=YES                                    
*                                                                               
         USING SPOOLD,R8           RE-ESTABLSIH COMMON WORKING STORAGE          
*                                                                               
         LA    RC,SPOOLEND         ESTABLISH GENCON WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ST    RD,COMMRD                                                        
*                                                                               
         L     R9,ASUBSYSD                                                      
         USING SUBSYSD,R9                                                       
*                                                                               
         ST    RE,RELORGEN         SAVE RELOCATION FACTOR                       
*                                                                               
         LA    R7,RENWRIOD         ESTABLISH RENWRIOD                           
         USING RENWRIOD,R7                                                      
*                                                                               
         L     RA,ATWA                                                          
         USING T830FFD,RA                                                       
*                                                                               
         SRL   RF,24                                                            
         CLM   RF,1,=AL1((BRMAX-BRANCH)/4)                                      
         BNH   *+6                                                              
         DC    H'0'                                                             
         SLL   RF,2                                                             
         LA    RF,BRANCH(RF)       POINT TO ENTRY IN BRANCH TABLE               
*                                                                               
         CLI   0(RF),0             IF IT IS NOT AN ADDRESS                      
         BNE   0(RF)                  GO TO BRANCH STATEMENT                    
*                                                                               
         L     RF,0(RF)            ELSE GO TO THAT ADDRESS                      
         A     RF,RELORGEN         RELOCATE ADDRESS                             
         BASR  RE,RF                                                            
         B     XIT                                                              
*                                                                               
BRANCH   DS    0A                                                               
         B     VUSERVAL            VALIDATE USER ID                             
         B     VREG                         REGION                              
         B     VOFF                VALIDATE OFFICE                              
         DC    A(VPDT)                      PERIOD DATES - FLIGHT               
         B     VGRPSUB                      GROUP/SUBGRP                        
         DC    A(VSTA)                      STATION CALL LETTERS                
         DC    A(0)                                                             
         B     VSAL                VALIDATE SALESPERSON                         
         B     VDT                          DIVISION/TEAM                       
         B     VADV                         ADVERTISER                          
         B     VAGY                         AGENCY                              
         DC    A(0)                                                             
         DC    A(0)                                                             
         B     VPRD                         PRODUCT                             
         DC    A(0)                                                             
*        B     VTRACE              TRACE DATA BLOCK                             
         DC    A(0)                                                             
*                                                                               
         B     VWRIUSER                                                         
         DC    A(0)                                                             
         DC    A(VVALOPTS)                  OPTIONS                             
         B     VVALTITS                                                         
         DC    3A(0)                                                            
*                                                                               
         B     VVALLEFT                                                         
         B     VVALRGHT                                                         
         B     VVALMID                                                          
         B     VVALROWS            ROWS                                         
         B     VVALCOLS                                                         
         DC    3A(0)                                                            
*                                                                               
         DC    A(0)                                                             
         B     VINTDRON                                                         
         B     VVRWDRON                                                         
         B     VGRWDRON                                                         
         B     VVCLDRON                                                         
         B     VGCLDRON                                                         
         B     VVCMDRON                                                         
         B     VGCMDRON                                                         
         B     VVUSDRON                                                         
         DC    3A(0)                                                            
         B     VWRPDRON                                                         
*                                                                               
         DC    7A(0)                                                            
         B     VNUMERIC                                                         
         B     VPACK                                                            
         DC    3A(0)                                                            
         B     VCURSERR                                                         
         B     VERRXIT                                                          
         DC    3A(0)                                                            
BRMAX    EQU   *                                                                
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VUSERVAL'                   
***********************************************************************         
*                                                                     *         
*        VALIDATE USER ID                                             *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VUSERVAL DS    0H                  VALIDATE USER ID                             
*                                                                               
         GOTO1 CALLOV,DMCB,X'02000000',0,0   STACK BUFFER                       
*                                                                               
         L     RF,DMCB             GET BUFFER ADDRESS                           
         LA    RF,8(RF)            BYPASS LABEL                                 
         ST    RF,ASTACKBF         SAVE BUFFER ADDRESS                          
*                                                                               
         XC    KEY,KEY             ESTABLISH REP RECORD KEY                     
         LA    R4,KEY                                                           
         USING RREPKEY,R4                                                       
*                                                                               
         MVI   RREPKTYP,RREPKTYQ   RECORD TYPE                                  
         MVC   RREPKREP,AGENCY     AGENCY                                       
         MVC   REQREP,AGENCY       SAVE REQUESTING REP                          
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RREPKEY,KEYSAVE     MUST FIND RECORD                             
         BNE   VUSRREPE                                                         
*                                                                               
         L     R4,AIO1             READ IN RECORD                               
         ST    R4,AIO                                                           
*                                                                               
         GOTO1 GETREC                                                           
*                                                                               
         MVC   REREP,RREPKREP      SAVE SIGN-ON REP                             
*                                                                               
         MVI   ELCODE,01           FIND HEADER ELEMENT                          
         BAS   RE,GETEL                                                         
         BNE   VUSRREPE            MUST FIND ELEMENT                            
*                                                                               
         USING RREPELEM,R4         ESTABLISH REP HEADER ELEMENT                 
*                                                                               
         MVC   USERNAME,RREPNAME   SAVE NAME AND ADDRESS                        
         MVC   USERADDR,RREPADDR                                                
*                                                                               
         XC    REMREP,REMREP       INIT MASTER REP ID                           
*                                                                               
         CLC   REREP,=C'NU'        IF REP NU                                    
         BNE   *+14                                                             
         MVC   REMREP,=C'K3'          ASSUME K3 IS MASTER REP                   
         B     VUSRMRPX                                                         
*                                                                               
         OC    RREPMAST,RREPMAST   IF THERE IS A MASTER REP                     
         BZ    VUSRMRPX            NO                                           
         CLC   RREPMAST,SPACES                                                  
         BE    VUSRMRPX            NO                                           
         CLC   RREPMAST,=X'FFFF'                                                
         BE    VUSRMRPX            NO                                           
         MVC   REMREP,RREPMAST        SAVE IT                                   
*                                                                               
VUSRMRPX DS    0H                                                               
*                                                                               
         MVC   REREPPRF,RREPPROF   SAVE REP PROFILE                             
*                                                                               
*        INIT VLBLOCK FOR DDVAL                                                 
*                                                                               
         L     R5,AVLPARMS         ESTABLISH DDVAL BLOCK                        
         USING VLPARMS,R5                                                       
*                                                                               
         XC    VLBLOCK(VLBLOCKL),VLBLOCK CLEAR BLOCK                            
         MVC   VLACFACS,ACOMFACS   A(COMFACS)                                   
         MVC   VLCTRY,CTRY         SET COUNTRY CODE                             
         MVC   VLLANG,LANG         LANGUAGE CODE                                
         MVC   VLAGENCY,AGENCY     AGENCY                                       
         MVI   VLSYSTEM,VLSYSREQ                                                
*                                                                               
         GOTO1 DATCON,DMCB,(3,BTODAY),(2,VLTODAYC)                              
*                                                                               
*        ADD REP RECORD TYPE TO REDATA LIST                                     
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RREPKTYQ',0),RR=RELORGEN                       
*                                                                               
         MVI   READCNTL,0          INIT CONTROL BYTES                           
         MVI   REAGCNTL,0                                                       
         MVI   REPRCNTL,0                                                       
*                                                                               
         XC    RERRGWRC(256),RERRGWRC   INIT RRGWRI CONTROL BLOCK               
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF OFFLINE                              
         BE    VUSERX                                                           
*                                                                               
         CLC   =C'TEST',CONREC    RECORD=TEST ONLY FOR DDS TERMINALS            
         BNE   *+12                                                             
         CLI   DDS,C'Y'               MUST BE DDS TERMINAL                      
         BNE   VUSRDDSE                                                         
*                                                                               
VUSERX   DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VUSRDDSE DS    0H                  DDS ONLY FUNCTION                            
         LA    R2,CONRECH          CURSOR AT RECORD FIELD                       
         MVI   FIELDERR,0          FIRST FIELD                                  
         MVI   ERROR,RWEDDS                                                     
         B     VUSRERR                                                          
*                                                                               
VUSRREPE DS    0H                  REP NOT FOUND                                
         MVI   ERROR,RWEREPNF                                                   
         B     VUSRERR                                                          
*                                                                               
VUSRERR  DS    0H                                                               
         GOTO1 CURSERR                                                          
         XIT1                                                                   
*                                                                               
         DROP  R4                                                               
         DROP  R5                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VREG'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE REGION                                                        
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VREG     DS    0H                                                               
*                                                                               
         XC    REFREG,REFREG       INIT SAVEAREA                                
*                                                                               
         CLI   5(R2),0             INPUT NOT REQUIRED                           
         BE    VREGX                                                            
*                                                                               
         CLI   5(R2),L'RREGKREG    REGION CODE LENGTH CHECK                     
         BH    VREGLNE                                                          
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VREGX                                                            
*                                                                               
         XC    KEY,KEY             ESTABLISH REGION KEY                         
         LA    R4,KEY                                                           
         USING RREGKEY,R4                                                       
*                                                                               
         MVI   RREGKTYP,RREGKTYQ   RECORD TYPE                                  
         MVC   RREGKREP,AGENCY     AGENCY                                       
         MVC   RREGKREG,8(R2)      REGION CODE                                  
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RREGKEY,KEYSAVE     MUST FIND RECORD                             
         BNE   VREGNFE                                                          
*                                                                               
         MVC   REFREG,RREGKREG     SAVE REGION CODE                             
*                                                                               
         OI    REQTABLE,REQOFRG    INDICATE REGION PART OF REQUEST              
*                                                                               
*        ADD REGION RECORD TYPE TO REDATA LIST                                  
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RREGKTYQ',0),RR=RELORGEN                       
*                                                                               
VREGX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VREGNVE  DS    0H                  REGION NOT VALID                             
         MVI   ERROR,RWEREGNV                                                   
         B     VREGERR                                                          
*                                                                               
VREGNFE  DS    0H                  REGION NOT FOUND                             
         MVI   ERROR,RWEREGNF                                                   
         B     VREGERR                                                          
*                                                                               
VREGLNE  DS    0H                  REGION TOO LARGE                             
         MVI   ERROR,RWEREGLN                                                   
         B     VREGERR                                                          
*                                                                               
VREGERR  DS    0H                                                               
         GOTO1 CURSERR                                                          
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VOFF'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE OFFICE                                                        
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VOFF     DS    0H                                                               
*                                                                               
         XC    REFOFF,REFOFF       INIT OFFICE SAVEAREA                         
*                                                                               
         CLI   5(R2),0             ENTRY NOT REQUIRED                           
         BE    VOFFSEC                                                          
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VOFFSEC                                                          
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          IF SET RECORD ID                             
         BNE   VOFFSETN                                                         
*                                                                               
         GOTO1 =A(SETVAL),DUB,=C'OF',=AL1(ROFFKTYQ),                   X        
               RR=RELORGEN            VALIDATE SET ID                           
*                                                                               
         OC    WORK(4),WORK           ERROR IF NO ID RETURNED                   
         BZ    VOFFSETE                                                         
*                                                                               
         MVC   REOFFSID,WORK          SAVE OFFICE SET ID                        
*                                                                               
*        SET REQUESTABLE ONLY BY AUTHORIZED USERS                               
*                                                                               
         B     VOFFSEC                GO CHECK SECURITY                         
*                                  IF ACCESS RESTRICTED THEN SET ID             
*                                  WILL GENERATE ERROR.                         
*                                  WE ASSUME SET HAS AT LEAST 2 OFFICES         
*                                  AND THUS MUST BE ILLEGAL                     
*                                                                               
VOFFSETN DS    0H                                                               
*                                                                               
*        FIND OFFICE RECORD                                                     
*                                                                               
         CLI   5(R2),L'ROFFKOFF    CHECK FOR INPUT TOO LONG                     
         BH    VOFFLNE                                                          
*                                                                               
         XC    KEY,KEY             ESTABLISH OFFICE KEY                         
         LA    R4,KEY                                                           
         USING ROFFKEY,R4                                                       
*                                                                               
         MVI   ROFFKTYP,ROFFKTYQ   RECORD ID                                    
         MVC   ROFFKREP,AGENCY     AGENCY                                       
         MVC   ROFFKOFF,8(R2)      OFFICE ID                                    
         OC    ROFFKOFF(2),SPACES    CONVERT X'00' TO BLANKS                    
*                                                                               
         GOTO1 HIGH                READ FOR DIRECTORY POINTER                   
*                                                                               
         CLC   ROFFKEY,KEYSAVE     MUST FIND POINTER                            
         BNE   VOFFNFE                                                          
*                                                                               
*        OFFICE SECURITY CHECK                                                  
*                                                                               
VOFFSEC  DS    0H                                                               
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF OFF-LINE                             
         BE    VOFFSECX                                                         
*                                                                               
         CLC   =C'O=',TWAACCS      TEST FOR OFFICE LIMITED ACCESS               
         BNE   VOFFSECX                                                         
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL                                 
         BE    VOFFSECX             YES                                         
*                                                                               
         TM    REREQPRF+1,X'40'    SKIP IF NO OFFICE ACCESS RESTRICTION         
         BNO   VOFFSECX                                                         
*                                                                               
         TM    TWAAUTH,X'80'       TERMINAL HAS ACCESS TO ALL OFFICES?          
         BO    VOFFSECX             YES                                         
*                                                                               
         CLC   8(2,R2),TWAACCS+2    NO, MUST MATCH RESTRICTED OFFICE            
         BNE   VOFFSECE                                                         
*                                                                               
VOFFSECX DS    0H                                                               
*                                                                               
         OI    REFTYPS2,REFTOFFQ   INDICATE FILTERING ON OFFICE                 
*                                                                               
         CLI   8(R2),C'*'          OKAY IF SET OF OFFICES                       
         BE    VOFFOK                                                           
         CLI   5(R2),0             OKAY IF ALL OFFICES WANTED                   
         BE    *+10                                                             
         CLC   =C'ALL',8(R2)                                                    
         BE    VOFFOK                                                           
*                                                                               
         MVC   REFOFF,8(R2)        SAVE OFFICE CODE                             
*                                                                               
VOFFOK   DS    0H                                                               
*                                                                               
*        ADD OFFICE RECORD TYPE TO REDATA LIST                                  
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('ROFFKTYQ',0),RR=RELORGEN                       
*                                                                               
VOFFX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VOFFNVE  DS    0H                  OFFICE CODE NOT VALID                        
         MVI   ERROR,RWEOFFNV                                                   
         B     VOFFERR                                                          
*                                                                               
VOFFNFE  DS    0H                  OFFICE NOT FOUND                             
         MVI   ERROR,RWEOFFNF                                                   
         B     VOFFERR                                                          
*                                                                               
VOFFLNE  DS    0H                  OFFICE CODE TOO LONG                         
         MVI   ERROR,RWEOFFLN                                                   
         B     VOFFERR                                                          
*                                                                               
VOFFSECE DS    0H                  SECURITY LOCKOUT                             
         MVI   ERROR,RWEOFFLK                                                   
         B     VOFFERR                                                          
*                                                                               
VOFFSETE DS    0H                  OFFICE SET RECORD NOT FOUND                  
         MVI   ERROR,RWEOFSNF                                                   
         B     VOFFERR                                                          
*                                                                               
VOFFERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VGRPSUB'                    
***********************************************************************         
*                                                                     *         
*        VALIDATE GROUP/SUBGROUP ENTRY                                *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A GRP/SGRP CODE                                     *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VGRPSUB  DS    0H                                                               
*                                                                               
         XC    REFGRPSB,REFGRPSB   INIT GRP/SGRP          SAVEAREA              
         XC    REGRPSID,REGRPSID   INIT GRP/SGRP SET ID   SAVEAREA              
*                                                                               
         CLI   5(R2),0             OKAY IF THERE IS NO ENTRY                    
         BE    VGRPSUBX                                                         
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VGRPSUBX                                                         
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          IF SET RECORD ID                             
         BNE   VGSBSETN                                                         
*                                                                               
         GOTO1 =A(SETVAL),DUB,=C'GS',=AL1(RGRPKTYQ),                   X        
               RR=RELORGEN            VALIDATE SET ID                           
*                                                                               
         OC    WORK(4),WORK           ERROR IF NO ID RETURNED                   
         BZ    VGSBSETE                                                         
*                                                                               
         MVC   REGRPSID,WORK          SAVE GRP SET ID                           
*                                                                               
         B     VGSBOK                 SET ID IS OKAY                            
*                                                                               
VGSBSETN DS    0H                                                               
*                                                                               
         XC    KEY,KEY             ESTABLISH GRP/SBGRP KEY                      
         LA    R4,KEY                                                           
         USING RGRPKEY,R4                                                       
*                                                                               
         MVI   RGRPKTYP,RGRPKTYQ   RECORD TYPE                                  
         MVC   RGRPKREP,AGENCY     AGENCY                                       
*                                                                               
         MVC   RGRPKGRP,SPACES     INIT KEY FIELD                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,5(R2)          ENTRY LENGTH                                 
         BZ    *+10                SKIP IF NO ENTRY                             
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RGRPKGRP(0),8(R2)   GRP/SBGRP ID                                 
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
*                                  KEY MUST MATCH ON GROUP CODE                 
         CLC   RGRPKEY(RGRPKGRP+1-RGRPKEY),KEYSAVE                              
         BNE   VGSBGRPE            GROUP NOT FOUND                              
*                                                                               
         MVC   REFGRP,8(R2)        SAVE GROUP CODE                              
*                                                                               
         CLI   5(R2),1             SKIP IF ONLY GROUP SPECIFIED                 
         BE    VGSBSUBX                                                         
*                                                                               
         CLC   RGRPKEY,KEYSAVE     ELSE WE MUST HAVE EXACT MATCH                
         BNE   VGSBSUBE                                                         
*                                                                               
         MVC   REFGRPSB,8(R2)         SAVE GRP/SUBGRP                           
*                                                                               
VGSBSUBX DS    0H                                                               
*                                                                               
VGSBOK   DS    0H                                                               
*                                                                               
*        ADD GROUP RECORD TYPE TO REDATA LIST                                   
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RGRPKTYQ',0),RR=RELORGEN                       
*                                                                               
VGRPSUBX DS    0H                                                               
         XIT1                                                                   
*                                                                               
VGSBGRPE DS    0H                  GROUP NOT FOUND                              
*                                                                               
         MVI   ERROR,RWEGRPNF                                                   
         B     VGSBERR                                                          
*                                                                               
VGSBSUBE DS    0H                  SUBGROUP NOT FOUND                           
*                                                                               
         MVI   ERROR,RWESUBNF                                                   
         B     VGSBERR                                                          
*                                                                               
VGSBSETE DS    0H                  GROUP/SUBGROUP SET ID NOT FOUND              
*                                                                               
         MVI   ERROR,RWEGSSNF                                                   
         B     VGSBERR                                                          
*                                                                               
VGSBERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VSAL'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE SALESPERSON ENTRY                                   *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A SALESPERSON CODE                                  *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VSAL     DS    0H                                                               
*                                                                               
         XC    REFSAL,REFSAL       INIT SAVEAREA                                
*                                                                               
         CLI   5(R2),0             ENTRY NOT REQUIRED                           
         BE    VSALX                                                            
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VSALX                                                            
*                                                                               
         CLI   8(R2),C'='          BROWSE REQUEST?                              
         BNE   VSALBRWX                                                         
*                                                                               
         GOTOX (RFBROWSE,VREPFACS),DMCB,ACOMFACS,SYSRD,(R2),           X        
               0,(0,C' SAL'),0                                                  
         DC    H'0'           BROWSE SHOULD HAVE TAKEN IT FROM HERE             
*                                                                               
VSALBRWX DS    0H                                                               
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          IF SET RECORD ID                             
         BNE   VSALSETN                                                         
*                                                                               
         GOTO1 =A(SETVAL),DUB,=C'SP',=AL1(RSALKTYQ),                   X        
               RR=RELORGEN            VALIDATE SET ID                           
*                                                                               
         OC    WORK(4),WORK           ERROR IF NO ID RETURNED                   
         BZ    VSALSETE                                                         
*                                                                               
         OI    REFTYPS1,REFTSALQ      INDICATE FILTERING ON SALESPERSON         
         MVC   RESALSID,WORK          SAVE SALESPERSON SET ID                   
*                                                                               
*        SETS ALLOWED ONLY FOR AUTHORIZED                                       
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF OFFLINE                              
         BE    VSALSSCX                                                         
*                                                                               
         CLC   =C'O=',TWAACCS      TEST FOR OFFICE LIMITED ACCESS               
         BNE   VSALSSCX                                                         
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL                                 
         BE    VSALSSCX             YES                                         
*                                                                               
         TM    REREQPRF+1,X'40'    SKIP IF NO OFFICE ACCESS RESTRICTION         
         BNO   VSALSSCX                                                         
*                                                                               
         TM    TWAAUTH,X'80'       TERMINAL HAS ACCESS TO ALL OFFICES?          
         BO    VSALSSCX             YES                                         
*                                                                               
*        SECURITY ALL SALES PEOPLE MUST BE FOR USER'S OFFICE                    
*                                                                               
         MVC   AIO,REAIO3          READ SET RECORD INTO IOA3                    
*                                                                               
         GOTO1 GETREC              GET SET RECORD - FOUND BY SETVAL             
*                                                                               
         MVC   AIO,REAIO1          RESTORE TO REACING INTO IOA1                 
*                                                                               
         L     R4,REAIO3           POINT TO SET RECORD                          
         MVI   ELCODE,RSETMCDQ     FIND MEMBERS ELEMENT                         
         BRAS  RE,GETEL                                                         
         BNE   VSALSSCX            ELEMENT NOT FOUND                            
*                                                                               
         USING RSETMEMD,R4         ESTABLISH MEMBERS ELEMENT                    
*                                                                               
         SR    RF,RF                                                            
         IC    RF,RSETMELN         GET ELEMENT LENGTH                           
         LA    RF,RSETMEMD(RF)     POINT TO END OF ELEMENT                      
*                                                                               
         LA    RE,RSETMEMB         POINT TO START OF MEMBERS                    
*                                                                               
         SR    RF,RE               LENGTH OF MEMBERS AREA                       
*                                                                               
         SR    R1,R1                                                            
         ICM   R1,1,RSETMLEN       GET LENGTH OF EACH MEMBER                    
         BZ    VSALSSCX            ZERO LENGTH                                  
*                                                                               
         SR    RE,RE                                                            
*                                                                               
         DR    RE,R1               GET NUMBER OF ELEMENTS                       
*                                                                               
         LTR   R0,RF               SAVE NUMBER OF ELEMENTS                      
         BZ    VSALSSCX            NONE                                         
         LA    R3,RSETMEMB         POINT TO FIRST MEMBER OF SET                 
*                                                                               
VSALSCLP DS    0H                                                               
*                                                                               
*        READ SALESPERSON RECORD FOR MEMBER                                     
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RSALKEY,R4          ESTABLISH SALESPERSON KEY                    
*                                                                               
         MVI   RSALKTYP,RSALKTYQ   RECORD ID                                    
         MVC   RSALKREP,AGENCY     AGENCY                                       
         MVC   RSALKSAL,0(R3)      SALESPERSON CODE                             
         OC    RSALKSAL,SPACES                                                  
*                                                                               
         GOTO1 HIGH                READ FOR FILE POINTER                        
*                                                                               
         CLC   KEY(27),KEYSAVE                                                  
         BNE   VSALNFE                                                          
*                                                                               
         GOTO1 GETREC              READ RECORD                                  
*                                                                               
         L     R4,AIO              POINT TO FOUND RECORD                        
*                                                                               
         MVI   ELCODE,01                                                        
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING RSALELEM,R4         ESTABLISH HEADER ELEMENT                     
*                                                                               
         CLC   RSALOFF,TWAACCS+2   SALESPERSON MUST BE IN OFFICE                
         BNE   VSALOFFE                                                         
*                                                                               
VSALSCCN DS    0H                                                               
*                                                                               
         LA    R3,L'RSALKSAL(R3)   BUMP TO NEXT MEMBER IN SET                   
         BCT   R0,VSALSCLP                                                      
*                                                                               
VSALSCDN DS    0H                  ALL SALESPEOPLE IN SET ARE FOR OFC           
*                                                                               
         OI    REFTYPS1,REFTSALQ   INDICATE FILTERING ON SALESPERSON            
*                                                                               
VSALSSCX DS    0H                                                               
*                                                                               
         B     VSALOK                 SET ID IS OKAY                            
*                                                                               
VSALSETN DS    0H                                                               
*                                                                               
*        FIND SALESPERSON RECORD                                                
*                                                                               
         CLI   5(R2),L'RSALKSAL    CHECK FOR INPUT TOO LONG                     
         BH    VOFFNVE                                                          
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RSALKEY,R4          ESTABLISH SALESPERSON KEY                    
*                                                                               
         MVI   RSALKTYP,RSALKTYQ   RECORD ID                                    
         MVC   RSALKREP,AGENCY     AGENCY                                       
         MVC   RSALKSAL,8(R2)      SALESPERSON CODE                             
         OC    RSALKSAL,SPACES                                                  
*                                                                               
         GOTO1 HIGH                READ FOR FILE POINTER                        
*                                                                               
         CLC   KEY(27),KEYSAVE                                                  
         BNE   VSALNFE                                                          
*                                                                               
VSALSEC  DS    0H                                                               
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF OFFLINE                              
         BE    VSALSECX                                                         
*                                                                               
         CLC   =C'O=',TWAACCS      TEST FOR OFFICE LIMITED ACCESS               
         BNE   VSALSECX                                                         
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL                                 
         BE    VSALSECX             YES                                         
*                                                                               
         TM    REREQPRF+1,X'40'    SKIP IF NO OFFICE ACCESS RESTRICTION         
         BNO   VSALSECX                                                         
*                                                                               
         TM    TWAAUTH,X'80'       TERMINAL HAS ACCESS TO ALL OFFICES?          
         BO    VSALSECX             YES                                         
*                                                                               
*        SECURITY ALL SALES PEOPLE MUST BE FOR USER'S OFFICE                    
*                                                                               
*                                                                               
*        READ SALESPERSON RECORD FOR OFFICE                                     
*                                                                               
         L     R4,AIO1                                                          
         ST    R4,AIO                                                           
*                                                                               
         GOTO1 GETREC              READ RECORD                                  
*                                                                               
         MVI   ELCODE,01                                                        
         BAS   RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING RSALELEM,R4         ESTABLISH HEADER ELEMENT                     
*                                                                               
         CLC   RSALOFF,TWAACCS+2   SALESPERSON MUST BE IN OFFICE                
         BNE   VSALOFFE                                                         
*                                                                               
VSALSECX DS    0H                                                               
*                                                                               
VSALOFFX DS    0H                                                               
*                                                                               
         MVC   REFSAL,8(R2)        SAVE SALESPERSON'S CODE                      
         OC    REFSAL,SPACES       SPACE FILL                                   
         OI    REFTYPS1,REFTSALQ   INDICATE FILTERING ON SALESPERSON            
*                                                                               
VSALOK   DS    0H                                                               
*                                                                               
*        ADD SALESPERSON RECORD TYPE TO REDATA LIST                             
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RSALKTYQ',0),RR=RELORGEN                       
*                                                                               
VSALX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VSALNVE  DS    0H                  SALESPERSON'S CODE INVALID                   
         MVI   ERROR,RWESALNV                                                   
         B     VSALERR                                                          
*                                                                               
VSALNFE  DS    0H                  SALESPERSON NOT FOUND                        
         MVI   ERROR,RWESALNF                                                   
         B     VSALERR                                                          
*                                                                               
VSALSETE DS    0H                  SALESPERSON SET NOT FOUND                    
         MVI   ERROR,RWESPSNF                                                   
         B     VSALERR                                                          
*                                                                               
VSALOFFE DS    0H                  SALESPERSON NOT ASSIGNED TO OFFICE           
         MVI   ERROR,RWESPOFF                                                   
         B     VSALERR                                                          
*                                                                               
VSALERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VDT'                        
***********************************************************************         
*                                                                     *         
*        VALIDATE DIVISION/TEAM                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VDT      DS    0H                                                               
*                                                                               
         XC    REFTEM,REFTEM       INIT SAVEAREA                                
*                                                                               
         CLI   5(R2),0             ENTRY IS NOT REQUIRED                        
         BE    VDTX                                                             
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VDTX                                                             
*                                                                               
         CLI   5(R2),L'RTEMKTEM    CHECK FOR INPUT TOO LONG                     
         BH    VDTNVE                                                           
*                                                                               
         XC    KEY,KEY             ESTABLISH DIVISION/TEAM KEY                  
         LA    R4,KEY                                                           
         USING RTEMKEY,R4                                                       
*                                                                               
         MVI   RTEMKTYP,RTEMKTYQ   RECORD ID                                    
         MVC   RTEMKREP,AGENCY     AGENCY                                       
         MVC   RTEMKTEM,8(R2)      DIVISION/TEAM ID                             
*                                                                               
         GOTO1 HIGH                READ FOR FILE POINTER                        
*                                                                               
         CLC   RTEMKEY(RTEMKTEM+1-RTEMKEY),KEYSAVE  DIVISION MUST MATCH         
         BNE   VDTDVNFE                                                         
*                                                                               
         CLI   5(R2),1             SKIP IF ONLY DIVISION ENTERED                
         BH    *+14                                                             
         MVC   REFDIV,8(R2)        SAVE DIVISION CODE                           
         B     VDTTMX                                                           
*                                                                               
         CLC   RTEMKEY(RTEMKTEM+2-RTEMKEY),KEYSAVE  TEAM MUST MATCH             
         BNE   VDTTMNFE                                                         
*                                                                               
         MVC   REFTEM,8(R2)        SAVE DIV/TEAM CODE                           
*                                                                               
VDTTMX   DS    0H                                                               
*                                                                               
         OI    REFTYPS2,REFTTEMQ   INDICATE FILTERING ON DIV/TEM                
*                                                                               
*        ADD DIVISION RECORD TYPE TO REDATA LIST                                
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RTEMKTYQ',0),RR=RELORGEN                       
*                                                                               
VDTX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VDTNVE   DS    0H                  DIVISION/TEAM CODE NOT VALID                 
         MVI   ERROR,RWEDTMNV                                                   
         B     VDTERR                                                           
*                                                                               
VDTDVNFE DS    0H                  DIVISION                                     
         MVI   ERROR,RWEDIVNF                                                   
         B     VDTERR                                                           
*                                                                               
VDTTMNFE DS    0H                  TEAM NOT FOUND                               
         MVI   ERROR,RWETMNF                                                    
         B     VDTERR                                                           
*                                                                               
VDTERR   DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VADV'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE ADVERTISER                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VADV     DS    0H                                                               
*                                                                               
         XC    REFADV,REFADV       INIT SAVEAREA                                
*                                                                               
         CLI   5(R2),0             INPUT NOT REQUIRED                           
         BE    VADVX                                                            
*                                                                               
         CLI   5(R2),3             IF ENTRY IS 3 LONG                           
         BNE   *+14                                                             
         CLC   =C'ALL',8(R2)          'ALL' IS VALID ENTRY                      
         BE    VADVX                                                            
*                                                                               
         CLI   8(R2),C'='          BROWSE REQUEST?                              
         BNE   VADVBRWX                                                         
*                                                                               
         GOTOX (RFBROWSE,VREPFACS),DMCB,ACOMFACS,SYSRD,(R2),           X        
               0,(0,C' ADV'),0                                                  
         DC    H'0'           BROWSE SHOULD HAVE TAKEN IT FROM HERE             
*                                                                               
VADVBRWX DS    0H                                                               
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          IF SET RECORD ID                             
         BNE   VADVSETN                                                         
*                                                                               
         GOTO1 =A(SETVAL),DUB,=C'AD',=AL1(RADVKTYQ),                   X        
               RR=RELORGEN            VALIDATE SET ID                           
*                                                                               
         OC    WORK(4),WORK           ERROR IF NO ID RETURNED                   
         BZ    VADVSETE                                                         
*                                                                               
         MVC   READVSID,WORK          SAVE ADVERTISER SET ID                    
******   OI    READCNTL,READCFTQ   INDICATE FILTERING ON ADV                    
*                                                                               
         B     VADVOK                 SET ID IS OKAY                            
*                                                                               
VADVSETN DS    0H                                                               
*                                                                               
*        FIND ADVERTISER RECORD                                                 
*                                                                               
         CLI   5(R2),L'RADVKADV    CHECK FOR INPUT TOO LONG                     
         BH    VADVLNE                                                          
*                                                                               
         XC    KEY,KEY             ESTABLISH ADVERTISER KEY                     
         LA    R4,KEY                                                           
         USING RADVKEY,R4                                                       
*                                                                               
         MVI   RADVKTYP,RADVKTYQ   RECORD TYPE                                  
         MVC   RADVKREP,AGENCY     AGENCY                                       
         MVC   RADVKADV,8(R2)      ADVERTISER CODE                              
         OC    RADVKADV,SPACES     SPACE FILL                                   
*                                                                               
         GOTO1 HIGH                READ DIRECTORY POINTER                       
*                                                                               
         CLC   RADVKEY,KEYSAVE     MUST FIND RECORD                             
         BNE   VADVNFE                                                          
*                                                                               
         MVC   REFADV,RADVKADV     SAVE ADVERTISER CODE                         
******   OI    READCNTL,READCFTQ   INDICATE FILTERING ON ADV                    
*                                                                               
VADVOK   DS    0H                                                               
*                                                                               
*        ADD ADVERTISER RECORD TYPE TO REDATA LIST                              
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RADVKTYQ',0),RR=RELORGEN                       
*                                                                               
VADVX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VADVNVE  DS    0H                  ADVERTISER CODE NOT VALID                    
         MVI   ERROR,RWEADVNV                                                   
         B     VADVERR                                                          
*                                                                               
VADVNFE  DS    0H                  ADVERTISER NOT FOUND                         
         MVI   ERROR,RWEADVNF                                                   
         B     VADVERR                                                          
*                                                                               
VADVLNE  DS    0H                  ADVERTISER CODE TOO LARGE                    
         MVI   ERROR,RWEADVLN                                                   
         B     VADVERR                                                          
*                                                                               
VADVSETE DS    0H                  ADVERTISER SET NOT FOUND                     
         MVI   ERROR,RWEADSNF                                                   
         B     VADVERR                                                          
*                                                                               
VADVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VAGY'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE AGENCY AND AGENCY OFFICE CODE                       *         
*                                                                     *         
*        MAY NEED TO CHECK OFFICE CODE IN KEY                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VAGY     DS    0H                                                               
*                                                                               
         XC    REFAGY,REFAGY       INIT AGENCY        SAVEAREA                  
         XC    REFAOF,REFAOF       INIT AGENCY OFFICE SAVEAREA                  
         XC    REFTER,REFTER       INIT TERRITORY     SAVEAREA                  
*                                                                               
         CLI   5(R2),0             ENTRY NOT REQUIRED                           
         BE    VAGYX                                                            
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VAGYX                                                            
*                                                                               
         CLI   8(R2),C'='          BROWSE REQUEST?                              
         BNE   VAGYBRWX                                                         
*                                                                               
         GOTOX (RFBROWSE,VREPFACS),DMCB,ACOMFACS,SYSRD,(R2),           X        
               0,(0,C' AGY'),0                                                  
         DC    H'0'           BROWSE SHOULD HAVE TAKEN IT FROM HERE             
*                                                                               
VAGYBRWX DS    0H                                                               
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          IF SET RECORD ID                             
         BNE   VAGYSETN                                                         
*                                                                               
         GOTO1 =A(SETVAL),DUB,=C'AG',=AL1(RAGYKTYQ),                   X        
               RR=RELORGEN            VALIDATE SET ID                           
*                                                                               
         OC    WORK(4),WORK           ERROR IF NO ID RETURNED                   
         BZ    VAGYSETE                                                         
*                                                                               
         MVC   REAGYSID,WORK          SAVE AGENCY SET ID                        
*                                                                               
         B     VAGYOK                 SET ID IS OKAY                            
*                                                                               
VAGYSETN DS    0H                                                               
*                                                                               
*        EXAMINE INPUT FOR SPECIAL CHARACTERS                                   
*        FORMATS                                                                
*              AAA-OO      AGENCY-OFFICE                                        
*              T(ERR)=TT   TERRITORY CODE                                       
*                                                                               
         SR    R0,R0                                                            
         IC    R0,5(R2)            INPUT LENGTH                                 
         LA    R1,8(,R2)           START OF AGENCY CODE                         
         SR    RF,RF                                                            
*                                                                               
VAGYLOOP DS    0H                                                               
*                                                                               
         CLI   0(R1),C'-'          AGENCY CODE ENDS AT DASH                     
         BE    VAGYAGFD                                                         
         CLI   0(R1),C'='          TERRITORY TITLE ENDS AT EQUAL SIGN           
         BE    VAGYTRFD                                                         
*                                                                               
VAGYCONT DS    0H                                                               
*                                                                               
         LA    R1,1(,R1)                                                        
         BCT   R0,VAGYLOOP                                                      
*                                                                               
VAGYAGFD DS    0H                                                               
*                                                                               
         LR    RF,R1               COPY END OF CODE POINTER                     
         LA    RE,8(R2)            POINT TO START OF FIELD                      
*                                                                               
         SR    RF,RE               LENGTH OF AGENCY CODE                        
         BZ    VAGYMSE             CODE MISSING                                 
*                                                                               
         CLM   RF,1,=AL1(L'RAGYKAGY)  CHECK ON MAX LENGTH                       
         BH    VAGYLNE             TOO BIG                                      
*                                                                               
         MVC   REFAGY,SPACES       INIT AGENCY CODE                             
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFAGY(0),8(R2)     SAVE AGENCY CODE                             
*                                                                               
         MVC   REFAOF,SPACES       INIT AGENCY OFFICE CODE                      
*                                                                               
         LTR   R0,R0               SKIP IF END OF INPUT REACHED                 
         BZ    VAGYOFX             NO OFFICE SPECIFIED                          
*                                                                               
*        GET AGENCY OFFICE CODE                                                 
*                                                                               
         LA    R1,1(R1)            BYPASS DASH                                  
         BCT   R0,*+8              RECTIFY LENGTH COUNTER                       
         B     VAGYOMSE            AGENCY OFFICE CODE MISSING                   
*                                                                               
         LR    RF,R0               COPY OFFICE CODE LENGTH                      
         CLM   RF,1,=AL1(L'RAGYKAOF)  CHECK MAX LENGTH                          
         BH    VAGYOLNE                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFAOF(0),0(R1)     SAVE AGENCY OFFICE CODE                      
*                                                                               
VAGYOFX  DS    0H                                                               
*                                                                               
*        READ AGENCY RECORD                                                     
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RAGYKEY,R4          ESTABLISH AGENCY RECORD KEY                  
*                                                                               
         MVI   RAGYKTYP,RAGYKTYQ   RECORD TYPE                                  
         MVC   RAGYKAGY,REFAGY     AGENCY CODE                                  
         MVC   RAGYKAOF,REFAOF     AGENCY OFFICE CODE                           
         MVC   RAGYKREP,AGENCY     REP                                          
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RAGYKEY,KEYSAVE     MUST FIND RECORD                             
         BNE   VAGYNFE                                                          
*                                                                               
         CLC   REFAOF,SPACES       IF NO OFFICE REQUESTED                       
         BNE   *+10                                                             
         XC    REFAOF,REFAOF          CLEAR SAVEAREA                            
*                                                                               
VAGYAGYX DS    0H                                                               
         B     VAGYOK                                                           
*                                                                               
*        VALIDATE TERRITORY CODE                                                
*                                                                               
VAGYTRFD DS    0H                                                               
*                                                                               
         LR    RF,R1               COPY END OF CODE POINTER                     
         LA    RE,8(R2)            POINT TO START OF FIELD                      
*                                                                               
         SR    RF,RE               LENGTH OF TITLE                              
         BZ    VAGYTLME                TITLE MISSING                            
*                                                                               
         CLM   RF,1,=AL1(9)        CHECK ON MAX TITLE LENGTH                    
         BH    VAGYTLLE                TOO BIG                                  
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   8(0,R2),=C'TERRITORY'   VERIFY TITLE                             
         BNE   VAGYTLVE                                                         
*                                                                               
         MVC   REFTER,SPACES       INIT TERRITORY CODE                          
*                                                                               
         LTR   R0,R0               SKIP IF END OF INPUT REACHED                 
         BZ    VAGYTRME            NO TERRITORY SPECIFIED                       
*                                                                               
*        GET TERRITORY CODE                                                     
*                                                                               
         LA    R1,1(R1)            BYPASS DASH                                  
         BCT   R0,*+8              RECTIFY LENGTH COUNTER                       
         B     VAGYTRME            TERRITORY CODE MISSING                       
*                                                                               
         LR    RF,R0               COPY OFFICE CODE LENGTH                      
         CLM   RF,1,=AL1(L'RTERKTER)  CHECK MAX LENGTH                          
         BH    VAGYTRVE                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFTER(0),0(R1)     SAVE TERRITORY CODE                          
*                                                                               
*        READ TERRITORY POINTER                                                 
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RTERKEY,R4          ESTABLISH TERRITORY RECORD KEY               
*                                                                               
         MVI   RTERKTYP,RTERKTYQ   RECORD TYPE                                  
         MVC   RTERKREP,AGENCY     REP                                          
         MVC   RTERKTER,REFTER     TERRITORY CODE                               
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RTERKEY,KEYSAVE     MUST FIND RECORD                             
         BNE   VAGYTRFE                                                         
*                                                                               
*        ADD TERRITORY RECORD TYPE TO REDATA LIST                               
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RTERKTYQ',0),RR=RELORGEN                       
*                                                                               
         OI    REFTYPS2,REFTRTYQ      INDICATE TERR CODE NEEDED                 
*****    OI    REAGCNTL,REAGCSRQ      SET TO FILL AGY TABLE                     
*                                                                               
VAGYTERX DS    0H                                                               
*                                                                               
VAGYOK   DS    0H                                                               
*                                                                               
*        ADD AGENCY RECORD TYPE TO REDATA LIST                                  
*                                                                               
         GOTOR TBLLST,DMCB,('RAG2KTYQ',0)                                       
*                                                                               
VAGYX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VAGYSETE DS    0H                  AGENCY SET RECORD NOT VALID                  
         MVI   ERROR,RWEAGSNF                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYNVE  DS    0H                  AGENCY CODE NOT VALID                        
         MVI   ERROR,RWEAGYNV                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYNFE  DS    0H                  AGENCY NOT FOUND                             
         MVI   ERROR,RWEAGYNF                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYMSE  DS    0H                  AGENCY CODE MISSING                          
         MVI   ERROR,RWEAGYMS                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYLNE  DS    0H                  AGENCY CODE TOO LARGE                        
         MVI   ERROR,RWEAGYLN                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYONVE DS    0H                  AGENCY OFFICE CODE NOT VALID                 
         MVI   ERROR,RWEAOFNV                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYOFFE DS    0H                  AGENCY OFFICE NOT FOUND                      
         MVI   ERROR,RWEAOFNF                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYOMSE DS   0H                   AGENCY OFFICE CODE MISSING                   
         MVI   ERROR,RWEAOFMS                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYOLNE DS    0H                  AGENCY OFFICE CODE TOO LARGE                 
         MVI   ERROR,RWEAOFLN                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTLVE DS    0H                  FILTER CODE NOT VALID                        
         MVI   ERROR,RWEFLTNV                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTLLE DS    0H                  FILTER CODE TOO LARGE                        
         MVI   ERROR,RWEFLTLN                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTLME DS    0H                  FILTER CODE TITLE REQUIRED                   
         MVI   ERROR,RWEFLTMS                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTRVE DS    0H                  TERRITORITY NOT VALID                        
         MVI   ERROR,RWETERNV                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTRLE DS    0H                  TERRITORY CODE TOO LARGE                     
         MVI   ERROR,RWETERLN                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTRME DS   0H                   TERRITORY CODE MISSING                       
         MVI   ERROR,RWETERMS                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYTRFE DS    0H                  TERRITORY CODE NOT FOUND                     
         MVI   ERROR,RWETERNF                                                   
         B     VAGYERR                                                          
*                                                                               
VAGYERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         SPACE                                                                  
         DROP  R4                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VPRD'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE PRODUCT                                             *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VPRD     DS    0H                                                               
*                                                                               
         XC    REFPRD,REFPRD       INIT SAVEAREA                                
*                                                                               
         CLI   5(R2),0             INPUT NOT REQUIRED                           
         BE    VPRDX                                                            
*                                                                               
         CLC   =C'ALL',8(R2)       'ALL' IS VALID ENTRY                         
         BE    VPRDX                                                            
*                                                                               
         CLC   REFADV,SPACES       ADVERTISER REQUIRED                          
         JNH   VPRDAMSE                                                         
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RPRDKEY,R4          ESTABLISH PRODUCT RECORD KEY                 
*                                                                               
         MVI   RPRDKTYP,RPRDKTYQ   RECORD TYPE                                  
         MVC   RPRDKADV,REFADV     ADVERTISER                                   
*                                                                               
         MVC   RPRDKPRD,SPACES     INIT PRODUCT                                 
*                                                                               
         SR    RF,RF                                                            
         IC    RF,5(R2)            GET INPUT LENGTH                             
         CLM   RF,1,=AL1(L'RPRDKPRD) LENGTH CHECK                               
         JH    VPRDLNE                                                          
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RPRDKPRD(0),8(R2)      PRODUCT                                   
*                                                                               
         MVC   RPRDKREP,AGENCY     REP                                          
*                                                                               
         GOTO1 HIGH                READ RECORD POINTER                          
*                                                                               
         CLC   RPRDKEY,KEYSAVE     MUST FIND RECORD                             
         JNE   VPRDNFE                                                          
*                                                                               
         MVC   REFPRD,RPRDKPRD     SAVE PRODUCT CODE                            
         OI    REFTYPS1,REFTPRDQ   FILTERING ON PRODUCT                         
*                                                                               
*        ADD PRODUCT RECORD TYPE TO REDATA LIST                                 
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RPRDKTYQ',0),RR=RELORGEN                       
*                                                                               
VPRDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VPRDNFE  DS    0H                  PRODUCT NOT FOUND                            
         MVI   ERROR,RWEPRDNF                                                   
         J     VPRDERR                                                          
*                                                                               
VPRDLNE  DS    0H                  PRODUCT CODE TOO BIG                         
         MVI   ERROR,RWEPRDLN                                                   
         J     VPRDERR                                                          
*                                                                               
VPRDAMSE DS    0H                  ADVERTISER REQUIRED                          
         MVI   ERROR,RWEADVMS                                                   
         J     VPRDERR                                                          
*                                                                               
VPRDERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP  R4                                                               
*                                                                               
         EJECT                                                                  
*              USER ID RECORD                                                   
         SPACE 2                                                                
VWRIUSER L     R1,SYSPARMS                                                      
*        MVC   AGENCY,0(R1)                                                     
         MVC   AGYSIGN,SPACES                                                   
         XC    AGYALPHA,AGYALPHA                                                
*                                  AGENCY NAME & ADDRESS FROM ID REC.           
         MVC   FILENAME,=CL8'CTFILE'                                            
         MVI   USEIO,C'Y'                                                       
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING CTIKEY,R4                                                        
         MVI   CTIKTYP,C'I'                                                     
         MVC   CTIKID+8(2),10(RA)                                               
         MVI   RDUPDATE,C'N'                                                    
         GOTO1 READ                                                             
         L     R4,AIO                                                           
         LA    R4,CTIDATA                                                       
         SR    R3,R3                                                            
         SPACE                                                                  
VUSER10  CLI   0(R4),0                                                          
         BE    VUSER30                                                          
         CLI   0(R4),X'02'                                                      
         BE    VUSER24                                                          
         CLI   0(R4),X'06'                                                      
         BE    VUSER26                                                          
         CLI   0(R4),X'21'                                                      
         BE    VUSER28                                                          
         SPACE                                                                  
VUSER16  IC    R3,1(R4)                                                         
         AR    R4,R3                                                            
         B     VUSER10                                                          
         SPACE                                                                  
         USING CTDSCD,R4                                                        
VUSER24  MVC   AGYSIGN,CTDSC                                                    
         B     VUSER16                                                          
         SPACE                                                                  
         USING CTAGYD,R4                                                        
VUSER26  MVC   AGYALPHA,CTAGYID                                                 
         B     VUSER16                                                          
         SPACE                                                                  
         USING CTSYSD,R4                                                        
VUSER28  CLI   CTSYSNUM,8          THIS ONE'S FOR REPPAK                        
         BNE   VUSER16                                                          
         OC    TWAACCS(2),TWAACCS  ACCESS                                       
         BNZ   *+10                                                             
         MVC   TWAACCS,CTSYSLMT                                                 
         B     VUSER16                                                          
         SPACE                                                                  
VUSER30  XC    FILENAME,FILENAME                                                
         MVI   USEIO,0                                                          
         LA    R4,FACTWRK                                                       
         GOTO1 GETFACT,DMCB,(R4)                                                
         B     XIT                                                              
         EJECT                                                                  
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VVALTITS'                   
***********************************************************************         
*                                                                     *         
*        VALIDATE TITLE                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALTITS DS    0H                                                               
*                                                                               
         MVC   TITLE,SPACES        INIT TITLE TO SPACES                         
         MVC   TITLE(20),=C'REPPAK REPORT WRITER'  DEFAULT TITLE                
*                                                                               
         CLI   5(R2),0             SKIP IF NO TITLE ENTERED                     
         BE    VTL02                                                            
*                                                                               
         GOTO1 ANY                 READ TITLE INTO WORK                         
         MVC   TITLE,WORK          CAPTURE TITLE                                
*                                                                               
VTL02    DS    0H                                                               
*                                                                               
         CLI   NARROPT,C'Y'        SKIP IF A NARROW REPORT                      
         BE    VTLCNTR1                                                         
*                                                                               
         GOTO1 CENTER,DMCB,TITLE,64    CENTER TITLE IN TITLE SAVEAREA           
*                                                                               
         BE    VTLCNTRX                                                         
*                                                                               
VTLCNTR1 DS    0H                                                               
*                                  NAROOW TITLE SHORTER                         
         GOTO1 CENTER,DMCB,TITLE,40    CENTER TITLE IN TITLE SAVEAREA           
*                                                                               
VTLCNTRX DS    0H                                                               
*                                                                               
VVALTITX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VVALLEFT'                   
***********************************************************************         
*                                                                     *         
*        VALIDATE LEFT HAND HEADERS                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALLEFT DS    0H                                                               
*                                                                               
         ST    R2,RELHEADA         SAVE ADDRESS OF FIRST                        
*                                                                               
         MVI   ROWWIDTH,0          NOT CHECKING REPORT WIDTH YET                
         XC    TOTWIDTH,TOTWIDTH                                                
*                                                                               
         MVI   MAX,4               MAXIMUM 4 HEADERS                            
*                                                                               
         BAS   RE,DELINS           CHECK FOR DELETING/INSERTING KEYWORD         
*                                                                               
         LA    R3,4                MAX 4 FIELDS                                 
         LA    R4,4                (START ON HEADLINE 4)                        
*                                                                               
         CLI   REQRP2SW,0          SKIP IF DOING A SECOND REPORT                
         BNE   *+8                                                              
         MVI   KEYWORD#,0          INIT KEYWORD COUNTER                         
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),RKVHEAD    SET FOR HEADLINE FILTER           
*                                                                               
VLFLOOP  DS    0H                                                               
*                                                                               
         CLI   5(R2),0                                                          
         BE    VLFCONT                                                          
*                                                                               
         MVI   MYPOSO,C'H'         INDICATE THIS IS A HEADLINE                  
         STC   R4,MYPOSO+1         SET HEADLINE FOR PRINTING                    
         MVI   MYPOSO+2,2          START PRINTING IN (COLUMN 2)                 
         STC   R4,LASTHEAD                                                      
*                                                                               
         ZIC   RF,KEYWORD#         BUMP KEYWORD COUNTER                         
         LA    RF,1(RF)                                                         
         STC   RF,KEYWORD#                                                      
*                                                                               
         GOTO1 =A(VALROW),RR=RELORGEN VALIDATE AS A ROW                         
*                                                                               
         LA    R4,1(R4)            BUMP LINE FOR PRINTING                       
*                                                                               
VLFCONT  DS    0H                                                               
*                                                                               
         BAS   RE,BUMP             BUMP TO NEXT LEFT HEADER KEYWORD             
         BCT   R3,VLFLOOP                                                       
*                                                                               
VLFDONE  DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),0          RESET FILTER                      
*                                                                               
         LA    R4,2(R4)            BUMP TO NEXT LINE FOR PRINTING               
*                                                                               
         CH    R4,=H'8'            LAST AVAILABLE LINE IS 8                     
         BH    *+8                                                              
         LA    R4,8                                                             
*                                                                               
         STC   R4,MYFIRSTH         SAVE LINE FOR START OF COLUMN TITLES         
*                                                                               
VVALLEFX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VVALRGHT'                   
***********************************************************************         
*                                                                     *         
*        VALIDATE RIGHT HAND HEADERS                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALRGHT DS    0H                                                               
*                                                                               
         ST    R2,RERHEADA         SAVE ADDRESS OF FIRST                        
*                                                                               
         MVI   ROWWIDTH,0          NOT CHECKING REPORT WIDTH YET                
         XC    TOTWIDTH,TOTWIDTH                                                
*                                                                               
         LA    R3,3                MAX 3 FIELDS                                 
         LA    R4,6                (START ON HEAD 6)                            
         MVI   MAX,3                                                            
*                                                                               
         BAS   RE,DELINS           CHECK FOR DELETE/INSERT OF KEYWORDS          
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),RKVHEAD    SET FOR HEADLINE FILTER           
*                                                                               
VRGLOOP  DS    0H                                                               
*                                                                               
         CLI   5(R2),0             SKIP IF FIELD IS EMPTY                       
         BE    VRGCONT                                                          
*                                                                               
         MVI   MYPOSO,C'H'         SET AS HEADLINE                              
         STC   R4,MYPOSO+1         SET HEADLINE NUMBER                          
         MVI   MYPOSO+2,99         START IN COLUMN 99                           
*                                                                               
         CLI   NARROPT,C'Y'        (NOT ALLOWED FOR NARROW)                     
         BE    VRGNARE                                                          
*                                                                               
         CLI   WIDEOPT,C'Y'                                                     
         BNE   *+8                                                              
         MVI   MYPOSO+2,132        (COLUMN 132 FOR WIDE)                        
*                                                                               
         ZIC   RF,KEYWORD#         BUMP KEYWORD COUNTER                         
         LA    RF,1(RF)                                                         
         STC   RF,KEYWORD#                                                      
*                                                                               
         GOTO1 =A(VALROW),RR=RELORGEN VALIDATE AS A ROW                         
*                                                                               
         LA    R4,1(R4)            BUMP LINE FOR PRINTING                       
*                                                                               
VRGCONT  DS    0H                                                               
*                                                                               
         BAS   RE,BUMP             BUMP TO NEXT RIGHT HEADER                    
         BCT   R3,VRGLOOP                                                       
*                                                                               
VRGDONE  DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),0          RESET FILTER                      
*                                                                               
         LA    R4,2(R4)            NEXT AVAILABLE LINE FOR PRINTING             
*                                                                               
         CH    R4,=H'8'            MUST NOT EXCEED 8TH HEADLINE                 
         BH    *+8                                                              
         LA    R4,8                                                             
*                                                                               
         SR    R3,R3               SAVE AS START OF COLUMN TITLES               
         IC    R3,MYFIRSTH         IF IT IS LARGER THAN THAT FOR LEFT           
         CR    R4,R3               HEADERS                                      
         BL    *+8                                                              
         STC   R4,MYFIRSTH                                                      
*                                                                               
VVALRGHX DS    0H                                                               
         XIT1                                                                   
*                                                                               
VRGNARE  DS    0H                  NOT VALID FOR NARROW REPORT                  
         MVI   FIELDERR,0          CURSOR TO START OF FIELD                     
         MVI   ERROR,RWENARE                                                    
*                                                                               
VRGERR   DS    0H                                                               
                                                                                
         GOTO1 CURSERR                                                          
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VVALMID'                    
***********************************************************************         
*                                                                     *         
*        VALIDATE MIDLINE                                             *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALMID  DS    0H                                                               
*                                                                               
         ST    R2,REMIDA           SAVE ADDRESS OF FIRST                        
*                                                                               
         MVI   ROWMIDSW,0          INIT ROW/MIDLINE SWITCH                      
*                                                                               
         MVI   ROWWIDTH,0          NOT CHECKING REPORT WIDTH YET                
         XC    TOTWIDTH,TOTWIDTH                                                
*                                                                               
         MVI   MAX,1               MAX ONE FIELD                                
*                                                                               
         MVI   MYPOSO,C'M'         SET AS MIDLINE                               
         MVI   MYPOSO+1,1          SET AS FIRST MIDLINE                         
         MVI   MYPOSO+2,1          START PRINTING IN COLUMN 1                   
*                                                                               
         ZIC   RF,KEYWORD#         BUMP KEYWORD COUNTER                         
         LA    RF,1(RF)                                                         
         STC   RF,KEYWORD#                                                      
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),RKVMID     SET FOR MIDLINE FILTER            
*                                                                               
         GOTO1 =A(VALROW),RR=RELORGEN VALIDATE AS A ROW                         
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),0          RESET FILTER                      
*                                                                               
VVALMIDX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         TITLE 'PRWRIGEN - VALIDATE ROWS - VALROWS'                             
***********************************************************************         
*                                                                     *         
*        VALIDATE ROWS                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALROWS DS    0H                                                               
*                                                                               
         ST    R2,REROWA           SAVE ADDRESS OF FIRST                        
*                                                                               
         MVI   TOTWIDTH+1,1        START CHECKING REPORT WIDTH NOW              
         MVI   ROWWIDTH,1          START CHECKING REPORT WIDTH NOW              
*                                                                               
         CLI   XBOXSW,C'Y'                                                      
         BNE   *+12                                                             
         MVI   TOTWIDTH+1,2        BOXES WAS REQUESTED                          
         MVI   XBOXSW,0                                                         
*                                                                               
         ZIC   R3,MAX              GET MAX NUMBER OF ROWS                       
         LTR   R3,R3                                                            
         BNZ   *+12                                                             
         LA    R3,8                DEFAULT IS 6                                 
         STC   R3,MAX                                                           
*                                                                               
         BAS   RE,DELINS           CHECK FOR INSERTING OR DELETING FLDS         
*                                                                               
*        LOOP TO VALIDATE ROWS                                                  
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),RKVROW     SET FOR ROW      FILTER           
*                                                                               
VVRWLOOP DS    0H                                                               
*                                                                               
         XC    MYPOSO,MYPOSO                                                    
*                                                                               
         SR    RF,RF                                                            
         IC    RF,KEYWORD#         BUMP KEYWORD COUNTER                         
         LA    RF,1(RF)                                                         
         STC   RF,KEYWORD#                                                      
*                                                                               
         GOTO1 =A(VALROW),RR=RELORGEN VALIDATE FIELD AS A ROW                   
*                                                                               
VVRWCONT DS    0H                                                               
*                                                                               
         BAS   RE,BUMP             BUMP TO NEXT FIELD                           
*                                                                               
         BCT   R3,VVRWLOOP                                                      
*                                                                               
VVRWDONE DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),0          RESET FILTER                      
*                                                                               
         ZIC   R4,LASTHEAD                                                      
         LA    R4,3(R4)                                                         
         CH    R4,=H'9'                                                         
         BH    *+8                                                              
         LA    R4,9                                                             
*                                                                               
         CLI   REQRP2SW,0          IF DOING A SECOND REPORT                     
         BE    VVR22                                                            
*                                                                               
         CLM   R4,1,MYFIRSTH          UPDATE ONLY IF LARGER                     
         BNH   VVR23                                                            
*                                                                               
VVR22    DS    0H                                                               
*                                                                               
         STC   R4,MYFIRSTH                                                      
*                                                                               
VVR23    DS    0H                                                               
*                                                                               
         TM    SORTIND,SORTFLDQ    MUST HAVE A SORT FIELD IN REQUEST            
         BNO   VVRSORTE                                                         
*                                                                               
         TM    ROWMIDSW,RMIDFNDQ   MUST HAVE ROW OR COLUMN IN REQUEST           
         BNO   VVRRMIDE                                                         
*                                                                               
*        IF RGON REPORT VALIDATE DATATYPES COMBO                                
*                                                                               
VVRRRG   DS    0H                                                               
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   VVRRRGX                                                          
*                                                                               
*        LOAD RGON MODULE                                                       
*                                                                               
         GOTO1 CALLOV,DMCB,X'10000000',0,0   RGON INTERFACE                     
*                                                                               
         CLI   4(R1),X'FF'         MAKE SURE MODULE FOUND                       
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   RENRGWRA,0(R1)      SAVE MODULE'S ADDRESS                        
*                                                                               
         LA    R5,RERRGWRC         ESTABLISH RGON CONTROL BLOCK                 
         USING RRGWRI,R5                                                        
*                                                                               
         MVC   RRGWID,=CL8'**WRIT**'   IDENTIFY CALLER                          
         MVC   RRGWREP,AGENCY      SET REP CODE                                 
*                                                                               
         MVC   RRGWSTDT,REYMSTRP   REQUEST START DATE                           
         MVC   RRGWEDDT,REYMENDP   REQUEST END   DATE                           
*                                                                               
         MVC   RRGWOFFL,OFFLINE    PASS OFFLINE SWITCH                          
*                                                                               
         MVC   RRGWADAY,ADDAY       SET RRGWCONS                                
         MVC   RRGWCALL,CALLOV                                                  
         MVC   RRGWDMGR,DATAMGR                                                 
         MVC   RRGWDATC,DATCON                                                  
         MVC   RRGWHEXO,HEXOUT                                                  
         MVC   RRGWCOMF,ACOMFACS                                                
*                                                                               
         MVI   RRGWCNTL,RRGWVALQ   SET TO VALIDATE                              
*                                                                               
         GOTO1 RENRGWRA,DMCB,RRGWRI                                             
*                                                                               
         CLI   RRGWERR,0           CHECK FOR ERRORS                             
         BNE   VVALRRGE                                                         
*                                                                               
VVRRRGX  DS    0H                                                               
*                                                                               
VVALROWX DS    0H                                                               
         B     XIT                                                              
*                                                                               
VVALRRGE DS    0H                  RGON VALIDATION ERROR                        
*                                                                               
         MVI   ERROR,0             JUST IN CASE ITS SET                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,RRGWERR        TRANSLATE TO WRITER ERROR CODES              
         BCTR  RF,0                DECREMENT FOR INDEXING                       
         SLL   RF,1                *2 FOR INDEX                                 
         LA    R1,RRGEMSGS(RF)     POINT TO WRITER ERROR NUMBER                 
*                                                                               
         MVC   RERROR,0(R1)                                                     
         MVI   FIELDERR,0                                                       
         L     R2,RELHEADA         PUT CURSOR AT FIRST HEADLINE                 
*                                                                               
         GOTO1 CURSERR                                                          
*                                                                               
*        RRGWRI TRANSLATION TABLE FOR ERROR MESSAGES                            
*                                                                               
RRGEMSGS DC    AL2(301,302,303,304,305,306,307,308,309,310)                     
         DC    AL2(311,312,313,314,315,316,317)                                 
*                                                                               
VVRSORTE DS    0H                  NO SORT FIELD IN REQUEST                     
*                                                                               
         MVI   ERROR,RWESORT       SET ERROR NUMBER                             
         MVI   FIELDERR,0                                                       
         L     R2,RELHEADA         PUT CURSOR AT FIRST HEADLINE                 
*                                                                               
         B     VVRERR                                                           
*                                                                               
VVRRMIDE DS    0H                  NEITHER ROW NOR MIDLINE IN REQUEST           
*                                                                               
         LHI   RF,RWERWMID                                                      
         STCM  RF,3,RERROR                                                      
         L     R2,REMIDA           PUT CURSOR AT MID-LINE                       
         MVI   FIELDERR,0          PUT CURSOR AT START OF FIELD                 
*                                                                               
VVRERR   DS    0H                                                               
*                                                                               
         GOTO1 CURSERR                                                          
*                                                                               
         TITLE 'PRWRIGEN - VALIDATE ROWS - VVALCOLS'                            
***********************************************************************         
*                                                                     *         
*        VALIDATE COLUMNS                                             *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALCOLS DS    0H                                                               
*                                                                               
         ST    R2,RECOLA           SAVE ADDRESS OF FIRST                        
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,MAX            GET MAX COLUMNS ALLOWED                      
         BZ    VVALCOLX            SKIP IF NONE WANTED                          
*                                                                               
         CLI   5(R2),0                                                          
         BE    VVCLND1E            NEED AT LEAST 1 COLUMN                       
*                                                                               
         BAS   RE,DELINS           CHECK FOR DELETES/INSERT                     
*                                                                               
         MVI   MYLABEL,C'A'        SET LABEL FOR FIRST COLUMN                   
         ST    R2,ALASTCOL         SAVE POINTER TO CURRENT COLUMN               
*                                                                               
         BAS   RE,SETMAX           SET LAST COLUMN FOR COMPUTE                  
*                                                                               
         LA    R3,EDITLIST         INIT EDITLIST POINTER                        
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),RKVCOL     SET FOR COLUMN   FILTER           
*                                                                               
VVCLLOOP DS    0H                                                               
*                                                                               
         XC    MYPOSO,MYPOSO       INIT PRINT POSITION                          
*                                                                               
         MVC   0(1,R3),MYLABEL     SAVE LABEL IN EDIT LIST                      
*                                                                               
         SR    RF,RF                                                            
         IC    RF,KEYWORD#         BUMP KEYWORD COUNTER                         
         LA    RF,1(RF)                                                         
         STC   RF,KEYWORD#                                                      
*                                                                               
         GOTO1 =A(VALCOL),RR=RELORGEN VALIDATE COLUMN KEYWORD                   
*                                                                               
VVCLCONT DS    0H                                                               
*                                                                               
         LA    R3,4(R3)            BUMP EDITLIST POINTER                        
         BAS   RE,BUMP             BUMP TO NEXT COLUMN LABEL                    
*                                                                               
         MVC   MYLABEL,8(R2)       SAVE FIELD LABEL                             
*                                                                               
         BAS   RE,BUMP             BUMP TO NEXT COLUMN                          
*                                                                               
         BCT   R0,VVCLLOOP         PROCESS NEXT COLMUN                          
*                                                                               
VVCLDONE DS    0H                                                               
*                                                                               
*        CHECK ON GLOBAL RESTRICTIONS                                           
*                                                                               
*        SOON/RGON REPORT MUST BE FOR 1 STATION IF ADV/AGY                      
*              REPORTED                                                         
*                                                                               
         CLC   =C'SOON',CONWHEN    OKAY IF NOT SOON                             
         BNE   VVCLRRGX                                                         
         CLI   REFLAVOR,C'R'       OKAY IF NOT RGON REPORT                      
         BNE   VVCLRRGX                                                         
         CLC   REFSTA,SPACES       OKAY IF SINGLE STATION REQUESTED             
         BH    VVCLRRGX                                                         
*                                                                               
*        ERROR IF AGENCY OR ADVERTISER KEYWORD IN REPORT                        
*                                                                               
         LA    R1,REDATA           LIST OF RECORD TYPES NEED FOR REPORT         
         LA    R0,L'REDATA         MAX LENGTH OF LIST                           
*                                                                               
VVCLRRGL DS    0H                                                               
*                                                                               
         CLI   0(R1),0             OKAY IF  END OF LIST REACHED                 
         BE    VVCLRRGD                                                         
*                                                                               
         CLI   0(R1),RAGYKTYQ      AGENCY KEYWORD                               
         BE    VVCLRRGF                                                         
         CLI   0(R1),RADVKTYQ      ADVERTISER KEYWORD                           
         BE    VVCLRRGF                                                         
*                                                                               
VVCLRRGC DS    0H                                                               
*                                                                               
         LA    R1,1(R1)            BUMP LIST POINTER                            
         BCT   R0,VVCLRRGL                                                      
*                                                                               
VVCLRRGD DS    0H                                                               
*                                                                               
         B     VVCLRRGX            NOT IN LIST - OKAY                           
*                                                                               
VVCLRRGF DS    0H                  ERROR - SINGLE STATION REQUIRED              
*                                                                               
         B     VVCLSNAE                                                         
*                                                                               
VVCLRRGX DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT5V-VLPARMS(R1),0          RESET FILTER                      
*                                                                               
         CLI   STACKLST,0          IF LAST STACK COLUMN GIVEN                   
         BE    *+14                                                             
         CLC   CLASTLBL,STACKLST      LAST ENTERED COLUMN MUST BE               
         BL    VVCLSTKE               ON OR AFTER LAST STACK COL                
*                                                                               
         CLC   TOTWIDTH,=H'80'     CHECK NOT TOO BIG NOW                        
         BNH   VVCLSIZX                                                         
*                                                                               
         CLI   NARROPT,C'Y'        ONLY 80 ALLOWED WITH NARROW OPT              
         BE    VVCLBIGE                                                         
*                                                                               
         CLC   TOTWIDTH,=H'132'    CHECK NOT TOO BIG NOW                        
         BNH   VVCLSIZX                                                         
*                                                                               
         CLI   WIDEOPT,C'Y'        CHECK FOR WIDE OPTION                        
         BE    *+8                                                              
         CLI   DOWNOPT,C'Y'          OR DOWN OPTION                             
         BNE   VVCLBIGE                                                         
*                                                                               
         CLC   TOTWIDTH,=H'165'                                                 
         BNH   VVCLSIZX                                                         
*                                                                               
         CLI   DOWNOPT,C'Y'        DOWN OPTION                                  
         BNE   VVCLBIGE                                                         
*                                                                               
         CLC   TOTWIDTH,=H'255'                                                 
         BNH   VVCLSIZX                                                         
*                                                                               
         B     VVCLBIGE                                                         
*                                                                               
VVCLSIZX DS    0H                                                               
*                                                                               
VVALCOLX DS    0H                                                               
         XIT1                                                                   
*                                                                               
VVCLBIGE DS    0H                  REPORT IS TOO WIDE                           
*                                                                               
         MVC   CONHEAD(36),=C'REPORT HAS NNN CHARACTERS - TOO WIDE'             
         LA    R3,CONHEAD+11                                                    
         EDIT  (2,TOTWIDTH),(3,(R3))                                            
*                                                                               
         L     R2,ALASTCOL         CURSOR TO LAST COLUMN KEYWORD                
         MVI   ERROR,X'FE'         MESSAGE ALREADY SET                          
         GOTO1 ERRXIT                                                           
*                                                                               
VVCLND1E DS     0H                 NEED AT LEAST ONE COLUMN                     
         MVI   ERROR,RWENEEDC                                                   
         B     VVCLERR                                                          
*                                                                               
VVCLSTKE DS     0H                 NEED AT LEAST ONE COLUMN                     
         MVI   ERROR,RWESTKE1      STACK RANGE LARGER THAN ENTERED COLS         
         B     VVCLERR                                                          
*                                                                               
VVCLSNAE DS     0H                 ONE STATION ONLY                             
         MVI   ERROR,RWESNAGY      LIMITED TO SINGLE STATION                    
         LA    R2,RESTAA           POINT TO STATION FIELD                       
         B     VVCLERR                                                          
*                                                                               
VVCLERR  DS    0H                                                               
         GOTO1 CURSERR                                                          
*                                                                               
         TITLE 'PRWRIGEN - VALIDATE ROWS - SETMAX'                              
***********************************************************************         
*                                                                     *         
*        ROUTINE TO FIND MAXIMUM NUMBER OF COLUMNS REQUESTED          *         
*                                                                     *         
*NTRY    R2==> FIRST COLUMN ON SCREEN                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
SETMAX   NTR1                                                                   
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,MAX            GET MAX COLUMNS ALLOWED                      
         BZ    SETMAXX             SKIP IF NONE WANTED                          
*                                                                               
         MVI   BYTE,C'A'           INIT LAST COLUMN LABEL                       
*                                                                               
SETMAXLP DS    0H                                                               
*                                                                               
         CLI   5(R2),0             DONE IF FIELD HAS NO DATA                    
         BE    SETMAXDN                                                         
*                                                                               
         MVC   DRCMPMAX,BYTE       UPDATE LABEL OF LAST COLUMN                  
*                                     AVAILABLE FOR COMPUTES                    
SETMAXCN DS    0H                                                               
*                                                                               
         BAS   RE,BUMP             BUMP TO NEXT LABEL FIELD                     
         MVC   BYTE,8(R2)          SAVE LABEL                                   
         BAS   RE,BUMP             BUMP TO NEXT COLUMN                          
         BCT   R0,SETMAXLP                                                      
*                                                                               
SETMAXDN DS    0H                                                               
*                                                                               
SETMAXX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         EJECT                                                                  
*              DRONE UTILITIES                                                  
         SPACE 3                                                                
VINTDRON DS    0H                  INITIALIZATION                               
         MVI   DRWHO,DRREPWHO                                                   
         MVI   DRACTION,DRINIT                                                  
         MVC   DRDICT,=CL8'RENWR '                                              
         MVC   DRALTDIC,=CL8'DRIVER'                                            
         MVC   DRCOMFAC,ACOMFACS                                                
         MVC   DRMAXWID,=H'999'    FORCE BIG - I CHECK WIDTH                    
         GOTO1 DRONE,DMCB,DRGEN                                                 
         B     XIT                                                              
*                                                                               
VVRWDRON DS    0H                  VALIDATE A ROW                               
         MVI   DRACTION,DRROW                                                   
         B     ALLVAL                                                           
         SPACE                                                                  
VGRWDRON DS    0H                  GENERATE A ROW                               
         MVI   DRACTION,DRGENROW                                                
         B     ALLDRONE                                                         
         SPACE                                                                  
VVCLDRON DS    0H                  VALIDATE A COLUMN                            
         MVI   DRACTION,DRCOL                                                   
         B     ALLVAL                                                           
         SPACE                                                                  
VGCLDRON DS    0H                  GENERATE A COLUMN                            
         MVI   DRACTION,DRGENCOL                                                
         B     ALLDRONE                                                         
         SPACE                                                                  
VVCMDRON DS    0H                  VALIDATE A COMP                              
         MVI   DRACTION,DRCMP                                                   
         B     ALLVAL                                                           
         SPACE                                                                  
VGCMDRON DS    0H                  GENERATE A COMP                              
         MVI   DRACTION,DRGENCMP                                                
         B     ALLVAL              (LOOKS LIKE A VALIDATION)                    
*                                                                               
VWRPDRON DS    0H                  WRAP UP                                      
*                                                                               
         MVI   DRACTION,DRWRAPUP                                                
*                                                                               
         GOTO1 DRONE,DMCB,DRGEN                                                 
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE                                   
         BNE   VWRPDRNX                                                         
*                                                                               
         GOTO1 TRACDRON               (OPTIONAL TRACE)                          
*                                                                               
VWRPDRNX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         TITLE 'PRWRIGEN - VALIDATE ROWS - VVUSDRON'                            
***********************************************************************         
*                                                                     *         
*        VALIDATE USER RECORD                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVUSDRON DS    0H                  VALIDATE USER RECORD                         
*                                                                               
         MVI   DRACTION,DRUSER                                                  
         MVC   DRUSRKEY(2),AGYALPHA         KEY IS AGENCY                       
         MVC   DRUSRKEY+2(8),22(R4)                AND USER CODE                
*                                                                               
         GOTO1 DRONE,DMCB,DRGEN                                                 
*                                                                               
         CLI   DRERROR,0                                                        
         BNE   VVUSRNVE                                                         
*                                                                               
         TM    DROPTSO,DRBKMINO    IF BRACKET=M SPECIFIED                       
         BNO   VVUSERX                                                          
*                                                                               
         NI    DROPTSO,X'FF'-X'20'    DON'T NEED MINUS=YES                      
*                                                                               
         CLI   DRFLOATO,C'-'                                                    
         BNE   *+8                                                              
         MVI   DRFLOATO,0                OR FLOAT=-                             
*                                                                               
VVUSERX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VVUSRNVE DS     0H                                                              
         MVI   ERROR,RWEUSNV       USER NOT VALID                               
         B     VVUSRERR                                                         
*                                                                               
VVUSRERR DS    0H                                                               
         GOTO1 CURSERR                                                          
*                                                                               
         EJECT                                                                  
*              MORE DRONE UTILITIES                                             
         SPACE 3                                                                
ALLVAL   XC    WORK,WORK           GENERATE A PSEUDO TWA HEADER                 
         MVC   WORK+5(1),0(R4)     (PASS THROUGH THE LENGTH)                    
         MVC   WORK+8(30),12(R4)                                                
         LA    R1,WORK                                                          
         ST    R1,DRACCFLD                                                      
         OI    DRFLAGS,DREXPDIC    TELL DRONE TO EXPLODE DICT.                  
         GOTO1 DRONE,DMCB,DRGEN                                                 
         B     XIT                                                              
         SPACE                                                                  
ALLDRONE GOTO1 DRONE,DMCB,DRGEN                                                 
         B     XIT                 USER NEEDS TO TEST DRERROR                   
         SPACE                                                                  
BADDRONE MVC   CONHEAD,DRERRMSG    ERROR - SO SHOW WHAT DRONE PASSED            
         B     MYCURSOR                                                         
*                                                                               
         EJECT                                                                  
*              OTHER DATA HANDLING ROUTINES                                     
         SPACE 3                                                                
VNUMERIC TM    4(R2),X'08'                                                      
         BO    VPACK                                                            
         MVI   ERROR,3                                                          
         B     VCURSERR                                                         
         SPACE                                                                  
VPACK    SR    R3,R3                                                            
         IC    R3,5(R2)                                                         
         SR    R1,R1                                                            
         ZAP   DUB,=P'0'                                                        
         LTR   R3,R3                                                            
         BZ    XITR1                                                            
         BCTR  R3,R0                                                            
         EX    R3,*+8                                                           
         B     *+10                                                             
         PACK  DUB,8(0,R2)                                                      
         CVB   R1,DUB                                                           
         SPACE                                                                  
ITSFINE  SR    R1,R1                                                            
         B     *+8                                                              
         SPACE                                                                  
NOGOOD   LA    R1,1                                                             
         LTR   R1,R1                                                            
         SPACE                                                                  
XITR1    XIT1  REGS=(R1)                                                        
         EJECT                                                                  
*              INSERT DELETE UNPROTECTED FIELDS                                 
         SPACE 3                                                                
*              INPUT               R2=A(FIRST UNPROTECTED FIELD)                
*                                  MAX=NUMBER OF INPUT FIELDS                   
         SPACE                                                                  
DELINS   NTR1                                                                   
         CLI   OFFLINE,C'Y'                                                     
         BE    XIT                                                              
         CLI   PFAID,3             WAS PF3 OR PF4 HIT                           
         BE    DI2                                                              
         CLI   PFAID,4                                                          
         BE    DI2                                                              
         CLI   PFAID,15            PF15 PF16 EQUIVALENT                         
         BE    DI2                                                              
         CLI   PFAID,16                                                         
         BNE   XIT                                                              
         SPACE                                                                  
DI2      L     R4,ATIOB                                                         
         USING TIOBD,R4                                                         
         LH    R4,TIOBCURD         PICK UP RELATIVE DISPLACEMENT                
         AR    R4,RA               INTO TWA                                     
         ZIC   R0,MAX                                                           
         SPACE                                                                  
DI4      CR    R2,R4                                                            
         BE    DI6                                                              
         BAS   RE,BUMPTOUN                                                      
         BCT   R0,DI4                                                           
         B     XIT                 (NOT IN THIS PART OF THE SCREEN)             
         SPACE                                                                  
DI6      CLI   PFAID,3                                                          
         BE    DEL2                                                             
         CLI   PFAID,15                                                         
         BE    DEL2                                                             
         XC    BLOCK(80),BLOCK                                                  
         SPACE                                                                  
INS2     MVC   BLOCK+80(80),8(R2)  SAVE THIS FIELD                              
         ZIC   R1,0(R2)            GET L'FIELD-1 INTO R1                        
         SH    R1,=H'9'                                                         
         TM    1(R2),X'02'                                                      
         BNO   *+8                                                              
         SH    R1,=H'8'                                                         
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R2),BLOCK       MOVE IN PREVIOUS (OR CLEAR)                  
         OI    6(R2),X'80'                                                      
         MVC   BLOCK(80),BLOCK+80                                               
         BAS   RE,BUMPTOUN                                                      
         BCT   R0,INS2                                                          
         B     INSFOUND                                                         
         SPACE                                                                  
INSFOUND MVC   CONHEAD(L'INSMESS),INSMESS                                       
         L     R4,ATIOB                                                         
         LH    R2,TIOBCURD         PICK UP RELATIVE DISPLACEMENT                
         AR    R2,RA               INTO TWA                                     
         B     VERRX2                                                           
         SPACE                                                                  
DEL2     LR    R3,R2                                                            
         BAS   RE,BUMPTOUN                                                      
         CLI   5(R2),0                                                          
         BE    DEL4                                                             
         ZIC   R1,0(R3)            GET L'FIELD-1 INTO R1                        
         SH    R1,=H'9'                                                         
         TM    1(R3),X'02'                                                      
         BNO   *+8                                                              
         SH    R1,=H'8'                                                         
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   8(0,R3),8(R2)       MOVE NEXT INTO THIS                          
         OI    6(R3),X'80'                                                      
         BCT   R0,DEL2                                                          
         SPACE                                                                  
DEL4     EX    R1,*+8                                                           
         B     *+10                                                             
         XC    8(0,R3),8(R3)       CLEAR LAST ONE                               
         OI    6(R3),X'80'                                                      
         LR    R2,R3                                                            
         MVC   CONHEAD(L'DELMESS),DELMESS                                       
         B     VERRX2                                                           
*                                                                               
         DROP  R4                                                               
*                                                                               
         TITLE 'RENWRGEN - ERROR EXITS - VCURSERR'                              
***********************************************************************         
*                                                                     *         
*        POSITION CURSOR TO CORRECT FIELD IN ERRORS                   *         
*                                                                     *         
*        INPUTS R2=A(SCREEN HEADER)                                   *         
*               FIELDERR=NUMBER OF FIELD IN ERROR                     *         
*                                                                     *         
* THIS ROUTINE INTERFACES TO GENCON'S ERREX ROUTINE AND SETS SPECIAL  *         
* PARAMETERS TO MAKE IT CALL GETTXT INSTEAD OF GETMSG.  SINCE REWRI   *         
* USES MESSAGE NUMBERS GREATER THAN 255, GETTXT MUST BE USED BECAUSE  *         
* GETMSG IS NOT DESIGNED TO HANDLE THESE NUMBERS.                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VCURSERR DS    0H                                                               
*                                                                               
*        MOVE ERROR NUMBER IN ERROR TO RERROR IF REQUIRED                       
*                                                                               
         OI    GENSTAT2,USGETTXT   GENCON MUST CALL GETTXT, NOT GETMSG          
*                                                                               
         LA    RF,GETTXTCB                                                      
         USING GETTXTD,RF                                                       
*                                                                               
         CLI   ERROR,0             IF OLD STYLE MESSAGE NUMBER                  
         JE    *+10                                                             
         MVC   RERROR+1(1),ERROR      PUT IN NEW STYLE                          
*                                                                               
         MVC   GTINDX,RINDEX       MESSAGE INDEX                                
         MVC   GTMSYS,GETMSYS      MESSAGE SYSTEM                               
         MVC   GTMSGNO,RERROR      MESSAGE NUMBER                               
         MVC   GTMTYP,RMSGTYPE     MESSAGE TYPE                                 
         MVC   GTLTXT,RTXTLEN      LENGTH OF OPTIONAL TEXT                      
         MVC   GTATXT,RTXTADR      A(OPTIONAL TEXT)                             
*                                                                               
         CLC   RERROR,=H'60'       IF MESSAGE NUMBER <= 60                      
         JH    *+8                                                              
         MVI   GTMSYS,X'FF'        USE GENERAL SYSTEM                           
*                                                                               
         DROP  RF                                                               
*                                                                               
*        SET INDEX TO DATA IN ERROR                                             
*                                                                               
         CLI   FIELDERR,0          APPLICATION MUST SET FIELD NUMBER            
         JE    VERRXIT                                                          
*                                                                               
         CLI   OFFLINE,C'Y'                                                     
         JE    VERRXIT                                                          
*                                                                               
         L     R4,ATIOB                                                         
         USING TIOBD,R4                                                         
*                                                                               
         OI    6(R2),X'80'         TRANSMIT ERROR FIELD HEADER                  
*                                                                               
         OI    TIOBINDS,TIOBSETC   INSTRUCT CURSOR SETTING                      
*                                                                               
         LR    RF,R2                                                            
         S     RF,ATWA                                                          
         STCM  RF,3,TIOBCURD       DISPLACEMENT FROM START OF TWA               
*                                                                               
         LA    RE,8(R2)                                                         
         SR    R1,R1               COMPUTE FIELD DISPLACEMENT INTO R1           
         ZIC   R0,5(R2)            R0 HAS FIELD LENGTH                          
         ZIC   RF,FIELDERR                                                      
*                                                                               
         BRCT  RF,CURSERR2         CHECK IF ERROR IS IN FIELD 1                 
         J     CURSERR6                                                         
*                                                                               
CURSERR2 CLI   0(RE),C','          SCAN FOR THE COMMAS                          
         JNE   CURSERR4                                                         
*                                                                               
         BRCT  RF,CURSERR4                                                      
*                                                                               
         LA    R1,1(R1)            FOUND ENOUGH - SPACE PAST LAST               
         J     CURSERR6                                                         
*                                                                               
CURSERR4 LA    R1,1(R1)                                                         
         LA    RE,1(RE)                                                         
         BRCT  R0,CURSERR2                                                      
*                                                                               
         SR    R1,R1               ERROR - DIDN'T FIND ENOUGH COMMAS            
*                                                                               
CURSERR6 STC   R1,TIOBCURI         SET CURSOR DISPLACEMENT WITHIN FIELD         
*                                                                               
         J     VERRXIT                                                          
*                                                                               
         DROP  R4                                                               
*                                                                               
VEXIT    DS    0H                                                               
VERRXIT  OI    6(R2),X'40'         POSITION CURSOR                              
         OI    CONHEADH+6,X'80'    ALWAYS TRANSMIT HEADER                       
         CLI   ERROR,X'FE'                                                      
         JE    VERRX2                                                           
         GOTO1 ERREX               SYSTEM MESSAGE                               
*                                                                               
VERRX2   GOTO1 ERREX2              MY OWN ERROR MESSAGE                         
*                                                                               
XIT      XIT1                                                                   
*                                                                               
MYCURSOR MVI   ERROR,X'FE'                                                      
         GOTO1 CURSERR                                                          
*                                                                               
         TITLE 'RENWRGEN - COMMON ROUTINES - BUMP'                              
***********************************************************************         
*                                                                     *         
*              COMMON EXIT ROUTINES                                             
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
BUMP     ZIC   RF,0(R2)            GET TO NEXT SCREEN FIELD                     
         AR    R2,RF                                                            
         BR    RE                                                               
*                                                                               
BUMPTOUN ZIC   RF,0(R2)            GET TO NEXT UNPROTECTED FIELD                
         AR    R2,RF                                                            
         CLI   0(R2),0                                                          
         BER   RE                                                               
         TM    1(R2),X'20'                                                      
         BO    BUMPTOUN                                                         
         BR    RE                                                               
*                                                                               
         TITLE 'RENWRGEN - COMMON ROUTINES - GETEL'                             
***********************************************************************         
*                                                                     *         
*              CONSTANTS TABLES ETC                                             
*                                                                     *         
***********************************************************************         
         SPACE                                                                  
         GETEL R4,DATADISP,ELCODE                                               
*                                                                               
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
*                                  ERROR MESSAGES                               
*                                                                               
         SPACE                                                                  
INSMESS  DC    C'NEW FIELD INSERTED ON SCREEN'                                  
DELMESS  DC    C'FIELD DELETED ON SCREEN'                                       
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - OVERFLOW'                 
***********************************************************************         
*                                                                     *         
*              OVERFLOW ROUTINES                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
OVSTART  DS    0H                                                               
*                                                                               
OVERFLOW NMOD1 0,**RE00OF,R6                                                    
         L     R8,0(R1)                                                         
         USING SPOOLD,R8                                                        
         LA    RC,SPOOLEND                                                      
         USING GEND,RC                                                          
         L     R9,4(R1)                                                         
         USING SUBSYSD,R9                                                       
         L     RA,ATWA                                                          
         USING T830FFD,RA                                                       
*                                                                               
         LA    R7,RENWRIOD                                                      
         USING RENWRIOD,R7                                                      
*                                                                               
         ZIC   RF,0(R1)                                                         
         SLL   RF,2                                                             
         B     ROUTINE(RF)                                                      
*                                                                               
ROUTINE  DS    0H                                                               
         B     XVPDT               0 - VALIDATE PERIOD DATE                     
         DC    XL4'00'             REPLACED BY DLSTBLD                          
         DC    XL4'00'             REPLACED BY PERXP                            
         DC    H'0'                                                             
         EJECT                                                                  
XVPDT    DS    0H                  VALIDATE REQUEST PERIOD                      
                                                                                
* - LET RRG FILL IN ITS FIELDS (CODE FROM REREPRG02)                            
                                                                                
*        MVC   ACCOPT,QACCTOPT     SAVE ACCOUNTING OPTION                       
*                                                                               
         GOTO1 ADDAY,DMCB,QSTART,DUB,15  BUMP START TO CALENDAR MONTH           
*                                                                               
         GOTO1 DATCON,DMCB,DUB,(3,WORK)  BROADCAST START Y/M                    
         GOTO1 (RF),(R1),QEND,(3,WORK+3) BROADCAST END   Y/N                    
*                                                                               
         CLC   WORK(3),WORK+3      CHECK START DATE LE END DATE                 
         BH    VALNO                                                            
*                                                                               
         MVC   CURST,WORK          CUR PERIOD START                             
*                                                                               
         MVC   CURND,WORK+3        CUR PERIOD END                               
*                                                                               
         MVC   PRIST,CURST                                                      
*                                                                               
         ZIC   R5,PRIST                                                         
         BCTR  R5,0                                                             
         STC   R5,PRIST            PRIOR PERIOD START                           
*                                                                               
         MVC   PRIND,CURND                                                      
*                                                                               
         IC    R5,PRIND                                                         
         BCTR  R5,0                                                             
         STC   R5,PRIND            PRIOR PERIOD END                             
*                                                                               
* - GET COMPRESSED START/END DATES                                              
*                                                                               
         GOTO1 DATCON,(R1),(0,REQPSTR),(2,REQCMPST)                             
         GOTO1 (RF),(R1),(0,REQPEND),(2,REQCMPND)                               
*                                                                               
         B     VALOK                                                            
                                                                                
*                                                                               
VALOK    SR    RF,RF               SET CONDITION CODE                           
VALNO    LTR   RF,RF               SET CONDITION CODE                           
*                                                                               
VALX     XIT1                                                                   
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VPDT'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE PERIOD DATES                                        *         
*                                                                     *         
*        DATES ARE IN FORMAT YEAR/MONTH AND REQUEST USES              *         
*        BROADCAST MONTH DATES                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VPDT     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REQPDTS,REQPDTS     INIT PERIOD DATE SAVEAREA                    
         XC    AACTFLD,AACTFLD     ZERO ACTIVITY DATES FIELD                    
*                                                                               
         GOTO1 ANY                 INPUT REQUIRED                               
*                                  PUTS INPUT IN WORK                           
*                                                                               
         ST    R2,APERFLD          SAVE FIELD ADDRESS                           
*                                                                               
*        CHECK IF RFP SYMBOLIC PARAMETER ENTERED                                
*                                                                               
         OC    ARFPBLK,ARFPBLK     SKIP IF RFP NOT BEING USED                   
         BZ    VPDTRFPN                                                         
*                                                                               
         L     R4,ARFPBLK          ESTABLISH RFP BLOCK                          
         USING RFPBLK,R4                                                        
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,RFPVNUMS       NUMBER OF VIABLE SYMBOLIC NAMES              
         BZ    VPDTRFPN            NONE                                         
*                                                                               
         LH    RF,=Y(RFPXTNSN-RFPBLK)  USE EXTENDED SYMBOL TABLE                
         LA    RF,RFPBLK(RF)                                                    
*                                                                               
         USING RFPVSYMS,RF         ESTABLISH SYMBOL TABLE                       
*                                                                               
         CLC   RFPVSYMB,WORK MATCH INPUT TO SYMBOLIC PARAMETER                  
         BE    *+10                   EXPANDED FORMAT                           
         CLC   RFPVSYME(L'RFPVSYME-1),WORK MATCH INPUT TO SYMBOLIC PARM         
         BE    *+16                  ESCAPE SEQ IN CASE LEFT OVER               
*                                     FROM LAST TRANSACTION                     
         LA    RF,RFPVSYML(RF)     BUMP TO NEXT SYMBOLIC PARAMETER              
         BCT   R0,*-24                                                          
         B     VPDTRFPN            NO SYMBOLIC PARAMETER FOUND                  
*                                                                               
         CLC   =AL2(RE#RFSPM),RFPVSYME+1 MUST BE PERIOD MONTH SYMBOLIC          
         BNE   VPDTNVE                                                          
*                                                                               
         SR    R1,R1                                                            
         IC    R1,0(R2)            TOTAL FIELD LENGTH                           
         AHI   R1,-8               HEADER LENGTH                                
         AHI   R1,-8               TRAILER LENGTH                               
         BCTR  R1,0                EXECUTE LENGTH                               
*                                                                               
         EX    R1,*+8                                                           
         B     *+10                                                             
         XC    8(0,R2),8(R2)       INIT PERIOD FIELD                            
*                                                                               
         MVC   8(L'RFPVSYME,R2),RFPVSYME REPLACE KEYWORD WITH ESC SEQ           
*                                                                               
         LA    RE,1(R1)            MAX LENGTH FOR PERIOD                        
         STC   RE,5(R2)            CHANGE LENGTH TO MAX INPUT FOR RFP           
         STC   RE,L'RFPVSYME-1+8(R2)   CHG LEN IN ESCAPE SEQ                    
*                                                                               
         B     VPDTX               VALID PERIOD                                 
*                                                                               
VPDTRFPN DS    0H                                                               
*                                                                               
         DROP  R4,RF                                                            
*                                                                               
         XC    BLOCK(256),BLOCK                                                 
         LA    R4,BLOCK                                                         
         USING PERVALD,R4          ESTABLISH PERVAL WORKAREA                    
*                                                                               
         MVC   PVALBSTA,BTODAY     PASS TODAY'S DATE                            
*                                                                               
         L     RF,ACOMFACS         GET PERVAL ADDRESS                           
         L     RF,CPERVAL-COMFACSD(RF)                                          
*                                                                               
         SR    R3,R3                                                            
         IC    R3,5(R2)            INPUT LENGTH                                 
******   LA    R3,PVINDDMM(R3)     VALIDATE FOR MM/DD                           
*                                                                               
*                                  VALIDATE PERIOD                              
         GOTO1 (RF),DMCB,((R3),8(R2)),('PVINTOD',(R4))                          
         CLI   4(R1),0             CHECK FOR ERRORS                             
         BNE   VPDTNVE                                                          
*                                                                               
*        DATES MUST NOT INCLUDE DAYS - IE FULL MONTHS ONLY                      
*                                                                               
         TM    PVALASSM,PVALASD    DAYS MUST BE ASSUMED                         
         BNO   VPDT1E                                                           
*                                                                               
         MVC   REQPSTR,PVALESTA    SAVE START DATE                              
         MVC   REYMSTRP,PVALBSTA   SAVE Y/M BINARY START DATE                   
*                                                                               
         GOTO1 DATCON,(R1),REQPSTR,(6,REQPSTRM) SAVE START AS MMM/YY            
         MVC   REQPENDM,REQPSTRM   END DATE DEFAULTS TO START                   
*                                                                               
         XC    WORK,WORK                                                        
         MVC   REQPSTR+4(2),=C'15'                                              
         GOTO1 QGTBROAD,(R1),(1,REQPSTR),WORK,GETDAY,ADDAY                      
*                                                                               
         CLI   DMCB,X'FF'          DATE ERROR                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   REQPSTR(12),WORK    DEFAULT TO START BROADCAST MONTH             
*                                                                               
         TM    PVALASSM,PVALAED    DAYS MUST BE ASSUMED                         
         BNO   VPDT1E                                                           
*                                                                               
         CLC   PVALBSTA,PVALBEND   START MUST BE BEFORE END                     
         BH    VPDT2E                                                           
*                                                                               
         MVC   REQPEND,PVALEEND    SAVE END DATE                                
         MVC   REYMENDP,PVALBEND   SAVE Y/M BINARY END   DATE                   
*                                                                               
         GOTO1 DATCON,(R1),REQPEND,(6,REQPENDM)   END AS MMM/YY                 
*                                                                               
         MVC   REQPEND+4(2),=C'15'                                              
         GOTO1 QGTBROAD,(R1),(1,REQPEND),WORK,GETDAY,ADDAY                      
         CLI   DMCB,X'FF'          DATE ERROR                                   
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         MVC   REQPEND,WORK+6      END OF END BROADCAST MONTH                   
*                                                                               
         CLC   =C'SOON',CONWHEN    SKIP IF NOT SOON REQUEST                     
         BNE   VPDTENDX                                                         
*                                                                               
         CLC   PVALNMNS,=AL2(13)   MAX 13 MONTHS                                
         BH    VPDT3E                                                           
*                                                                               
VPDTENDX DS    0H                                                               
*                                                                               
         CLC   PVALNMNS,=AL2(25)   MAX 25 MONTHS                                
         BH    VPDT4E                                                           
*                                                                               
*        SET YTD START                                                          
*                                                                               
         TM    REQCFOPT,REQCFYTQ   SKIP IF NOT DOING YTD COLUMNS                
         BNO   VPDTYTSX                                                         
*                                                                               
         OC    REQYTDSB,REQYTDSB   IF NO YTD START SET IN OPTIONS               
         BNZ   VPDTYTSX                                                         
*                              DEFAULT TO JAN OF REQUEST START YR               
*                                                                               
         GOTO1 DATCON,DMCB,REQPEND,(3,REQYTDSB)  GET JAN OF REQ YEAR            
*                                                                               
         MVI   REQYTDSB+1,1                                                     
         MVI   REQYTDSB+2,1                                                     
*                                                                               
*        REQUEST CAN'T SPAN START OF A YEAR                                     
*                                                                               
         CLC   REQYTDSB(2),REYMSTRP     RESULT MUST BE LE REQ START             
         BH    VPDTYTDE                                                         
*                                                                               
         GOTO1 DATCON,DMCB,(3,REQYTDSB),REQYTDST                                
*                                                                               
VPDTYTSX DS    0H                                                               
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         BNE   VPDTRNGX                                                         
*                                                                               
*        SET UP RANGES OF COMPRESSED BROADCAST MONTH DATES FOR                  
*              CURRENT, PRIOR, 2YR PRIOR AND NEXT YEAR                          
*                                                                               
*        START DATES                                                            
*                                                                               
         GOTO1 DATCON,DMCB,REQPSTR,(2,REFCURST) CURRENT START                   
         GOTO1 DATCON,DMCB,REQPSTR,(3,REFCURSB) CURRENT START                   
*                                                                               
         GOTO1 ADDAY,DMCB,REQPSTR,DUB,15  BUMP START TO CALENDAR MONTH          
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'-1'  BACK UP A YEAR                 
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+12,(2,REFPRIST)  PRIOR START COMPRSED           
         GOTO1 DATCON,DMCB,WORK+12,(3,REFPRISB)  PRIOR START COMPRSED           
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'-2'  BACK UP A 2 YEARS              
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+12,(2,REFPR2ST)  2YR PRIOR START                
         GOTO1 DATCON,DMCB,WORK+12,(3,REFPR2SB)  2YR PRIOR START                
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'1'   ADD 1 YEAR                     
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+12,(2,REFNXTST)  NEXT  START                    
         GOTO1 DATCON,DMCB,WORK+12,(3,REFNXTSB)  NEXT  START                    
*                                                                               
*        END DATES                                                              
*                                                                               
         GOTO1 DATCON,DMCB,REQPEND,(2,REFCUREN) CURRENT END                     
         GOTO1 DATCON,DMCB,REQPEND,(3,REFCUREB) CURRENT END                     
*                                                                               
         GOTO1 ADDAY,DMCB,REQPEND,DUB,F'-10'    STAY IN END MONTH               
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'-1'  BACK UP A YEAR                 
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR END            
         GOTO1 DATCON,DMCB,WORK+18,(2,REFPRIEN)  PRIOR END COMPRSED             
         GOTO1 DATCON,DMCB,WORK+18,(3,REFPRIEB)  PRIOR END COMPRSED             
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'-2'  BACK UP A 2 YEARS              
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+18,(2,REFPR2EN)  2YR PRIOR END                  
         GOTO1 DATCON,DMCB,WORK+18,(3,REFPR2EB)  2YR PRIOR END                  
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'1'   ADD 1 YEAR                     
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+18,(2,REFNXTEN)  NEXT  END                      
         GOTO1 DATCON,DMCB,WORK+18,(3,REFNXTEB)  NEXT  END                      
*                                                                               
*        IF YTD OPTION BEING USED SOMEWHERE                                     
*           SET UP APPROPRIATE START DATES                                      
*                                                                               
         TM    REQCFOPT,REQCFYTQ   SKIP IF NOT DOING YTD COLUMNS                
         BNO   VPDTYTDX                                                         
*                                                                               
         GOTO1 DATCON,DMCB,REQYTDST,(2,REFYCRST) CURRENT YTD START              
         GOTO1 DATCON,DMCB,REQYTDST,(3,REFYCRSB) CURRENT YTD START              
*                                                                               
         GOTO1 ADDAY,DMCB,REQYTDST,DUB,15 BUMP START TO CALENDAR MONTH          
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'-1'  BACK UP A YEAR                 
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+12,(2,REFYPRST)  PRIOR START COMPRSED           
         GOTO1 DATCON,DMCB,WORK+12,(3,REFYPRSB)  PRIOR START COMPRSED           
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'-2'  BACK UP A 2 YEARS              
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+12,(2,REFYP2ST)  2YR PRIOR START                
         GOTO1 DATCON,DMCB,WORK+12,(3,REFYP2SB)  2YR PRIOR START                
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',DUB),WORK,F'1'   ADD 1 YEAR                     
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+12,GETDAY,ADDAY PRIOR START          
         GOTO1 DATCON,DMCB,WORK+12,(2,REFYNXST)  NEXT  START                    
         GOTO1 DATCON,DMCB,WORK+12,(3,REFYNXSB)  NEXT  START                    
*                                                                               
VPDTYTDX DS    0H                                                               
*                                                                               
VPDTRNGX DS    0H                                                               
*                                                                               
         OC    REQASTR,REQASTR     SKIP IF ACTIVITY DATES NOT ENTERED           
         BNZ   VPDTACTX                                                         
*                                                                               
         MVI   REQAPER,C'Y'        ACTIVITY DATES EQUAL PERIOD DATES            
*                                                                               
         MVC   REQASTR,REQPSTR     DEFAULT TO PERIOD DATES                      
         MVC   REQAEND,REQPEND                                                  
         MVC   REQAASTR,REQPSTR                                                 
         MVC   REQAAEND,REQPEND                                                 
*                                                                               
         MVI   BYTE,0                                                           
         GOTO1 GETDAY,(R1),REQASTR,WORK   GET START DAY                         
*                                                                               
         CLC   WORK(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                SHOULD NOT BE HERE                           
*                                                                               
         CLI   DMCB,1              IF MONDAY, OK                                
         BE    VPDTACT1                                                         
*                                                                               
         MVI   BYTE,1              BACKUP TO PRIOR MONDAY FOR START             
         ZIC   R0,DMCB                                                          
         BCTR  R0,0                                                             
         LNR   R0,R0                                                            
         GOTO1 ADDAY,DMCB,REQASTR,REQAASTR,(R0)  ACTUAL START DATE              
*                                                                               
VPDTACT1 DS    0H                                                               
*                                                                               
         GOTO1 GETDAY,(R1),REQAEND,WORK                                         
*                                                                               
         CLC   WORK(3),SPACES                                                   
         BNE   *+6                                                              
         DC    H'0'                SHOULD NOT BE HERE                           
*                                                                               
         CLI   DMCB,7              IF SUNDAY, OK                                
         BE    VPDTACT2                                                         
*                                                                               
         MVI   BYTE,1              FIND FOLLOWING SUNDAY FOR END DATE           
         ZIC   R0,DMCB                                                          
         SH    R0,=H'7'                                                         
         LCR   R0,R0                                                            
         GOTO1 ADDAY,DMCB,REQAEND,REQAAEND,(R0) ACTUAL END DATE                 
*                                                                               
VPDTACT2 DS    0H                                                               
*                                                                               
         GOTO1 PERVERT,(R1),REQAASTR,REQAAEND NUMBER OF WKS IN PERIOD           
*                                                                               
         MVC   REQAAWKS,DMCB+13    SAVE # OF WEEKS IN ACTIVITY PERIOD           
*                                                                               
VPDTACTX DS    0H                                                               
*                                                                               
         GOTO1 DATCON,(R1),(0,REQPSTR),(3,REQPSTRB) BINARY END & START          
         GOTO1 (RF),(R1),(0,REQPEND),(3,REQPENDB)                               
*                                                                               
         MVC   USERQSTR,REQPSTR    PASS ON START AND END DATES                  
         MVC   USERQEND,REQPEND                                                 
*                                                                               
         TWAXC (R2),(R2)           CLEAR FIELD                                  
*                                                                               
         MVC   8(L'REQPSTRM,R2),REQPSTRM RE-DISPLAY PERIOD                      
         MVI   5(R2),L'REQPSTRM    RESET INPUT  LENGTH                          
*                                                                               
         CLC   REYMENDP,REYMSTRP   SKIP IF NO END MONTH                         
         BNH   *+22                                                             
         OI    REQFLAGS,REQ2MON    SET ON 2 MONTH OR MORE REQUEST               
         MVI   14(R2),C'-'                                                      
         MVC   15(L'REQPENDM,R2),REQPENDM RE-DISPLAY PERIOD                     
         MVI   5(R2),13            RESET INPUT  LENGTH                          
*                                                                               
         OI    6(R2),X'80'         FORCE RE-TRANSMISSION                        
         MVI   7(R2),13            SET   OUTPUT LENGTH                          
*                                                                               
         DROP  R4                                                               
*                                                                               
* - FOLLOWING DATA NEEDED BY RRG ROUTINES                                       
*                                                                               
         MVC   QSTART,REQPSTR                  SET RRG REQ CARD DATES           
         MVC   QEND,REQPEND                                                     
*                                                                               
* - NOW LET RRG GENERATE THE REST                                               
*                                                                               
         GOTO1 =A(OVERFLOW),DMCB,(0,(R8)),(R9),RR=RELORGEN 0=VPDT               
         BNE   VPDTNVE                                                          
*                                                                               
* - GENERATE DATE LIST                                                          
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP UNLESS OFFLIEN                          
         BNE   VPDTX                                                            
*                                                                               
         GOTO1 DLISTBLD                                                         
*                                                                               
VPDTX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
VPDTNVE  DS    0H                  DATE NOT VALID                               
         LHI   RF,RWEDTENV                                                      
         B     VPDTERR                                                          
*                                                                               
VPDT1E   DS    0H                  DATES MUST BE YEAR/MONTH                     
         LHI   RF,RWEYRMON                                                      
         B     VPDTERR                                                          
*                                                                               
VPDT2E   DS    0H                  END BEFORE START                             
         LHI   RF,RWEENDST                                                      
         B     VPDTERR                                                          
*                                                                               
VPDT3E   DS    0H                  PERIOD TOO LONG FOR SOON                     
         LHI   RF,RWEPERLG                                                      
         B     VPDTERR                                                          
*                                                                               
VPDT4E   DS    0H                  PERIOD TOO LONG                              
         LHI   RF,RWEPRLG1                                                      
         B     VPDTERR                                                          
*                                                                               
VPDTYTDE DS    0H                  REQUEST PERIOD SPANS JANUARY                 
*                                                                               
         LHI   RF,RWEYTDER                                                      
         B     VPDTERR                                                          
*                                                                               
VPDTERR  DS    0H                                                               
         STCM  RF,3,RERROR         SET ERROR CODE                               
         GOTO1 CURSERR                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VVALOPTS'                 
***********************************************************************         
*                                                                     *         
*              VALIDATE OPTIONS                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VVALOPTS NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         ST    R2,REOPTA           SAVE ADDRESS OF FIRST                        
*                                                                               
         MVI   ERROR,0             KILL ANY LEFT OVER ERROR CODE                
*                                                                               
         BRAS  RE,VOPTINIT         INITIALIZE OPTIONS                           
*                                                                               
         CLI   5(R2),0             OKAY IF THERE IS NO ENTRY                    
         JE    VVALOPTX                                                         
*                                                                               
         ST    R2,ALASTCOL         SAVE COLUMN POINTER                          
*                                                                               
         MVI   FIELDERR,1          INIT FIELD IN ERROR COUNTER                  
*                                                                               
         XC    BLOCK(240),BLOCK                                                 
         XC    BLOCK+240(240),BLOCK+240                                         
         LA    R4,BLOCK            POINT TO FIRST OPTION                        
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,5(R2)          FIELD LENGTH                                 
         LA    RE,7(RF,R2)         LAST BYTE OF INPUT                           
*                                                                               
         CLI   0(RE),C','          IF FIELD ENDS IN COMMA                       
         BNE   *+10                                                             
         BCTR  RF,0                   LENGTH DECREMENTED FOR SCANNER            
         STC   RF,5(R2)                                                         
*                                                                               
*        SCAN INPUT                                                             
*                                                                               
         GOTO1 SCANNER,DMCB,(20,(R2)),(X'8B',BLOCK),0                           
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,4(R1)          NUMBER OF ENTERED OPTIONS                    
         JZ    VOPTNVE             MUST HAVE SOME ENTRY BY NOW                  
*                                                                               
VOPTLOOP DS    0H                                                               
*                                                                               
         CLI   12(R4),C'+'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   12(R4),C'?'                                                      
         BE    *+8                                                              
         CLI   13(R4),C'?'                                                      
         BNE   VOPTHLPX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMOPW),(R2),HELPCBLK SHOW HELP MENU         
*                                  FOR OPTIONS                                  
VOPTHLPX DS    0H                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
*        VALIDATE OPTION AGAINST FILTERS                                        
*                                                                               
         L     R1,AVLPARMS                                                      
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQWROPT)),                 X        
               (0(R4),12(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   VOPTNVE                                                          
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
*        SAVE OPTION TITLE FOR PRINTING                                         
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE SAVE OPTION TITLE                 
         BNE   *+8                                                              
         BRAS  RE,VOPTTTL                                                       
*                                                                               
*        ISSUE WARNING IF OPTION HAS QUALIFYING DATA                            
*        BUT DOESN'T EXPECT IT. IE IS FOLLOWED BY '='                           
*        BUT IS STAND ALONE OPTION                                              
*                                                                               
         CLI   1(R4),0             IF SECOND HALF OF OPTION GIVEN               
         BE    VOPTEQLX                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,VLTLFULL       GET OPTION NAME LENGTH                       
         BZ    VOPTEQLX            SHOULDN'T HAPPEN                             
*                                                                               
         LA    R1,VLTFULL-1(RF)    POINT TO LAST BYTE OF NAME                   
*                                                                               
*        LOOK FOR EQUAL SIGN                                                    
*                                                                               
         CLI   0(R1),C'='                                                       
         BE    VOPTEQLX            FOUND - EVRYTHING IS KOSHER                  
         BCTR  R1,0                BACK UP A POSITION                           
         BCT   RF,*-10                                                          
*                                                                               
         J     VOPTEQUE            EXTRANEOUS DATA IN OPTION                    
*                                                                               
VOPTEQLX DS    0H                                                               
*                                                                               
*        VALIDATE INDIVIDUAL OPTIONS                                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,VLTICODE       GET OPTION CODE                              
*                                                                               
*        BUDGET TYPES                                                           
*                                                                               
VOPTBTP  DS    0H                                                               
*                                                                               
         L     R1,=A(BTTBTAB)      POINT TO BUDGET TYPES TABLE                  
         A     R1,RELORGEN         RELOCATE ADDRESS                             
*                                                                               
VOPTBTPL DS    0H                                                               
*                                                                               
         CLI   0(R1),X'FF'         CHECK FOR END OF TABLE                       
         BE    VOPTBTPN            NOT A BUDGET TYPE                            
*                                                                               
         CLM   RF,3,0(R1)          MATCH ON BUDGET TYPE                         
         BE    VOPTBTPF                                                         
*                                                                               
VOPTBTPC DS    0H                                                               
*                                                                               
         LA    R1,BTTBTABL(R1)     NEXT ENTRY IN TABLE                          
         B     VOPTBTPL                                                         
*                                                                               
VOPTBTPF DS    0H                  VALIDATE BUDGET TYPE                         
*                                                                               
         BRAS  RE,BTPVAL                                                        
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTBTPN DS    0H                                                               
*                                                                               
*        BACKBILLING OPTIONS                                                    
*                                                                               
VOPTBKB  DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPBKB         BACK BILLING OPTIONS                         
         JNE   VOPTBKBN                                                         
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         BE    *+12                                                             
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         BNE   VOPTBKHX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMBKB),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
VOPTBKHX DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQBKBOP)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   VOPTBKBE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   REFBKBOP,VLTICODE+1 SAVE BACKBILLING OPTION                      
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF ON-LINE                              
         BNE   VOPTBKBX                                                         
*                                                                               
         MVC   NAMEAREA,VLTFULL    DESCRIPTION                                  
         OC    NAMEAREA,SPACES     SPACE FILL                                   
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTBKBX DS    0H                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBKBN DS    0H                                                               
*                                                                               
*        BUY CODE FILTERS                                                       
*                                                                               
VOPTBCD  DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPBCD         BUY CODE FILTER                              
         JE    *+8                                                              
         CHI   RF,RKQOPBT1         BUY TYPE 1 FILTER                            
         JE    *+8                                                              
         CHI   RF,RKQOPBT2         BUY TYPE 2 FILTER                            
         JNE   VOPTBCDN                                                         
*                                                                               
         BRAS  RE,BCDVAL           VALIDATE BUYCODE                             
*                                                                               
VOPTBCDX DS    0H                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBCDN DS    0H                                                               
*                                                                               
*        CROSSFILE REPS                                                         
*                                                                               
VOPTXFL  DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPXFL         CROSS FILE REPS                              
         JNE   VOPTXFLN                                                         
*                                                                               
         GOTO1 =A(XFLVAL),RR=RELORGEN   VALLIDATE CROSS FILE OPTION             
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTXFLN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPAST         ALLSTA - STATION FILE LISTING                
         JNE   VOPTASTN                                                         
*                                                                               
         OI    REALL2,REALSTAQ     SET FOR STATION FILE LISTING                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTASTN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPYTD         YTD - REPORTING                              
         JNE   VOPTYTDN                                                         
*                                                                               
         OI    REQCFOPT,REQCFYTQ   INDICATE SOME COLUMN USING YTD               
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTYTDN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPPQI         PRINT QUEUE INDICIES                         
         JNE   VOPTPQIN                                                         
*                                                                               
         OI    NEWOPTS,NOPTPQIX    SET OPTION INDICATOR                         
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTPQIN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPAAG               ALLAGY - AGENCY FILE LISTING           
         JNE   VOPTAAGN                                                         
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTAAGN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPNRG               RGON REPORT                            
         BNE   VOPTNRGN                                                         
*                                                                               
         MVI   FLAVOR,C'R'         SET FOR RGON PROCESSING                      
         MVI   REFLAVOR,C'R'                                                    
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVC   HCBFLVR-HELPCB(L'HCBFLVR,RF),FLAVOR                              
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT4V-VLPARMS(R1),RKVFLNRG   SET FLAVOR FILTER                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         OC    REQASATD,REQASATD   AS-AT-DATE INVLAID AS FILTER                 
         JNZ   VOPTRG1E                                                         
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTNRGN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPFDS               USE FLIGHT DATES                       
         BNE   VOPTFLTN                                                         
*                                                                               
         MVI   FLAVOR,C'F'         SET FOR FLIGHT PROCESSING                    
         MVI   REFLAVOR,C'F'                                                    
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVC   HCBFLVR-HELPCB(L'HCBFLVR,RF),FLAVOR                              
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT4V-VLPARMS(R1),RKVFLFDS   SET FLAVOR FILTER                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         B     VOPTCONT                                                         
*                                                                               
VOPTFLTN DS    0H                                                               
*                                                                               
*        CONTRACT HEADER CREATE DATE FILTER                                     
*                                                                               
         CHI   RF,RKQOPCCD               CONTRACT HEADR CREATE FILTER           
         BNE   VOPTCCDN                                                         
*                                                                               
*                                                                               
         CLI   1(R4),0              ENTRY REQUIRED AT THIS POINT                
         JE    VOPTCCD1                                                         
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         XC    CFLTFVAL,CFLTFVAL            INIT VALUE                          
         MVI   CFLTVLEN,6                   FIXED VALUE LENGTH                  
*                                                                               
         XC    DBLOCKC(256),DBLOCKC                                             
         LA    R6,DBLOCKC                                                       
         USING PERVALD,R6          ESTABLISH PERVAL WORKAREA                    
*                                                                               
         MVC   PVALBSTA,BTODAY     PASS TODAY'S DATE                            
*                                                                               
         LA    RE,22(R4)           START OF INPUT                               
*                                                                               
         SR    R3,R3                                                            
         IC    R3,1(R4)            INPUT LENGTH                                 
*                                                                               
         CLI   22(R4),C'-'         IF DATE STARTS WITH DASH                     
         BNE   *+16                                                             
         BCT   RE,*+8                 DECREMENT LENGTH                          
         J     VOPTCCD1                  NO DATE                                
         LA    RE,1(RE)               BUMP INPUT POINTER                        
*                                                                               
         ST    RE,DMCB             SAVE INPUT ADDRESS                           
*                                                                               
         LA    R3,PVINDDMM(R3)     DEFAULT TO MMDD INSTEAD OF MMYY              
         STC   R3,DMCB                                                          
*                                                                               
         L     RF,ACOMFACS         GET PERVAL ADDRESS                           
         L     RF,CPERVAL-COMFACSD(RF)                                          
*                                                                               
*                                  VALIDATE PERIOD                              
         GOTO1 (RF),DMCB,,('PVINTOD+PVINSGLS',(R6))                             
*                                                                               
         TM    4(R1),X'FF'-PVRCONE CHECK FOR ERRORS                             
         JNZ   VOPTCCD2                                                         
*                                                                               
         TM    DMCB+4,PVRCONE      IF SINGLE DATE FOUND                         
         JNO   VOPTCCDA                                                         
*                                                                               
         CLI   22(R4),C'-'         IF END OF RANGE                              
         JNE   *+14                                                             
         MVC   REQCCDEN,PVALBSTA      SAVE DATE AS END DATE                     
         J     *+10                                                             
         MVC   REQCCDST,PVALBSTA   ELSE SAVE AS START DATE                      
*                                                                               
         J     VOPTCCDX                                                         
*                                                                               
VOPTCCDA DS    0H                  DATE RANGE ENTRERED                          
*                                                                               
         CLC   PVALBSTA,PVALBEND   START MUST BE BEFORE END                     
         JH    VOPTCCD3                                                         
*                                                                               
         MVC   REQCCDST,PVALBSTA   SAVE DATE RANGE                              
         MVC   REQCCDEN,PVALBEND                                                
*                                                                               
VOPTCCDX DS    0H                                                               
*                                                                               
         MVC   NAMEAREA(20),22(R4) DISPLAY DATE(S)                              
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCCDN DS    0H                                                               
*                                                                               
*        AS-AT-DATE OPTION                                                      
*                                                                               
         CHI   RF,RKQOPAAD               AS-AT-DATE OPTION                      
         BNE   VOPTAADN                                                         
*                                                                               
         CLI   FLAVOR,C'R'         NOT AVAILABLE FOR NRRG PROCESSING            
         JE    VOPTRG1E                                                         
*                                                                               
*        CHECK IF RFP SYMBOLIC PARAMETER ENTERED                                
*                                                                               
         OC    ARFPBLK,ARFPBLK     SKIP IF RFP NOT BEING USED                   
         BZ    VOPTRFPN                                                         
*                                                                               
         L     R6,ARFPBLK          ESTABLISH RFP BLOCK                          
         USING RFPBLK,R6                                                        
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,RFPVNUMS       NUMBER OF VIABLE SYMBOLIC NAMES              
         BZ    VOPTRFPN            NONE                                         
*                                                                               
         LHI   RF,RFPXTNSN-RFPBLK  USE EXTENDED SYMBOL TABLE                    
         LA    RF,RFPBLK(RF)                                                    
*                                                                               
         USING RFPVSYMS,RF         ESTABLISH SYMBOL TABLE                       
*                                                                               
         CLC   RFPVSYMB(20),22(R4) MATCH INPUT TO SYMBOLIC PARAMETER            
         BE    *+10                   EXPANDED FORMAT                           
         CLC   RFPVSYME(L'RFPVSYME-1),22(R4) MATCH INPUT TO SYMB PARM           
         JE    *+16                  ESCAPE SEQ IN CASE LEFT OVER               
*                                     FROM LAST TRANSACTION                     
         LA    RF,RFPVSYML(RF)     BUMP TO NEXT SYMBOLIC PARAMETER              
         BCT   RE,*-24                                                          
         J     VOPTRFPN            NO SYMBOLIC PARAMETER FOUND                  
*                                                                               
         CLC   =AL2(RE#RFSAS),RFPVSYME+1 MUST BE ASATDATE SYMBOLIC              
         JNE   VOPTNVE                                                          
*                                                                               
         CHI   R0,1                MUST BE LAST OPTION                          
         JNE   VOPTAADE                                                         
*                                                                               
         SR    R1,R1                                                            
         IC    R1,8(R4)            DISPLACEMENT OF DATE IN FIELD                
         LA    R1,8(R1,R2)         POINT TO DATE AREA                           
         MVC   0(17,R1),SPACES     INIT DATE                                    
         MVC   0(L'RFPVSYME,R1),RFPVSYME REPLACE KEYWORD WITH ESC SEQ           
*                                                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
*                                                                               
         IC    RE,1(R4)            LENGTH OF DATE AS ENTERED                    
         IC    RF,5(R2)            CURRENT LENGTH OF INPUT                      
*                                                                               
         SR    RF,RE               LENGTH WITHOUT DATE                          
*                                                                               
         LA    RF,17(RF)           LENGTH WITH MAX DATE                         
*                                                                               
         LA    RF,16(RF)           MAKE SURE IT WILL FIT IN FIELD               
         CLM   RF,1,0(R2)                                                       
         JH    VOPTAD2E                                                         
*                                                                               
         AHI   RF,-16              RESTORE INPUT LENGTH                         
*                                                                               
         STC   RF,5(R2)            CHANGE LENGTH TO MAX INPUT FOR RFP           
         MVI   L'RFPVSYME-1(R1),17   CHG LEN IN ESCAPE SEQ                      
*                                                                               
         MVI   REQASATD,X'FF'      INDICATE AAD= FILTER BEING USED              
*                                                                               
         J     VOPTCONT            VALID ASATDATE                               
*                                                                               
VOPTRFPN DS    0H                                                               
*                                                                               
         DROP  R6,RF                                                            
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            LENGTH OF SECOND PART OF BLOCK               
*                                                                               
         L     R1,AVLPARMS                                                      
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQOPAAD)),((RF),22(R4)),   X        
               AVLTAB,0,0,0                                                     
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   VOPTNVE                                                          
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE                      
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
         CLC   VLTEXTRA+1(3),VLTEXTRA+4 IF START EQUALS END                     
         JNE   *+14                                                             
         XC    VLTEXTRA+4(3),VLTEXTRA+4  ELIMINATE END                          
         MVI   VLTEXTRA,3          (NEW LENGTH)                                 
*                                                                               
         MVC   REQASATD,VLTEXTRA+1   SAVE AS AT DATE                            
         MVC   RWAADTAB(6),VLTEXTRA+1   MAKE FIRST IN ASATDATE TABLE            
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE                                   
         JNE   VOPTADDX                                                         
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   LABLAREA,10(RE)                                                  
         J     *+20                                                             
         DC    CL16'AS AT DATE:'                                                
*                                                                               
         LA    RF,3                ASSUME SINGLE DATE                           
         CLI   VLTEXTRA,3          IF END DATE GIVEN                            
         JNH   *+8                                                              
         LA    RF,X'10'(RF)           TELL DATCON ITS THERE                     
*                                                                               
         GOTO1 DATCON,DMCB,((RF),VLTEXTRA+1),(17,NAMEAREA) TRANS DATE           
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTADDX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTAADN DS    0H                                                               
*                                                                               
VOPTBOX  DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPBOX               BOX OPTION                             
         JNE   VOPTBOXN                                                         
*                                                                               
         CLI   22(R4),C'N'         BOX OPTION MUST BE Y OR N                    
         JE    *+8                                                              
         CLI   22(R4),C'Y'                                                      
         JNE   VOPTBOXE                                                         
*                                                                               
         MVC   BOXOPT,22(R4)       SAVE BOX OPTION                              
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBOXN DS    0H                                                               
*                                                                               
VOPTCF   DS    0H                  CONFIRMED DOLLARS                            
*                                                                               
         CHI   RF,RKQOPCF               CONFIRMED OPTION                        
         JNE   VOPTCFN                                                          
*                                                                               
         OI    REQCSTAT,REQCSCFQ   SET INDICATOR                                
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCFN  DS    0H                                                               
*                                                                               
VOPTUC   DS    0H                  UNCONFIRMED DOLLARS                          
*                                                                               
         CHI   RF,RKQOPUC               UNCONFIRMED OPTION                      
         JNE   VOPTUCN                                                          
*                                                                               
         OI    REQCSTAT,REQCSUCQ   SET INDICATOR                                
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTUCN  DS    0H                                                               
*                                                                               
VOPTCDL  DS    0H                  CURRENT DOLLARS                              
*                                                                               
         CHI   RF,RKQOPCDL              CURRENT DOLLARS OPTION                  
         JNE   VOPTCDLN                                                         
*                                                                               
         OI    REQBLLOP,REQBOCDQ  SET INDICATOR                                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCDLN DS    0H                                                               
*                                                                               
VOPTDR   DS    0H                  DIRECT RESPONSE                              
*                                                                               
         CHI   RF,RKQOPDR               DIRECT RESPONSE OPTION                  
         JNE   VOPTDRN                                                          
*                                                                               
         OI    REQBLLOP,REQBODRQ  SET INDICATOR                                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDRN DS     0H                                                               
*                                                                               
VOPTPPD  DS    0H                  PAID PROGRAMMING                             
*                                                                               
         CHI   RF,RKQOPPPD               PAID PROGRAMMING OPTION                
         JNE   VOPTPPDN                                                         
*                                                                               
         OI    REQBLLOP,REQBOPPQ  SET INDICATOR                                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTPPDN DS    0H                                                               
*                                                                               
VOPTR1   DS    0H                  BILLING OPTION 1                             
*                                                                               
         CHI   RF,RKQOPR1                BILLING OPTION 1                       
         JNE   VOPTR1N                                                          
*                                                                               
         OI    REQBLLOP,REQBOR1Q  SET INDICATOR                                 
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   LABLAREA,10(RE)                                                  
         J     *+20                                                             
         DC    CL16'BILLING OPTION'                                             
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTR1N  DS    0H                                                               
*                                                                               
VOPTR2   DS    0H                  BILLING OPTION 2                             
*                                                                               
         CHI   RF,RKQOPR2                BILLING OPTION 2                       
         JNE   VOPTR2N                                                          
*                                                                               
         OI    REQBLLOP,REQBOR2Q  SET INDICATOR                                 
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   LABLAREA,10(RE)                                                  
         J     *+20                                                             
         DC    CL16'BILLING OPTION'                                             
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTR2N  DS    0H                                                               
*                                                                               
VOPTR3   DS    0H                  BILLING OPTION 3                             
*                                                                               
         CHI   RF,RKQOPR3                BILLING OPTION 3                       
         JNE   VOPTR3N                                                          
*                                                                               
         OI    REQBLLOP,REQBOR3Q  SET INDICATOR                                 
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   LABLAREA,10(RE)                                                  
         J     *+20                                                             
         DC    CL16'BILLING OPTION'                                             
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTR3N  DS    0H                                                               
*                                                                               
VOPTR5   DS    0H                  BILLING OPTION 5                             
*                                                                               
         CHI   RF,RKQOPR5                BILLING OPTION 5                       
         JNE   VOPTR5N                                                          
*                                                                               
         OI    REQBLLOP,REQBOR5Q  SET INDICATOR                                 
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   LABLAREA,10(RE)                                                  
         J     *+20                                                             
         DC    CL16'BILLING OPTION'                                             
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
*        ADD STATION JOIN/LEAVE DATES TO REDATA LIST                            
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RSJLKTYQ',0),RR=RELORGEN                       
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTR5N  DS    0H                                                               
*                                                                               
VOPTLEF  DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPLEF                LEFT OPTION                           
         JNE   VOPTLEFN                                                         
*                                                                               
         MVI   LEFTOPT,C'Y'        RESET OPTION                                 
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTLEFN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPGRN                GRNAD TOTAL OPTION                    
         JNE   VOPTGRNN                                                         
*                                                                               
* THIS IS A BIT TRICKY - IT'S PUTTING A TOTAL ELEM IN THE DRONE                 
* BUFFER AFTER THE REC ELEM TO CREATE GRAND TOTALS.  IT MUST BE                 
* DONE AFTER THE INITDRON CALL, BUT BEFORE ANY OTHER BUFFER ELEMS               
* ARE ADDED.  ALL THAT SHOULD BE IN THE BUFFER CURRENTLY IS 1002.               
*                                                                               
         L     R1,DRCURBUF         PUT IN REPORT TOTALS                         
         MVC   0(2,R1),=X'4802'                                                 
         LA    R1,2(R1)                                                         
         MVC   0(2,R1),=X'820A'                                                 
         MVC   2(8,R1),=C'NOREPORT'                                             
         LA    R1,10(R1)                                                        
         ST    R1,DRCURBUF                                                      
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTGRNN DS    0H                                                               
*                                                                               
VOPTSPC  DS    0H                  SPACING OPTION                               
*                                                                               
         CHI   RF,RKQOPSPC                                                      
         JNE   VOPTSPCN                                                         
*                                                                               
         MVC   SPACOPT,11(R4)      SAVE NUMBER OF LINES TO SPACE                
*                                                                               
         CLI   SPACOPT,1           MUST BE 1 TO 3                               
         JL    VOPTSPCE                                                         
         CLI   SPACOPT,3                                                        
         JH    VOPTSPCE                                                         
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTSPCN DS    0H                                                               
*                                                                               
VOPTDWN  DS    0H                  DOWNLOADING OPTION                           
*                                                                               
         CHI   RF,RKQOPDWN                                                      
         JNE   VOPTDWNN                                                         
*                                                                               
         MVI   DOWNOPT,C'Y'        SET DOWNLOAD OPTION                          
*                                                                               
         OI    REQRTYP,REQTDOWN    SET FOR PQ IDENT                             
*                                                                               
         CLI   CONOUTH+5,0         SKIP IF ANY OUTPUT TYPE REQUESTED            
         JH    VOPTCONT                                                         
*                                                                               
         FOUT  CONOUTH,=CL8'DOWN',8 FORCE OUTPUT TO 'DOWN'                      
         MVI   CONOUTH+5,4         SET LENGTH TO 8                              
         MVC   TWAOUT,CONOUT                                                    
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDWNN DS    0H                                                               
*                                                                               
VOPTWID  DS    0H                  WIDE OPTION                                  
*                                                                               
         CHI   RF,RKQOPWID                                                      
         JNE   VOPTWIDN                                                         
*                                                                               
         MVI   WIDEOPT,C'Y'        RESET WIDE OPTION                            
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTWIDN DS    0H                                                               
*                                                                               
VOPTTRA  DS    0H                  TRACE OPTION                                 
*                                                                               
         CHI   RF,RKQOPTRA                                                      
         JNE   VOPTTRAN                                                         
*                                                                               
         MVI   TRACEOPT,C'Y'                                                    
         MVI   RETRACE,C'Y'                                                     
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTTRAN DS    0H                                                               
*                                                                               
VOPTBCK  DS    0H                  BACKOUT OPTION                               
*                                                                               
         CHI   RF,RKQOPBCK                                                      
         JNE   VOPTBCKN                                                         
*                                                                               
         OI    REQCFOPT,REQCFBCK   SET GLOBAL INDICATOR FOR OPTION              
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBCKN DS    0H                                                               
*                                                                               
VOPTNAR  DS    0H                  NARROW REPORT OPTION                         
*                                                                               
         CHI   RF,RKQOPNAR                                                      
         JNE   VOPTNARN                                                         
*                                                                               
         MVI   NARROPT,C'Y'         SET NARROW OPTION                           
         MVI   LEFTOPT,C'Y'         FORCE LEFT OPTION                           
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTNARN DS    0H                                                               
*                                                                               
VOPTDTL  DS    0H                  ALL DETAILS OPTION                           
*                                                                               
         CHI   RF,RKQOPDTA                                                      
         JNE   VOPTDTLN                                                         
*                                                                               
         OI    DRINDS,X'02'        SET ALL DETAILS OPTION                       
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDTLN DS    0H                                                               
*                                                                               
VOPTTOT  DS    0H                  ALL TOTALS OPTION                            
*                                                                               
         CHI   RF,RKQOPTOT                                                      
         JNE   VOPTTOTN                                                         
*                                                                               
         OI    DRINDS,X'04'                                                     
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTTOTN DS    0H                                                               
*                                                                               
VOPTATD  DS    0H                  ACTIVITY DATE RANGE                          
*                                                                               
         CHI   RF,RKQOPATD                                                      
         JNE   VOPTATDN                                                         
*                                                                               
         BRAS  RE,ATDVAL                                                        
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTATDN DS    0H                                                               
*                                                                               
VOPTTAP  DS    0H                  TAPE OPTION                                  
*                                                                               
         CHI   RF,RKQOPTAP                                                      
         JNE   VOPTTAPN                                                         
*                                                                               
         MVI   REQTAPE,C'Y'        SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTTAPN DS    0H                                                               
*                                                                               
VOPTPBL  DS    0H                  PRINT ZEROS AS BLANKS                        
*                                                                               
         CHI   RF,RKQOPPBL                                                      
         JNE   VOPTPBLN                                                         
*                                                                               
         MVI   REQPZERO,C'N'       SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTPBLN DS    0H                                                               
*                                                                               
VOPTPZR  DS    0H                  PRINT ZEROS AS ZEROS                         
*                                                                               
         CHI   RF,RKQOPPZR                                                      
         JNE   VOPTPZRN                                                         
*                                                                               
         MVI   REQPZERO,C'Y'       SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTPZRN DS    0H                                                               
*                                                                               
VOPTNHD  DS    0H                  NO HEADINGS                                  
*                                                                               
         CHI   RF,RKQOPNHD                                                      
         JNE   VOPTNHDN                                                         
*                                                                               
         OI    SPECOPT,GLDLNOHD    SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTNHDN DS    0H                                                               
*                                                                               
VOPTSTP  DS    0H                  STRIP                                        
*                                                                               
         CHI   RF,RKQOPSTP                                                      
         JNE   VOPTSTPN                                                         
*                                                                               
         OI    SPECOPT,GLDLSTRP    SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTSTPN DS    0H                                                               
*                                                                               
VOPTNTR  DS    0H                  NO TRUNCATION                                
*                                                                               
         CHI   RF,RKQOPNTR                                                      
         JNE   VOPTNTRN                                                         
*                                                                               
         OI    SPECOPT,GLDLNOTR    SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTNTRN DS    0H                                                               
*                                                                               
VOPTALF  DS    0H                  ALL DOWNLOAD IS ALPHA                        
*                                                                               
         CHI   RF,RKQOPALF                                                      
         JNE   VOPTALFN                                                         
*                                                                               
         OI    SPECOPT,GLDLALPH    SET OPTION                                   
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTALFN DS    0H                                                               
*                                                                               
VOPTDTP  DS    0H                  DOWNLOAD TO TAPE                             
*                                                                               
         CHI   RF,RKQOPDTP                                                      
         JNE   VOPTDTPN                                                         
*                                                                               
         OI    SPECOPT,GLDLALPH+GLDLSTRP+GLDLNOHD+GLDLNOTR+GLDLACTV             
         MVI   DOWNOPT,C'Y'                                                     
*                                                                               
         OI    REQRTYP,REQTDOWN    SET FOR PQ IDENT                             
*                                                                               
         CLI   CONOUTH+5,0         SKIP IF ANY OUTPUT TYPE REQUESTED            
         JH    VOPTCONT                                                         
*                                                                               
         FOUT  CONOUTH,=CL8'DOWN',8 FORCE OUTPUT TO 'DOWN'                      
         MVI   CONOUTH+5,4         SET LENGTH TO 8                              
         MVC   TWAOUT,CONOUT                                                    
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDTPN DS    0H                                                               
*                                                                               
VOPTDHD  DS    0H                  DOWNLOAD HEADLINES                           
*                                                                               
         CHI   RF,RKQOPDHD                                                      
         JNE   VOPTDHDN                                                         
*                                                                               
         OI    SPECOPT,GLDLHEAD                                                 
         MVI   DOWNOPT,C'Y'                                                     
*                                                                               
         OI    REQRTYP,REQTDOWN    SET FOR PQ IDENT                             
*                                                                               
         CLI   CONOUTH+5,0         SKIP IF ANY OUTPUT TYPE REQUESTED            
         JH    VOPTCONT                                                         
*                                                                               
         FOUT  CONOUTH,=CL8'DOWN',8 FORCE OUTPUT TO 'DOWN'                      
         MVI   CONOUTH+5,4         SET LENGTH TO 8                              
         MVC   TWAOUT,CONOUT                                                    
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDHDN DS    0H                                                               
*                                                                               
VOPTDTO  DS    0H                  DOWNLOAD TOTALS                              
*                                                                               
         CHI   RF,RKQOPDTL                                                      
         JNE   VOPTDTON                                                         
*                                                                               
         OI    SPECOPT,GLDLTOTS                                                 
         MVI   DOWNOPT,C'Y'                                                     
*                                                                               
         CLI   22(R4),C' '         IF TOTAL CHARACTER GIVEN                     
         JNH   *+10                                                             
         MVC   SPECCHAR,22(R4)        PASS IT ON                                
*                                                                               
         OI    REQRTYP,REQTDOWN    SET FOR PQ IDENT                             
*                                                                               
         CLI   CONOUTH+5,0         SKIP IF ANY OUTPUT TYPE REQUESTED            
         JH    VOPTCONT                                                         
*                                                                               
         FOUT  CONOUTH,=CL8'DOWN',8 FORCE OUTPUT TO 'DOWN'                      
         MVI   CONOUTH+5,4         SET LENGTH TO 8                              
         MVC   TWAOUT,CONOUT                                                    
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDTON DS    0H                                                               
*                                                                               
VOPTDTT  DS    0H                  DOWNLOAD TEXT                                
*                                                                               
         CHI   RF,RKQOPDTT                                                      
         JNE   VOPTDTTN                                                         
*                                                                               
         OI    SPECOPT,GLDLTOTS                                                 
         OI    SPECOPT2,GLDLTTXT                                                
         MVI   DOWNOPT,C'Y'                                                     
*                                                                               
         CLI   22(R4),C' '         IF TOTAL CHARACTER GIVEN                     
         JNH   *+10                                                             
         MVC   SPECCHAR,22(R4)        PASS IT ON                                
*                                                                               
         OI    REQRTYP,REQTDOWN    SET FOR PQ IDENT                             
*                                                                               
         CLI   CONOUTH+5,0         SKIP IF ANY OUTPUT TYPE REQUESTED            
         JH    VOPTCONT                                                         
*                                                                               
         FOUT  CONOUTH,=CL8'DOWN',8 FORCE OUTPUT TO 'DOWN'                      
         MVI   CONOUTH+5,4         SET LENGTH TO 8                              
         MVC   TWAOUT,CONOUT                                                    
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTDTTN DS    0H                                                               
*                                                                               
VOPTYMD  DS    0H                  DATES IN YYMMDD FORMAT                       
*                                                                               
         CHI   RF,RKQOPYMD                                                      
         JNE   VOPTYMDN                                                         
*                                                                               
         OI    REQPOPT,REQPOYYM                                                 
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTYMDN DS    0H                                                               
*                                                                               
VOPTCTY  DS    0H                  DATES IN CCYYMMDD FORMAT                     
*                                                                               
         CHI   RF,RKQOPCYM                                                      
         JNE   VOPTCTYN                                                         
*                                                                               
         OI    REQPOPT,REQPOYYM+REQPOCTY                                        
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCTYN DS    0H                                                               
*                                                                               
VOPTTOP  DS    0H                  REPORT ONLY TOP RANKED                       
*                                                                               
         CHI   RF,RKQOPTOP                                                      
         JNE   VOPTTOPN                                                         
*                                                                               
         TM    3(R4),X'80'         ENSURE NUMERIC INPUT                         
         JNO   VOPTTOPE                                                         
*                                                                               
         MVC   MAXRANK+1(3),9(R4)  SAVE CUTOFF NUMBER                           
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTTOPN DS    0H                                                               
*                                                                               
VOPTMTL  DS    0H                  SUPPRESS TOTALS IF ONLY ONE DETAIL           
*                                                                               
         CHI   RF,RKQOPMNT                                                      
         JNE   VOPTMTLN                                                         
*                                                                               
         NI    DRINDS,X'FF'-X'04'  REMOVE X'04'                                 
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTMTLN DS    0H                                                               
*                                                                               
VOPTCUT  DS    0H                  NO SECOND LINES IN OUTPUT                    
*                                                                               
         CHI   RF,RKQOPCUT                                                      
         JNE   VOPTCUTN                                                         
*                                                                               
         OI    REQPOPT,REQPOCUT                                                 
         OI    SPECOPT,GLDLCUT                                                  
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCUTN DS    0H                                                               
*                                                                               
VOPTNRQ  DS    0H                  SKIP REQUEST DETAIL PAGE                     
*                                                                               
         CHI   RF,RKQOPNRD                                                      
         JNE   VOPTNRQN                                                         
*                                                                               
         OI    GENSTAT2,NOREQDET                                                
         MVI   NOREQDTL,C'Y'                                                    
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTNRQN DS    0H                                                               
*                                                                               
VOPTXBX  DS    0H                  BOX LINE AT END OF ROWS                      
*                                                                               
         CHI   RF,RKQOPXBX                                                      
         JNE   VOPTXBXN                                                         
*                                                                               
         OI    REQGLOPS,GLEXTBOX   TEMP INDICATOR                               
         MVI   XBOXSW,C'Y'                                                      
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTXBXN DS    0H                                                               
*                                                                               
VOPTSLD  DS    0H                  SOLID                                        
*                                                                               
         CHI   RF,RKQOPSLD                                                      
         JNE   VOPTSLDN                                                         
*                                                                               
         OI    REQGLOPS,GLPWHOLE   TEMP INDICATOR                               
         MVI   XBOXSW,C'Y'                                                      
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTSLDN DS    0H                                                               
*                                                                               
VOPTCMB  DS    0H                  COMBOS                                       
*                                                                               
         CHI   RF,RKQOPCMB                                                      
         JNE   VOPTCMBN                                                         
*                                                                               
         CLI   1(R4),0             IF NO VALUE ENTERED                          
         JNE   *+12                                                             
         MVI   RECOMBO,C'Y'           DEFAULT TO 'Y'                            
         J     VOPTCMB9                                                         
*                                                                               
         CLI   22(R4),C'N'         COMBOS OPTION MUST BE Y OR N                 
         JE    *+8                                                              
         CLI   22(R4),C'Y'                                                      
         JNE   VOPTCMBE                                                         
*                                                                               
         MVC   RECOMBO,22(R4)      SAVE COMBOS OPTION                           
*                                                                               
VOPTCMB9 DS    0H                                                               
*                                                                               
         MVC   CODEAREA(1),RECOMBO                                              
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTCMBX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCMBN DS    0H                                                               
*                                                                               
VOPTALT  DS    0H                  USE ALTERNATE CALENDAR                       
*                                                                               
         CHI   RF,RKQOPALT                                                      
         JNE   VOPTALTN                                                         
*                                                                               
         OI    REQCSTAT,REQCSACQ   FLAG FOR ALTERNATE CALENDAR                  
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(18),10(RE)                                              
         J     *+22                                                             
         DC    CL18'ALTERNATE CALENDAR'                                         
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTALTX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTALTN DS    0H                                                               
*                                                                               
VOPTFR   DS    0H                  EXCLUDE FORECAST DOLLARS                     
*                                                                               
         CHI   RF,RKQOPFR                                                       
         JNE   VOPTFRN                                                          
*                                                                               
         OI    REQCSTAT,REQCSFRQ   FLAG TO SHOW FORECAST ORDERS ONLY            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(20),10(RE)                                              
         J     *+24                                                             
         DC    CL20'FORECAST ORDERS ONLY'                                       
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTFRX DS     0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTFRN  DS    0H                                                               
*                                                                               
VOPTXFR  DS    0H                  EXCLUDE FORECAST DOLLARS                     
*                                                                               
         CHI   RF,RKQOPXFR                                                      
         JNE   VOPTXFRN                                                         
*                                                                               
         OI    REQCSTAT,REQCSXFQ   FLAG TO EXCLUDE FORECAST ORDERS              
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(24),10(RE)                                              
         J     *+28                                                             
         DC    CL24'EXCLUDE FORECAST ORDERS'                                    
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTXFRX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTXFRN DS    0H                                                               
*                                                                               
VOPTDCT  DS    0H                  DEVELOPMENTAL CONTRACT TYPE                  
*                                                                               
         CHI   RF,RKQOPDCT                                                      
         JNE   VOPTDCTN                                                         
*                                                                               
         BRAS  RE,DCTVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RDCTKTYQ',0),RR=RELORGEN                       
*                                  ADD DEV CONTRACT TYPE TO TABLES              
         J     VOPTCONT                                                         
*                                                                               
VOPTDCTN DS    0H                                                               
*                                                                               
VOPTDS   DS    0H                  DEVELOPMENTAL SALESPERSON                    
*                                                                               
         CHI   RF,RKQOPDSP                                                      
         JNE   VOPTDSN                                                          
*                                                                               
         BRAS  RE,DSPVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RDSPKTYQ',0),RR=RELORGEN                       
*                                  ADD DEV SALPERSON TO TABLES                  
         J     VOPTCONT                                                         
*                                                                               
VOPTDSN DS     0H                                                               
*                                                                               
VOPTMKT  DS    0H                  MARKET                                       
*                                                                               
         CHI   RF,RKQOPMKT                                                      
         JNE   VOPTMKTN                                                         
*                                                                               
         BRAS  RE,MKTVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RMKTKTYQ',0),RR=RELORGEN                       
*                                  ADD MARKET TO TABLES                         
         J     VOPTCONT                                                         
*                                                                               
VOPTMKTN DS    0H                                                               
*                                                                               
VOPTOWN  DS    0H                  OWNER                                        
*                                                                               
         CHI   RF,RKQOPOWN                                                      
         JNE   VOPTOWNN                                                         
*                                                                               
         BRAS  RE,OWNVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('ROWNKTYQ',0),RR=RELORGEN                       
*                                  ADD OWNER TO TABLES                          
         J     VOPTCONT                                                         
*                                                                               
VOPTOWNN DS    0H                                                               
*                                                                               
VOPTPP   DS    0H                  POINT PERSON                                 
*                                                                               
         CHI   RF,RKQOPPTP                                                      
         JNE   VOPTPPN                                                          
*                                                                               
         BRAS  RE,PTPVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RPTPKTYQ',0),RR=RELORGEN                       
*                                  ADD POINT PERSON TO TABLES                   
         J     VOPTCONT                                                         
*                                                                               
VOPTPPN DS     0H                                                               
*                                                                               
VOPTCT   DS    0H                  CONTRACT TYPE                                
*                                                                               
         CHI   RF,RKQOPCTY                                                      
         JNE   VOPTCTN                                                          
*                                                                               
         BRAS  RE,CTYVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RCTYKTYQ',0),RR=RELORGEN                       
*                                  ADD CONTRACT TYPE TO TABLES                  
         J     VOPTCONT                                                         
*                                                                               
VOPTCTN DS     0H                                                               
*                                                                               
VOPTNCT  DS    0H                  NETWORK CONTRACT TYPE                        
*                                                                               
         CHI   RF,RKQOPNCT                                                      
         JNE   VOPTNCTN                                                         
*                                                                               
         TM    3(R4),X'80'         ENTRY MUST BE NUMERIC                        
         JNE   VOPTNCTE                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          CONTRACT NUMBER LENGTH                       
         JZ    VOPTCONE            NOTHING ENTERED                              
         CHI   RF,8                MAX 8 DIGITS                                 
         JH    VOPTCONE                                                         
*                                                                               
         EX    RF,*+8                                                           
         J     *+10                                                             
         PACK  WORK(5),22(0,R4)    PACK FOR EXTRA BYTE                          
*                                                                               
         MVC   REFNCT,WORK         SAVE NETWORK CONTRACT NUMBER                 
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RPRDKTYQ',0),RR=RELORGEN NEED PRD TAB          
*                                                                               
         UNPK  CODEAREA(9),REFNCT(5)  DISPLAY NUMBER                            
         MVI   CODEAREA+8,C' '     KILL EXTRANEOUS BYTE                         
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTNCTX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTNCTN DS    0H                                                               
*                                                                               
*        VALIDATE STATION TYPE CODE                                             
*                                                                               
VOPTSTY  DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPSTY               STATION TYPE FILTER                    
         JNE   VOPTSTYN                                                         
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         JE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         JNE   VOPTSTHX                                                         
*                                                                               
         GOTOR VREHELP,DMCB,=AL2(RKQHMSTP),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         J     VOPTERR                                                          
*                                                                               
VOPTSTHX DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQSTTPS)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   VOPTTPNE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   REFSTTP,VLTICODE+1  STATION TYPE                                 
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RSTAKTYQ',0),RR=RELORGEN NEED STA TAB          
*                                                                               
         MVC   NAMEAREA,VLTFULL    DESCRIPTION                                  
         OC    NAMEAREA,SPACES     SPACE FILL                                   
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTSTYX DS    0H                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTSTYN DS    0H                                                               
*                                                                               
VOPTCON  DS    0H                  CONTRACT NUMBER                              
*                                                                               
         CHI   RF,RKQOPCON                                                      
         JNE   VOPTCONN                                                         
*                                                                               
         TM    3(R4),X'80'         ENTRY MUST BE NUMERIC                        
         JNO   VOPTCONE                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          CONTRACT NUMBER LENGTH                       
         JZ    VOPTCONE            NOTHING ENTERED                              
         CHI   RF,8                MAX 8 DIGITS                                 
         JH    VOPTCONE                                                         
*                                                                               
         EX    RF,*+8                                                           
         J     *+10                                                             
         PACK  WORK(5),22(0,R4)    PACK FOR EXTRA BYTE                          
*                                                                               
         MVC   REFCON,WORK         SAVE CONTRACT NUMBER                         
*                                                                               
         UNPK  CODEAREA(9),REFCON(5)  DISPLAY CONTRACT NUMBER                   
         MVI   CODEAREA+8,C' '     CLEAR EXTRANEOUS BYTE                        
*                                                                               
         BRAS  RE,PRTOPT                                                        
*                                                                               
VOPTCONX DS    0H                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTCONN DS    0H                                                               
*                                                                               
VOPTCLS  DS    0H                  CLASS                                        
*                                                                               
         CHI   RF,RKQOPCLS                                                      
         JNE   VOPTCLSN                                                         
*                                                                               
         BRAS  RE,CLSVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RCLSKTYQ',0),RR=RELORGEN                       
*                                  ADD DEV CONTRACT TYPE TO TABLES              
         J     VOPTCONT                                                         
*                                                                               
VOPTCLSN DS    0H                                                               
*                                                                               
VOPTCTG  DS    0H                  CATEGORY                                     
*                                                                               
         CHI   RF,RKQOPCAT                                                      
         JNE   VOPTCTGN                                                         
*                                                                               
         BRAS  RE,CTGVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RCTGKTYQ',0),RR=RELORGEN                       
*                                  ADD CATEGORY TO TABLES                       
         J     VOPTCONT                                                         
*                                                                               
VOPTCTGN DS    0H                                                               
*                                                                               
VOPTREP  DS    0H                  REPTRAREP TYPE                               
*                                                                               
         CHI   RF,RKQOPREP                                                      
         JNE   VOPTREPN                                                         
*                                                                               
         BRAS  RE,REPVAL                                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RREPKTYQ',0),RR=RELORGEN                       
*                                  ADD REP TO TABLES                            
         J     VOPTCONT                                                         
*                                                                               
VOPTREPN DS    0H                                                               
*                                                                               
*        COMPETITIVE ANALYSIS OPTIONS                                           
*                                                                               
         CHI   RF,RKQOPBPD               PENDING CONTRACTS ONLY                 
         JNE   VOPTBPDN                                                         
*                                                                               
         OI    REQCOMPF,REQCFPDQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(22),10(RE)                                              
         J     *+26                                                             
         DC    CL22'PENDING CONTRACTS ONLY'                                     
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTBPDX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBPDN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPBIN               INCOMPLETE CONTRACTS ONLY              
         JNE   VOPTBINN                                                         
*                                                                               
         OI    REQCOMPF,REQCFINQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(26),10(RE)                                              
         J     *+30                                                             
         DC    CL26'INCOMPLETE CONTRACTS ONLY'                                  
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTBINX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBINN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPBCM               COMPLETE CONTRACTS ONLY                
         JNE   VOPTBCMN                                                         
*                                                                               
         OI    REQCOMPF,REQCFCPQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(24),10(RE)                                              
         J     *+28                                                             
         DC    CL24'COMPLETE CONTRACTS ONLY'                                    
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTBCMX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBCMN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPBLS               LOST CONTRACTS ONLY                    
         JNE   VOPTBLSN                                                         
*                                                                               
         OI    REQCOMPF,REQCFLSQ   SET FOR INDICATOR                            
*                                                                               
         MVC   LABLAREA,SPACES                                                  
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(20),10(RE)                                              
         J     *+24                                                             
         DC    CL20'LOST CONTRACTS ONLY'                                        
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTBLSX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTBLSN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPXPD               EXCLUDE PENDING CONTRACTS              
         JNE   VOPTXPDN                                                         
*                                                                               
         OI    REQCMPFX,REQCFPDQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(26),10(RE)                                              
         J     *+30                                                             
         DC    CL26'EXCLUDE PENDING CONTRACTS'                                  
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTXPDX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTXPDN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPXIN               EXCLUDE INCOMPLETE CONTRACTS           
         JNE   VOPTXINN                                                         
*                                                                               
         OI    REQCMPFX,REQCFINQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(28),10(RE)                                              
         J     *+32                                                             
         DC    CL28'EXCLUDE INCOMPLETE CONTRACTS'                               
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTXINX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTXINN DS    0H                                                               
*                                                                               
*                                                                               
         CHI   RF,RKQOPXCM               EXCLUDE COMPLETE CONTRACTS             
         JNE   VOPTXCMN                                                         
*                                                                               
         OI    REQCMPFX,REQCFCPQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(26),10(RE)                                              
         J     *+30                                                             
         DC    CL26'EXCLUDE COMPLETE CONTRACTS'                                 
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTXCMX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTXCMN DS    0H                                                               
*                                                                               
         CHI   RF,RKQOPXLS               EXCLUDE LOST CONTRACTS                 
         JNE   VOPTXLSN                                                         
*                                                                               
         OI    REQCMPFX,REQCFLSQ   SET FOR INDICATOR                            
*                                                                               
         BASR  RE,0                WHERE ARE WE                                 
         MVC   NAMEAREA(22),10(RE)                                              
         J     *+26                                                             
         DC    CL22'EXCLUDE LOST CONTRACTS'                                     
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTXLSX DS    0H                                                               
*                                                                               
         J     VOPTCONT                                                         
*                                                                               
VOPTXLSN DS    0H                                                               
*                                                                               
VOPTCONT DS    0H                                                               
*                                                                               
         LA    R4,42(R4)           NEXT SCANNER CHUNK                           
         AI    FIELDERR,1          BUMP FIELD COUNTER                           
         BRCT  R0,VOPTLOOP         PROCESS NEXT OPTION                          
*                                                                               
VOPTDONE DS    0H                                                               
*                                                                               
         J     VVALOPTX                                                         
*                                                                               
VVALOPTX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
*                                                                               
*        ERROR MESSAGES                                                         
*                                                                               
VOPTAURE LHI   RF,RWEOPAUR         OPTION VALID ONLY FOR AUR REPORT             
         J     VOPTERR                                                          
*                                                                               
VOPTBOXE LHI   RF,RWEOPBOX         BOX OPTION MUST BE Y OR N                    
         J     VOPTERR                                                          
*                                                                               
VOPTCMBE LHI   RF,RWEOPCMB         COMBOS OPTION MUST BE Y OR N                 
         J     VOPTERR                                                          
*                                                                               
VOPTSPCE LHI   RF,RWEOPSPC         SPACE OPTION MUST BE 1 TO 3                  
         J     VOPTERR                                                          
*                                                                               
VOPTNVE  LHI   RF,RWEOPNV          INVALID OPTION                               
         J     VOPTERR                                                          
*                                                                               
VOPTTOPE LHI   RF,RWEOPTOP         TOP VALUE MUST BE NUMERIC                    
         J     VOPTERR                                                          
*                                                                               
VOPTNCTE LHI   RF,RWEOPNCT         NETWORK CONTRACT MUST BE NUMERIC             
         J     VOPTERR                                                          
*                                                                               
VOPTCONE LHI   RF,RWEOPCON         CONTRACT NUMBER MUST BE NUMERIC              
         J     VOPTERR                                                          
*                                                                               
VOPTSONE DS    0H                  NOT ALLOWED FOR SOON REQUEST                 
         LHI   RF,RWENSOON                                                      
         J     VOPTERR                                                          
*                                                                               
VOPTTPNE DS    0H                  STATION FILTER CODE NOT VALID                
         LHI   RF,RWEFOPNV                                                      
         J     VOPTERR                                                          
*                                                                               
VOPTAADE DS    0H                  ASATDATE OPTION MUST BE LAST OPTION          
         LHI   RF,RWEAADLS                                                      
         J     VOPTERR                                                          
*                                                                               
VOPTAD2E DS    0H                  ASATDATE OPTION WON'T FIT ON LINE            
         LHI   RF,RWEAADLG                                                      
         J     VOPTERR                                                          
*                                                                               
VOPTBKBE DS    0H                                                               
         LHI   RF,RWEBKBNV         BACK BILLING OPTION NOT VALID                
         J     VOPTERR                                                          
*                                                                               
VOPTBTPE DS    0H                                                               
         LHI   RF,RWEBTSNV         STATION BUDGET TYPE NOT VALID                
         J     VOPTERR                                                          
*                                                                               
VOPTCCD1 DS     0H                 CREATION DATE RANGE REQUIRED                 
         LHI   RF,RWECCDMS         SET ERROR CODE                               
         J     VOPTERR                                                          
*                                                                               
VOPTCCD2 DS    0H                  CREATION DATE INVALID                        
         LHI   RF,RWECCDNV         SET ERROR CODE                               
         J     VOPTERR                                                          
*                                                                               
VOPTCCD3 DS    0H                  CREATION DATE START BEFORE END               
         LHI   RF,RWECCD2E         SET ERROR CODE                               
         J     VOPTERR                                                          
*                                                                               
VOPTEQUE DS    0H                  EXTRANEOUS DATA FOR OPTION                   
         LHI   RF,RWEOPTEQ         SET ERROR CODE                               
         J     VOPTERR                                                          
*                                                                               
VOPTRG1E DS    0H                  AS-AT-DATES NOT COMPATIBLE WITH              
         LHI   RF,RWENRG1Q         NRRG REPORTS                                 
         J     VOPTERR                                                          
*                                                                               
VOPTERR  DS    0H                                                               
         ST    R4,DMCB+8           SAVE ERROR POINTER                           
         STCM  RF,3,RERROR         SET ERROR MESSAGE CODE                       
         GOTO1 CURSERR                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VOPTINIT'                 
***********************************************************************         
*                                                                     *         
*              OPTION VALIDATION INITIALISATION                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VOPTINIT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         MVI   BOXOPT,C'Y'         PRESET VALUES                                
         MVI   LEFTOPT,C'N'                                                     
         MVI   SPACOPT,1                                                        
         MVI   DOWNOPT,C'N'                                                     
         MVI   DRINDS,X'08'        DROP REJECTED PRINT LINES                    
         MVI   FISCOPT,1                                                        
         MVI   THOUOPT,C'N'                                                     
         MVI   WIDEOPT,C'N'                                                     
         MVI   TRACEOPT,C'N'                                                    
         MVI   BRACKOPT,C'N'                                                    
         MVI   GRANDOPT,C'N'                                                    
         MVI   NARROPT,C'N'                                                     
         MVI   TESTOPT,0                                                        
         MVI   RECOMBO,0           REPORT COMBOS AND NON-COMBOS                 
         MVI   REQCSTAT,0          CONTRACT STATUS FILTER                       
         MVI   SPECOPT,0                                                        
         MVI   SPECOPT2,0                                                       
         MVI   FLAVOR,C'C'         DEFAULT TO CONTRACT FLAVOR                   
         MVI   REFLAVOR,C'C'                                                    
         MVI   REFSTTP,0                                                        
         MVI   REFBKBOP,0          INIT BACKBILLING OPTION                      
         MVC   CODESHTL,SPACES                                                  
         MVC   LABLAREA,SPACES                                                  
         MVI   REQCOMPF,0          INIT COMPETITIVE FILTER                      
         XC    REQADTS,REQADTS     INIT ACTIVITY PERIOD                         
         XC    REXFREP(REXFREPL),REXFREP  INIT XFILE REPS                       
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT4V-VLPARMS(R1),RKVFLCON   SET FLAVOR FILTER                 
*                                                                               
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVC   HCBFLVR-HELPCB(L'HCBFLVR,RF),FLAVOR                              
*                                                                               
         MVC   LABLAREA,SPACES     INIT SOME AREAS                              
         MVC   CODEAREA,SPACES                                                  
         MVC   NAMEAREA,SPACES                                                  
*                                                                               
VOPTINIX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - PRTOPT'                     
***********************************************************************         
*                                                                     *         
*        ADD ITEM TO TABLE OF OPTIONS TO BE PRINTED                   *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*              DDVAL BLOCK IS FOR OPTION TO BE PRINTED                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PRTOPT   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   PRTOPTX                                                          
*                                                                               
         ICM   R6,15,OPTPRTBA      POINT TO OPTIONS PRINT BUFFER                
         BZ    PRTOPTX             SKIP IF NO BUFFER AVAILABLE                  
*                                                                               
         USING OPTPRTD,R6          ESTABLISH BUFFER                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,OPPHENTN       GET NUMBER OF ENTRIES SO FAR                 
         LA    RF,1(RF)            POINT TO NEXT AVAILABLE SLOT IN TAB          
*                                                                               
         CLM   RF,1,=AL1(OPPMAXQ)  MAKE SURE THERE IS ROOM IN TABLE             
         BH    PRTOPTX             SKIP PRINTING IF NO ROOM                     
*                                                                               
         STC   RF,OPPHENTN         SAVE NEW NUMBER                              
*                                                                               
         LA    RE,OPPENTLQ         LENGTH OF ENTRY IN TABLE                     
*                                                                               
         BCTR  RF,0                DECREMENT FOR INDEXING                       
         MR    RE,RE               INDEX FACTOR FOR NEXT ENTRY                  
         LA    R4,OPPTAB(RF)       POINT TO NEXT AVAILABLE ENTRY                
         USING OPPENTD,R4          ESTABLISH TABLE ENTRY                        
*                                                                               
         MVC   OPPENTD(OPPENTLQ),SPACES INIT ENTRY                              
*                                                                               
         L     R5,AVLTAB           POINT TO DDVAL TABLE ENTRY                   
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   OPPTTLSH,CODESHTL   SET SHORT TITLE                              
         MVC   OPPTTL,LABLAREA     SET TITLE                                    
         MVC   OPPCODE,CODEAREA    COPY CURRENT CODE                            
         MVC   OPPNAME,NAMEAREA    COPY CURRENT NAMEAREA                        
*                                                                               
         MVC   CODESHTL,SPACES     CLEAR CODE AND NAME                          
         MVC   LABLAREA,SPACES     CLEAR CODE AND NAME                          
         MVC   CODEAREA,SPACES     CLEAR CODE AND NAME                          
         MVC   NAMEAREA,SPACES                                                  
*                                                                               
PRTOPTX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VOPTTTL'                    
***********************************************************************         
*                                                                     *         
*        HANDLE REPORT TITLE                                          *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*        R5==> VALIDATION TABLE                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VOPTTTL  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
*                                                                               
         CLC   VLTSHORT,SPACES     IF THERE IS A SHORT NAME                     
         BNH   *+14                                                             
         MVC   CODESHTL,VLTSHORT      USE IT AS THE SHORT TITLE                 
         B     VOPTSHRX                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,VLTMINI        GET MINIMUM INPUT LENGTH                     
         BNZ   *+8                                                              
         LA    RF,L'VLTSHORT       DEFAULT TO LENGTH OF SHORT NAME              
*                                                                               
         CHI   RF,L'VLTSHORT       MAX LENGTH IS THAT OF SHORT NAME             
         BNH   *+8                                                              
         LA    RF,L'VLTSHORT       DEFAULT TO LENGTH OF SHORT NAME              
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODESHTL(0),VLTFULL   SET SHORT TITLE FOR PRINTING               
*                                                                               
VOPTSHRX DS    0H                                                               
*                                                                               
         MVC   LABLAREA,VLTFULL    SET TITLE FOR PRINTING                       
*                                                                               
         LA    RE,L'LABLAREA       MAX TITLE LENGTH                             
         LA    R1,LABLAREA         POINT TO LAST BYTE OF TITLE                  
         AR    R1,RE                                                            
         BCTR  R1,0                                                             
*                                                                               
         CLI   0(R1),C' '          FIND LAST CHARACTER IN TITLE                 
         BH    *+14                                                             
         BCTR  R1,0                                                             
         BCT   RE,*-10                                                          
         B     VOPTTTLX            NO TITLE                                     
*                                                                               
         CLI   0(R1),C'+'          IF LAST CHARCTER IS '+', ERASE IT            
         BNE   *+10                                                             
         MVI   0(R1),C' '                                                       
         BCTR  R1,0                   BACK UP A BYTE                            
*                                                                               
         CLI   0(R1),C'='          IF LAST CHARCTER IS '=', ERASE IT            
         BNE   *+12                                                             
         MVI   0(R1),C' '                                                       
         B     VOPTTTLX                                                         
*                     ELSE PUT OPTION IN NAMEAREA WHICH IS BIGGER               
*                                                                               
         MVC   NAMEAREA,VLTFULL    OPTION TO NAMEAREA                           
         MVC   LABLAREA,SPACES     CLEAR LABEL AREA                             
*                                                                               
VOPTTTLX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - ATDVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE ACTIVITY DATE RANGE                                 *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ATDVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    WORK,WORK                                                        
*                                                                               
*        CHECK IF RFP SYMBOLIC PARAMETER ENTERED                                
*                                                                               
         OC    ARFPBLK,ARFPBLK     SKIP IF RFP NOT BEING USED                   
         BZ    ATDVRFPN                                                         
*                                                                               
         L     R6,ARFPBLK          ESTABLISH RFP BLOCK                          
         USING RFPBLK,R6                                                        
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,RFPVNUMS       NUMBER OF VIABLE SYMBOLIC NAMES              
         BZ    ATDVRFPN            NONE                                         
*                                                                               
         LH    RF,=Y(RFPXTNSN-RFPBLK)  USE EXTENDED SYMBOL TABLE                
         LA    RF,RFPBLK(RF)                                                    
*                                                                               
         USING RFPVSYMS,RF         ESTABLISH SYMBOL TABLE                       
*                                                                               
         CLC   RFPVSYMB(20),22(R4) MATCH INPUT TO SYMBOLIC PARAMETER            
         BE    *+10                   EXPANDED FORMAT                           
         CLC   RFPVSYME(L'RFPVSYME-1),22(R4) MATCH INPUT TO SYMB PARM           
         BE    *+16                  ESCAPE SEQ IN CASE LEFT OVER               
*                                     FROM LAST TRANSACTION                     
         LA    RF,RFPVSYML(RF)     BUMP TO NEXT SYMBOLIC PARAMETER              
         BCT   RE,*-24                                                          
         B     ATDVRFPN            NO SYMBOLIC PARAMETER FOUND                  
*                                                                               
         CLC   =AL2(RE#RFSAT),RFPVSYME+1 MUST BE ASATDATE SYMBOLIC              
         BNE   ATDVNVE                                                          
*                                                                               
         CLM   R0,1,=AL1(1)        MUST BE LAST OPTION                          
         BNE   ATDVLSTE                                                         
*                                                                               
         SR    R1,R1                                                            
         IC    R1,8(R4)            DISPLACEMENT OF DATE IN FIELD                
         LA    R1,8(R1,R2)         POINT TO DATE AREA                           
         MVC   0(17,R1),SPACES     INIT DATE                                    
         MVC   0(L'RFPVSYME,R1),RFPVSYME REPLACE KEYWORD WITH ESC SEQ           
*                                                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
*                                                                               
         IC    RE,1(R4)            LENGTH OF DATE AS ENTERED                    
         IC    RF,5(R2)            CURRENT LENGTH OF INPUT                      
*                                                                               
         SR    RF,RE               LENGTH WITHOUT DATE                          
*                                                                               
         LA    RF,17(RF)           LENGTH WITH MAX DATE                         
*                                                                               
         LA    RF,16(RF)           MAKE SURE IT WILL FIT IN FIELD               
         CLM   RF,1,0(R2)                                                       
         BH    ATDVAD2E                                                         
*                                                                               
         SH    RF,=H'16'           RESTORE INPUT LENGTH                         
*                                                                               
         STC   RF,5(R2)            CHANGE LENGTH TO MAX INPUT FOR RFP           
         MVI   L'RFPVSYME-1(R1),17   CHG LEN IN ESCAPE SEQ                      
*                                                                               
         B     ATDVALX            VALID ACTIVITY DATE                           
*                                                                               
         DROP  R6,RF                                                            
*                                                                               
ATDVRFPN DS    0H                                                               
*                                                                               
         CLI   1(R4),0              ENTRY REQUIRED AT THIS POINT                
         BE    ATDVMSE                                                          
*                                                                               
         MVI   REQAPER,C'N'        ACTIVITY DTS DIFFER FROM PERIOD DTS          
*                                                                               
         XC    DBLOCKC(256),DBLOCKC                                             
         LA    R6,DBLOCKC                                                       
         USING PERVALD,R6          ESTABLISH PERVAL WORKAREA                    
*                                                                               
         MVC   PVALBSTA,BTODAY     PASS TODAY'S DATE                            
*                                                                               
         L     RF,ACOMFACS         GET PERVAL ADDRESS                           
         L     RF,CPERVAL-COMFACSD(RF)                                          
*                                                                               
         SR    R3,R3                                                            
         IC    R3,1(R4)            INPUT LENGTH                                 
*                                                                               
         LA    R3,PVINDDMM(R3)     DEFAULT TO MMDD INSTEAD OF MMYY              
*                                  VALIDATE PERIOD                              
         GOTO1 (RF),DMCB,((R3),22(R4)),('PVINTOD',(R6))                         
         CLI   4(R1),0             CHECK FOR ERRORS                             
         BNE   ATDVNVE                                                          
*                                                                               
         CLC   PVALBSTA,PVALBEND   START MUST BE BEFORE END                     
         BH    ATDV2E                                                           
*                                                                               
         MVC   REQASTR,PVALESTA    SAVE START DATE                              
         MVC   REQAEND,PVALEEND    SAVE END DATE                                
         MVC   REQAASTR,PVALESTA   SAVE ACTUAL START DATE                       
         MVC   REQAAEND,PVALEEND   SAVE ACTUAL END   DATE                       
*                                                                               
         MVC   QASAT,REQASTR       INIT AS AT DATE                              
*                                                                               
         MVI   BYTE,0                                                           
         GOTO1 GETDAY,(R1),REQASTR,WORK   GET START DAY                         
*                                                                               
         CLC   WORK(3),SPACES                                                   
         BE    ATDVNVE             INVALID START DAY                            
*                                                                               
         CLI   DMCB,1              IF MONDAY, OK                                
         BE    ATDV64                                                           
*                                                                               
         MVI   BYTE,1              BACKUP TO PRIOR MONDAY FOR START             
         ZIC   R0,DMCB                                                          
         BCTR  R0,0                                                             
         LNR   R0,R0                                                            
         GOTO1 ADDAY,DMCB,REQASTR,REQAASTR,(R0)  ACTUAL START DATE              
*                                                                               
ATDV64   DS    0H                                                               
*                                                                               
         GOTO1 GETDAY,(R1),REQAEND,WORK                                         
         CLC   WORK(3),SPACES                                                   
         BE    ATDVNVE             INVALID END DATE                             
*                                                                               
         CLI   DMCB,7              IF SUNDAY, OK                                
         BE    ATDV66                                                           
*                                                                               
         MVI   BYTE,1              FIND FOLLOWING SUNDAY FOR END DATE           
         ZIC   R0,DMCB                                                          
         SH    R0,=H'7'                                                         
         LCR   R0,R0                                                            
         GOTO1 ADDAY,DMCB,REQAEND,REQAAEND,(R0) ACTUAL END DATE                 
*                                                                               
ATDV66   DS    0H                                                               
*                                                                               
         GOTO1 PERVERT,(R1),REQAASTR,REQAAEND NUMBER OF WKS IN PERIOD           
*                                                                               
         MVC   REQAAWKS,DMCB+13    SAVE WEEKS IN PERIOD                         
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE                                   
         BNE   ATDPRTX                                                          
*                                                                               
         MVC   LABLAREA,=CL15'ACTIVITY DATES:'                                  
*                                                                               
         GOTO1 DATCON,DMCB,(X'10',REQASTR),(17,NAMEAREA)                        
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN   PRINT OPTION                            
*                                                                               
ATDPRTX  DS    0H                                                               
*                                                                               
ATDVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
ATDVNVE  DS    0H                  DATE NOT VALID                               
         MVI   ERROR,RWEDTENV                                                   
         B     ATDVERR                                                          
*                                                                               
ATDVMSE  DS    0H                  ACTIVITY DATE MISSING                        
*        MVI   ERROR,RWEATDMS                                                   
         B     ATDVERR                                                          
*                                                                               
ATDV2E   DS    0H                  END BEFORE START                             
         MVI   ERROR,RWEENDST                                                   
         B     ATDVERR                                                          
*                                                                               
ATDVAD2E DS    0H                  ACTIVITY OPTION WON'T FIT ON LINE            
         MVI   ERROR,RWEAADLG                                                   
         B     ATDVERR                                                          
*                                                                               
ATDVLSTE DS    0H                  OPTION MUST BE LAST OPTION                   
         MVI   ERROR,RWEAADLS                                                   
         B     ATDVERR                                                          
*                                                                               
ATDVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - BCDVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE BUY CODE FILTER                                     *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
BCDVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
*        READ BUY CODE RECORD                                                   
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY              ESTABLISH BUY CODE KEY                       
         USING RSPBKEY,R6                                                       
*                                                                               
         MVC   RSPBKREP,AGENCY     SET REP CODE                                 
         MVI   RSPBKTYP,RBCDKTYQ   SET RECORD TYPE                              
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          FILTER LENGTH                                
         BZ    BCVMSE              MUST BE NETERED                              
*                                                                               
         CLC   VLTICODE,=AL2(RKQOPBCD) IF BUY CODE FILTER                       
         BNE   BCVKY10                                                          
*                                                                               
         CHI   RF,3                BUY CODE AT MOST 3 LONG                      
         BH    BCVLONGE                                                         
*                                                                               
         MVI   RSPBKTCD,1             SET BUY CODE TYPE CODE                    
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE                                   
         BNE   *+10                                                             
         MVC   LABLAREA,=CL15'BUY CODE:'                                        
*                                                                               
         B     BCVKY20                                                          
*                                                                               
BCVKY10  DS    0H                                                               
*                                                                               
         CHI   RF,2                BUY FILER AT MOST 2 LONG                     
         BH    BCVLONGE                                                         
*                                                                               
         MVI   RSPBKTCD,0             SET BUY FILTER TYPE CODE                  
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE                                   
         BNE   BCVKY15                                                          
*                                                                               
         MVC   LABLAREA,=CL15'BUY TYPE 1:'                                      
*                                                                               
         CLC   VLTICODE,=AL2(RKQOPBT2) IF BUY TYPE 2 FILTER                     
         BNE   *+10                                                             
         MVC   LABLAREA,=CL15'BUY TYPE 2:'                                      
*                                                                               
BCVKY15  DS    0H                                                               
*                                                                               
BCVKY20  DS    0H                                                               
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RSPBKCOD(0),22(R4)        COPY FILTER CODE                       
*                                                                               
         GOTO1 HIGH                READ RECORD                                  
*                                                                               
         CLC   RSPBKEY,KEYSAVE     MUST FIND RECORD                             
         BNE   BCVNOTFE                                                         
*                                                                               
         CLC   VLTICODE,=AL2(RKQOPBCD) IF BUY CODE FILTER                       
         BNE   *+18                                                             
         OI    REFTYPS3,REFTBCDQ      BUY CODE FILTER PRESENT                   
         MVC   REFBCD,RSPBKCOD     SAVE FILTER                                  
         B     BCVTYPX                                                          
*                                                                               
         CLC   VLTICODE,=AL2(RKQOPBT1) IF BUY TYPE 1 FILTER                     
         BNE   *+18                                                             
         OI    REFTYPS3,REFTBT1Q      BUY TYPE 1 FILTER PRESENT                 
         MVC   REFBT1,RSPBKCOD     SAVE CILTER                                  
         B     BCVTYPX                                                          
*                                                                               
         CLC   VLTICODE,=AL2(RKQOPBT2) IF BUY TYPE 2 FILTER                     
         BNE   *+18                                                             
         OI    REFTYPS3,REFTBT2Q      BUY TYPE 2 FILTER PRESENT                 
         MVC   REFBT2,RSPBKCOD     SAVE CILTER                                  
         B     BCVTYPX                                                          
*                                                                               
BCVTYPX  DS    0H                                                               
*                                                                               
         CLI   OFFLINE,C'Y'        IF OFFLINE                                   
         BNE   BCVPRTX                                                          
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
*                                                                               
         MVC   CODEAREA(3),RSPBKCOD COPY FILTER CODE                            
         MVC   NAMEAREA,RSPBDESC   COPY DESCRIPTION                             
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN   PRINT OPTION                            
*                                                                               
BCVPRTX  DS    0H                                                               
*                                                                               
*        ADD BCODE RECORD TYPE TO REDATA LIST                                   
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RBCDKTYQ',0),RR=RELORGEN                       
*                                                                               
BCDVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
BCVMSE   DS    0H                  FILTER MISSING                               
         LHI   RF,RWEBCDMS                                                      
         STCM  RF,3,RERROR                                                      
         B     BCDVERR                                                          
*                                                                               
BCVNOTFE DS    0H                  BUY CODE NOT FOUND                           
         LHI   RF,RWEBCDNF                                                      
         STCM  RF,3,RERROR                                                      
         B     BCDVERR                                                          
*                                                                               
BCVLONGE DS    0H                  BUY CODE TOO LARGE                           
         LHI   RF,RWEBCDLG                                                      
         STCM  RF,3,RERROR                                                      
         B     BCDVERR                                                          
*                                                                               
BCDVERR  DS    0H                                                               
         GOTO1 CURSERR                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - BTPVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE BUDGET TYPE                                         *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*        R1==> ENTRY IN BUDGET TYPE TABLE                             *         
*                AL2(BUDGET TYPE ID)                                  *         
*                AL2(BUDGET TYPE HELP MENU ID)                        *         
*                AL1(BUDGET TYPE FILTER TYPE)                         *         
*                AL3(0) - SPARE                                       *         
*                AL4(BUDGET TYPE SAVEAREA IN RENWRIOD)                *         
*        R2==> INPUT FIELD                                            *         
*        RF=   BUDGET TYPE                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
BTPVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         LR    R3,R1               SAVE A(BUDGET TYPE TABLE ENTRY)              
*                                                                               
         L     R1,AVLPARMS         POINT TO DDVAL PARAMETERS                    
*                                                                               
         MVC   BYTE,VLFLT3V-VLPARMS(R1) SAVE CURRENT FILTER VALUE               
*                                                                               
*                                  SET FILTER FOR BUDGET TYPES                  
         MVC   VLFLT3V-VLPARMS(1,R1),BTTBVFLT-BTTBTAB(R3)                       
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         BNE   BTPVHLPN                                                         
*                                                                               
         SR    RF,RF                                                            
         LA    RF,BTTBHMID-BTTBTAB(R3)  HELP MENU ID                            
         GOTO1 VREHELP,DMCB,(RF),(R2),HELPCBLK PUT OUT HELP                     
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
BTPVHLPN DS    0H                                                               
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQBUDTP)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         MVC   VLFLT3V-VLPARMS(1,R1),BYTE RESTORE CURRENT FILTER VALUE          
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   BTPVBTPE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         ICM   RF,15,BTTBSAVA-BTTBTAB(R3) POINT TO BUD SUB-TYPE SAVE            
         LA    RF,RENWRIOD(RF)     RELOCATE ADDRESS                             
*                                                                               
         MVC   0(1,RF),VLTEXTRA    BUDGET SUB-TYPE                              
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF ON-LINE                              
         BNE   BTPVALX                                                          
*                                                                               
         MVC   NAMEAREA,VLTFULL    DESCRIPTION                                  
         OC    NAMEAREA,SPACES     SPACE FILL                                   
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
BTPVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
BTPVBTPE DS    0H                  BUDGET TYPE NOT VALID                        
         LHI   RF,RWEBTSNV                                                      
         B     BTPVERR                                                          
*                                                                               
BTPVERR  DS    0H                                                               
         ST    R4,DMCB+8           SAVE ERROR POINTER                           
         STCM  RF,3,RERROR         SET ERROR MESSAGE CODE                       
         GOTO1 CURSERR                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
*        TABLE OF BUDGET TYPES                                                  
*                                                                               
BTTBTAB  DS    0D                  BUDGET TYPES TABLE                           
*                                  STATION                                      
BTTBOPID DC    AL2(RKQOPBST)         OPTION ID                                  
BTTBHMID DC    AL2(RKQHMBST)         HEKP MENU ID                               
BTTBVFLT DC    AL1(RKVBTPST)         VALIDATION FILTER                          
         DC    AL3(0)                SPARE                                      
BTTBSAVA DC    AL4(REBTPS-RENWRIOD)  A(SAVE AREA - STATION BUDGET TYP)          
BTTBTABL EQU   *-BTTBTAB           LENGTH OF TABLE ENTRY                        
*                                  OFFICE                                       
         DC    AL2(RKQOPBOF)         OPTION ID                                  
         DC    AL2(RKQHMBOF)         HELPMENU ID                                
         DC    AL1(RKVBTPOF)         VALIDATION FILTER                          
         DC    AL3(0)                SPARE                                      
         DC    AL4(REBTPO-RENWRIOD)  A(SAVE AREA - STATION BUDGET TYP)          
*                                  COMPANY                                      
         DC    AL2(RKQOPBCO)         OPTION ID                                  
         DC    AL2(RKQHMBCO)         HELPMENU ID                                
         DC    AL1(RKVBTPCO)         VALIDATION FILTER                          
         DC    AL3(0)                SPARE                                      
         DC    AL4(REBTPC-RENWRIOD)  A(SAVE AREA - COMPANY BUDGET TYP)          
*                                  SALESPERSON                                  
         DC    AL2(RKQOPBSP)         OPTION ID                                  
         DC    AL2(RKQHMBSP)         HELPMENU ID                                
         DC    AL1(RKVBTPSP)         VALIDATION FILTER                          
         DC    AL3(0)                SPARE                                      
         DC    AL4(REBTPSP-RENWRIOD)  A(SAVE AREA - STATION BUDGET TYP)         
*                                  SALESPERSON/STATION                          
         DC    AL2(RKQOPBSS)         OPTION ID                                  
         DC    AL2(RKQHMBSS)         HELPMENU ID                                
         DC    AL1(RKVBTPSS)         VALIDATION FILTER                          
         DC    AL3(0)                SPARE                                      
         DC    AL4(REBTPSS-RENWRIOD)  A(SAVE AREA - STATION BUDGET TYP)         
*                                  SALESPERSON/STATION                          
         DC    XL1'FF'             EOT                                          
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - CTYVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE CONTRACT TYPE FILTER                                *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A CONTRCT TYPE CODE                                 *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CTYVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFCTY,REFCTY       INIT SAVEAREAS                               
         XC    RECTYSID,RECTYSID   INIT SET ID SAVEAREA                         
*                                                                               
         NI    REFTYPS1,X'FF'-REFTCTYQ   TURN OFF INDICATORS                    
         NI    REFTYPN1,X'FF'-REFTCTYQ   TURN OFF INDICATORS                    
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,1(R4)          CODE LENGTH                                  
         JZ    CTYVMSE                                                          
*                                                                               
         LA    R5,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R5),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R5,1(R5)               BUMP POINTER                              
         OI    REFTYPN1,REFTCTYQ      INDICATE SO                               
         BRCT  R3,*+8                 RECTIFY LENGTH COUNTER                    
         J     CTYVMSE                NO CODE ENTERED                           
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   0(R5),C'*'           IF SET RECORD ID                            
         JNE   CTYVSETN                                                         
*                                                                               
*        VALIDATE SET RECORD ID                                                 
*                                                                               
         GOTO1 =A(SETREP),DMCB,=CL2'CT',=AL1(RCTYKTYQ),RR=RELORGEN              
*                                                                               
         XC    KEY,KEY             ESTABLISH SET RECORD KEY                     
         LA    R6,KEY                                                           
         USING RSETKEY,R6                                                       
*                                                                               
         MVI   RSETKTYP,RSETKTYQ   RECORD TYPE                                  
         MVC   RSETKREP,REDMREP    AGENCY                                       
         MVC   RSETKSET,=C'CT'     SET TYPE                                     
*                                                                               
         MVC   RSETKID,SPACES      INIT SET ID                                  
*                                                                               
         AHI   R3,-2               DECREMENT FOR EXECUTE AND '*'                
         JM    CTYVMSE                NO CODE ENTERED                           
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RSETKID(0),1(R5)    SET ID                                       
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RSETKEY,KEYSAVE     MUST FIND KEY                                
         JNE   CTYVSETE                                                         
*                                                                               
         MVC   RECTYSID,RSETKID    SAVE SET ID                                  
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   CTYVSETX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RSETREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         LA    R6,RSETELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             SKIP IF END OF RECORD                        
         JE    CTYVSET1                                                         
         CLI   0(R6),RSETDCDQ      FIND DESCRIPTION ELEMENT                     
         JE    *+16                                                             
         IC    RF,1(R6)            BUMP TO NEXT ELEMENT                         
         LA    R6,0(RF,R6)                                                      
         J     *-24                                                             
*                                                                               
         USING RSETDESD,R6         ESTABLISH SET DESCRIPTION ELEMENT            
*                                                                               
         IC    RF,RSETDELN         ELEMENT LENGTH                               
*                                                                               
         AHI   RF,-RSETDOV         DECREMENT BY OVERHEAD LENGTH                 
         JZ    CTYVSET1               NO DESCRIPTION                            
*                                                                               
         CHI   RF,L'NAMEAREA       CHECK IF DESCRIPTION TOO BIG                 
         JNH   *+8                                                              
         LHI   RF,L'NAMEAREA                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NAMEAREA(0),RSETDESC   COPY DESCRIPTION                          
*                                                                               
CTYVSET1 DS    0H                                                               
*                                                                               
         J     CTYVPRT1            GO PRINT SET ID                              
*                                                                               
CTYVSETX DS    0H                                                               
         J     CTYVALOK            SET ID IS OKAY                               
*                                                                               
CTYVSETN DS    0H                                                               
*                                                                               
         XC    KEY,KEY             ESTABLISH CONTRACT TYPE KEY                  
         LA    R6,KEY                                                           
         USING RCTYKEY,R6                                                       
*                                                                               
         MVI   RCTYKTYP,RCTYKTYQ   RECORD TYPE                                  
         MVC   RCTYKREP,AGENCY     AGENCY                                       
         MVC   RCTYKCTY,SPACES     INIT CONTRACT TYPE                           
*                                                                               
         CHI   R3,L'RCTYKCTY       CHECK CODE LENGTH                            
         JH    CTYVLNE                                                          
*                                                                               
         BCTR  R3,0                DECREMENT FOR EXECUTE                        
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RCTYKCTY(0),0(R5)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RCTYKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   CTYVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFCTY,RCTYKCTY     SAVE CODE                                    
         OI    REFTYPS1,REFTCTYQ   INDICATE FILTERING ON CONTRACT TYPE          
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF ON-LINE                              
         JNE   CTYPRTX                                                          
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         JZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
*                                                                               
         MVC   NAMEAREA(L'RCTYDESC),RCTYDESC  DESCRIPTION                       
*                                                                               
CTYVPRT1 DS    0H                                                               
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
CTYPRTX  DS    0H                                                               
*                                                                               
CTYVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS1,REFTCTYQ   INDICATE FILTERING ON CONTRACT TYPE          
*                                                                               
CTYVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
CTYVNVE  DS    0H                  CODE NOT VALDI                               
*                                                                               
         MVI   ERROR,RWECTYNV                                                   
         B     CTYVERR                                                          
*                                                                               
CTYVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWECTYNF                                                   
         B     CTYVERR                                                          
*                                                                               
CTYVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWECTYMS                                                   
         B     CTYVERR                                                          
*                                                                               
CTYVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWECTYLN                                                   
         B     CTYVERR                                                          
*                                                                               
CTYVSETE DS    0H                  CONT TYPE SET ID NOT FOUND                   
*                                                                               
         MVI   ERROR,RWECTSNF                                                   
         B     CTYVERR                                                          
*                                                                               
CTYVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - DSPVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE DEVELOPMENTAL SALESPERSON FILTER                    *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A DEVELOPMENTAL SALESPERSON CODE                    *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
DSPVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFDSP,REFDSP       INIT SAVEAREAS                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          CODE LENGTH                                  
         JZ    DSPVMSE                                                          
*                                                                               
         LA    R1,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R1),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R1,1(R1)               BUMP POINTER                              
         OI    REFTYPN1,REFTDSPQ      INDICATE SO                               
         BRCT  RF,*+8                 RECTIFY LENGTH COUNTER                    
         J     DSPVMSE                NO CODE ENTERED                           
*                                                                               
         XC    KEY,KEY             ESTABLISH DEVELOP SALESPERSON KEY            
         LA    R6,KEY                                                           
         USING RDSPKEY,R6                                                       
*                                                                               
         MVI   RDSPKTYP,RDSPKTYQ   RECORD TYPE                                  
         MVC   RDSPKREP,AGENCY     AGENCY                                       
         MVC   RDSPKSAL,SPACES     INIT DEVELOPMENTAL SALESPERSON               
*                                                                               
         CHI   RF,L'RDSPKSAL       CHECK CODE LENGTH                            
         JH    DSPVLNE                                                          
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RDSPKSAL(0),0(R1)   SET DEVELOPMENTAL SALESPERSON                
*                                                                               
         GOTO1 HIGH                 READ POINTER                                
*                                                                               
         CLC   RDSPKEY,KEYSAVE     RECORD MUST BE FOUND                         
         BNE   DSPVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFDSP,RDSPKSAL     SAVE CODE                                    
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF ON-LINE                              
         BNE   DSPPRTX                                                          
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
*                                                                               
         MVC   NAMEAREA(L'RDSPNAME),RDSPNAME  DESCRIPTION                       
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN   PRINT OPTION                            
*                                                                               
DSPPRTX  DS    0H                                                               
*                                                                               
DSPVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS1,REFTDSPQ   INDICATE FILTERING ON DEV SLSPERS            
*                                                                               
DSPVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
DSPVNVE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWEDSPNF                                                   
         B     DSPVERR                                                          
*                                                                               
DSPVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWEDSPNF                                                   
         B     DSPVERR                                                          
*                                                                               
DSPVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWEDSPMS                                                   
         B     DSPVERR                                                          
*                                                                               
DSPVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWEDSPLN                                                   
         B     DSPVERR                                                          
*                                                                               
DSPVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - DCTVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE DEVELOPMENTAL TYPE FILTER                           *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A DEVELOPMENTAL TYPE CODE                           *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
DCTVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFDCT,REFDCT       INIT SAVEAREAS                               
         XC    REDCTSID,REDCTSID   INIT DEVELOPMENTAL SET ID SAVEAREA           
*                                                                               
         NI    REFTYPS1,X'FF'-REFTDCTQ   TURN OFF INDICATORS                    
         NI    REFTYPN1,X'FF'-REFTDCTQ   TURN OFF INDICATORS                    
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,1(R4)          CODE LENGTH                                  
         JZ    DCTVMSE                                                          
*                                                                               
         LA    R5,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R5),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R5,1(R5)               BUMP POINTER                              
         OI    REFTYPN1,REFTDCTQ      INDICATE SO                               
         BRCT  R3,*+8                 RECTIFY LENGTH COUNTER                    
         J     DCTVMSE                NO CODE ENTERED                           
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   0(R5),C'*'           IF SET RECORD ID                            
         JNE   DCTVSETN                                                         
*                                                                               
*        VALIDATE SET RECORD ID                                                 
*                                                                               
         XC    KEY,KEY             ESTABLISH SET RECORD KEY                     
         LA    R6,KEY                                                           
         USING RSETKEY,R6                                                       
*                                                                               
         GOTO1 =A(SETREP),DMCB,=CL2'DT',=AL1(RDCTKTYQ),RR=RELORGEN              
*                                                                               
         MVI   RSETKTYP,RSETKTYQ   RECORD TYPE                                  
         MVC   RSETKREP,REDMREP    AGENCY                                       
         MVC   RSETKSET,=C'DT'     SET TYPE                                     
*                                                                               
         MVC   RSETKID,SPACES      INIT SET ID                                  
*                                                                               
         AHI   R3,-2               DECREMENT FOR EXECUTE AND '*'                
         JM    DCTVMSE                NO CODE ENTERED                           
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RSETKID(0),1(R5)    SET ID                                       
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RSETKEY,KEYSAVE     MUST FIND KEY                                
         JNE   DCTVSETE                                                         
*                                                                               
         MVC   REDCTSID,RSETKID    SAVE SET ID                                  
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   DCTVSETX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RSETREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         LA    R6,RSETELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             SKIP IF END OF RECORD                        
         JE    DCTVSET1                                                         
         CLI   0(R6),RSETDCDQ      FIND DESCRIPTION ELEMENT                     
         JE    *+16                                                             
         IC    RF,1(R6)            BUMP TO NEXT ELEMENT                         
         LA    R6,0(RF,R6)                                                      
         J     *-24                                                             
*                                                                               
         USING RSETDESD,R6         ESTABLISH SET DESCRIPTION ELEMENT            
*                                                                               
         IC    RF,RSETDELN         ELEMENT LENGTH                               
*                                                                               
         AHI   RF,-RSETDOV         DECREMENT BY OVERHEAD LENGTH                 
         JZ    DCTVSET1               NO DESCRIPTION                            
*                                                                               
         CHI   RF,L'NAMEAREA       SCHECK IF DESCRIPTION TOO BIG                
         JNH   *+8                                                              
         LHI   RF,L'NAMEAREA                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NAMEAREA(0),RSETDESC   COPY DESCRIPTION                          
*                                                                               
DCTVSET1 DS    0H                                                               
*                                                                               
         J     DCTVPRT1            GO PRINT SET ID                              
*                                                                               
DCTVSETX DS    0H                                                               
         J     DCTVALOK            SET ID IS OKAY                               
*                                                                               
DCTVSETN DS    0H                                                               
*                                                                               
         XC    KEY,KEY             ESTABLISH DEVELOP CONT CODE KEY              
         LA    R6,KEY                                                           
         USING RDCTKEY,R6                                                       
*                                                                               
         MVI   RDCTKTYP,RDCTKTYQ   RECORD TYPE                                  
         MVC   RDCTKREP,AGENCY     AGENCY                                       
         MVC   RDCTKCTY,SPACES     INIT DEVELOPMENTAL CONTRACT TYPE             
*                                                                               
         CHI   R3,L'RDCTKCTY       CHECK CODE LENGTH                            
         BH    DCTVLNE                                                          
*                                                                               
         BCTR  R3,0                DECREMENT FOR EXECUTE                        
         EX    R3,*+8                                                           
         B     *+10                                                             
         MVC   RDCTKCTY(0),0(R5)   SET DEVELOPMENTAL CONTRACT CODE              
*                                                                               
         GOTO1 HIGH                 READ POINTER                                
*                                                                               
         CLC   RDCTKEY,KEYSAVE     RECORD MUST BE FOUND                         
         BNE   DCTVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFDCT,RDCTKCTY     SAVE CODE                                    
*                                                                               
DCTPRT   DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         BNE   DCTPRTX                                                          
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RDCTREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'RDCTDESC),RDCTDESC   COPY DESCRIPTION                 
*                                                                               
DCTVPRT1 DS    0H                                                               
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
DCTPRTX  DS    0H                                                               
*                                                                               
DCTVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS1,REFTDCTQ   INDICATE FILTERING ON DEV CT TYPE            
*                                                                               
DCTVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
DCTVNVE  DS    0H                  CODE NOT VALID                               
*                                                                               
         MVI   ERROR,RWEDCTNV                                                   
         B     DCTVERR                                                          
*                                                                               
DCTVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWEDCTNF                                                   
         B     DCTVERR                                                          
*                                                                               
DCTVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWEDCTMS                                                   
         B     DCTVERR                                                          
*                                                                               
DCTVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWEDCTLN                                                   
         B     DCTVERR                                                          
*                                                                               
DCTVSETE DS    0H                  DEVELOPMENTAL TYPE  SET ID NOT FOUND         
*                                                                               
         MVI   ERROR,RWEDTSNF                                                   
         B     DCTVERR                                                          
*                                                                               
DCTVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - MKTVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE MARKET FILTER                                       *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A MARKET CODE                                       *         
*        '-' AT START INDICATES NEGATIVE FILTER                       *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
MKTVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFMKT,REFMKT       INIT SAVEAREAS                               
         XC    REMKTSID,REMKTSID   INIT MARKET SET ID SAVEAREA                  
         NI    REFTYPS2,X'FF'-REFTMKTQ   TURN OFF INDICATORS                    
         NI    REFTYPN2,X'FF'-REFTMKTQ   TURN OFF INDICATORS                    
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,1(R4)          CODE LENGTH                                  
         JZ    MKTVMSE                                                          
*                                                                               
         LA    R5,22(R4)           START OF CODE                                
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   0(R5),C'*'           IF SET RECORD ID                            
         JNE   MKTVSETN                                                         
*                                                                               
*        VALIDATE SET RECORD ID                                                 
*                                                                               
         XC    KEY,KEY             ESTABLISH SET RECORD KEY                     
         LA    R6,KEY                                                           
         USING RSETKEY,R6                                                       
*                                                                               
         GOTO1 =A(SETREP),DMCB,=CL2'DT',=AL1(RMKTKTYQ),RR=RELORGEN              
*                                                                               
         MVI   RSETKTYP,RSETKTYQ   RECORD TYPE                                  
         MVC   RSETKREP,REDMREP    AGENCY                                       
         MVC   RSETKSET,=C'MK'     SET TYPE                                     
*                                                                               
         MVC   RSETKID,SPACES      INIT SET ID                                  
*                                                                               
         AHI   R3,-2               DECREMENT FOR EXECUTE AND '*'                
         JM    MKTVMSE                NO CODE ENTERED                           
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RSETKID(0),1(R5)    SET ID                                       
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RSETKEY,KEYSAVE     MUST FIND KEY                                
         JNE   MKTVSETE                                                         
*                                                                               
         MVC   REMKTSID,RSETKID    SAVE SET ID                                  
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   MKTVSETX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RSETREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         LA    R6,RSETELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             SKIP IF END OF RECORD                        
         JE    MKTVSET1                                                         
         CLI   0(R6),RSETDCDQ      FIND DESCRIPTION ELEMENT                     
         JE    *+16                                                             
         IC    RF,1(R6)            BUMP TO NEXT ELEMENT                         
         LA    R6,0(RF,R6)                                                      
         J     *-24                                                             
*                                                                               
         USING RSETDESD,R6         ESTABLISH SET DESCRIPTION ELEMENT            
*                                                                               
         IC    RF,RSETDELN         ELEMENT LENGTH                               
*                                                                               
         AHI   RF,-RSETDOV         DECREMENT BY OVERHEAD LENGTH                 
         JZ    MKTVSET1               NO DESCRIPTION                            
*                                                                               
         CHI   RF,L'NAMEAREA       SCHECK IF DESCRIPTION TOO BIG                
         JNH   *+8                                                              
         LHI   RF,L'NAMEAREA                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NAMEAREA(0),RSETDESC   COPY DESCRIPTION                          
*                                                                               
MKTVSET1 DS    0H                                                               
*                                                                               
         J     MKTVPRT1            GO PRINT SET ID                              
*                                                                               
MKTVSETX DS    0H                                                               
         J     MKTVALOK            SET ID IS OKAY                               
*                                                                               
MKTVSETN DS    0H                                                               
*                                                                               
         CLI   0(R5),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R5,1(R5)               BUMP POINTER                              
         OI    REFTYPN2,REFTMKTQ      INDICATE SO                               
         BRCT  R3,*+8                 RECTIFY LENGTH COUNTER                    
         J     MKTVMSE                NO CODE ENTERED                           
*                                                                               
         XC    KEY,KEY             ESTABLISH MARKET KEY                         
         LA    R6,KEY                                                           
         USING RMKTKEY,R6                                                       
*                                                                               
         MVI   RMKTKTYP,RMKTKTYQ   RECORD TYPE                                  
         MVC   RMKTKREP,AGENCY     REP                                          
*                                                                               
         CHI   R3,L'RMKTKMKT       CHECK CODE LENGTH                            
         JH    MKTVLNE                                                          
*                                                                               
         BCTR  R3,0                DECREMENT FOR EXECUTE                        
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RMKTKMKT(0),0(R5)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RMKTKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   MKTVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFMKT,RMKTKMKT     SAVE CODE                                    
*                                                                               
MKTVPRT  DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   MKTVPRTX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RMKTREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'RMKTNAME),RMKTNAME   COPY NAME                        
*                                                                               
MKTVPRT1 DS    0H                                                               
*                                                                               
         MVC   LABLAREA,=CL16'MARKET'  SET LABEL FOR TITLE PRINTING             
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
MKTVPRTX DS    0H                                                               
*                                                                               
MKTVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS2,REFTMKTQ   INDICATE FILTERING ON MARKET                 
*                                                                               
MKTVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
MKTVNVE  DS    0H                  CODE NOT VALID                               
MKTVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         LHI   RF,RWEMKTNV                                                      
         J     MKTVERR                                                          
*                                                                               
MKTVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         LHI   RF,RWEMKTNF                                                      
         J     MKTVERR                                                          
*                                                                               
MKTVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         LHI   RF,RWEMKTMS                                                      
         J     MKTVERR                                                          
*                                                                               
MKTVSETE DS    0H                  MARKET SET ID NOT FOUND                      
*                                                                               
         LHI   RF,RWEMKSNF                                                      
         B     MKTVERR                                                          
*                                                                               
MKTVERR  DS    0H                                                               
         STCM  RF,3,RERROR                                                      
         GOTO1 CURSERR                                                          
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - OWNVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE OWNER FILTER                                        *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A OWNER CODE                                        *         
*        '-' AT START INDICATES NEGATIVE FILTER                       *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
OWNVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFOWN,REFOWN       INIT SAVEAREAS                               
         NI    REFTYPS2,X'FF'-REFTOWNQ   TURN OFF INDICATORS                    
         NI    REFTYPN2,X'FF'-REFTOWNQ   TURN OFF INDICATORS                    
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          CODE LENGTH                                  
         JZ    OWNVMSE                                                          
*                                                                               
         LA    R1,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R1),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R1,1(R1)               BUMP POINTER                              
         OI    REFTYPN2,REFTOWNQ      INDICATE SO                               
         BRCT  RF,*+8                 RECTIFY LENGTH COUNTER                    
         J     OWNVMSE                NO CODE ENTERED                           
*                                                                               
         XC    KEY,KEY             ESTABLISH OWNER KEY                          
         LA    R6,KEY                                                           
         USING ROWNKEY,R6                                                       
*                                                                               
         MVI   ROWNKTYP,ROWNKTYQ   RECORD TYPE                                  
         MVC   ROWNKREP,AGENCY     REP                                          
         MVC   ROWNKOWN,SPACES     INIT OWNER ID                                
*                                                                               
         CHI   RF,L'ROWNKOWN       CHECK CODE LENGTH                            
         JH    OWNVLNE                                                          
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   ROWNKOWN(0),0(R1)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   ROWNKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   OWNVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFOWN,ROWNKOWN     SAVE CODE                                    
*                                                                               
OWNVPRT  DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   OWNVPRTX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING ROWNREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'ROWNNAME),ROWNNAME   COPY NAME                        
*                                                                               
OWNVPRT1 DS    0H                                                               
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
OWNVPRTX DS    0H                                                               
*                                                                               
OWNVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS2,REFTOWNQ   INDICATE FILTERING ON OWNER                  
*                                                                               
OWNVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
OWNVNVE  DS    0H                  CODE NOT VALID                               
OWNVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         LHI   RF,RWEOWNNV                                                      
         J     OWNVERR                                                          
*                                                                               
OWNVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         LHI   RF,RWEOWNNF                                                      
         J     OWNVERR                                                          
*                                                                               
OWNVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         LHI   RF,RWEOWNMS                                                      
         J     OWNVERR                                                          
*                                                                               
OWNVERR  DS    0H                                                               
         STCM  RF,3,RERROR                                                      
         GOTO1 CURSERR                                                          
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - PTPVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE POINT PERSON FILTER                                 *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A POINT PERSON CODE CODE                            *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*        '-' AT START INDICATES NEGATIVE FILTER                       *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PTPVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFPTP,REFPTP       INIT SAVEAREAS                               
         XC    REPTPSID,REPTPSID   INIT SET ID SAVEAREA                         
         NI    REFTYPS1,X'FF'-REFTPTPQ   TURN OFF INDICATORS                    
         NI    REFTYPN1,X'FF'-REFTPTPQ   TURN OFF INDICATORS                    
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,1(R4)          CODE LENGTH                                  
         JZ    PTPVMSE                                                          
*                                                                               
         LA    R5,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R5),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R5,1(R5)               BUMP POINTER                              
         OI    REFTYPN1,REFTPTPQ      INDICATE SO                               
         BRCT  R3,*+8                 RECTIFY LENGTH COUNTER                    
         J     PTPVMSE                NO CODE ENTERED                           
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   0(R5),C'*'           IF SET RECORD ID                            
         JNE   PTPVSETN                                                         
*                                                                               
*        VALIDATE SET RECORD ID                                                 
*                                                                               
         GOTO1 =A(SETREP),DMCB,=CL2'PP',=AL1(RPTPKTYQ),RR=RELORGEN              
*                                                                               
         XC    KEY,KEY             ESTABLISH SET RECORD KEY                     
         LA    R6,KEY                                                           
         USING RSETKEY,R6                                                       
*                                                                               
         MVI   RSETKTYP,RSETKTYQ   RECORD TYPE                                  
         MVC   RSETKREP,REDMREP    AGENCY                                       
         MVC   RSETKSET,=C'PP'     SET TYPE                                     
*                                                                               
         MVC   RSETKID,SPACES      INIT SET ID                                  
*                                                                               
         AHI   R3,-2               DECREMENT FOR EXECUTE AND '*'                
         JM    PTPVMSE                NO CODE ENTERED                           
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RSETKID(0),1(R5)    SET ID                                       
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RSETKEY,KEYSAVE     MUST FIND KEY                                
         JNE   PTPVSETE                                                         
*                                                                               
         MVC   REPTPSID,RSETKID    SAVE SET ID                                  
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   PTPVSETX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RSETREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         LA    R6,RSETELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             SKIP IF END OF RECORD                        
         JE    PTPVSET1                                                         
         CLI   0(R6),RSETDCDQ      FIND DESCRIPTION ELEMENT                     
         JE    *+16                                                             
         IC    RF,1(R6)            BUMP TO NEXT ELEMENT                         
         LA    R6,0(RF,R6)                                                      
         J     *-24                                                             
*                                                                               
         USING RSETDESD,R6         ESTABLISH SET DESCRIPTION ELEMENT            
*                                                                               
         IC    RF,RSETDELN         ELEMENT LENGTH                               
*                                                                               
         AHI   RF,-RSETDOV         DECREMENT BY OVERHEAD LENGTH                 
         JZ    PTPVSET1               NO DESCRIPTION                            
*                                                                               
         CHI   RF,L'NAMEAREA       SCHECK IF DESCRIPTION TOO BIG                
         JNH   *+8                                                              
         LHI   RF,L'NAMEAREA                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NAMEAREA(0),RSETDESC   COPY DESCRIPTION                          
*                                                                               
PTPVSET1 DS    0H                                                               
*                                                                               
         J     PTPVPRT1            GO PRINT SET ID                              
*                                                                               
PTPVSETX DS    0H                                                               
         J     PTPVALOK            SET ID IS OKAY                               
*                                                                               
*        VALIDATE POINT PERSON CODE                                             
*                                                                               
PTPVSETN DS    0H                                                               
*                                                                               
         XC    KEY,KEY             ESTABLISH POINT PERSON KEY                   
         LA    R6,KEY                                                           
         USING RPTPKEY,R6                                                       
*                                                                               
         MVI   RPTPKTYP,RPTPKTYQ   RECORD TYPE                                  
         MVC   RPTPKREP,AGENCY     REP                                          
         MVC   RPTPKREC,SPACES     INIT POINT PERSON ID                         
*                                                                               
         CHI   R3,L'RPTPKREC       CHECK CODE LENGTH                            
         JH    PTPVLNE                                                          
*                                                                               
         BCTR  R3,0                DECREMENT FOR EXECUTE                        
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RPTPKREC(0),0(R5)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RPTPKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   PTPVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFPTP,RPTPKREC     SAVE CODE                                    
*                                                                               
PTPVPRT  DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   PTPVPRTX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RPTPREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'RPTPNAME),RPTPNAME   COPY NAME                        
*                                                                               
PTPVPRT1 DS    0H                                                               
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
PTPVPRTX DS    0H                                                               
*                                                                               
PTPVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS1,REFTPTPQ   INDICATE FILTERING ON POINT PERSON           
*                                                                               
PTPVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
PTPVNVE  DS    0H                  CODE NOT VALID                               
*                                                                               
         MVI   ERROR,RWEPTPNV                                                   
         J     PTPVERR                                                          
*                                                                               
PTPVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWEPTPNF                                                   
         J     PTPVERR                                                          
*                                                                               
PTPVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWEPTPMS                                                   
         J     PTPVERR                                                          
*                                                                               
PTPVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWEPTPLN                                                   
         J     PTPVERR                                                          
*                                                                               
PTPVSETE DS    0H                  POINT PERSON SET ID NOT FOUND                
*                                                                               
         MVI   ERROR,RWEPPSNF                                                   
         J     PTPVERR                                                          
*                                                                               
PTPVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - CLSVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE CLASS FILTER                                        *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A CLASS CODE                                        *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CLSVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFCLS,REFCLS       INIT SAVEAREAS                               
*                                                                               
         NI    REFTYPS1,X'FF'-REFTCLSQ   TURN OFF INDICATORS                    
         NI    REFTYPN1,X'FF'-REFTCLSQ   TURN OFF INDICATORS                    
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          CODE LENGTH                                  
         JZ    CLSVMSE                                                          
*                                                                               
         LA    R1,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R1),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R1,1(R1)               BUMP POINTER                              
         OI    REFTYPN1,REFTCLSQ      INDICATE SO                               
         BRCT  RF,*+8                 RECTIFY LENGTH COUNTER                    
         J     CLSVMSE                NO CODE ENTERED                           
*                                                                               
         XC    KEY,KEY             ESTABLISH CLASS KEY                          
         LA    R6,KEY                                                           
         USING RCLSKEY,R6                                                       
*                                                                               
         MVI   RCLSKTYP,RCLSKTYQ   RECORD TYPE                                  
         MVC   RCLSKREP,AGENCY     AGENCY                                       
         MVC   RCLSKCLS,SPACES     CLASS CODE                                   
*                                                                               
         CHI   RF,L'RCLSKCLS       CHECK CODE LENGTH                            
         JH    CLSVLNE                                                          
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RCLSKCLS(0),0(R1)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RCLSKEY,KEYSAVE     RECORD MUST BE FOUND                         
         BNE   CLSVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFCLS,RCLSKCLS     SAVE CODE                                    
*                                                                               
CLSPRT   DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         BNE   CLSPRTX                                                          
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RCLSREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'RCLSNAME),RCLSNAME   COPY NAME                        
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
CLSPRTX  DS    0H                                                               
*                                                                               
         OI    REFTYPS1,REFTCLSQ   INDICATE FILTERING ON CLASS                  
*                                                                               
CLSVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
CLSVNVE  DS    0H                  CODE NOT VALID                               
*                                                                               
         MVI   ERROR,RWECLSNV                                                   
         B     CLSVERR                                                          
*                                                                               
CLSVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWECLSNF                                                   
         B     CLSVERR                                                          
*                                                                               
CLSVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWECLSMS                                                   
         B     CLSVERR                                                          
*                                                                               
CLSVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWECLSLN                                                   
         B     CLSVERR                                                          
*                                                                               
CLSVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - CTGVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE CATEGORY FILTER                                     *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A CATEGORY CODE                                     *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CTGVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFCTG,REFCTG       INIT SAVEAREAS                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          CODE LENGTH                                  
         JZ    CTGVMSE                                                          
*                                                                               
         LA    R1,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R1),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R1,1(R1)               BUMP POINTER                              
         OI    REFTYPN1,REFTCTGQ      INDICATE SO                               
         BRCT  RF,*+8                 RECTIFY LENGTH COUNTER                    
         J     CTGVMSE                NO CODE ENTERED                           
*                                                                               
         XC    KEY,KEY             ESTABLISH CATEGORY KEY                       
         LA    R6,KEY                                                           
         USING RCTGKEY,R6                                                       
*                                                                               
         MVI   RCTGKTYP,RCTGKTYQ   RECORD TYPE                                  
         MVC   RCTGKREP,AGENCY     AGENCY                                       
         MVC   RCTGKCTG,SPACES     CLASS CODE                                   
*                                                                               
         CHI   RF,L'RCTGKCTG       CHECK CODE LENGTH                            
         JH    CTGVLNE                                                          
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RCTGKCTG(0),0(R1)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RCTGKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   CTGVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFCTG,RCTGKCTG     SAVE CODE                                    
*                                                                               
CTGPRT   DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         BNE   CTGPRTX                                                          
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RCTGREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'RCTGNAME),RCTGNAME   COPY NAME                        
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
CTGPRTX  DS    0H                                                               
*                                                                               
         OI    REFTYPS1,REFTCTGQ   INDICATE FILTERING ON CATEGORY               
*                                                                               
CTGVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
CTGVNVE  DS    0H                  CODE NOT VALID                               
*                                                                               
         MVI   ERROR,RWECTGNV                                                   
         B     CTGVERR                                                          
*                                                                               
CTGVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWECTGNF                                                   
         B     CTGVERR                                                          
*                                                                               
CTGVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWECTGMS                                                   
         B     CTGVERR                                                          
*                                                                               
CTGVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWECTGLN                                                   
         B     CTGVERR                                                          
*                                                                               
CTGVSETE DS    0H                  CATEGORY CODE NOT FOUND                      
*                                                                               
         MVI   ERROR,RWECTGNF                                                   
         B     CTGVERR                                                          
*                                                                               
CTGVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - REPVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE REP FILTER                                          *         
*                                                                     *         
*                                                                     *         
*        INPUT IS A REP CODE                                          *         
*        '*' INDICATES FOLLOWING IS A SET RECORD ID                   *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
REPVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         XC    REFREP,REFREP       INIT SAVEAREAS                               
         XC    REREPSID,REREPSID   INIT SET ID SAVEAREA                         
*                                                                               
         NI    REFTYPS2,X'FF'-REFTREPQ   TURN OFF INDICATORS                    
         NI    REFTYPN2,X'FF'-REFTREPQ   TURN OFF INDICATORS                    
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,1(R4)          CODE LENGTH                                  
         JZ    REPVMSE                                                          
*                                                                               
         LA    R5,22(R4)           START OF CODE                                
*                                                                               
         CLI   0(R5),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R5,1(R5)               BUMP POINTER                              
         OI    REFTYPN2,REFTREPQ      INDICATE SO                               
         BRCT  R3,*+8                 RECTIFY LENGTH COUNTER                    
         J     REPVMSE                NO CODE ENTERED                           
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   0(R5),C'*'           IF SET RECORD ID                            
         JNE   REPVSETN                                                         
*                                                                               
*        VALIDATE SET RECORD ID                                                 
*                                                                               
         GOTO1 =A(SETREP),DMCB,=CL2'RE',=AL1(RREPKTYQ),RR=RELORGEN              
*                                                                               
         XC    KEY,KEY             ESTABLISH SET RECORD KEY                     
         LA    R6,KEY                                                           
         USING RSETKEY,R6                                                       
*                                                                               
         MVI   RSETKTYP,RSETKTYQ   RECORD TYPE                                  
         MVC   RSETKREP,REDMREP    AGENCY                                       
         MVC   RSETKSET,=C'RE'     SET TYPE                                     
*                                                                               
         MVC   RSETKID,SPACES      INIT SET ID                                  
*                                                                               
         AHI   R3,-2               DECREMENT FOR EXECUTE AND '*'                
         JM    REPVMSE                NO CODE ENTERED                           
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RSETKID(0),1(R5)    SET ID                                       
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RSETKEY,KEYSAVE     MUST FIND KEY                                
         JNE   REPVSETE                                                         
*                                                                               
         MVC   REREPSID,RSETKID    SAVE SET ID                                  
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         JNE   REPVSETX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RSETREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  R3,0                DECREMENT FOR EXECUTE                        
         EX    R3,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         LA    R6,RSETELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             SKIP IF END OF RECORD                        
         JE    REPVSET1                                                         
         CLI   0(R6),RSETDCDQ      FIND DESCRIPTION ELEMENT                     
         JE    *+16                                                             
         IC    RF,1(R6)            BUMP TO NEXT ELEMENT                         
         LA    R6,0(RF,R6)                                                      
         J     *-24                                                             
*                                                                               
         USING RSETDESD,R6         ESTABLISH SET DESCRIPTION ELEMENT            
*                                                                               
         IC    RF,RSETDELN         ELEMENT LENGTH                               
*                                                                               
         AHI   RF,-RSETDOV         DECREMENT BY OVERHEAD LENGTH                 
         JZ    REPVSET1               NO DESCRIPTION                            
*                                                                               
         CHI   RF,L'NAMEAREA       SCHECK IF DESCRIPTION TOO BIG                
         JNH   *+8                                                              
         LHI   RF,L'NAMEAREA                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   NAMEAREA(0),RSETDESC   COPY DESCRIPTION                          
*                                                                               
REPVSET1 DS    0H                                                               
*                                                                               
         J     REPVPRT1            GO PRINT SET ID                              
*                                                                               
REPVSETX DS    0H                                                               
         J     REPVALOK            SET ID IS OKAY                               
*                                                                               
REPVSETN DS    0H                                                               
*                                                                               
         XC    KEY,KEY             ESTABLISH REP KEY                            
         LA    R6,KEY                                                           
         USING RREPKEY,R6                                                       
*                                                                               
         MVI   RREPKTYP,RREPKTYQ   RECORD TYPE                                  
         MVC   RREPKREP,SPACES     INIT POINT PERSON ID                         
*                                                                               
         CHI   R3,L'RREPKREP       CHECK CODE LENGTH                            
         JH    REPVLNE                                                          
*                                                                               
         BCTR  R3,0                DECREMENT FOR EXECUTE                        
         EX    R3,*+8                                                           
         J     *+10                                                             
         MVC   RREPKREP(0),0(R5)   SET CODE                                     
*                                                                               
         GOTO1 HIGH                 READ POINTER                                
*                                                                               
         CLC   RREPKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   REPVNFE             CODE NOT FOUND                               
*                                                                               
         MVC   REFREP,RREPKREP     SAVE CODE                                    
*                                                                               
REPPRT   DS    0H                  PRINT OPTION IN HEADLINE                     
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFFLINE                          
         BNE   REPPRTX                                                          
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
         USING RREPREC,R6          ESTABLISH RECORD                             
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          ID LENGTH                                    
         BZ    *+6                 NO INPUT                                     
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),22(R4)    COPY CODE                                  
*                                                                               
         MVC   NAMEAREA(L'RREPNAME),RREPNAME   COPY NAME                        
*                                                                               
REPVPRT1 DS    0H                                                               
*                                                                               
         GOTO1 =A(PRTOPT),RR=RELORGEN  PRINT OPTION IN HEADLINES                
*                                                                               
REPPRTX  DS    0H                                                               
*                                                                               
REPVALOK DS    0H                                                               
*                                                                               
         OI    REFTYPS2,REFTREPQ   INDICATE FILTERING ON REP                    
*                                                                               
REPVALX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
REPVNVE  DS    0H                  CODE NOT VALID                               
*                                                                               
         MVI   ERROR,RWEREPNV                                                   
         B     REPVERR                                                          
*                                                                               
REPVNFE  DS    0H                  CODE NOT FOUND                               
*                                                                               
         MVI   ERROR,RWEREPNF                                                   
         B     REPVERR                                                          
*                                                                               
REPVMSE  DS    0H                  CODE REQUIRED                                
*                                                                               
         MVI   ERROR,RWEREPMS                                                   
         B     REPVERR                                                          
*                                                                               
REPVLNE  DS    0H                  CODE TOO LARGE                               
*                                                                               
         MVI   ERROR,RWEREPLN                                                   
         B     REPVERR                                                          
*                                                                               
REPVSETE DS    0H                  REP SET ID NOT FOUND                         
*                                                                               
         MVI   ERROR,RWERESNF                                                   
         B     REPVERR                                                          
*                                                                               
REPVERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VSTA'                       
***********************************************************************         
*                                                                     *         
*        VALIDATE STATION CALL LETTERS                                *         
*                                                                     *         
*- STAKEY -- PARSE STATION FIELD INPUT (6 CHARS)                      *         
*            AND BUILD KEY FOR FILE READING.                          *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VSTA     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
*        INIT SAVEAREAS                                                         
*                                                                               
         ST    R2,RESTAA           SAVE FILED ADDRESS                           
*                                                                               
         XC    REFSTA,REFSTA       STATION CALL LETTERS                         
         XC    REFAFF,REFAFF       AFFLIATION CODE                              
         XC    REFRNK,REFRNK       MARKET RANK                                  
         XC    REFTVB,REFTVB       TVB REGION CODE                              
         XC    RESTASID,RESTASID   STATION SET CODE                             
         NI    REFTYPS2,X'FF'-REFTSTAQ   TURN OFF INDICATORS                    
         NI    REFTYPN2,X'FF'-REFTSTAQ   TURN OFF INDICATORS                    
*                                                                               
         CLI   5(R2),0             ENTRY NOT REQUIRED                           
         BE    VSTA10                                                           
*                                                                               
         CLI   5(R2),3                                                          
         BNE   VSTA20                                                           
*                                                                               
         CLC   =C'ALL',8(R2)      ENTRY NOT REQUIRED                            
         BNE   VSTA20                                                           
*                                                                               
VSTA10   DS    0H                                                               
*                                                                               
*MN      MVI   REQSML,C'L'         FLAG AS POSSIBLY LONG SOON                   
*                                                                               
*****    CLC   =C'SOON',CONWHEN       MUST NOT BE SOON REQUEST                  
*****    BE    VSTASONE                                                         
*                                                                               
         B     VSTAX                                                            
*                                                                               
VSTA20   DS    0H                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   8(R2),C'+'          IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   8(R2),C'?'          IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   9(R2),C'?'          IF HELP REQUESTED                            
         BNE   VSTASOPX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMSOP),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         B     VSTAERR                                                          
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
VSTASOPX DS    0H                                                               
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          IF SET RECORD ID                             
         BNE   VSTASETN                                                         
*                                                                               
         GOTO1 =A(SETVAL),DUB,=C'ST',=AL1(RSTAKTYQ),                   X        
               RR=RELORGEN            VALIDATE SET ID                           
*                                                                               
         OC    WORK(4),WORK           ERROR IF NO ID RETURNED                   
         BZ    VSTASETE                                                         
*                                                                               
         MVC   RESTASID,WORK          SAVE STATION SET ID                       
*                                                                               
*MN      MVI   REQSML,C'L'         FLAG AS POSSIBLY LONG SOON                   
*                                                                               
****     CLC   =C'SOON',CONWHEN       MUST NOT BE SOON REQUEST                  
****     BE    VSTASONE                                                         
*                                                                               
         B     VSTAOK                 SET ID IS OKAY                            
*                                                                               
VSTASETN DS    0H                                                               
*                                                                               
*        SCAN INPUT FOR FILTER EXPRESSION                                       
*                                                                               
         XC    BLOCK(240),BLOCK                                                 
         XC    BLOCK+240(240),BLOCK+240                                         
*                                                                               
         GOTO1 SCANNER,DMCB,(20,(R2)),(6,BLOCK)                                 
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,4(R1)          GET NUMBER OF BLOCKS SCANNED                 
         BZ    VSTANFE             MUST HAVE A BLOCK                            
*                                                                               
         CH    R0,=H'1'            MAX ONE BLOCK ALLOWED                        
         BE    VSTA25                                                           
*                                                                               
*                                  THIS CHECK NEEDED BECAUSE SCANNER            
*                                  RETURNS 2 BLOCKS ON INPUT 'OWNER= '          
*                                  SECOND SCAN BLOCK IS EMPTY                   
*                                                                               
         CLI   BLOCK+42,0          IF SECOND BLOCK HAS SOMETHING                
         BNE   VSTAMAXE               THEN TOO MANY FILTERS                     
*                                                                               
VSTA25   DS    0H                                                               
*                                                                               
         LA    R4,BLOCK            POINT TO RETURNED BLOCK                      
*                                                                               
         CLI   1(R4),0             IF SECOND PART THEN NOT A STATION            
         BNE   VSTASTAN                                                         
*                                                                               
         CLC   0(1,R4),5(R2)       IF FIRST PART NE TOTAL INPUT                 
         BNE   VSTASTAN               THEN NOT A STATION                        
*                                     IE NOT OF FORM AAAAA=                     
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,1,0(R4)          CODE LENGTH                                  
         JZ    VSTANFE                                                          
*                                                                               
         LA    R5,12(R4)           START OF CODE                                
*                                                                               
         CLI   0(R5),C'-'          IF NEGATIVE FILTER                           
         JNE   *+20                                                             
         LA    R5,1(R5)               BUMP POINTER                              
         OI    REFTYPN2,REFTSTAQ      INDICATE SO                               
         BRCT  R3,*+8                 RECTIFY LENGTH COUNTER                    
         J     VSTANFE                NO CODE ENTERED                           
*                                                                               
*        VALIDATE STATION CALL LETTERS                                          
*                                                                               
VSTASTA  DS    0H                                                               
*                                                                               
         MVC   REFSTA,SPACES       INIT STATION CALL LETTERS                    
*                                                                               
         LR    R0,R3               COPY CALL LETTERS LENGTH                     
         LR    RF,R5               COPY START OF INPUT                          
         LA    RE,REFSTA           STATION SAVE AREA                            
*                                                                               
VSTASTLP DS    0H                                                               
*                                                                               
         CLI   0(RF),C'-'          IF '-' FOUND                                 
         BNE   VSTASTCN                                                         
*                                                                               
         LA    RF,1(RF)               SKIP THE '-'                              
*                                                                               
*MN      MVI   REQSML,C'L'         FLAG AS POSSIBLY LONG SOON                   
*                                                                               
         LA    RE,REFSTA+4            BAND MUST GO HERE                         
*                                                                               
         CH    R0,=H'2'            MAX 2 CHARACTERS LEFT '-' AND BAND           
         BH    VSTABNDE                                                         
*                                                                               
         BCT   R0,*+8                 LESS 1 ON IPT LEN (THE '-')               
         B     VSTASTDN               NOTHING AFTER THE '-' (WABC- )            
*                                                                               
VSTASTCN DS    0H                                                               
*                                                                               
         MVC   0(1,RE),0(RF)       MOVE NEXT BYTE TO SAVEAREA                   
         LA    RE,1(RE)            BUMP SAVEAREA POINTER                        
         LA    RF,1(RF)            BUMP INPUT POINTER                           
         BCT   R0,VSTASTLP                                                      
*                                                                               
VSTASTDN DS    0H                                                               
*                                                                               
*- IF BAND = 'T' (TELEVISION) THEN BLANK OUT BAND IN KEY.                       
*                                                                               
         CLI   REFSTA+4,C'T'                                                    
         BNE   *+8                                                              
         MVI   REFSTA+4,C' '                                                    
*                                                                               
*        MAKE SURE STATION IS ON FILE                                           
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RSTAKEY,R4          ESTABLISH REP STATION KEY                    
*                                                                               
         MVI   RSTAKTYP,RSTAKTYQ   RECORD TYPE                                  
         MVC   RSTAKREP,AGENCY     AGENCY                                       
         MVC   RSTAKSTA,REFSTA     STATION CALL LETTERS                         
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RSTAKEY,KEYSAVE                                                  
         BNE   VSTANFE             STATION NOT FOUND                            
*                                                                               
VSTASTAX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
         DROP  R4                                                               
*                                                                               
VSTASTAN DS    0H                                                               
*                                                                               
*        VALIDATE FILTER                                                        
*                                                                               
VSTAFLT  DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQSTOPT)),                 X        
               (0(R4),12(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   VSTAOPNE                                                         
*                                                                               
*MN      MVI   REQSML,C'L'         FLAG AS POSSIBLY LONG SOON                   
*                                                                               
****     CLC   =C'SOON',CONWHEN       MUST NOT BE SOON REQUEST                  
****     BE    VSTASONE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,VLTICODE       GET OPTION CODE                              
*                                                                               
*        FILTER ON MARKET                                                       
*                                                                               
VSTAMKT  DS    0H                                                               
*                                                                               
         CHI   RF,RKQSOMKT               MARKET FILTER                          
         BNE   VSTAMKTN                                                         
*                                                                               
*        VALIDATE MARKET CODE                                                   
*                                                                               
         BRAS  RE,MKTVAL                                                        
*                                                                               
         GOTOR TBLLST,DMCB,('RMKTKTYQ',0)                                       
*                                  ADD MARKET TO TABLES                         
         B     VSTAMKTX                                                         
*                                                                               
         XC    REFMKT,REFMKT       INIT MARKET SAVEAREA                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          MUST HAVE A CODE                             
         BZ    VSTAMKTE                                                         
*                                                                               
         CH    RF,=Y(L'REFMKT)     INPUT LENGTH IS FIXED                        
         BH    VSTAMKTE                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFMKT(0),22(R4)    SAVE MARKET CODE                             
*                                                                               
*        MAKE SURE MARKET IS ON FILE                                            
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RMKTREC,R4          ESTABLISH REP STATION KEY                    
*                                                                               
         MVI   RMKTKTYP,RMKTKTYQ   RECORD TYPE                                  
         MVC   RMKTKREP,AGENCY     AGENCY                                       
         MVC   RMKTKMKT,REFMKT     MARKET CODE                                  
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RMKTKEY,KEYSAVE                                                  
         BNE   VSTAMKTE            STATION NOT VALID                            
*                                                                               
*        ADD MARKET RECORD TYPE TO REDATA LIST                                  
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RMKTKTYQ',0),RR=RELORGEN                       
*                                                                               
VSTAMKTX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTAMKTN DS    0H                                                               
*                                                                               
VSTAOWN  DS    0H                                                               
*                                                                               
         CHI   RF,RKQSOOWN               OWNER FILTER                           
         BNE   VSTAOWNN                                                         
*                                                                               
*        VALIDATE OWNER                                                         
*                                                                               
         MVC   REFOWN,SPACES       INIT OWNER SAVEAREA                          
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          MUST HAVE A CODE                             
         BZ    VSTAOWNE                                                         
*                                                                               
         CH    RF,=Y(L'REFOWN)     CHECK ON MAX INPUT LENGTH                    
         BH    VSTAOWNE                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFOWN(0),22(R4)    SAVE OWNERSHIP CODE                          
*                                                                               
         OI    REFTYPS2,REFTOWNQ   INDICATE FILTERING ON OWNER                  
*                                                                               
*        MAKE SURE OWNER IS ON FILE                                             
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING ROWNREC,R4          ESTABLISH REP STATION KEY                    
*                                                                               
         MVI   ROWNKTYP,X'2A'      RECORD TYPE                                  
         MVC   ROWNKREP,AGENCY     AGENCY                                       
         MVC   ROWNKOWN,REFOWN     OWNERSHIP CODE                               
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   ROWNKEY,KEYSAVE                                                  
         BNE   VSTAOWNE            STATION NOT VALID                            
*                                                                               
*        ADD OWNER RECORD TYPE TO REDATA LIST                                   
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('ROWNKTYQ',0),RR=RELORGEN                       
*                                                                               
VSTAOWNX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTAOWNN DS    0H                                                               
*                                                                               
*        VALIDATE AFFILIATE CODE                                                
*                                                                               
         CHI   RF,RKQSOAFF               AFFILIATE FILTER                       
         BNE   VSTAAFFN                                                         
*                                                                               
VSTAAFF  DS    0H                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   23(R4),C'?'         IF HELP REQUESTED                            
         BNE   VSTAAFHX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMSAF),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
VSTAAFHX DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQSTNAF)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   VSTAAFNE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   REFAFF,VLTFULL      STATION AFFLIATION                           
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTAAFFX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTAAFFN DS    0H                                                               
*                                                                               
*        VALIDATE STATION TYPE CODE                                             
*                                                                               
         CHI   RF,RKQSOTYP               TYPE FILTER                            
         BNE   VSTATYPN                                                         
*                                                                               
VSTATYP  DS    0H                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   23(R4),C'?'         IF HELP REQUESTED                            
         BNE   VSTATYHX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMSTP),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         B     VSTAERR                                                          
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
VSTATYHX DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQSTTPS)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   VSTATPNE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   REFSTTP,VLTICODE+1   STATION TYPE                                
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTATYPX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTATYPN DS    0H                                                               
*                                                                               
         CHI   RF,RKQSORNK               MARKET RANK CODE                       
         BNE   VSTARNKN                                                         
*                                                                               
*        VALIDATE MARKET RANK CODE                                              
*                                                                               
VSTARNK  DS    0H                                                               
*                                                                               
         TM    3(R4),X'80'         INPUT MUST BE NUMERIC                        
         BNO   VSTARKNE                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,7,9(R4)          GET NUMERIC VALUE                            
         BZ    VSTARKNE            RANK CAN'T BE ZERO                           
*                                                                               
         CH    RF,=H'7'            MAX VALUE IS 7                               
         BH    VSTARKNE                                                         
*                                                                               
         MVC   REFRNK,SPACES       INIT RANK CODE SAVEAREA                      
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          MUST HAVE A CODE                             
         BZ    VSTARKNE                                                         
*                                                                               
         CH    RF,=Y(L'REFRNK)     CHECK ON MAX INPUT LENGTH                    
         BH    VSTARKNE                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFRNK(0),22(R4)    SAVE MARKET RANK CODE                        
*                                                                               
VSTARNKX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
VSTARNKN DS    0H                                                               
*                                                                               
         CHI   RF,RKQSOTVB               TVB REGION CODE                        
         BNE   VSTATVBN                                                         
*                                                                               
*        VALIDATE TVB REGION CODE                                               
*                                                                               
VSTATVB  DS    0H                                                               
*                                                                               
         MVC   REFTVB,SPACES       INIT TVB REGION CODE SAVEAREA                
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          MUST HAVE A CODE                             
         BZ    VSTATBNE                                                         
*                                                                               
         CH    RF,=Y(L'REFTVB)     CHECK ON MAX INPUT LENGTH                    
         BH    VSTATBNE                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   REFTVB(0),22(R4)    SAVE TVB REGION CODE                         
*                                                                               
*        MAKE SURE TVB REGION CODE IS IN LIST                                   
*                                                                               
         LA    R1,TVBLST           POINT TO TVB LIST                            
*                                                                               
         ST    R1,REATVBLS         SAVE A(TVB LIST)                             
*                                                                               
         CLI   0(R1),X'FF'         DONE AT END OF LIST                          
         BE    VSTAAFNE                                                         
         CLC   REFTVB,0(R1)        MATCH INPUT TO LIST ENTRIES                  
         BE    *+12                                                             
         LA    R1,L'TVBLST(R1)     BUMP TO NEXT LIST ENTRY                      
         B     *-22                                                             
*                                                                               
VSTATVBX DS    0H                                                               
*                                                                               
         B     VSTAOK                                                           
*                                                                               
* TVBLST                                                                        
       ++INCLUDE RETVBTAB                                                       
*                                                                               
VSTATVBN DS    0H                                                               
*                                                                               
VSTAOK   DS    0H                                                               
*                                                                               
*        ADD STATION RECORD TYPE TO REDATA LIST                                 
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RSTAKTYQ',0),RR=RELORGEN                       
*                                                                               
*                                                                               
*        ADD MARKET  RECORD TYPE TO REDATA LIST                                 
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RMKTKTYQ',0),RR=RELORGEN                       
*                                                                               
VSTAX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        ERROR MESSAGES                                                         
*                                                                               
VSTASONE DS    0H                  NOT ALLOWED FOR SOON REQUEST                 
*                                                                               
         MVI   ERROR,RWENSOON                                                   
         B     VSTAERR                                                          
*                                                                               
VSTAOPNE DS    0H                  STATION FILTER CODE NOT VALID                
*                                                                               
         MVI   ERROR,RWEFOPNV                                                   
         B     VSTAERR                                                          
*                                                                               
VSTAMKTE DS    0H                  MARKET NOT FOUND                             
*                                                                               
         MVI   ERROR,RWEMKTNF                                                   
         B     VSTAERR                                                          
*                                                                               
VSTAOWNE DS    0H                  OWNER NOT FOUND                              
*                                                                               
         MVI   ERROR,RWEOWNNF                                                   
         B     VSTAERR                                                          
*                                                                               
VSTASETE DS    0H                  STATION SET NOT FOUND                        
*                                                                               
         MVI   ERROR,RWESTSNF                                                   
         B     VSTAERR                                                          
*                                                                               
VSTANFE  DS    0H                  STATION NOT FOUND                            
*                                                                               
         MVI   ERROR,RWESTANF                                                   
         B     VSTAERR                                                          
*                                                                               
VSTAMAXE DS    0H                  TOO MANY FILTERS IN FIELD                    
*                                                                               
         MVI   ERROR,RWEMAXFL                                                   
         B     VSTAERR                                                          
*                                                                               
VSTABNDE DS    0H                  BROADCAST BAND NOT VALID                     
*                                                                               
         MVI   ERROR,RWEBNDNV                                                   
         B     VSTAERR                                                          
*                                                                               
VSTAAFNE DS    0H                  AFFILIATE CODE NOT VALID                     
*                                                                               
         MVI   ERROR,RWEAFFNV                                                   
         B     VSTAERR                                                          
*                                                                               
VSTATPNE DS    0H                  STATION TYPE CODE NOT VALID                  
*                                                                               
         MVI   ERROR,RWETYPNV                                                   
         B     VSTAERR                                                          
*                                                                               
VSTATPFE DS    0H                  STATION TYPE CODE NOT FOUND                  
*                                                                               
         MVI   ERROR,RWETYPNF                                                   
         B     VSTAERR                                                          
*                                                                               
VSTATPME DS    0H                  STATION TYPE CODE MISSING                    
*                                                                               
         MVI   ERROR,RWETYPMS                                                   
         B     VSTAERR                                                          
*                                                                               
VSTATPLE DS    0H                  STATION TYPE CODE TOO LARGE                  
*                                                                               
         MVI   ERROR,RWETYPLN                                                   
         B     VSTAERR                                                          
*                                                                               
VSTARKNE DS    0H                  MARKET  RANK CODE NOT VALID                  
*                                                                               
         MVI   ERROR,RWERNKNV                                                   
         B     VSTAERR                                                          
*                                                                               
VSTATBNE DS    0H                  TVB REGION NOT VALID                         
*                                                                               
         MVI   ERROR,RWETVBNV                                                   
         B     VSTAERR                                                          
*                                                                               
VSTAERR  DS    0H                                                               
         GOTO1 ERREX                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - XFLVAL'                   
***********************************************************************         
*                                                                     *         
*              VALIDATE CROSS FILE OPTION                             *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
XFLVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
*        RECORD MUST BE XFILE                                                   
*                                                                               
         CLI   RECNUM,X'05'        XFILE RECORD NUMBER                          
         JNE   VOPTXF1E                                                         
*                                                                               
*        MUST NOT BE RUN SOON                                                   
*                                                                               
         TM    WHEN,X'20'          CHECKING IF RUNNING SOON                     
         JNE   VOPTXF2E                                                         
*                                                                               
*        VALIDATE SIGN ON REP TO GET GROUP                                      
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         MVC   BYTE,VLFLT3V-VLPARMS(R1) SAVE CURRENT FILTER VALUE               
*                                                                               
         MVI   VLFLT3V-VLPARMS(R1),0    SET FOR ALL REPS                        
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQXFLRP)),                 X        
               (2,AGENCY),AVLTAB,0,0,0                                          
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   VOPTXFLE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   VLFLT3V-VLPARMS(1,R1),VLTEXTRA GET SIGN ON'S GROUP CODE          
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         JNE   VOPTXFHX                                                         
*                                                                               
         MVC   HCBFLT3V-HELPCB+HELPCBLK,VLTEXTRA GET SIGN ON'S GRP CDE          
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMXFL),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
VOPTXFHX DS    0H                                                               
*                                                                               
*        VALIDATE ENTERED REPS                                                  
*        INPUT OF FORM REP1/REP2/REP3.....                                      
*                                                                               
         SR    R6,R6                                                            
         ICM   R6,1,1(R4)          LENGTH OF REP LIST                           
         JZ    VOPTXFLE                                                         
         LA    R3,22(R4)           POINT TO START OF REP LIST                   
         LR    RE,R3               SAVE START OF REP                            
*                                                                               
         MVC   NAMEAREA,SPACES     INIT PRINT AREA                              
*                                                                               
VOPTXFLP DS    0H                                                               
*                                                                               
         CLI   0(R3),C'/'          LOOKING FOR END OF REP                       
         JNE   VOPTXFCN                                                         
*                                                                               
VOPTXFFD DS    0H                                                               
*                                                                               
         LR    RF,R3               COPY END OF REP                              
         SR    RF,RE               LENGTH OF REP                                
         LR    R5,RE               SAVE START OF REP                            
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQXFLRP)),                 X        
               ((RF),(R5)),AVLTAB,0,0,0                                         
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   VOPTXFLE                                                         
*                                                                               
         LR    RE,R5               RESTORE START OF REP                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         LA    RF,REXFREP          START OF REP SAVEAREA                        
*                                                                               
         CLC   0(L'REXFREP,RF),SPACES    FIND NEXT OPEN SPACE                   
         JNH   *+12                                                             
         LA    RF,L'REXFREP(RF)                                                 
         J     *-14                                                             
*                                                                               
         MVC   0(L'REXFRPCH,RF),VLTSHORT            SAVE REP CODE               
         MVC   L'REXFRPCH(L'REXFRPSE,RF),VLTEXTRA+1 SAVE REP SE CODE            
*                                                                               
*        ADD REP LONG NAME TO OPTION DESCRIPTION                                
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFF-LINE                         
         JNE   VOPTXFNX                                                         
*                                                                               
         LA    RE,NAMEAREA         START OF OPTION DESCRIPTION                  
         LA    RF,L'NAMEAREA                                                    
*                                  FIND NEXT OPEN AREA IN NAMEAREA              
         CLI   0(RE),C' '                                                       
         JNH   *+16                                                             
         LA    RE,1(RE)                                                         
         BRCT  RF,*-12                                                          
         J     VOPTXFNX            NO ROOM                                      
*                                                                               
         CHI   RF,L'NAMEAREA       SKIP IF FIRST REP                            
         JE    *+20                                                             
         MVI   0(RE),C'/'          SET SEPARATOR                                
         LA    RE,1(RE)                                                         
         BRCT  RF,*+8              RECTIFY LENGTH COUNTER                       
         J     VOPTXFNX            NO ROOM                                      
*                                                                               
         CLM   RF,1,VLTLFULL       MAKE SURE THERE IS ROOM FOR REP              
         JNH   *+8                                                              
         ICM   RF,1,VLTLFULL                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  R1,0                DETERMINE WHERE WE ARE                       
         EX    RF,8(R1)                                                         
         J     *+10                                                             
         MVC   0(0,RE),VLTFULL     DISPLAY FULL REP NAME                        
*                                                                               
VOPTXFNX DS    0H                                                               
*                                                                               
         CHI   R6,1                CHECK ON HOW MUCH IS LEFT OF LIST            
         JL    VOPTXFDN            NOTHING LEFT - END OF LIST                   
         JE    VOPTXFLE            LIST CAN'T END IN '/'                        
*                                                                               
         LA    RE,1(R3)            SAVE START OF NEXT REP                       
*                                                                               
VOPTXFCN DS    0H                                                               
*                                                                               
         LA    R3,1(R3)            POINT TO NEXT BYTE IN LIST                   
         BRCT  R6,VOPTXFLP         DECREMENT LIST LENGTH COUNTER                
         J     VOPTXFFD            LAST REP IN LIST                             
*                                                                               
VOPTXFDN DS    0H                                                               
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF ON-LINE                              
         JNE   VOPTXFLX                                                         
*                                                                               
         BRAS  RE,PRTOPT                PRINT OPTION                            
*                                                                               
VOPTXFLX DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         MVC   VLFLT3V-VLPARMS(1,R1),BYTE RESTORE CURRENT FILTER VALUE          
*                                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
*        ERROR MESSAGES                                                         
*                                                                               
VOPTXF1E LHI   RF,RWEXFL1E         MUST BE RECORD 'XFILE'                       
         J     VOPTXFER                                                         
*                                                                               
VOPTXF2E LHI   RF,RWESOON          CAN'T RUN SOON                               
         J     VOPTXFER                                                         
*                                                                               
VOPTXFLE LHI   RF,RWEXFLE          INVALID XFILE REP                            
         J     VOPTXFER                                                         
*                                                                               
VOPTXFER DS    0H                                                               
*                                                                               
         ST    R4,DMCB+8           SAVE ERROR POINTER                           
         STCM  RF,3,RERROR         SET ERROR MESSAGE CODE                       
         GOTO1 CURSERR                                                          
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VALROW'                   
***********************************************************************         
*                                                                     *         
*              VALIDATE ROWS                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VALROW   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         LA    R0,DRLENIN          CLEAR DRONEBLOCK AREA                        
         LA    R1,DRINFEND-DRLENIN                                              
         LR    RE,R0                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         XC    DRATTRIB,DRATTRIB   INIT ATTRIBUTE AREA                          
*                                                                               
*        ROWS - FIRST VALIDATE FOR KEYWORD                                      
*                                                                               
         STC   R3,FLDNMBR          SAVE FIELD NUMBER                            
         ST    R2,ALASTCOL         SAVE COLUMN POINTER                          
*                                                                               
         CLI   5(R2),0             SKIP IF NO DATA ENTERED                      
         BE    VALROWX                                                          
*                                                                               
         LA    R4,BLOCK            POINT TO START OF SCANNER BLOCK              
*                                                                               
VALROWXL DS    0H                                                               
*                                                                               
         STC   R3,FLDNMBR          SAVE FIELD NUMBER                            
         ST    R2,ALASTCOL         SAVE COLUMN POINTER                          
*                                                                               
         MVI   FIELDERR,1          INIT FIELD IN ERROR COUNTER                  
*                                                                               
         NI    ROWCOLSW,X'FF'-ROWCOLXQ INIT CONTINUED FIELD INDICATOR           
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,5(R2)          FIELD LENGTH                                 
         LA    RE,7(RF,R2)         LAST BYTE OF INPUT                           
*                                                                               
         CLI   0(RE),C','          IF FIELD ENDS IN COMMA                       
         BNE   VALROWX1                                                         
*                                                                               
         MVI   0(RE),C' '             REPLACE COMMA                             
         OI    ROWCOLSW,ROWCOLXQ      FIELD CONTINUED IN NEXT FIELD             
         BCTR  RF,0                   LENGTH DECREMENTED FOR SCANNER            
         STC   RF,5(R2)                                                         
*                                                                               
VALROWX1 DS    0H                                                               
*                                                                               
*        SCAN ENTRY FOR KEYWORD AND FILTERS/FORMAT INSTRUCTIONS                 
*                                                                               
         XC    BLOCK(240),BLOCK                                                 
         XC    BLOCK+240(240),BLOCK+240                                         
*                                                                               
         GOTO1 SCANNER,DMCB,(20,(R2)),(11,(R4)),0                               
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,4(R1)          SOMETHING MUST HAVE BEEN SCANNED             
         BZ    VRWKYNVE                                                         
*                                                                               
         TM    ROWCOLSW,ROWCOL2Q   SKIP IF DOING CONTINUATION FIELD             
         BO    VRWQUAL                                                          
*                                                                               
         CLI   12(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   13(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   12(R4),C'+'         IF HELP REQUESTED                            
         BNE   VRWHLPX                                                          
*                                                                               
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVC   HCBFTYP-HELPCB(L'HCBFTYP,RF),MYPOSO                              
*                                                                               
         CLI   MYPOSO,0            IF PROCESSING A ROW                          
         BNE   *+8                                                              
         MVI   HCBFTYP-HELPCB(RF),C'R'   HARD CODE VALUE                        
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMKYW),(R2),HELPCBLK SHOW HELP MENU         
*                                     FOR KEYWORDS                              
*                                                                               
*        NEVER RETURNS HERE                                                     
*                                                                               
VRWHLPX  DS    0H                                                               
*                                                                               
         OI    SORTIND,SORTFLDQ    INDICATE REPORT HAS A SORT FIELD             
*                                                                               
*        VALIDATE KEYWORD                                                       
*                                                                               
VRWKYW   DS    0H                                                               
*                                                                               
*        CHECK FOR '<' & '>' AS SEPARATORS                                      
*                                                                               
         CLI   0(R4),0             MAKE SURE WE HAVE A KEYWORD                  
         BE    VRWKYNVE                                                         
*                                                                               
         GOTO1 =A(SEPSCAN),RR=RELORGEN CHECK FOR < AND >                        
*                                                                               
         BNE   VRWKYNVE            ERROR FOUND                                  
*                                                                               
*        VALIDATE KEYWORD AGAINST FILTERS                                       
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQWRKYW)),                 X        
               (0(R4),12(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   VRWKYNVE                                                         
*                                                                               
         DROP  R1                                                               
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         CLI   SCANSEP,0           IF THERE IS A DATA SEPARATER                 
         B     VRWVAL05            BACKING FOLLOWING CHECK OUT                  
*                                                                               
         BE    VRWVAL05                                                         
*                                     MAKE SURE IT IS ALLOWED                   
         SR    RF,RF                                                            
         ICM   RF,1,VLTLFULL       GET KYWD NAME LENGTH                         
         BZ    VRWVAL05            SHOULDN'T HAPPEN                             
*                                                                               
         LA    R1,VLTFULL-1(RF)    POINT TO LAST BYTE                           
*                                                                               
         CLI   0(R1),C'='          CHECK IF THIS IS A FILTER KYWD               
         BE    VRWVAL05               YES                                       
         BCTR  R1,0                                                             
         BCT   RF,*-10                RESET LENGTH                              
*                                                                               
         J     VRWSEPER            NO FILTERING ALLOWED FOR KYWD                
*                                                                               
VRWVAL05 DS    0H                                                               
*                                                                               
         CLC   VLTMINO,0(R4)       SKIP IF INPUT AS LONG AS OUTPUT              
         BNH   VRWVAL10                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,VLTMINO        GET MINIMUM OUTPUT LENGTH                    
         BZ    VRWVAL10            NONE FOUND                                   
*                                                                               
         MVC   12(10,R4),SPACES    INIT SCANNED AREA                            
         STC   RF,0(R4)            RESET SCANNED LENGTH                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   12(0,R4),VLTFULL    RESET TO FULL VALUE                          
*                                                                               
         LA    R1,12(RF,R4)        POINT TO LAST BYTE                           
*                                                                               
         CLI   0(R1),C'='          IF IT IS '=', ELIMINATE IT                   
         BNE   *+12                                                             
         MVI   0(R1),C' '                                                       
         STC   RF,0(R4)               RESET LENGTH                              
*                                                                               
VRWVAL10 DS    0H                                                               
*                                                                               
         DROP  R5                                                               
*                                                                               
         GOTO1 VROWDRON            VALIDATE A ROW ENTRY VIA DRONE               
*                                                                               
         CLI   DRERROR,0           CHECK FOR VALIDATION ERRORS                  
         BNE   VRWKYNVE                                                         
*                                                                               
         CLI   DRARGSI,X'0A'       NEW RECORD ID FOR AGY KYWDS                  
         BNE   *+8                                                              
         MVI   DRARGSI,X'1A'                                                    
*                                                                               
         CLI   DRARGSO,X'0A'       NEW RECORD ID FOR AGY KYWDS                  
         BNE   *+8                                                              
         MVI   DRARGSO,X'1A'                                                    
*                                                                               
         OI    ROWMIDSW,RMIDFNDQ   INDICATE KEYWORD FOUND                       
*                                                                               
         MVC   DRARGSI+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         MVI   DRNARGSI,16         ASSUME MAXIMUN NUMBER OF ARGUMENTS           
*                                                                               
         MVC   DRARGSO+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         MVI   DRNARGSO,16         ASSUME MAXIMUM NUMBER OF ARGUMENTS           
*                                                                               
         EJECT                                                                  
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE                      
         USING VLTABD,R5           ESTABLISH TABLE                              
*                                                                               
         CLC   VLTICODE,=Y(RKQTEXT)  IF TEXT FIELD                              
         BNE   VRWTEXTN                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          GET TEXT LENGTH                              
         BZ    VRWTXMSE            MUST HAVE ENTRY                              
*                                                                               
         CHI   RF,L'DRLITI         TEXT MUST NOT BE TOO LONG                    
         BH    VRWTXLNE                                                         
*                                                                               
         STC   RF,DRLITLNI         SAVE TEXT LENGTH                             
         STC   RF,DRLENI           SET INPUT  WIDTH                             
         STC   RF,DRLENO           SET OUTPUT WIDTH                             
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DRLITI(0),22(R4)    SAVE ENTERED TEXT                            
*                                                                               
         B     VRWKYWX             GO TO END OF KEYWORD VALIDATION              
*                                                                               
VRWTEXTN DS    0H                                                               
*                                                                               
*        CHECK FOR DATE TYPE ROW                                                
*                                                                               
         CLC   =C'DT',DRATTRIB     IF A DATE KEYWORD                            
         BNE   *+14                                                             
         MVC   REQDTYPE,DRARGSI+1     SAVE DATE TYPE                            
         OI    RECNTRL,RECDLSTQ       INDICATE DATE LIST PROCESSING             
*                                                                               
*        CHECK FOR STACKING (STACK=A-N)                                         
*        CHECK FOR MERGING  (MERGE=A-N)                                         
*                                                                               
         CLC   VLTICODE,=Y(RKQSTACK)  IF STACKING BEING CALLED FOR              
         BE    *+10                                                             
         CLC   VLTICODE,=Y(RKQMERGE)  IF MERGING BEING CALLED FOR               
         BNE   VRWSTKN                                                          
*                                                                               
         CLI   1(R4),0                MUST HAVE COLUMN SPECIFICATION            
         BE    VRWSTK2E                                                         
*                                                                               
         CLI   1(R4),3                AND AT MOST 3 LONG                        
         BH    VRWSTK2E                                                         
*                                                                               
         OI    SPECOPT2,GLDADDCH      IN CASE DOWNLOADING, KEEP                 
*                                        CHAR ADDITIVE FIELDS AS CHAR           
*                                        EVEN IF NUMERIC                        
*                                                                               
         CLC   VLTICODE,=Y(RKQMERGE)    IF MERGING BEING CALLED FOR             
         BNE   VRWMRG05                                                         
*                                                                               
         OI    STACKSW,STCKMRGQ+STCKBUFQ  INDICATE MERGING AND                  
*                                         BUFFER NEEDED OFF-LINE                
         NI    DRFLAGO,X'FF'-X'80' TURN OFF PRINT IND ON ALL HEADLINES          
         NI    DRHEAD1,X'FF'-X'80'                                              
         NI    DRHEAD2,X'FF'-X'80'                                              
         NI    DRHEAD3,X'FF'-X'80'                                              
         NI    DRHEAD4,X'FF'-X'80'                                              
*                                                                               
         B     VRWMRG10                                                         
*                                                                               
VRWMRG05 DS    0H                                                               
*                                                                               
         OI    STACKSW,STACKYQ+STCKBUFQ ELSE INDICATE STACKING AND              
*                                         BUFFER NEEDED OFF-LINE                
*                                                                               
*        INITIALIZE STACK BUFFER                                                
*                                                                               
         ICM   RF,15,ASTACKBF      POINT TO STACK BUFFER                        
         USING STACKBFD,RF         ESTABLISH BUFFER                             
*                                                                               
         LA    RE,STBFSTRT         SET BXLE ADDRESSES FOR BUFFER                
         ST    RE,STBFSTA          START ADDRESS                                
         BCTR  RE,0                                                             
         ST    RE,STBFENA          CURRENT END ADDRESS                          
         LA    RE,STBFENTL         BUFFER ENTRY LENGTH                          
         ST    RE,STBFLEN                                                       
*                                                                               
         DROP  RF                                                               
*                                                                               
VRWMRG10 DS    0H                                                               
*                                                                               
         LA    RF,22(R4)           POINT TO COLUMN SPECIFICATIONS               
*                                                                               
         CLI   0(RF),C'A'          MUST BE A TO N                               
         BL    VRWSTK2E                                                         
         CLI   0(RF),C'N'                                                       
         BH    VRWSTK2E                                                         
*                                                                               
         MVC   STACK1ST,0(RF)      SAVE STARTING COLUMN                         
*                                                                               
         CLI   1(R4),1             OKAY IF ONLY 1 COLUMN                        
         BE    VRWSTKCX                                                         
*                                                                               
         CLI   1(RF),C'-'          ELSE NEED DASH AS SEPARATOR                  
         BNE   VRWSTK2E                                                         
*                                                                               
         CLC   2(1,RF),STACK1ST    MUST BE EQUAL OR AFTER FIRST                 
         BL    VRWSTK2E                                                         
         CLI   2(RF),C'N'          AND AT MOST C'N'                             
         BH    VRWSTK2E                                                         
*                                                                               
         MVC   STACKLST,2(RF)      SAVE ENDING COLUMN                           
*                                                                               
VRWSTKCX DS    0H                                                               
*                                                                               
         B     VRWKYWX             GO TO END OF KEYWORD VALIDATION              
*                                                                               
VRWSTKN  DS    0H                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
*        CROSS CHECKING FOR RANK ENTRY                                          
*                                                                               
VRWRNK   DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQRANK)                                           
         BNE   VRWRANKN                                                         
*                                                                               
         LA    R4,42(R4)           BUMP TO NEXT SCANNER ENTRY                   
*                                  RANK NEEDS A COMPUTE EXPRESSION              
*                                  AS FOLLOWING ENTRY                           
*                                                                               
         BCT   R0,*+8              MUST HAVE A FOLLOWING SCANNER ENTRY          
         B     VRWRNKE                                                          
*                                                                               
         CLI   FLDNMBR,1           RANK NEEDS FOLLOWING KEYWORD -               
         BNH   VRWRNK2E               CAN'T BE LAST ROW KEYWORD                 
*                                                                               
         AI    FIELDERR,1          BUMP FIELD IN ERROR COUNTER                  
         MVI   DRCMPMAX,C'N'                                                    
         MVI   RANKSW,C'R'         INDICATE RANK IN ROW RQSTD- NO               
*                                   TOTALS AFTER THIS                           
         CLI   OFFLINE,C'Y'        IF OFF-LINE                                  
         BNE   VRWRNK1                                                          
*                                                                               
         GOTO1 GROWDRON               GENERATE ROW ENTRY                        
         GOTO1 GCMPDRON               GENERATE FOR COMPUTE                      
*                                                                               
         CLI   DRERROR,0              CHECK FOR ERRORS                          
         BNE   VRWCMPE                                                          
*                                                                               
         B     VALROWX                GO TO END OF ROW VALIDATION               
*                                                                               
VRWRNK1  DS    0H                                                               
*                                                                               
         GOTO1 VCMPDRON            VALIDATE NEXT FIELD AS COMPUTE               
         CLI   DRERROR,0                                                        
         BNE   VRWCMPE                                                          
*                                                                               
         CLI   MYPOSO,0            IF WE'RE DOING ROWS - NOT 'H' OR 'M'         
         BNE   VRWRANKX                                                         
*                                                                               
         LR    R3,R2               SAVE CURRENT FIELD POINTER                   
*                                                                               
         ZIC   RF,0(R2)            BUMP TO NEXT SCREEN FIELD                    
         AR    R2,RF                                                            
*                                                                               
         CLI   5(R2),0             IF NEXT FIELD HAS NO INPUT                   
         LR    R2,R3               THEN ERROR BECAUSE IT IS                     
         BE    VRWRNK2E              NOT GOOD TO RANK ON LAST ROW               
*                                                                               
VRWRANKX DS    0H                                                               
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWRANKN DS    0H                                                               
*                                                                               
*        IF DOING RGON REPORT SET DATATYPE IN CONTROL BLOCK                     
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   VRWRGONN                                                         
*                                                                               
         LA    RF,RERRGWRC         ESTABLISH CONTROL BLOCK                      
         USING RRGWRI,RF                                                        
*                                                                               
         LA    R1,RRGWDT1          FIRST DATATYPE                               
         LA    RE,8                MAX 8 DATATYPES                              
*                                                                               
         CLI   0(R1),0             FIND FIRST EMPTY DATATYPE SLOT               
         BE    *+16                                                             
         LA    R1,L'RRGWDT1+L'RRGWDA1(R1) BUMP TO NEXT SLOT                     
         BCT   RE,*-12                                                          
         B     VRWRRG1E            TOO MANY DATATYPES                           
*                                                                               
         MVC   0(1,R1),DRARGSI     SET DATATYPE                                 
*                                                                               
         DROP  RF                                                               
*                                                                               
VRWRGONN DS    0H                                                               
*                                                                               
*        CHECK IF KEYWORD BEING FILTERED ON VALUE                               
*                                                                               
VRWFLTR  DS    0H                                                               
*                                                                               
         GOTO1 =A(FLTRVAL),RR=RELORGEN                                          
         BNE   VRWFVALE            INVALID FILTER                               
*                                                                               
VRWFLTRX DS    0H                                                               
*                                                                               
VRWKYWX DS     0H                                                               
*                                                                               
         CLI   MYPOSO,C'H'         SPECIAL FOR HEADS                            
         BNE   VRW4                                                             
*                                                                               
         OI    DRFIRST,X'80'       GENERATE FIRST STATEMENT                     
         OI    DRFOPTS,DRFSKIP     WITH SKIP OPTION                             
         MVI   DRFSPACE,0                                                       
*                                                                               
         B     VRWTYPX                                                          
*                                                                               
VRW4     CLI   MYPOSO,C'M'         SPECIAL FOR MID                              
         BNE   VRWTYPX                                                          
*                                                                               
VRWTYPX  DS    0H                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
* CHECK FOR QUALIFYING ROW EXPRESSIONS                                          
*                                                                               
         CLI   REQPZERO,C'Y'          IF WE ARE TO PRINT ZEROS                  
         BNE   *+12                                                             
         OI    DROPTSO,DRZEROO           SET DRIVER INDICATOR                   
****     NI    DROPTSO,X'FF'-DRCOMMAO    KILL COMMAS IN OUTPUT                  
         B     *+8                                                              
*                                                                               
         NI    DROPTSO,X'FF'-DRZEROO  ELSE TURN OFF INDICATOR                   
*                                                                               
         LA    R4,42(R4)           POINT TO NEXT SCANNED ENTRY                  
         AI    FIELDERR,1          BUMP SCANNED FIELD COUNTER                   
         BCT   R0,*+8              DECREMENT FIELD COUNTER                      
         B     VRWQUAD             NO QUALIFIERS                                
*                                                                               
VRWQUAL  DS    0H                                                               
*                                                                               
*        CHECK FOR '<' & '>' AS SEPARATORS                                      
*                                                                               
         GOTO1 =A(SEPSCAN),RR=RELORGEN CHECK FOR < AND >                        
*                                                                               
         BNE   VRWCFNVE            ERROR FOUND                                  
*                                                                               
         CLI   12(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   13(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   12(R4),C'+'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   13(R4),C'?'         IF HELP REQUESTED                            
         BNE   VRWQHLPX                                                         
*                                                                               
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVC   HCBFTYP-HELPCB(L'HCBFTYP,RF),MYPOSO                              
*                                                                               
         CLI   MYPOSO,0            IF PROCESSING A ROW                          
         BNE   *+8                                                              
         MVI   HCBFTYP-HELPCB(RF),C'R'   HARD CODE VALUE                        
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMCFW),(R2),HELPCBLK SHOW HELP MENU         
*                                     FOR OPTIONS                               
VRWQHLPX DS    0H                                                               
*                                                                               
         MVC   FIELDERR,4(R4)      SAVE NUMERIC VALUE OF ENTRY                  
*                                                                               
*              CHECK FOR SUBSIDIARY ROW EXPRESSIONS                             
*                                                                               
*                                                                               
*        PURE NUMBER IS ASSUMED TO BE LENGTH OVERRIDE                           
*                                                                               
VRWFLN   DS    0H                                                               
*                                                                               
         TM    2(R4),X'80'         NUMERIC=OUTPUT WIDTH OVERRIDE                
         BNO   VRWFLNN                                                          
*                                                                               
         MVC   DRLENO,4+3(R4)      (NEW OUTPUT LENGTH)                          
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWFLNN  DS    0H                                                               
*                                                                               
*        ANALYZE FOR FLOWCHARTING                                               
*                                                                               
VRWFFLW  DS     0H                                                              
*                                                                               
         CLC   =C'ST',12(R4)       AVOID STA=  CONFUSION                        
         BE    VRWFFLWN                                                         
*                                                                               
         CLC   =C'SP',12(R4)       AVOID SPACE CONFUSION                        
         BE    VRWFFLWN                                                         
*                                                                               
         CLC   =C'SK',12(R4)       AVOID SKIP  CONFUSION                        
         BE    VRWFFLWN                                                         
*                                                                               
         CLI   12(R4),C'Y'         YEARLY    TOTAL                              
         BE    VRWFFLW1                                                         
         CLI   12(R4),C'S'         SEMI-ANNUAL TOTAL                            
         BE    VRWFFLW1                                                         
         CLI   12(R4),C'Q'         QUARTERLY TOTAL                              
         BE    VRWFFLW1                                                         
         CLI   12(R4),C'M'         MONTHLY TOTALS                               
         BE    VRWFFLW1                                                         
         CLI   12(R4),C'W'         WEEKLY  TOTALS                               
         BNE   VRWFFLWN                                                         
*                                                                               
VRWFFLW1 DS    0H                                                               
*                                                                               
         CLI   13(R4),C'1'         DATE RANGE MUST BE NUMERIC                   
         BL    VRWFLW1E                                                         
*                                                                               
         CLI   DRATTRIB,C'$'       IF NOT NUMERIC FIELD                         
         BE    *+12                                                             
         CLI   MYLABEL,C'A'        THEN MUST BE 1ST COLUMN                      
         BNE   VRW1STE                                                          
*                                                                               
         MVC   FLOWDTYP,12(R4)       SAVE FLOWCHART DATE TYPE                   
*                                                                               
         MVI   FCHRTITR,0            INITIALIZE                                 
*                                                                               
*        VALIDATE FLOWCHART EXPRESSION AND BUILD DATE TABLE                     
*                                                                               
         MVI   ERROR,0             IN CASE ERROR CODE SET                       
         GOTOR PEREXP,DMCB,0                                                    
*                                                                               
         CLI   ERROR,0             CHECK FOR ERRORS                             
         BNE   VRWERR                                                           
*                                                                               
         ICM   RF,15,ADATLIST         ESTABLISH DATE LIST                       
         BZ    VRWQUAC                                                          
*                                                                               
         USING DATELSTD,RF                                                      
*                                                                               
         CLI   EXPLIST,255         CHECK FOR ERRORS                             
         BE    VRWERR              ERROR CODE SET                               
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
         DROP  RF                                                               
*                                                                               
VRWFFLWN DS    0H                                                               
*                                                                               
*        CHECK FOR COLUMN FILTERS VIA DDVAL                                     
*                                                                               
VRWFLT   DS    0H                                                               
*                                                                               
         GOTO1 =A(CFLTVAL),RR=RELORGEN VALIDATE FILTERS                         
*                                                                               
         OC    CFLTQTIC,CFLTQTIC   ERROR IF NO MASTER ICODE                     
         BZ    VRWCFNVE                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE                      
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
VRWTOT   DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFTOT) TOTAL EXPRESSION                         
         BNE   VRWTOTN                                                          
*                                                                               
         OI    DRTOTAL,X'80'                                                    
*                                                                               
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWTOTN DS     0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFSKP) SKIP FORMAT COMMAND                      
         BNE   VRWSKPN                                                          
*                                                                               
         OI    DRFIRST,X'80'       GENERATE FIRST STATEMENT                     
         OI    DRFOPTS,DRFSKIP     WITH SKIP OPTION                             
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWSKPN DS     0H                                                               
*                                                                               
VRWSPC  DS     0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFSPC)   SPACE OPTION                           
         BNE   VRWSPCN                                                          
*                                                                               
         OI    DRLAST,X'80'        GENERATE LAST STATEMENT                      
         MVI   DRLSPACE,1          WITH AT LEAST ONE SPACE                      
*                                                                               
         CLI   1(R4),0             CHECK SECOND PARAMETER                       
         BE    VRWQUAC                                                          
*                                                                               
         MVC   DRLSPACE,11(R4)     CAPTURE NUMBER OF LINES TO SPACE             
*                                                                               
         CLI   DRLSPACE,0          S/B 1-3 LINES                                
         BE    VRWSPCE                                                          
*                                                                               
         CLI   DRLSPACE,3                                                       
         BH    VRWSPCE                                                          
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWSPCN DS     0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFUSR)   IF USER RECORD                         
         BNE   VRWUSRN                                                          
*                                                                               
         GOTO1 GUSRDRON                                                         
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWUSRN DS     0H                                                               
*                                                                               
VRWNP    DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFNP)     ROW NOT TO PRINT                      
         BNE   VRWNPN                                                           
*                                                                               
         NI    DRFLAGO,X'7F'                                                    
         NI    DRHEAD1,X'7F'                                                    
         NI    DRHEAD2,X'7F'                                                    
         NI    DRHEAD3,X'7F'                                                    
         NI    DRHEAD4,X'7F'                                                    
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWNPN   DS    0H                                                               
*                                                                               
VRWDTL   DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFDTL)   TOTAL DETAIL EXPRESSION                
         BNE   VRWDTLN                                                          
*                                                                               
         OI    DRTOTAL,X'80'                                                    
         MVI   DRTSPACE,1          SPACE AFTER TOTALS                           
         MVC   DRTDET(1),11(R4)    PICK UP NUMBER OF DETAILS                    
*                                                                               
         CLI   DRTDET,0            MUST BE SOMETHING NUMERIC                    
         BE    VRWDTLE                                                          
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWDTLN DS     0H                                                               
*                                                                               
VRWLEN   DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFLEN) IF LENGTH                                
         BNE   VRWLENN                                                          
*                                                                               
         TM    2(R4),X'80'         NUMERIC=OUTPUT WIDTH OVERRIDE                
         BNO   VRWLENE                                                          
*                                                                               
         L     R1,4(R4)            OUTPUT WIDTH OVERRIDE                        
         STC   R1,DRLENO           (NEW OUTPUT LENGTH)                          
*                                                                               
VRWLENX DS     0H                                                               
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWLENN DS     0H                                                               
*                                                                               
VRWFHD   DS    0H                  CHECK FOR HEADING OVERRIDES                  
*                                                                               
         LA    R1,DRHEAD1                                                       
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFH1)                                           
         BE    VRWFHD1                                                          
*                                                                               
         LA    R1,DRHEAD2                                                       
         CLC   VLTICODE,=AL2(RKQCFH2)                                           
         BE    VRWFHD1                                                          
*                                                                               
         LA    R1,DRHEAD3                                                       
         CLC   VLTICODE,=AL2(RKQCFH3)                                           
         BE    VRWFHD1                                                          
*                                                                               
         LA    R1,DRHEAD4                                                       
         CLC   VLTICODE,=AL2(RKQCFH4)                                           
         BNE   VRWFHDN                                                          
*                                                                               
         USING DRHEADD,R1          ESTABLISH HEADING DRONE AREA                 
*                                                                               
VRWFHD1  DS    0H                                                               
*                                                                               
         XC    0(64,R1),0(R1)      TURN OFF ROUTINE & ARGS                      
         MVI   HDGOVRSW,C'Y'       HEADING OVERRIDE INDICATOR                   
*                                                                               
         CLI   1(R4),0                                                          
         BE    VRWQUAC             HN=  CAUSES REMOVAL                          
*                                                                               
         CLI   1(R4),1             HN=X CAUSES REMOVAL                          
         BNE   *+12                                                             
         CLI   22(R4),C'X'                                                      
         BE    VRWQUAC                                                          
*                                                                               
         OI    DRHEAD,X'80'        OTHERWISE TURN IT BACK ON                    
         MVC   DRHLITL,1(R4)       PASS LITERAL LENGTH TO DRONE                 
*                                                                               
         CLC   DRHLITL,DRLENO                                                   
         BH    VRWTLWDE            CHECK LITERAL NOT WIDER THAN COLUMN          
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DRHLITL                                                     
         BZ    *+6                 ZERO LENGTH                                  
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DRHLIT(0),22(R4)    MOVE IN HEADER LITERAL                       
*                                                                               
VRWFHDX  DS    0H                                                               
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
         DROP  R1                                                               
*                                                                               
VRWFHDN  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFRIG) RIGHT JUSTIFY OUTPUT                     
         BNE   VRWFRGTN                                                         
*                                                                               
         OI    DROPTSO,DRALGNRO    TURN ON INDICATOR                            
*                                                                               
         B     VRWQUAC                                                          
*                                                                               
VRWFRGTN DS    0H                                                               
*                                                                               
VRWQUAC  LA    R4,42(R4)                                                        
         AI    FIELDERR,1                                                       
         BCT   R0,VRWQUAL                                                       
*                                                                               
VRWQUAD DS     0H                                                               
*                                                                               
         TM    ROWCOLSW,ROWCOLXQ   IF THERE IS A CONTINUATION                   
         BNO   VALROWXD                                                         
*                                                                               
         L     R2,ALASTCOL         RE-POINT TO SCREEN FIELD                     
*                                                                               
         SR    RF,RF                                                            
         IC    RF,5(R2)            RESTORE LAST FIELD LENGTH                    
         LA    R1,8(RF,R2)                                                      
         MVI   0(R1),C','          REPLACE COMMA                                
         LA    RF,1(RF)                                                         
         STC   RF,5(R2)                                                         
*                                                                               
         OI    ROWCOLSW,ROWCOL2Q   INDICATE ON SECOND FIELD                     
*                                                                               
         SR    R3,R3                                                            
         IC    R3,FLDNMBR                                                       
         BCT   R3,*+8              DECREMENT FIELD COUNTER                      
         B     VRWKYNVE            NO MORE AVAILABLE                            
*                                                                               
         ZIC   RF,0(R2)            GET TO NEXT SCREEN FIELD                     
         AR    R2,RF                                                            
         ST    R2,ALASTCOL         UPDATE CURRENT FIELD POINTER                 
*                                                                               
         B     VALROWXL            PROCESS CONTINUATION                         
*                                                                               
VALROWXD DS    0H                                                               
*                                                                               
*        SAVE FIRST TWO STACK HEADLINES                                         
*                                                                               
         CLC   DRRTNI,=CL8'ISTACK' IF DEALING WITH STACK KEYWORD                
         BNE   VRWSTHX                                                          
         CLI   DRARGSI+1,C'M'      SKIP IF MERGING                              
         BE    VRWSTHX                                                          
*                                                                               
*        SAVE HEADLINES IN WORKAREA FOR LATER                                   
*                                                                               
         LA    R0,2                ONLY INTERESTED IN 1ST TWO HEADLINES         
         LA    R1,STACKH1L         HEAD 1 SAVEAREA                              
         LA    R2,DRHEAD1          POINT TO FIRST HEADLINE                      
*                                                                               
VRWSTHLP DS    0H                                                               
*                                                                               
         USING DRHEADD,R2                                                       
*                                                                               
         TM    DRHEAD,X'80'        IF THERE IS NO HEADING                       
         BO    *+12                                                             
         MVI   0(R1),X'FF'            SET INDICATOR                             
         B     VRWSTHCN                                                         
*                                                                               
         XI    DRHEAD,X'80'        DON'T PRINT HEADLINE                         
*                                                                               
         MVC   0(1,R1),DRHLITL     SAVE LITERAL LENGTH                          
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,0(R1)          GET LENGTH OF HEADING                        
         BZ    *+10                NO LENGTH                                    
         BCTR  RE,0                DECREMENT FOR EXECUTE                        
         EX    RE,*+8              MOVE IN THE HEADER LITERAL                   
         B     *+10                                                             
         MVC   1(0,R1),DRHLIT      SAVE HEADLINE                                
*                                                                               
VRWSTHCN DS    0H                                                               
*                                                                               
         LA    R2,L'DRH1ALL(R2)    POINT TO NEXT HEADLINE                       
         LA    R1,STACKH2L         POINT TO SECOND SAVEAREA                     
         BCT   R0,VRWSTHLP                                                      
*                                                                               
         DROP  R2                                                               
*                                                                               
VRWSTHX  DS    0H                                                               
*                                                                               
         OC    TOTWIDTH,TOTWIDTH   SKIP IF WE AREN'T CHECKING WIDTH             
         BZ    VRWWIDX                                                          
*                                                                               
         CLC   =C'ISTACK',DRRTNI   IF STACK ROW                                 
         BNE   VRWWID1                                                          
         CLI   DRARGSI+1,C'M'      SKIP IF MERGING                              
         BE    VRWWID1                                                          
*                                                                               
         MVC   STACKWID,DRLENO     SAVE WIDTH OF STACK COLUMN                   
*                                                                               
         NI    DRFLAGO,X'FF'-X'80' NO PRINT                                     
         NI    DRHEAD1,X'FF'-X'80'                                              
         NI    DRHEAD2,X'FF'-X'80'                                              
         NI    DRHEAD3,X'FF'-X'80'                                              
         NI    DRHEAD4,X'FF'-X'80'                                              
*                                                                               
         B     VRWWID2             COUNT WIDTH BECAUSE OF TITLE COL             
*                                                                               
VRWWID1  DS    0H                                                               
*                                                                               
         TM    DRFLAGO,X'80'       SKIP IF NOT BEING PRINTED                    
         BZ    VRWWIDX                                                          
*                                                                               
VRWWID2  DS    0H                                                               
*                                                                               
         LH    R1,TOTWIDTH         ADJUST CURRENT WIDTH                         
         ZIC   RF,DRLENO           ENTRY OUTPUT LENGTH                          
         LA    R1,1(RF,R1)         ADD 1 MORE FOR BOX COLUMN                    
         STH   R1,TOTWIDTH                                                      
*                                                                               
         CLC   =C'ISTACK',DRRTNI   IF STACK ROW                                 
         BE    *+8                                                              
         STC   R1,ROWWIDTH            WIDTH IS FOR TITLES COLUMN                
*                                                                               
VRWWIDX  DS   0H                                                                
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF NOT OFF-LINE                         
         JNE   VRWINXX                                                          
*                                                                               
*        BUILD PQINDEX TABLE ENTRY                                              
*                                                                               
         ICM   RF,15,APQINDEX      POINT TO PQ INDEX TABLE                      
         JZ    VRWINXX             SKIP IF NO TABLE AVAILABLE                   
*                                                                               
         USING PQINDEX,RF          ESTABLISH TABLE ENTRY                        
*                                                                               
*        FIND NEXT AVAILABLE ENTRY IN TABLE                                     
*                                                                               
         LA    R0,MAXHEADS+MAXMIDS+MAXROWS+MAXCOLS   MAX ENTRIES                
*                                                                               
         OC    PQKEYWRD,PQKEYWRD   FIND FIRST NULL ENTRY                        
         JZ    *+16                                                             
         LA    RF,PQINDXEQ(RF)     BUMP TO NEXT ENTRY                           
         BRCT  R0,*-14                                                          
         J     VRWINXX             SKIP                                         
*                                                                               
         MVC   PQKEYWRD,BLOCK+12   SAVE KEYWORD                                 
         MVC   PQOUTLEN,DRLENO     SAVE OUTPUT LENGTH                           
         MVC   PQPOSO,MYPOSO       SAVE KEYWORD TYPE                            
*                                                                               
         CLI   PQPOSO,C' '         IF NO POSITION SET                           
         BH    *+8                                                              
         MVI   PQPOSO,C'R'            ASSUME A ROW                              
*                                                                               
         MVC   PQHEAD1,DRH1LIT     SAVE FIRST  COLUMN HEADLINE                  
*                                                                               
         CLI   MYPOSO,C'H'         SINGLE HEADER FOR HEADS AND MIDS             
         JE    VRWINXHX                                                         
         CLI   MYPOSO,C'M'         SINGLE HEADER FOR HEADS AND MIDS             
         JE    VRWINXHX                                                         
*                                                                               
         MVC   PQHEAD2,DRH2LIT     SAVE SECOND COLUMN HEADLINE                  
         MVC   PQHEAD3,DRH3LIT     SAVE THIRD  COLUMN HEADLINE                  
         MVC   PQHEAD4,DRH4LIT     SAVE FOURTH COLUMN HEADLINE                  
*                                                                               
VRWINXHX DS    0H                                                               
*                                                                               
         DROP  RF                                                               
*                                                                               
VRWINXX  DS    0H                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
*              FINAL ADJUSTMENTS                                                
*                                                                               
*        ADD RECORD TYPE TO REDATA LIST                                         
*              CONTAINED IN DRARGSI+0(1)                                        
*                                                                               
         CLI   DRARGSI,X'2F'       IF PAPER WORK RECORD TYPE                    
         BNE   *+8                                                              
         OI    REQFLAGS,REQPWCR       SET TO READ PAPERWORK RECORDS             
*                                                                               
         CLI   DRARGSI,RBCDKTYQ    IF BUY CODE RECORD TYPE                      
         BNE   VRWBCDX                                                          
*                                                                               
         CLI   DRARGSI+1,C'B'      IF BUY CODE                                  
         BNE   *+12                                                             
         OI    REFTYPS3,REFTBCDQ      SET INDICATOR                             
         B     VRWBCDX                                                          
*                                                                               
         CLI   DRARGSI+1,C'1'      IF BUY TYPE 1                                
         BNE   *+12                                                             
         OI    REFTYPS3,REFTBT1Q      SET INDICATOR                             
         B     VRWBCDX                                                          
*                                                                               
         CLI   DRARGSI+1,C'2'      IF BUY TYPE 2                                
         BNE   *+12                                                             
         OI    REFTYPS3,REFTBT2Q      SET INDICATOR                             
         B     VRWBCDX                                                          
*                                                                               
VRWBCDX  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RCOMKTYQ    IF COMMISSION RATE RECORD TYPE               
         BNE   *+8                                                              
         OI    REQTABLE,REQCOMRQ      SET TO READ COMMISSION RATES              
*                                                                               
         CLI   DRARGSI,RADVKTYQ    IF ADVERTISER                                
         BE    *+8                                                              
         CLI   DRARGSI,RAGYKTYQ    OR AGENCY                                    
         BNE   *+12                                                             
         CLI   DRATTRIB,C'C'       AND CODE ONLY NEEDED                         
         BE    VRWLISTX               SKIP ADDING TO LIST                       
*                                                                               
         GOTO1 =A(TBLLST),DMCB,(DRARGSI,0),RR=RELORGEN                          
*                                                                               
*        ADD RECORD TYPE TO REDATA LIST                                         
*              CONTAINED IN DRARGSO+0(1)                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,(DRARGSO,0),RR=RELORGEN                          
*                                                                               
         CLI   DRARGSO,RSTAKTYQ    ADD MARKETS FOR STATION KYW                  
         BE    VRWLISTX                                                         
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RMKTKTYQ',0),RR=RELORGEN                       
*                                                                               
VRWLISTX DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RCTGKTYQ    IF CTG KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSO,RCTGKTYQ    IF CTG KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSI,RPTPKTYQ    IF CTG KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSO,RPTPKTYQ    IF CTG KEYWORD                               
         BNE   *+8                                                              
         OI    REPRCNTL,REPRCSRQ      SET TO FILL PRD TABLE                     
*                                                                               
         CLI   DRARGSI,RADVKTYQ    IF ADV KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSO,RADVKTYQ    IF ADV KEYWORD                               
         BNE   VRWADVN                                                          
*                                                                               
         CLI   DRATTRIB,C'S'       AND SORTING ON KEYWORD                       
         BNE   *+8                                                              
         OI    READCNTL,READCSRQ      SET TO FILL ADV TABLE                     
*                                                                               
VRWADVN  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RTERKTYQ    IF TERRITORY KEYWORD                         
         BE    *+8                                                              
         CLI   DRARGSO,RTERKTYQ    IF TERRITORY KEYWORD                         
         BNE   VRWTERN                                                          
*                                                                               
         OI    REFTYPS2,REFTRTYQ      INDICATE TERR CODE NEEDED                 
         OI    REAGCNTL,REAGCSRQ      SET TO FILL AGY TABLE                     
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RAGYKTYQ',0),RR=RELORGEN                       
*                                  ADD AGENCY TO TABLES                         
VRWTERN  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RPRDKTYQ    IF PRD KEYWORD                               
         BNE   VRWPRDN                                                          
         CLI   DRATTRIB,C'S'       AND SORTING ON KEYWORD                       
         BNE   *+8                                                              
         OI    REPRCNTL,REPRCSRQ      SET TO FILL PRD TABLE                     
*                                                                               
VRWPRDN  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RAG2KTYQ    IF AGY 2 KEYWORD                             
         BNE   VRWAGYN                                                          
*                                                                               
         CLI   DRATTRIB,C'S'       AND SORTING ON KEYWORD                       
         BNE   *+8                                                              
         OI    REAGCNTL,REAGCSRQ      SET TO FILL AGY TABLE                     
*                                                                               
VRWAGYN  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RREPKTYQ    IF REP KEYWORD                               
         BNE   *+8                                                              
         OI    REKYWTYP,REKYREPQ      SET INDICATOR                             
*                                                                               
VRWGENR  CLI   OFFLINE,C'Y'        NOW GENERATE ELEMENTS                        
         BNE   VALROWX                                                          
*                                                                               
         MVC   DRPOSO,MYPOSO                                                    
*                                                                               
         TM    DRTOTAL,X'80'       WAS TOTAL REQUESTED?                         
         BNO   VRWADJ2                                                          
*                                                                               
         CLI   DRRTNO,X'41'        IF OUT ROUTINE SPECIFIED                     
         BL    VRWADJ2                                                          
*                                                                               
         MVC   DRTRTN,DRRTNO       USE THIS FOR TOTAL AS WELL                   
         MVC   DRTARGS,DRARGSO     AND PASS THROUGH THE ARGUMENTS               
         MVI   DRTNARGS,16                                                      
         MVI   DRTLITLN,0                                                       
*                                                                               
VRWADJ2  GOTO1 GROWDRON             GENERATE DRIVER CODE                        
*                                                                               
         B     VALROWX                                                          
*                                                                               
VALROWX  DS    0H                                                               
*                                                                               
         SR    R3,R3                                                            
         IC    R3,FLDNMBR          RESTORE FIELD NUMBER                         
         L     R2,ALASTCOL         RESTORE CURRENT FIELD POINTER                
*                                                                               
         NI    ROWCOLSW,X'FF'-ROWCOL2Q   TURN OFF INDICATOR                     
*                                                                               
         USING FLDHDRD,R2          ESTABLISH SCREEN HEADER                      
*                                                                               
         OI    FLDIIND,FINPVAL     INDICATE FIELD IS VALID                      
*                                                                               
         CR    RB,RB               EQUAL CC                                     
         XIT1  REGS=(R2,R3)                                                     
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
***********************************************************************         
*                                                                     *         
*        VALROW ERROR MESSAGES                                        *         
*                                                                     *         
***********************************************************************         
         EJECT                                                                  
VRWSEPER DS    0H                  KEYWORD CAN'T BE A FILTER                    
         LHI   RF,RWESEPER                                                      
         STCM  RF,3,RERROR                                                      
         J     VRWERR                                                           
*                                                                               
VRWKYNVE MVI   ERROR,RWEKYNVE      KEYWORD NOT VALID                            
         J     VRWERR                                                           
*                                                                               
VRWCFNVE MVI   ERROR,RWECFNVE      INVALID FILTER/FORMAT EXPRESSION             
         J     VRWERR                                                           
*                                                                               
VRWDTLE  MVI   ERROR,RWEDTLE       NUMBER OF DETAIL LEVELS MUST BE NUMB         
         J     VRWERR                                                           
*                                                                               
VRWRRG1E MVC   RERROR,=AL2(RWERRG04) MORE THAN 3 DATATYPES REQUESTED            
         J     VRWERR                                                           
*                                                                               
VRWFVALE MVI   ERROR,RWEFVALE      INVALID VALUE FOR KEYWORD                    
         J     VRWERR                                                           
*                                                                               
VRWLENE  MVI   ERROR,RWELENE       WIDTH OVERRIDE MUST BE NUMERIC               
         J     VRWERR                                                           
*                                                                               
VRWRNKE  MVI   ERROR,RWERNKE       RANK KEYWORD MUST BE SECOND LAST ROW         
         J     VRWERR                                                           
*                                                                               
VRWRNK2E MVI   ERROR,RWERNKE       RANK KEYWORD MUST BE SECOND LAST ROW         
         J     VRWERR                                                           
*                                                                               
VRWSPCE  MVI   ERROR,RWESPCE       SPACING LIMITED TO 1 TO 3 LINES              
         J     VRWERR                                                           
*                                                                               
VRWCMPE  MVI   ERROR,RWECMPE       INVALID COMPUTE EXPRESSION                   
         J     VRWERR                                                           
*                                                                               
VRWSTK2E MVI   ERROR,RWESTK2E      STACK KEYWORD REQUIRES COLUMN RANGE          
         J     VRWERR                                                           
*                                                                               
VRWFLW1E DS    0H                  PERIOD RANGE MUST BE NUMERIC                 
         MVI   ERROR,RWEFLW1E      SET ERROR CODE                               
         J     VRWERR                                                           
*                                                                               
VRW1STE DS     0H                  NON-NUMERIC FLOWCHARTING MUST BE             
         MVI   ERROR,RWE1STCL         FIRST COLUMN                              
         J     VRWERR                                                           
*                                                                               
VRWTLWDE DS    0H                  COLUMN TITLE WIDER THAN COLUMN               
         MVI   ERROR,RWETLWDE      SET ERROR CODE                               
         J     VRWERR                                                           
*                                                                               
VRWMISSE DS    0H                  COLUMN TITLE WIDER THAN COLUMN               
         MVI   ERROR,RWETLWDE      SET ERROR CODE                               
         J     VRWERR                                                           
*                                                                               
VRWTXMSE DS    0H                  TEXT INPUT MISSING                           
         MVI   ERROR,RWETXTMS      SET ERROR CODE                               
         J     VRWERR                                                           
*                                                                               
VRWTXLNE DS    0H                  TEXT INPUT TOO LONG                          
         MVI   ERROR,RWETXTLN      SET ERROR CODE                               
         J     VRWERR                                                           
*                                                                               
VRWERR   DS    0H                                                               
         ST    R4,DMCB+8           SAVE ERROR POINTER                           
         GOTO1 CURSERR                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VALCOL'                   
***********************************************************************         
*                                                                     *         
*              VALIDATE COLUMNS                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VALCOL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         MVI   COLRANK,0           INIT COLUMN RANK INDICATOR                   
         MVI   FIELDERR,1          INIT FIELD COUNTER                           
         MVI   MYPOSO+1,1          PRINT IN NEXT COLUMN                         
*                                                                               
         STC   R0,FLDNMBR          SAVE FIELD NUMBER                            
*                                                                               
         LR    R4,R0               SAVE FIELD NUMBER                            
         LA    R0,DRLENIN          CLEAR DRONEBLOCK AREA                        
         LA    R1,DRINFEND-DRLENIN                                              
         LR    RE,R0                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
         LR    R0,R4               RESTORE FIELD NUMBER                         
*                                                                               
         XC    DRATTRIB,DRATTRIB   INIT ATTRIBUTE AREA                          
*                                                                               
         CLI   5(R2),0             SKIP IF FIELD WAS NOT ENTERED                
         BE    VALCOLX                                                          
*                                                                               
         MVC   CLASTLBL,MYLABEL    UPDATE LAST ENTERED COLUMN                   
*                                                                               
         XC    BLOCK(240),BLOCK                                                 
         XC    BLOCK+240(240),BLOCK+240                                         
         LA    R4,BLOCK+42         START OF SCANNER OUTPUT                      
*                                  FIRST POISTION RESERVED FOR                  
*                                  COMPUTE KEYWORD, IF NEEDED                   
*                                                                               
*        FOLLOWING LOOP NEEDED IN CASE KEYOWRD IS                               
*        CARRIED OVER INTO NEXT FIELD                                           
*                                                                               
VALCOLXL DS    0H                                                               
*                                                                               
         STC   R0,FLDNMBR          SAVE FIELD NUMBER                            
         ST    R2,ALASTCOL         SAVE COLUMN POINTER                          
         MVI   FIELDERR,1          INIT FIELD IN ERROR COUNTER                  
*                                                                               
         NI    ROWCOLSW,X'FF'-ROWCOLXQ INIT CONTINUED FIELD INDICATOR           
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,5(R2)          FIELD LENGTH                                 
         LA    RE,7(RF,R2)         LAST BYTE OF INPUT                           
*                                                                               
         CLI   0(RE),C','          IF FIELD ENDS IN COMMA                       
         BNE   VALCOLX1                                                         
*                                                                               
         OI    ROWCOLSW,ROWCOLXQ      FIELD CONTINUED IN NEXT FIELD             
         MVI   0(RE),C' '             ELIMINATE COMMA                           
         BCTR  RF,0                   LENGTH DECREMENTED FOR SCANNER            
         STC   RF,5(R2)                                                         
*                                                                               
VALCOLX1 DS    0H                                                               
*                                                                               
         GOTO1 SCANNER,DMCB,(20,(R2)),(134,(R4)),0                              
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,4(R1)          NUMBER OF ENTRY ITEMS                        
         BZ    VCLNOTVE            MUST HAVE A COLUMN                           
*                                                                               
         TM    ROWCOLSW,ROWCOL2Q   SKIP IF DOING CONTINUATION FIELD             
         BO    VCLKYWX                                                          
*                                                                               
*        HANDLE FIRST ENTRY THAT SPECIFIES THE KEYWORD                          
*                                                                               
         CLI   12(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   13(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   12(R4),C'+'         IF HELP REQUESTED                            
         BNE   VCLHLPX                                                          
*                                                                               
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVI   HCBFTYP-HELPCB(RF),C'C'   HARD CODE VALUE FOR COLUMNS            
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMKYW),(R2),HELPCBLK SHOW HELP MENU         
*                                     FOR COLUMN KEYWORDS                       
*                                                                               
*        NEVER RETURNS HERE                                                     
*                                                                               
VCLHLPX DS     0H                                                               
*                                                                               
         CLI   0(R4),0             MAKE SURE WE HAVE A KEYWORD                  
         BE    VCLNOTVE                                                         
*                                                                               
*        CHECK FOR '<' & '>' AS SEPARATORS                                      
*                                                                               
         GOTO1 =A(SEPSCAN),RR=RELORGEN CHECK FOR < AND >                        
*                                                                               
         BNE   VCLNOTVE            ERROR FOUND                                  
*                                                                               
*        VALIDATE KEYWORD AGAINST FILTERS                                       
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQWRKYW)),                 X        
               (0(R4),12(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   VCLCMP              ERROR FOUND - GO TRY COMPUTE                 
*                                                                               
         DROP  R1                                                               
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         CLI   SCANSEP,0           IF THERE IS A DATA SEPARATER                 
         BE    VCLVAL05                                                         
*                                     MAKE SURE IT IS ALLOWED                   
         SR    RF,RF                                                            
         ICM   RF,1,VLTLFULL       GET KYWD NAME LENGTH                         
         BZ    VCLVAL05            SHOULDN'T HAPPEN                             
*                                                                               
         LA    R1,VLTFULL-1(RF)    POINT TO LAST BYTE                           
*                                                                               
         CLI   0(R1),C'='          CHECK IF THIS IS A FILTER KYWD               
         BE    VCLVAL05               YES                                       
         BCTR  R1,0                                                             
         BCT   RF,*-10                RESET LENGTH                              
*                                                                               
         J     VCLSEPER            NO FILTERING ALLOWED FOR KYWD                
*                                                                               
VCLVAL05 DS    0H                                                               
*                                                                               
         CLC   VLTMINO,0(R4)       SKIP IF INPUT AS LONG AS OUTPUT              
         BNH   VCLVAL10                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,VLTMINO        GET MINIMUM OUTPUT LENGTH                    
         BZ    VCLVAL10            NONE FOUND                                   
*                                                                               
         MVC   12(10,R4),SPACES    INIT SCANNED AREA                            
         STC   RF,0(R4)            RESET SCANNED LENGTH                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   12(0,R4),VLTFULL    RESET TO FULL VALUE                          
*                                                                               
         LA    R1,12(RF,R4)        POINT TO LAST BYTE                           
*                                                                               
         CLI   0(R1),C'='          IF IT IS '=', ELIMINATE IT                   
         BNE   *+12                                                             
         MVI   0(R1),C' '                                                       
         STC   RF,0(R4)               RESET LENGTH                              
*                                                                               
VCLVAL10 DS    0H                                                               
*                                                                               
         DROP  R5                                                               
*                                                                               
*        VALIDATE KEYWORD VIA DDDRONE                                           
*                                                                               
         GOTO1 VCOLDRON            VALIDATE COLUMN ENTRY                        
*                                                                               
         CLI   DRERROR,0           INVALID KEYWORD ENTRY                        
         BNE   VCLCMP              MAY NOT BE AN ERROR-MAY BE A COMPUTE         
*                                                                               
         CLI   DRARGSI,X'0A'       NEW RECORD ID FOR AGY KYWDS                  
         BNE   *+8                                                              
         MVI   DRARGSI,X'1A'                                                    
*                                                                               
         CLI   DRARGSO,X'0A'       NEW RECORD ID FOR AGY KYWDS                  
         BNE   *+8                                                              
         MVI   DRARGSO,X'1A'                                                    
*                                                                               
         MVC   DRARGSI+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         MVI   DRNARGSI,16         ALWAYS USE ALL ARGUMENTS                     
*                                                                               
         MVC   DRARGSO+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         MVI   DRNARGSO,16         ALWAYS USE ALL ARGUMENTS                     
*                                                                               
*        CHECK IF KEYWORD BEING FILTERED ON VALUE                               
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
         CLC   VLTICODE,=AL2(RKQTEXT) IF TEXT FIELD                             
         BNE   VCLTEXTN                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R4)          GET TEXT LENGTH                              
         BZ    VCLTXMSE            MUST HAVE ENTRY                              
*                                                                               
         CHI   RF,L'DRLITI         TEXT MUST NOT BE TOO LONG                    
         BH    VCLTXLNE                                                         
*                                                                               
         STC   RF,DRLITLNI         SAVE TEXT LENGTH                             
         STC   RF,DRLENI           SET INPUT  WIDTH                             
         STC   RF,DRLENO           SET OUTPUT WIDTH                             
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DRLITI(0),22(R4)    SAVE ENTERED TEXT                            
*                                                                               
         B     VCLFLTX                                                          
*                                                                               
VCLTEXTN DS    0H                                                               
*                                                                               
         GOTO1 =A(FLTRVAL),RR=RELORGEN                                          
         BNE   VCLFVLE             INVALID FILTER                               
*                                                                               
VCLFLTX  DS    0H                                                               
*                                                                               
         B     VCLKYWX             KEYWORD IS VALID                             
*                                                                               
*        VALIDATE AS A COMPUTE STATEMENT                                        
*                                                                               
VCLCMP   DS    0H                  MAY BE A COMPUTE EXPRESSION                  
*                                                                               
         XC    BLOCK(42),BLOCK                                                  
         MVI   BLOCK,7                                                          
         MVC   BLOCK+12(30),SPACES                                              
         MVC   BLOCK+12(7),=C'COMPUTE'                                          
*                                                                               
         LA    R4,BLOCK                                                         
         GOTO1 VCOLDRON            VALIDATE THE 'COMPUTE' COLUMN                
*                                  JUST SETS UP A DRONE BLOCK ENTRY             
*                                                                               
         CLI   DRERROR,0                                                        
         BNE   VCLNOTVE                                                         
*                                                                               
         LA    R4,BLOCK+42                                                      
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP VALIDATING IF OFF-LINE                  
         BE    VCLCMP1                                                          
*                                                                               
         GOTO1 VCMPDRON            VALIDATE A COMPUTE EXPRESSION                
*                                                                               
         CLI   DRERROR,0                                                        
         BNE   VCLCMPE                                                          
*                                                                               
VCLCMP1  DS    0H                                                               
*                                                                               
         GOTO1 =A(COMPEDIT),RR=RELORGEN AUTO EDIT FOR COMPUTES                  
*                                                                               
         CLI   DRDECO,X'FF'        ERROR CHECK                                  
         BE    VCLCMP2E                                                         
*                                                                               
         CHI   R0,1                DONE IF NO FILTERS                           
         BE    VCLFLTRX                                                         
*                                                                               
         B     VCLKYWX                                                          
*                                                                               
*****                                                                           
*****    LA    R4,42(R4)                                                        
*****    AI    FIELDERR,1                                                       
*****    BCT   R0,*+8                                                           
*****    B     VCLFLTRX            NO OTHER FILTERS                             
*                                                                               
VCLKYWX  DS    0H                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
*              CHECK FOR SUBSIDIARY COLUMN EXPRESSIONS                          
*                                                                               
         CLI   REQPZERO,C'Y'          IF WE ARE TO PRINT ZEROS                  
         BNE   *+12                                                             
         OI    DROPTSO,DRZEROO           SET DRIVER INDICATOR                   
******   NI    DROPTSO,X'FF'-DRCOMMAO    KILL COMMAS IN OUTPUT                  
         B     *+8                                                              
*                                                                               
         NI    DROPTSO,X'FF'-DRZEROO  ELSE TURN OFF INDICATOR                   
*                                                                               
VCLFLTR  DS    0H                                                               
*                                                                               
         GOTO1 =A(VCLFLTS),RR=RELORGEN  VALIDATE COLUMN FILTERS                 
*                                                                               
VCLFLTRX DS    0H                                                               
*                                                                               
         TM    ROWCOLSW,ROWCOLXQ   IF THERE IS A CONTINUATION                   
         BNO   VALCOLXD                                                         
*                                                                               
         L     R2,ALASTCOL         RE-POINT TO SCREEN FIELD                     
*                                                                               
         SR    RF,RF                                                            
         IC    RF,5(R2)            RESTORE LAST FIELD LENGTH                    
         LA    R1,8(RF,R2)         POINT TO END OF FIELD                        
         MVI   0(R1),C','          REPLACE COMMA                                
         LA    RF,1(RF)                                                         
         STC   RF,5(R2)                                                         
*                                                                               
         OI    ROWCOLSW,ROWCOL2Q   INDICATE ON SECOND FIELD                     
*                                                                               
         ZIC   RF,0(R2)            GET TO NEXT LABEL  FIELD                     
         AR    R2,RF                                                            
*                                                                               
         ZIC   RF,0(R2)            GET TO NEXT SCREEN FIELD                     
         AR    R2,RF                                                            
*                                                                               
         SR    R0,R0                                                            
         IC    R0,FLDNMBR                                                       
*                                                                               
         BCT   R0,VALCOLXL         DECREMENT FIELD COUNTER                      
*                                                                               
         B     VCLNOTVE            NO MORE AVAILABLE                            
*                                                                               
VALCOLXD DS    0H                                                               
*                                                                               
*        ADD RECORD TYPE TO REDATA LIST                                         
*              CONTAINED IN DRARGSI+0(1)                                        
*                                                                               
         CLI   DRARGSI,X'2F'       IF PAPER WORK RECORD TYPE                    
         BNE   *+8                                                              
         OI    REQFLAGS,REQPWCR       SET TO READ PAPERWORK RECORDS             
*                                                                               
         CLI   DRARGSI,RBCDKTYQ    IF BUY CODE RECORD TYPE                      
         BNE   VCLBCDX                                                          
*                                                                               
         CLI   DRARGSI+1,C'B'      IF BUY CODE                                  
         BNE   *+12                                                             
         OI    REFTYPS3,REFTBCDQ      SET INDICATOR                             
         B     VCLBCDX                                                          
*                                                                               
         CLI   DRARGSI+1,C'1'      IF BUY TYPE 1                                
         BNE   *+12                                                             
         OI    REFTYPS3,REFTBT1Q      SET INDICATOR                             
         B     VCLBCDX                                                          
*                                                                               
         CLI   DRARGSI+1,C'2'      IF BUY TYPE 2                                
         BNE   *+12                                                             
         OI    REFTYPS3,REFTBT2Q      SET INDICATOR                             
         B     VCLBCDX                                                          
*                                                                               
VCLBCDX  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RCOMKTYQ    IF COMMISSION RATE RECORD TYPE               
         BNE   *+8                                                              
         OI    REQTABLE,REQCOMRQ      SET TO READ COMMISSION RATES              
*                                                                               
         CLI   DRARGSI,RADVKTYQ    IF ADVERTISER                                
         BE    *+8                                                              
         CLI   DRARGSI,RAGYKTYQ    OR AGENCY                                    
         BNE   *+12                                                             
         CLI   DRATTRIB,C'C'       AND CODE ONLY NEEDED                         
         BE    VCLLISTX               SKIP ADDING TO LIST                       
*                                                                               
         GOTO1 =A(TBLLST),DMCB,(DRARGSI,0),RR=RELORGEN                          
*                                                                               
*                                                                               
*        ADD RECORD TYPE TO REDATA LIST                                         
*              CONTAINED IN DRARGSO+0(1)                                        
*                                                                               
         GOTO1 =A(TBLLST),DMCB,(DRARGSO,0),RR=RELORGEN                          
*                                                                               
         CLI   DRARGSO,RSTAKTYQ    ADD MARKETS FOR STATION KYW                  
         BE    VCLLISTX                                                         
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RMKTKTYQ',0),RR=RELORGEN                       
*                                                                               
VCLLISTX DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RTERKTYQ    IF TERRITORY KEYWORD                         
         BE    *+8                                                              
         CLI   DRARGSO,RTERKTYQ    IF TERRITORY KEYWORD                         
         BNE   VCLLTERX                                                         
*                                                                               
         OI    REFTYPS2,REFTRTYQ      INDICATE TERR CODE NEEDED                 
         OI    REAGCNTL,REAGCSRQ      SET TO FILL AGY TABLE                     
*                                                                               
         GOTO1 =A(TBLLST),DMCB,('RAGYKTYQ',0),RR=RELORGEN                       
*                                  ADD AGENCY TO TABLES                         
VCLLTERX DS    0H                                                               
*                                                                               
         TM    REQCFOPT,REQCFYTQ   IF YTD OPTION IN PLAY                        
         BNO   VCLYTOPX                                                         
*                                                                               
         OC    DRARGSI+9(2),DRARGSI+9 IF NO DATE RANGE YET                      
         BNZ   *+16                                                             
         MVC   DRARGSI+9(2),REYMSTRP    DEFAULT TO REQUEST PERIOD               
         MVC   DRARGSI+12(2),REYMENDP   DEFAULT TO REQUEST PERIOD               
*                                                                               
VCLYTOPX DS    0H                                                               
*                                                                               
         TM    DRARGSI+8,X'80'     IF YTD COLUMN,                               
         BNO   VCLYTDX                                                          
*                                                                               
         MVC   DRARGSI+9(2),REQYTDSB      SET PERIOD START DATE                 
*                                                                               
         OC    DRARGSI+12(3),DRARGSI+12   IF NO PERIOD END                      
         BNZ   *+10                                                             
         MVC   DRARGSI+12(2),REYMENDP        USE REQUEST END                    
*                                                                               
VCLYTDX  DS    0H                                                               
*                                                                               
         GOTO1 =A(PERPOP),RR=RELORGEN MAY POP IN A PERIOD HEADING               
*                                                                               
         CLI   DRATTRIB,C'$'       IF DOLLARS KEYWORD                           
         BNE   *+10                                                             
         OC    REFDTTYP,DRATTRIB+1    SAVE TYPE OF DATES INDICATOR              
*                                                                               
         TM    STACKSW,STACKYQ+STCKMRGQ    IF STACKING OR MERGING               
         BZ    VCLSTCX                                                          
*                                                                               
         MVC   DRLABELI,MYLABEL                                                 
*                                                                               
         CLC   DRLABELI,STACK1ST   AND THIS IS A STACKED COLUMN                 
         BL    VCLSTCX                                                          
         CLC   DRLABELI,STACKLST                                                
         BH    VCLSTCX                                                          
*                                                                               
         CLI   DRTYPEO,C'N'        IF NOT NUMERIC                               
         BE    *+8                                                              
         OI    DROPTSO+1,DRNOTOT      DON'T TOTAL FIELD                         
*                                                                               
         TM    STACKSW,STACKYQ     CONTINUE IF STACKING                         
         BNO   VCLSTCX                                                          
*                                                                               
         L     R3,ASTACKBF         POINT TO STACK BUFFER                        
         USING STACKBFD,R3         ESTABLISH BUFFER                             
*                                                                               
*        SAVE DRONEBLOCK IN BUFFER                                              
*                                                                               
         L     RE,STBFENA          NEXT ENTRY IN BUFFER                         
         LA    RE,1(RE)            NEXT AVAILABLE SLOT                          
         LA    RF,DRINFEND-DRLENIN DRONE BLOCK LENGTH                           
         LR    R1,RF               COPY LENGTH                                  
         LA    R0,DRLENIN          SAVE DRONEBLOCK FROM HERE                    
*                                                                               
         MVCL  RE,R0                                                            
*                                                                               
         L     RE,STBFENA          CURRENT END OF BUFFER                        
         LA    RE,1(RE)            A(ENTRY USED IN BUFFER)                      
         USING STBFENTD,RE         ESTABLISH BUFFER ENTRY                       
*                                                                               
         MVC   STBFSBLK,BLOCK+42   SAVE SCANNER BLOCK                           
*                                                                               
         DROP  RE                                                               
*                                                                               
         A     RE,STBFLEN          BUFFER ENTRY LENGTH                          
         BCTR  RE,0                                                             
         ST    RE,STBFENA          NEW END OF BUFFER                            
*                                                                               
         CLC   STACKLNO,DRLENO     UPDATE COLUMN WIDTH                          
         BNL   *+10                                                             
         MVC   STACKLNO,DRLENO     USE LARGEST IN STACK                         
*                                                                               
         LA    RE,0                CLEAR DRONEBLOCK                             
         SR    RF,RF                                                            
         LA    R1,DRINFEND-DRLENIN DRONE BLOCK LENGTH                           
         LA    R0,DRLENIN                                                       
*                                                                               
         MVCL  R0,RE                                                            
*                                                                               
         DROP  R3                                                               
*                                                                               
         CLC   MYLABEL,STACKLST    DONE IF NOT LAST COLUMN                      
         BNE   VALCOLX                                                          
*                                                                               
         OI    DRFLAGO,X'80'       INDICATE WE ARE PRINTING THIS FIELD          
         MVC   DRLENO,STACKLNO     RESET OUTPUT LENGTH                          
*                                                                               
VCLSTCX DS     0H                                                               
*                                                                               
         MVI   HDGOVRSW,0          CLEAR                                        
*                                                                               
         CLI   DRATTRIB,C'$'       IF DOLLARS KEYWORD                           
         BNE   *+10                                                             
         OC    REFDTTYP,DRATTRIB+1    SAVE TYPE OF DATES INDICATOR              
*                                                                               
         TM    DRFLAGO,X'80'       IF THERE IS ANY PRINTING                     
         BZ    VCLGEN                                                           
*                                                                               
         CLI   DRPOSO,C'N'                                                      
         BE    VCLGEN                                                           
*                                                                               
         ZIC   RE,FCHRTITR         ANY FLOWCHARTING                             
         LA    RE,1(RE)            ENSURE AT LEAST ONE                          
         MVI   FCHRTITR,0            INITIALIZE                                 
*                                                                               
VCLMULT LH     R1,TOTWIDTH         ADJUST CURRENT WIDTH                         
*                                                                               
         ZIC   RF,DRLENO                                                        
         AR    R1,RF                                                            
         LA    R1,1(R1)                                                         
         STH   R1,TOTWIDTH                                                      
*                                                                               
         CLI   OFFLINE,C'Y'           OFF LINE                                  
         BE    VCLGEN                                                           
*                                                                               
         CLI   STFLWSTR,0             ANY COMPETETIVE STATIONS FLOW             
         BNE   *+8                                                              
         CLI   FLOWDTYP,0             ANY FLOWCHARTING                          
         BE    VCLGEN                                                           
*                                                                               
         BCT   RE,VCLMULT                                                       
*                                                                               
VCLGEN   CLI   OFFLINE,C'Y'        NOW GENERATE ELEMENTS                        
         BNE   VALCOLX                                                          
*                                                                               
         ICM   RF,15,APQINDEX      POINT TO PQ INDEX TABLE                      
         JZ    VCLINXX             SKIP IF NO TABLE AVAILABLE                   
*                                                                               
         USING PQINDEX,RF          ESTABLISH TABLE ENTRY                        
*                                                                               
*        FIND NEXT AVAILABLE ENTRY IN TABLE                                     
*                                                                               
         LA    R0,MAXHEADS+MAXMIDS+MAXROWS+MAXCOLS   MAX ENTRIES                
*                                                                               
         OC    PQKEYWRD,PQKEYWRD   FIND FIRST NULL ENTRY                        
         JZ    *+16                                                             
         LA    RF,PQINDXEQ(RF)     BUMP TO NEXT ENTRY                           
         BRCT  R0,*-14                                                          
         J     VCLINXX             SKIP                                         
*                                                                               
         MVC   PQKEYWRD,BLOCK+54   SAVE KEYWORD                                 
         MVC   PQOUTLEN,DRLENO     SAVE OUTPUT LENGTH                           
         MVI   PQPOSO,C'C'         SAVE KEYWORD TYPE                            
         MVC   PQHEAD1,DRH1LIT     SAVE FIRST  COLUMN HEADLINE                  
         MVC   PQHEAD2,DRH2LIT     SAVE SECOND COLUMN HEADLINE                  
         MVC   PQHEAD3,DRH3LIT     SAVE THIRD  COLUMN HEADLINE                  
         MVC   PQHEAD4,DRH4LIT     SAVE FOURTH COLUMN HEADLINE                  
*                                                                               
         DROP  RF                                                               
*                                                                               
VCLINXX  DS    0H                                                               
*                                                                               
         CLI   DRARGSI,RCTGKTYQ    IF CTG KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSO,RCTGKTYQ    IF CTG KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSI,RPTPKTYQ    IF PTP KEYWORD                               
         BE    *+8                                                              
         CLI   DRARGSO,RPTPKTYQ    IF PTP KEYWORD                               
         BNE   *+8                                                              
         OI    REPRCNTL,REPRCSRQ      SET TO FILL PRD TABLE                     
*                                                                               
         TM    STACKSW,STACKYQ     IF STACKING                                  
         BO    *+20                                                             
         CLI   FLOWDTYP,0          OR FLOWCHARTING                              
         BNE   *+8                                                              
         CLI   STFLWSTR,0          OR FLOWCHARTING STATIONS                     
         BE    VCLFLWX                                                          
*                                                                               
         GOTO1 DOFLOW              DOFLOW ROUTINE                               
*                                                                               
         MVI   FLOWDTYP,0          TURN OFF FLOWCHARTING                        
         MVI   STFLWSTR,0          TURN OFF FLOWCHARTING                        
         MVI   STFLWEND,0          TURN OFF FLOWCHARTING                        
         MVC   DRLABELI,MYLABEL                                                 
*                                                                               
         TM    STACKSW,STACKYQ     IF STACKING                                  
         BNO   *+12                                                             
         NI    STACKSW,X'FF'-STACKYQ  TURN OFF STACKING                         
         OI    STACKSW,STACKP1        NEXT COLUMN USES P1 FOR POSITION          
*                                                                               
         B      VCLFLWY                                                         
*                                                                               
VCLFLWX DS     0H                                                               
*                                                                               
         MVC   DRLABELI,MYLABEL                                                 
*                                                                               
         TM    STACKSW,STACKP1     IF WE HAVE JUST COMPLETED STACKING           
         BNO   *+16                                                             
         MVI   DRPOSO,C'P'            WE MUST RESET PRINTING TO P1              
         MVI   DRPOSO+1,1             TO GET COL HORIZ ALIGNED                  
         XI    STACKSW,STACKP1        TURN OFF SWITCH                           
*                                                                               
         TM    STACKSW,STCKMRGQ    IF MERGING                                   
         BNO   *+16                                                             
         CLI   DRTYPEI+1,C' '         IF THIS INFO NOT SPECIFIED                
         BH    *+8                                                              
         MVI   DRTYPEI+1,C'+'            FORCE ADDITIVE NATURE                  
*                                                                               
*                                                                               
         CLI   OFFLINE,C'Y'           OFF LINE                                  
         BNE   VCLFLWY                                                          
*                                                                               
*        SAVE DECIMALS ETC IN EDIT LIST FOR COMPUTE                             
*                                                                               
         LA    R1,EDITLIST         FIND CURRENT ENTRY IN LIST                   
         LA    R0,L'EDITLIST/4     NUMBER OF ENTRIES IN LIST                    
*                                                                               
         CLC   MYLABEL,0(R1)       FIND ENTRY IN TABLE                          
         BE    *+16                                                             
         LA    R1,4(R1)            BUMP TABLE POINTER                           
         BCT   R0,*-14                                                          
         B     *+16                                                             
*                                                                               
         MVC   1(1,R1),DRDECO      SAVE NUMBER OF DECIMALS                      
         MVC   2(1,R1),DRDIVO      SAVE SCALING FACTOR                          
*                                                                               
         GOTO1 GCOLDRON                                                         
*                                                                               
VCLFLWY DS     0H                                                               
*                                                                               
         CLC   BLOCK+12(7),=C'COMPUTE'                                          
         BNE   VCLCMPX                                                          
*                                                                               
         LA    R4,BLOCK+42                                                      
*                                                                               
         GOTO1 GCMPDRON                                                         
*                                                                               
         CLI   DRERROR,0                                                        
         BNE   VCLNOTVE                                                         
*                                                                               
VCLCMPX  DS    0H                                                               
*                                                                               
*        ADD RANKING COLUMN IF NEEDED                                           
*                                                                               
         CLI   COLRANK,0           TEST COLUMN RANKING                          
         BE    VCLRNKX                                                          
*                                                                               
         XC    BLOCK(12),BLOCK     YES-GENERATE ADDITIONAL RANK COL             
         MVI   BLOCK,7                                                          
         MVC   BLOCK+12(30),SPACES                                              
         MVC   BLOCK+12(7),=C'COLRANK'                                          
         LA    R4,BLOCK                                                         
*                                                                               
         GOTO1 VCOLDRON                                                         
*                                                                               
         MVC   DRARGSI(1),COLRANK                                               
         MVI   DRNARGSI,16                                                      
         MVI   COLRANK,0                                                        
*                                                                               
         GOTO1 GCOLDRON                                                         
*                                                                               
VCLRNKX  DS    0H                                                               
*                                                                               
VALCOLX  DS    0H                                                               
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,FLDNMBR          RESTORE FIELD NUMBER                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         NI    ROWCOLSW,X'FF'-ROWCOL2Q   TURN OFF INDICATOR                     
*                                                                               
         XIT1  REGS=(R0,R2)                                                     
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
VCLNOTVE DS    0H                  INVALID COLUMN ENTRY                         
         MVI   ERROR,RWECOLNV                                                   
         J     VCLERR                                                           
*                                                                               
VCLCMPE  DS    0H                  INVALID COMPUTE EXPRESSION                   
         MVI   ERROR,RWECMPNV                                                   
         J     VCLERR                                                           
*                                                                               
VCLCMP2E DS    0H                  INVALID COMPUTE EXPRESSION                   
         MVI   ERROR,RWECMPNV                                                   
         J     VCLERR                                                           
*                                                                               
VCLERR   DS    0H                                                               
*                                                                               
         GOTO1 CURSERR                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - VCLFLTS'                  
***********************************************************************         
*                                                                     *         
*        VALIDATE COLUMN FILTERS AND FORMATS                          *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*        R2==> FIELD ON SCREEN                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
VCLFLTS  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         TM    ROWCOLSW,ROWCOL2Q   SKIP IF DOING CONTINUATION FIELD             
         BO    VCLFLOOP                                                         
*                                                                               
*        IMPLEMENT CUR$ AS NEQ=0                                                
*                                                                               
         TM    REQBLLOP,REQBOCDQ  IF CURRENT DOLLARS ACTIVE                     
         BNO   VCLCFC$X                                                         
*                                                                               
         CLC   DRRTNI,=CL8'IDOL'   SKIP IF NOT DOLLAR BUCKET                    
         BNE   VCLCFC$X                                                         
*                                                                               
         CLI   DRARGSI+4,C'C'      SKIP IF NOT CURRENT $ FIELD                  
         BNE   VCLCFC$X                                                         
*                                                                               
*        SET MIN/MAX FIELD TO REJECT IF EQ ZERO                                 
*              IE. NEQ=0                                                        
*                                                                               
         ZAP   DRMINO,=P'0'        SET MIN VALUE ACCEPTED                       
         MVI   DRMINO,1            SET TO EXCLUDE IF MIN NOT REACHED            
         ZAP   DRMAXO,=P'0'        SET MAX VALUE ACCEPTED                       
         MVI   DRMAXO,1            SET TO EXCLUDE IF OVER MAX                   
*                                                                               
VCLCFC$X DS    0H                                                               
*                                                                               
*        VALIDATE COLUMN FILTERS                                                
*                                                                               
         LA    R4,42(R4)           BUMP TO FIRST FORMAT OR FILTER               
         AI    FIELDERR,1          INCREMENT FIELD IN ERROR COUNTER             
         BCT   R0,*+8                                                           
         B     VCLFDONE            NO FORMAT OR FILTER OPTIONS                  
*                                                                               
VCLFLOOP DS    0H                                                               
*                                                                               
*        CHECK FOR '<' & '>' AS SEPARATORS                                      
*                                                                               
         GOTO1 =A(SEPSCAN),RR=RELORGEN CHECK FOR < AND >                        
*                                                                               
         BNE   VCLFNVE             ERROR FOUND                                  
*                                                                               
         CLI   12(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   13(R4),C'?'         IF HELP REQUESTED                            
         BE    *+8                                                              
         CLI   12(R4),C'+'         IF HELP REQUESTED                            
         BNE   VCLFHLPN                                                         
*                                                                               
         LA    RF,HELPCBLK         SET FIELD TYPE IN HELP CONTROL BLOCK         
         MVI   HCBFTYP-HELPCB(RF),C'C'   HARD CODE VALUE FOR COLUMNS            
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMCFW),(R2),HELPCBLK SHOW HELP MENU         
*                                     FOR OPTIONS                               
*                                                                               
*        DOES NOT RETURN HERE                                                   
*                                                                               
VCLFHLPN DS    0H                                                               
*                                                                               
*        PURE NUMBER IS ASSUMED TO BE LENGTH OVERRIDE                           
*                                                                               
VCLFLN   DS    0H                                                               
*                                                                               
         TM    2(R4),X'80'         NUMERIC=OUTPUT WIDTH OVERRIDE                
         BNO   VCLFLNN                                                          
*                                                                               
         MVC   DRLENO,4+3(R4)      (NEW OUTPUT LENGTH)                          
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFLNN  DS    0H                                                               
*                                                                               
VCLFMXM  DS    0H                                                  L24          
*                                                                               
         BAS   RE,VCOLMXMN         VALIDATE FOR MAX/MIN ENTRY      L24          
         BNE   VCLFMXMN                                            L24          
*                                                                               
         B     VCLFCONT                                            L22          
*                                                                               
VCLFMXMN DS     0H                                                  L24         
*                                                                               
*        ANALYZE FOR FLOWCHARTING                                               
*                                                                               
VCLFFLW  DS     0H                                                  L24         
*                                                                               
         CLC   =C'ST',12(R4)       AVOID STA=  CONFUSION                        
         BE    VCLFFLWN                                                         
         CLC   =C'SAL',12(R4)      AVOID SAL=  CONFUSION                        
         BE    VCLFFLWN                                                         
         CLC   =C'SP',12(R4)       AVOID SPACE CONFUSION                        
         BE    VCLFFLWN                                                         
         CLC   =C'SK',12(R4)       AVOID SKIP  CONFUSION                        
         BE    VCLFFLWN                                                         
         CLC   =C'MK',12(R4)       AVOID MKT=  CONFUSION                        
         BE    VCLFFLWN                                                         
         CLC   =C'MARK',12(R4)     AVOID MARKET=  CONFUSION                     
         BE    VCLFFLWN                                                         
         CLC   =C'YTD',12(R4)      AVOID YTD      CONFUSION                     
         BE    VCLFFLWN                                                         
*                                                                               
         CLI   12(R4),C'Y'         YEARLY    TOTAL                              
         BE    VCLFFLW1                                                         
         CLI   12(R4),C'S'         SEMI-ANNUAL TOTAL                            
         BE    VCLFFLW1                                                         
         CLI   12(R4),C'Q'         QUARTERLY TOTAL                              
         BE    VCLFFLW1                                                         
         CLI   12(R4),C'M'         MONTHLY TOTALS                               
         BE    VCLFFLW1                                                         
         CLI   12(R4),C'W'         WEEKLY TOTALS                                
         BNE   VCLFFLWN                                                         
*                                                                               
VCLFFLW1 DS    0H                                                               
*                                                                               
         CLI   13(R4),C'1'         DATE RANGE MUST BE NUMERIC                   
         BL    VCLFLW1E                                                         
*                                                                               
         CLI   DRATTRIB,C'$'       IF NOT NUMERIC FIELD                         
         BE    *+12                                                             
         CLI   MYLABEL,C'A'        THEN MUST BE 1ST COLUMN                      
         BNE   VCL1STE                                                          
*                                                                               
         MVC   FLOWDTYP,12(R4)       SAVE FLOWCHART DATE TYPE                   
*                                                                               
         MVI   FCHRTITR,0            INITIALIZE                                 
*                                                                               
*        VALIDATE FLOWCHART EXPRESSION AND BUILD DATE TABLE                     
*                                                                               
         MVI   ERROR,0             IN CASE ERROR CODE SET                       
         GOTOR PEREXP,DMCB,0                                                    
*                                                                               
         CLI   ERROR,0             CHECK FOR ERRORS                             
         BE    *+14                                                             
         SR    RF,RF                                                            
         ICM   RF,1,ERROR          FOR ERROR ROUTINES                           
         B     VCLFERR                                                          
*                                                                               
         ICM   RF,15,ADATLIST      ESTABLISH DATE LIST                          
         BZ    VCLFCONT                                                         
         USING DATELSTD,RF                                                      
*                                                                               
         CLI   EXPLIST,255         CHECK FOR ERRORS                             
         BE    VCLFERR             ERROR CODE SET                               
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
         DROP  RF                                                               
*                                                                               
VCLFFLWN DS    0H                                                               
*                                                                               
*        CHECK FOR COLUMN FILTERS VIA DDVAL                                     
*                                                                               
VCLFLT   DS    0H                                                               
*                                                                               
         GOTO1 =A(CFLTVAL),RR=RELORGEN VALIDATE FILTERS                         
*                                                                               
         OC    CFLTQTIC,CFLTQTIC   ERROR IF NO MASTER ICODE                     
         BZ    VCLFNVE                                                          
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE                      
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
*        OUTPUT LENGTH MODIFIER                                                 
*                                                                               
VCLFLEN  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFLEN)   CHECK FOR LEN=                         
         BNE   VCLFLENN                                                         
*                                                                               
         MVC   DRLENO,4+3(R4)      (NEW OUTPUT LENGTH)                          
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFLENN DS    0H                                                               
*                                                                               
*        AS-AT-DATE FILTER                                                      
*                                                                               
VCLFAAD  DS    0H                                                               
*                                                                               
         CLC   CFLTQTIC,=AL2(RKQCFAAD)   CHECK FOR ASATDATE=                    
         BNE   VCLFAADN                                                         
*                                                                               
         SR    RF,RF               BUMP ASATDATE FILTERS COUNTER                
         IC    RF,REQAADFN                                                      
         LA    RF,1(RF)                                                         
         STC   RF,REQAADFN                                                      
*                                                                               
         LA    RE,6                                                             
         MR    RE,RE               DISPLACEMENT INTO ASATDATE TABLE             
         LA    R1,RWAADTAB(RF)     ASATDATE STORAGE AREA                        
         MVC   0(6,R1),VLTEXTRA+1  TABLE DATE(S)                                
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFAADN DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFATD)   CHECK FOR ACTIVITY DATES=              
         BNE   VCLFATDN                                                         
*                                                                               
         XC    WORK,WORK                                                        
*                                                                               
*        CHECK IF RFP SYMBOLIC PARAMETER ENTERED                                
*                                                                               
         OC    ARFPBLK,ARFPBLK     SKIP IF RFP NOT BEING USED                   
         JZ    VCATRFPN                                                         
*                                                                               
         L     R6,ARFPBLK          ESTABLISH RFP BLOCK                          
         USING RFPBLK,R6                                                        
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,RFPVNUMS       NUMBER OF VIABLE SYMBOLIC NAMES              
         JZ    VCATRFPN            NONE                                         
*                                                                               
         LHI   RF,RFPXTNSN-RFPBLK  USE EXTENDED SYMBOL TABLE                    
         LA    RF,RFPBLK(RF)                                                    
*                                                                               
         USING RFPVSYMS,RF         ESTABLISH SYMBOL TABLE                       
*                                                                               
         CLC   RFPVSYMB(20),22(R4) MATCH INPUT TO SYMBOLIC PARAMETER            
         JE    *+10                   EXPANDED FORMAT                           
         CLC   RFPVSYME(L'RFPVSYME-1),22(R4) MATCH INPUT TO SYMB PARM           
         JE    *+16                  ESCAPE SEQ IN CASE LEFT OVER               
*                                     FROM LAST TRANSACTION                     
         LA    RF,RFPVSYML(RF)     BUMP TO NEXT SYMBOLIC PARAMETER              
         BRCT  RE,*-24                                                          
         J     VCATRFPN            NO SYMBOLIC PARAMETER FOUND                  
*                                                                               
         CLC   =AL2(RE#RFSAT),RFPVSYME+1 MUST BE ASATDATE SYMBOLIC              
         JNE   VCATNVE                                                          
*                                                                               
         CLM   R0,1,=AL1(1)        MUST BE LAST OPTION                          
         JNE   VCATLSTE                                                         
*                                                                               
         SR    R1,R1                                                            
         IC    R1,8(R4)            DISPLACEMENT OF DATE IN FIELD                
         LA    R1,8(R1,R2)         POINT TO DATE AREA                           
         MVC   0(17,R1),SPACES     INIT DATE                                    
         MVC   0(L'RFPVSYME,R1),RFPVSYME REPLACE KEYWORD WITH ESC SEQ           
*                                                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
*                                                                               
         IC    RE,1(R4)            LENGTH OF DATE AS ENTERED                    
         IC    RF,5(R2)            CURRENT LENGTH OF INPUT                      
*                                                                               
         SR    RF,RE               LENGTH WITHOUT DATE                          
*                                                                               
         LA    RF,17(RF)           LENGTH WITH MAX DATE                         
*                                                                               
         LA    RF,16(RF)           MAKE SURE IT WILL FIT IN FIELD               
         CLM   RF,1,0(R2)                                                       
         JH    VCATAD2E                                                         
*                                                                               
         AHI   RF,-16              RESTORE INPUT LENGTH                         
*                                                                               
         STC   RF,5(R2)            CHANGE LENGTH TO MAX INPUT FOR RFP           
         MVI   L'RFPVSYME-1(R1),17   CHG LEN IN ESCAPE SEQ                      
*                                                                               
         B     VCATALX            VALID ACTIVITY DATE                           
*                                                                               
         DROP  R6,RF                                                            
*                                                                               
VCATRFPN DS    0H                                                               
*                                                                               
         CLI   1(R4),0              ENTRY REQUIRED AT THIS POINT                
         JE    VCATMSE                                                          
*                                                                               
         XC    DBLOCKC(256),DBLOCKC                                             
         LA    R6,DBLOCKC                                                       
         USING PERVALD,R6          ESTABLISH PERVAL WORKAREA                    
*                                                                               
         MVC   PVALBSTA,BTODAY     PASS TODAY'S DATE                            
*                                                                               
         L     RF,ACOMFACS         GET PERVAL ADDRESS                           
         L     RF,CPERVAL-COMFACSD(RF)                                          
*                                                                               
         SR    R3,R3                                                            
         IC    R3,1(R4)            INPUT LENGTH                                 
*                                                                               
         LA    R3,PVINDDMM(R3)     DEFAULT TO MMDD INSTEAD OF MMYY              
*                                  VALIDATE PERIOD                              
         GOTO1 (RF),DMCB,((R3),22(R4)),('PVINTOD',(R6))                         
         CLI   4(R1),0             CHECK FOR ERRORS                             
         JNE   VCATNVE                                                          
*                                                                               
         CLC   PVALBSTA,PVALBEND   START MUST BE BEFORE END                     
         JH    VCAT2E                                                           
*                                                                               
         MVC   WORK+10(6),PVALESTA    SAVE START DATE                           
         MVC   WORK+16(6),PVALEEND    SAVE END DATE                             
*                                                                               
         MVI   BYTE,0                                                           
         GOTO1 GETDAY,(R1),WORK+10,WORK   GET START DAY                         
*                                                                               
         CLC   WORK(3),SPACES                                                   
         JE    VCATNVE             INVALID START DAY                            
*                                                                               
         MVC   WORK+30(6),WORK+10  INIT START DATE                              
         MVC   WORK+36(6),WORK+16  INIT END   DATE                              
*                                                                               
         CLI   DMCB,1              IF MONDAY, OK                                
         JE    VCAT64                                                           
*                                                                               
         MVI   BYTE,1              BACKUP TO PRIOR MONDAY FOR START             
         ZIC   R0,DMCB                                                          
         BCTR  R0,0                                                             
         LNR   R0,R0                                                            
         GOTO1 ADDAY,DMCB,WORK+10,WORK+30,(R0)  ACTUAL START DATE               
*                                                                               
VCAT64   DS    0H                                                               
*                                                                               
         GOTO1 GETDAY,(R1),WORK+16,WORK                                         
         CLC   WORK(3),SPACES                                                   
         JE    VCATNVE             INVALID END DATE                             
*                                                                               
         CLI   DMCB,7              IF SUNDAY, OK                                
         JE    VCAT66                                                           
*                                                                               
         MVI   BYTE,1              FIND FOLLOWING SUNDAY FOR END DATE           
         ZIC   R0,DMCB                                                          
         SH    R0,=H'7'                                                         
         LCR   R0,R0                                                            
         GOTO1 ADDAY,DMCB,WORK+16,WORK+36,(R0) ACTUAL END DATE                  
*                                                                               
VCAT66   DS    0H                                                               
*                                                                               
         GOTO1 DATCON,DMCB,WORK+30,(3,DRARGSI+09)  START DATE                   
         GOTO1 DATCON,DMCB,WORK+36,(3,DRARGSI+12)  END    DATE                  
*                                                                               
         MVC   DRARGSO+9(6),DRARGSI+9   ADD DATES TO ARGUMENTS                  
*                                                                               
VCATALX  DS    0H                                                               
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFATDN DS    0H                                                               
*                                                                               
VCLFHD   DS    0H                  CHECK FOR HEADING OVERRIDES                  
*                                                                               
         LA    R1,DRHEAD1                                                       
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFH1)                                           
         BE    VCLFHD1                                                          
*                                                                               
         LA    R1,DRHEAD2                                                       
         CLC   VLTICODE,=AL2(RKQCFH2)                                           
         BE    VCLFHD1                                                          
*                                                                               
         LA    R1,DRHEAD3                                                       
         CLC   VLTICODE,=AL2(RKQCFH3)                                           
         BE    VCLFHD1                                                          
*                                                                               
         LA    R1,DRHEAD4                                                       
         CLC   VLTICODE,=AL2(RKQCFH4)                                           
         BNE   VCLFHDN                                                          
*                                                                               
         USING DRHEADD,R1          ESTABLISH HEADING DRONE AREA                 
*                                                                               
VCLFHD1  DS    0H                                                               
*                                                                               
         XC    0(64,R1),0(R1)      TURN OFF ROUTINE & ARGS                      
         MVI   HDGOVRSW,C'Y'       HEADING OVERRIDE INDICATOR                   
*                                                                               
         CLI   1(R4),0                                                          
         BE    VCLFCONT            HN= CAUSES REMOVAL                           
*                                                                               
         CLI   1(R4),1             HN=X CAUSES REMOVAL                          
         BNE   *+12                                                             
         CLI   22(R4),C'X'                                                      
         BE    VCLFCONT                                                         
*                                                                               
         OI    DRHEAD,X'80'        OTHERWISE TURN IT BACK ON                    
         MVC   DRHLITL,1(R4)       PASS LITERAL LENGTH TO DRONE                 
*                                                                               
         CLC   DRHLITL,DRLENO                                                   
         BH    VCLTLWDE            CHECK LITERAL NOT WIDER THAN COLUMN          
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DRHLITL                                                     
         BZ    *+6                 ZERO LENGTH                                  
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DRHLIT(0),22(R4)    MOVE IN HEADER LITERAL                       
*                                                                               
VCLFHDX  DS    0H                                                               
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
         DROP  R1                                                               
*                                                                               
VCLFHDN  DS    0H                                                               
*                                                                               
VCLFNP   DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFNP)  OPTION NOT TO PRINT                      
         BNE   VCLFNPN                                                          
*                                                                               
         MVI   MYPOSO,C'N'                                                      
         NI    DRFLAGO,X'FF'-X'80'                                              
         NI    DRHEAD1,X'FF'-X'80'  TURN OFF ALL HEADLINES                      
         NI    DRHEAD2,X'FF'-X'80'                                              
         NI    DRHEAD3,X'FF'-X'80'                                              
         NI    DRHEAD4,X'FF'-X'80'                                              
         MVC   DRH1LIT,SPACES                                                   
         MVC   DRH2LIT,SPACES                                                   
         MVC   DRH3LIT,SPACES                                                   
         MVC   DRH4LIT,SPACES                                                   
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFNPN  DS    0H                                                               
*                                                                               
VCLFUSR  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFUSR)   USER RECORD                            
         BNE   VCLFUSRN                                                         
*                                                                               
         GOTO1 GUSRDRON            VALIDATE USING DRONE                         
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFUSRN DS    0H                                                               
*                                                                               
VCLFNT   DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFNT)  OPTION NOT TO TOTAL THIS COLUMN          
         BNE   VCLFNTN                                                          
*                                                                               
         OI    DROPTSO+1,DRNOTOT   TURN ON INDICATOR                            
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFNTN  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFRIG) RIGHT JUSTIFY OUTPUT                     
         BNE   VCLFRGTN                                                         
*                                                                               
         OI    DROPTSO,DRALGNRO    TURN ON INDICATOR                            
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFRGTN DS    0H                                                               
*                                                                               
VCLFTHO  DS     0H                                                  L24         
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFTHO)   THOUSAND OPTION                        
         BNE   VCLFTHON                                                         
*                                                                               
         MVI   DRDIVO,3                                                         
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFTHON DS    0H                                                  L24          
*                                                                               
VCLFDIV  DS    0H                  DIVIDE OPTION                                
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFDIV)   DIVIDE OPTION                          
         BNE   VCLFDIVN                                                         
*                                                                               
         TM    3(R4),X'80'         DIVIDE VALUE MUST BE NUMERIC                 
         BZ    VCLDIVE                                                          
*                                                                               
         MVI   DRDIVO,1                                                         
         SR    RF,RF                                                            
         ICM   RF,7,9(R4)                                                       
*                                                                               
         CH    RF,=H'10'                                                        
         BE    VCLFDIVX                                                         
*                                                                               
         MVI   DRDIVO,2                                                         
         CH    RF,=H'100'                                                       
         BE    VCLFDIVX                                                         
*                                                                               
         MVI   DRDIVO,3                                                         
         CH    RF,=H'1000'                                                      
         BE    VCLFDIVX                                                         
*                                                                               
         MVI   DRDIVO,4                                                         
         CH    RF,=H'10000'                                                     
         BE    VCLFDIVX                                                         
*                                                                               
         MVI   DRDIVO,5                                                         
         C     RF,=F'100000'                                                    
         BE    VCLFDIVX                                                         
*                                                                               
         B     VCLDIV1E                                                         
*                                                                               
VCLFDIVX DS    0H                                                               
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFDIVN DS    0H                                                               
*                                                                               
VCLFBKT  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFBKT)  (NUMBERS) BRACKET POS AND NEG           
         BNE   VCLFBKTN                                                         
*                                                                               
         OI    DROPTSO,DRBKMINO                                                 
*                                                                               
         CLI   22(R4),C'M'              ELIMINATE FLOAT                         
         BNE   VCLFBKTX                                                         
*                                                                               
         NI    DROPTSO,X'FF'-X'20'      DO NOT NEED MINUS =                     
*                                                                               
         CLI   DRFLOATO,C'-'                                                    
         BNE   VCLFBKTX                                                         
*                                                                               
         MVI   DRFLOATO,0                                                       
*                                                                               
VCLFBKTX DS    0H                                                               
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFBKTN DS    0H                                                               
*                                                                               
VCLFDEC  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFDEC)   DECIMAL PLACES                         
         BNE   VCLFDECN                                                         
*                                                                               
         TM    3(R4),X'80'         NUMBER OF DECIMALS MUST BE NUMERIC           
         BZ    VCLDECE                                                          
*                                                                               
         MVC   DRDECO,11(R4)       SAVE NUMBER OF DECIMALS                      
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFDECN DS    0H                                                               
*                                                                               
VCLFCUM  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFCUM)   ACCUMULATE                             
         BNE   VCLFCUMN                                                         
*                                                                               
         CLI   DRATTRIB,C'$'       MUST BE DOLLARS                L09           
         BNE   VCLCUME                                           L09            
*                                                                               
         OI    DROPTSO+1,DRCUME                                   L09           
*                                                                               
VCLFCUMX DS    0H                                                 L12           
*                                                                               
         B     VCLFCONT                                           L09           
*                                                                               
VCLFCUMN DS    0H                                                 L12           
*                                                                               
VCLFTRM  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFTRM) IF TRIMMING DECIMALS                     
         BNE   VCLFTRMN                                                         
*                                                                               
         OI    DROPTSO+1,DRTRMDEC         SET INDICATOR                         
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFTRMN DS    0H                                                               
*                                                                               
VCLFPBL  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFPBL) IF NOT PRINTING ZERO FIELDS              
         BNE   VCLFPBLN                                                         
*                                                                               
         NI    DROPTSO,X'FF'-DRZEROO      SET INDICATOR                         
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFPBLN DS    0H                                                               
*                                                                               
VCLFPZR  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFPZR) IF PRINTING ZERO FIELDS                  
         BNE   VCLFPZRN                                                         
*                                                                               
         OI    DROPTSO,DRZEROO            SET INDICATOR                         
*****    NI    DROPTSO,X'FF'-DRCOMMAO     KILL COMMAS IN OUTPUT                 
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFPZRN DS    0H                                                               
*                                                                               
VCLFNBX  DS    0H                                                               
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFNBX) IF ERASING LEFT BOX LINE                 
         BNE   VCLFNBXN                                                         
*                                                                               
         OI    DROPTSO+1,DRNOLBOX         SET INDICATOR                         
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFNBXN DS    0H                                                               
*                                                                               
VCLFTRL  DS    0H                  TRAIL=                                       
*                                                                               
         CLC   VLTICODE,=AL2(RKQCFTRL) IF SETTING FLOAT CHARACTER               
         BNE   VCLFTRLN                                                         
*                                                                               
         MVC   DRTRAILO,22(R4)            CAPTURE TRAILING CHARACTER            
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
VCLFTRLN DS    0H                                                               
*                                                                               
*        END OF SPECIAL HANDLING FOR COLUMN FILTERS                             
*                                                                               
         B     VCLFCONT                                                         
*                                                                               
         DROP  R5                                                               
*                                                                               
VCLFCONT DS    0H                                                               
*                                                                               
         LA    R4,42(R4)                                                        
         AI    FIELDERR,1                                                       
         BCT   R0,VCLFLOOP                                                      
*                                                                               
VCLFDONE DS    0H                                                               
*                                                                               
VCLFLTSX DS    0H                                                               
         XIT1                                                                   
*                                                                               
VCLFNVE DS     0H                  COLUMN FILTER NOT VALID                      
         LHI   RF,RWECFNV                                                       
         J     VCLFERR                                                          
*                                                                               
VCLFVLE DS     0H                  INVALID FILTER VALUE FOR KEYWORD             
         LHI   RF,RWEFLTNV                                                      
         J     VCLFERR                                                          
*                                                                               
VCLWIDE DS     0H                  HEADING OVERRIDE TOO WIDE                    
         LHI   RF,RWEHDWID                                                      
         J     VCLFERR                                                          
*                                                                               
VCLFLW1E DS    0H                  PERIOD RANGE MUST BE NUMERIC                 
         LHI   RF,RWEFLW1E         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLSEPER DS    0H                  KEYORD CAN'T ACT AS A FILTER                 
         LHI   RF,RWESEPER         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLTXMSE DS    0H                  TEXT INPUT MISSING                           
         LHI   RF,RWETXTMS         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLTXLNE DS    0H                  TEXT INPUT TOO LONG                          
         LHI   RF,RWETXTLN         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCATNVE  DS    0H                  DATE NOT VALID                               
         LHI   RF,RWEDTENV                                                      
         J     VCLFERR                                                          
*                                                                               
VCATMSE  DS    0H                  ACTIVITY DATE MISSING                        
*        LHI   RF,RWEATDMS                                                      
         J     VCLFERR                                                          
*                                                                               
VCAT2E   DS    0H                  END BEFORE START                             
         LHI   RF,RWEENDST                                                      
         J     VCLFERR                                                          
*                                                                               
VCATAD2E DS    0H                  ACTIVITY OPTION WON'T FIT ON LINE            
         LHI   RF,RWEAADLG                                                      
         J     VCLFERR                                                          
*                                                                               
VCATLSTE DS    0H                  OPTION MUST BE LAST OPTION                   
         LHI   RF,RWEAADLS                                                      
         J     VCLFERR                                                          
*                                                                               
VCLTLWDE DS    0H                  COLUMN TITLE WIDER THAN COLUMN               
         LHI   RF,RWETLWDE         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCL1STE DS     0H                  NON-NUMERIC FLOWCHARTING MUST BE             
         LHI   RF,RWE1STCL            FIRST COLUMN                              
         J     VCLFERR                                                          
*                                                                               
VCLDIVE  DS    0H                  DIVISOR NOT NUMERIC                          
         LHI   RF,RWEDIVNV         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLDIV1E DS    0H                  DIVISOR NOT VALID                            
         LHI   RF,RWEDIVNV         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLDECE  DS    0H                  NUMBER OF DECIMALS NOT VALID                 
         LHI   RF,RWEDECNM         SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLCUME  DS    0H                  CAN ACCUMULATE ONLY NUMERIC FIELDS           
         LHI   RF,RWECUME          SET ERROR CODE                               
         J     VCLFERR                                                          
*                                                                               
VCLFERR  DS    0H                                                               
*                                                                               
         STCM  RF,3,RERROR         SET ERROR CODE                               
         GOTO1 CURSERR                                                          
*                                                                               
       ++INCLUDE DDVALMNMX                                                      
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - COMPEDIT'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO FIGURE OUT EDITS FOR COMPUTES                     *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*        R2==> FIELD ON SCREEN                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
COMPEDIT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         CLI   BRACKOPT,C'Y'       IF USER ASKED FOR BRACKETS                   
         BNE   *+12                                                             
         MVI   DRFLOATO,0             DO NOT FLOAT IN MINUS AS WELL!            
         OI    DROPTSO,DRBKMINO       AND ENSURE BRACKET OPTION                 
*                                                                               
*        R4=A(SCANNER TABLE ENTRY)                                              
*                                                                               
         ZIC   R1,0(R4)            PICK UP EXPRESSION LENGTH                    
*                                                                               
         LA    R1,10(R1,R4)        POINT TO LAST OPERATOR                       
*                                                                               
         CLI   0(R1),C'%'          IS LAST OPERATOR PERCENT?                    
         BE    COMPPCT                                                          
*                                                                               
         CLI   0(R1),C'I'          OR INDEX?                                    
         BE    COMPINX                                                          
*                                                                               
         BCTR  R1,0                BACK UP A POSITION                           
*                                                                               
         CLI   0(R1),C'V'          OR VERTICAL PERCENT                          
         BE    COMPPCT                                                          
*                                                                               
         LA    RE,8(R2)            RE=A(START OF INPUT STRING)                  
         ZIC   R0,5(R2)            R0=LENGTH OF INPUT STRING                    
*                                                                               
COMPED1L LA    R1,EDITLIST         ELSE LOOK FOR FIRST OPERAND                  
*                                                                               
COMPED2L DS    0H                                                               
*                                                                               
         CLI   0(R1),0             AT END OF TABLE                              
         BE    COMPED2D                                                         
*                                                                               
         CLC   0(1,R1),0(RE)       FIND VARIABLE IN TABLE                       
         BE    COMPEDFD                                                         
*                                                                               
COMPED2C DS    0H                                                               
*                                                                               
         LA    R1,4(R1)            BUMP TABLE POINTER                           
         B     COMPED2L                                                         
*                                                                               
COMPED2D DS    0H                                                               
*                                                                               
COMPED1C DS    0H                                                               
*                                                                               
         LA    RE,1(RE)               BUMP INPUT POINTER                        
         BCT   R0,COMPED1L                                                      
*                                                                               
COMPED1D DS    0H                                                               
*                                                                               
         MVI   DRDECO,X'FF'        INDICATE ERROR                               
         B     COMPEDIX                                                         
*                                                                               
COMPEDFD MVC   DRDECO,1(R1)        PICK UP ITS EDIT CHARACTERISTIC              
         MVC   DRDIVO,2(R1)                                                     
*                                                                               
         B     COMPEDIX                                                         
*                                                                               
COMPPCT  MVI   DRDECO,2            PERCENTS HAVE 2 DEC                          
         MVI   DRTRAILO,C'%'       AND END WITH PERCENT SIGN                    
*                                                                               
         B     COMPEDIX                                                         
*                                                                               
COMPINX  MVI   DRDECO,0            INDEXES HAVE 0 DEC                           
*                                                                               
COMPEDIX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - PERPOP'                   
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PUT IN PERIOD HEADING SUPPORT                     *         
*                                                                     *         
*NTRY    R4==> SCANNER BLOCK                                          *         
*        R2==> FIELD ON SCREEN                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
PERPOP   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9          ESTABLISH WRITER WORKING STORAGE             
         USING T830FFD,RA                                                       
         USING GEND,RC                                                          
*                                                                               
         CLI   MYPOSO,C'N'         NOT NEEDED IF NOT PRINTING                   
         BE    PERPOPX                                                          
*                                                                               
         CLI   DRARGSI+11,0        WAS A PERIOD SPECIFIED?                      
         BE    PERPOPX                 (MINIMUM IS 1 MONTH)                     
*                                                                               
         LA    R1,DRHEAD1          YES SO FIND AN EMPTY HEADING                 
*                                                                               
         TM    0(R1),X'80'                                                      
         BNO   PERPOP2                                                          
         LA    R1,DRHEAD2                                                       
         TM    0(R1),X'80'                                                      
         BNO   PERPOP2                                                          
         LA    R1,DRHEAD3                                                       
         TM    0(R1),X'80'                                                      
         BNO   PERPOP2                                                          
         LA    R1,DRHEAD4                                                       
         TM    0(R1),X'80'                                                      
         BNO   PERPOP2                                                          
*                                                                               
         B     PERPOPX             NO ROOM!                                     
*                                                                               
PERPOP2  OI    0(R1),X'80'         FOUND A SPACE - SO TURN ON                   
         MVC   1(8,R1),=CL8'PERPOP' SET HEADLINE ROUTINE ADDRESS                
         MVC   9(7,R1),DRARGSI+9   PASS THE PERIOD TYPE, START/END              
         MVI   25(R1),16           ALL ARGUMENTS                                
*                                                                               
PERPOPX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLTVAL'                   
***********************************************************************         
*                                                                     *         
*        USE DDVAL TO VALIDATE COLUMN FILTERS                         *         
*                                                                     *         
*NTRY    R4 ==>   SCANNER BLOCK                                       *         
*                                                                     *         
*EXIT    CFLTQTIC - INTERNAL CODE FOR COLUMN FILTER                   *         
*                   NULLS IF INVALID FILTER                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
CFLTVAL  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING GEND,RC                                                          
         USING SUBSYSD,R9                                                       
         USING T830FFD,RA                                                       
*                                                                               
         BRAS  RE,CFLVINIT         INITIALIZE FOR VALIDATION                    
         BNE   CFLTVALX            ERRORS FOUND                                 
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVTYPE'                  
***********************************************************************         
*                                                                     *         
*        ANALYZE COLUMN FILTER TYPE                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVTYPE DS    0H                                                               
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE                      
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,VLTICODE                                                    
*                                                                               
*        SOME QUICKIES                                                          
*                                                                               
*        DROP IF NO DATA FILTER                                                 
*                                                                               
         CHI   RF,RKQCFDRP        IF SUPPRESS  FILTER                           
         JNE   CFLVDRPN                                                         
*                                                                               
         OI    REQCFOPT,REQCFDPQ     SET OPTION IN WORKAREA                     
*                                                                               
         CLC   DRRTNO,SPACES          IF NO OUTPUT ROUTINE                      
         BH    *+10                                                             
         MVC   DRRTNO,=CL8'ODOL'         SET TO DUMMY ONE                       
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
CFLVDRPN DS    0H                                                               
*                                                                               
*        NO DETAIL FILTER                                                       
*                                                                               
         CHI   RF,RKQCFNDT        IF NO DETAIL FILTER                           
         JNE   *+12                                                             
         OI    DROPTSO+1,DRNODET           SET OPTION                           
         J     CFLVCFLX                                                         
*                                                                               
         CHI   RF,RKQCFND         IF NO DETAIL FILTER                           
         JNE   *+12                                                             
         OI    DROPTSO+1,DRNODET           SET OPTION                           
         J     CFLVCFLX                                                         
*                                                                               
*        COUNT                                                                  
*                                                                               
         CHI   RF,RKQCFCT         IF COUNT OPTION                               
         JNE   *+16                                                             
         OI    REQCFOPT,REQCFCTQ           SET OPTION IN WORKAREA               
         OI    DRINDS,X'04'                MUST PRINT ALL TOTALS                
         J     CFLVFHDX                    SKIP PUTTING IN HEADS                
*                                                                               
*        RANKING ON COLUMN - ASCENDING                                          
*                                                                               
         CHI   RF,RKQCFRKA         IF RANKING                                   
         JNE   CFLVRKAN                                                         
*                                                                               
         MVI   COLRANK,2              SET COLUMN RANK SWITCH                    
*                                                                               
         CLI   22(R4),C'-'            CHECK FOR DESCENDING ORDER                
         JE    *+8                                                              
         CLI   12(R4),C'-'                                                      
         JNE   *+8                                                              
         MVI   COLRANK,1                                                        
*                                                                               
         LH    R1,TOTWIDTH            BUMP REPORT WIDTH                         
         LA    R1,4(R1)                                                         
         STH   R1,TOTWIDTH                                                      
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
CFLVRKAN DS    0H                                                               
*                                                                               
*        RANKING ON COLUMN - DESCENDING                                         
*                                                                               
         CHI   RF,RKQCFRKD         IF RANKING IN DESCENDING ORDER               
         JNE   CFLVRKDN                                                         
*                                                                               
         MVI   COLRANK,1              SET COLUMN RANK SWITCH                    
*                                                                               
         LH    R1,TOTWIDTH            BUMP REPORT WIDTH                         
         LA    R1,4(R1)                                                         
         STH   R1,TOTWIDTH                                                      
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
CFLVRKDN DS    0H                                                               
*                                                                               
*        MORE COMPLICATED VALIDATIONS                                           
*                                                                               
         CHI   RF,RKQCFCCD           IF CREATION DATES FILTER                   
         JE    CFLVCCD                                                          
*                                                                               
         CHI   RF,RKQCFAFF           IF AFFILIATION FILTER                      
         JE    CFLVAFF                                                          
*                                                                               
         CHI   RF,RKQCFDEM           IF TARGET DEMO FILTER                      
         JE    CFLVDEM                                                          
*                                                                               
         CHI   RF,RKQCFADV           IF ADVERTISER FILTER                       
         JE    CFLVADV                                                          
*                                                                               
         CHI   RF,RKQCFAGY           IF AGENCY  FILTER                          
         JE    CFLVAGY                                                          
*                                                                               
         CHI   RF,RKQCFBST           IF STATION BUDGET TYPE                     
         JE    CFLVBST                                                          
*                                                                               
         CHI   RF,RKQCFBOF           IF OFFICE  BUDGET TYPE                     
         JE    CFLVBOF                                                          
*                                                                               
         CHI   RF,RKQCFCTP           IF CONTRACT TYPE FILTER                    
         JE    CFLVCTP                                                          
*                                                                               
         CHI   RF,RKQCFOFF           IF OFFICE  FILTER                          
         JE    CFLVOFF                                                          
*                                                                               
         CHI   RF,RKQCFTEM           IF DIV/TEAM FILTER                         
         JE    CFLVTEM                                                          
*                                                                               
         CHI   RF,RKQCFGRP           IF GROUP FILTER                            
         JE    CFLVGRP                                                          
*                                                                               
         CHI   RF,RKQCFMKT           IF MARKET FILTER                           
         JE    CFLVMKT                                                          
*                                                                               
         CHI   RF,RKQCFOWN           IF OWNER FILTER                            
         JE    CFLVOWN                                                          
*                                                                               
         CHI   RF,RKQCFREP           IF REP   FILTER                            
         JE    CFLVREP                                                          
*                                                                               
         CHI   RF,RKQCFPTP           IF POINT PERSON FILTER                     
         JE    CFLVPTP                                                          
*                                                                               
         CHI   RF,RKQCFREG           IF REGION FILTER                           
         JE    CFLVREG                                                          
*                                                                               
         CHI   RF,RKQCFSAL           IF SALESPERSON FILTER                      
         JE    CFLVSAL                                                          
*                                                                               
         CHI   RF,RKQCFSTA           IF STATION FILTER                          
         JE    CFLVSTA                                                          
*                                                                               
         CHI   RF,RKQCFCST           IF COMPETETIVE STATIONS FLOW               
         JE    CFLVCST                                                          
*                                                                               
         CHI   RF,RKQCFYTD           IF YTD SUMS                                
         JE    CFLVYTD                                                          
*                                                                               
         CHI   RF,RKQCFBKB           IF BACK BILLING OPTIONS                    
         JE    CFLVBKB                                                          
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVCCD'                   
***********************************************************************         
*                                                                     *         
*        CONTRACT CREATION DATES                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVCCD  DS    0H                                                               
*                                                                               
         CLI   1(R4),0              ENTRY REQUIRED AT THIS POINT                
         JE    VCCDMSE                                                          
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         XC    CFLTFVAL,CFLTFVAL            INIT VALUE                          
         MVI   CFLTVLEN,6                   FIXED VALUE LENGTH                  
*                                                                               
         XC    DBLOCKC(256),DBLOCKC                                             
         LA    R6,DBLOCKC                                                       
         USING PERVALD,R6          ESTABLISH PERVAL WORKAREA                    
*                                                                               
         MVC   PVALBSTA,BTODAY     PASS TODAY'S DATE                            
*                                                                               
         LA    RE,22(R4)           START OF INPUT                               
*                                                                               
         SR    R3,R3                                                            
         IC    R3,1(R4)            INPUT LENGTH                                 
*                                                                               
         CLI   22(R4),C'-'         IF DATE STARTS WITH DASH                     
         BNE   *+16                                                             
         BCT   RE,*+8                 DECREMENT LENGTH                          
         J     VCCDMSE                   NO DATE                                
         LA    RE,1(RE)               BUMP INPUT POINTER                        
*                                                                               
         ST    RE,DMCB             SAVE INPUT ADDRESS                           
*                                                                               
         LA    R3,PVINDDMM(R3)     DEFAULT TO MMDD INSTEAD OF MMYY              
         STC   R3,DMCB                                                          
*                                                                               
         L     RF,ACOMFACS         GET PERVAL ADDRESS                           
         L     RF,CPERVAL-COMFACSD(RF)                                          
*                                                                               
*                                  VALIDATE PERIOD                              
         GOTO1 (RF),DMCB,,('PVINTOD+PVINSGLS',(R6))                             
*                                                                               
         TM    4(R1),X'FF'-PVRCONE CHECK FOR ERRORS                             
         JNZ   VCCDNVE                                                          
*                                                                               
         TM    DMCB+4,PVRCONE      IF SINGLE DATE FOUND                         
         BNO   VCCD10                                                           
*                                                                               
         CLI   22(R4),C'-'         IF END OF RANGE                              
         BNE   *+14                                                             
         MVC   CFLTFVAL+3(3),PVALBSTA      SAVE DATE AS END DATE                
         B     *+10                                                             
         MVC   CFLTFVAL(3),PVALBSTA   ELSE SAVE AS START DATE                   
*                                                                               
         B     CFLVCCDX                                                         
*                                                                               
VCCD10   DS    0H                  DATE RANGE ENTRERED                          
*                                                                               
         CLC   PVALBSTA,PVALBEND   START MUST BE BEFORE END                     
         JH    VCCD2E                                                           
*                                                                               
         MVC   CFLTFVAL(3),PVALBSTA   SAVE DATE RANGE                           
         MVC   CFLTFVAL+3(3),PVALBEND                                           
*                                                                               
CFLVCCDX DS    0H                                                               
*                                                                               
         B     CFLVCFLX                                                         
*                                                                               
CFLVCCDN DS    0H                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVAFF'                   
***********************************************************************         
*                                                                     *         
*        AFFILIATION FILTER                                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVAFF  DS    0H                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         JE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         JNE   CFLVAFHX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMSAF),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
CFLVAFHX DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES              INIT VALUE                          
         MVI   CFLTVLEN,L'RSTAAFFL          FIXED VALUE LENGTH                  
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQSTNAF)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   CFLVAFNV                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   CFLTFVAL(L'RSTAAFFL),VLTFULL  AFFILIATION CODE                   
*                                                                               
         J     CFLVEXTX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVDEM'                   
***********************************************************************         
*                                                                     *         
*        TARGET DEMO FILTER                                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVDEM  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES              INIT VALUE                          
         MVI   CFLTVLEN,3                   FIXED VALUE LENGTH                  
*                                                                               
*        BUILD DUMMY SCREEN FIELD FOR DEMOVAL                                   
*                                                                               
         CLI   1(R4),0             INPUT REQUIRED                               
         JE    CFLVDMNE                                                         
*                                                                               
         XC    WORK,WORK                                                        
         MVI   WORK,18             TOTAL FIELD LENGTH                           
         MVC   WORK+5(1),1(R4)     FIELD LENGTH                                 
         MVC   WORK+8(10),22(R4)   DEMO VALUE                                   
*                                                                               
*        SET UP DUMMY DEMO BLOCK                                                
*                                                                               
         LA    R6,DBLOCKC          ESTABLISH DEMO BLOCK                         
         USING DBLOCKD,R6                                                       
*                                                                               
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,=C'INV'                                                   
         MVI   DBSELMED,C'T'                                                    
         MVC   DBCOMFCS,ACOMFACS                                                
*                                                                               
         GOTO1 DEMOVAL,DMCB,(0,WORK),(1,CFLTFVAL),(0,DBLOCK)                    
*                                                                               
         CLI   DMCB+4,0            CHECK FOR ERRORS                             
         JE    CFLVDMNV            DEMO NOT VALID                               
*                                                                               
         DROP  R6                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVADV'                   
***********************************************************************         
*                                                                     *         
*        ADVERTISER FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVADV  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RADVKADV FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RADVKADV       CHECK LENGTH                                 
         JH    CFLVAD1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVAD2E                                                         
*                                                                               
*        VALIDATE ADVERTISER CODE                                               
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   ADVERTISER CODE                              
*                                                                               
*        MAKE SURE ADVERTISER IS ON FILE                                        
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RADVKEY,R6          ESTABLISH REP ADV KEY                        
*                                                                               
         MVI   RADVKTYP,RADVKTYQ   RECORD TYPE                                  
         MVC   RADVKREP,AGENCY     AGENCY                                       
         MVC   RADVKADV,CFLTFVAL   ADVERTISER CODE                              
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RADVKEY,KEYSAVE                                                  
         JNE   CFLVAD3E            ADV     NOT FOUND                            
*                                                                               
CFLVADVX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVAGY'                   
***********************************************************************         
*                                                                     *         
*        AGENCY     FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVAGY  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RAGYKAGY FIXED VALUE LENGTH                           
*                                                                               
         SR    R0,R0                                                            
         IC    R0,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  R0,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         LR    RE,R1               SAVE START OF AGENCY CODE                    
*                                                                               
         CLI   0(RE),C'-'          FIND DASH FOR OFFICE                         
         JE    *+12                                                             
         LA    RE,1(RE)                                                         
         BRCT  R0,*-12                                                          
*                                                                               
         LR    RF,RE               CALCULATE AGENCY CODE LENGTH                 
         SR    RF,R1                                                            
         JZ    CFLVAG2E            MUST HAVE A CODE                             
*                                                                               
         CHI   RF,L'RAGYKAGY       CHECK LENGTH                                 
         JH    CFLVAG1E                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   AGENCY CODE                                  
*                                                                               
         LTR   R0,R0               NO OFFICE IF DASH NOT FOUND                  
         JZ    CFLVAOFX                                                         
*                                                                               
         LA    R1,1(RE)            START OF OFFICE CODE                         
*                                                                               
         BRCT  R0,*+8              RECTIFY COUNT                                
         J     CFLVAG3E            OFFICE CODE NEEDED                           
*                                                                               
         LR    RF,R0               COPY OFFICE CODE LENGTH                      
         CHI   RF,L'RAGYKAOF       CHECK MAX LENGTH                             
         JH    CFLVAG4E                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL+L'RAGYKAGY(0),0(R1)   AGENCY OFFICE CODE                
*                                                                               
         MVI   CFLTVLEN,L'RAGYKAGY+L'RAGYKAOF FILTER LENGTH                     
*                                                                               
CFLVAOFX DS    0H                                                               
*                                                                               
*        MAKE SURE AGENCY     IS ON FILE                                        
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RAGYKEY,R6          ESTABLISH REP AGY KEY                        
*                                                                               
         MVI   RAGYKTYP,RAGYKTYQ   RECORD TYPE                                  
         MVC   RAGYKAGY(L'RAGYKAGY+L'RAGYKAOF),CFLTFVAL   AGENCY CODE           
         MVC   RAGYKREP,AGENCY     REP                                          
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RAGYKEY,KEYSAVE                                                  
         JNE   CFLVAG5E            AGY     NOT FOUND                            
*                                                                               
CFLVAGYX DS    0H                                                               
*                                                                               
         B     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVBST'                   
***********************************************************************         
*                                                                     *         
*        STATION BUDGET TYPE FILTER                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVBST  DS    0H                                                               
*                                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         JE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         JE    *+8                                                              
         CLI   23(R4),C'?'         IF HELP REQUESTED                            
         JNE   CFLVBSHX                                                         
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT3V-VLPARMS(R1),RKVBTPST   SET FOR STA BUDTYPES              
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMBST),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
CFLVBSHX DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES              INIT VALUE                          
         MVI   CFLTVLEN,L'REBTPS            FIXED VALUE LENGTH                  
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         MVI   VLFLT3V-VLPARMS(R1),RKVBTPST   SET FOR STA BUDTYPES              
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQBUDTP)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   CFLVAFNV                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   CFLTFVAL(L'REBTPS),VLTEXTRA    STATION BUDGET TYPE               
*                                                                               
         J     CFLVEXTX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVBOF'                   
***********************************************************************         
*                                                                     *         
*        OFFICE  BUDGET TYPE FILTER                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVBOF  DS    0H                                                               
*                                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         JE    *+8                                                              
         CLI   22(R4),C'?'         IF HELP REQUESTED                            
         JE    *+8                                                              
         CLI   23(R4),C'?'         IF HELP REQUESTED                            
         JNE   CFLVBOHX                                                         
*                                                                               
         L     R1,AVLPARMS                                                      
         MVI   VLFLT3V-VLPARMS(R1),RKVBTPOF   SET FOR OFF BUDTYPES              
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMBOF),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
CFLVBOHX DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES              INIT VALUE                          
         MVI   CFLTVLEN,L'REBTPS            FIXED VALUE LENGTH                  
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         MVI   VLFLT3V-VLPARMS(R1),RKVBTPOF   SET FOR OFF BUDTYPES              
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQBUDTP)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   CFLVAFNV                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   CFLTFVAL(L'REBTPO),VLTEXTRA    OFFICE  BUDGET TYPE               
*                                                                               
         J     CFLVEXTX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVCTP'                   
***********************************************************************         
*                                                                     *         
*        CONTRACT TYPE FILTER                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVCTP  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RCTYKCTY FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RCTYKCTY       CHECK LENGTH                                 
         JH    CFLVCT1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVCT2E                                                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   CONTRACT TYPE                                
*                                                                               
*        VALIDATE CONTRACT TYPE                                                 
*                                                                               
         XC    KEY,KEY             ESTABLISH CONTRACT TYPE KEY                  
         LA    R6,KEY                                                           
         USING RCTYKEY,R6                                                       
*                                                                               
         MVI   RCTYKTYP,RCTYKTYQ   RECORD TYPE                                  
         MVC   RCTYKREP,AGENCY     AGENCY                                       
         MVC   RCTYKCTY,CFLTFVAL   CONTRACT TYPE                                
*                                                                               
         GOTO1 HIGH                 READ POINTER                                
*                                                                               
         CLC   RCTYKEY,KEYSAVE     RECORD MUST BE FOUND                         
         JNE   CFLVCT3E            CODE NOT FOUND                               
*                                                                               
CFLVCTPX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVOFF'                   
***********************************************************************         
*                                                                     *         
*        OFFICE     FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVOFF  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'ROFFKOFF FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'ROFFKOFF       CHECK LENGTH                                 
         JH    CFLVOF1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVOF2E                                                         
*                                                                               
*        VALIDATE OFFICE CODE                                                   
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   OFFICE CODE                                  
*                                                                               
*        MAKE SURE OFFICE IS ON FILE                                            
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING ROFFKEY,R6          ESTABLISH REP OFF KEY                        
*                                                                               
         MVI   ROFFKTYP,ROFFKTYQ   RECORD TYPE                                  
         MVC   ROFFKREP,AGENCY     AGENCY                                       
         MVC   ROFFKOFF,CFLTFVAL   OFFICE CODE                                  
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   ROFFKEY,KEYSAVE                                                  
         JNE   CFLVOF3E            OFF     NOT FOUND                            
*                                                                               
*        OFFICE SECURITY CHECK                                                  
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF OFFLINE                              
         JE    CFLVOFFX                                                         
*                                                                               
         CLC   =C'O=',TWAACCS      TEST FOR OFFICE LIMITED ACCESS               
         JNE   CFLVOFFX                                                         
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL                                 
         JE    CFLVOFFX             YES                                         
*                                                                               
         TM    REREQPRF+1,X'40'    SKIP IF NO OFFICE ACCESS RESTRICTION         
         JNO   CFLVOFFX                                                         
*                                                                               
         TM    TWAAUTH,X'80'       TERMINAL HAS ACCESS TO ALL OFFICES?          
         JO    CFLVOFFX             YES                                         
*                                                                               
         CLC   CFLTFVAL,TWAACCS+2   NO, MUST MATCH RESTRICTED OFFICE            
         JNE   CFLVOFCE                                                         
*                                                                               
CFLVOFFX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVTEM'                   
***********************************************************************         
*                                                                     *         
*        DIV/TEAM   FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVTEM  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RTEMKTEM FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RTEMKTEM       CHECK LENGTH                                 
         JH    CFLVTM1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVTM2E                                                         
*                                                                               
*        VALIDATE TEAM CODE                                                     
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   TEAM CODE                                    
*                                                                               
*        MAKE SURE TEAM IS ON FILE                                              
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RTEMKEY,R6          ESTABLISH TEAM KEY                           
*                                                                               
         MVI   RTEMKTYP,RTEMKTYQ   RECORD TYPE                                  
         MVC   RTEMKREP,AGENCY     AGENCY                                       
         MVC   RTEMKTEM,CFLTFVAL   TEAM CODE                                    
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RTEMKEY,KEYSAVE                                                  
         JNE   CFLVTM3E            TEAM NOT FOUND                               
*                                                                               
CFLVTEMX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVGRP'                   
***********************************************************************         
*                                                                     *         
*        GROUP      FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVGRP  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RGRPKGRP FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RGRPKGRP       CHECK LENGTH                                 
         JH    CFLVGP1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVGP2E                                                         
*                                                                               
*        VALIDATE GROUP CODE                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         B     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   GROUP CODE                                   
*                                                                               
*        MAKE SURE GROUP IS ON FILE                                             
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RGRPKEY,R6          ESTABLISH REP GRP KEY                        
*                                                                               
         MVI   RGRPKTYP,RGRPKTYQ   RECORD TYPE                                  
         MVC   RGRPKREP,AGENCY     AGENCY                                       
         MVC   RGRPKGRP,CFLTFVAL   GROUP CODE                                   
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RGRPKEY,KEYSAVE                                                  
         JNE   CFLVGP3E            GROUP   NOT FOUND                            
*                                                                               
CFLVGRPX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVMKT'                   
***********************************************************************         
*                                                                     *         
*        MARKET     FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVMKT  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         XC    CFLTFVAL,CFLTFVAL   INIT VALUE                                   
         MVI   CFLTVLEN,L'RMKTKMKT FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RMKTKMKT       CHECK LENGTH                                 
         JH    CFLVGP1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVMK2E                                                         
*                                                                               
*        VALIDATE MARKET CODE                                                   
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   MARKET CODE                                  
*                                                                               
*        MAKE SURE MARKET IS ON FILE                                            
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RMKTKEY,R6          ESTABLISH REP MKT KEY                        
*                                                                               
         MVI   RMKTKTYP,RMKTKTYQ   RECORD TYPE                                  
         MVC   RMKTKREP,AGENCY     AGENCY                                       
         MVC   RMKTKMKT,CFLTFVAL   MARKET CODE                                  
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RMKTKEY,KEYSAVE                                                  
         JNE   CFLVMK3E            MARKET  NOT FOUND                            
*                                                                               
CFLVMKTX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVOWN'                   
***********************************************************************         
*                                                                     *         
*        OWNER      FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVOWN  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'ROWNKOWN FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'ROWNKOWN       CHECK LENGTH                                 
         JH    CFLVGP1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVOW2E                                                         
*                                                                               
*        VALIDATE OWNER CODE                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   OWNER CODE                                   
*                                                                               
*        MAKE SURE OWNER IS ON FILE                                             
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING ROWNKEY,R6          ESTABLISH REP OWN KEY                        
*                                                                               
         MVI   ROWNKTYP,ROWNKTYQ   RECORD TYPE                                  
         MVC   ROWNKREP,AGENCY     AGENCY                                       
         MVC   ROWNKOWN,CFLTFVAL   OWNER CODE                                   
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   ROWNKEY,KEYSAVE                                                  
         JNE   CFLVOW3E            OWNER   NOT FOUND                            
*                                                                               
CFLVOWNX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVREP'                   
***********************************************************************         
*                                                                     *         
*        REP        FILTER                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVREP  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RREPKREP FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RREPKREP       CHECK LENGTH                                 
         JH    CFLVRP1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVRP2E                                                         
*                                                                               
*        VALIDATE REP CODE                                                      
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTALISH WHERE WE ARE                        
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   REP CODE                                     
*                                                                               
*        MAKE SURE REP IS ON FILE                                               
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RREPKEY,R6          ESTABLISH REP REP KEY                        
*                                                                               
         MVI   RREPKTYP,RREPKTYQ   RECORD TYPE                                  
         MVC   RREPKREP,CFLTFVAL   REP CODE                                     
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RREPKEY,KEYSAVE                                                  
         JNE   CFLVRP3E            REP   NOT FOUND                              
*                                                                               
CFLVREPX DS    0H                                                               
*                                                                               
         B     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVPTP'                   
***********************************************************************         
*                                                                     *         
*        POINT PERSON FILTER                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVPTP  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RPTPKREC FIXED VALUE LENGTH                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CHI   RF,L'RPTPKREC       CHECK LENGTH                                 
         JH    CFLVPP1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVPP2E                                                         
*                                                                               
*        VALIDATE POINT PERSON CODE                                             
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   POINT PERSON CODE                            
*                                                                               
*        MAKE SURE POINT PERSON IS ON FILE                                      
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RPTPKEY,R6          ESTABLISH REP PTP KEY                        
*                                                                               
         MVI   RPTPKTYP,RPTPKTYQ   RECORD TYPE                                  
         MVC   RPTPKREP,AGENCY     AGENCY                                       
         MVC   RPTPKREC,CFLTFVAL   POINT PERSON CODE                            
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RPTPKEY,KEYSAVE                                                  
         JNE   CFLVPP3E            POINT PERSON NOT FOUND                       
*                                                                               
CFLVPTPX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVREG'                   
***********************************************************************         
*                                                                     *         
*        REGION FILTER                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVREG  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES              INIT VALUE                          
         MVI   CFLTVLEN,L'RREGKREG          FIXED VALUE LENGTH                  
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CH    RF,=Y(L'RREGKREG)   CHECK LENGTH                                 
         JH    CFLVRG1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVRG2E                                                         
*                                                                               
*        VALIDATE REGION CODE                                                   
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   REGION CODE                                  
*                                                                               
*        MAKE SURE REGION IS ON FILE                                            
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RREGKEY,R6          ESTABLISH REP REG KEY                        
*                                                                               
         MVI   RREGKTYP,RREGKTYQ   RECORD TYPE                                  
         MVC   RREGKREP,AGENCY     AGENCY                                       
         MVC   RREGKREG,CFLTFVAL   REGION CODE                                  
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RREGKEY,KEYSAVE                                                  
         JNE   CFLVRG3E            REGION NOT FOUND                             
*                                                                               
CFLVREGX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVSAL'                   
***********************************************************************         
*                                                                     *         
*        SALESPERSON FILTER                                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVSAL  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVC   CFLTFVAL,SPACES              INIT VALUE                          
         MVI   CFLTVLEN,L'RSALKSAL          FIXED VALUE LENGTH                  
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    R1,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(R1),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    R1,1(R1)               BUMP TO START OF FILTER                   
         BCTR  RF,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         CH    RF,=Y(L'RSALKSAL)   CHECK LENGTH                                 
         JH    CFLVSL1E                                                         
         LTR   RF,RF               MUST HAVE AN ENTRY                           
         JE    CFLVSL2E                                                         
*                                                                               
*        VALIDATE SALESPERSON CODE                                              
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   CFLTFVAL(0),0(R1)   SALESPERSON CODE                             
*                                                                               
*        MAKE SURE SALESPERSON IS ON FILE                                       
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RSALKEY,R6          ESTABLISH REP SAL KEY                        
*                                                                               
         MVI   RSALKTYP,RSALKTYQ   RECORD TYPE                                  
         MVC   RSALKREP,AGENCY     AGENCY                                       
         MVC   RSALKSAL,CFLTFVAL   SALESPERSON CODE                             
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RSALKEY,KEYSAVE                                                  
         JNE   CFLVSL3E            SALESPERSON NOT FOUND                        
*                                                                               
*        CHECK SECURITY                                                         
*                                                                               
         CLI   OFFLINE,C'Y'        SKIP IF OFFLINE                              
         JE    CFLVSALX                                                         
*                                                                               
         CLC   =C'O=',TWAACCS      TEST FOR OFFICE LIMITED ACCESS               
         JNE   CFLVSALX                                                         
*                                                                               
         CLI   TWAOFFC,C'*'        DDS TERMINAL                                 
         JE    CFLVSALX             YES                                         
*                                                                               
         TM    REREQPRF+1,X'40'    SKIP IF NO OFFICE ACCESS RESTRICTION         
         BNO   CFLVSALX                                                         
*                                                                               
         TM    TWAAUTH,X'80'       TERMINAL HAS ACCESS TO ALL OFFICES?          
         JO    CFLVSALX             YES                                         
*                                                                               
*        SECURITY ALL SALESPERSON MUST BE FOR USER'S OFFICE                     
*                                                                               
*        READ SALESPERSON RECORD FOR OFFICE                                     
*                                                                               
         L     R4,AIO1                                                          
         ST    R4,AIO                                                           
*                                                                               
         GOTO1 GETREC              READ RECORD                                  
*                                                                               
         MVI   ELCODE,01                                                        
         BRAS  RE,GETEL                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         USING RSALELEM,R4         ESTABLISH HEADER ELEMENT                     
*                                                                               
         CLC   RSALOFF,TWAACCS+2   SALESPERSON MUST BE IN OFFICE                
         JNE   CFLVSOFE                                                         
*                                                                               
CFLVSALX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6,R4                                                            
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVSTA'                   
***********************************************************************         
*                                                                     *         
*        STATION FILTER                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVSTA  DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
*                                                                               
         SR    R0,R0                                                            
         IC    R0,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    RF,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(RF),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    RF,1(RF)               BUMP TO START OF FILTER                   
         BCTR  R0,0                   DECREMENT FILTER LENGTH                   
*                                                                               
*        VALIDATE STATION CALL LETTERS                                          
*                                                                               
         LA    RE,CFLTFVAL         STATION SAVE AREA                            
         MVC   CFLTFVAL,SPACES     INIT VALUE                                   
         MVI   CFLTVLEN,L'RSTAKSTA FIXED VALUE LENGTH                           
*                                                                               
CFLVSTLP DS    0H                                                               
*                                                                               
         CLI   0(RF),C'-'          IF '-' FOUND                                 
         JNE   CFLVSTCN                                                         
*                                                                               
         CHI   R0,3                MAX 2 CHARACTERS LEFT '-' AND BAND           
         JH    CFLVERR                                                          
*                                                                               
         LA    RF,1(RF)               SKIP THE '-'                              
*                                                                               
         LA    RE,CFLTFVAL+4          BAND MUST GO HERE                         
*                                                                               
         BRCT  R0,*+8                 LESS 1 ON IPT LEN (THE '-')               
         J     CFLVSTDN               NOTHING AFTER THE '-' (WABC- )            
*                                                                               
CFLVSTCN DS    0H                                                               
*                                                                               
         MVC   0(1,RE),0(RF)       MOVE NEXT BYTE TO SAVEAREA                   
         LA    RE,1(RE)            BUMP SAVEAREA POINTER                        
         LA    RF,1(RF)            BUMP INPUT POINTER                           
         BRCT  R0,CFLVSTLP                                                      
*                                                                               
CFLVSTDN DS    0H                                                               
*                                                                               
*- IF BAND = 'T' (TELEVISION) THEN BLANK OUT BAND IN KEY.                       
*                                                                               
         CLI   CFLTFVAL+4,C'T'                                                  
         JNE   *+8                                                              
         MVI   CFLTFVAL+4,C' '                                                  
*                                                                               
*        MAKE SURE STATION IS ON FILE                                           
*                                                                               
         XC    KEY,KEY                                                          
         LA    R6,KEY                                                           
         USING RSTAKEY,R6          ESTABLISH REP STATION KEY                    
*                                                                               
         MVI   RSTAKTYP,RSTAKTYQ   RECORD TYPE                                  
         MVC   RSTAKREP,AGENCY     AGENCY                                       
         MVC   RSTAKSTA,CFLTFVAL   STATION CALL LETTERS                         
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         CLC   RSTAKEY,KEYSAVE                                                  
         JNE   CFLVERR             STATION NOT FOUND                            
*                                                                               
CFLVSTAX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVCST'                   
***********************************************************************         
*                                                                     *         
*        FLOWCHARTING BY COMPETITIVE STATIONS                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVCST  DS    0H                                                               
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,1(R4)          EXPRESSION LENGTH                            
         JZ    CFLVCSNE            NOTHING ENTERED                              
*                                                                               
         LA    RF,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         LR    R1,RF               GET FIRST STATION RELATIVE NUMBER            
*                                                                               
         CLI   0(RF),C'-'          LOOK FOR SEPARATOR                           
         JE    *+20                                                             
         CLI   0(RF),C'0'          MUST BE NUMERIC                              
         JL    CFLVCSNM                                                         
         LA    RF,1(RF)            BUMP POINTER                                 
         BRCT  R0,*-20                                                          
*                                                                               
         SR    RF,R1               LENGTH OF EXPRESSION                         
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         PACK  DUB,0(0,R1)         PACK NUMBER                                  
*                                                                               
         CVB   RE,DUB                                                           
         STC   RE,STFLWSTR         SAVE START OF STATION FLOW                   
         OI    STACKSW,STCKSTFQ    STATION FLOWCHARTING IN EFFECT               
         LR    R2,RE               SAVE START OF FLOW                           
*                                                                               
         LTR   R0,R0               CHECK ON END OF EXPRESSION                   
         JZ    CFLVCSF3            SINGLE ENTRY                                 
*                                                                               
         LA    RF,2(RF,R1)         NEXT INPUT POSITION PAST '-'                 
         LR    R1,RF               SAVE STARTING POSITION                       
         BRCT  R0,*+8              RECTIFY LENGTH COUNTER                       
         J     CFLVCS2E            NO SECOND NUMBER                             
*                                                                               
         CLI   0(RF),C'0'          MUST BE NUMERIC                              
         JL    CFLVCSNM                                                         
         LA    RF,1(RF)            BUMP POINTER                                 
         BRCT  R0,*-12                                                          
*                                                                               
         SR    RF,R1               LENGTH OF EXPRESSION                         
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                ESTABLISH WHERE WE ARE                       
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         PACK  DUB,0(0,R1)         PACK NUMBER                                  
*                                                                               
         CVB   RE,DUB                                                           
         STC   RE,STFLWEND         SAVE END OF STATION FLOW                     
*                                                                               
         CR    R2,RE               MUST BE EQUAL OR LARGER THAN 1ST             
         JH    CFLVCS3E                                                         
*                                                                               
         SR    RE,R2                                                            
         AHI   RE,1                CORRECT COUNT                                
*                                                                               
         STC   RE,FCHRTITR         CONTAINS ITERATION COUNTER                   
*                                                                               
CFLVCSF3 DS   0H                                                                
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVYTD'                   
***********************************************************************         
*                                                                     *         
*        YTD SUMS                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVYTD  DS    0H                                                               
*                                                                               
         TM    REQCFOPT,REQCFYTQ   IF YTD FLAG NOT SET                          
         BO    CFLVYTD1                                                         
*                                                                               
         GOTO1 =A(YTDSET),RR=RELORGEN SET YTD IN OPTIONS FIELD                  
*                                                                               
CFLVYTD1 DS    0H                                                               
*                                                                               
         OI    DRARGSI+8,X'80'     INDICATE A YTD COLUMN                        
*                                                                               
CFLVYTDX DS    0H                                                               
*                                                                               
         J     CFLVCFLX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVBKB'                   
***********************************************************************         
*                                                                     *         
*        BACK BILLING OPTIONS                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVBKB  DS    0H                                                               
*                                                                               
*        CHECK FOR HELP REQUEST                                                 
*                                                                               
         CLI   22(R4),C'+'         IF HELP REQUESTED                            
         JNE   CFLVBKHX                                                         
*                                                                               
         GOTO1 VREHELP,DMCB,=AL2(RKQHMBKB),(R2),HELPCBLK PUT OUT HELP           
*                                                                               
         DC    H'0'                SHOULD NEVER COME BACK                       
*                                                                               
CFLVBKHX DS    0H                                                               
*                                                                               
         MVC   CFLTQTIC,VLTICODE            SAVE FILTER TYPE                    
         MVI   CFLTVLEN,L'VLTICODE          FIXED VALUE LENGTH                  
*                                                                               
*        BACKBILL COLUMN FILTERING MAKES SENSE ONLY                             
*        IF WHOLE REPORT INCLUDES BACKBILLING                                   
*                                                                               
         CLI   REFBKBOP,C'I'       OKAY IF BACK BILLING INCLUDED IN RPT         
         JE    CFLVBKB5                                                         
*                                                                               
         CLI   REREPPRF+15,C'B'    ERROR IF REP EXCLUDES BACKBILLING            
         JE    CFLVBKRQ                                                         
*                                                                               
         CLI   REFBKBOP,C'X'       ERROR IF RPT EXCLUDES BACKBILLING            
         JE    CFLVBKRQ                                                         
*                                                                               
         CLI   REFBKBOP,C'O'       ERROR IF RPT ONLY FOR BACKBILLING            
         JE    CFLVBKRQ                                                         
*                                                                               
CFLVBKB5 DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS                                                      
         USING VLPARMS,R1          ESTABLISH DDVAL PARAMETERS                   
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',=AL2(RKQBKBOP)),                 X        
               (1(R4),22(R4)),AVLTAB,0,0,0                                      
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   CFLVBKNV                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH VALIDATION TABLE                   
*                                                                               
         MVC   CFLTFVAL(L'VLTICODE),VLTICODE    BACK BILLING OPTION             
*                                                                               
CFLVBKBX DS    0H                                                               
*                                                                               
         J     CFLVEXTX                                                         
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLVCFLX'                  
***********************************************************************         
*                                                                     *         
*        END OF COLUMN FILTER VALIDATION                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLVCFLX DS    0H                                                               
*                                                                               
*        ISSUE WARNING IF FILTER HAS QUALIFYING DATA                            
*        BUT DOESN'T EXPECT IT. IE IS FOLLOWED BY '='                           
*        BUT IS STAND ALONE FILTER                                              
*                                                                               
*        DOESN'T WORK IF DDVAL USED TO VALIDATE SECOND HALF                     
****                                                                            
****     CLI   1(R4),0             IF SECOND HALF OF FILTER GIVEN               
****     BE    CFLVEXTX                                                         
****                                                                            
****     SR    RF,RF                                                            
****     ICM   RF,1,VLTLFULL       GET FILTER NAME LENGTH                       
****     BZ    CFLVEXTX            SHOULDN'T HAPPEN                             
****                                                                            
****     LA    R1,VLTFULL-1(RF)    POINT TO LAST BYTE OF NAME                   
****                                                                            
****     LOOK FOR EQUAL SIGN                                                    
****                                                                            
****     CLI   0(R1),C'='                                                       
****     BE    CFLVEXTX            FOUND - EVRYTHING IS KOSHER                  
****     BCTR  R1,0                BACK UP A POSITION                           
****     BCT   RF,*-10                                                          
****                                                                            
****     J     CFLVEQUE            EXTRANEOUS DATA IN FILTER                    
****                                                                            
CFLVEXTX DS    0H                                                               
*                                                                               
         CLI   VLTICODE,RKQWRCFM   SKIP IF FORMAT INSTRUCTION                   
         JE    CFLVFHDX                                                         
*                                                                               
*        ADD FILTER TO COLUMN HEADLINES                                         
*                                                                               
         LA    R1,DRH1ALL          FIND FIRST UNUSED HEADLINE                   
         LA    R0,4                MAX 4 HEADLINES                              
*                                                                               
         CLC   DRH1LIT-DRH1ALL(L'DRH1LIT,R1),SPACES USE IF NO LIT YET           
         JNH   *+16                                                             
         LA    R1,L'DRH1ALL(R1)    BUMP TO NEXT HEADLINE                        
         BRCT  R0,*-14                                                          
         J     CFLVFHDX            ALL HEADLINES USED                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,0(R4)            FILTER ID WIDTH                              
         CLM   RF,1,DRLENO         DEFAULT TO COLUMN WIDTH                      
         JNH   *+8                                                              
         IC    RF,DRLENO           COLUMN WIDTH                                 
*                                                                               
         STC   RF,DRH1LITL-DRH1ALL(R1) SET HEADLINE LITERAL LENGTH              
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   DRH1LIT-DRH1ALL(0,R1),12(R4) ADD TO HEADLINES                    
*                                                                               
         CLI   1(R4),0             SKIP IF NO VALUE FOR ID                      
         JE    CFLVFHD1                                                         
*                                                                               
         LA    RE,DRH1LIT+1-DRH1ALL(RF,R1) NEXT OUTPUT POSITION                 
*                                                                               
         MVC   0(1,RE),SCANSEP     COMPARATIVE OPERATOR                         
         LA    RE,1(RE)            BUMP OUTPUT POINTER                          
*                                                                               
         SR    R7,R7                                                            
         IC    R7,DRLENO           COLUMN WIDTH                                 
         SR    R7,RF               CALCULATE WIDTH LEFT                         
         AHI   R7,-2                                                            
*                                                                               
         CLM   R7,1,1(R4)          IF NO ROOM ON CURRENT LINE                   
         JNL   CFLTLITX                                                         
*                                                                               
         CHI   R0,1                AND THERE IS ANOTHER LINE AVAILABLE          
         JNH   CFLTLITX                                                         
*                                                                               
         LA    RF,DRH1LIT-DRH1ALL(R1)                                           
         SR    RE,RF                                                            
         STC   RE,DRH1LITL-DRH1ALL(R1) UPDATE CURRENT HEADLINE LENGTH           
         MVC   DRHEAD1-DRH1ALL(L'DRHEAD1,R1),DRHEAD1 COPY STATUS OF 1ST         
*                                                                               
         LA    R1,L'DRH1ALL(R1)       BUMP TO NEXT LINE                         
         LA    RE,DRH1LIT-DRH1ALL(R1) RESET OUTPUT POSITION                     
         BCTR  R0,0                   DECREMENT LINE COUNTER                    
         IC    R7,DRLENO              USE TOTAL COLUMN WIDTH                    
*                                                                               
CFLTLITX DS    0H                                                               
*                                                                               
         IC    RF,1(R4)            VALUE LENGTH                                 
         CR    RF,R7               MAKE SURE IT FITS                            
         JNH   *+6                                                              
         LR    RF,R7                                                            
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         J     *+10                                                             
         MVC   0(0,RE),22(R4)      DISPLAY VALUE                                
*                                                                               
         LA    RE,2(RF,RE)         NEXT AVAILABLE POSITION                      
         LA    RF,DRH1LIT-DRH1ALL(R1)                                           
         SR    RE,RF               HEADLINE LENGTH                              
         STC   RE,DRH1LITL-DRH1ALL(R1) UPDATE HEADLINE LENGTH                   
*                                                                               
CFLVFHD1 DS    0H                                                               
*                                                                               
         MVC   DRHEAD1-DRH1ALL(L'DRHEAD1,R1),DRHEAD1 COPY STATUS OF 1ST         
*                                                                               
         J     CFLVFHDX                                                         
*                                                                               
CFLVFHDX DS    0H                                                               
*                                                                               
*        ADD COLUMN FILTER TO COLUMN FILTER SAVEAREA                            
*                                                                               
         MVC   DRARGSI+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         CLI   DRNARGSI,7          UPDATE NUMBER OF ARGUMENTS IF NEEDED         
         JNL   *+8                                                              
         MVI   DRNARGSI,7                                                       
*                                                                               
         MVC   DRARGSO+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         CLI   DRNARGSO,7          UPDATE NUMBER OF ARGUMENTS IF NEEDED         
         JNL   *+8                                                              
         MVI   DRNARGSO,7                                                       
*                                                                               
         L     R7,AFLTTAB          POINT TO FILTER SAVEAREAS                    
*                                                                               
         SR    RE,RE                                                            
         IC    RE,KEYWORD#         KEYWORD NUMBER                               
         BCTR  RE,0                DECREMENT FOR INDEXING                       
         LA    RF,FTBENTL          FILTER AREA LENGTH                           
         MR    RE,RE               INDEX INTO FILTER AREA                       
         LA    R7,0(RF,R7)         AREA FOR THIS KEYWORD                        
*                                                                               
         USING FLTTABD,R7          ESTABLISH FILTER SAVEAREA                    
*                                                                               
         CLC   =AL2(RKQCFMAJ),VLTICODE  IF MAJOR STACK FIELD                    
         JNE   *+12                                                             
         OI    DRARGSI+5,X'02'             SET INDICATOR                        
         J     CFLTVALX                                                         
*                                                                               
         USING FLTAREA,R7          ESTABLISH FILTERS SAVEAREA                   
*                                                                               
         LA    R6,FLTCTL           POINT TO FIRST FILTER IN AREA                
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,FLTFNO         GET NUMBER OF FILTERS SO FAR                 
         JZ    CFLVFL10                                                         
*                                                                               
         SR    RF,RF                                                            
         USING FLTCTL,R6           ESTABLISH FILTER                             
*                                                                               
         ICM   RF,1,FLTFVLEN       GET LENGTH OF FILTER                         
         LA    R6,FLTFVAL(RF)      BUMP TO NEXT FILTER                          
         BRCT  RE,*-8                                                           
*                                                                               
CFLVFL10 DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,FLTFNO           ADD ONE TO FILTER COUNTER                    
         LA    RF,1(RF)                                                         
         STC   RF,FLTFNO                                                        
*                                                                               
         L     R1,AVLTAB           POINT TO DDVAL TABLE ENTRY                   
*                                                                               
         MVC   FLTFTIC,CFLTQTIC    SET FILTER TYPE                              
         MVI   FLTCTL,FLTEQQ       SET FOR EQUALITY                             
*                                                                               
         CLI   SCANSEP,C'<'        IF FILTER STARTS WITH '<'                    
         JNE   *+8                                                              
         MVI   FLTCTL,FLTLTQ          SET FOR LESS THAN                         
*                                                                               
         CLI   SCANSEP,C'>'        IF FILTER STARTS WITH '>'                    
         JNE   *+8                                                              
         MVI   FLTCTL,FLTGTQ          SET FOR LESS THAN                         
*                                                                               
         CLI   12(R4),C'-'         IF FILTER STARTS WITH '-'                    
         JE    *+8                                                              
         CLI   22(R4),C'-'                                                      
         JNE   *+8                                                              
         OI    FLTCTL,FLTNOTQ         SET FOR INEQUALITY                        
*                                                                               
         CLI   CFLTVLEN,0          IF FILTER VALUE KNOWN                        
         JE    CFLVFL15                                                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,CFLTVLEN          FILTER VALUE LENGTH                       
         STC   RF,FLTFVLEN            SET  FILTER VALUE LENGTH                  
*                                                                               
         BCTR  RF,0                   DECREMENT FOR EXECUTE                     
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   FLTFVAL(0),CFLTFVAL    FILTER VALUE                              
*                                                                               
         J     CFLVFL30                                                         
*                                                                               
CFLVFL15 DS    0H                                                               
*                                                                               
         TM    VLTIND-VLTABD(R1),VLTNSLNQ IF STANDARD ICODE                     
         JO    CFLVFL20                                                         
*                                                                               
         MVI   FLTFVLEN,2          FILTER VALUE IS 2 BYTES                      
         MVC   FLTFVAL(2),VLTICODE-VLTABD(R1)  SAVE FILTER VALUE                
*                                                                               
         J     CFLVFL30                                                         
*                                                                               
CFLVFL20 DS    0H                                                               
*                                                                               
         MVC   FLTFVLEN,VLTEXTRA-VLTABD(R1)  LENGTH AT VLTEXTRA                 
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,VLTEXTRA-VLTABD(R1) FILTER VALUE LENGTH                     
         JZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         MVC   FLTFVAL(0),VLTEXTRA+1-VLTABD(R1) SAVE FILTER VALUE               
*                                                                               
CFLVFL30 DS    0H                                                               
*                                                                               
         J     CFLTVALX                                                         
*                                                                               
         DROP  R5                                                               
*                                                                               
CFLVERR  DS    0H                                                               
*                                                                               
         XC    CFLTQTIC,CFLTQTIC   CLEAR FILTER ICODE                           
*                                                                               
CFLTVALX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         EJECT                                                                  
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
CFLVAD1E DS    0H                  ADVERTISER CODE TOO LARGE                    
         LHI   RF,RWEADVLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAD2E DS    0H                  ADVERTISER CODE MISSING                      
         LHI   RF,RWEADVMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAD3E DS    0H                  ADVERTISER NOT FOUND                         
         LHI   RF,RWEADVNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAG1E DS    0H                  AGENCY     CODE TOO LARGE                    
         LHI   RF,RWEAGYLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAG2E DS    0H                  AGENCY     CODE MISSING                      
         LHI   RF,RWEAGYMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAG3E DS    0H                  AGENCY OFFICE   MISSING                      
         LHI   RF,RWEAOFMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAG4E DS    0H                  AGENCY OFFICE CODE TOO LARGE                 
         LHI   RF,RWEAOFLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAG5E DS    0H                  AGENCY NOT ON FILE                           
         LHI   RF,RWEAGYNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVBKNV DS    0H                  BACK BILLING OPTION INVALID                  
         LHI   RF,RWEBKBNV                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVBKRQ DS    0H                  BACK BILLING REQUIRED                        
         LHI   RF,RWEBKBRQ                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVMK2E DS    0H                  MARKET CODE MISSING                          
         LHI   RF,RWEMKTMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVMK3E DS    0H                  MARKET NOT FOUND                             
         LHI   RF,RWEMKTNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOF1E DS    0H                  OFFICE CODE TOO LARGE                        
         LHI   RF,RWEOFFLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOF2E DS    0H                  OFFICE CODE MISSING                          
         LHI   RF,RWEOFFMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOF3E DS    0H                  OFFICE NOT FOUND                             
         LHI   RF,RWEOFFNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOW1E DS    0H                  OWNER CODE TOO LARGE                         
         LHI   RF,RWEOWNLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOW2E DS    0H                  OWNER CODE MISSING                           
         LHI   RF,RWEOWNMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOW3E DS    0H                  OWNER NOT FOUND                              
         LHI   RF,RWEOWNNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVDMNE DS    0H                  DEM CODE REQUIRED                            
         LHI   RF,RWEDEMMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVDMNV DS    0H                  DEM CODE INVALID                             
         LHI   RF,RWEDEMNV                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVAFNV DS    0H                  AFF CODE INVALID                             
         LHI   RF,RWEAFFNV                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVTM1E DS    0H                  TEAM CODE TOO LARGE                          
         LHI   RF,RWETEMLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVTM2E DS    0H                  TEAM CODE MISSING                            
         LHI   RF,RWETEMMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVTM3E DS    0H                  TEAM NOT FOUND                               
         LHI   RF,RWETMNF                                                       
         J     CFLVERR1                                                         
*                                                                               
CFLVGP1E DS    0H                  GROUP CODE TOO LARGE                         
         LHI   RF,RWEGRPLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVGP2E DS    0H                  GROUP CODE MISSING                           
         LHI   RF,RWEGRPMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVGP3E DS    0H                  GROUP NOT FOUND                              
         LHI   RF,RWEGRPNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVRP1E DS    0H                  REP CODE TOO LARGE                           
         LHI   RF,RWEREPLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVRP2E DS    0H                  REP CODE MISSING                             
         LHI   RF,RWEREPMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVRP3E DS    0H                  REP NOT FOUND                                
         LHI   RF,RWEREPNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVPP1E DS    0H                  POINT PERSON CODE TOO LARGE                  
         LHI   RF,RWEPTPLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVPP2E DS    0H                  POINT PERSON CODE MISSING                    
         LHI   RF,RWEPTPMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVPP3E DS    0H                  POINT PERSON NOT FOUND                       
         LHI   RF,RWEPTPNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVRG1E DS    0H                  REGION CODE TOO LARGE                        
         LHI   RF,RWEREGLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVRG2E DS    0H                  REGION CODE MISSING                          
         LHI   RF,RWEREGMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVRG3E DS    0H                  REGION NOT FOUND                             
         LHI   RF,RWEREGNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVSL1E DS    0H                  SALESPERSON CODE TOO LARGE                   
         LHI   RF,RWESALLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVSL2E DS    0H                  SALESPERSON CODE MISSING                     
         LHI   RF,RWESALMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVSL3E DS    0H                  SALESPERSON NOT FOUND                        
         LHI   RF,RWESALNF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCSNE DS    0H                  STATION FLOWCHART EXPRESSION MISSING         
*                                                                               
         LHI   RF,RWESFREQ                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCSNM DS    0H                  ENTRY MUST BE NUMERIC                        
*                                                                               
         LHI   RF,RWESFNUM                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCS2E DS    0H                  SECOND NUMBER REQUIRED                       
*                                                                               
         LHI   RF,RWESF2RQ                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCS3E DS    0H                  START NUMBER GREATER THAN END NUMBER         
*                                                                               
         LHI   RF,RWESFR3E                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCT1E DS    0H                  CODE TOO LARGE                               
*                                                                               
         LHI   RF,RWECTYLN                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCT2E DS    0H                  CODE REQUIRED                                
*                                                                               
         LHI   RF,RWECTYMS                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVCT3E DS    0H                  CODE NOT VALID                               
*                                                                               
         LHI   RF,RWECTYNV                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVYTDE DS    0H                  REQUEST PERIOD SPANS JANUARY                 
*                                                                               
         LHI   RF,RWEYTDER                                                      
         J     CFLVERR1                                                         
*                                                                               
VCCDMSE DS     0H                  CREATION DATE RANGE REQUIRED                 
         LHI   RF,RWECCDMS         SET ERROR CODE                               
         J     CFLVERR1                                                         
*                                                                               
VCCDNVE DS     0H                  CREATION DATE INVALID                        
         LHI   RF,RWECCDNV         SET ERROR CODE                               
         J     CFLVERR1                                                         
*                                                                               
VCCD2E  DS     0H                  CREATION DATE START BEFORE END               
         LHI   RF,RWECCD2E         SET ERROR CODE                               
         J     CFLVERR1                                                         
*                                                                               
CFLVSOFE DS    0H                  SALESPERSON MUST BE FOR OFFICE               
         LHI   RF,RWESPOFF                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVEQUE DS    0H                  EXTRANEOUS DATA FOR COLUMN FILTER            
         LHI   RF,RWECFLEQ                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVOFCE DS    0H                  SECURITY LOCKOUT                             
         LHI   RF,RWEOFFLK                                                      
         J     CFLVERR1                                                         
*                                                                               
CFLVERR1 DS    0H                                                               
*                                                                               
         STCM  RF,3,RERROR         SET ERROR CODE                               
         XC    CFLTQTIC,CFLTQTIC   CLEAR FILTER ICODE                           
         GOTO1 CURSERR                                                          
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRGEN - VALIDATE COLUMN FILTERS - CFLTINIT'                  
***********************************************************************         
*                                                                     *         
*        COLUMN FILTER CALIDATION INITIALIZATION                      *         
*                                                                     *         
*NTRY    R4 ==>   SCANNER BLOCK                                       *         
*                                                                     *         
*EXIT    CFLTQTIC - INTERNAL CODE FOR COLUMN FILTER                   *         
*                   NULLS IF INVALID FILTER                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
CFLVINIT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING GEND,RC                                                          
         USING SUBSYSD,R9                                                       
         USING T830FFD,RA                                                       
*                                                                               
         XC    CFLTQTIC,CFLTQTIC   INIT FILTER INTERNAL CODE                    
         XC    CFLTFVAL,CFLTFVAL   INIT FILTER VALUE                            
*                                                                               
*        INIT VLBLOCK FOR DDVAL                                                 
*                                                                               
         SR    R0,R0                                                            
         IC    R0,0(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    RF,12(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(RF),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    RF,1(RF)               BUMP TO START OF FILTER                   
         BCTR  R0,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         LA    R1,RKQWRCFL                                                      
         STCM  R1,3,CFLTQTIC          INIT FILTER INTERNAL CODE                 
         MVI   CFLTVLEN,0             INIT VALUE LENGTH                         
         XC    CFLTFVAL,CFLTFVAL      INIT VALUE                                
*                                                                               
         L     R1,AVLPARMS                                                      
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',CFLTQTIC),                       X        
               ((R0),(RF)),AVLTAB,0,0,0                                         
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   CFLVIERR                                                         
*                                                                               
         L     RF,AVLTAB           POINT TO RETURNED TABLE ENTRY                
*                                                                               
         TM    VLTIND-VLTABD(RF),VLTCHLDQ SKIP IF ENTRY HAS NO CHILDREN         
         JNO   CFLVFLT1                                                         
*                                                                               
         MVC   CFLTQTIC,VLTICODE-VLTABD(RF)    SAVE FILTER TYPE                 
*                                                                               
         SR    R0,R0                                                            
         IC    R0,1(R4)            GET FILTER LENGTH                            
*                                                                               
         LA    RF,22(R4)           POINT TO START OF FILTER                     
*                                                                               
         CLI   0(RF),C'-'          IF FILTER STARTS WITH MINUS SIGN             
         JNE   *+10                                                             
         LA    RF,1(RF)               BUMP TO START OF FILTER                   
         BCTR  R0,0                   DECREMENT FILTER LENGTH                   
*                                                                               
         L     R1,AVLPARMS                                                      
         GOTO1 VDDVAL,(R1),('VLPVALQ',CFLTQTIC),                       X        
               ((R0),(RF)),AVLTAB,0,0,0                                         
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         JNE   CFLVIERR                                                         
*                                                                               
CFLVFLT1 DS    0H                                                               
*                                                                               
         CR    RB,RB               SET EQ CC                                    
*                                                                               
         B     CFLVINIX                                                         
*                                                                               
CFLVIERR DS    0H                                                               
*                                                                               
         XC    CFLTQTIC,CFLTQTIC   CLEAR FILTER ICODE                           
*                                                                               
         LTR   RB,RB               SET NEQ CC                                   
*                                                                               
CFLVINIX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWR00  - SET YTD IN OPTIONS - YTDSET'                         
***********************************************************************         
*                                                                     *         
*        SET 'YTD' IN OPTIONS FIELD                                   *         
*        WRITER MUST KNOW ABOUT YTD OPTION BEFORE                     *         
*        IT VALIDATES PERIOD AND BUILDS DATE LISTS                    *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*EXIT                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
YTDSET   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING GEND,RC                                                          
         USING SUBSYSD,R9                                                       
         USING T830FFD,RA                                                       
*                                                                               
         L     R2,REOPTA           POINT TO OPTIONS FIELD                       
         LHI   R0,2                MAC 2 OPTIONS FIELDS                         
*                                                                               
*        FIND OPTIONS FIELD WITH ROOM FOR YTD OPTION                            
*                                                                               
YTDSRMLP DS    0H                                                               
*                                                                               
         SR    RF,RF               GET LENGTH OF INPUT                          
         IC    RF,5(R2)                                                         
*                                                                               
         SR    RE,RE                                                            
         IC    RE,0(R2)            LENGTH OF OPTIONS FIELD                      
         AHI   RE,-8               LENGTH OF HEADER                             
         AHI   RE,-8               LENGTH OF TRAILER                            
*                                                                               
         SR    RE,RF               SPACE REMAINING IN FIELD                     
*                                                                               
         CHI   RE,4                THERE MUST BE ROOM FOR YTD OPTION            
         BH    YTDSRMFD                                                         
*                                                                               
YTDSRMCN DS    0H                                                               
*                                                                               
         BRAS  RE,BUMPTOUN         BUMP TO NEXT UNPROTECTED FIELD               
         BCT   R0,YTDSRMLP                                                      
*                                                                               
         DC    H'0'                SHOULD RARELY HAPPEN                         
*                                                                               
YTDSRMFD DS    0H                  ROOM IN FIELD FOR YTD                        
*                                                                               
         LA    R1,8(RF,R2)         POINT TO FIRST AVAILABLE SPACE               
*                                                                               
         LTR   RF,RF               IF SOMETHING THERE ALREADY                   
         BZ    *+16                                                             
         MVI   0(R1),C','             SET SEPARATING COMMA                      
         LA    R1,1(R1)               BUMP POINTER                              
         AHI   R5,1                   BUMP LENGTH COUNTER                       
*                                                                               
         MVC   0(3,R1),=C'YTD'     SET OPTION IN FIELD                          
*                                                                               
         AHI   RF,3                BUMP FIELD LENGTH                            
         STC   RF,5(R2)                                                         
*                                                                               
         OI    6(R2),X'80'         FORCE RE-TRANSMISSON OF FIELD                
*                                                                               
         OI    REQCFOPT,REQCFYTQ   INDICATE YTD OPTION IN PLAY                  
*                                                                               
YTDSETX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWR00  - VALIDATE KEYWORD FILTERS - TBLLST'                   
***********************************************************************         
*                                                                     *         
*        BUILD LIST OF TABLES NEEDED FOR REPORT                       *         
*                                                                     *         
*NTRY    P1    AL1(RECORD TYPE FOR TABLE)                             *         
*              AL3(0)                                                 *         
*                                                                     *         
*EXIT    ID ADDED TO REDATA IF IT IS NEW                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
TBLLST   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING GEND,RC                                                          
         USING SUBSYSD,R9                                                       
         USING T830FFD,RA                                                       
*                                                                               
         SR    R2,R2                                                            
         ICM   R2,1,0(R1)          GET RECORD TYPE                              
*                                                                               
         BAS   RE,ADDTYP           ADDED RECORD TYPE TO LIST                    
         BNZ   TBLLSTX             DONE - ALREADY IN TABLE                      
*                                                                               
         LA    R3,XTRALST          POINT TO OTHER RECORDS TABLE                 
*                                                                               
TBLLST1L DS    0H                                                               
*                                                                               
         CLI   0(R3),X'FF'         END OF TABLE                                 
         BE    TBLLST1D                                                         
*                                                                               
         CLM   R2,1,0(R3)          CHECK IF THIS RECTYPE HAS                    
         BE    TBLLST1F              ENTRY IN TABLE                             
*                                                                               
TBLLST1C DS    0H                                                               
*                                                                               
         LA    R3,L'XTRALST(R3)    BUMP TO NEXT ENTRY IN LIST                   
         B     TBLLST1L                                                         
*                                                                               
TBLLST1D DS    0H                                                               
*                                                                               
         B     TBLLSTX             RECORD TYPE NOT IN TABLE                     
*                                                                               
TBLLST1F DS    0H                                                               
*                                                                               
         LA    R3,1(R3)            POINT TO FIRST OF OTHER RECORD TYPES         
         LA    R4,7                MAX NUMBER OF OTHER RECORD TYPES             
*                                                                               
TBLLST2L DS    0H                                                               
*                                                                               
         ICM   R2,1,0(R3)          GET NEXT NEEDED REC TYPE                     
         BZ    TBLLST2D            END OF TABLE                                 
*                                                                               
         BAS   RE,ADDTYP           ADD TO LIST                                  
*                                                                               
TBLLST2C DS    0H                                                               
*                                                                               
         LA    R3,1(R3)            BUMP TO NEXT ENTRY IN LIST                   
         BCT   R4,TBLLST2L                                                      
*                                                                               
TBLLST2D DS    0H                                                               
*                                                                               
         B     TBLLSTX             RECORD TYPE NOT IN TABLE                     
*                                                                               
TBLLSTX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
*        TABLE OF RECORD TYPES NEEDED FOR CURRENT ONE                           
*        TO BE FOUND                                                            
*                                                                               
*        AL1(RECORD TYPE BEING PROCESSED)                                       
*        7*AL1(RECORD TYPES NEEDED FOR THIS ONE                                 
*                                                                               
XTRALST  DS    0D                                                               
         DC    AL1(RCLSKTYQ,RCTGKTYQ,RPRDKTYQ,RADVKTYQ,0,0,0,0) CLASS           
         DC    AL1(RCTGKTYQ,RPRDKTYQ,RADVKTYQ,0,0,0,0,0)  CATEGORY              
         DC    AL1(RPTPKTYQ,RPRDKTYQ,RADVKTYQ,0,0,0,0,0)  PT PERSON             
         DC    X'FF'               END OF TABLE                                 
*                                                                               
         EJECT                                                                  
*                                                                               
*        ADD RECORD TYPE TO REDATA LIST                                         
*                                                                               
*        R2  HAS RECORD TYPE TO BE ADDED                                        
*                                                                               
ADDTYP   DS    0H                                                               
*                                                                               
         LA    R1,REDATA           LIST OF RECORD TYPES NEED FOR REPORT         
         LA    R0,L'REDATA         MAX LENGTH OF LIST                           
*                                                                               
         LA    RF,1                DEFAULT TO ALREADY IN LIST                   
*                                                                               
         CLI   0(R1),0             IF END OF LIST REACHED                       
         BE    *+22                   GO ADD TO LIST                            
         CLM   R2,1,0(R1)          IF ALREADY IN LIST                           
         BE    ADDTYPX                NO NEED TO ADD TO LIST                    
         LA    R1,1(R1)            BUMP LIST POINTER                            
         BCT   R0,*-20                                                          
         DC    H'0'                ENLARGE LIST STORAGE AREA                    
*                                                                               
         STCM  R2,1,0(R1)          ADD TO LIST                                  
         SR    RF,RF               INDICATE NEW TO LIST                         
*                                                                               
ADDTYPX  DS    0H                                                               
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWR00  - VALIDATE KEYWORD FILTERS - FLTRVAL'                  
***********************************************************************         
*                                                                     *         
*        USE DDVAL TO VALIDATE FILTER VALUES FOR KEYWORD              *         
*                                                                     *         
*NTRY    R4 ==>   SCANNER BLOCK                                       *         
*                                                                     *         
*EXIT    CFLTQTIC - INTERNAL CODE FOR KEYWORD VALUE                   *         
*                   NULLS IF INVALID VALUE                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
FLTRVAL  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING GEND,RC                                                          
         USING SUBSYSD,R9                                                       
         USING T830FFD,RA                                                       
*                                                                               
         CLI   1(R4),0             SKIP IF NOTHING IN 2ND PART                  
         BE    FLTROK                                                           
*                                                                               
         XC    CFLTQTIC,CFLTQTIC   INIT FILTER INTERNAL CODE                    
*                                                                               
***********************************************************************         
*                                                                     *         
*        CHECK IF KEYWORD ALLOWS FILTERING ON VALUES                  *         
*                                                                     *         
*        AN 'X' IN ATTRIBUTES INDICATES NEXT BYTE IS                  *         
*        INTERNAL CODE FOR VALUES TABLE                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         LA    R0,L'DRATTRIB       NUMBER OF ATTRIBUTES                         
         LA    R1,DRATTRIB         START OF ATTRIBUTES                          
*                                                                               
         CLI   0(R1),C'X'          LOOK FOR 'X'                                 
         BE    *+16                                                             
         LA    R1,1(R1)            BUMP TO NEXT ATTRIBUTE                       
         BCT   R0,*-12                                                          
         B     FLTROK              NO VALUES ALLOWED                            
*                                                                               
         MVC   CFLTQTIC+1(1),1(R1)   COPY INTERNAL CODE FOR TABLE               
*                                                                               
         MVI   BYTE,FLTEQQ         DEFAULT TO EQUALITY                          
*                                                                               
         CLI   SCANSEP,C'<'        IF SEPARATOR IS LESS THAN                    
         BNE   *+12                                                             
         MVI   BYTE,FLTLTQ         SET FILTER CONTROL BYTE                      
         B     FLTRSEPF                                                         
*                                                                               
         CLI   SCANSEP,C'>'        IF SEPARATOR IS GREATER THAN                 
         BNE   *+12                                                             
         MVI   BYTE,FLTGTQ         SET FILTER CONTROL BYTE                      
         B     FLTRSEPF                                                         
*                                                                               
FLTRSEPF DS    0H                                                               
*                                                                               
FLTRFLT  DS    0H                                                               
*                                                                               
         SR    R0,R0                                                            
         IC    R0,1(R4)            LENGTH OF SECOND PART OF BLOCK               
         LA    RF,22(R4)           START OF SECOND PART OF BLOCK                
*                                                                               
         CLI   0(RF),C'-'          IF NEGATIVE SIGN STARTS RESULT               
         BNE   *+14                                                             
         OI    BYTE,FLTNOTQ           SET INEQUALITY INDICATOR                  
         BCTR  R0,0                   DECREMENT LENGTH                          
         LA    RF,1(RF)               POINT TO TRUE START OF VALUE              
*                                                                               
         L     R1,AVLPARMS                                                      
         GOTO1 VDDVAL,(R1),('VLPVALQ',CFLTQTIC),((R0),(RF)),           X        
               AVLTAB,0,0,0                                                     
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   CHECK FOR ERRORS                          
         BNE   FLTRERR                                                          
*                                                                               
FLTRFLT1 DS    0H                                                               
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE                      
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
*        ADD FILTER TO COLUMN HEADLINES                                         
*                                                                               
         CLI   MYPOSO,C'H'         SKIP FOR  HEADLINES                          
         BE    FLTRFHDX                                                         
         CLI   MYPOSO,C'M'         AND MIDLINES                                 
         BE    FLTRFHDX                                                         
*                                                                               
         LA    R1,DRH1ALL          FIND FIRST UNUSED HEADLINE                   
         USING DRH1ALL,R1          ESTABLISH GENERIC HEADLINE BLOCK             
         LA    RE,4                MAX 4 HEADLINES                              
*                                                                               
         CLC   DRH1LIT,SPACES      USE IF NO LITERAL YET                        
         BNH   *+16                                                             
         LA    R1,L'DRH1ALL(R1)    BUMP TO NEXT HEADLINE                        
         BCT   RE,*-14                                                          
         B     FLTRFHDX            ALL HEADLINES USED                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R4)            FILTER ID WIDTH                              
         CLM   RF,1,DRLENO         DEFAULT TO COLUMN WIDTH                      
         BNH   *+8                                                              
         IC    RF,DRLENO           COLUMN WIDTH                                 
*                                                                               
         STC   RF,DRH1LITL         SET HEADLINE LITERAL LENGTH                  
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   DRH1LIT(0),22(R4)   ADD TO HEADLINES                             
*                                                                               
         DROP  R1                                                               
*                                                                               
         MVC   DRHEAD1-DRH1ALL(L'DRHEAD1,R1),DRHEAD1 COPY STATUS OF 1ST         
*                                                                               
FLTRFHDX DS    0H                                                               
*                                                                               
*        ADD COLUMN FILTER TO COLUMN FILTER SAVEAREA                            
*                                                                               
         MVC   DRARGSI+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         CLI   DRNARGSI,7          UPDATE NUMBER OF ARGUMENTS IF NEEDED         
         BNL   *+8                                                              
         MVI   DRNARGSI,7                                                       
*                                                                               
         MVC   DRARGSO+6(1),KEYWORD# PASS ALONG KEYWORD NUMBER                  
         CLI   DRNARGSO,7          UPDATE NUMBER OF ARGUMENTS IF NEEDED         
         BNL   *+8                                                              
         MVI   DRNARGSO,7                                                       
*                                                                               
         L     R7,AFLTTAB          POINT TO FILTER SAVEAREAS                    
*                                                                               
         SR    RE,RE                                                            
         IC    RE,KEYWORD#         KEYWORD NUMBER                               
         BCTR  RE,0                DECREMENT FOR INDEXING                       
         LA    RF,FTBENTL          FILTER AREA LENGTH                           
         MR    RE,RE               INDEX INTO FILTER AREA                       
         LA    R7,0(RF,R7)         AREA FOR THIS KEYWORD                        
*                                                                               
         USING FLTAREA,R7          ESTABLISH FILTERS SAVEAREA                   
*                                                                               
         LA    R6,FLTCTL           POINT TO FIRST FILTER IN AREA                
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,FLTFNO         GET NUMBER OF FILTERS SO FAR                 
         BZ    FLTRFL10                                                         
*                                                                               
         SR    RF,RF                                                            
         USING FLTCTL,R6           ESTABLISH FILTER                             
*                                                                               
         ICM   RF,1,FLTFVLEN       GET LENGTH OF FILTER                         
         LA    R6,FLTFVAL(RF)      BUMP TO NEXT FILTER                          
         BCT   RE,*-8                                                           
*                                                                               
FLTRFL10 DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,FLTFNO           ADD TWO TO FILTER COUNTER                    
         LA    RF,2(RF)                                                         
         STC   RF,FLTFNO                                                        
*                                                                               
*        ADD ENTRY CONTAINING MASTER TYPE                                       
*                                                                               
         MVC   FLTFTIC,=AL2(RKQMTIC)  SET FILTER TYPE AS MASTER HOLDER          
         MVI   FLTCTL,FLTEQQ       SET CONTROL BYTE                             
*                                                                               
         MVI   FLTFVLEN,2          FILTER VALUE IS 2 BYTES                      
         MVC   FLTFVAL(2),CFLTQTIC  SAVE DEFAULT TYPE                           
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,FLTFVLEN       GET LENGTH OF FILTER                         
         LA    R6,FLTFVAL(RF)      BUMP TO NEXT FILTER                          
*                                                                               
         L     R1,AVLTAB           POINT TO DDVAL TABLE ENTRY                   
*                                                                               
         MVC   FLTFTIC,CFLTQTIC    SET FILTER TYPE                              
         MVC   FLTCTL,BYTE         SET CONTROL BYTE                             
*                                                                               
         TM    VLTIND-VLTABD(R1),VLTNSLNQ IF STANDARD ICODE                     
         BO    FLTRFL20                                                         
*                                                                               
         MVI   FLTFVLEN,2          FILTER VALUE IS 2 BYTES                      
         MVC   FLTFVAL(2),VLTICODE-VLTABD(R1)  SAVE FILTER VALUE                
*                                                                               
         B     FLTRFL30                                                         
*                                                                               
FLTRFL20 DS    0H                                                               
*                                                                               
         MVC   FLTFVLEN,VLTEXTRA-VLTABD(R1)  LENGTH AT VLTEXTRA                 
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,VLTEXTRA-VLTABD(R1) FILTER VALUE LENGTH                     
         BZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   FLTFVAL(0),VLTEXTRA+1-VLTABD(R1) SAVE FILTER VALUE               
*                                                                               
FLTRFL30 DS    0H                                                               
*                                                                               
         DROP  R5                                                               
*                                                                               
FLTROK   DS    0H                  FILTER VALIDATION OKAY                       
*                                                                               
         CR    RB,RB               SET EQ CC                                    
         B     FLTRVALX                                                         
*                                                                               
FLTRERR  DS    0H                                                               
*                                                                               
         XC    CFLTQTIC,CFLTQTIC   CLEAR FILTER ICODE                           
         LTR   RB,RB               SET NE CC                                    
         B     FLTRVALX                                                         
*                                                                               
FLTRVALX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWR00  - VALIDATE KEYWORD FILTERS - PEREXP'                   
***********************************************************************         
*                                                                     *         
*              ROUTINE TO VALIDATE PERIOD EXPRESSIONS                 *         
*                                                                     *         
*NTRY    R4 ==>   SCANNER BLOCK                                       *         
*                                                                     *         
*EXIT    RETURN IN EXPLIST                                            *         
*                 X'00' NOT VALID                                     *         
*                 X'FF' VALID BUT DATE MISSED                         *         
*                 X'NN00' PERIOD NUMBER                               *         
*                 OR LIST OF PERIOD NUMBERS                           *         
*                                                                     *         
*VALID      W1 THRU W104   SINGLE WEEK                                *         
*           M1 THRU M50    SINGLE MONTH                               *         
*           Q1 THRU Q16           QUARTER                             *         
*           S1 THRU S8            HALF-YEARS                          *         
*           Y1 THRU Y4            YEAR                                *         
*           MN-N           FLOW   MONTH                               *         
*           QN-N                  QUARTER                             *         
*           SN-N                  SEMI-YEARS                          *         
*           YN-N                  YEAR                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
PEREXP   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING GEND,RC                                                          
         USING SUBSYSD,R9                                                       
         USING T830FFD,RA                                                       
*                                                                               
         OC    REQPSTR,REQPSTR     SKIP IF NO PERIOD GIVEN                      
         BZ    PEXIT                    HAPPENS WITH SYMBOLICS                  
*                                                                               
*        INIT COUNTERS BASED ON DATE TYPE                                       
*                                                                               
         XC    FLOWSTRT(2),FLOWSTRT INIT FLOW PERIOD                            
*                                                                               
         CLI   12(R4),C'W'         WEEKS                                        
         BNE   *+16                                                             
         LA    R2,WEEKLIST-DATELSTD DISPLACEMENT INTO DATELIST                  
         LA    R3,104              MAX NUMBER OF WEEKS                          
         B     PEXP2                                                            
*                                                                               
         CLI   12(R4),C'M'         MONTHS                                       
         BNE   *+16                                                             
         LA    R2,MNTHLIST-DATELSTD DISPLACEMENT INTO DATELIST                  
         LA    R3,50               MAX NUMBER OF MONTHS                         
         B     PEXP2                                                            
*                                                                               
         CLI   12(R4),C'Q'         QUARTERS                                     
         BNE   *+16                                                             
         LA    R2,QURTLIST-DATELSTD DISPLACEMENT INTO DATELIST                  
         LA    R3,16               MAX NUMBER OF QUARTERS                       
         B     PEXP2                                                            
*                                                                               
         CLI   12(R4),C'S'         SEMI-YEARS                                   
         BNE   *+16                                                             
         LA    R2,SEMILIST-DATELSTD DISPLACEMENT INTO DATELIST                  
         LA    R3,8                MAX NUMBER OF SEMI-YEARS                     
         B     PEXP2                                                            
*                                                                               
         CLI   12(R4),C'Y'         YEARS                                        
         BNE   *+16                                                             
         LA    R2,YEARLIST-DATELSTD DISPLACEMENT INTO DATELIST                  
         LA    R3,4                MAX NUMBER OF YEARS                          
         B     PEXP2                                                            
*                                                                               
*        MAY NOT BE A FLOWCHART EXPRESSION                                      
*                                                                               
         B     PEXIT               UNKNOWN DATE TYPE                            
*                                                                               
PEXP2    DS    0H                                                               
*                                                                               
         MVC   REQDTYPE,12(R4)     SAVE DATE TYPE                               
*                                                                               
         LA    R4,13(R4)           R4=A(FIRST POTENTIAL NUMBER)                 
*                                                                               
         BAS   RE,PEXNUM           VALIDATE NUMERIC                             
*                                                                               
         LTR   R0,R0               DID WE GET A VALID NUMBER                    
         BZ    PEXIT                                                            
*                                                                               
         CR    R0,R3               THAT WASN'T TOO BIG?                         
         BH    PEXIT                                                            
*                                                                               
         STC   R0,FLOWSTRT         SAVE STARTING PERIOD                         
*                                                                               
         CLI   0(R4),C'-'          IS THERE A RANGE SPECIFIED?                  
         BNE   PEXVALX                                                          
*                                                                               
         LA    R4,1(R4)            POINT TO NEXT NUMBER                         
*                                                                               
         LR    RF,R0               SAVE START NUMBER                            
*                                                                               
         BAS   RE,PEXNUM           VALIDATE SECOND NUMBER                       
*                                                                               
         LTR   R0,R0                                                            
         BZ    PEXNO               NOT VALID                                    
*                                                                               
         CR    R0,R3               THAT WASN'T TOO BIG?                         
         BH    PEXNO                                                            
*                                                                               
         CR    RF,R0               MUST BE EQUAL OR LARGER THAN 1ST             
         BH    PEXNO                                                            
*                                                                               
         STC   R0,FLOWEND          SAVE ENDING PERIOD                           
*                                                                               
         SR    R0,RF                                                            
         AHI   R0,1                CORRECT COUNT                                
*                                                                               
         STC   R0,FCHRTITR        CONTAINS ITERATION                            
*                                                                               
PEXVALX  DS    0H                                                               
*                                                                               
         ICM   R5,15,ADATLIST      ESTABLISH LIST OF DATES                      
         BZ    PEXIT               NO LIST AVAILABLE                            
         USING DATELSTD,R5                                                      
*                                                                               
         SR    R0,R0                                                            
         IC    R0,FLOWSTRT                                                      
*                                                                               
         SRL   R2,2                RELATIVE START OF CORRECT DATE LIST          
*                                                                               
         AR    R0,R2               RELATIVE POSITION IN DATELIST                
*                                                                               
         STC   R0,EXPLIST          SAVE FIRST PERIOD NUMBER                     
*                                                                               
         ICM   R0,1,FLOWEND        END OF LIST                                  
         BZ    PEXVALX1                                                         
*                                                                               
         AR    R0,R2               RELATIVE POSITION IN DATELIST                
*                                                                               
         SR    R1,R1                                                            
         IC    R1,EXPLIST          GET FIRST RELATIVE POSITION                  
*                                                                               
         CR    R0,R1                                                            
         BNH   PEXNO               SECOND MUST BE HIGHER THAN FIRST             
*                                                                               
         SR    R0,R1               NUMBER OF PERIODS MINUS 1                    
*                                                                               
         CH    R0,=H'15'           AND NOT MORE THAN 15 MORE                    
         BH    PEXNO                                                            
*                                                                               
         SR    R1,R1                                                            
         IC    R1,EXPLIST          FIRST PERIOD                                 
*                                                                               
         LA    R1,1(R1)            BUMP PERIOD NUMBER                           
         LA    R2,EXPLIST+1        NEXT AVAILABLE SLOT                          
*                                                                               
         STC   R1,0(R2)            GENERATE A LIST OF NUMBERS                   
         LA    R1,1(R1)                                                         
         LA    R2,1(R2)                                                         
         BCT   R0,*-12                                                          
*                                                                               
PEXVALX1 DS    0H                                                               
*                                                                               
         LA    R2,EXPLIST          NOW HAVE A LIST OF NUMBERS                   
         LA    R3,16               IN EXPLIST                                   
*                                                                               
PEXLOOP  DS    0H                                                               
*                                                                               
         CLI   0(R2),0             DONE AT END OF LIST                          
         BE    PEXDONE                                                          
*                                                                               
         SR    R1,R1                                                            
         IC    R1,0(R2)            FIND DATE IN DATELIST                        
         BCTR  R1,0                DECREMENT FOR INDEXING                       
         SLL   R1,2                CALCULATE INDEX INTO DATELIST                
*                                                                               
         LA    RF,0(R1,R5)         POINT TO DATE IN LIST                        
*                                                                               
         OC    0(4,RF),0(RF)       MAKE SURE DATE EXISTS                        
         BZ    PEXMISS             2 BYTE COMPRESSED DATES                      
*                                                                               
PEXCONT  DS    0H                                                               
*                                                                               
         LA    R2,1(R2)                                                         
         BCT   R3,PEXLOOP                                                       
*                                                                               
PEXDONE  DS    0H                                                               
*                                                                               
         B     PEXIT                                                            
*                                                                               
*        ERROR ROUTINES                                                         
*                                                                               
PEXMISS  MVI   EXPLIST,X'FF'       PASS BACK X'FF'                              
         MVI   ERROR,RWEFLW3E      FLOW RANGE LARGER THAN REQ PER               
         B     PEXERR                                                           
*                                                                               
PEXNO    DS    0H                                                               
         ICM   R5,15,ADATLIST      SKIP IF NO DATE LIST AVAILABLE               
         BZ    *+14                                                             
         XC    EXPLIST,EXPLIST                                                  
         MVI   EXPLIST,X'FF'       FLAG THAT ERROR EXISTS                       
*                                                                               
         MVI   ERROR,RWEFLW2E      INVALID FLOWCHART EXPRESSION                 
*                                                                               
PEXERR   DS    0H                                                               
*                                                                               
PEXIT    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         EJECT                                                                  
*                                                                               
*        EXTRACT PERIOD NUMBER AND VALIDATE AS NUMERIC                          
*                                                                               
PEXNUM   SR    R0,R0               VALIDATE FOR NUMERIC                         
*                                  R4=A(POTENTIAL EXPRESSION)                   
*                                  PASS BACK NUMBER IN R0                       
         SPACE 1                                                                
PEXNUM2  CLI   0(R4),C' '          DELIMITED BY SPACE OR DASH                   
         BE    PEXNUMX                                                          
*                                                                               
         CLI   0(R4),C'-'                                                       
         BE    PEXNUMX                                                          
*                                                                               
         CLI   0(R4),C'0'          CHECK FOR NUMERIC DIGIT                      
         BL    PEXNUMNO                                                         
*                                                                               
         CLI   0(R4),C'9'                                                       
         BH    PEXNUMNO                                                         
*                                                                               
         MH    R0,=H'10'           MULTIPLY PREVIOUS BY 10                      
         ZIC   R1,0(R4)            AND ADD THIS DIGIT                           
         SLL   R1,28               (STRIP TOP BITS)                             
         SRL   R1,28                                                            
         AR    R0,R1                                                            
*                                                                               
         LA    R4,1(R4)            BUMP TO NEXT DIGIT                           
*                                                                               
         B     PEXNUM2                                                          
*                                                                               
PEXNUMNO SR    R0,R0               NO GOOD - RETURN ZERO                        
         BR    RE                                                               
*                                                                               
PEXNUMX  DS    0H                                                               
*                                                                               
         CR    RB,RB               PERIOD NUMBER VALID                          
         BR    RE                                                               
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWR00 - SCAN FOR < OR >  - SEPSCAN'                           
***********************************************************************         
*                                                                     *         
*        SCAN FIRST PART OF SCANNER BLOCK FOR < AND >                 *         
*        IF FOUND SPLIT BLOCK INTO 2 PARTS AND SAVE                   *         
*          ACTUAL SEPARATOR                                           *         
*                                                                     *         
*                                                                     *         
*NTRY    R4 ==>   SCANNER BLOCK                                       *         
*                                                                     *         
*EXIT    SCANSEP HAS ACTUAL SEPARATOR                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
SEPSCAN  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9                                                       
         USING GEND,RC                                                          
*                                                                               
         MVI   SCANSEP,0           DEFAULT TO NO SEPARATOR                      
*                                                                               
         CLI   1(R4),0             IF THERE IS A SECOND PART                    
         BE    *+12                                                             
         MVI   SCANSEP,C'='           SET TO '=' SEPARATOR                      
         B     SEPSCAND               SKIP CHECK                                
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,0(R4)          GET DATA LENGTH                              
         BZ    SEPNOTV             NO FIRST PART                                
         LR    R1,RE               SAVE TOTAL LENGTH                            
*                                                                               
         LA    RF,12(R4)           POINT TO START OF DATA                       
*                                                                               
SEPSCANL DS    0H                                                               
*                                                                               
         CLI   0(RF),C'<'          IF DATA HAS LT SIGN                          
         BE    *+8                                                              
         CLI   0(RF),C'>'           OR GT SIGN                                  
         BE    SEPSCANF               USE AS SEPARATOR                          
*                                                                               
SEPSCANC DS    0H                                                               
*                                                                               
         LA    RF,1(RF)            BUMP POINTER                                 
         BCT   RE,SEPSCANL                                                      
*                                                                               
         B     SEPSCAND            NO SPECIAL SEPARATORS                        
*                                                                               
SEPSCANF DS    0H                                                               
*                                                                               
         MVC   SCANSEP,0(RF)       SAVE SEPARATOR                               
*                                                                               
         SR    R1,RE               FIRST PART LENGTH                            
         BZ    SEPNOTV             NOTHING BEFORE SEPARATOR                     
*                                                                               
         STC   R1,0(R4)            SAVE FIRST PART LENGTH                       
*                                                                               
         BCT   RE,*+8              SECOND PART LENGTH                           
         B     SEPNOTV             NOTHING AFTER SEPARATOR                      
*                                                                               
         STC   RE,1(R4)            SET SECOND PART LENGTH                       
*                                                                               
         BCTR  RE,0                DECREMENT FOR EXECUTE                        
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   22(0,R4),1(RF)         MOVE TO SECOND PART                       
*                                                                               
         MVI   0(RF),C' '             CLEAR SEPARATOR                           
*                                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   1(0,RF),SPACES         CLEAR REMAINDER OF KEYWORD PART           
*                                                                               
SEPSCAND DS    0H                                                               
*                                                                               
*        CHECK IF A VARIABLE NEEDS TO BE REPLACED                               
*                                                                               
         CLI   12(R4),AMPERSND     IF KEYWORD                                   
         BE    *+8                                                              
         CLI   22(R4),AMPERSND     OR VALUE STARTS WITH AMPERSAND               
         BNE   SETVARX                                                          
*                                                                               
*        IF VARIABLE IN FIRST PART OF SCANNER BLOCK                             
*           REPLACE WITH VARIABLE'S VALUE                                       
*                                                                               
         CLI   12(R4),AMPERSND     SKIP UNLESS FIRST PART OF BLOCK              
         BNE   SVAR1STX               BEING REPLACED                            
*                                                                               
         CLI   0(R4),1             LENGTH MUST BE GREATER THAN 1                
         BNH   SVAR1STX                                                         
*                                                                               
         LA    R0,3                MAX 3 VARIABLES SAVED                        
         LA    R1,VARSAVE          POINT TO FIRST SAVED VARIABLE                
*                                                                               
         CLC   0(1,R1),0(R4)       LENGTHS MUST MATCH                           
         BNE   *+10                                                             
         CLC   12(10,R1),12(R4)    INPUT MUST MATCH                             
         BE    *+16                                                             
         LA    R1,42(R1)           BUMP TO NEXT VARIABLE                        
         BCT   R0,*-24                                                          
         B     SETVARER            UNKNOWN VARIABLE                             
*                                                                               
         MVC   0(1,R4),1(R1)       REPLACE WITH VARIABLE LENGTH                 
         MVC   12(10,R4),22(R1)    REPLACE WITH VARIABLE VALUE                  
*                                                                               
SVAR1STX DS    0H                                                               
*                                                                               
         CLI   22(R4),AMPERSND     SKIP UNLESS SECOND PART OF BLOCK             
         BNE   SVAR2NDX               BEING REPLACED                            
*                                                                               
         CLI   1(R4),1             LENGTH MUST BE GREATER THAN 1                
         BNH   SVAR2NDX                                                         
*                                                                               
         LA    R0,3                MAX 3 VARIABLES SAVED                        
         LA    R1,VARSAVE          POINT TO FIRST SAVED VARIABLE                
*                                                                               
         CLC   1(1,R4),0(R1)       LENGTHS MUST MATCH                           
         BNE   *+10                                                             
         CLC   22(10,R4),12(R1)    INPUT MUST MATCH                             
         BE    *+16                                                             
         LA    R1,42(R1)           BUMP TO NEXT VARIABLE                        
         BCT   R0,*-24                                                          
         B     SETVARER            UNKNOWN VARIABLE                             
*                                                                               
         MVC   1(1,R4),1(R1)       REPLACE WITH VARIABLE LENGTH                 
         MVC   22(20,R4),22(R1)    REPLACE WITH VARIABLE                        
*                                                                               
SVAR2NDX DS    0H                                                               
*                                                                               
         B     SETVARX                                                          
*                                                                               
SETVARER DS    0H                  INVALID VARIABLE                             
*                                                                               
         B     SEPNOTV                                                          
*                                                                               
SETVARX  DS    0H                                                               
*                                                                               
         CR    RB,RB               SET EQ CC                                    
*                                                                               
         B     SEPSCANX                                                         
*                                                                               
SEPNOTV  DS    0H                                                               
*                                                                               
         LTR   RB,RB               SET NEQ CC                                   
*                                                                               
SEPSCANX DS    0H                                                               
         XIT1                                                                   
*                                                                               
Y        EQU   X'FFFF'             FOR FILTER MASKS                             
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - SETVAL'                     
***********************************************************************         
*                                                                     *         
*        VALIDATE SET RECORD IDS                                      *         
*                                                                     *         
*NTRY    R2 ==> INPUT FIELD                                           *         
*        P0    A(SET RECORD TYPE)                                     *         
*        P1    A(MEMBERS OF SET RECORD TYPE)                          *         
*                                                                     *         
*EXIT    WORK(4)     SET RECORD ID - LEFT JUSTIFIED, SPACE FILLED     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
SETVAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9                                                       
         USING GEND,RC                                                          
*                                                                               
         L     R3,0(R1)            SAVE SET TYPE POINTER                        
*                                                                               
         XC    WORK,WORK           INIT WORKAREA                                
*                                                                               
         CLI   5(R2),0             DONE IF NO INPUT                             
         BE    SETVALX                                                          
*                                                                               
*        IF FIELD STARTS WITH '*' THEN IT IS A SET RECORD ID                    
*                                                                               
         CLI   8(R2),C'*'          DONE IF NOT A SET RECORD ID                  
         BNE   SETVALX                                                          
*                                                                               
         GOTO1 =A(SETREP),RR=RELORGEN   FILE READ REP FOR SET                   
*                                  SAME PARAMETER LIST                          
*                                                                               
         XC    KEY,KEY             ESTABLISH SET RECORD KEY                     
         LA    R4,KEY                                                           
         USING RSETKEY,R4                                                       
*                                                                               
         MVI   RSETKTYP,RSETKTYQ   RECORD TYPE                                  
         MVC   RSETKREP,REDMREP    AGENCY                                       
         MVC   RSETKSET,0(R3)      SET TYPE                                     
*                                                                               
         MVC   RSETKID,SPACES      INIT SET ID                                  
*                                                                               
         SR    RF,RF                                                            
         IC    RF,5(R2)            GET INPUT LENGTH                             
         SH    RF,=H'2'            DECREMENT FOR '*' AND EXECUTE                
         BM    SETVALX             NO ID ENTERED                                
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RSETKID(0),9(R2)    SET ID                                       
*                                                                               
         GOTO1 HIGH                READ POINTER                                 
*                                                                               
         CLC   RSETKEY,KEYSAVE     MUST FIND KEY                                
         BNE   SETVALX                                                          
*                                                                               
         MVC   WORK(4),RSETKID     RETURN SET ID                                
*                                                                               
SETVALX  DS     0H                                                              
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'T00AAD - REPPAK WRITER CONTROLLER - SETREP'                     
***********************************************************************         
*                                                                     *         
*        SET CORRECT REP IN KEY FOR RECORD TYPE                       *         
*                                                                     *         
*NTRY    R2 ==> INPUT FIELD                                           *         
*        P0    A(SET RECORD TYPE)                                     *         
*        P1    A(MEMBERS OF SET RECORD TYPE)                          *         
*                                                                     *         
*EXIT    REDMREP   REP FOR READING FILE                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
SETREP   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SPOOLD,R8                                                        
         USING SUBSYSD,R9                                                       
         USING GEND,RC                                                          
*                                                                               
         MVC   REDMREP,AGENCY      DEFAULT TO CURRENT REP                       
*                                                                               
         OC    REMREP,REMREP       SKIP ID IF THERE IS NO MASTER REP            
         BZ    SETREPX                                                          
*                                                                               
         L     R2,4(R1)            POINT TO RECORD ID                           
*                                                                               
*        KATZ HAS A SPECIAL ARRANGEMENT FOR GROUPS                              
*                                                                               
         CLI   0(R2),RGRPKTYQ      IF GROUP SET AND                             
         BNE   STRPK3N                                                          
         CLC   REMREP,=C'K3'       AND KATZ MASTER REP                          
         BNE   STRPK3N                                                          
         MVC   REDMREP,REMREP         USE MASTER REP                            
         B     SETREPX                                                          
*                                                                               
STRPK3N  DS    0H                                                               
*                                                                               
         L     R1,=A(INTEREP)      POINT TO REP TRANSLATION TAB                 
         A     R1,RELORGEN         RELOCATE ADDRESS                             
*                                                                               
STRPLOOP DS    0H                                                               
*                                                                               
         CLI   RTABID(R1),0        DONE AT END OF TABLE                         
         BE    STRPDONE                                                         
*                                                                               
         CLC   REREP,RTABSUB(R1)   MATCH ON SUBSIDIARY REP                      
         BNE   STRPCONT                                                         
*                                                                               
         CLC   RTABID(1,R1),0(R2)  MATCH ON RECORD TYPE                         
         BE    STRPFND                                                          
*                                                                               
STRPCONT DS    0H                                                               
*                                                                               
         LA    R1,RTABELEN(R1)     BUMP TO NEXT TABLE ENTRY                     
         B     STRPLOOP                                                         
*                                                                               
STRPFND  DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,RTABDISP(R1)     GET DISPLACEMENT OF REP IN KEY               
         LA    RF,0(RF,R2)         POINT TO REP IN KEY                          
*                                                                               
         MVC   REDMREP,RTABMAST(R1)  SAVE REP FOR READING FILE                  
*                                                                               
STRPDONE DS    0H                                                               
*                                                                               
SETREPX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
*                                                                               
         DROP                                                                   
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - DATELSTD'                 
***********************************************************************         
*                                                                     *         
*        DSECT FOR DATELISTS FOUND IN DATEAREA                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
       ++INCLUDE RENWRDLSTD                                                     
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - GEND'                     
***********************************************************************         
*                                                                     *         
*              GENCON OVERALL WORKAREAS DSECT                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WKLND    DSECT                                                                  
WKST     DS    CL(SPOOLEND-SPOOLD)                                              
         DS    CL((GENDEND+16)-GEND)                                            
         DS    CL2000              (SPACE FOR SECOND I/O)                       
         DS    CL(SYSEND-WRISYS)                                                
BUFFWRKC DS    CL(BUFFWRKL)                                                     
WKEND    EQU   *                                                                
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - RENWRWORKD'               
***********************************************************************         
*                                                                     *         
*              WRITER WORKING STORAGE                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
       ++INCLUDE RENWRWORKD                                                     
*                                                                               
           TITLE 'T00AAD - REPPAK WRITER CONTROLLER - DSECTS'                   
***********************************************************************         
*                                                                     *         
*              OTHER DSECTS ARE HIDDEN IN HERE                        *         
*                                                                     *         
***********************************************************************         
         SPACE                                                                  
         PRINT ON                                                               
*DDSPOOLD                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDSPOOLD                                                       
         PRINT ON                                                               
*DDSPLWORKD                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDSPLWORKD                                                     
         PRINT ON                                                               
*CTGENDIC                                                                       
         PRINT OFF                                                              
       ++INCLUDE CTGENDIC                                                       
         PRINT ON                                                               
DBLOCKD  DSECT                                                                  
         PRINT OFF                                                              
       ++INCLUDE DEDBLOCK                                                       
         PRINT ON                                                               
*RENWRFFD                                                                       
         PRINT OFF                                                              
       ++INCLUDE RENWRFFD                                                       
         PRINT ON                                                               
*DDGENTWA                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDGENTWA                                                       
         PRINT ON                                                               
*RENWRF1D                                                                       
****     ORG   CONTAGH                                                          
****     PRINT OFF                                                              
****   ++INCLUDE RENWRF1D                                                       
****     PRINT ON                                                               
         EJECT                                                                  
T830FFD  DSECT                                                                  
         ORG   CONHEADH-64+X'3000'                                              
HELPSAVE DS    XL512               HELP SAVEAREA                                
*                                                                               
*RENWREQUS                                                                      
         PRINT OFF                                                              
       ++INCLUDE RENWREQUS                                                      
         PRINT ON                                                               
*PRVALTABD                                                                      
         PRINT OFF                                                              
       ++INCLUDE PRVALTABD                                                      
         PRINT ON                                                               
*DDPERVALD                                                                      
         PRINT OFF                                                              
       ++INCLUDE DDPERVALD                                                      
         PRINT ON                                                               
*DDFLDIND                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDFLDIND                                                       
         PRINT ON                                                               
*DDFLDHDR                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDFLDHDR                                                       
         PRINT ON                                                               
*FAFACTS                                                                        
         PRINT OFF                                                              
       ++INCLUDE FAFACTS                                                        
         PRINT ON                                                               
*FATIOB                                                                         
         PRINT OFF                                                              
       ++INCLUDE FATIOB                                                         
         PRINT ON                                                               
*FAGETTXTD                                                                      
         PRINT OFF                                                              
       ++INCLUDE FAGETTXTD                                                      
         PRINT ON                                                               
*DDCOMFACS                                                                      
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACS                                                      
         PRINT ON                                                               
*DDCOREQUS                                                                      
         PRINT OFF                                                              
       ++INCLUDE DDCOREQUS                                                      
         PRINT ON                                                               
*DRGLOBAL                                                                       
         PRINT OFF                                                              
       ++INCLUDE DRGLOBAL                                                       
         PRINT ON                                                               
*DDBIGBOX                                                                       
         PRINT OFF                                                              
       ++INCLUDE DDBIGBOX                                                       
         PRINT ON                                                               
*DDWIDED                                                                        
         PRINT OFF                                                              
       ++INCLUDE DDWIDED                                                        
         PRINT ON                                                               
*CTGENFILE                                                                      
         PRINT OFF                                                              
       ++INCLUDE CTGENFILE                                                      
         PRINT ON                                                               
*REGENALL1                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENALL1                                                      
         PRINT ON                                                               
*REGENPWC                                                                       
         PRINT OFF                                                              
       ++INCLUDE REGENPWC                                                       
         PRINT ON                                                               
*REGENSET                                                                       
         PRINT OFF                                                              
       ++INCLUDE REGENSET                                                       
         PRINT ON                                                               
*REGENDCT                                                                       
         PRINT OFF                                                              
       ++INCLUDE REGENDCT                                                       
         PRINT ON                                                               
*REGENSPEC                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENSPEC                                                      
         PRINT ON                                                               
*REGENDSP                                                                       
         PRINT OFF                                                              
       ++INCLUDE REGENDSP                                                       
         PRINT ON                                                               
* GERFPIOD                                                                      
         PRINT OFF                                                              
       ++INCLUDE GERFPIOD                                                       
         PRINT ON                                                               
* REDDEQUS                                                                      
         PRINT OFF                                                              
       ++INCLUDE REDDEQUS                                                       
         PRINT ON                                                               
* REPFACSQ                                                                      
         PRINT OFF                                                              
       ++INCLUDE REPFACSQ                                                       
         PRINT ON                                                               
* INTEREP                                                                       
         PRINT OFF                                                              
       ++INCLUDE INTEREP                                                        
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'041RENWRGENS 12/17/03'                                      
         END                                                                    

*          DATA SET SPLNK32    AT LEVEL 196 AS OF 11/03/20                      
*PHASE T21E32C                                                                  
SPLNK32  TITLE '- Spot Desktop OM Server'                                       
                                                                                
         GBLB  &FAST_ASSEMBLY                                                   
&FAST_ASSEMBLY SETB 1              ** NOOP THIS FOR INTEGRITY CHECK **          
                                                                                
         PRINT NOGEN                                                            
SVRDEF   CSECT                                                                  
         LKSVR TYPE=D,                                                 +        
               SERVERTYPE=TSTSPOT,                                     +        
               WORKERKEY=SPOD,                                         +        
               FACS=FACS,                                              +        
               LOADFACSOFF=Y,                                          +        
               SEGMENT=Y,                                              +        
               APPEND=Y,                                               +        
               REQUEST=*,                                              +        
               CODE=CODE,                                              +        
               SYSPHASE=SYSPHASE,                                      +        
               SYSTEM=SPTSYSQ,                                         +        
               FILES=FILES,                                            +        
               IDF=Y,                                                  +        
               BIG=Y,                                                  +        
               SLOWLIST=SLOWS,                                         +        
               ABENDLIST=FAILS,                                        +        
               AUTOCLEAR=Y,                                            +        
               BLOCKS=(B#WORKD,WORKD,                                  +        
               B#SAVED,SAVED,                                          +        
               B#TWAD,TWAD,                                            +        
               B#COMREC,COMRECD,                                       +        
               B#BYRREC,BYRRECD,                                       +        
               B#SALREC,GSPLRECD,                                      +        
               B#OCOREC,OCOMHDR,                                       +        
               B#SVRDEF,SVRDEF),                                       +        
               BLOCKS2=(B#NOTREC,DAREMGND,                             +        
               B#OHSREC,OHISRECD,                                      +        
               B#OFFREC,DAREMGOD,                                      +        
               B#SDMREC,DAREMGOD,                                      +        
               B#ESTREC,ESTHDR,                                        +        
               B#FLTREC,DFLRECD,                                       +        
               B#ORDREC,DAREORDD,                                      +        
               B#OBCREC,DAREORDD,                                      +        
               B#DBTREC,DARBTCHD,                                      +        
               B#OMXREC,DAREORDD,                                      +        
               B#NOTRJC,DAREMGCD)                                      +        
                                                                                
CODE     NMOD1 0,**SL32**,RR=RE                                                 
         LAY   RA,GLOBALS                                                       
         USING GLOBALS,RA          RA=A(GLOBAL LITERALS)                        
         LR    R5,R1                                                            
         USING LP_D,R5             R5=A(DDLINK PARAMETER BLOCK)                 
         L     R7,LP_ARUNP                                                      
         USING RUNPARMD,R7         R7=A(RUNPARMS)                               
         SR    R6,R6                                                            
         ICM   R6,7,RUNPARUN                                                    
         USING RUNFACSD,R6         R6=A(RUNFACS)                                
                                                                                
         TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         BNZ   INIT02                                                           
         L     R9,LP_ABLK1         ONLINE - ROOT PROVIDES WORKD/SAVED           
         L     R8,LP_ABLK2                                                      
         B     INIT04                                                           
                                                                                
INIT02   L     R9,RSVRSAVE                                                      
         USING WORKD,R9            R9=A(GLOBAL W/S)                             
         ST    R9,LP_BLKS+((B#WORKD-1)*L'LP_BLKS)                               
         SR    R8,R8                                                            
         ICM   R8,3,WORKLEN                                                     
         LA    R8,WORKD+2048(R8)                                                
         USING SAVED,R8            R8=A(SAVE W/S)                               
         ST    R8,LP_BLKS+((B#SAVED-1)*L'LP_BLKS)                               
                                                                                
INIT04   MVC   RUNMODE,RUNPMODE    EXTRACT DDLINK/RUNNER CALLING MODE           
         MVC   ACOMFACS,RCOMFACS                                                
         MVC   AMASTC,RMASTC                                                    
         MVC   ABUFFRIN,RBUFFRIN                                                
         DROP  R6,R7                                                            
                                                                                
         LA    R0,LP_D                                                          
         ST    R0,ALP              SAVE A(LP_D)                                 
         ST    RE,SRVRRELO         SAVE PROGRAM RELOCATION FACTOR               
         STM   R2,RB,LP_R2RB       SAVE REGISTERS FOR SUB-ROUTINES              
                                                                                
         L     RF,ACOMFACS         LOAD FACILITIES OVERLAYS                     
         MVC   ARECUP,CRECUP-COMFACSD(RF)                                       
                                                                                
         USING STABLKD,WORK                                                     
         USING STAPACKD,WORK                                                    
         USING FAWSSVRD,WORK                                                    
         USING TSARD,TSARBLK                                                    
         USING SODOD,TSARREC                                                    
         EJECT                                                                  
***********************************************************************         
* INITIALIZE FOR RUNNING                                              *         
***********************************************************************         
                                                                                
RUNSTR   CLI   RUNMODE,RRUNSTRQ    TEST FIRST FOR RUN                           
         BNE   PRCWRK                                                           
                                                                                
         MVC   ABYRTAB,AIO7        USE IO7/8 FOR BYRTAB ONLINE                  
         LHI   R0,BYRTMAX1                                                      
         STCM  R0,15,BYRMAXN       SET MAXIMUM N'BYRTAB ENTRIES ONLINE          
                                                                                
         TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         BZ    RUNSTR02                                                         
                                                                                
         LA    R0,BYRTAB           USE W/S FOR BYRTAB OFFLINE                   
         ST    R0,ABYRTAB                                                       
         LHI   R0,BYRTMAX2                                                      
         STCM  R0,15,BYRMAXN       SET MAXIMUM N'BYRTAB ENTRIES OFFLINE         
                                                                                
         L     RF,ACOMFACS         LOAD FACILITIES OVERLAYS                     
         L     RF,CCALLOV-COMFACSD(RF)                                          
         GOTOR (RF),DMCB,('P#ROUTS1',0),0,0                                     
         MVC   AROUTS1,0(R1)                                                    
         MVC   LP_AUIR1,AROUTS1    SET A(INDEX ROUTINES 1)                      
         GOTOR (RF),DMCB,('P#ROUTS2',0),0,0                                     
         MVC   AROUTS2,0(R1)                                                    
         MVC   LP_AUIR2,AROUTS2    SET A(INDEX ROUTINES 2)                      
                                                                                
         GOTOR (#WRKINI,AWRKINI)   INITIALIZE WORKING STORAGE                   
                                                                                
RUNSTR02 MVC   LP_BLKS+((B#AGYREC-1)*L'LP_BLKS)(AIOLAST-AIO1),AIO1              
         MVC   LP_BLKS+((B#TWAD-1)*L'LP_BLKS)(L'LP_BLKS),LP_ATWA                
         MVC   LP_BLKS+((B#SVRDEF-1)*L'LP_BLKS)(L'LP_BLKS),LP_ASVR              
                                                                                
         MVC   WVALUES(WVALUEL),LVALUES                                         
                                                                                
         LA    R1,ADCONS           RELOCATE ADDRESS CONSTANTS                   
         LHI   R0,ADCONSN                                                       
         BASR  RE,0                                                             
         L     R2,0(R1)                                                         
         A     R2,SRVRRELO                                                      
         ST    R2,0(R1)                                                         
         AHI   R1,L'ADCONS                                                      
         BCTR  R0,RE                                                            
                                                                                
         XC    UPLVALS(UPLVALL),UPLVALS                                         
                                                                                
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* FIRST FOR NEW WORK                                                  *         
***********************************************************************         
                                                                                
PRCWRK   CLI   RUNMODE,RPRCWRKQ    TEST 'PROCESS WORK' MODE                     
         BNE   RUNREQ                                                           
                                                                                
         XC    REQVALS(REQVALL),REQVALS                                         
         LA    R0,QVALS                                                         
         LHI   R1,L'QVALS                                                       
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
         LA    R0,OUTVALS                                                       
         LHI   R1,OUTVALL                                                       
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
         OI    LP_FLAG2,LP_FSTIA   SET SAVE/RESTORE TIA                         
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* RUN DOWNLOAD REQUEST                                                *         
***********************************************************************         
                                                                                
RUNREQ   CLI   RUNMODE,RRUNREQQ    TEST 'RUN REQUEST' MODE                      
         JNE   RUNEND                                                           
                                                                                
         L     RE,LP_AWMP          BUILD DEFAULT RANGE ELEMENTS IN WMP          
         USING LW_D,RE                                                          
         MVI   LW_TYPE,LW_TALLQ    ALL VALUES                                   
         STCM  RE,7,AALL                                                        
         AHI   RE,LW_LN1Q                                                       
         MVI   LW_TYPE,LW_TNZRQ    NON-ZERO VALUES                              
         STCM  RE,7,ANZR                                                        
         AHI   RE,LW_LN1Q                                                       
         ST    RE,LP_AWMP                                                       
         DROP  RE                                                               
                                                                                
         XC    MAPI,MAPI           INITIALIZE MAP INDICATORS                    
         LA    RF,MAPTAB                                                        
         LHI   R0,MAPTABN                                                       
         BASR  RE,0                                                             
         CLC   LP_QMAPN,0(RF)                                                   
         JNE   *+14                                                             
         MVC   MAPI,L'LP_QMAPN(RF)                                              
         J     *+10                                                             
         AHI   RF,L'MAPTAB                                                      
         BCTR  R0,RE                                                            
                                                                                
         TM    MAPI2,MAPIUDEM      TEST UPLOAD MAKEGOOD DEMOS                   
         JNZ   UPLUMD                                                           
                                                                                
         OC    ENDDATEB,ENDDATEB   SET END DATES TO HIGH VALUES                 
         BNZ   *+10                IF NOT INPUT                                 
         MVC   ENDDATEB,EFFS                                                    
         OC    ENDDATEC,ENDDATEC                                                
         BNZ   *+10                                                             
         MVC   ENDDATEC,EFFS                                                    
         OC    QENDDATE,QENDDATE                                                
         BNZ   *+10                                                             
         MVC   QENDDATE,EFFS                                                    
                                                                                
         MVC   AGENCY,LP_AGY       SET AGENCY ALPHA ID                          
         ICM   RF,15,AMASTC        SET TRACE OPTION IF OFFLINE                  
         BZ    *+10                                                             
         MVC   IOTRACE,MCTRACE-MASTD(RF)                                        
                                                                                
         TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         BZ    RUNREQ02                                                         
         GOTOR VDATAMGR,DMCB,DMKEY,SPTDIR,(4,0),0                               
         GOTOR VDATAMGR,DMCB,DMKEY,TRFDIR,(4,0),0                               
         GOTOR VDATAMGR,DMCB,DMKEY,XSPDIR,(4,0),0                               
         GOTOR VDATAMGR,DMCB,DMKEY,SPTFIL,(4,0),0                               
         GOTOR VDATAMGR,DMCB,DMKEY,XSPFIL,(4,0),0                               
         GOTOR VDATAMGR,DMCB,DMKEY,STAFIL,(4,0),0                               
         GOTOR VDATAMGR,DMCB,DMKEY,GENDIR,(4,0),0                               
                                                                                
         GOTOR (#GETAGY,AGETAGY),LP_AGY                                         
                                                                                
RUNREQ02 MVI   RUNI1,0                                                          
         L     RF,AAGYREC          SET CANADIAN AGENCY FLAG                     
         CLI   AGYPCNDA-AGYHDR(RF),CANAGYQ                                      
         BNE   *+8                                                              
         OI    RUNI1,RUNICANA                                                   
                                                                                
         TM    MAPI2,MAPIAMCE      TEST WANT AGY/MED/CLT/EST RESOLVED           
         BZ    RUNREQ10                                                         
                                                                                
         ICM   RF,7,AMED                                                        
         MVC   QMEDX,LW_DATA1-LW_D(RF)                                          
         GOTOR (#EDTMED,AEDTMED),DMCB,QMEDX,,QMEDA                              
         JNE   *+2                                                              
                                                                                
         ICM   RF,7,ACLT           RF=A(CLIENT REQUEST VALUE)                   
         BZ    RUNREQ04                                                         
         MVC   QCLTX,LW_DATA1-LW_D(RF)                                          
         GOTOL RESCLT              RESOLVE CLIENT VALUES                        
                                                                                
RUNREQ04 CLI   ESTIND,LW_TALLQ     TEST ANY ESTIMATES GIVEN                     
         BNE   RUNREQ06                                                         
         L     RE,LP_AWMP          NO - BUILD WORK MAP POOL ENTRY               
         USING LW_D,RE                                                          
         STCM  RE,7,AEST2          AND POINT TO IT                              
         MVI   ESTIND2,LW_TLSTQ                                                 
         LHI   R0,LW_LN2Q                                                       
         STCM  R0,3,LW_LN                                                       
         XC    LW_NUMN,LW_NUMN     SET NO ENTRIES IN LIST                       
         MVI   LW_TYPE,LW_TLSTQ                                                 
         AHI   RE,LW_LN2Q+256                                                   
         ST    RE,LP_AWMP                                                       
         DROP  RE                                                               
                                                                                
RUNREQ06 GOTOL INIDAT              INITIALIZE REQUEST DATES                     
                                                                                
RUNREQ10 XC    SVERROR,SVERROR     INITIALIZE ERROR NUMBER                      
         GOTOR LP_APUTO,LP_D       CALL DDLINK OUTPUT PROCESSOR                 
         OC    SVERROR,SVERROR     TEST ERROR NUMBER IS SET                     
         BZ    EXITY                                                            
         MVC   LP_ERROR,SVERROR    YES - SET DDLINK ERROR VALUE                 
         B     EXITN                                                            
                                                                                
***********************************************************************         
* HANDLE LAST TIME FOR UPLOAD CALL                                    *         
***********************************************************************         
                                                                                
RUNEND   CLI   RUNMODE,RRUNENDQ    TEST 'RUN END' MODE                          
         BNE   EXITY                                                            
         GOTOR PUTDEM              PUT LAST RECORD                              
         B     EXITY                                                            
         DROP  RB                                                               
         EJECT                                                                  
FILES    DS    0C                  ** SYSTEM/FILE LIST **                       
                                                                                
         DC    C'SPOT   '                                                       
                                                                                
         DC    C'N'                                                             
         DC    C'SPTDIR '                                                       
         DC    C'N'                                                             
         DC    C'SPTFILE'                                                       
         DC    C'N'                                                             
         DC    C'XSPDIR '                                                       
         DC    C'N'                                                             
         DC    C'XSPFILE'                                                       
         DC    C'N'                                                             
         DC    C'STAFILE'                                                       
         DC    C'N'                                                             
         DC    C'CTFILE '                                                       
         DC    C'N'                                                             
         DC    C'STRFFL '                                                       
         DC    C'N'                                                             
         DC    C'STRFDR '                                                       
         DC    C'N'                                                             
         DC    C'GENDIR '                                                       
         DC    C'N'                                                             
         DC    C'GENFIL '                                                       
         DC    C'N'                                                             
         DC    C'DEMDIRA'                                                       
         DC    C'N'                                                             
         DC    C'DEMDIRN'                                                       
         DC    C'N'                                                             
         DC    C'DEMDIRR'                                                       
         DC    C'N'                                                             
         DC    C'L=DEMFA'                                                       
         DC    C'N'                                                             
         DC    C'L=DEMFN'                                                       
         DC    C'N'                                                             
         DC    C'L=DEMFR'                                                       
                                                                                
FILESX   DC    C'X'                                                             
                                                                                
FAILS    DC    C'JNEW,HWON,WHOA:'                                               
SLOWS    DC    C'JNEW,HWON,WHOA:'                                               
                                                                                
FACS     DS    0XL(RFACTABL)       ** SYSTEM FACILITIES **                      
         DC    AL1(QDEMTABS),AL2(CDEMTABS-COMFACSD,0)                           
         DC    AL1(RFACEOTQ)                                                    
         EJECT                                                                  
***********************************************************************         
* UPLOAD MAKEGOOD DEMOS                                               *         
*                                                                               
*   AIO5     - MAKEGOOD OFFER RECORD                                            
*   AIO6     - MAKEGOOD OFFER DEFAULT DEMO RECORD                               
***********************************************************************         
                                                                                
MOK      USING DAREMGOD,IOKEY                                                   
UPLUMD   OC    OFFDA,OFFDA         TEST OFFER RECORD D/A PRESENT                
         JZ    *+2                                                              
         CLC   OFFDA,OFFDASV       TEST CHANGE OF OFFER                         
         JE    UPLUMD10                                                         
         GOTOR PUTDEM                                                           
                                                                                
UPLUMD01 MVC   IODAOVER,OFFDA      READ OFFER RECORD                            
         CLI   OFFFILE,C'X'        SPOT OR XSPOT?                               
         JE    UPLUMD06                                                         
*                                                                               
* THIS IS BROADCAST MAKEGOOD, READ SPOT FILE                                    
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL+IO5'                              
         JNE   UPLUMDN                                                          
                                                                                
         L     R2,IOADDR           R2=A(OFFER RECORD)                           
         MVC   MOK.MOKEY,0(R2)                                                  
         MVI   MOK.MOKSEQ,MOKSEQDQ X'FF' - DEMO REC SEQ #                       
         GOTOR (#IOEXEC,AIOEXEC),'IORDUPD+IODIR+IO6'                            
         JE    UPLUMD04                                                         
         TM    IOERR,IOERNF        TEST NOT FOUND                               
         JZ    UPLUMDN                                                          
         MVI   OFFDAACT,OFFDAADD   SET TO ADD RECORD                            
         J     UPLUMD05                                                         
                                                                                
UPLUMD04 GOTOR (#IOEXEC,AIOEXEC),'IOGETRUP+IOFIL+IO6'                           
         JNE   UPLUMDN                                                          
         MVI   OFFDAACT,OFFDAPUT   SET TO PUT RECORD                            
                                                                                
         USING DAREMGOD,R2         R2=A(OFFER DEMO RECORD)                      
UPLUMD05 L     R2,AIO6             BUILD OFFER DEMO RECORD                      
         L     R1,AIO5             R1=A(OFFER RECORD)                           
         MVC   MOKEY,0(R1)         COPY KEY FROM OFFER RECORD                   
         MVI   MOKSEQ,MOKSEQDQ     SET SEQUENCE NUMBER OF DEMO RECORD           
         XC    MORSTAT(MORFRST+1-MORSTAT),MORSTAT                               
         MVC   MORAGY,MORAGY-MOKEY(R1)                                          
         MHI   R0,MORFRST+1-DAREMGOD                                            
         STCM  R0,3,MORLEN         SET INITIAL RECORD LENGTH                    
         J     UPLUMD10                                                         
*                                                                               
* THIS IS CABLE MAKEGOOD, READ XSPOT FILE                                       
*                                                                               
UPLUMD06 GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOXSPFIL+IO5'                           
         JNE   UPLUMDN                                                          
                                                                                
         L     R2,IOADDR              R2=A(OFFER RECORD)                        
         MVC   MOK.MOXKEY,0(R2)                                                 
         MVI   MOK.MOXKDTYP,MOXKDDMQ  X'FF' - DEMO REC SEQ #                    
         GOTOR (#IOEXEC,AIOEXEC),'IORDUPD+IOXSPDIR+IO6'                         
         JE    UPLUMD07                                                         
         TM    IOERR,IOERNF        TEST NOT FOUND                               
         JZ    UPLUMDN                                                          
         MVI   OFFDAACT,OFFDAADD   SET TO ADD RECORD                            
         J     UPLUMD08                                                         
                                                                                
UPLUMD07 GOTOR (#IOEXEC,AIOEXEC),'IOGETRUP+IOXSPFIL+IO6'                        
         JNE   UPLUMDN                                                          
         MVI   OFFDAACT,OFFDAPUT   SET TO PUT RECORD                            
*                                                                               
         USING DAREMGOD,R2         R2=A(OFFER DEMO RECORD)                      
UPLUMD08 L     R2,AIO6             BUILD OFFER DEMO RECORD                      
         L     R1,AIO5             R1=A(OFFER RECORD)                           
         MVC   MOXKEY,0(R1)        COPY KEY FROM OFFER RECORD                   
         MVI   MOXKDTYP,MOXKDDMQ   SET SEQUENCE NUMBER OF DEMO RECORD           
         XC    MOXRSTAT(MOXFRST+1-MOXRSTAT),MOXRSTAT                            
         MVC   MOXRAGY,MOXRAGY-MOKEY(R1)                                        
         LHI   R0,MOXFRST+1-DAREMGOD                                            
         STCM  R0,3,MOXRLEN        SET INITIAL RECORD LENGTH                    
*                                                                               
UPLUMD10 CLI   OFFDAACT,OFFDAERR   TEST OFFER IN ERROR                          
         BE    EXITY                                                            
                                                                                
         L     R2,AIO6             R2=A(OFFER DEMO RECORD)                      
         SR    R3,R3                                                            
         ICM   R3,7,ATOK           POINT TO DEMO WMP ENTRY                      
         JZ    *+2                                                              
         AHI   R3,LW_LN1Q          POINT TO UPLOAD DEMO ELEMENT                 
         USING MODMELD,R3                                                       
         CLI   MODMEL,MODMELQ      ENSURE POINTING TO A DEMO ELEMENT            
         JNE   *+2                                                              
         LLC   R1,MODMLEN                                                       
         SHI   R1,MODMOVRH                                                      
         SRL   R1,3                R1=NUMBER OF DEMO CATEGORIES                 
                                                                                
         LA    R4,MORFRST                                                       
         CLI   OFFFILE,C'X'        SPOT OR XSPOT?                               
         JNE   *+8                                                              
         LA    R4,MOXFRST                                                       
         USING MODCELD,R4          R4=A(DEMO CATEGORY ELEMENT)                  
         CLI   MODCEL,EOR          TEST VIRGIN RECORD                           
         JNE   UPLUMD18                                                         
                                                                                
         MVI   MODCEL,MODCELQ      BUILD DEMO CATEGORY ELEMENT                  
         LA    RE,MODMDEMO                                                      
         LA    RF,MODCDEMO                                                      
         LR    R0,R1                                                            
UPLUMD14 MVC   0(L'MODCDEMO,RF),0(RE)                                           
         AHI   RF,L'MODCDEMO                                                    
         AHI   RE,L'MODMDEMO                                                    
         JCT   R0,UPLUMD14                                                      
         SR    RF,R4                                                            
         STC   RF,MODCLEN                                                       
         AR    R4,RF                                                            
                                                                                
         USING MODVELD,R4                                                       
         MVI   MODVEL,MODVELQ      BUILD DEMO VALUE ELEMENT                     
         MVC   MODVOFFR(L'MODVOFFR+L'MODVREC),MODMOFFR                          
         LA    RE,MODMDEMO+4                                                    
         LA    RF,MODVDEMO                                                      
         LR    R0,R1                                                            
UPLUMD16 MVC   0(L'MODVDEMO,RF),0(RE)                                           
         AHI   RF,L'MODVDEMO                                                    
         AHI   RE,L'MODMDEMO                                                    
         JCT   R0,UPLUMD16                                                      
         SR    RF,R4                                                            
         STC   RF,MODVLEN                                                       
         AR    R4,RF                                                            
                                                                                
         MVI   0(R4),EOR           SET END OF RECORD                            
         AHI   R4,1                                                             
         SR    R4,R2                                                            
         LA    RF,MORLEN                                                        
         CLI   OFFFILE,C'X'        SPOT OR XSPOT?                               
         JNE   *+8                                                              
         LA    RF,MOXRLEN                                                       
         STCM  R4,3,0(RF)          SET RECORD LENGTH                            
         B     EXITY                                                            
                                                                                
         USING MODCELD,R4                                                       
UPLUMD18 CLI   MODCEL,MODCELQ      TEST DEMO CATEGORY ELEMENT                   
         JNE   *+2                                                              
         SR    RE,RE                                                            
         LLC   RF,MODCLEN                                                       
         LHI   R0,L'MODCDEMO                                                    
         DR    RE,R0                                                            
         LTR   R0,RF                                                            
         JZ    *+2                                                              
         STC   R1,BYTE1            SAVE CURRENT NUMBER OF CATEGORIES            
         STC   R1,BYTE2            USED FOR ASSIGNING NEW CATEGORIES            
         LA    R6,MODMDEMO         R6=A(DEMO CATEGORY/VALUE)                    
                                                                                
UPLUMD20 LA    RE,MODCDEMO         LOCATE CATEGORY IN CURRENT LIST              
         USING MODCDEMO,RE                                                      
         LLC   R0,BYTE1            R0=CATEGORY COUNT                            
         LHI   R7,1                R7=CATEGORY INDEX                            
                                                                                
UPLUMD25 CLC   MODCDEMO,0(R6)      MATCH DEMO CATEGORY TO LIST                  
         JE    UPLUMD30                                                         
         AHI   RE,L'MODCDEMO                                                    
         AHI   R7,1                                                             
         JCT   R0,UPLUMD25                                                      
         DROP  RE                                                               
                                                                                
         LLC   R0,BYTE2            ASSIGN NEW CATEGORY SEQUENCE NUMBER          
         AHI   R0,1                                                             
         STC   R0,BYTE2                                                         
         MVC   3(1,R6),BYTE2                                                    
         J     UPLUMD35                                                         
                                                                                
UPLUMD30 STC   R7,3(R6)            SET CURRENT SLOT NUMBER FOR CATEGORY         
                                                                                
UPLUMD35 AHI   R6,L'MODMDEMO       BUMP TO NEXT DEMO CATEGORY/VALUE             
         JCT   R1,UPLUMD20         DO FOR NUMBER OF DEMOS                       
                                                                                
         CLC   BYTE2,BYTE1         TEST ANY NEW DEMO CATEGORIES                 
         JNH   UPLUMD47                                                         
         MVC   ELEM,MODCEL         EXTRACT CURRENT CATEGORY ELEMENT             
         GOTOR ARECUP,DMCB,(C'S',AIO6),(R4)                                     
         ORG   *-2                                                              
         CLI   OFFFILE,C'X'        CABLE?                                       
         JNE   *+8                  NO                                          
         MVI   DMCB,C'T'           YES, SET X-SPOT SYSTEM CODE                  
         BASR  RE,RF                                                            
                                                                                
         LA    R4,ELEM                                                          
         LLC   RE,BYTE2                                                         
         LLC   RF,BYTE1                                                         
         SR    RE,RF               RE=NUMBER OF NEW DEMO CATEGORIES             
         MHI   RE,L'MODCDEMO                                                    
         LLC   RF,MODCLEN                                                       
         AR    RF,RE                                                            
         STC   RF,MODCLEN                                                       
         GOTOR ARECUP,DMCB,(C'S',AIO6),ELEM,(R4)                                
         ORG   *-2                                                              
         CLI   OFFFILE,C'X'        CABLE?                                       
         JNE   *+8                  NO                                          
         MVI   DMCB,C'T'           YES, SET X-SPOT SYSTEM CODE                  
         BASR  RE,RF                                                            
                                                                                
         LA    R4,MORFRST          POINT TO WHERE CATEGORY ELEMENT              
         CLI   OFFFILE,C'X'        CABLE?                                       
         JNE   *+8                                                              
         LA    R4,MOXFRST          POINT TO WHERE CATEGORY ELEMENT              
         CLI   MODCEL,MODCELQ      SHOULD BE AND ENSURE IT'S THERE              
         JNE   *+2                                                              
                                                                                
         LA    R1,MODMDEMO                                                      
         LLC   R0,BYTE1                                                         
UPLUMD40 CLC   3(1,R1),BYTE1       TEST NEW DEMO CATEGORY                       
         JNH   UPLUMD45                                                         
         LLC   RE,3(R1)                                                         
         BCTR  RE,0                                                             
         MHI   RE,L'MODCDEMO       SLOT#-1*WIDTH                                
         LA    RE,MODCDEMO(RE)     +A(FIRST SLOT)                               
         MVC   0(L'MODCDEMO,RE),0(R1)                                           
UPLUMD45 AHI   R1,L'MODMDEMO       BUMP TO NEXT DEMO                            
         JCT   R0,UPLUMD40         DO FOR NUMBER OF ENTRIES IN LIST             
         DROP  R4                                                               
*                                                                               
UPLUMD47 LA    R4,MORFRST          POINT TO WHERE CATEGORY ELEMENT              
         CLI   OFFFILE,C'X'        CABLE?                                       
         JNE   *+8                                                              
         LA    R4,MOXFRST          POINT TO WHERE CATEGORY ELEMENT              
         USING MODVELD,R4                                                       
UPLUMD50 CLI   MODVEL,0            EOR?                                         
         JE    UPLUMD80             NO MATCH FOUND, SKIP DELETE                 
         CLI   MODVEL,MODVELQ      X'6F'     MG DEMO VALUE ELEM                 
         JNE   UPLUMD55                                                         
         CLC   MODVOFFR,MODMOFFR   MATCH ON OFFER#?                             
         JL    UPLUMD55             LESS THAN                                   
         JH    UPLUMD80                                                         
         CLC   MODVREC,MODMREC                                                  
         JE    UPLUMD60            FOUND MATCH, LETS DELETE IT                  
         JH    UPLUMD80             NO MATCH FOUND, SKIP DELETE                 
UPLUMD55 LLC   R0,1(R4)                                                         
         AR    R4,R0                                                            
         J     UPLUMD50                                                         
         DROP  R4                                                               
                                                                                
UPLUMD60 GOTOR ARECUP,DMCB,(C'S',AIO6),(R4)                                     
         ORG   *-2                                                              
         CLI   OFFFILE,C'X'        CABLE?                                       
         JNE   *+8                  NO                                          
         MVI   DMCB,C'T'           YES, SET X-SPOT SYSTEM CODE                  
         BASR  RE,RF                                                            
                                                                                
UPLUMD80 LA    RF,ELEM                                                          
         USING MODVELD,RF          BUILD DEMO VALUE ELEMENT                     
         XC    MODVELD(L'ELEM),MODVELD                                          
         MVI   MODVEL,MODVELQ                                                   
         MVC   MODVOFFR(L'MODVOFFR+L'MODVREC),MODMOFFR                          
         LLC   RE,BYTE2                                                         
         MHI   RE,L'MODVDEMO                                                    
         AHI   RE,MODVLN1Q                                                      
         STC   RE,MODVLEN                                                       
                                                                                
         LA    R1,MODMDEMO                                                      
         LLC   R0,BYTE1                                                         
UPLUMD90 LLC   RE,3(R1)            ADD TO CORRECT SLOT                          
         BCTR  RE,0                                                             
         MHI   RE,L'MODVDEMO       SLOT#-1*WIDTH                                
         LA    RE,MODVDEMO(RE)     +A(FIRST SLOT)                               
         MVC   0(L'MODVDEMO,RE),4(R1)                                           
UPLUMD95 AHI   R1,L'MODMDEMO       BUMP TO NEXT DEMO                            
         JCT   R0,UPLUMD90         DO FOR NUMBER OF ENTRIES IN LIST             
         DROP  RF                                                               
                                                                                
         GOTOR ARECUP,DMCB,(C'S',AIO6),ELEM,(R4)                                
         ORG   *-2                                                              
         CLI   OFFFILE,C'X'        CABLE?                                       
         JNE   *+8                  NO                                          
         MVI   DMCB,C'T'           YES, SET X-SPOT SYSTEM CODE                  
         BASR  RE,RF                                                            
         J     EXITY                                                            
                                                                                
UPLUMDN  MVI   OFFDAACT,OFFDAERR   SET OFFER RECORD IN ERROR                    
         B     EXITY                                                            
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* ADD/WRITE LAST OFFER DEMO RECORD                                    *         
***********************************************************************         
                                                                                
PUTDEM   NTR1  LABEL=NO                                                         
         OC    OFFDASV,OFFDASV     TEST ANY UPLOAD ACTIVITY                     
         JZ    PUTDEMX                                                          
         CLI   OFFDAACT,OFFDAERR   TEST OFFER RECORD IN ERROR                   
         JE    PUTDEMX                                                          
         CLI   OFFFLSV,C'X'        SPOT OR XSPOT?                               
         JE    PUTDEM10                                                         
                                                                                
         CLI   OFFDAACT,OFFDAADD   TEST ADDING NEW RECORD                       
         JNE   PUTDEM05                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOADDMNT+IOFIL+IO6'                           
         JE    PUTDEMX                                                          
         DC    H'0'                                                             
                                                                                
PUTDEM05 CLI   OFFDAACT,OFFDAPUT   TEST PUTTING EXISTING RECORD                 
         JNE   *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOPUTMNT+IOFIL+IO6'                           
         JNE   *+2                                                              
         L     R1,IOADDR                                                        
         MVC   IOKEY(L'MOKEY),0(R1)                                             
         MVC   IOKEY+L'MOKEY(L'MORSTAT),MORSTAT-DAREMGOD(R1)                    
         MVC   IOKEY+L'MOKEY+L'MORSTAT(L'IODA),IODA                             
         GOTOR (#IOEXEC,AIOEXEC),'IOWRT+IODIR+IO6'                              
         JE    PUTDEMX                                                          
         DC    H'0'                                                             
                                                                                
PUTDEM10 CLI   OFFDAACT,OFFDAADD   TEST ADDING NEW RECORD                       
         JNE   PUTDEM15                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOADDMNT+IOXSPFIL+IO6'                        
         JE    PUTDEMX                                                          
         DC    H'0'                                                             
                                                                                
PUTDEM15 CLI   OFFDAACT,OFFDAPUT   TEST PUTTING EXISTING RECORD                 
         JNE   *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOPUTMNT+IOXSPFIL+IO6'                        
         JNE   *+2                                                              
         L     R1,IOADDR                                                        
         MVC   IOKEY(L'MOXKEY),0(R1)                                            
         MVC   IOKEY+L'MOXKEY(L'MOXRSTAT),MOXRSTAT-DAREMGOD(R1)                 
         MVC   IOKEY+L'MOXKEY+L'MOXKSTAT(L'IODA),IODA                           
         GOTOR (#IOEXEC,AIOEXEC),'IOWRT+IOXSPDIR+IO6'                           
         JNE   *+2                                                              
PUTDEMX  MVC   OFFDASV,OFFDA                                                    
         MVC   OFFFLSV,OFFFILE                                                  
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* STANDARD COMMENT DOWNLOAD  X'00D2'                                  *         
***********************************************************************         
                                                                                
REQSCO   LKREQ H,I#SDSCMD,OUTSDSC,NEXTREQ=REQUMD                                
Media    LKREQ F,1,(D,B#SAVED,RQMEDIA),(U,#VALMED,$VALMED),            +        
               OLEN=L'RQMEDIA,MAXLEN=L'RQMEDIA,TEXT=SP#MED,COL=*                
ComCd    LKREQ F,2,(I,B#SAVED,COMIND),CHAR,LIST=Y,DEFAULT=Y,           +        
               OLEN=L'COMKCOM,TEXT=SP#COMCD,COL=*                               
         LKREQ E                                                                
                                                                                
OUTSDSC  LKOUT H                   ** STANDARD COMMENT **                       
                                                                                
SDCOMM   LKOUT R,X'00D2'                                                        
Array    LKOUT C,X'00D2',(A,ARYSDSC)                                            
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR STANDARD COMMENT DOWNLOAD                      *         
***********************************************************************         
                                                                                
ARYSDSC  LKOUT A,(R,NXTSDS),MULTIROW=Y,ROWNAME=COMRECD                          
ComCd    LKOUT C,1,COMKCOM,CHAR                                                 
Array    LKOUT C,255,(A,ARYCTXT)                                                
         LKOUT E                                                                
                                                                                
ARYCTXT  LKOUT A,(D,B#COMREC,COMRELEM),EOT=0,                          +        
               ROWID=(COMTXTD,COMTXTEQ),ROWWIDTH=(V,COMTXTLN)                   
ComTL    LKOUT C,1,COMTXTTX,CHAR,LEN=V,MAPMOD1=COMTXTSQ                         
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET NEXT STANDARD COMMENT RECORD                                    *         
***********************************************************************         
                                                                                
NXTSDS   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTSDS02                                                         
         OC    ACOM,ACOM           TEST ANY STANDARD COMMENTS REQUESTED         
         BZ    NOMORE              NO - DO NOTHING                              
                                                                                
NXTSDS02 GOTOR (#NXTREC,ANXTREC),DMCB,COMKEYT,('B#COMREC',0),SAVED,0,0          
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* UPLOAD MAKEGOOD DEMOS  X'00E8'                                      *         
***********************************************************************         
                                                                                
REQUMD   LKREQ H,I#SDOUMD,OUTUMD,NEXTREQ=REQBYR                                 
OffDA    LKREQ F,1,(D,B#SAVED,OFFDA),CHAR,TEXT=SP#SDBDA,COL=*                   
FileType LKREQ F,2,(D,B#SAVED,OFFFILE),CHAR,TEXT=SP#1BFIL,COL=*                 
DemEl    LKREQ F,3,(I,B#SAVED,TOKIND),CHAR,TEXT=SP#1BDEM,OLEN=0,COL=*           
         LKREQ E                                                                
                                                                                
OUTUMD   DS    0X                  DUMMY OUTPUT POINTER FOR UPLOAD              
         EJECT                                                                  
***********************************************************************         
* BUYER DOWNLOAD  X'00D3'                                             *         
***********************************************************************         
                                                                                
REQBYR   LKREQ H,I#SDBYRD,OUTBYR,NEXTREQ=REQSAL                                 
Media    LKREQ F,1,(D,B#SAVED,RQMEDIA),(U,#VALMED,$VALMED),            +        
               OLEN=L'RQMEDIA,MAXLEN=L'RQMEDIA,TEXT=SP#MED,COL=*                
ByrCd    LKREQ F,2,(I,B#SAVED,BYRIND),CHAR,LIST=F,DEFAULT=Y,           +        
               OLEN=L'BYRKBYR,TEXT=SP#BUYER,COL=*                               
         LKREQ E                                                                
                                                                                
OUTBYR   LKOUT H                   ** BUYER **                                  
                                                                                
SDBUYR   LKOUT R,X'00D3'                                                        
Array    LKOUT C,X'00D3',(A,ARYBYR)                                             
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR BUYER DOWNLOAD                                 *         
***********************************************************************         
                                                                                
ARYBYR   LKOUT A,(R,NXTBYR),MULTIROW=Y,ROWNAME=BYRRECD                          
ByrMed   LKOUT C,1,BYRKAM,(U,#EDTMED,$EDTMED)                                   
ByrCd    LKOUT C,2,BYRKBYR,CHAR                                                 
Array    LKOUT C,255,(A,ARYBYRD)                                                
Array    LKOUT C,255,(A,ARYBYRD2)                                               
Array    LKOUT C,255,(A,ARYBYRC)                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* DOWNLOAD BUYER RECORDS                                              *         
***********************************************************************         
                                                                                
NXTBYR   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTBYR02                                                         
         OC    ABYR,ABYR           TEST ANY BUYER CODES REQUESTED               
         BZ    NOMORE              NO - DO NOTHING                              
                                                                                
NXTBYR02 GOTOR (#NXTREC,ANXTREC),DMCB,BYRKEYT,('B#BYRREC',0),SAVED,0,0          
         BNE   NOMORE                                                           
         L     R2,IOADDR                                                        
         USING BYRKEY,R2                                                        
         LA    R2,BYRRELEM                                                      
NXTBYR04 CLI   0(R2),0                                                          
         BE    EXITY                                                            
         CLI   0(R2),BYRDCD2Q      X'11' ELEM                                   
         JE    NXTBYR06                                                         
         LLC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         J     NXTBYR04                                                         
NXTBYR06 TM    BYRMFLG1-BYRDSCD2(R2),BYRMFDAC  DEACTIVATED?                     
         JNZ   NXTBYR02                        YES, SKIP THIS BUYER             
         B     EXITY                                                            
                                                                                
ARYBYRD  LKOUT A,(D,B#BYRREC,BYRRELEM),EOT=0,                          +        
               ROWID=(BYRDSCD,BYRDCDQ),ROWWIDTH=(V,BYRDSLN)                     
ByrNm    LKOUT C,3,BYRFNAME,CHAR                                                
TelNo    LKOUT C,8,BYRPHONE,CHAR,PCVERSION=3.0.0.120                            
         LKOUT E                                                                
                                                                                
ARYBYRD2 LKOUT A,(D,B#BYRREC,BYRRELEM),EOT=0,                          +        
               ROWID=(BYRDSCD2,BYRDCD2Q),ROWWIDTH=(V,BYRDSLN2)                  
SBPrf    LKOUT C,4,BYRBRWPF,CHAR,ND=Y                                           
         LKOUT E                                                                
                                                                                
ARYBYRC  LKOUT A,(D,B#BYRREC,BYRRELEM),EOT=0,                          +        
               ROWID=(BYRCMTD,BYRCMCDQ),ROWWIDTH=(V,BYRCMLN)                    
ByrSC    LKOUT C,5,BYRSCMNT,CHAR,ND=Y                                           
ByrC1    LKOUT C,6,BYROCMT1,CHAR,ND=Y                                           
ByrC2    LKOUT C,7,BYROCMT2,CHAR,ND=Y                                           
         LKOUT E                                                                
                                                                                
         EJECT                                                                  
***********************************************************************         
* RADIO SALESPERSON DOWNLOAD  X'00D7'                                 *         
***********************************************************************         
                                                                                
REQSAL   LKREQ H,I#SDSALD,OUTSDSAL,NEXTREQ=REQOCO                               
UsrID    LKREQ F,1,(D,B#SAVED,REPAGY),(R,VALUID),MAXLEN=L'CTIKID,      +        
               TEXT=SP#REPR,COL=*                                               
PType    LKREQ F,2,(D,B#SAVED,PERTYPE),CHAR,TEXT=SP#TYPE,COL=*                  
         LKREQ E                                                                
                                                                                
OUTSDSAL LKOUT H                   ** RADIO SALESPERSON **                      
                                                                                
SDRSAL   LKOUT R,X'00D7'                                                        
Array    LKOUT C,X'00D7',(A,ARYRSAL)                                            
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR RADIO PERSON DOWNLOAD                          *         
***********************************************************************         
                                                                                
ARYRSAL  LKOUT A,(R,NXTSAL),MULTIROW=Y,ROWNAME=GSPLRECD                         
Array    LKOUT C,255,(A,ARYSAL2)                                                
Array    LKOUT C,255,(A,ARYSAL1),FILTROUT=HAVEX02                               
PerCd    LKOUT C,3,(D,B#SALREC,GSPLKSAL),UBIN                                   
AlphCd   LKOUT C,4,(D,B#SALREC,GSPLKSRP),CHAR                                   
         LKOUT E                                                                
                                                                                
***********************************************************************         
* DOWNLOAD RADIO SALESPERSON RECORDS                                  *         
***********************************************************************         
                                                                                
NXTSAL   CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTSAL04                                                         
                                                                                
         LA    R2,IOKEY            CHECK IF THIS IS A SUBSIDIARY REP            
         USING GSPLRECD,R2                                                      
         XC    GSPLKEY,GSPLKEY                                                  
         MVI   GSPLKTYP,GSPLRECQ                                                
         MVC   GSPLKRP1,REPAGY                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IOHI+IOGENDIR+IO3'                            
                                                                                
         CLC   GSPLKEY(GSPLKRP2-GSPLKEY),IOKEYSAV  SUBSIDIARY REP?              
         JNE   NXTSAL02                            NO                           
         MVC   REPAGY,GSPLKRP2     YES, MOVE IN MASTER REP                      
         CLI   PERTYPE,C'P'        ARE WE DOING POINTPERSON?                    
         JNE   NXTSAL02            NO                                           
         OC    GSPLMRP,GSPLMRP     YES, DO WE HAVE A NEW MASTER REP?            
         JZ    NXTSAL02            NO                                           
         MVC   REPAGY,GSPLMRP      YES, USE THAT ONE                            
         DROP  R2                                                               
                                                                                
NXTSAL02 CLI   PERTYPE,C'P'        ARE WE DOING POINTPERSON?                    
         MVI   PERTYPE,2                                                        
         JE    NXTSAL04            NO                                           
         MVI   PERTYPE,1                                                        
                                                                                
NXTSAL04 GOTOR (#NXTREC,ANXTREC),DMCB,SALKEYT,('B#SALREC',0),          +        
               ('$NXTRGEN',SAVED),0,0                                           
         XC    WORK(L'GSPLNFLS+L'GSPLNFFR),WORK                                 
         B     EXITY                                                            
                                                                                
ARYSAL2  LKOUT A,(D,B#SALREC,GSPLSBCD),EOT=0,                          +        
               ROWID=(GSPLNFCD,X'02'),ROWWIDTH=(V,GSPLNFLN)                     
PRout    LKOUT P,GSPLNFCD,SETSAL                                                
Pname    LKOUT C,1,(D,B#WORKD,WORK),CHAR,LEN=L'GSPLNFLS+L'GSPLNFFR              
OffCd    LKOUT C,2,(D,B#SAVED,REPOFF),CHAR                                      
         LKOUT E                                                                
                                                                                
ARYSAL1  LKOUT A,(D,B#SALREC,GSPLSBCD),EOT=0,                          +        
               ROWID=(GSPLSPCD,X'01'),ROWWIDTH=(V,GSPLSPLN)                     
PName    LKOUT C,1,GSPLSPNM,CHAR                                                
OffCd    LKOUT C,2,GSPLSPOF,CHAR                                                
         LKOUT E                                                                
                                                                                
HAVEX02  OC    WORK(L'GSPLNFLS+L'GSPLNFFR),WORK                                 
         BR    RE                                                               
                                                                                
SETSAL   L     R1,LP_AINP                                                       
         USING GSPLNFCD,R1                                                      
         MVC   WORK(L'GSPLNFFR),GSPLNFFR                                        
         LA    R2,WORK+L'GSPLNFFR-1                                             
SETSAL02 CLI   0(R2),C' '                                                       
         JH    *+8                                                              
         JCT   R2,SETSAL02                                                      
         LA    R2,2(R2)                                                         
         MVC   0(L'GSPLNFFR,R2),GSPLNFLS                                        
         B     EXITY                                                            
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* ORDER COMMENT DOWNLOAD  X'00D9'                                     *         
***********************************************************************         
                                                                                
REQOCO   LKREQ H,I#SDOCOD,OUTSDOCO,NEXTREQ=REQSTC                               
Media    LKREQ F,1,(D,B#SAVED,RQMEDIA),(U,#VALMED,$VALMED),            +        
               OLEN=L'RQMEDIA,MAXLEN=L'RQMEDIA,TEXT=SP#MED,COL=*                
CltCd    LKREQ F,2,(D,B#WORKD,QCLTX),(U,#VALCLT,$VALCLT),              +        
               OLEN=L'QCLTX,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*                    
PrdCd    LKREQ F,3,(D,B#SAVED,PRDCDE),(R,VALPRC),                      +        
               OLEN=L'PRDCDE,MAXLEN=L'PRDCDE,TEXT=SP#PRO,COL=*                  
EstNo    LKREQ F,4,(D,B#SAVED,ESTNO),UBIN,                             +        
               OLEN=L'ESTNO,MAXLEN=3,TEXT=SP#EST,COL=*                          
FltNo    LKREQ F,5,(D,B#SAVED,FLTNO),UBIN,                             +        
               OLEN=L'FLTNO,MAXLEN=L'FLTNO,TEXT=SP#FLGHT,COL=*                  
         LKREQ E                                                                
                                                                                
OUTSDOCO LKOUT H                   ** ORDER COMMENT **                          
                                                                                
SDOCOM   LKOUT R,X'00D9'                                                        
Array    LKOUT C,X'00D9',(A,ARYACOM)                                            
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OCOM DOWNLOAD                                  *         
***********************************************************************         
                                                                                
ARYACOM  LKOUT A,(R,NXTCOM),MULTIROW=Y,ROWNAME=OCOMHDR                          
Media    LKOUT C,1,OCOMKAGY,(U,#EDTMED,$EDTMED)                                 
CliCd    LKOUT C,2,OCOMKCLT,(U,#EDTCLT,$EDTCLT),LEN=3,ND=Y                      
PrdCd    LKOUT C,3,OCOMKPRD,(R,EDTPRC),LEN=L'OCOMKPRD,ND=Y                      
EstNo    LKOUT C,4,OCOMKEST,UBIN,ND=Y                                           
FltNo    LKOUT C,5,OCOMKFLT,UBIN,ND=Y,FILTROUT=TSTOCOY                          
StaCd    LKOUT C,5,OCOMKSTA,(R,EDTSTC),LEN=L'OCOMKSTA,ND=Y,            +        
               FILTROUT=TSTSCOY                                                 
MktCd    LKOUT C,6,OCOMKSTA,(R,EDTSTC),LEN=L'OCOMKSTA,ND=Y,            +        
               FILTROUT=TSTSMCOY                                                
MktCd    LKOUT C,6,OCOMKMKT,UBIN,ND=Y,FILTROUT=TSTMCOY                          
Array    LKOUT C,255,(A,ARYCOM)                                                 
         LKOUT E                                                                
                                                                                
TSTOCOY  CLC   LP_QMAPN,SDOCOM#    TEST OCOM DOWNLOAD                           
         BER   RE                                                               
         CLC   LP_QMAPN,SDBOX#     TEST BATCH ORDER EXPORT D/L                  
         BR    RE                                                               
                                                                                
TSTSCOY  CLC   LP_QMAPN,SDSCOM#    TEST SCOM DOWNLOAD                           
         BNER  RE                                                               
         L     R1,LP_ADATA                                                      
         USING OCOMHDR,R1                                                       
         OC    OCOMKSTA,OCOMKSTA   ALL STATION REQUEST                          
         BZR   RE                                                               
         CLI   OCOMKSTA,0          TEST MARKET LEVEL REQUEST                    
         B     SETCCC                                                           
                                                                                
TSTSMCOY CLC   LP_QMAPN,SDSCOM#    TEST SCOM DOWNLOAD                           
         BNER  RE                                                               
         L     R1,LP_ADATA                                                      
         OC    OCOMKSTA,OCOMKSTA   ALL STATION REQUEST                          
         BZ    SETCCC                                                           
         CLI   OCOMKSTA,0          TEST MARKET LEVEL REQUEST                    
         BR    RE                                                               
         DROP  R1                                                               
                                                                                
TSTMCOY  CLC   LP_QMAPN,SDMCOM#    TEST MCOM DOWNLOAD                           
         BR    RE                                                               
                                                                                
***********************************************************************         
* DOWNLOAD ORDER COMMENT RECORDS                                      *         
***********************************************************************         
                                                                                
NXTCOM   MVC   LP_ADATA,AOCOREC                                                 
                                                                                
         CLC   LP_QMAPN,SDBOX#     TEST BATCH ORDER EXPORT                      
         JE    NXTCOM02                                                         
                                                                                
         CLC   LP_QMAPN,SDOCOM#    TEST OCOM DOWNLOAD                           
         JNE   NXTCOM30                                                         
                                                                                
         CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTCOM12                                                         
         J     NXTCOM10                                                         
                                                                                
NXTCOM02 CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTCOM04                                                         
         OC    APEF,APEF           TEST ANY PRODUCT/ESTIMATE/FLIGHTS            
         BZ    NOMORE              NO - DO NOTHING                              
         OC    QCLTX,QCLTX         TEST WE HAVE A CLIENT                        
         BZ    NOMORE              NO - CAN'T DO ANYTHING                       
         GOTOR (#GETCLT,AGETCLT)   GET CLIENT RECORD                            
         JNE   *+2                 DIE IF WE HAVE A BAD CLIENT                  
         XR    RE,RE                                                            
         ICM   RE,7,APEF           POINT TO PRD/EST/FLT ARRAY                   
         MVC   PEFIND,LW_NUMN+1-LW_D(RE)                                        
         AHI   RE,LW_LN2Q                                                       
         STCM  RE,7,APEF           POINT TO FIRST ROW OF ARRAY                  
         J     NXTCOM06                                                         
                                                                                
NXTCOM04 CLI   BYTE,1              TEST ALL PREVIOUS LEVELS READ                
         JNE   NXTCOM12                                                         
                                                                                
NXTCOM06 SR    R0,R0               SET FIRST/NEXT PRD/EST/FLT                   
         ICM   R0,1,PEFIND                                                      
         BZ    NOMORE                                                           
         BCTR  R0,0                                                             
         STC   R0,PEFIND                                                        
         ICM   R1,7,APEF                                                        
         MVC   PRDCDE,0(R1)                                                     
         MVC   ESTNO,L'PKEYPRD(R1)                                              
         MVC   FLTNO,L'PKEYPRD+L'ESTNO(R1)                                      
         AHI   R1,L'PKEYPRD+L'OCOMKEST+L'OCOMKFLT                               
         STCM  R1,7,APEF                                                        
         GOTOR (#VALPRD,AVALPRD),DMCB,PRDCDE,L'PRDCDE,WORK                      
         JNE   *+2                 DIE IF WE HAVE A BAD PRODUCT                 
         LLC   R0,WORK                                                          
         STCM  R0,7,PRDCDE                                                      
                                                                                
NXTCOM10 MVI   BYTE,5              BUILD KEY FOR FIRST READ                     
         USING OCOMHDR,IOKEY                                                    
         XC    OCOMKEY,OCOMKEY                                                  
         MVI   OCOMKTYPE+0,X'0D'                                                
         MVI   OCOMKTYPE+1,X'0C'                                                
         MVC   OCOMKAGY,RQMEDIA                                                 
         MVI   OCOMCTYPE,C'O'      O-ORDER COMMENTS                             
         MVC   OCOMKCLT,QCLTX                                                   
         MVC   OCOMKPRD,PRDCDE                                                  
         MVC   OCOMKEST,ESTNO                                                   
         MVC   OCOMKFLT,FLTNO      OCOM USES FLIGHT NUMBER                      
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOSPTDIR+B#OCOREC'                      
         JNE   NXTCOM12                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOSPTFIL+B#OCOREC'                     
         BE    EXITY                                                            
         DC    H'0'                                                             
                                                                                
NXTCOM12 CLI   BYTE,5                                                           
         JNE   NXTCOM16                                                         
         MVI   BYTE,4                                                           
         MVC   IOKEY,IOKEYSAV      RESTORE PREVIOUS KEY                         
         CLI   OCOMKFLT,0                                                       
         JE    NXTCOM14                                                         
         XC    OCOMKFLT,OCOMKFLT                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOSPTDIR+B#OCOREC'                      
         JNE   NXTCOM14                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOSPTFIL+B#OCOREC'                     
         BE    EXITY                                                            
         DC    H'0'                                                             
                                                                                
NXTCOM14 MVC   IOKEY,IOKEYSAV      RESTORE PREVIOUS KEY                         
         MVC   OCOMKPRD,ALLPRD                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOSPTDIR+B#OCOREC'                      
         JNE   NXTCOM16                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOSPTFIL+B#OCOREC'                     
         BE    EXITY                                                            
         DC    H'0'                                                             
                                                                                
NXTCOM16 CLI   BYTE,4                                                           
         JNE   NXTCOM18                                                         
         MVI   BYTE,3                                                           
         MVC   IOKEY,IOKEYSAV      RESTORE PREVIOUS KEY                         
         XC    OCOMKEST,OCOMKEST                                                
         MVC   OCOMKPRD,PRDCDE                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOSPTDIR+B#OCOREC'                      
         JNE   NXTCOM18                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOSPTFIL+B#OCOREC'                     
         BE    EXITY                                                            
         DC    H'0'                                                             
                                                                                
NXTCOM18 CLI   BYTE,3                                                           
         JNE   NXTCOM20                                                         
         MVI   BYTE,2                                                           
         MVC   IOKEY,IOKEYSAV      RESTORE PREVIOUS KEY                         
         XC    OCOMKPRD,OCOMKPRD                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOSPTDIR+B#OCOREC'                      
         JNE   NXTCOM20                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOSPTFIL+B#OCOREC'                     
         BE    EXITY                                                            
         DC    H'0'                                                             
                                                                                
NXTCOM20 CLI   BYTE,2                                                           
         JNE   NXTCOM22                                                         
         MVI   BYTE,1                                                           
         MVC   IOKEY,IOKEYSAV      RESTORE PREVIOUS KEY                         
         XC    OCOMKCLT,OCOMKCLT                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOSPTDIR+B#OCOREC'                      
         JNE   NXTCOM22                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOSPTFIL+B#OCOREC'                     
         BE    EXITY                                                            
         DC    H'0'                                                             
                                                                                
NXTCOM22 CLC   LP_QMAPN,SDBOX#     TEST BATCH ORDER EXPORT                      
         JE    NXTCOM04            YES - GET NEXT PRD/EST/FLT                   
         B     NOMORE                                                           
                                                                                
***********************************************************************         
* DOWNLOAD STATION AND MARKET COMMENTS                                *         
***********************************************************************         
                                                                                
NXTCOM30 CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTCOM36                                                         
                                                                                
         SR    RE,RE                                                            
         ICM   RE,7,APRD           POINT TO LIST OF PRODUCTS IN WMP             
         USING LW_D,RE                                                          
         SR    RF,RF                                                            
         ICM   RF,3,LW_NUMN        BUMP N'ENTRIES IN LIST                       
         AHI   RF,1                                                             
         STCM  RF,3,LW_NUMN                                                     
         SHI   RF,1                                                             
         MHI   RF,L'OCOMKPRD                                                    
         LA    RF,LW_DATA2(RF)     ADD POL PROD# TO LIST OF PRODUCTS            
         MVC   0(L'POLPRDX,RF),POLPRDX                                          
         DROP  RE                                                               
                                                                                
         CLC   LP_QMAPN,SDSCOM#    TEST SCOM DOWNLOAD                           
         JNE   NXTCOM34                                                         
                                                                                
         ICM   R2,7,AMKT           POINT TO LIST OF MARKETS IN WMP              
         USING LW_D,R2                                                          
         XC    WORK(L'WORK1+L'WORK2),WORK     CLEAR OUT WORK AREA               
         LA    RF,1                1 FOR ALL STATIONS                           
         SR    R1,R1                                                            
         ICM   R1,3,LW_NUMN        BUMP N'ENTRIES IN LIST                       
         AR    RF,R1                                                            
         ST    RF,FULL                                                          
         LA    RE,WORK+3           SKIP OVER ALL STATIONS                       
         LA    RF,LW_DATA2         POINT TO LIST OF MARKETS                     
NXTCOM32 MVC   1(L'OCOMKMKT,RE),0(RF)                                           
         LA    RE,L'QSTAX(RE)                                                   
         LA    RF,L'OCOMKMKT(RF)                                                
         JCT   R1,NXTCOM32                                                      
                                                                                
***********************************************************************         
* ADD EVERYTHING IN WORK TO START OF STATION LIST SINCE ALL STATIONS  *         
* AND MARKETS WILL HAVE TO COME BEFORE STATIONS SINCE BYTE 1 IS X'00' *         
***********************************************************************         
                                                                                
         ICM   R2,7,ASTATN         POINT TO LIST OF STATIONS IN WMP             
         L     RE,FULL                                                          
         LR    RF,RE                                                            
         MHI   RF,L'QSTAX          RF=LEN OF ENTRIES IN STA/MKT LIST            
         SR    R1,R1                                                            
         ICM   R1,3,LW_NUMN        BUMP N'ENTRIES IN LIST                       
         AR    RE,R1                                                            
         STCM  RE,3,LW_NUMN                                                     
         MHI   R1,L'QSTAX                                                       
         LA    RF,WORK(RF)         ADD STATIONS TO END OF WORK                  
         BASR  RE,0                                                             
         MVC   0(0,RF),LW_DATA2                                                 
         EX    R1,0(RE)                                                         
                                                                                
         SR    R1,R1               NOW PUT THEM BACK IN LW_DATA2                
         ICM   R1,3,LW_NUMN        BUMP N'ENTRIES IN LIST                       
         MHI   R1,L'QSTAX                                                       
         BASR  RE,0                                                             
         MVC   LW_DATA2(0),WORK                                                 
         EX    R1,0(RE)                                                         
         DROP  R2                                                               
                                                                                
NXTCOM34 CLC   LP_QMAPN,SDMCOM#    TEST MCOM DOWNLOAD                           
         JNE   NXTCOM36                                                         
                                                                                
         ICM   R2,7,AMKT           POINT TO LIST OF MARKETS IN WMP              
         USING LW_D,R2                                                          
         SR    R1,R1                                                            
         ICM   R1,3,LW_NUMN        BUMP N'ENTRIES IN LIST                       
         AHI   R1,1                ADD 1 FOR ALL MARKETS                        
         STCM  R1,3,LW_NUMN                                                     
         AHI   R1,-1                                                            
         MHI   R1,L'OCOMKMKT                                                    
         LA    RF,LW_DATA2                                                      
         BASR  RE,0                                                             
         MVC   L'OCOMKMKT(0,RF),0(RF)                                           
         EX    R1,0(RE)                                                         
         MVC   0(L'OCOMKMKT,RF),HZEROS                                          
         DROP  R2                                                               
                                                                                
NXTCOM36 LA    R0,OCSKEYT          STATION COMMENT DRIVER                       
         CLC   LP_QMAPN,SDSCOM#    DOING A STATION COMMENT DOWNLOAD?            
         JE    *+8                                                              
         LA    R0,OCMKEYT          MARKET COMMENT DRIVER                        
         GOTOR (#NXTREC,ANXTREC),DMCB,(R0),('B#COMREC',0),SAVED,0,0             
         B     EXITY                                                            
                                                                                
ARYCOM   LKOUT A,(D,B#OCOREC,OCOMEL),EOT=0,                            +        
               ROWID=(OCOMEL,OCOMELQ),ROWWIDTH=(V,OCOMELEN)                     
CText    LKOUT C,5,OCOMMENT,CHAR,MAPMOD=*,LEN=V,FILTROUT=TSTOCOY,ND=Y           
CText    LKOUT C,6,OCOMMENT,CHAR,MAPMOD=*,LEN=V,FILTROUT=TSTNOCOY,ND=Y          
         LKOUT E                                                                
                                                                                
TSTNOCOY CLC   LP_QMAPN,SDOCOM#    TEST NOT OCOM DOWNLOAD                       
         BE    SETCCC                                                           
         CLC   LP_QMAPN,SDBOX#     TEST NOT BATCH ORDER EXPORT D/L              
         B     SETCCC                                                           
         EJECT                                                                  
***********************************************************************         
* STATION COMMENT DOWNLOAD  X'00DB'                                   *         
***********************************************************************         
                                                                                
REQSTC   LKREQ H,I#SDSCOD,OUTSDSCO,NEXTREQ=REQMKC                               
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'OCOMKAGY,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                 
CltCd    LKREQ F,2,(I,B#SAVED,CLTIND),(U,#VALCLT,$VALCLT),             +        
               OLEN=L'OCOMKCLT,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*                 
PrdCd    LKREQ F,3,(I,B#SAVED,PRDIND),(R,VALPRC),LIST=F,               +        
               OLEN=L'OCOMKPRD,TEXT=SP#PRO,COL=*                                
EstNo    LKREQ F,4,(I,B#SAVED,ESTIND),LBIN,                            +        
               OLEN=L'OCOMKEST,MAXLEN=3,TEXT=SP#EST,COL=*                       
StNet    LKREQ F,5,(I,B#SAVED,STTNIND),(R,VALSTN),LIST=F,              +        
               OLEN=L'QSTAX,MAXLEN=L'QSTAA,TEXT=SP#STA,COL=*                    
MktNo    LKREQ F,6,(I,B#SAVED,MKTIND),(R,VALMKN),OLEN=L'OCOMKMKT,      +        
               LIST=F,DEFAULT=NOT,TEXT=SP#MKT,COL=*                             
         LKREQ E                                                                
                                                                                
OUTSDSCO LKOUT H                   ** STATION COMMENT **                        
                                                                                
SDSCOM   LKOUT R,O#SDSCOD                                                       
Array    LKOUT C,I#SDSCOD,(A,ARYACOM)                                           
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
         EJECT                                                                  
***********************************************************************         
* MARKET COMMENT DOWNLOAD  X'00DC'                                    *         
***********************************************************************         
                                                                                
REQMKC   LKREQ H,I#SDMCOD,OUTSDMCO,NEXTREQ=REQVSB                               
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'OCOMKAGY,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                 
CltCd    LKREQ F,2,(I,B#SAVED,CLTIND),(U,#VALCLT,$VALCLT),             +        
               OLEN=L'OCOMKCLT,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*                 
PrdCd    LKREQ F,3,(I,B#SAVED,PRDIND),(R,VALPRC),LIST=F,               +        
               OLEN=L'OCOMKPRD,MAXLEN=L'OCOMKPRD,TEXT=SP#PRO,COL=*              
EstNo    LKREQ F,4,(I,B#SAVED,ESTIND),LBIN,                            +        
               OLEN=L'OCOMKEST,MAXLEN=3,TEXT=SP#EST,COL=*                       
MktNo    LKREQ F,6,(I,B#SAVED,MKTIND),(R,VALMKN),OLEN=L'OCOMKMKT,      +        
               LIST=F,DEFAULT=NOT,TEXT=SP#MKT,COL=*                             
         LKREQ E                                                                
                                                                                
OUTSDMCO LKOUT H                   ** MARKET COMMENT **                         
                                                                                
SDMCOM   LKOUT R,O#SDMCOD                                                       
Array    LKOUT C,I#SDMCOD,(A,ARYACOM)                                           
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
         EJECT                                                                  
***********************************************************************         
* SUBSCRIBED ORDER DOWNLOAD VALIDATION  X'0084'                       *         
***********************************************************************         
                                                                                
REQVSB   LKREQ H,I#SDSUBV,OUTVSB,NEXTREQ=REQR4R                                 
                                                                                
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'RQMEDIA,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                  
Buyer    LKREQ F,2,(I,B#SAVED,BYRIND),CHAR,LIST=F,                     +        
               OLEN=L'BYRKBYR,TEXT=SP#SBYR,COL=*                                
CltCd    LKREQ F,3,(I,B#SAVED,CLTIND),CHAR,LIST=F,                     +        
               SORT=NO,OLEN=L'QCLTA,TEXT=SP#CLI,COL=*                           
MktNo    LKREQ F,4,(I,B#SAVED,MKTIND),(R,VALMKN),LIST=F,               +        
               SORT=NO,OLEN=L'MKTKMKT,TEXT=SP#MKT,COL=*                         
         LKREQ E                                                                
                                                                                
OUTVSB   LKOUT H                   ** VALIDATE SUBSCRIPTION **                  
                                                                                
SDVSUB   LKOUT R,X'0084'                                                        
PRout    LKOUT P,,SETMED                                                        
MedCd    LKOUT C,1,(D,B#SAVED,RQMEDIA),(U,#EDTMED,$EDTMED)                      
ByrCd    LKOUT C,2,(D,B#WORKD,WORK),CHAR,LEN=L'BYRKBYR,FILTROUT=GETBYR          
ByrNm    LKOUT C,3,(D,B#WORKD,WORK+L'BYRKBYR),CHAR,LEN=L'BYRFNAME,     +        
               FILTROUT=TSTVBYR                                                 
Array    LKOUT C,255,(A,ARYVCLT)                                                
Array    LKOUT C,255,(A,ARYVMKT)                                                
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
SETMED   ICM   RF,7,AMED           SET QMEDX/QMEDA/MEDIA                        
         MVC   QMEDX,LW_DATA1-LW_D(RF)                                          
         MVC   RQMEDIA,QMEDX                                                    
         GOTOR (#EDTMED,AEDTMED),DMCB,QMEDX,,QMEDA                              
         BE    EXIT                                                             
         DC    H'0'                                                             
                                                                                
***********************************************************************         
* GET BUYER RECORD FOR SUBSCRIPTION VALIDATION DOWNLOAD               *         
***********************************************************************         
                                                                                
GETBYR   XC    WORK(L'BYRKBYR+L'BYRFNAME),WORK                                  
         CLI   BYRIND,LW_TLSTQ     TEST BUYER REQUESTED                         
         BNER  RE                                                               
         NTR1  LABEL=NO                                                         
         ICM   R1,7,ABYR                                                        
         MVC   WORK(L'BYRKBYR),LW_DATA2-LW_D(R1)                                
         USING BYRRECD,IOKEY                                                    
         XC    BYRKEY,BYRKEY                                                    
         MVI   BYRKTYP,BYRKTYPQ                                                 
         MVI   BYRKSUB,BYRKSUBQ                                                 
         MVC   BYRKAM,RQMEDIA                                                   
         MVC   BYRKBYR,WORK                                                     
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOSPTDIR+IO2'                            
         BNE   EXITY                                                            
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOSPTFIL+IO2'                           
         JNE   *+2                                                              
                                                                                
         L     R1,IOADDR                                                        
         AHI   R1,BYRRELEM-BYRREC  POINT TO FIRST ELEMENT                       
         USING BYRDSCD,R1                                                       
         SR    R0,R0                                                            
GETBYR02 CLI   BYRDCDE,0           TEST END OF RECORD                           
         BE    EXITY                                                            
         CLI   BYRDCDE,BYRDCDQ     TEST DESCRIPTION ELEMENT                     
         JE    *+14                                                             
         IC    R0,BYRDSLN                                                       
         AR    R1,R0                                                            
         J     GETBYR02                                                         
         MVC   WORK+L'BYRKBYR(L'BYRFNAME),BYRFNAME                              
         B     EXITY                                                            
         DROP  R1                                                               
                                                                                
TSTVBYR  CLI   BYRIND,LW_TLSTQ     TEST BUYER REQUESTED                         
         BNER  RE                                                               
         CR    RE,RE                                                            
         BR    RE                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITIONS FOR SUBSCRIPTION VALIDATION DOWNLOAD              *         
***********************************************************************         
                                                                                
ARYVCLT  LKOUT A,(R,NXTSDC)                                                     
CltCd    LKOUT C,4,(D,B#WORKD,QCLTA),CHAR                                       
Array    LKOUT C,5,(D,B#WORKD,WORK),CHAR,LEN=L'CNAME                            
         LKOUT E                                                                
                                                                                
***********************************************************************         
* DOWNLOAD CLIENT RECORDS                                             *         
***********************************************************************         
                                                                                
NXTSDC   CLI   LP_RMODE,LP_RFRST   IS THIS THE FIRST TIME                       
         JNE   NXTSDC02                                                         
         ICM   R1,7,ACLT                                                        
         BZ    NOMORE                                                           
         CLI   LW_DATA2-LW_D(R1),C'*'                                           
         BE    NOMORE                                                           
                                                                                
         MVI   LP_RMODE,LP_RMORE                                                
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         STC   R0,CLTIND           # OF ENTIRES                                 
         LA    R0,LW_DATA2-LW_D(R1)                                             
         STCM  R0,7,ACLT           A(CLIENT)                                    
                                                                                
NXTSDC02 SR    R0,R0                                                            
         ICM   R0,1,CLTIND                                                      
         BZ    NOMORE                                                           
         SHI   R0,1                                                             
         STC   R0,CLTIND                                                        
         LA    R0,WORK                                                          
         ST    R0,LP_ADATA                                                      
         ICM   R1,7,ACLT                                                        
         MVC   QCLTA,0(R1)                                                      
         AHI   R1,L'QCLTA                                                       
         STCM  R1,7,ACLT                                                        
         XC    WORK(L'CNAME),WORK                                               
         GOTOR (#VALCLT,AVALCLT),DMCB,QCLTA,L'QCLTA,QCLTX                       
         BNE   EXITY                                                            
         L     R1,ACLTREC                                                       
         MVC   WORK(L'CNAME),CNAME-CLTHDR(R1)                                   
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MARKET DOWNLOAD                                *         
***********************************************************************         
                                                                                
ARYVMKT  LKOUT A,(R,NXTSDM)                                                     
MktCd    LKOUT C,6,(D,B#WORKD,WORK),CHAR,LEN=L'MKTKMKT                          
Array    LKOUT C,7,(D,B#WORKD,WORK+L'MKTKMKT),CHAR,LEN=L'MKTNAME                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* DOWNLOAD MARKET RECORDS                                             *         
***********************************************************************         
                                                                                
NXTSDM   CLI   LP_RMODE,LP_RFRST   IS THIS THE FIRST TIME                       
         JNE   NXTSDM02                                                         
         ICM   R1,7,AMKT                                                        
         BZ    NOMORE                                                           
         CLI   LW_DATA2-LW_D(R1),C'*'                                           
         BE    NOMORE                                                           
                                                                                
         MVI   LP_RMODE,LP_RMORE   TELL DDLINK TO CALL ME AGAIN                 
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         STC   R0,MKTIND           # OF ENTRIES                                 
         LA    R0,LW_DATA2-LW_D(R1)                                             
         STCM  R0,7,AMKT           A(MARKET)                                    
                                                                                
NXTSDM02 SR    R0,R0                                                            
         ICM   R0,1,MKTIND                                                      
         BZ    NOMORE                                                           
         SHI   R0,1                                                             
         STC   R0,MKTIND                                                        
         LA    R0,WORK                                                          
         ST    R0,LP_ADATA                                                      
         ICM   R1,7,AMKT                                                        
         MVC   WORK(L'MKTKMKT),0(R1)                                            
         AHI   R1,L'MKTKMKT                                                     
         STCM  R1,7,AMKT                                                        
         XC    WORK+L'MKTKMKT(L'MKTNAME),WORK+L'MKTKMKT                         
                                                                                
         LA    R1,IOKEY                                                         
         USING MKTRECD,R1                                                       
         XC    MKTKEY,MKTKEY                                                    
         MVI   MKTKTYPE,MKTKTYPQ                                                
         MVC   MKTKMED,QMEDA                                                    
         MVC   MKTKMKT,WORK                                                     
         MVC   MKTKAGY,LP_AGY                                                   
         MVC   MKTKFILL,EZEROS                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOSTAFIL+IO4'                            
         BNE   EXITY                                                            
         L     R1,AIO4                                                          
         MVC   WORK+L'MKTKMKT(L'MKTNAME),MKTNAME-MKTREC(R1)                     
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* READ FOR ROUTES REQUEST  X'00E0'                                    *         
***********************************************************************         
                                                                                
REQR4R   LKREQ H,I#SDRD4D,OUTR4R,NEXTREQ=REQSDM                                 
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'CKEYAM,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                   
CltCd    LKREQ F,2,(I,B#SAVED,CLTIND),(U,#VALCLT,$VALCLT),             +        
               OLEN=L'CKEYCLT,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*                  
StaCd    LKREQ F,3,(I,B#SAVED,STAIND),(R,VALSCL),MAXLEN=10,            +        
               OLEN=L'DSRKSTA,TEXT=SP#STATN,COL=*                               
SCall    LKREQ F,7,(D,B#SAVED,STACALL2),CHAR,TEXT=SP#STATN,COL=*                
         LKREQ E                                                                
                                                                                
OUTR4R   LKOUT H                   ** READ FOR ROUTES **                        
                                                                                
R4REDI   LKOUT R,X'00E1'                                                        
Array    LKOUT C,255,(A,ARYEDI)                                                 
         LKOUT E                                                                
                                                                                
R4RFAX   LKOUT R,X'00E2'                                                        
Array    LKOUT C,255,(A,ARYSFAX)                                                
         LKOUT E                                                                
         LKOUT X                                                                
                                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR READ FOR ROUTES DOWNLOAD (SINGLE STATION)      *         
***********************************************************************         
                                                                                
ARYEDI   LKOUT A,(R,NXTEDI),MULTIROW=Y,ROWNAME=R4RVALS                          
                                                                                
DType    LKOUT C,1,R4RDESTN,CHAR,ND=Y                                           
UPrfx    LKOUT C,2,R4RUSRID,CHAR,ND=Y                                           
UOffc    LKOUT C,3,R4ROFFIC,CHAR,ND=Y                                           
*NoEDI    LKOUT C,50,R4RDNEDI,HDRO,ND=Y                                         
DRout    LKOUT C,99,R4RDFLTR,HDRO,ND=Y                                          
*                                                                               
Array    LKOUT C,X'00E2',(A,ARYRFAX),FILTROUT=TSTCANFX  Rep faxes               
*                                                                               
Array    LKOUT C,X'00EA',(A,ARY2NDR),FILTROUT=TST2NDR   2nd rep                 
         LKOUT E                                                                
                                                                                
TST2NDR  CLI   R4RDESTN,C'R'       EDI TYPE IS REP?                             
         JNE   RTRNNO              NO, DON'T SEND 2ND REP                       
         OC    R4RA2NDR,R4RA2NDR   ANY 2ND REP?                                 
         JNZ   RTRNYES             YES, SET CC=EQUAL                            
         J     RTRNNO                                                           
*                                                                               
TSTCANFX TM    R4RFLAG2,R4RCANFX   SET CC=EQUAL IF USERID CAN FAX               
         JNZ   RTRNYES                                                          
         OI    R4RFLAG1,R4RFRFAX   DONE WITH REP FAX                            
         J     RTRNNO                                                           
         EJECT                                                                  
***********************************************************************         
* ARRAY DEFINITION FOR 2ND REP X'00EA'                                          
***********************************************************************         
                                                                                
ARY2NDR  LKOUT A,(R,NXT2NDR),MULTIROW=Y                                         
U2Prfx   LKOUT C,4,(D,B#SAVED,R4R2NDPF),CHAR,ND=Y                               
U2Offc   LKOUT C,5,(D,B#SAVED,R4R2NDOF),CHAR,ND=Y                               
*                                                                               
Array    LKOUT C,X'00E2',(A,ARYRFAX),FILTROUT=TSTCANFX  Rep faxes               
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET SECONDARY REP(S)                                                          
***********************************************************************         
NXT2NDR  DS    0H                                                               
         LA    R0,R4RA2NDR                                                      
         ST    R0,LP_ADATA                                                      
*                                                                               
         CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXT2R010                                                         
*                                                                               
         USING DSTAREPD,RF                                                      
         ICM   RF,15,R4RA2NDR      GET A(2ND REP ELEM)                          
         JZ    *+2                                                              
         XC    R4RA2NDR,R4RA2NDR                                                
         LA    R1,DSTAREPCR                                                     
         CLI   DSTAREPLN,DSTAREPLQ OLDER 2ND REP ELEM LEN?                      
         JE    NXT2R015            YES - ONLY HAVE ONE 2ND REP                  
         LA    R1,DSTAREPS                                                      
         ST    R1,R4RA2NDR                                                      
         DROP  RF                                                               
*                                                                               
NXT2R010 ICM   R1,15,R4RA2NDR       ANY MORE 2ND REPS?                          
         JZ    NXT2RNM             NO                                           
         LA    RF,L'DSTAREPS(R1)   BUMP TO NEXT 2ND REP                         
         ST    RF,R4RA2NDR                                                      
*                                                                               
NXT2R015 CLC   0(L'DSTAREPS,R1),SPACES  DO WE HAVE A REP HERE?                  
         JNH   NXT2RNM                  NO, THEN NO MORE DATA                   
*                                                                               
         MVC   WORK(L'DSTAREPCR),0(R1)                                          
         GOTOR VGETDARE,DMCB,(C'R',0),WORK,AIO8,A(IO8LQ),VDATAMGR               
         JNE   NXT2RXY                                                          
         L     RF,AIO8                                                          
         MVC   R4RDRTAB,0(RF)      COPY TABLE ENTRY INTO SAVED                  
NXT2RD   USING DAREPTD,R4RDRTAB                                                 
*                                                                               
         MVC   R4R2NDPF,NXT2RD.DAPTRPPF                                         
*                                                                               
***********************************************************************         
* ON FQA, TMNYBLD IS SPANKED TO TMNY & LUNABLD IS SPANKED TO LUNA               
* SINCE THE FQA GENDIR/FIL FILE ARE SHARED BY BOTH TMNY AND TMNYBLD             
* THIS MEANS, DSTA ARE SHARED, AND ONLY ONE LUNA REP CAN BE ASSIGNED            
* SO IN ORDER FOR TMNY TO SEND TO LUNA, AND TMNYBLD SEND TO LUNABLD             
* FOR TMNYBLD USERS, WE MUST MASSAGE THE DSTA LUNA REP TO LUNABLD               
*                                         -HWON 5/4/2018  SPEC-23705            
***********************************************************************         
*                                                                               
         TM    LP_FLAG,LP_FOFFL         TEST OFFLINE                            
         JZ    NXT2R020                  NO                                     
         ICM   RF,15,AMASTC             TEST HAVE A(MASTD)                      
         JZ    NXT2R040                  NO, SKIP MASSAGE                       
         ICM   RE,15,MCSSB-MASTD(RF)    TEST HAVE A(SSB)                        
         JZ    NXT2R040                  NO, SKIP MASSAGE                       
         CLI   SSODSPAC-SSOOFF(RE),C'Q' FQA DSPACE?                             
         J     NXT2R030                                                         
*                                                                               
NXT2R020 GOTO1 VGETFACT,DMCB,0                                                  
         L     RE,DMCB                                                          
         CLI   FADSPACE-FACTSD(RE),C'Q' FQA DSPACE?                             
NXT2R030 JNE   *+10                      NO                                     
         CLC   LP_USRID,=X'1F5E'       MATCH TMNYBLD USERID?                    
         JNE   *+10                      NO                                     
         CLC   R4R2NDPF,=CL10'LUNA'    MATCH REP IS LUNA?                       
         JNE   *+10                      NO                                     
         MVC   R4R2NDPF,=CL10'LUNABLD' THEN MASSAGE IT LUNABLD                  
*                                                                               
NXT2R040 XC    R4R2NDOF,R4R2NDOF                                                
         TM    NXT2RD.DAPTFLG1,DPF1NOOF     X'80' - APPENDS OFFICE?             
         JNZ   NXT2R050                     NO, SKIP                            
*                                                                               
         MVC   R4ROVOFF,DAREOFFC   DEFAULT IS TO USE THE SAME OFFICE            
         GOTOR GETAGR                                                           
         MVC   R4R2NDOF,R4ROVOFF                                                
*                                                                               
NXT2R050 NI    R4RFLAG1,X'FF'-R4RFRFAX  CHECK 2ND REP FAX                       
NXT2RXY  J     EXITY                                                            
*                                                                               
NXT2RNM  J     EXITN                                                            
*NXT2RNM  J     NOMORE                                                          
         DROP  NXT2RD                                                           
***********************************************************************         
* GET NEXT EDI RECORD                                                 *         
***********************************************************************         
         USING NEWORKD,RC                                                       
NXTEDI   LA    R0,R4RVALS                                                       
         ST    R0,LP_ADATA                                                      
         XC    R4RVALS(R4RVALL),R4RVALS                                         
* TODAYJUL WAS BLOWN AWAY BY NXT2NDR: both using  NEWORKD?                      
*                                     OR IS IT  D-CHAIN RELATED?                
* REESTABLISH TODAYJUL AND TODAYBIN                                             
         GOTOR VDATCON,DMCB,(5,0),(15,TODAYJUL)                                 
         GOTOR (RF),(R1),(6,TODAYJUL),(3,TODAYBIN)                              
                                                                                
         CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXEDI035                                                         
         MVI   R4RFLAG1,R4RFFRST   HAVEN'T READ REP'S USER-ID                   
         MVI   R4RFLAG2,0                                                       
                                                                                
************************************                                            
* THESE USERID DON'T WANT FAX OPTION                                            
************************************                                            
         CLC   LP_AGY,=C'JS'                                                    
         JE    NXEDI006                                                         
         CLC   LP_AGY,=C'FR'                                                    
         JE    NXEDI006                                                         
         CLC   LP_AGY,=C'H7'                                                    
         JE    NXEDI006                                                         
************************************                                            
* THESE USERID DON'T WANT FAX OPTION                                            
************************************                                            
*                                                                               
         L     R6,AIO4                                                          
         USING CTIREC,R6                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKNUM,LP_USRID                                                 
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO4'                            
         JNE   *+2                                                              
         LA    R6,CTIDATA          R2=A(FIRST ELEMENT ON ID RECORD)             
NXEDI002 CLI   0(R6),0                                                          
         JE    *+2                                                              
         CLI   0(R6),CTDSCELQ      X'02' TEXT USERID IN DESCR ELEM              
         JE    NXEDI004                                                         
         LLC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         J     NXEDI002                                                         
*                                                                               
         USING CTDSCD,R6                                                        
NXEDI004 L     R2,AIO4             ONLY WAY TO KNOW FOR SURE IS TO              
         USING EDIKEYD,R2             CHECK EDICT REC FOR COMPANY-ID            
         XC    EDIKEY,EDIKEY                                                    
         MVI   EDIKSYS,EDIKSYSQ                                                 
         MVI   EDITYPE,EDITYPEQ                                                 
         MVC   EDINAME,CTDSC       8 CHARACTERS                                 
         MVC   IOKEY(L'EDIKEY),EDIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO4'                            
         JNE   NXEDI006                                                         
         LA    R6,EDIFSTEL                                                      
         USING EDILNKD,R6                                                       
         CLI   EDIMETHS,C'E'       EASILINK?                                    
         JE    *+12                                                             
         CLI   EDIMETHS,C'I'         OR ECN?                                    
         JNE   NXEDI006                                                         
         OI    R4RFLAG2,R4RCANFX   YES, COMPANY-ID CAN FAX AS PER EDICT         
         DROP  R2,R6                                                            
*****                                                                           
NXEDI006 L     RF,LP_ATWA          EXTRACT DARE ROUTING CODE                    
         OC    DAREROUT,SVDARERC-TWAD(RF)                                       
         JNZ   *+14                                                             
         BRAS  RE,GTDARRT                                                       
         MVC   DAREROUT,SVDARERC-TWAD(RF)                                       
*                                                                               
         CLI   QMEDA,C'R'          FAX ALL RADIO ORDERS?                        
         JNE   NXEDI020                                                         
         XC    WORK,WORK           YES, CHECK SPOT/OM PROFILE                   
         MVC   WORK+00(4),=C'S0OM'                                              
         MVC   WORK+04(L'LP_AGY),LP_AGY                                         
         MVC   WORK+06(L'QMEDA),QMEDA                                           
         MVC   WORK+07(L'QCLTA),QCLTA                                           
         MVI   WORK+10,C'*'                                                     
         L     RF,ACLTREC                                                       
         MVC   WORK+11(L'COFFICE),COFFICE-CLTRECD(RF)                           
         GOTOR VGETPROF,DMCB,WORK,WORK+16,VDATAMGR                              
         CLI   WORK+16+3,C'N'      NO, WE CAN HAVE EDI                          
         JE    NXEDI020                                                         
                                                                                
***********************************************************************         
* KATZ REDI EXCEPTION TABLE                                           *         
***********************************************************************         
                                                                                
         LAY   RE,KTZRDYTB         CHECK AGAINST TABLE IF USER CAN EDI          
NXEDI010 CLI   0(RE),FF                                                         
         JE    NXEDI015                                                         
         CLC   DAREROUT,0(RE)                                                   
         JE    NXEDI020            THIS AGENCY/CITY CAN EDI                     
         AHI   RE,L'KTZRDYTB                                                    
         J     NXEDI010                                                         
                                                                                
NXEDI015 OI    R4RFLAG2,R4RFXRAD   DEFAULT IS TO FAX ALL RADIO ORDERS           
                                                                                
NXEDI020 OC    STACALL1,STACALL1   TEST VALIDATED STATION SET                   
         JNZ   *+10                                                             
         MVC   STACALL1,STACALL2   NO - SET FROM CALLER                         
         TM    MAPI1,MAPIR4RD      TEST MULTI-STATION DOWNLOAD                  
         JZ    *+12                                                             
         CLI   R4RMEDIA,0          YES - TEST FIRST TIME                        
         JNE   NXEDI035                                                         
                                                                                
         ICM   RF,7,AMED           EXTRACT MEDIA CODE                           
         MVC   QMEDX,LW_DATA1-LW_D(RF)                                          
         CLI   QMEDA,0             TEST ALPHA MEDIA IS RESOLVED                 
         JNE   NXEDI025                                                         
         GOTOR (#EDTMED,AEDTMED),DMCB,QMEDX,,QMEDA                              
                                                                                
NXEDI025 CLI   STACALL1+L'STACALL1-1,C' '                                       
         JH    *+10                                                             
         MVC   STACALL1+L'STACALL1-1(1),QMEDA                                   
         MVC   STACALL2,STACALL1                                                
                                                                                
         ICM   RF,7,ACLT           EXTRACT CLIENT CODE                          
         MVC   QCLTX,LW_DATA1-LW_D(RF)                                          
         OC    QCLTA,QCLTA         TEST ALPHA CLIENT RESOLVED                   
         JNZ   NXEDI030                                                         
         GOTOR (#EDTCLT,AEDTCLT),DMCB,QCLTX,,QCLTA                              
                                                                                
NXEDI030 XC    WORK,WORK           READ SPOT/FX PROFILE                         
         MVC   WORK+00(4),PROFS0FX                                              
         MVC   WORK+04(L'LP_AGY),LP_AGY                                         
         MVC   WORK+06(L'QMEDA),QMEDA                                           
         MVC   WORK+07(L'QCLTA),QCLTA                                           
         MVI   WORK+10,C'*'                                                     
         L     RF,ACLTREC                                                       
         MVC   WORK+11(L'COFFICE),COFFICE-CLTRECD(RF)                           
         GOTOR VGETPROF,DMCB,WORK,PROFFXV,VDATAMGR                              
                                                                                
         L     RF,LP_ATWA          EXTRACT DARE ROUTING CODE                    
         MVC   DAREROUT,SVDARERC-TWAD(RF)                                       
*                                                                               
NXEDI035 MVC   R4RMEDIA,QMEDA      SET MEDIA CODE FOR KEY BUILDING              
         CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JE    NXEDI040                                                         
                                                                                
         TM    R4RFLAG1,R4RFDSTA   DONE WITH DSTAS FOR THIS STATION?            
         JNZ   NXEDI340                                                         
         TM    R4RFLAG1,R4RFUSER   DID ALL REP USER IDS FOR THIS DSTA?          
         JNZ   NXEDI045                                                         
         MVC   R4RSCALL(L'LR4RSCLL+L'LR4RSEFF),LR4RSCLL                         
         J     NXEDI230            ON TO THE NEXT REP USER ID                   
                                                                                
NXEDI040 NI    R4RFLAG1,FF-R4RFDFLT                                             
         XC    R4RHOMEV(R4RHOMEL),R4RHOMEV                                      
*                                                                               
NXEDI045 NI    R4RFLAG1,FF-R4RFUSER-R4RFRFAX-R4RFUID0                           
         OI    R4RFLAG1,R4RFFRST   SET TO PROCESS USER-IDS AGAIN                
                                                                                
NXEDI050 MVC   IOKEY(L'DSTAKEY),SVDSTKEY                                        
         GOTOR (#NXTREC,ANXTREC),DMCB,DSTKEYT,('B#DSTREC',0),          +        
               ('$NXTRGEN+$NXTRXAD',SAVED),0,0                                  
         MVC   SVDSTKEY,IOKEY                                                   
         JE    NXEDI055                                                         
         OI    R4RFLAG1,R4RFDSTA   SET DONE WITH DARE STATION RECORDS           
         XC    R4RDRTAB,R4RDRTAB   CLEAR REP ENTRY                              
         TM    R4RFLAG1,R4RFRFAX   DONE WITH REP FAX?                           
         JNZ   *+10                                                             
         MVC   R4RSCALL,IOKEYSAV+(DSTAKSTIN-DSTAKEY)                            
         J     NXEDI340                                                         
                                                                                
NXEDI055 XC    R4RHOMEV(R4RHOMEL),R4RHOMEV                                      
*                                                                               
         L     R2,IOADDR                                                        
         USING DSTAKEYD,R2                                                      
*                                                                               
         MVC   R4RSCALL,DSTAKSTIN  SET STATION CALL LETTERS                     
         MVC   LR4RSCLL,DSTAKSTIN  SAVE THIS FOR USER-ID ITERATIONS             
         SR    RF,RF                                                            
         ICM   RF,7,DSTAKEFDA                                                   
         LNR   RF,RF                                                            
         STCM  RF,7,R4REFFDT       SET STATION EFFECTIVE DATE                   
         MVC   LR4RSEFF,R4REFFDT   SAVE THIS FOR USER-ID ITERATION              
*                                                                               
         AHI   R2,DSTAELDQ                                                      
         USING DSTAREPD,R2                                                      
         XC    R4RA2NDR,R4RA2NDR   NO 2ND REPS YET                              
NXEDI065 CLI   0(R2),0             ANY 2ND REP ELEM?                            
         JE    NXEDI070            NONE                                         
*                                                                               
         CLI   DSTAREPC,DSTARP2CQ  X'11'- 2ND REP INFO ELEM PRESENT?            
         JE    NXEDI067            YES                                          
         LLC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         J     NXEDI065                                                         
*                                                                               
NXEDI067 DS    0H                  THIS WILL BE USED IN ARY2NDR                 
         ST    R2,R4RA2NDR         SAVE A(2ND REP ELEMENT)                      
*                                                                               
NXEDI070 L     R2,IOADDR                                                        
         AHI   R2,DSTAELDQ                                                      
         CLI   DSTAREPC,DSTAREPCQ  X'10'- REP INFO ELEMENT PRESENT?             
         JNE   NXEDI050            NO - GET NEXT DSTA RECORD                    
*                                                                               
         MVC   WORK(L'DAPTCODE),DSTAREPCR                                       
         OC    DSTAREPED,DSTAREPED TEST EFFECTIVE DATE SET                      
         JZ    NXEDI076                                                         
         CLC   DSTAREPED,TODAYJUL  TEST EFFECTIVE DATE REACHED                  
         JNH   NXEDI076                                                         
         MVC   WORK(L'DAPTCODE),DSTAREPPR                                       
* WORK NOW HAS THE EFFECTIVE REP CODE                                           
                                                                                
***********************************************************************         
* ONLY MEDIAVEST AND SJR USES VSG                                     *         
***********************************************************************         
NXEDI076 CLC   =C'H9',LP_AGY                                                    
         JE    *+14                                                             
         CLC   =C'SJ',LP_AGY                                                    
         JNE   NXEDI092                                                         
                                                                                
         LAY   RF,VSSTATAB                                                      
NXEDI080 CLI   0(RF),FF            EOT?                                         
         JE    NXEDI092            YES, NO WORRIES                              
         CLC   STACALL2(4),0(RF)                                                
         JE    NXEDI083                                                         
         AHI   RF,L'VSSTATAB                                                    
         J     NXEDI080                                                         
                                                                                
NXEDI083 XR    RE,RE                                                            
         ICM   RE,7,AEST                                                        
         JZ    NXEDI092            CAN'T BE VSG WITHOUT AN ESTIMATE             
         LLC   R0,LW_NUMN-LW_D(RE) GET THE ESTIMATE BINARY                      
         CVD   R0,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  WORK+32(3),DUB      ESTIMATE TO 3 BYTE EBCDIC                    
                                                                                
         LAY   RF,VSSTATAB         NOW SEE IF OUR CLT AND EST MATCHES           
         AHI   RF,VSCNETAB-VSSTATAB                                             
NXEDI086 CLI   0(RF),FF                                                         
         JE    NXEDI092            NO, NO WORRIES                               
         CLC   QCLTA,0(RF)                                                      
         JNE   NXEDI088                                                         
         CLC   WORK+32(3),3(RF)                                                 
         JE    *+12                                                             
NXEDI088 AHI   RF,L'VSCNETAB                                                    
         J     NXEDI086                                                         
                                                                                
         CLC   QCLTA,=C'WH '       THE WH /100 ENTRY IS ONLY FOR SJR            
         JNE   NXEDI090                                                         
         CLC   LP_AGY,=C'SJ'                                                    
         JNE   NXEDI092            MEDIAVEST MIGHT HAVE A WH /100               
NXEDI090 MVC   WORK(3),=C'VSG'     PURPOSEFUL OVERRIDE TO VSG FOR H9            
         CLC   =C'DCBS',STACALL2                                                
         JNE   NXEDI092                                                         
         MVC   WORK(3),=C'EJO'     EJOR FOR DCBS AND CLT/EST WH/100             
***********************************************************************         
                                                                                
NXEDI092 GOTOR VGETDARE,DMCB,(C'R',0),WORK,AIO8,A(IO8LQ),VDATAMGR               
         JNE   NXEDI050                                                         
*&&DO                                                                           
         JNE   NXEDI110                                                         
         TM    MAPI1,MAPIR4RD      TEST MULTI-STATION DOWNLOAD                  
         JNZ   NXEDI050                                                         
         B     NOMORE                                                           
*&&                                                                             
NXEDI110 L     RF,AIO8                                                          
         MVC   R4RDRTAB,0(RF)      COPY TABLE ENTRY INTO SAVED                  
                                                                                
         USING DAREPTD,R4RDRTAB                                                 
         TM    R4RFLAG1,R4RFRFAX   DONE WITH DARADM FAX RECORDS?                
         JZ    NXEDI120                                                         
         NI    R4RFLAG1,FF-R4RFUID0                                             
         CLC   LR4RREPC,DAPTCODE   DID THE REP CHANGE?                          
         JE    NXEDI120                                                         
                                                                                
         NI    R4RFLAG1,FF-(R4RFRFAX+R4RFGRFX)           YES, WE NEED           
         NI    R4RFLAG2,FF-(R4RFREDI+R4RRPIBX)               DARADM FAX         
                                                                                
NXEDI120 MVC   LR4RREPC,DAPTCODE                                                
                                                                                
         MVC   UIDRSTR,SPACES      BUILD USER-ID KEY RANGE                      
         LLC   RF,DAPTLPFX                                                      
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         MVC   UIDRSTR(0),DAPTRPPF                                              
         EX    RF,0(RE)                                                         
         MVC   UIDREND,EFFS                                                     
         BASR  RE,0                                                             
         MVC   UIDREND(0),DAPTRPPF                                              
         EX    RF,0(RE)                                                         
*                                                                               
         TM    R4RFLAG2,R4RFXRAD   FAX ALL RADIO ORDERS?                        
         JNZ   NXEDI140            DON'T CARE WHO IT IS                         
         TM    DAPTFLG1,DPF1NODR   X'20' - IS IT A DARE REP?                    
         JZ    NXEDI145            YES, IT IS                                   
                                                                                
***********************************************************************         
* NON-DARE REP, STATION, AND ROUTING CODE TESTING                     *         
*                                                                     *         
*  A NON-DARE REP WOULD ONLY LIKE TO RECEIVE EDI FOR A STATION FROM   *         
*  AN  AGENCY AND OFFICE OF THAT AGENCY.  AFTER KNOWING THAT THE REP  *         
*  IS A NON-DARE REP, WE CAN CHECK AGAINST THE TABLE.                 *         
***********************************************************************         
                                                                                
         LAY   RF,GTRSAOTB                                                      
         USING NONDARD,RF                                                       
NXEDI124 CLI   NDRTREP,FF          HIT THE END OF SPECIAL TABLE?                
         JE    NXEDI130            MIGHT NEED ROUTING CODE TESTING              
         CLC   NDRTREP,DAPTCODE    MAKE SURE THE REP MATCHES                    
         JNE   NXEDI128                                                         
         CLC   NDRTSTA,STACALL2    MATCH ON STATION?                            
         JNE   NXEDI128                                                         
         CLC   NDRTAGY,=C'**'      DO WE NEED TO CHECK POWER CODE?              
         JE    NXEDI126            NO, APPLIES TO ALL AGENCIES                  
         CLC   NDRTAGY,LP_AGY      MATCH ON POWER CODE?                         
         JNE   NXEDI128                                                         
NXEDI126 CLC   NDRTOFF,DAREROUT+3                                               
         JE    NXEDI145            TREAT AS IF IT IS A DARE REP                 
NXEDI128 AHI   RF,NONDARL                                                       
         J     NXEDI124                                                         
         DROP  RF                                                               
                                                                                
NONDARD  DSECT                                                                  
NDRTREP  DS    CL3                 NON-DARE REP TO MATCH AGAINST SVREP          
NDRTSTA  DS    CL4                 STATION CALL LETTERS                         
NDRTAGY  DS    CL2                 AGENCY POWER CODE                            
NDRTOFF  DS    CL2                 OFFICE IN ROUTING CODE                       
NONDARL  EQU   *-NONDARD                                                        
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* NON DARE REP AND ROUTING CODE TESTING                               *         
*  A NON-DARE REP WOULD ONLY LIKE TO RECEIVE EDI FROM A PARTICULAR    *         
*  AGENCY AND OFFICE OF THAT AGENCY.  AFTER KNOWING THAT THE REP      *         
*  IS A NON-DARE REP, WE CAN CHECK AGAINST THE TABLE.                 *         
***  ABC  AND  ROB  ***                                               *         
***  UNI ADDED TO THIS TABLE  OCT22/07                                *         
***********************************************************************         
                                                                                
NXEDI130 MVC   R4ROVOFF,DAREOFFC                                                
         GOTOR GETAGR              READ DAGYROUT RECORD                         
         MVC   IOADDR,AIO3         POINT BACK TO DSTA RECORD                    
                                                                                
         LAY   RF,GTRAOTAB                                                      
         USING RAOTABD,RF                                                       
NXEDI132 CLI   RAOTREP,FF          HIT THE END OF SPECIAL TABLE?                
         JE    NXEDI140            YES, REP STAYS AS FAX                        
         CLC   RAOTREP,DAPTCODE    MAKE SURE THE REP MATCHES                    
         JNE   NXEDI138                                                         
         CLC   RAOTRAGY,=C'***'    DO WE NEED TO CHECK THE AGENCY?              
         JE    NXEDI136            NO, APPLIES TO ALL AGENCIES                  
         CLC   RAOTRAGY,DAREAGYC   DAREROUT = AGENCY(3) + OFFICE(2)             
         JNE   NXEDI138            TREAT AS IF IT IS A DARE REP                 
NXEDI136 CLC   RAOTOFF,R4ROVOFF                                                 
         JE    NXEDI145            TREAT AS IF IT IS A DARE REP                 
NXEDI138 LA    RF,RAOTABL(RF)                                                   
         J     NXEDI132                                                         
         DROP  RF                                                               
***********************************                                             
* NOT A VALID DARE REP AND IN ANY OF THE EXCEPTION TABLES, FAX ONLY             
***********************************                                             
NXEDI140 MVC   UIDRSTR,EFFS        WE'RE FAXING, SO NO REP IDS                  
         J     NXEDI150                                                         
                                                                                
***********************************                                             
* WE HAVE A VALID DARE REP                                                      
***********************************                                             
NXEDI145 TM    DAPTFLG1,DPF1NOOF   X'80'- CAN THIS REP HAVE OFFICES?            
         JZ    NXEDI150            YES IT CAN                                   
         LLC   RF,DAPTLPFX                                                      
         LA    RF,UIDREND(RF)                                                   
         MVI   0(RF),C' '                                                       
                                                                                
NXEDI150 L     R2,IOADDR           FIND HOME MARKET ELEM IN DSTA RECORD         
         AHI   R2,DSTAELDQ                                                      
         USING DSTAHOMD,R2                                                      
         SR    R0,R0                                                            
         XC    R4RHOMER,R4RHOMER                                                
                                                                                
NXEDI155 CLI   DSTAHOMC,EOR        TEST END OF RECORD                           
         JE    NXEDI200                                                         
                                                                                
         CLI   DSTAHOMC,DSTAHOMCQ  TEST X'30' HOME MARKET ELEMENT               
         JNE   NXEDI180                                                         
         MVC   R4RHOMEM,DSTAHOMCT  SAVE HOME MARKET                             
         CLC   DSTAHOMIC,SPACES    DO WE HAVE A RECEIVING ID?                   
         JNH   NXEDI159            NO, SO NO STATION EDI                        
         MVC   R4RHOMER,DSTAHOMIC  SAVE HOME MARKET RECEIVING ID                
                                                                                
NXEDI159 LAY   RF,HOVTAB                                                        
         USING HOVTABD,RF          POINT TO OVERRIDE TABLE                      
         LHI   R0,HOVTABN                                                       
NXEDI160 CLC   HOVTAGY,LP_AGY      MATCH AGENCY CODE                            
         JNE   NXEDI170                                                         
         CLC   HOVTOFF,DAREOFFC    OFFICE CODE                                  
         JNE   NXEDI170                                                         
         CLC   HOVTSTA,STACALL1    AND STATION                                  
         JNE   NXEDI170                                                         
*                                                                               
         LR    RF,R2                                                            
         LLC   R0,1(RF)                                                         
         AR    RF,R0                                                            
         USING DSTAH2D,RF                                                       
         CLI   DSTAH2C,DSTAH2CQ    X'31' HIDDEN RECEIVING ID?                   
         JNE   NXEDI170                                                         
         MVC   R4RHOMEM,DAREOFFC   OVERRIDE ENTRY FOUND                         
         MVC   R4RHOMER,DSTAH2IC                                                
         J     NXEDI190                                                         
                                                                                
NXEDI170 AHI   RF,HOVTABL          BUMP TO NEXT TABLE ENTRY                     
         JCT   R0,NXEDI160                                                      
         J     NXEDI190                                                         
         DROP  RF                                                               
                                                                                
         USING DSTASTAD,R2                                                      
NXEDI180 CLI   DSTASTAC,DSTASTACQ  TEST X'10' NEW STATION ELEMENT               
         JNE   NXEDI190                                                         
         MVC   R4RNCALL,DSTASTA                                                 
         MVC   R4RNEFFD,DSTASTADT                                               
         XC    STAPACKD(STAPACKL),STAPACKD                                      
         MVI   STAPACT,C'P'        CONVERT TO PACKED FORMAT                     
         MVC   STAPAGY,LP_AGY                                                   
         L     RF,AAGYREC                                                       
         MVC   STAPCTRY,AGYPCNDA-AGYHDR(RF)                                     
         MVC   STAPMED,R4RMEDIA                                                 
         MVC   STAPACOM,ACOMFACS                                                
         MVC   STAPQMKT,EZEROS                                                  
         MVC   STAPQSTA(STASTAL),DSTASTA                                        
         GOTOR VSTAPACK,STAPACKD                                                
         CLI   STAPERR,0                                                        
         JNE   *+2                                                              
         GOTOR ADDSTA,STAPSTA      ADD TO STATION LIST IF NECESSARY             
                                                                                
NXEDI190 LLC   R0,DSTASTALN        BUMP TO NEXT ELEMENT ON RECORD               
         AR    R2,R0                                                            
         J     NXEDI155                                                         
                                                                                
NXEDI200 OC    R4RHOMER,R4RHOMER   ALREADY HAVE HOME MKT RECEIVING ID?          
         JZ    NXEDI230            NO , PUT OUT REP EDI                         
                                                                                
         MVI   R4RDESTN,R4RDSTAQ   DESTINATION IS STATION                       
         MVC   R4ROFFIC,R4RHOMEM                                                
         MVC   R4RUSRID,R4RHOMER                                                
*                                                                               
***********************************************************************         
* ON FQA, TMNYBLD IS SPANKED TO TMNY & LUNABLD IS SPANKED TO LUNA               
* SINCE THE FQA GENDIR/FIL FILE ARE SHARED BY BOTH TMNY AND TMNYBLD             
* THIS MEANS, DSTA ARE SHARED, AND ONLY ONE LUNA REP CAN BE ASSIGNED            
* SO IN ORDER FOR TMNY TO SEND TO LUNA, AND TMNYBLD SEND TO LUNABLD             
* FOR TMNYBLD USERS, WE MUST MASSAGE THE DSTA LUNA REP TO LUNABLD               
*                                         -HWON 5/4/2018  SPEC-23705            
***********************************************************************         
*                                                                               
         TM    LP_FLAG,LP_FOFFL         TEST OFFLINE                            
         JZ    NXEDI201                  NO                                     
         ICM   RF,15,AMASTC             TEST HAVE A(MASTD)                      
         JZ    NXEDI203                  NO, SKIP MASSAGE                       
         ICM   RE,15,MCSSB-MASTD(RF)    TEST HAVE A(SSB)                        
         JZ    NXEDI203                  NO, SKIP MASSAGE                       
         CLI   SSODSPAC-SSOOFF(RE),C'Q' FQA DSPACE?                             
         J     NXEDI202                                                         
*                                                                               
NXEDI201 GOTO1 VGETFACT,DMCB,0                                                  
         L     RE,DMCB                                                          
         CLI   FADSPACE-FACTSD(RE),C'Q' FQA DSPACE?                             
NXEDI202 JNE   *+10                      NO                                     
         CLC   LP_USRID,=X'1F5E'       MATCH TMNYBLD USERID?                    
         JNE   *+10                                                             
         CLC   R4RUSRID,=CL10'LUNA'    MATCH REP IS LUNA?                       
         JNE   *+10                                                             
         MVC   R4RUSRID,=CL10'LUNABLD' THEN MASSAGE IT LUNABLD                  
*                                                                               
NXEDI203 NI    R4RFLAG1,FF-(R4RFUSER+R4RFUID0)                                  
         CLC   R4RHOMEM,=C'**'     ANY OFFICE CAN SEND STATION EDI?             
         JE    NXEDI205                                                         
         CLC   R4RHOMEM,DAREOFFC   REP USER-IDS AFTER STATION EDI               
         JNE   NXEDI210                                                         
NXEDI205 GOTOR SETEDIDF            TEST/SET EDI DEFAULT                         
         B     EXITY                                                            
         DROP  R2                                                               
                                                                                
***********************************************************************         
* IF WE HAVE STATION INBOX THAT DOES NOT MATCH THE HOME MARKET        *         
* THEN DO NOT LET REP/FAX DEFAULT OVER REP/INBOX, IF REP/INBOX FOR THE*         
* OFFICE EXISTS OTHERWISE WE'LL SEND AN INVALID DEFAULT ROUTE         *         
***********************************************************************         
                                                                                
NXEDI210 CLC   =C'NOR',DAPTCODE    NO REP                                       
         BE    EXITY                                                            
         CLC   =C'NON',DAPTCODE    OR NON-REP FOR RADIO                         
         BE    EXITY                                                            
         MVC   R4ROVOFF,DAREOFFC                                                
                                                                                
         GOTOR GETAGR              READ DAGYROUT RECORD                         
                                                                                
         L     R2,AIO4             READ THE REP USER-ID                         
         USING CTIREC,R2                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKID,UIDRSTR      BECAUSE IT CAN BE EFFS IF NON-DARE           
         LLC   R1,DAPTLPFX                                                      
         LA    R1,CTIKID(R1)                                                    
***FIX***REMOVE THE FOLLOWING CODE*************************************         
         TM    DAPTFLG1,DPF1NOOF   X'80' - APPENDS OFFICE?                      
         JNZ   *+10                                                             
***********************************************************************         
         MVC   0(L'R4ROVOFF,R1),R4ROVOFF                                        
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO4'                            
         BNE   EXITY                                                            
         OI    R4RFLAG2,R4RRPIBX   REP/INBOX WILL BE DEFAULT                    
         B     EXITY                                                            
                                                                                
NXEDI230 TM    R4RFLAG1,R4RFFRST   TEST FIRST TIME (OR FIRST FOR NEXT)          
         JZ    NXEDI240                                                         
                                                                                
         MVC   R4ROVOFF,DAREOFFC                                                
         TM    R4RFLAG1,R4RFDAGY   WE ALREADY LOOKED FOR DAGYROUT REC           
**NOP    JNZ   NXEDI240            OR NO NEED TO LOOK FOR IT                    
         OI    R4RFLAG1,R4RFDAGY   WON'T NEED TO AFTER THIS                     
                                                                                
         GOTOR GETAGR              READ DAGYROUT RECORD                         
                                                                                
NXEDI240 CLC   =C'NOR',DAPTCODE    NO REP                                       
         JE    NXEDI245                                                         
         CLC   =C'NON',DAPTCODE    OR NON-REP FOR RADIO                         
         JNE   NXEDI250                                                         
                                                                                
***      OI    R4RFLAG1,R4RFDFLT                                                
NXEDI245 MVC   R4RUSRID,DAPTRPPF                                                
         MVI   R4RDESTN,R4RDREPQ                                                
         MVI   R4RDFLTR,0                                                       
         MVI   R4RDNEDI,YESQ       SET NO EDI INFO                              
         OI    R4RFLAG1,R4RFUSER                                                
         J     NXEDI350                                                         
                                                                                
NXEDI250 NI    R4RFLAG2,FF-R4RRPIBX WE DON'T NEED THIS ANYMORE                  
         MVC   R4RUSRID,DAPTRPPF   READ USER-ID RECORDS                         
*                                                                               
***********************************************************************         
* ON FQA, TMNYBLD IS SPANKED TO TMNY & LUNABLD IS SPANKED TO LUNA               
* SINCE THE FQA GENDIR/FIL FILE ARE SHARED BY BOTH TMNY AND TMNYBLD             
* THIS MEANS, DSTA ARE SHARED, AND ONLY ONE LUNA REP CAN BE ASSIGNED            
* SO IN ORDER FOR TMNY TO SEND TO LUNA, AND TMNYBLD SEND TO LUNABLD             
* FOR TMNYBLD USERS, WE MUST MASSAGE THE DSTA LUNA REP TO LUNABLD               
*                                         -HWON 5/4/2018  SPEC-23705            
***********************************************************************         
*                                                                               
         TM    LP_FLAG,LP_FOFFL         TEST OFFLINE                            
         JZ    NXEDI251                  NO                                     
         ICM   RF,15,AMASTC             TEST HAVE A(MASTD)                      
         JZ    NXEDI253                  NO, SKIP MASSAGE                       
         ICM   RE,15,MCSSB-MASTD(RF)    TEST HAVE A(SSB)                        
         JZ    NXEDI253                  NO, SKIP MASSAGE                       
         CLI   SSODSPAC-SSOOFF(RE),C'Q' FQA DSPACE?                             
         J     NXEDI252                                                         
*                                                                               
NXEDI251 GOTO1 VGETFACT,DMCB,0                                                  
         L     RE,DMCB                                                          
         CLI   FADSPACE-FACTSD(RE),C'Q' FQA DSPACE?                             
NXEDI252 JNE   *+10                      NO                                     
         CLC   LP_USRID,=X'1F5E'       MATCH TMNYBLD USERID?                    
         JNE   *+10                                                             
         CLC   R4RUSRID,=CL10'LUNA'    MATCH REP IS LUNA?                       
         JNE   *+10                                                             
         MVC   R4RUSRID,=CL10'LUNABLD' THEN MASSAGE IT LUNABLD                  
*                                                                               
NXEDI253 MVI   R4RDESTN,R4RDREPQ                                                
         MVI   R4RDFLTR,0                                                       
         XC    R4ROFFIC,R4ROFFIC                                                
*                                                                               
         TM    DAPTFLG1,DPF1XMLR   X'08' - XML REP?                             
         JNZ   NXEDI370                                                         
*                                                                               
         TM    R4RFLAG1,R4RFFRST   TEST FIRST TIME                              
         JZ    NXEDI260                                                         
         NI    R4RFLAG1,FF-(R4RFFRST+R4RFUID0)                                  
         NI    R4RFLAG2,FF-(R4RFREDI)                                           
         XC    SVUIDKEY,SVUIDKEY                                                
                                                                                
*****MATCHING DARE ROUTING OFFICE *************************************         
* (DO NOT REMOVE THIS CODE)!!!!!  IT WILL GO BACK IN THE NEAR FUTURE  *         
* MOVING THESE 2 LINE FURTHER DOWN SO THAT A PREFIX ONLY WILL BE READ *         
*   FIRST BEFORE USING THE RANGE OF IDS                               *         
*                                                                     *         
*        TM    DAPTFLG1,DPF1NOOF   X'80'- DOES THIS REP HAVE OFFICES? *         
*        JNZ   NXEDI260            NO, DEFAULT WOULD BE ONLY PREFIX   *         
***********************************************************************         
                                                                                
         L     R2,AUIDREC          READ THE REP USER-ID                         
         USING CTIREC,R2                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKID,UIDRSTR      BECAUSE IT CAN BE EFFS IF NON-DARE           
         LLC   R1,DAPTLPFX                                                      
         LA    R1,CTIKID(R1)                                                    
***FIX***REMOVE THE FOLLOWING CODE*************************************         
         TM    DAPTFLG1,DPF1NOOF   X'80'                                        
         JNZ   *+10                                                             
***********************************************************************         
         MVC   0(L'R4ROVOFF,R1),R4ROVOFF                                        
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IOCTFILE+B#UIDREC'                      
         JE    NXEDI290                                                         
         DROP  R2                                                               
                                                                                
***FIX***REMOVE BRANCH AND (TEMPORARY) LABEL AT NXEDI280                        
NXEDI260 J     NXEDI280            ONLY WANT MATCHING ROUTING OFFICE            
         TM    R4RFLAG1,R4RFUID0   SET LP_RFRST FOR REP USER-IDS YET?           
         JNZ   NXEDI270            YES                                          
         OI    R4RFLAG1,R4RFUID0   NO, BUT WE HAVE FROM HENCE FORTH             
         MVI   LP_RMODE,LP_RFRST   SET FIRST TIME FOR NXTREC ROUTINE            
                                                                                
***FIX***REMOVE BRANCH AND (TEMPORARY) LABEL AT NXEDI280                        
NXEDI270 J     NXEDI280                                                         
*XEDI270 MVC   IOKEY(L'SVUIDKEY),SVUIDKEY                                       
         GOTOR (#NXTREC,ANXTREC),DMCB,UIDKEYT,('B#UIDREC',0),          +        
               ('$NXTRCTF+$NXTRXAD',SAVED),0,0                                  
         MVC   SVUIDKEY,IOKEY                                                   
         JE    NXEDI290                                                         
NXEDI280 OI    R4RFLAG1,R4RFUSER   DONE WITH USER-ID FOR THIS DSTA              
* CODE REMOVED SINCE WE WANT TO READ ALL DSTAS FOR A SINGLE STATION             
****HW   TM    MAPI1,MAPIR4RD      TEST MULTI-STATION DOWNLOAD                  
****HW   BZ    NOMORE              NO - ALL DONE                                
         TM    R4RFLAG1,R4RFRFAX                                                
         JZ    NXEDI350            DON'T WANT REP ERASED IF NOT TO BE           
         J     NXEDI035            GO LOOK FOR NEXT DSTA RECORD                 
                                                                                
NXEDI290 L     R2,AUIDREC                                                       
         USING CTIKEY,R2           R2=A(USER-ID RECORD)                         
                                                                                
         TM    DAPTFLG1,DPF1NOOF   X'80'- DOES THIS REP HAVE OFFICES?           
         JNZ   NXEDI300            NO, DEFAULT WOULD BE ONLY PREFIX             
         LLC   R1,DAPTLPFX                                                      
         LA    R1,CTIKID(R1)                                                    
         CLC   R4ROVOFF,0(R1)      WE ALREADY LOOKED THIS ONE UP?               
         JNE   NXEDI300                                                         
         TM    R4RFLAG1,R4RFUID0   SET LP_RFRST FOR REP USER-IDS YET?           
         JNZ   NXEDI260            YES, KEEP LOOKING                            
                                                                                
NXEDI300 LA    R1,CTIDATA                                                       
         USING CTUSAD,R1                                                        
NXEDI310 CLI   CTUSAEL,EOR         ONLY THOSE IDS WITH DARE PARTNER SET         
         JE    NXEDI270                                                         
         CLI   CTUSAEL,CTUSAELQ    TEST AGENCY EXTRA INFO ELEMENT               
         JE    NXEDI315                                                         
         LLC   R0,CTUSALEN                                                      
         AR    R1,R0                                                            
         J     NXEDI310                                                         
NXEDI315 CLI   CTUSADPI,C' '       TEST DARE PARTNER ID SET                     
         JNH   NXEDI270             NO                                          
         DROP  R1                                                               
                                                                                
         LLC   RF,DAPTLPFX         L'REP PREFIX                                 
         LA    R1,CTIKID(RF)       POINT TO AFTER THE PREFIX                    
                                                                                
         TM    DAPTFLG1,DPF1NOOF   X'80'- DOES THIS REP HAVE OFFICES?           
         JZ    NXEDI320                                                         
         CLI   0(R1),C' '          NO - WE SHOULD JUST HAVE THE PREFIX          
         JH    NXEDI350                                                         
***HW    OC    R4RHOMEM,R4RHOMEM   WE HAVE A HOME MARKET?                       
***HW    JZ    NXEDI317            NO, DEFAULT IS TO SEND TO REP                
         CLC   R4RHOMEM,=C'**'     ANY OFFICE CAN SEND STATION EDI?             
         JE    NXEDI330                                                         
         CLC   R4RHOMEM,DAREOFFC                                                
         JE    NXEDI330            YES, DEFAULT IS TO SEND TO STA               
NXEDI317 GOTOR SETEDIDF            TEST/SET EDI DEFAULT                         
         J     NXEDI330                                                         
                                                                                
NXEDI320 CLI   2(R1),C' '          ONLY WANT THOSE WITH 2 CHAR OFFICE           
         JH    NXEDI270                                                         
         CLI   1(R1),C' '          THIS SHOULD MEAN WE HAVE 2 CHAR AFTR         
         JNH   NXEDI270            THE USER-ID PREFIX                           
         MVC   R4ROFFIC,0(R1)      OUTPUT THIS OFFICE IF WE USE THIS ID         
                                                                                
NXEDI330 OI    R4RFLAG2,R4RFREDI                                                
***HW    OC    R4RHOMEM,R4RHOMEM   WE HAVE A HOME MARKET?                       
***HW    JZ    *+14                NO, DEFAULT IS OFFICE IN DAREROUT            
         CLC   R4RHOMEM,=C'**'     ANY OFFICE CAN SEND STATION EDI?             
         BE    EXITY                                                            
         CLC   R4RHOMEM,DAREOFFC                                                
         BE    EXITY               YES, DEFAULT IS TO SEND TO STA               
         CLC   R4ROFFIC,DAREOFFC   SAME AS DARE ROUTING OFFICE                  
         JE    *+14                                                             
         CLC   R4ROFFIC,R4ROVOFF   SAME AS OVERRIDE OFFICE                      
         BNE   EXITY                                                            
         GOTOR SETEDIDF            TEST/SET EDI DEFAULT                         
         B     EXITY                                                            
                                                                                
NXEDI340 DS    0H                                                               
*      COMMENTED OUT SO E1 MAP RECORDS WOULD BE D/L                             
*&&DO                                                                           
         TM    MAPI1,MAPIR4RD      TEST MULTI-STATION DOWNLOAD                  
         BZ    NOMORE                                                           
*&&                                                                             
NXEDI350 TM    R4RFLAG1,R4RFRFAX   DID WE PROCESS DARADM FAX RECS YET?          
         JZ    NXEDI360            NO, SET NO EDI INFO                          
         TM    R4RFLAG1,R4RFGRFX   YES, DID WE GET A REP FAX?                   
         JZ    NXEDI355                 NORMAL EXIT                             
         TM    R4RFLAG2,R4RFREDI   ALREADY DID "NO EDI INFO"                    
         JZ    NXEDI360            NO, CHECK IT                                 
*                                                                               
NXEDI355 TM    R4RFLAG1,R4RFDSTA   DONE WITH DARE STATION RECORDS?              
         JNZ   NOMORE              YES, OTHERWISE CHECK NEXT DARE STA           
*        MVI   LP_RMODE,LP_RNEXT   RESET FIRST TIME CALL                        
         J     EXITY                                                            
*                                                                               
NXEDI360 MVI   R4RDNEDI,YESQ       SET NO EDI INFO                              
         OI    R4RFLAG2,R4RFREDI   PUT OUT A REP EDI OBJECT                     
* B/C COMMENTED OUT CODE @NXEDI340, OTHERWISE DEATH BY LOOP                     
***NOP   TM    MAPI1,MAPIR4RD      TEST MULTI-STATION DOWNLOAD                  
***NOP   BZ    EXITY                                                            
***NOP   MVI   LP_RMODE,LP_RNEXT   RESET FIRST TIME CALL                        
         B     EXITY                                                            
                                                                                
* GET THE NY ID OF THE XML REP TO FIND THE POWER CODE                           
NXEDI370 TM    R4RFLAG1,R4RFUID0   SET LP_RFRST FOR REP USER-IDS YET?           
         JNZ   NXEDI460            YES                                          
         OI    R4RFLAG1,R4RFUID0   NO, BUT WE HAVE FROM HENCE FORTH             
                                                                                
         L     R2,AIO4             READ THE REP USER-ID                         
         USING CTIREC,R2                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKID,DAPTRPPF                                                  
         LLC   R1,DAPTLPFX                                                      
         LA    R1,CTIKID(R1)                                                    
         MVC   0(2,R1),=C'NY'      YES, MUST HAVE NY OFFICE                     
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO4'                            
         JE    NXEDI390                                                         
                                                                                
NXEDI380 MVC   R4RUSRID,DAPTRPPF   READ USER-ID RECORDS                         
         MVI   R4RDESTN,R4RDREPQ                                                
         MVI   R4RDFLTR,0                                                       
         MVI   R4RDNEDI,YESQ       SET NO EDI INFO                              
         OI    R4RFLAG1,R4RFUSER+R4RFUID0                                       
         J     NXEDI350                                                         
                                                                                
NXEDI390 LA    R1,CTIDATA                                                       
         DROP  R2                                                               
                                                                                
         USING CTAGYD,R1                                                        
NXEDI400 CLI   CTAGYEL,0                                                        
         JE    NXEDI380            NO POWER CODE, NO EDI                        
         CLI   CTAGYEL,CTAGYELQ                                                 
         JE    NXEDI405                                                         
         LLC   R0,CTAGYLEN                                                      
         AR    R1,R0                                                            
         J     NXEDI400                                                         
                                                                                
NXEDI405 MVC   HALF,CTAGYID                                                     
         DROP  R1                                                               
         L     R2,AIO4             READ THE SUBSIDIARY RECORD                   
         USING GSPLKEY,R2                                                       
         XC    GSPLKEY,GSPLKEY                                                  
         MVI   GSPLKTYP,GSPLRECQ   X'00' SUBTYPE FOR SUBSIDIARY                 
         MVC   GSPLKRP1,HALF                                                    
         MVC   IOKEY(L'GSPLKEY),GSPLKEY                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOHI+IOGENDIR+IO4'                            
         JNE   NXEDI380                                                         
NXEDI410 CLC   IOKEY(GSPLKRP2-GSPLKEY),GSPLKEY    SAME POWER CODE?              
         JNE   NXEDI380                                                         
*&&DO                              ANY MASTER REP IN NEW KEY FOR KRG?           
         OC    IOKEY+GSPLMRP-GSPLKEY(L'GSPLMRP),IOKEY+GSPLMRP-GSPLKEY           
         JNZ   NXEDI420                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOSQ+IOGENDIR+IO4'                            
         J     NXEDI410                                                         
*&&                                                                             
NXEDI420 GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOGENFIL+IO4'                           
         LA    R1,GSPLFRST(R2)                                                  
         DROP  R2                                                               
                                                                                
         USING GSPLOFFL,R1                                                      
NXEDI430 CLI   GSPLOFFL,0          ANY OFFICES?                                 
         JE    NXEDI380            NO OFFICES, NO EDI                           
         CLI   GSPLOFFL,X'02'                                                   
         JE    NXEDI435                                                         
         LLC   R0,GSPLOFLN                                                      
         AR    R1,R0                                                            
         J     NXEDI430                                                         
                                                                                
NXEDI435 CLI   GSPLOFNM,0          NO OFFICES                                   
         JE    NXEDI380                                                         
         XC    WORK2,WORK2         COPY THE LIST OF OFFICES INTO WORK           
         LLC   RF,GSPLOFLN                                                      
         SHI   RF,(GSPLOFFN-GSPLOFFL+1)                                         
         BASR  RE,0                                                             
         MVC   WORK2(0),GSPLOFFN                                                
         EX    RF,0(RE)                                                         
                                                                                
         LA    RF,WORK2                                                         
         LLC   RE,GSPLOFNM                                                      
NXEDI440 CLC   R4ROVOFF,0(RF)      ALWAYS WANT AGENCY'S OFFICE FIRST            
         JNE   NXEDI450                                                         
         MVC   R4ROFFIC,R4ROVOFF                                                
         GOTOR SETEDIDF            TEST/SET EDI DEFAULT                         
         XC    WORK2,WORK2 <====== REMOVE IF CAN SEND TO ANY OFFICE             
         OI    R4RFLAG1,R4RFUSER <=====                                         
         B     EXITY       <======                                              
*****    J     NXEDI480    <====== UNCOMMENT LINE AFTER REMOVING LINES          
                                                                                
NXEDI450 LA    RF,L'R4ROFFIC(RF)                                                
         JCT   RE,NXEDI440                                                      
         J     NXEDI380    <====   REMOVE IF CAN SEND TO ANY OFFICE             
                                                                                
NXEDI460 OC    WORK2(L'R4ROFFIC),WORK2 ANY MORE OFFICES?                        
         JNZ   NXEDI465                                                         
         TM    DAPTFLG1,DPF1XMLR   X'08'- XML REP?                              
         BNZ   NOMORE                                                           
         J     NXEDI340            GO AND TEST IF MULTI-STATION D/L             
                                                                                
NXEDI465 CLC   R4ROVOFF,WORK2                                                   
         JNE   NXEDI470                                                         
         MVC   WORK2(L'WORK2-2),WORK2+2                                         
         J     NXEDI460                                                         
                                                                                
NXEDI470 MVC   R4ROFFIC,WORK2                                                   
         MVC   WORK2(L'WORK2-2),WORK2+2                                         
                                                                                
NXEDI480 B     MORE                                                             
         DROP  RC                                                               
                                                                                
NEWORKD  DSECT                                                                  
TODAYJUL DS    XL4                 TODAY'S DATE (FULL JULIAN)                   
TODAYBIN DS    XL3                 TODAY'S DATE (BINARY)                        
SVRDEF   CSECT                                                                  
***********************************************************************         
* ARRAY DEFINITION FOR READ FOR ROUTES STATION FAX D/L                *         
***********************************************************************         
                                                                                
ARYSFAX  LKOUT A,(R,NXTSFX),MULTIROW=Y,ROWNAME=R4RVALS                          
                                                                                
DType    LKOUT C,1,R4RDESTN,CHAR,ND=Y                                           
SCall    LKOUT C,2,R4RUSRID,CHAR,ND=Y                                           
FaxNo    LKOUT C,4,R4RFAXNO,CHAR,ND=Y                                           
Attn.    LKOUT C,5,R4RATTN,CHAR,ND=Y                                            
Phone    LKOUT C,6,R4RPHONE,CHAR,ND=Y                                           
DRout    LKOUT C,99,R4RDFLTR,HDRO,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET STATION FAX RECORD                                              *         
***********************************************************************         
                                                                                
NXTSFX   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         BNE   NOMORE                                                           
                                                                                
         TM    MAPI1,MAPIR4RD      TEST MULTI-STATION DOWNLOAD?                 
         JNZ   NXTSFX04                                                         
         ICM   RF,7,ASTA           SET STATION FROM WMP                         
         JZ    NXTSFX02                                                         
         MVC   STAPCODE,8(RF)                                                   
         J     NXTSFX06                                                         
                                                                                
NXTSFX02 MVI   LP_VPARM,$VALSPAK                                                
         GOTOR (#VALSTA,AVALSTA),DMCB,STACALL1,5,WORK                           
         MVC   STAPCODE,WORK+(STAPSTA-STAPACKD)                                 
                                                                                
NXTSFX04 CLI   STAPCODE,X'E8'      ARE WE A CABLE STATION?                      
         JL    *+8                                                              
         NI    STAPCODE+2,X'80'    YES, REMOVE NTWK, ONLY WANT SYSCODE          
                                                                                
         CLC   LR4RSTAP,STAPCODE   ONLY DO ONCE PER STATION                     
         BE    NOMORE                                                           
         MVC   LR4RSTAP,STAPCODE                                                
                                                                                
NXTSFX06 LA    R0,R4RVALS                                                       
         ST    R0,LP_ADATA                                                      
         XC    R4RVALS(R4RVALL),R4RVALS                                         
         MVI   R4RDESTN,R4RDSTAQ   DEFAULT VALUE                                
         XC    R4RUSRID,R4RUSRID                                                
         MVC   R4RUSRID(L'STACALL1),STACALL1                                    
                                                                                
NXTSFX08 GOTOR (#NXTREC,ANXTREC),DMCB,DSRKEYT,('B#DSRREC',0),          +        
               ('$NXTRXAD',SAVED),0,0                                           
         JNE   NXTSFX26                                                         
                                                                                
         L     R1,IOADDR                                                        
         USING DSRKEY,R1           R1=A(DESTN RECORD)                           
         OC    DSRKCLT,DSRKCLT     ANYTHING IN CLIENT?                          
         JZ    NXTSFX14            NOTHING                                      
         CLI   DSRKCLT,C'$'        OFFICE LIST?                                 
         JE    NXTSFX12            YES, CHECK IF SAME LIST AS CLIENT            
         CLI   DSRKCLT,C'*'        OFFICE?                                      
         JE    NXTSFX10            YES, CHECK IF SAME OFFICE AS CLIENT          
                                                                                
         CLC   DSRKCLT,QCLTX       TEST SAME CLIENT AS REQUEST                  
         JE    NXTSFX14            YES, GO GRAB THE FAX NUMBER                  
         J     NXTSFX08                                                         
                                                                                
NXTSFX10 L     RF,ACLTREC                                                       
         CLC   DSRKCLT+1(1),COFFICE-CLTRECD(RF)                                 
         JNE   NXTSFX08                                                         
         J     NXTSFX14            YES, GO GRAB THE FAX NUMBER                  
                                                                                
NXTSFX12 CLI   PROFFXV+0,YESQ      USES OFFICE LIST?                            
         JNE   NXTSFX08                                                         
         CLC   PROFFXV+1(1),DSRKCLT+1                                           
         JNE   NXTSFX08            DOESN'T MATCH OFFICE LIST                    
                                                                                
NXTSFX14 LA    R1,DSRFRST                                                       
         USING DSRIDELD,R1         SEARCH FOR PRIMARY ID ELEMENT                
NXTSFX16 CLI   DSRIDEL,EOR         TES END OF RECORD                            
         JE    NXTSFX08                                                         
         CLI   DSRIDEL,DSRIDELQ    TEST PRIMARY ID ELEMENT                      
         JE    NXTSFX20                                                         
         CLI   DSRIDEL,DSRDRELQ    TEST RADIO DEST AND ROUTE ELEM               
         JE    NXTSFX22                                                         
NXTSFX18 LLC   R0,DSRIDLEN         BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         J     NXTSFX16                                                         
                                                                                
NXTSFX20 MVC   R4RFAXNO,DSRIDFAX   EXTRACT VALUES                               
         MVC   R4RATTN,DSRIDATT                                                 
         MVC   R4RPHONE,DSRIDPHN                                                
         J     NXTSFX18            KEEP LOOKING FOR THE MOST SPECIFIC           
                                                                                
         USING DSRDRELD,R1                                                      
NXTSFX22 MVI   R4RDESTN,R4RDSTAQ   DEFAULT VALUE                                
         MVC   R4RUSRID(L'STACALL1),STACALL1                                    
         CLI   DSRDRDES,DSRDRREP   NOT REP, WHO CARES, DEFAULT IS STA           
         JNE   NXTSFX08                                                         
                                                                                
         GOTOR VGETDARE,DMCB,(C'R',0),DSRDRROU,AIO8,A(IO8LQ),VDATAMGR           
         JNE   NXTSFX08                                                         
                                                                                
         L     RF,AIO8                                                          
         USING DAREPTD,RF                                                       
         MVI   R4RDESTN,R4RDREPQ   DEFAULT VALUE                                
         MVC   R4RUSRID(L'DRREPPFX),DAPTRPPF                                    
         J     NXTSFX08            KEEP LOOKING FOR THE MOST SPECIFIC           
         DROP  RF                                                               
                                                                                
NXTSFX26 CLC   R4RFAXNO,SPACES     TEST FAX NUMBER PRESENT                      
         JNH   NOMORE              NO - CAN'T BE DEFAULT                        
                                                                                
         MVI   LP_RMODE,LP_RNEXT   RESET MODE TO SEND A RECORD                  
***HW    OC    R4RHOMEM,R4RHOMEM   ANY HOME MARKET?                             
***HW    JZ    NXTSFX28            NO, STATION MIGHT BE THE DEFAULT             
         CLC   R4RHOMEM,=C'**'     ANY OFFICE CAN SEND STATION EDI?             
         JE    NXTSFX28                                                         
                                                                                
         CLC   R4RHOMEM,DAREOFFC   HOME MARKET=ROUTING OFFICE?                  
         JNE   NXTSFX28                                                         
                                                                                
         OC    R4RHOMER,R4RHOMER   ANY HOME MKT RECEIVING ID?                   
         JNZ   EXITY               YES, DEFAULT CAN'T BE STATION FAX            
                                                                                
         MVI   R4RDFLTR,YESQ                                                    
         J     EXITY                                                            
                                                                                
NXTSFX28 GOTOR SETEDIDF            TEST/SET EDI DEFAULT                         
         J     EXITY                                                            
         DROP  R1                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR READ FOR ROUTES REP FAX DOWNLOAD               *         
***********************************************************************         
                                                                                
ARYRFAX  LKOUT A,(R,NXTRFX),MULTIROW=Y,ROWNAME=R4RVALS                          
                                                                                
DType    LKOUT C,1,R4RDESTN,CHAR,ND=Y                                           
UPrfx    LKOUT C,2,R4RUSRID,CHAR,ND=Y                                           
UOffc    LKOUT C,3,R4ROFFIC,CHAR,ND=Y                                           
FaxNo    LKOUT C,4,R4RFAXNO,CHAR,ND=Y                                           
Attn.    LKOUT C,5,R4RATTN,CHAR,ND=Y                                            
Phone    LKOUT C,6,R4RPHONE,CHAR,ND=Y                                           
DRout    LKOUT C,99,R4RDFLTR,HDRO,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET REP FAX RECORDS                                                 *         
***********************************************************************         
                                                                                
NXTRFXDD USING DAREPTD,R4RDRTAB                                                 
NXTRFX   TM    R4RFLAG1,R4RFRFAX   DONE WITH REP FAX RECORDS?                   
         BNZ   NOMORE                                                           
*                                                                               
         CLI   R4RDESTN,R4RDREPQ   DESTINATION IS REP?                          
         BNE   NOMORE                                                           
                                                                                
         LA    R0,R4RVALS                                                       
         ST    R0,LP_ADATA                                                      
         XC    R4RVALS(R4RVALL),R4RVALS                                         
         MVI   R4RDESTN,R4RDREPQ   DESTINATION IS REP                           
         MVI   R4RDESTN,R4RDREPQ                                                
         MVC   R4RUSRID,NXTRFXDD.DAPTRPPF                                       
                                                                                
         CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTRFX02                                                         
                                                                                
         XC    FAXRSTR,FAXRSTR     BUILD FAX CODE RANGE                         
         LLC   RF,NXTRFXDD.DAPTLPFX                                             
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         MVC   FAXRSTR(0),NXTRFXDD.DAPTRPPF                                     
         EX    RF,0(RE)                                                         
         MVC   FAXREND,EFFS                                                     
         BASR  RE,0                                                             
         MVC   FAXREND(0),NXTRFXDD.DAPTRPPF                                     
         EX    RF,0(RE)                                                         
                                                                                
         TM    NXTRFXDD.DAPTFLG1,DPF1NOOF   X'80'- REP HAVE OFFICES?            
         JZ    NXTRFX02                     YES, IT MIGHT                       
         MVC   FAXRSTR,NXTRFXDD.DAPTRPPF    NO, REP PREFIX IS REP               
         MVC   FAXREND,NXTRFXDD.DAPTRPPF                                        
                                                                                
NXTRFX02 GOTOR (#NXTREC,ANXTREC),DMCB,FAXKEYT,('B#FAXREC',0),          +        
               ('$NXTRCTF+$NXTRXAD',SAVED),0,0                                  
         JE    *+12                                                             
         OI    R4RFLAG1,R4RFRFAX                                                
         B     EXITY                                                            
                                                                                
         L     R2,IOADDR                                                        
         USING CTFXKEY,R2                                                       
         LLC   RF,NXTRFXDD.DAPTLPFX                                             
         LA    R1,CTFXCODE(RF)     POINT TO AFTER THE PREFIX                    
                                                                                
         TM    NXTRFXDD.DAPTFLG1,DPF1NOOF  X'80'- REP HAVE OFFICES?             
         JZ    NXTRFX04                     YES                                 
         CLI   0(R1),C' '          NO - WE SHOULD JUST HAVE THE PREFIX          
         BH    NOMORE                                                           
         CLC   R4RHOMEM,=C'**'     ANY OFFICE CAN SEND STATION EDI?             
         JE    NXTRFX06                                                         
         CLC   R4RHOMEM,DAREOFFC   HOME MARKET=ROUTING OFFICE?                  
         JE    NXTRFX06                                                         
         GOTOR SETEDIDF2           TEST/SET EDI DEFAULT                         
         J     NXTRFX06                                                         
                                                                                
NXTRFX04 CLI   2(R1),C' '          ONLY WANT THOSE WITH 2 CHAR OFFICE           
         JH    NXTRFX02                                                         
         CLI   1(R1),C' '          THIS SHOULD MEAN WE HAVE 2 CHAR AFTR         
         JNH   NXTRFX02            THE USER-ID PREFIX                           
         MVC   R4ROFFIC,0(R1)      OUTPUT THIS OFFICE IF WE USE THIS ID         
         CLC   R4ROFFIC,DAREOFFC                                                
         JNE   NXTRFX06                                                         
         CLC   R4RHOMEM,=C'**'     ANY OFFICE CAN SEND STATION EDI?             
         JE    NXTRFX06                                                         
         CLC   R4RHOMEM,DAREOFFC   HOME MARKET=ROUTING OFFICE?                  
         JE    NXTRFX06                                                         
         GOTOR SETEDIDF2           TEST/SET EDI DEFAULT                         
                                                                                
NXTRFX06 LA    R1,CTFXEL1          POINT TO FIRST ELEMENT ON RECORD             
NXTRFX08 CLI   0(R1),EOR           WANT ONLY THOSE WITH FAX NUMBERS             
         JE    NXTRFX20                                                         
         CLI   0(R1),CTFX1ELQ      X'01' - FAX NUMBER ELEMENT                   
         JE    NXTRFX12                                                         
         CLI   0(R1),CTFX2ELQ      X'02' - ATTENTION ELEMENT                    
         JE    NXTRFX14                                                         
         CLI   0(R1),CTFX4ELQ      X'04' - PHONE NUMBER ELEMENT                 
         JE    NXTRFX16                                                         
NXTRFX10 LLC   R0,1(R1)            BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         J     NXTRFX08                                                         
                                                                                
         USING CTFX1EL,R1                                                       
NXTRFX12 LLC   RF,CTFX1LEN                                                      
         SHI   RF,CTFX1NUM-CTFX1EL+1                                            
         BASR  RE,0                                                             
         MVC   R4RFAXNO(0),CTFX1NUM                                             
         EX    RF,0(RE)                                                         
         J     NXTRFX10                                                         
                                                                                
         USING CTFX2EL,R1                                                       
NXTRFX14 MVC   R4RATTN,CTFX2ATT                                                 
         J     NXTRFX10                                                         
                                                                                
         USING CTFX4EL,R1                                                       
NXTRFX16 LLC   RF,CTFX4LEN                                                      
         SHI   RF,CTFX4TEL-CTFX4EL+1                                            
         BASR  RE,0                                                             
         MVC   R4RPHONE(0),CTFX4TEL                                             
         EX    RF,0(RE)                                                         
         J     NXTRFX10                                                         
                                                                                
NXTRFX20 OC    R4RFAXNO,R4RFAXNO   TEST FAX NUMBER PRESENT                      
         JZ    *+12                                                             
         OI    R4RFLAG1,R4RFGRFX   WE GOT A REP FAX RECORD                      
         B     EXITY                                                            
         XC    R4RCONV(R4RCONL),R4RCONV   NO - GET NEXT RECORD                  
         J     NXTRFX02                                                         
         DROP  NXTRFXDD                                                         
                                                                                
SETEDIDF TM    R4RFLAG1,R4RFDFLT   TEST/SET EDI DEFAULT                         
         BNZR  RE                                                               
         TM    R4RFLAG2,R4RRPIBX   FOR FAX ROUTINES, REP/INBOX WILL BE          
         BNZR  RE                  DEFAULT                                      
*                                                                               
         OI    R4RFLAG1,R4RFDFLT                                                
         MVI   R4RDFLTR,YESQ                                                    
         BR    RE                                                               
*                                                                               
SETEDIDF2 TM    R4RFLAG1,R4RFDFLT   TEST/SET EDI DEFAULT                        
         BNZR  RE                                                               
         TM    R4RFLAG2,R4RRPIBX   FOR FAX ROUTINES, REP/INBOX WILL BE          
         BNZR  RE                  DEFAULT                                      
*                                                                               
         OI    R4RFLAG1,R4RFDFLT                                                
         MVI   R4RDFLTR,YESQ                                                    
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* MAKEGOOD DOWNLOAD REQUEST  X'0150'                                  *         
***********************************************************************         
                                                                                
REQSDM   LKREQ H,I#SDMGED,POINTTO=REQORD,NEXTREQ=REQORD                         
                                                                                
***********************************************************************         
* ORDERS LOCK DOWNLOAD REQUEST  X'0152'                               *         
***********************************************************************         
                                                                                
REQORD   LKREQ H,I#SDORDD,OUTORD,NEXTREQ=REQOMS                                 
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'DCKAGMD,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                  
CltCd    LKREQ F,2,(I,B#SAVED,CLTIND),(U,#VALCLT,$VALCLT),             +        
               DEFAULT=Y,OLEN=L'DCKCLT,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*         
PrdCd    LKREQ F,3,(I,B#SAVED,PRDIND),(U,#VALPRD,$VALPRD),DEFAULT=Y,   +        
               OLEN=L'DCKPRD,MAXLEN=L'PKEYPRD,TEXT=SP#PRO,COL=*                 
PigCd    LKREQ F,6,(I,B#SAVED,PIGIND),(U,#VALPRD,$VALPRD),             +        
               OLEN=L'DCKPRD2,MAXLEN=L'PKEYPRD,TEXT=SP#PIGGY,COL=*              
EstNo    LKREQ F,4,(I,B#SAVED,ESTIND),LBIN,LIST=NOD,RANGE=Y,           +        
               DEFAULT=NOT,OLEN=L'DCKEST,TEXT=SP#EST,COL=*                      
StNet    LKREQ F,5,(I,B#SAVED,STAIND),(U,#VALSTA,$VALSTA),             +        
               OLEN=L'BUYKSTAC,MAXLEN=STASTAL,TEXT=SP#STA,COL=*,       +        
               LIST=NOD,DEFAULT=Y                                               
FltNo    LKREQ F,7,(I,B#SAVED,FLTIND),LBIN,LIST=NOD,RANGE=Y,           +        
               DEFAULT=Y,OLEN=L'DCKFLTNM,TEXT=SP#FLGHT,COL=*                    
         LKREQ E                                                                
                                                                                
OUTORD   LKOUT H                   ** ORDERS LOCK DOWNLOAD **                   
         LKOUT R,X'0080'                                                        
Array    LKOUT C,X'0080',(A,ARYSTO)                                             
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD DOWNLOAD/ORDER LOCK DOWNLOAD          *         
***********************************************************************         
                                                                                
ARYSTO   LKOUT A,(R,NXTORD),MULTIROW=Y,ROWNAME=ORDVALS                          
                                                                                
OrdNo    LKOUT C,1,ORDER#,(U,#EDTORD,$EDTORD)                                   
Statn    LKOUT C,2,ORDSTA,CHAR                                                  
TMthd    LKOUT C,3,ORDMTHD,CHAR,ND=Y,FILTROUT=TSTCSHOR,SKIPCOLS=1               
TData    LKOUT C,4,ORDDATA,CHAR,ND=Y                                            
PrdCd    LKOUT C,5,ORDPRD,(U,#EDTPRD,$EDTPRD)                                   
PigCd    LKOUT C,6,ORDPIG,(U,#EDTPRD,$EDTPRD),ND=Y                              
FltNo    LKOUT C,7,ORDFLT,CHAR,ND=Y                                             
Buyer    LKOUT C,8,(D,B#SAVED,ORDBUYER),CHAR                                    
Array    LKOUT C,X'0082',(A,ARYMKN),FILTROUT=TSTSDMGE                           
*Array    LKOUT C,X'0082',(A,ARYNOT),FILTROUT=TSTSDMGE                          
                                                                                
         LKOUT E                                                                
                                                                                
TSTCSHOR TM    ORDMTHD,X'40'       SET CC=EQUAL IF UPPER CASE                   
         BZ    RTRNNO                                                           
         B     RTRNYES                                                          
                                                                                
TSTNSMGE CLC   LP_QMAPN,SDMGED#    SET CC=NEQUAL IF MAKEGOOD DOWNLOAD           
         B     SETCCC                                                           
*                                                                               
TSTSDMGE CLC   LP_QMAPN,SDMGED#    SET CC=EQUAL IF MAKEGOOD DOWNLOAD            
         BR    RE                                                               
                                                                                
***********************************************************************         
* GET DARE ORDER RECORDS FOR ORIGINAL VERSION                         *         
***********************************************************************         
                                                                                
NXTORD   CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTORD04                                                         
         ICM   RF,7,AMED                                                        
         MVC   QMEDX,LW_DATA1-LW_D(RF)                                          
         GOTOR (#EDTMED,AEDTMED),DMCB,QMEDX,,QMEDA                              
         JNE   *+2                                                              
         MVC   BUYMED,QMEDA        SET BUYMED FOR GETSTA ROUTINE                
         ICM   RF,7,ACLT                                                        
         MVC   QCLTX,LW_DATA1-LW_D(RF)                                          
         GOTOR RESCLT              RESOLVE CLIENT VALUES                        
         JNE   *+2                                                              
                                                                                
         OC    APRD1,APRD1         TEST PRODUCT SET                             
         JNZ   *+10                                                             
         MVC   APRD1,APRD          NO - SET IT                                  
                                                                                
         OC    APIG,APIG           TEST PIGGYBACK PRODUCT SET                   
         JNZ   NXTORD04                                                         
         ICM   RE,7,APRD                                                        
         USING LW_D,RE                                                          
         CLI   LW_TYPE,LQ_TALLQ                                                 
         JNE   *+14                                                             
         MVC   APIG,APRD                                                        
         J     NXTORD04                                                         
                                                                                
         CLI   LW_TYPE,LQ_TSINQ                                                 
         JNE   *+2                                                              
         CLI   LW_DATA1,POLPRDQ                                                 
         JE    NXTORD02                                                         
                                                                                
         L     RE,LP_AWMP                                                       
         STCM  RE,7,APIG                                                        
         MVI   PIGIND,LQ_TSINQ                                                  
         MVI   LW_TYPE,LQ_TSINQ                                                 
         MVI   LW_DATA1,0                                                       
         AHI   RE,LW_LN1Q+1                                                     
         ST    RE,LP_AWMP                                                       
         J     NXTORD04                                                         
                                                                                
NXTORD02 L     RE,LP_AWMP                                                       
         STCM  RE,7,APIG                                                        
         MVI   LW_TYPE,LQ_TRNGQ                                                 
         MVI   LW_DATA1,1                                                       
         MVI   LW_DATA1+1,POLPRDQ-1                                             
         AHI   RE,LW_LN1Q+2                                                     
         ST    RE,LP_AWMP                                                       
         DROP  RE                                                               
                                                                                
NXTORD04 GOTOR (#NXTREC,ANXTREC),DMCB,DCKKEY2T,('B#ORDREC',0),SAVED,0, +        
               AGETORD                                                          
         BNE   EXITY                                                            
         L     R2,IOADDR                                                        
         USING DAREORDD,R2         R2=A(DARE ORDER RECORD)                      
         XC    ORDVALS(ORDVALL),ORDVALS                                         
         LA    R0,ORDVALS                                                       
         ST    R0,LP_ADATA                                                      
         MVC   ORDER#,DOKORDER                                                  
         XC    DUB(L'DOSPMKT),DUB                                               
         MVC   DUB+L'DOSPMKT(L'DOKSTA),DOKSTA                                   
         GOTOR GETSTA,DUB                                                       
         MVC   ORDSTA,STAPQSTA                                                  
         MVI   ORDFL1,0                                                         
                                                                                
         LA    R2,DORFRST          EXTRACT TRADE TYPE & DATA                    
         USING DOSPELD,R2                                                       
NXTORD06 CLI   DOSPEL,EOR                                                       
         BE    EXITY                                                            
         CLI   DOSPEL,DOSPELQ                                                   
         JE    NXTORD08                                                         
         LLC   R0,DOSPLEN                                                       
         AR    R2,R0                                                            
         J     NXTORD06                                                         
NXTORD08 MVC   ORDFL1,DOSPFLG1                                                  
         CLI   DOSPLEN,DOSPTMTH-DOSPELD                                         
         BNH   EXITY                                                            
         MVC   ORDMTHD,DOSPTMTH                                                 
         MVC   ORDDATA,DOSPTDAT                                                 
         B     EXITY                                                            
         DROP  R2                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD NOTICE DOWNLOAD                       *         
***********************************************************************         
*                                                                               
*ARYNOT   LKOUT A,(R,NXTOMN),MULTIROW=Y,ROWNAME=NOTVALS                         
*                                                                               
*Group    LKOUT C,1,NOTGROUP,CHAR,ND=Y                                          
*Gstat    LKOUT C,2,NOTSTAT,CHAR,ND=Y                                           
*SDate    LKOUT C,3,NOTDATE,JDAT,ND=Y                                           
*STime    LKOUT C,4,NOTTIME,(R,EDTTIME)                                         
*RecDA    LKOUT C,5,NOTDA,HEXD,ND=Y                                             
*ChkSm    LKOUT C,6,NOTCKSM,HEXD,ND=Y                                           
*********                                                                       
*********                                                                       
*Array    LKOUT C,X'0084',(A,ARYXBD)                                            
*Array    LKOUT C,X'0086',(A,ARYMSC)                                            
*Array    LKOUT C,X'0088',(A,ARYMSO)                                            
*Array    LKOUT C,X'008A',(A,ARYMBC)                                            
*Array    LKOUT C,255,(A,ARYOFF)                                                
*                                                                               
*         LKOUT E                                                               
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD OFFER DOWNLOAD                        *         
***********************************************************************         
*                                                                               
*ARYOFF   LKOUT A,(R,NXTOFF),MULTIROW=Y,ROWNAME=DAREMGOD                        
*                                                                               
*ARRAY    LKOUT C,X'008C',(A,ARYMGCC)                                           
*Array    LKOUT C,X'008E',(A,ARYMGB)                                            
*                                                                               
*         LKOUT E                                                               
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD GROUP COMMENTS                        *         
***********************************************************************         
*                                                                               
*ARYMGCC  LKOUT A,(D,B#OFFREC,MORFRST),NEWEL=Y,EOT=EOR,                         
*               ROWID=(MOCMELD,MOCMELQ),ROWWIDTH=(V,MOCMLEN)                    
*                                                                               
*Line#    LKOUT C,1,MOCMLINE,UBIN,ND=Y                                          
*CText    LKOUT C,2,MOCMTEXT,CHAR,ND=Y,LEN=V                                    
*                                                                               
*         LKOUT E                                                               
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD GROUP COMMENTS                        *         
***********************************************************************         
*                                                                               
*AXYMGCC  LKOUT A,(D,B#OFFREC,MOXFRST),NEWEL=Y,EOT=EOR,                         
*               ROWID=(MOCMELD,MOCMELQ),ROWWIDTH=(V,MOCMLEN)                    
*                                                                               
*Line#    LKOUT C,1,MOCMLINE,UBIN,ND=Y                                          
*CText    LKOUT C,2,MOCMTEXT,CHAR,ND=Y,LEN=V                                    
*                                                                               
*         LKOUT E                                                               
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DOWNLOAD                          *         
***********************************************************************         
*                                                                               
*ARYMGB   LKOUT A,(D,B#OFFREC,MORFRST),NEWEL=B,EOT=EOR,                         
*               ROWID=(MOMBELD,MOMBELQ),ROWWIDTH=(V,MOMBLEN),                   
*               SETFILT=(MOMBOFFR,L'MOMBOFFR+L'MOMBREC)                         
*                                                                               
*Offer    LKOUT C,1,MOMBOFFR,UBIN,ND=Y                                          
*RecNo    LKOUT C,2,MOMBREC,UBIN,ND=Y                                           
*BDays    LKOUT C,3,MOMBDAYS,UBIN,ND=Y                                          
*OOWSD    LKOUT C,4,MOMBOROT,UBIN,ND=Y                                          
*STime    LKOUT C,5,MOMBSTIM,UBIN,ND=Y                                          
*Etime    LKOUT C,6,MOMBETIM,UBIN,ND=Y                                          
*TSecs    LKOUT C,7,MOMBTSLN,UBIN,ND=Y                                          
*BCost    LKOUT C,8,MOMBCOST,UBIN,ND=Y                                          
*P1Shr    LKOUT C,9,MOMBPTIM,UBIN,ND=Y                                          
*SType    LKOUT C,10,MOMBSTYP,CHAR,ND=Y                                         
*DayPt    LKOUT C,11,MOMBDYPT,CHAR,ND=Y                                         
*ProgN    LKOUT C,12,MOMBPROG,CHAR,ND=Y,LEN=V                                   
*AdjCd    LKOUT C,13,MOMBELD,(R,FNDADJ),ND=Y,LEN=2                              
*Array    LKOUT C,255,(A,ARYMBR),FILTROUT=FNDMOD                                
*Array    LKOUT C,255,(A,ARYBMD),FILTROUT=TSTMODNF                              
*Array    LKOUT C,255,(A,ARYMBNTD)                                              
*Array    LKOUT C,255,(A,ARYRBD)      Seller Demo values as a comment           
*Array    LKOUT C,255,(A,ARYRBC)                                                
*Array    LKOUT C,255,(A,ARYMOD)                                                
*Array    LKOUT C,255,(A,ARYMBU)                                                
*Array    LKOUT C,255,(A,ARYMBD)                                                
*Array    LKOUT C,255,(A,ARYMPC)                                                
*Array    LKOUT C,255,(A,ARYMRC)                                                
*Array    LKOUT C,255,(A,ARYMGE),PCVERSION=2.7.0.0                              
*Array    LKOUT C,255,(A,ARYBBC)                                                
*                                                                               
*         LKOUT E                                                               
TSTMODNF MVC   AMOMBEL,LP_AINP     SET A(MOMBEL)                                
         CLI   MONTDFND,NOQ                                                     
         BNER  RE                                                               
         CLI   MODFOUND,NOQ        SET CC=EQUAL IF BOTH MODMEL & MONTEL         
         BR    RE                  NOT FOUND                                    
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DEMO DOWNLOAD                     *         
***********************************************************************         
                                                                                
ARYMBR   LKOUT A,(D,B#WORKD,ELEM),EOT=EOR,                             +        
               ROWID=(MODMELD,MODMELQ),ROWWIDTH=(V,MODMLEN)                     
                                                                                
Dummy    LKOUT C,255,MODMELD,(R,SETDEM),ND=Y                                    
Array    LKOUT C,255,(A,ARYMBRV)                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* SET NUMBER OF DEMOS IN MAKEGOOD OFFER DEMO ELEMENT                  *         
***********************************************************************         
                                                                                
SETDEM   L     R1,LP_AINP                                                       
         USING MODMELD,R1          R1=A(MAKEGOOD OFFER DEMO ELEMENT)            
         LA    RF,MODMDEMO                                                      
         STCM  RF,15,OFFADEM       SET A(DEMO LIST)                             
         SR    RF,RF                                                            
         ICM   RF,1,MODMLEN                                                     
         SHI   RF,MODMOVRH                                                      
         SR    RE,RE                                                            
         LHI   R0,L'MODMDEMO                                                    
         DR    RE,R0                                                            
         STCM  RF,3,OFFDEM#        SET NUMBER OF DEMOS IN LIST                  
         B     XCOLEN                                                           
         DROP  R1                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DEMO DOWNLOAD                     *         
***********************************************************************         
                                                                                
ARYMBRV  LKOUT A,(I,B#SAVED,OFFADEM),NROWS=(B#SAVED,OFFDEM#),          +        
               ROWNAME=MODMDEMO,ROWWIDTH=L'MODMDEMO                             
                                                                                
PRout    LKOUT P,(B#SVRDEF,BLDESTOR),SETROUT                                    
PRout    LKOUT P,,INITDEMS                                                      
DemCd    LKOUT C,14,MODMDEMO+0,(R,EDTDCD)                                       
DemVl    LKOUT C,15,MODMDEMO+4,(R,EDTDVL),LEN=4                                 
DemOr    LKOUT C,16,(D,B#SAVED,OFFOVER),HDRO,ND=Y                               
PRout    LKOUT P,MODMDEMO,SETNTFLG                                              
NtDemRLK LKOUT C,36,(D,B#WORKD,BYTE1),CHAR,ND=Y                                 
NtDemNA  LKOUT C,37,(D,B#WORKD,BYTE2),CHAR,ND=Y                                 
                                                                                
         LKOUT E                                                                
SETROUT  L     R1,LP_AINP          SET NUMBER OF DEMOS                          
         ST    R1,AROUTADR                                                      
         B     EXIT                                                             
*                                                                               
SETNTFLG MVI   BYTE1,0                                                          
         MVI   BYTE2,0                                                          
         USING EDEMLIS1,RF                                                      
         L     RF,LP_AINP          TEST IF STATUS IS SENT                       
         LLC   RE,EDEMLNU1                                                      
         ICM   RE,B'0010',EDEMLIS1  BYTE1&3 ZERO, NON-TRADITIONAL?              
         LTR   RE,RE               HAVE NON-TRADITIONAL DEMO CAT?               
         BNZ   EXIT                 NO                                          
*                                   YES, SET DEFAULT NON-TRAD LKUP FLGS         
         MVI   BYTE1,C'N'          SET DEF NON-TRAD DEMO REQ LOOKUP             
         MVI   BYTE2,C'N'          SET DEF NON-TRAD IS NOT N/A                  
         B     EXIT                                                             
         DROP  RF                                                               
*                                                                               
INITDEMS XC    SVDEMTYL,SVDEMTYL                                                
         J     EXITY                                                            
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY BUYER NON-TRAD DEMO DOWNLOAD      *         
***********************************************************************         
                                                                                
ARYMBNTD LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MONTELD,MONTELQ),ROWWIDTH=(V,MONTLEN),           +        
               TESTFILT=(MONTOFFR,L'MONTOFFR+L'MONTREC)                         
                                                                                
Array    LKOUT C,1,(A,ARYMNTD)     MKGD NON-TRAD DEMO CATS/VALUES               
                                                                                
         LKOUT E                                                                
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR CABLE MAKEGOOD BUY BUYER NON-TRAD DEMO DOWNLOAD*         
***********************************************************************         
AXYMBNTD LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MONTELD,MONTELQ),ROWWIDTH=(V,MONTLEN),           +        
               TESTFILT=(MONTOFFR,L'MONTOFFR+L'MONTREC)                         
                                                                                
Array    LKOUT C,1,(A,ARYMNTD)     MKGD NON-TRAD DEMO CATS/VALUES               
                                                                                
         LKOUT E                                                                
*                                                                               
ARYMNTD  LKOUT A,(*,MONTDEMO),ROWNAME=MONTELD,NROWS=*,                 +        
               ROWWIDTH=L'MONTDEMO                                              
PRout    LKOUT P,(B#SVRDEF,BLDESTOR),SETROUT                                    
PRout    LKOUT P,,INITDEMS                                                      
NtDemCD  LKOUT C,14,MONTBDMO,(R,EDTDCD)                                         
NtDemVl  LKOUT C,15,MONTDVAL,(R,EDTDVL)                                         
NtDemOr  LKOUT C,16,(D,B#SAVED,OFFOVER),HDRO,ND=Y                               
NtDemRLK LKOUT C,36,MONTFLG1,MB80                                               
NtDemNA  LKOUT C,37,MONTFLG1,MB40                                               
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY PURPOSE CODE DOWNLOAD             *         
***********************************************************************         
                                                                                
ARYMPC   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOPRPELD,MOPRPELQ),ROWWIDTH=(V,MOPRPLEN),        +        
               TESTFILT=(MOPRPOFR,L'MOPRPOFR+L'MOPRPREC)                        
                                                                                
Purps    LKOUT C,30,MOPRPCOD,CHAR,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY PURPOSE CODE DOWNLOAD             *         
***********************************************************************         
                                                                                
AXYMPC   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOPRPELD,MOPRPELQ),ROWWIDTH=(V,MOPRPLEN),        +        
               TESTFILT=(MOPRPOFR,L'MOPRPOFR+L'MOPRPREC)                        
                                                                                
Purps    LKOUT C,30,MOPRPCOD,CHAR,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY REASON CODE DOWNLOAD              *         
***********************************************************************         
                                                                                
ARYMRC   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MORSNELD,MORSNELQ),ROWWIDTH=(V,MORSNLEN),        +        
               TESTFILT=(MORSNOFR,L'MORSNOFR+L'MORSNREC)                        
                                                                                
Reasn    LKOUT C,31,MORSNCOD,CHAR,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY REASON CODE DOWNLOAD              *         
***********************************************************************         
                                                                                
AXYMRC   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MORSNELD,MORSNELQ),ROWWIDTH=(V,MORSNLEN),        +        
               TESTFILT=(MORSNOFR,L'MORSNOFR+L'MORSNREC)                        
                                                                                
Reasn    LKOUT C,31,MORSNCOD,CHAR,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD MGE CODE                              *         
***********************************************************************         
                                                                                
ARYMGE   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MNUMELD,MNUMELQ),ROWWIDTH=(V,MNUMLEN),           +        
               TESTFILT=(MNUMOFR,L'MNUMOFR+L'MNUMREC)                           
                                                                                
MGECd    LKOUT C,40,MNUMCD,CHAR                                                 
MGELn    LKOUT C,41,MNUMNUM,LBIN,ND=Y,PCVERSION=2.8.0.0                         
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD MGE CODE                              *         
***********************************************************************         
                                                                                
AXYMGE   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MNUMELD,MNUMELQ),ROWWIDTH=(V,MNUMLEN),           +        
               TESTFILT=(MNUMOFR,L'MNUMOFR+L'MNUMREC)                           
                                                                                
MGECd    LKOUT C,40,MNUMCD,CHAR                                                 
MGELn    LKOUT C,41,MNUMNUM,LBIN,ND=Y,PCVERSION=2.8.0.0                         
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUYER BUY COMMENT DOWNLOAD            *         
***********************************************************************         
                                                                                
ARYBBC   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOBBCELD,MOBBCELQ),ROWWIDTH=(V,MOBBCLEN),        +        
               TESTFILT=(MOBBCOFR,L'MOBBCOFR+L'MOBBCREC)                        
                                                                                
SeqNo    LKOUT C,32,MOBBCSEQ,UBIN,ND=Y                                          
CText    LKOUT C,33,MOBBCTXT,CHAR,ND=Y,LEN=V                                    
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUYER BUY COMMENT DOWNLOAD            *         
***********************************************************************         
                                                                                
AXYBBC   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOBBCELD,MOBBCELQ),ROWWIDTH=(V,MOBBCLEN),        +        
               TESTFILT=(MOBBCOFR,L'MOBBCOFR+L'MOBBCREC)                        
                                                                                
SeqNo    LKOUT C,32,MOBBCSEQ,UBIN,ND=Y                                          
CText    LKOUT C,33,MOBBCTXT,CHAR,ND=Y,LEN=V                                    
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DEMO UPGRADE DOWNLOAD             *         
***********************************************************************         
                                                                                
ARYMBU   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOUPGELD,MOUPGELQ),ROWWIDTH=(V,MOUPGLEN),        +        
               TESTFILT=(MOUPGOFR,L'MOUPGOFR+L'MOUPGREC)                        
                                                                                
UpFor    LKOUT C,24,MOUPGTXT,CHAR,FILTROUT=TSTUPGRD                             
Book     LKOUT C,42,MOUPGBK,CHAR,FILTROUT=TSTBOOK,SKIPCOLS=1                    
BookTy   LKOUT C,43,MOUPGBT,CHAR,ND=Y                                           
                                                                                
         LKOUT E                                                                
                                                                                
TSTUPGRD L     RF,LP_AINP          TEST IF ELEM IS UPGRADE                      
         CLC   MOUPGTXT-MOUPGELD(3,RF),=C'UPT'                                  
         BER   RE                                                               
         CLC   MOUPGTXT-MOUPGELD(3,RF),=C'UPP'                                  
         BR    RE                                                               
                                                                                
TSTBOOK  L     RF,LP_AINP          TEST IF ELEM IS BOOK                         
         CLC   MOUPGBKH-MOUPGELD(3,RF),=C'BK='                                  
         BR    RE                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DEMO UPGRADE DOWNLOAD             *         
***********************************************************************         
                                                                                
AXYMBU   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOUPGELD,MOUPGELQ),ROWWIDTH=(V,MOUPGLEN),        +        
               TESTFILT=(MOUPGOFR,L'MOUPGOFR+L'MOUPGREC)                        
                                                                                
UpFor    LKOUT C,24,MOUPGTXT,CHAR,FILTROUT=TSTUPGRD                             
Book     LKOUT C,42,MOUPGBK,CHAR,FILTROUT=TSTBOOK,SKIPCOLS=1                    
BookTy   LKOUT C,43,MOUPGBT,CHAR,ND=Y                                           
                                                                                
         LKOUT E                                                                
         EJECT                                                                  
***********************************************************************         
* SINGLE ORDER DOWNLOAD REQUEST  X'00E1'                              *         
***********************************************************************         
                                                                                
REQOMS   LKREQ H,I#SDOMSD,OUTOMS,NEXTREQ=REQOMM                                 
Media    LKREQ F,1,(D,B#WORKD,QMEDX),(U,#VALMED,$VALMED),              +        
               OLEN=L'DCKAGMD,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                  
OrdNo    LKREQ F,2,(I,B#SAVED,ORDIND),(U,#VALORD,$VALORD),LIST=F,      +        
               SORT=N,OLEN=L'DOKORDER,TEXT=SP#ORDN,COL=*                        
         LKREQ E                                                                
                                                                                
OUTOMS   LKOUT H                   ** SINGLE ORDER D/L **                       
                                                                                
OMSORD   LKOUT R,X'00DA'                                                        
Array    LKOUT C,255,(A,ARYOMS)                                                 
         LKOUT E                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SINGLE ORDER READ                              *         
***********************************************************************         
                                                                                
ARYOMS   LKOUT A,(R,NXTOMS),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,255,(A,ARYORD)                                                 
Array    LKOUT C,X'00E3',(A,ARYOSC)                                             
Array    LKOUT C,X'00E4',(A,ARYOCC)                                             
Array    LKOUT C,X'00E5',(A,ARYURL)                                             
Array    LKOUT C,X'00E6',(A,ARYOST)                                             
Array    LKOUT C,X'00E9',(A,ARYRURL)                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER RECORD FOR SINGLE ORDER DOWNLOAD                     *         
***********************************************************************         
                                                                                
NXTOMS   CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTOMS02                                                         
         ICM   RF,7,AORD                                                        
         BZ    NOMORE                                                           
         MVC   ORDIND,LW_NUMN+(L'LW_NUMN-L'ORDIND)-LW_D(RF)                     
         AHI   RF,LW_DATA2-LW_D                                                 
         STCM  RF,7,AORD                                                        
                                                                                
NXTOMS02 SR    RF,RF                                                            
         ICM   RF,1,ORDIND                                                      
         BZ    NOMORE                                                           
         SHI   RF,1                                                             
         STC   RF,ORDIND                                                        
         ICM   RF,7,AORD                                                        
         LA    R0,L'DOKORDER(RF)                                                
         STCM  R0,7,AORD                                                        
                                                                                
         LA    R2,IOKEY                                                         
         USING DAREORDD,R2                                                      
         XC    DOKEY,DOKEY                                                      
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,QMEDX                                                    
         MVC   DOKORDER,0(RF)                                                   
         GOTOR (#IOEXEC,AIOEXEC),'IOBHI+IODIR+B#ORDREC'                         
         JNE   NXTOMS02                                                         
         CLC   DOKEY(DOKSTA-DOKEY),IOKEYSAV                                     
         JNE   NXTOMS02                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ORDREC'                        
         JNE   NXTOMS02                                                         
         L     R1,IOADDR                                                        
         GOTOR GETORD,(R1)                                                      
                                                                                
         GOTOR ASETORD             SET ORDER VALUES                             
         B     EXITY                                                            
         DROP  R2                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER REJECT URL DOWNLOAD                      *         
***********************************************************************         
                                                                                
ARYRURL  LKOUT A,(R,NXTRURL),MULTIROW=Y,ROWNAME=DAREORDD                        
                                                                                
Array    LKOUT C,X'00E9',(A,ARYRJUR),PCVERSION=2.5.0.6                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER REJECT URL DETAILS                                   *         
***********************************************************************         
                                                                                
NXTRURL  GOTOR GETCOM,DOKRURLQ                                                  
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER REJECT URL DETAILS DOWNLOAD              *         
***********************************************************************         
                                                                                
ARYRJUR  LKOUT A,(D,B#OBCREC,DORFRST),EOT=EOR,NEWEL=B,                 +        
               ROWID=(DRURLELD,DRURLELQ),ROWWIDTH=(V,DRURLLEN)                  
                                                                                
VerNo    LKOUT C,1,DRURLVER,LBIN,ROWID=(DRURLVER,0)                             
URLAd    LKOUT C,2,DRURLELD,(R,EDTRURL),ROWID=(DRURLVER,0)                      
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER STATUS HISTORY DOWNLOAD               *         
***********************************************************************         
                                                                                
ARYOST   LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,NEWEL=B,                 +        
               ROWID=(DOSTELD,DOSTELQ),ROWWIDTH=(V,DOSTLEN),           +        
               SETFILT=(DOSTDATE,L'DOSTDATE+L'DOSTTIME+L'DOSTSTAT)              
                                                                                
StDat    LKOUT C,1,DOSTDATE,JDAT                                                
StTim    LKOUT C,2,DOSTTIME,(R,EDTTIME)                                         
Sttus    LKOUT C,3,DOSTSTAT,CHAR                                                
SndCnt   LKOUT C,26,(D,B#SAVED,ORDSCNT),LBIN,ND=Y                               
PRout    LKOUT P,DOSTELD,SETSCT                                                 
StTyp    LKOUT C,4,DOSTTYPE,HEXD,ROWID=(DOSTLEN,DOSTLNQ3),             +        
               FILTROUT=TSTCANRJ                                                
SnTyp    LKOUT C,25,DOSTTYP2,HEXD,ROWID=(DOSTLEN,DOSTLNQ7)                      
Array    LKOUT C,255,(A,ARYOME),FILTROUT=TSTERROR                               
SetID    LKOUT C,255,DOSTELD,(R,SETOID),ND=Y                                    
UsrID    LKOUT C,6,(D,B#SAVED,ORDCOMP),(R,EDTUID),LEN=L'CTIKID,ND=Y             
Array    LKOUT C,255,(A,ARYOMX),FILTROUT=TSTXTRA                                
UsrID    LKOUT C,11,(D,B#SAVED,ORDRECV),(R,EDTUID),LEN=L'CTIKID,ND=Y            
UsrID    LKOUT C,11,DOSTDRPP,CHAR,LEN=L'DOSTDRPP+L'DOSTDRPO,           +        
               ROWID=(DOSTLEN,DOSTLNQ6),FILTROUT=TSTDLVRD                       
Array    LKOUT C,255,(A,ARYEML),FILTROUT=TSTEXPR,PCVERSION=3.0.0.120            
                                                                                
         LKOUT E                                                                
                                                                                
TSTXTRA  CLI   ORDEXTRA,YESQ       TEST IF EXTRA RECORD WAS FOUND               
         BR    RE                                                               
                                                                                
TSTEXPR  L     RF,LP_AINP          TEST IF STATUS IS SENT (EXPORT)              
         CLI   DOSTSTAT-DOSTELD(RF),DSENT                                       
         BNE   RTRNNO              WE DON'T WANT IT THEN                        
         CLI   ORDEXTRA,YESQ       TEST IF EXTRA RECORD WAS FOUND               
         BR    RE                                                               
                                                                                
TSTERROR L     RF,LP_AINP          TEST IF STATUS IS ERROR                      
         CLI   DOSTSTAT-DOSTELD(RF),QERRORED                                    
         BR    RE                                                               
                                                                                
TSTDLVRD L     RF,LP_AINP          TEST IF STATUS IS DELIVERED                  
         CLI   DOSTSTAT-DOSTELD(RF),DDLVRD                                      
         BR    RE                                                               
*                                                                               
* PRIOR TO V4.6.0.156, SBTK INCORRECTLY SHOWS CANCELLED REJECTED STATUS         
* AS AMENDED STATUS. SO IF VER LT V4.6.0.156, JUST SHOW REJECT                  
*                                                       -HWON 7/25/2017         
TSTCANRJ L     RF,LP_AINP          TEST IF STATUS IS CANCELLED REJECTED         
         CLI   DOSTLEN-DOSTELD(RF),DOSTLNQ3                                     
         BNE   RTRNNO                                                           
         CLI   DOSTSTAT-DOSTELD(RF),QRJCT                                       
         BNE   RTRNYES                                                          
         CLI   DOSTTYPE-DOSTELD(RF),0  AMEND?                                   
         BER   RE                       YES, SEND THE TYPE                      
         OC    LP_VRSN,LP_VRSN     HAVE SBTK VER#?                              
         BZR   RE                   NO, OK TO SHOW CANCELLED REJECTED           
         CLC   LP_VRSN,V4600156    SBTK VER# GTE V4.6.0.156                     
         BNL   RTRNYES              YES, SHOW CANCELLED REJECT                  
         B     RTRNNO               OW, JUST SHOW REJECTED                      
***********************************************************************         
* REDUCE ORDER SENT COUNT IF STATUS IS SENT, FAX, FAX RESENT          *         
*  - OE CANCEL & OE RESEND DOES NOT INCREMEMNT                                  
***********************************************************************         
                                                                                
SETSCT   SR    R1,R1                                                            
         ICM   R1,3,ORDSCNT                                                     
         JZ    EXIT                                                             
         L     RF,LP_AINP          TEST STATUS                                  
         USING DOSTELD,RF                                                       
         CLI   DOSTSTAT,DFXSENT    FAX SENT?                                    
         JE    SETSCT20                                                         
         CLI   DOSTSTAT,DFXRSNT    FAX RESENT?                                  
         JE    SETSCT20                                                         
*                                                                               
         CLI   DOSTSTAT,DSENT      SENT?                                        
         JNE   EXIT                                                             
         CLI   DOSTLEN,DOSTLNQ7    HAVE SPECIAL SEND TYPE?                      
         JNE   SETSCT20             NO, MUST BE REGULAR                         
         TM    DOSTTYP2,DOSTXRSD+DOSTCNCL  IS IT RESEND OR CANCEL?              
         JNZ   EXIT                 YES, DON'T DECREMENT                        
         DROP  RF                                                               
*                                                                               
SETSCT20 BCTR  R1,0                                                             
         STCM  R1,3,ORDSCNT                                                     
         B     EXIT                                                             
                                                                                
***********************************************************************         
* SET ORDER ID VALUES                                                 *         
***********************************************************************         
                                                                                
SETOID   L     R1,LP_AINP          POINT TO STATUS ELEMENT                      
         USING DOSTELD,R1                                                       
         XC    LP_OLEN,LP_OLEN                                                  
         XC    ORDIDV(ORDIDVL),ORDIDV                                           
         CLI   DOSTLEN,DOSTLNQ2                                                 
         JE    *+12                                                             
         CLI   DOSTLEN,DOSTLNQ6                                                 
         BNE   EXITY                                                            
         CLI   DOSTSTAT,DSENT                                                   
         JE    SETOID02                                                         
         CLI   DOSTSTAT,DFXSENT                                                 
         JE    SETOID02                                                         
         CLI   DOSTSTAT,DEMSENT                                                 
         JE    SETOID02                                                         
         CLI   DOSTSTAT,QEMPTY                                                  
         JNE   SETOID04                                                         
SETOID02 MVC   ORDCOMP,DOSTIDNM                                                 
         B     EXITY                                                            
                                                                                
SETOID04 CLI   DOSTSTAT,DDLVRD                                                  
         JNE   SETOID06                                                         
         CLI   DOSTLEN,DOSTLNQ6                                                 
         JNE   SETOID08            NORMAL DELIVERY IS FROM DOSTIDNM             
         LA    RE,DOSTDRPP+L'DOSTDRPP-1                                         
         CLI   0(RE),C' '                                                       
         JH    *+8                                                              
         JCT   RE,*-8                                                           
                                                                                
         LA    RE,1(RE)                                                         
         MVC   HALF,DOSTDRPO                                                    
         XC    DOSTDRPO,DOSTDRPO                                                
         MVC   0(2,RE),HALF                                                     
         B     EXITY                                                            
SETOID06 CLI   DOSTSTAT,DFXDLVD                                                 
         BNE   EXITY                                                            
SETOID08 MVC   ORDRECV,DOSTIDNM                                                 
         B     EXITY                                                            
         DROP  R1                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER EXPORT EMAIL ADDRESSES                   *         
***********************************************************************         
                                                                                
ARYEML   LKOUT A,(D,B#OMXREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOEMXEL,DOEMXELQ),ROWWIDTH=(V,DOEMXLEN),         +        
               TESTFILT=(DOEMXDAT,L'DOEMXDAT+L'DOEMXTIM)                        
                                                                                
EmLst    LKOUT C,27,(A,ARYEEL)                                                  
                                                                                
         LKOUT E                                                                
                                                                                
ARYEEL   LKOUT A,(*,DOEMXD2),ROWNAME=DOEMXEL,NROWS=*,ROWWIDTH=DOEMXLN2          
                                                                                
ESTyp    LKOUT C,27,DOEMXFLG,CHAR,ND=Y                                          
EAddr    LKOUT C,28,DOEMXTOK,(R,EDTEML),ND=Y                                    
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER ERROR CODE                               *         
***********************************************************************         
                                                                                
ARYOME   LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOCOMEL,DOCOMELQ),ROWWIDTH=(V,DOCOMLEN)                   
                                                                                
ErrNo    LKOUT C,5,DOCOMTXT,CHAR,LEN=3,ND=Y                                     
ErrTx    LKOUT C,24,DOCOMTXT+3,CHAR,LEN=V-3,ND=Y,FILTROUT=TSTSBSER              
                                                                                
         LKOUT E                                                                
                                                                                
TSTSBSER L     RF,LP_AINP          MORE THAN JUST ERROR CODE?                   
         CLI   DOCOMLEN-DOCOMELD(RF),DOCOMOVH+3                                 
         BNH   RTRNNO                                                           
         B     RTRNYES             YES, THEN WE HAVE ERROR TEXT                 
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER EXTRA STATUS                             *         
***********************************************************************         
                                                                                
ARYOMX   LKOUT A,(D,B#OMXREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOSTELD,DOSTELQ),ROWWIDTH=(V,DOSTLEN),           +        
               TESTFILT=(DOSTDATE,L'DOSTDATE+L'DOSTTIME+L'DOSTSTAT)             
                                                                                
PerID    LKOUT C,7,DOSTPID,(R,EDTPID),LEN=L'SAPALPID,ND=Y                       
PerNM    LKOUT C,8,(D,B#SAVED,PERNAME),CHAR,ND=Y                                
DstLS    LKOUT C,9,DOSTDEST,CHAR                                                
Methd    LKOUT C,10,DOSTMTHD,CHAR                                               
TSpot    LKOUT C,12,DOSTSPTS,LBIN,ND=Y                                          
TCost    LKOUT C,13,DOSTTOTL,SPAK,ND=Y                                          
FaxNo    LKOUT C,14,DOSTFXN,CHAR,ND=Y                                           
DstID    LKOUT C,15,DOSTDID,(R,EDTUID),LEN=L'CTIKID,ND=Y                        
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER BUYER CONFIRM COMMENTS                   *         
***********************************************************************         
                                                                                
ARYOCC   LKOUT A,(R,NXTOCC),MULTIROW=Y,ROWNAME=DAREORDD                         
                                                                                
Array    LKOUT C,X'00E4',(A,ARYOCO2)                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER BUYER CONFIRM COMMENTS                               *         
***********************************************************************         
                                                                                
NXTOCC   GOTOR GETCOM,DOKCBCCQ                                                  
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR BUYER CONFIRM COMMENTS DOWNLOAD                *         
***********************************************************************         
                                                                                
ARYOCO2  LKOUT A,(D,B#OBCREC,DORFRST),EOT=EOR,NEWEL=B,                 +        
               ROWID=(DOCM2ELD,DOCM2ELQ),ROWWIDTH=(V,DOCM2LEN)                  
                                                                                
RevNo    LKOUT C,1,DOCM2REV,LBIN                                                
LinNo    LKOUT C,2,DOCM2LIN,LBIN                                                
CText    LKOUT C,3,DOCM2TXT,CHAR,LEN=V,ND=Y                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER URL DETAILS DOWNLOAD                     *         
***********************************************************************         
                                                                                
ARYURL   LKOUT A,(R,NXTURL),MULTIROW=Y,ROWNAME=DAREORDD                         
                                                                                
Array    LKOUT C,X'00E5',(A,ARYOURL)                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER URL DETAILS                                          *         
***********************************************************************         
                                                                                
NXTURL   GOTOR GETCOM,DOKCURLQ                                                  
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER URL DETAILS DOWNLOAD                     *         
***********************************************************************         
                                                                                
ARYOURL  LKOUT A,(D,B#OBCREC,DORFRST),EOT=EOR,NEWEL=B,                 +        
               ROWID=(DOCM2ELD,DOCM2ELQ),ROWWIDTH=(V,DOCM2LEN)                  
                                                                                
RevNo    LKOUT C,1,DOCM2REV,LBIN,ROWID=(DOCM2LIN,0)                             
URLAd    LKOUT C,2,DOCM2ELD,(R,EDTURL),ROWID=(DOCM2LIN,0)                       
                                                                                
         LKOUT E                                                                
         EJECT                                                                  
***********************************************************************         
* MULTIPLE ORDER DOWNLOAD REQUEST  x'00DA'                            *         
***********************************************************************         
                                                                                
REQOMM   LKREQ H,I#SDOMMD,OUTOMM,NEXTREQ=REQSOL                                 
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'CKEYAM,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                   
CltCd    LKREQ F,2,(I,B#SAVED,CLTIND),(U,#VALCLT,$VALCLT),             +        
               OLEN=L'CKEYCLT,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*                  
PrdCd    LKREQ F,3,(I,B#SAVED,PRDIND1),(R,VALPRD),LIST=NOD,DEFAULT=Y,  +        
               OLEN=L'BUYKPRD,MAXLEN=L'PKEYPRD,TEXT=SP#PRO,COL=*                
EstNo    LKREQ F,4,(I,B#SAVED,ESTIND),LBIN,LIST=NOD,RANGE=Y,           +        
               DEFAULT=NOT,OLEN=L'EKEYEST,TEXT=SP#EST,COL=*                     
MktNo    LKREQ F,5,(I,B#SAVED,MKTIND),(R,VALMKT),OLEN=L'DOSPMKT,       +        
               LIST=NOD,DEFAULT=NOT,TEXT=SP#MKT,COL=*                           
ByrNm    LKREQ F,6,(D,B#SAVED,DLDBYRNM),HDRO,TEXT=SP#BYRNM,COL=*                
RfDem    LKREQ F,7,(D,B#SAVED,REDODEMS),HDRO,TEXT=SP#RFDEM,COL=*                
StNet    LKREQ F,8,(I,B#SAVED,STAIND),(U,#VALSTA,$VALSTA),             +        
               OLEN=L'BUYKSTAC,MAXLEN=STASTAL,TEXT=SP#STA,COL=*,       +        
               LIST=NOD,DEFAULT=Y                                               
         LKREQ E                                                                
                                                                                
OUTOMM   LKOUT H                   ** MULTIPLE ORDER D/L **                     
                                                                                
OMMTIM   LKOUT R,X'00FF'           CURRENT TIME                                 
CTime    LKOUT C,1,(D,B#WORKD,FULL),HEXD,FILTROUT=GETTIME                       
         LKOUT E                                                                
                                                                                
OMMDAP   LKOUT R,X'00DC'           OM DARE PROFILES                             
Array    LKOUT C,255,(A,ARYDAP)                                                 
         LKOUT E                                                                
                                                                                
OMMFLT   LKOUT R,X'0047'           FLIGHT RECORDS                               
Array    LKOUT C,255,(A,ARYFLT)                                                 
         LKOUT E                                                                
                                                                                
OMMORD   LKOUT R,X'00DA'           ORDER RECORDS                                
Array    LKOUT C,255,(A,ARYOMM)                                                 
         LKOUT E                                                                
                                                                                
OMMDBT   LKOUT R,X'00DB'           BATCH RECORDS                                
Array    LKOUT C,255,(A,ARYDBT)                                                 
         LKOUT E                                                                
                                                                                
OMMR4R   LKOUT R,X'00E3'           ROUTING RECORDS                              
Array    LKOUT C,255,(A,ARYR4R)                                                 
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR DARE PROFILES                                  *         
***********************************************************************         
                                                                                
ARYDAP   LKOUT A,(R,NXTDAP),NROWS=1,NEWEL=Y                                     
                                                                                
         LKOUT C,1,(D,B#SAVED,PROFDARV+00),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+01),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+02),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+03),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+04),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+05),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+06),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+07),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+08),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+09),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+10),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+11),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+12),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+13),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+14),CHAR,LEN=1                           
         LKOUT C,1,(D,B#SAVED,PROFDARV+15),CHAR,LEN=1                           
                                                                                
         LKOUT C,2,(D,B#SAVED,PROFOMV+00),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+01),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+02),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+03),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+04),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+05),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+06),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+07),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+08),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+09),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+10),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+11),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+12),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+13),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+14),CHAR,LEN=1                            
         LKOUT C,2,(D,B#SAVED,PROFOMV+15),CHAR,LEN=1                            
                                                                                
         LKOUT C,3,(D,B#SAVED,PROFDXV+00),LBIN,SENDCHAR=Y,LEN=1                 
         LKOUT C,3,(D,B#SAVED,PROFDXV+01),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+02),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+03),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+04),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+05),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+06),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+07),LBIN,SENDCHAR=Y,LEN=1                 
         LKOUT C,3,(D,B#SAVED,PROFDXV+08),LBIN,SENDCHAR=Y,LEN=1                 
         LKOUT C,3,(D,B#SAVED,PROFDXV+09),LBIN,SENDCHAR=Y,LEN=1                 
         LKOUT C,3,(D,B#SAVED,PROFDXV+10),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+11),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+12),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+13),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+14),CHAR,LEN=1                            
         LKOUT C,3,(D,B#SAVED,PROFDXV+15),CHAR,LEN=1                            
                                                                                
         LKOUT C,4,(D,B#SAVED,PROFD2V+00),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+01),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+02),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+03),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+04),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+05),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+06),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+07),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+08),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+09),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+10),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+11),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+12),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+13),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+14),CHAR,LEN=1,                  +        
               PCVERSION=3.0.0.120                                              
         LKOUT C,4,(D,B#SAVED,PROFD2V+15),LBIN,LEN=1,SENDCHAR=Y,       +        
               PCVERSION=3.0.0.120                                              
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET ORDER PROFILES                                                  *         
***********************************************************************         
                                                                                
NXTDAP   LA    R0,PROFV                                                         
         ST    R0,LP_ADATA                                                      
         XC    WORK,WORK           BUILD PROFILE KEY & GET PROFILES             
         MVC   WORK+04(L'AGENCY),AGENCY                                         
         MVC   WORK+06(L'QMEDA),QMEDA                                           
         MVC   WORK+07(L'QCLTA),QCLTA                                           
         MVI   WORK+10,C'*'                                                     
         L     RF,ACLTREC                                                       
         MVC   WORK+11(L'COFFICE),COFFICE-CLTHDR(RF)                            
         LA    R2,PROFKSDO         R2=A(PROGRAM KEY LIST)                       
         LA    R3,PROFV            R3=A(PROFILES VALUES)                        
         LHI   R0,PROFNSDO         R0=NUMBER OF PROFILES TO LOOK UP             
NXTDAP02 MVC   WORK(L'PROFKSDO),0(R2)                                           
         GOTOR VGETPROF,DMCB,WORK,(R3),VDATAMGR                                 
                                                                                
* CHECKING AGAINST ROUTING EXCEPTION TABLE KTZRDYTB                             
                                                                                
         CLC   =C'S0OM',0(R2)      ONLY MODIFY IF OM PROFILE                    
         JNE   NXTDAP14                                                         
         CLI   3(R3),C'N'          CAN EDI, SO NO EXCEPTION NEEDED              
         JE    NXTDAP14                                                         
                                                                                
         TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         JNZ   NXTDAP04             YES                                         
         L     RE,LP_ATWA          ONLINE - TEST ROUTING RESOLVED               
         OC    SVDARERC-TWAD(,RE),SVDARERC-TWAD(RE)                             
         JNZ   NXTDAP08                                                         
                                                                                
NXTDAP04 L     R6,AIO3             READ USER-ID RECORD AND SET                  
         USING CTIREC,R6           DARE ROUTING CODE IN TWA                     
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKNUM,LP_USRID                                                 
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO3'                            
         JNE   *+2                                                              
                                                                                
         LA    R6,CTIDATA          R2=A(FIRST ELEMENT ON ID RECORD)             
         USING CTUSAD,R6                                                        
         SR    R0,R0                                                            
NXTDAP06 CLI   CTUSAEL,EOR         TEST END OF RECORD                           
         JE    NXTDAP14            NO DARE ROUTING SO USE PROFILE AS IS         
         CLI   CTUSAEL,CTUSAELQ    TEST US AGENCY EXTRA INFO ELEMENT            
         JE    *+14                                                             
         IC    R0,CTUSALEN         BUMP TO NEXT ELEMENT ON RECORD               
         AR    R6,R0                                                            
         J     NXTDAP06                                                         
         L     RE,LP_ATWA                                                       
         MVC   SVDARERC-TWAD(,RE),CTUSADRC                                      
         DROP  R6                                                               
                                                                                
NXTDAP08 L     RE,LP_ATWA          EXTRACT DARE ROUTING CODE                    
         MVC   DAREROUT,SVDARERC-TWAD(RE)                                       
         LAY   RE,KTZRDYTB         CHECK AGAINST TABLE IF USER CAN EDI          
NXTDAP10 CLI   0(RE),FF                                                         
         JE    NXTDAP14            DON'T MODIFY                                 
         CLC   DAREROUT,0(RE)                                                   
         JE    NXTDAP12            THIS AGENCY/CITY CAN EDI                     
         AHI   RE,L'KTZRDYTB                                                    
         J     NXTDAP10                                                         
                                                                                
NXTDAP12 MVI   3(R3),C'N'          ALLOW EDI FOR THIS ROUTING CODE              
                                                                                
NXTDAP14 AHI   R2,L'PROFKSDO                                                    
         AHI   R3,L'PROFV                                                       
         JCT   R0,NXTDAP02                                                      
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MULTI ORDER DOWNLOAD                           *         
***********************************************************************         
                                                                                
ARYOMM   LKOUT A,(R,NXTOMM),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,X'00DB',(A,ARYORD)                                             
Array    LKOUT C,X'00E2',(A,ARYOBC)                                             
Array    LKOUT C,X'00E3',(A,ARYOSC)                                             
Array    LKOUT C,X'0082',(A,ARYMKN)                                             
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER RECORDS FOR MULTIPLE ORDER DOWNLOAD                  *         
***********************************************************************         
                                                                                
NXTOMM   CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTOMM04                                                         
         XC    BYRTAB#,BYRTAB#     CLEAR N'ENTRIES IN BUYER SENT TABLE          
                                                                                
         ICM   RF,7,APRD1                                                       
         CLI   LW_TYPE-LW_D(RF),LW_TSINQ                                        
         JNE   NXTOMM02                                                         
         CLI   LW_DATA1-LW_D(RF),POLPRDQ                                        
         JNE   NXTOMM02                                                         
         MVC   APRD1,AALL          DEFAULT PRODUCT ENTRY                        
                                                                                
NXTOMM02 MVC   APIG,AALL           DEFAULT PIGGYBACK PRODUCT ENTRY              
                                                                                
         L     RF,LP_AWMP                                                       
         USING LW_D,RF                                                          
         XC    LW_NUMN,LW_NUMN                                                  
         ST    RF,ASTALST                                                       
         DROP  RF                                                               
                                                                                
NXTOMM04 LA    R0,DCKKEYT                                                       
         CLI   STAIND,LW_TSINQ                                                  
         JE    *+8                                                              
         LA    R0,DCMKEYT                                                       
         GOTOR (#NXTREC,ANXTREC),DMCB,(R0),('B#ORDREC',0),SAVED,0,     +        
               AGETORD                                                          
         BNE   EXITY                                                            
***********************************************************************         
* CODE HAS BEEN COMMENTED OUT, UNTIL NEW SAT IS REVISITED -HWON 11/8/16         
***********************************************************************         
*&&DO                                                                           
         CLI   STAIND,LW_TSINQ                                                  
         JE    NXTOMM10                                                         
         LA    R4,IOKEY            LET'S EXTRACT THE MARKET #                   
         MVC   ORDMKT,DCMKMKT-DOKEY(R4)                                         
*&&                                                                             
NXTOMM10 GOTOR ASETORD             SET ORDER VALUES                             
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER SELLER COMMENTS                          *         
***********************************************************************         
                                                                                
ARYOSC   LKOUT A,(R,NXTOSC),ROWNAME=DAREORDD,NEWEL=Y                            
                                                                                
Array    LKOUT C,X'00E3',(A,ARYOSCM)                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER SELLER COMMENTS                                      *         
***********************************************************************         
                                                                                
NXTOSC   GOTOR GETCOM,DOKCRPCQ                                                  
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER SELLER COMMENTS                          *         
***********************************************************************         
                                                                                
ARYOSCM  LKOUT A,(D,B#OBCREC,DORFRST),EOT=0,                           +        
               ROWID=(DOCOMELD,DOCOMELQ),ROWWIDTH=(V,DOCOMLEN)                  
                                                                                
BComm    LKOUT C,0,DOCOMTXT,CHAR,LEN=V,MAPMOD1=DOCOMLIN                         
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT DOWNLOAD                              *           
***********************************************************************         
                                                                                
ARYFLT   LKOUT A,(R,NXTFLT),MULTIROW=Y,ROWNAME=DFLRECD                          
                                                                                
EstNo    LKOUT C,5,DFLKEST,LBIN                                                 
Array    LKOUT C,255,(A,ARYFINV)                                                
Array    LKOUT C,255,(A,ARYFLTV)                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET FLIGHT RECORDS FOR BUY/GOAL DOWNLOAD                            *         
***********************************************************************         
                                                                                
NXTFLT   GOTOR (#NXTREC,ANXTREC),DMCB,FLTKEYT,('B#FLTREC',0),SAVED,0,0          
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT DETAILS DOWNLOAD                        *         
***********************************************************************         
                                                                                
ARYFLTV  LKOUT A,(D,B#FLTREC,DFLEL),EOT=EOR,                           +        
               ROWID=(DFFLTEL,DFFLTELQ),ROWWIDTH=(V,DFFLTLEN)                   
                                                                                
FltNo    LKOUT C,2,DFFLTNUM,UBIN                                                
StrDt    LKOUT C,3,DFFLTSTR,BDAT                                                
EndDt    LKOUT C,4,DFFLTEND,BDAT                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT INFO DOWNLOAD                           *         
***********************************************************************         
                                                                                
ARYFINV  LKOUT A,(D,B#FLTREC,DFLEL),EOT=EOR,                           +        
               ROWID=(DFINFEL,DFINFELQ),ROWWIDTH=(V,DFINFLEN)                   
                                                                                
FNFSD    LKOUT C,1,DFINFSDT,BDAT                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR DARE BATCH RECORDS                             *         
***********************************************************************         
                                                                                
ARYDBT   LKOUT A,(R,NXTDBT),MULTIROW=Y,ROWNAME=DARBTCHD                         
                                                                                
SCall    LKOUT C,3,DBTKSTA,(R,EDTSTA)                                           
PrdCd    LKOUT C,5,DBTKPRD,(U,#EDTPRD,$EDTPRD)                                  
PigCd    LKOUT C,6,DBTKPRD2,(U,#EDTPRD,$EDTPRD),ND=Y                            
Array    LKOUT C,255,(A,ARYDBF)                                                 
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* READ DARE BATCH RECORDS                                             *         
***********************************************************************         
                                                                                
NXTDBT   CLI   LP_RMODE,LP_RFRST                                                
         JNE   NXTDBT02                                                         
         MVC   ASTA,AALL           DEFAULT STATION ENTRY                        
                                                                                
NXTDBT02 GOTOR (#NXTREC,ANXTREC),DMCB,DBTKEYT,('B#DBTREC',0),SAVED,0,  +        
               AFLTDBT                                                          
         BNE   EXITY                                                            
         L     R1,IOADDR           ADD TO STATION LIST IF NECESSARY             
         GOTOR ADDSTA,DBTKSTA-DARBTCHD(R1)                                      
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR BATCH FLIGHT DOWNLOAD                          *         
***********************************************************************         
                                                                                
ARYDBF   LKOUT A,(R,NXTDBF),NROWS=1,ROWID=(DBFLTELD,DBFLTELQ),         +        
               ROWWIDTH=(V,DBFLTLEN,1),SETFILT=(DBFLTFLT,L'DBFLTFLT)            
                                                                                
FltNo    LKOUT C,8,DBFLTFLT,UBIN                                                
SComm    LKOUT C,9,DBFLTELD,(R,EDTSTD),LEN=L'DBFLTSTD,ND=Y                      
FComm    LKOUT C,10,DBFLTELD,(R,EDTFFT),ND=Y                                    
Flag1    LKOUT C,11,DBFLTFL1,HEXD,ND=Y                                          
Array    LKOUT C,255,(A,ARYDBS)                                                 
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT SALESPERSON DOWNLOAD                    *         
***********************************************************************         
                                                                                
ARYDBS   LKOUT A,(D,B#DBTREC,DBTRFRST),EOT=EOR,                        +        
               ROWID=(DBSLPELD,DBSLPELQ),ROWWIDTH=(V,DBSLPLEN),        +        
               TESTFILT=(DBSLPFLT,L'DBSLPFLT)                                   
                                                                                
SPers    LKOUT C,12,DBSALESP,CHAR,ND=Y                                          
Flag2    LKOUT C,13,DBSALFL1,HEXD,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ROUTES FOR MULTI-ORDER DOWNLOAD                *         
***********************************************************************         
                                                                                
ARYR4R   LKOUT A,(R,NXTR4R),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,X'00E7',(A,ARYEDIM)                                            
*                                                                               
Array    LKOUT C,X'00E8',(A,ARYSFAX)                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET NEXT STATION FOR MULTI-ORDER READ FOR ROUTES DOWNLOAD           *         
***********************************************************************         
                                                                                
NXTR4R   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTR4R10                                                         
                                                                                
         ICM   RF,7,AMED           EXTRACT MEDIA CODE                           
         MVC   QMEDX,LW_DATA1-LW_D(RF)                                          
         GOTOR (#EDTMED,AEDTMED),DMCB,QMEDX,,QMEDA                              
         MVI   R4RMEDIA,0          SET FIRST TIME                               
                                                                                
         TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         JNZ   NXTR4R02                                                         
         L     RF,LP_ATWA          ONLINE - TEST ROUTING RESOLVED               
         OC    SVDARERC-TWAD(,RF),SVDARERC-TWAD(RF)                             
         JNZ   NXTR4R08                                                         
                                                                                
NXTR4R02 L     R2,AIO4             READ USER-ID RECORD AND SET                  
         USING CTIREC,R2           DARE ROUTING CODE IN TWA                     
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKNUM,LP_USRID                                                 
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO4'                            
         JNE   *+2                                                              
                                                                                
         LA    R2,CTIDATA          R2=A(FIRST ELEMENT ON ID RECORD)             
         USING CTUSAD,R2                                                        
NXTR4R04 CLI   CTUSAEL,EOR         TEST END OF RECORD                           
         BE    NOMORE                                                           
         CLI   CTUSAEL,CTUSAELQ    TEST US AGENCY EXTRA INFO ELEMENT            
         JE    NXTR4R06                                                         
         LLC   R0,CTUSALEN         BUMP TO NEXT ELEMENT ON RECORD               
         AR    R2,R0                                                            
         J     NXTR4R04                                                         
                                                                                
NXTR4R06 L     RF,LP_ATWA                                                       
         MVC   SVDARERC-TWAD(,RF),CTUSADRC                                      
         DROP  R2                                                               
                                                                                
NXTR4R08 ICM   R1,15,ASTALST       R1=A(BUILT STATION LIST)                     
         BZ    NOMORE                                                           
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         BZ    NOMORE                                                           
         AHI   R1,LW_LN2Q          POINT TO FIRST STATION IN LIST               
         ST    R1,ASTACUR                                                       
         LA    R0,OUTVALS                                                       
         LHI   R1,R4RVALX-OUTVALS                                               
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
         XC    LR4RVALS(LR4RVALL),LR4RVALS                                      
         L     R1,ASTACUR                                                       
         J     NXTR4R12                                                         
                                                                                
NXTR4R10 L     R1,ASTACUR          BUMP TO NEXT STATION IN LIST                 
         AHI   R1,L'DOKSTA                                                      
         OC    0(L'DOKSTA,R1),0(R1)                                             
         BZ    NOMORE                                                           
         ST    R1,ASTACUR          SET A(CURRENT STATION ENTRY)                 
                                                                                
NXTR4R12 XC    STAPACKD(STAPACKL),STAPACKD                                      
         MVC   STAPSTA,0(R1)       GET ALPHA STATION CALL LETTERS               
         MVI   STAPACT,C'U'                                                     
         MVC   STAPAGY,LP_AGY                                                   
         L     R1,AAGYREC                                                       
         MVC   STAPCTRY,AGYPCNDA-AGYHDR(R1)                                     
         MVC   STAPMED,QMEDA                                                    
         MVC   STAPACOM,ACOMFACS                                                
         GOTOR VSTAPACK,STAPACKD                                                
         CLI   STAPQSTA+L'STAPQSTA-1,C' '                                       
         JNE   *+10                                                             
         MVC   STAPQSTA+L'STAPQSTA-1(L'QMEDA),QMEDA                             
         MVC   STACALL1,STAPQSTA   SET 'VALIDATED' STATION                      
         MVC   STACALL2,STAPQSTA   SET 'CALLED' STATION                         
         MVC   STAPCODE,STAPSTA    SET PACKED STATION CODE                      
         LA    R0,R4RVALS                                                       
         ST    R0,LP_ADATA                                                      
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR READ FOR ROUTES DOWNLOAD (MULTI-STATION)       *         
***********************************************************************         
                                                                                
ARYEDIM  LKOUT A,(R,NXTEDI),MULTIROW=Y,ROWNAME=R4RVALS                          
                                                                                
SCall    LKOUT C,1,R4RSCALL,CHAR,ND=Y                                           
EDate    LKOUT C,2,R4REFFDT,BDAT,ND=Y                                           
DType    LKOUT C,3,R4RDESTN,CHAR,ND=Y                                           
UPrfx    LKOUT C,4,R4RUSRID,CHAR,ND=Y                                           
UOffc    LKOUT C,5,R4ROFFIC,CHAR,ND=Y                                           
NCall    LKOUT C,10,R4RNCALL,CHAR,ND=Y                                          
NEfDt    LKOUT C,11,R4RNEFFD,JLNG,ND=Y                                          
NoEDI    LKOUT C,50,R4RDNEDI,HDRO,ND=Y                                          
DRout    LKOUT C,99,R4RDFLTR,HDRO,ND=Y                                          
*                                              2nd rep                          
Array    LKOUT C,X'00E8',(A,ARYRFAX),FILTROUT=TSTCANFX                          
*                                              2nd rep                          
Array    LKOUT C,X'00EA',(A,ARY2NDR),FILTROUT=TST2NDR                           
*                                                                               
         LKOUT E                                                                
         EJECT                                                                  
***********************************************************************         
* SUBSCRIBED ORDER DOWNLOAD REQUEST  X'00DE'                          *         
***********************************************************************         
                                                                                
REQSOL   LKREQ H,I#SDSOLD,OUTSOL,NEXTREQ=REQC4C                                 
Media    LKREQ F,1,(I,B#SAVED,SOLIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'SOLFMED,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*,ARRAY=S          
Buyer    LKREQ F,2,,(R,VALBYR),OLEN=L'SOLFBYR,TEXT=SP#BUYER,COL=*               
CltCd    LKREQ F,3,,(R,VALSCM),VPARM=SOLFCLTQ,OLEN=SOLFCLTL,           +        
               TEXT=SP#CLI,COL=*                                                
MktNo    LKREQ F,4,,(R,VALSCM),VPARM=SOLFMKTQ,OLEN=SOLFMKTL,           +        
               TEXT=SP#MKT,COL=*,ARRAY=E                                        
         LKREQ E                                                                
                                                                                
OUTSOL   LKOUT H                   ** SUBSCRIBE ORDER DOWNLOAD **               
                                                                                
SOLTIM   LKOUT R,X'00FF'           CURRENT TIME                                 
CTime    LKOUT C,1,(D,B#WORKD,FULL),HEXD,FILTROUT=GETTIME                       
         LKOUT E                                                                
                                                                                
SOLORD   LKOUT R,X'00DD'           ORDER RECORDS                                
Array    LKOUT C,255,(A,ARYSOL)                                                 
         LKOUT E                                                                
                                                                                
SOLBTC   LKOUT R,X'00DE'           BATCH RECORDS                                
Array    LKOUT C,255,(A,ARYSOB)                                                 
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SUBSCRIBED ORDER DOWNLOAD                      *         
***********************************************************************         
                                                                                
ARYSOL   LKOUT A,(R,NXTSOL),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,255,(A,ARYSOL03)                                               
Array    LKOUT C,255,(A,ARYSOL01)                                               
Array    LKOUT C,255,(A,ARYSOO)                                                 
Array    LKOUT C,255,(A,ARYOGP),FILTROUT=TSTXTRA,PCVERSION=4.7.0.132            
Array    LKOUT C,255,(A,ARYSOEM),PCVERSION=4.7.0.132                            
FltNo    LKOUT C,34,(D,B#SAVED,ORDFLT),CHAR,ND=Y                                
E.O.R    LKOUT C,64,(D,B#WORKD,EFFS),HDRO                                       
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER RECORDS FOR SUBSCRIBED ORDER DOWNLOAD                *         
***********************************************************************         
                                                                                
NXTSOL   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTSOLNX                                                         
*                                                                               
         GOTOR VDATCON,DMCB,(5,0),(0,WORK)                                      
         GOTOR VADDAY,DMCB,WORK,WORK+6,-90                                      
         GOTOR VDATCON,DMCB,(0,WORK+6),(2,TDYLS90D)                             
         XC    TDYLS90D,=X'FFFF'                                                
*                                                                               
         ICM   R2,7,ASOL                                                        
         BZ    NOMORE                                                           
         SR    R3,R3                                                            
         ICM   R3,3,LW_NUMN-LW_D(R2)                                            
         AHI   R2,LW_LN2Q                                                       
         USING SOLFD,R2            R2=A(SUBSCRIPTION FILTERS)                   
                                                                                
         XC    LORDVALS(LORDVALL),LORDVALS                                      
         MVI   DLDBYRNM,YESQ       SET BUYER NAME REQUIRED                      
         XC    BYRTAB#,BYRTAB#     AND CLEAR ENTRY COUNT                        
                                                                                
         L     RE,LP_AWMP                                                       
         STCM  RE,7,AMED           BUILD VIRGIN MEDIA/BUYER ENTRY               
         MVI   LW_TYPE-LW_D(RE),LW_TLSTQ                                        
         XC    LW_NUMN-LW_D(,RE),LW_NUMN-LW_D(RE)                               
                                                                                
NXTSOL10 ICM   RE,7,AMED           UPDATE MEDIA/BUYER LIST IF REQUIRED          
         SR    RF,RF                                                            
         ICM   RF,3,LW_NUMN-LW_D(RE)                                            
         JZ    NXTSOL20                                                         
         LA    R1,LW_DATA2-LW_D(RE)                                             
         CLC   SOLFMED(L'SOLFMED+L'SOLFBYR),0(R1)                               
         JE    NXTSOL30                                                         
         AHI   R1,L'SOLFMED+L'SOLFBYR                                           
         JCT   RF,*-14                                                          
                                                                                
NXTSOL20 ICM   RF,3,LW_NUMN-LW_D(RE)                                            
         LR    R1,RF                                                            
         MHI   R1,L'SOLFMED+L'SOLFBYR                                           
         LA    R1,LW_LN2Q(R1,RE)                                                
         MVC   0(L'SOLFMED+L'SOLFBYR,R1),SOLFMED                                
         AHI   R1,L'SOLFMED+L'SOLFBYR                                           
         ST    R1,LP_AWMP                                                       
         AHI   RF,1                                                             
         STCM  RF,3,LW_NUMN-LW_D(RE)                                            
                                                                                
NXTSOL30 AHI   R2,SOLFL            BUMP INPUT ARRAY POINTER                     
         JCT   R3,NXTSOL10         DO FOR NUMBER OF ENTRIES                     
                                                                                
         MVC   ACLT,AALL           DEFAULT CLIENT ENTRY                         
         MVC   AMKT,AALL           DEFAULT MARKET ENTRY                         
*                                                                               
         GOTOR BUFFER,DMCB,('TSAINI',0),('SODOKEYL',SODORECL)                   
         JNE   *+2                                                              
*                                                                               
NXTSOLNX GOTOR (#NXTREC,ANXTREC),DMCB,DBCKEYT,('B#ORDREC',0),SAVED,    +        
               AFLTSOL,AGETORD                                                  
         BNE   EXITY                                                            
*                                                                               
         LA    RF,TDYLS90D                                                      
         CLC   =C'TM',AGENCY       ARE WE TMNY?                                 
         JNE   NXTSOL50                                                         
         CLC   =X'8E47',IOKEY+DBCKCLT-DBCKTYPE   CLIENT DSH?                    
         JNE   NXTSOL40                          NO LIMITS, OTHERWISE           
         MVC   WORK,=X'FAF5F0F8F1F5'  WANT AUG15/05 & 90 DAYS PRIOR             
         J     NXTSOL45                                                         
*                                                                               
NXTSOL40 CLC   =X'C9EE',IOKEY+DBCKCLT-DBCKTYPE   CLIENT SPO?                    
         JNE   NXTSOL80                          NO LIMITS, OTHERWISE           
         MVC   WORK,=X'FAF5F0F6F1F5'  WANT JUN15/05 & 90 DAYS PRIOR             
NXTSOL45 GOTOR VADDAY,DMCB,WORK,WORK+6,-90                                      
         GOTOR VDATCON,DMCB,(0,WORK+6),(2,TDYLS90S)                             
         XC    TDYLS90S,=X'FFFF'                                                
         LA    RF,TDYLS90S                                                      
*                                                                               
NXTSOL50 L     R6,IOADDR                                                        
         USING DAREORDD,R6         R2=A(DARE ORDER RECORD)                      
         LA    R6,DORFRST                                                       
NXTSOL55 CLI   0(R6),0             NO COLOR ELEM?                               
         JE    NXTSOLNX            SO OLD, WE DON'T CARE, NEXT RECORD           
         CLI   0(R6),COLELQ        X'13' - COLOR ELEMENT                        
         JE    NXTSOL60                                                         
         LLC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         J     NXTSOL55                                                         
*                                                                               
         USING COLOREL,R6                                                       
NXTSOL60 CLC   COLDATE,0(RF)       COMPL DATES, HIGH VALUE, MEANS OLDER         
         JH    NXTSOLNX            SO IF OLDER, NEXT RECORD                     
*                                                                               
NXTSOL80 GOTOR ASETORD             SET ORDER VALUES                             
         B     EXITY                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* CHECK FOR CHANGES DOWNLOAD REQUEST  X'00DD'                         *         
***********************************************************************         
                                                                                
REQC4C   LKREQ H,I#SDCFOC,OUTC4C,NEXTREQ=REQSOD                                 
DTime    LKREQ F,1,(D,B#SAVED,C4TIME),HEXD,TEXT=SP#TIME,COL=*                   
Media    LKREQ F,2,(I,B#SAVED,C4CIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'C4CQMED,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*,ARRAY=S          
Buyer    LKREQ F,3,,CHAR,OLEN=L'C4CQBYR,TEXT=SP#BUYER,COL=*                     
CltCd    LKREQ F,4,,(R,VALSCM),VPARM=C4CQCLTQ,OLEN=C4CQCLTL,           +        
               TEXT=SP#CLI,COL=*                                                
MktNo    LKREQ F,5,,(R,VALSCM),VPARM=C4CQMKTQ,OLEN=C4CQMKTL,           +        
               TEXT=SP#MKT,COL=*                                                
EstNo    LKREQ F,6,,LBIN,OLEN=L'C4CQESTN,TEXT=SP#EST,COL=*                      
PrdCd    LKREQ F,7,,(U,#VALPRD,$VALPRD),OLEN=L'C4CQPRDN,               +        
               MAXLEN=L'PKEYPRD,TEXT=SP#PRO,COL=*                               
Token    LKREQ F,8,,CHAR,OLEN=L'C4CQTOKN,TEXT=SP#KEY,COL=*,ARRAY=E              
         LKREQ E                                                                
                                                                                
OUTC4C   LKOUT H                   ** CHECK FOR CHANGES DOWNLOAD **             
                                                                                
C4CTIM   LKOUT R,X'00FF'           CURRENT TIME                                 
CTime    LKOUT C,1,(D,B#WORKD,FULL),HEXD,FILTROUT=GETTIME                       
         LKOUT E                                                                
                                                                                
C4CORD   LKOUT R,X'00DD'                                                        
Array    LKOUT C,255,(A,ARYC4C)                                                 
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR CHECK FOR CHANGES DOWNLOAD                     *         
***********************************************************************         
                                                                                
ARYC4C   LKOUT A,(R,NXTC4C),MULTIROW=Y                                          
                                                                                
Media    LKOUT C,1,(D,B#SAVED,ORDAM),(U,#EDTMED,$EDTMED)                        
OrdNo    LKOUT C,2,(D,B#SAVED,ORDORDER),(U,#EDTORD,$EDTORD)                     
Group    LKOUT C,3,(D,B#SAVED,ORDGROUP),CHAR,ND=Y                               
ATime    LKOUT C,4,(D,B#SAVED,ORDATIME),HEXD                                    
PCKey    LKOUT C,5,(D,B#SAVED,ORDTOKN1),CHAR,ND=Y                               
PCKey    LKOUT C,5,(D,B#SAVED,ORDTOKN2),CHAR,ND=Y                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* READ ORDER ACTIVITY POINTERS FOR CHECK FOR CHANGE DOWNLOAD          *         
***********************************************************************         
                                                                                
NXTC4C   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTC4C08                                                         
                                                                                
         ICM   R2,7,AC4C                                                        
         BZ    NOMORE                                                           
         GOTOR BUFFER,DMCB,('TSAINI',0),('C4CRKEYL',C4CRRECL)                   
         GOTOR VDATCON,DMCB,(5,0),(2,TODAYCMP)                                  
         SR    R3,R3                                                            
         ICM   R3,3,LW_NUMN-LW_D(R2)                                            
         AHI   R2,LW_LN2Q                                                       
         USING C4CQD,R2            R2=A(REQUEST ARRAY)                          
                                                                                
         L     RE,LP_AWMP                                                       
         STCM  RE,7,ATIM           BUILD TIME RANGE ENTRY                       
         MVI   LW_TYPE-LW_D(RE),LW_TRNGQ                                        
         XC    LW_DATA1-LW_D(L'C4TIME,RE),LW_DATA1-LW_D(RE)                     
         XC    C4TIME,EFFS                                                      
         MVC   LW_DATA1+L'C4TIME-LW_D(L'C4TIME,RE),C4TIME                       
         AHI   RE,LW_LN1Q+(L'C4TIME*2)                                          
                                                                                
         STCM  RE,7,AMED           BUILD VIRGIN MEDIA ENTRY                     
         MVI   LW_TYPE-LW_D(RE),LW_TLSTQ                                        
         XC    LW_NUMN-LW_D(,RE),LW_NUMN-LW_D(RE)                               
                                                                                
NXTC4C02 ICM   RE,7,AMED           UPDATE MEDIA LIST IF NECESSARY               
         SR    RF,RF                                                            
         ICM   RF,3,LW_NUMN-LW_D(RE)                                            
         JZ    NXTC4C04                                                         
         LA    R1,LW_DATA2-LW_D(RE)                                             
         CLC   C4CQMED,0(R1)                                                    
         JE    NXTC4C06                                                         
         AHI   R1,L'C4CQMED                                                     
         JCT   RF,*-14                                                          
                                                                                
NXTC4C04 ICM   RF,3,LW_NUMN-LW_D(RE)                                            
         LR    R1,RF                                                            
         MHI   R1,L'C4CQMED                                                     
         LA    R1,LW_LN2Q(R1,RE)                                                
         MVC   0(L'C4CQMED,R1),C4CQMED                                          
         AHI   R1,L'C4CQMED                                                     
         ST    R1,LP_AWMP                                                       
         AHI   RF,1                                                             
         STCM  RF,3,LW_NUMN-LW_D(RE)                                            
                                                                                
NXTC4C06 AHI   R2,C4CQL            BUMP INPUT ARRAY POINTER                     
         JCT   R3,NXTC4C02         DO FOR NUMBER OF ENTRIES                     
         DROP  R2                                                               
                                                                                
NXTC4C08 GOTOR (#NXTREC,ANXTREC),DMCB,DODKEYT,('B#ORDREC',0),          +        
               ('$NXTRXSP+$NXTRXGR',SAVED),AFLTC4C,0                            
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* SEARCH ORDER DOWNLOAD REQUEST  X'00DF'                                        
***********************************************************************         
                                                                                
REQSOD   LKREQ H,I#SDSODD,OUTSOD,NEXTREQ=REQOAR                                 
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'QMEDX,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                    
CltCd    LKREQ F,2,(I,B#SAVED,CLTIND),(U,#VALCLT,$VALCLT),DEFAULT=Y,   +        
               OLEN=L'DCKCLT,MAXLEN=L'QCLTA,TEXT=SP#CLI,COL=*                   
MktNo    LKREQ F,3,(I,B#SAVED,MKTIND),LBIN,DEFAULT=Y,                  +        
               OLEN=L'DODKMKT,TEXT=SP#MKT,COL=*                                 
SCall    LKREQ F,4,(I,B#SAVED,STAIND),(U,#VALSTA,$VALSTA),             +        
               DEFAULT=Y,OLEN=L'DOKSTA,MAXLEN=STASTAL,TEXT=SP#STA,COL=*         
Buyer    LKREQ F,5,(I,B#SAVED,BYRIND),(R,VALBYR),DEFAULT=Y,            +        
               OLEN=L'SOLFBYR,TEXT=SP#BUYER,COL=*                               
OStat    LKREQ F,6,(I,B#SAVED,OSTIND),(R,VALSTA),MAXLEN=L'DOSTSTAT*2,  +        
               LOWERCASE=Y,OLEN=L'DOSTSTAT*2,TEXT=SP#STATS,COL=*,      +        
               ARRAY=S                                                          
OQual    LKREQ F,7,,(R,VALQUA),MAXLEN=1,OLEN=L'DOSTTYPE,TEXT=SP#SQUAL, +        
               COL=*,ARRAY=E                                                    
OrdNo    LKREQ F,8,(I,B#SAVED,ORDIND),(U,#VALORD,$VALORD),DEFAULT=Y,   +        
               OLEN=L'DOKORDER,TEXT=SP#ORDN,COL=*                               
SDate    LKREQ F,9,(D,B#SAVED,STRDATEC),CDAT,TEXT=SP#STDT,COL=*                 
EDate    LKREQ F,10,(D,B#SAVED,ENDDATEC),CDAT,TEXT=SP#ENDT,COL=*                
NtwkCd   LKREQ F,11,(D,B#SAVED,REQNTWK),CHAR,TEXT=SP#NTWRK,COL=*                
         LKREQ E                                                                
                                                                                
OUTSOD   LKOUT H                   ** SEARCH ORDER D/L **                       
                                                                                
SODORD   LKOUT R,X'00DD'           ORDER RECORDS                                
ChkFltr  LKOUT P,,CHKFLT                                                        
Array    LKOUT C,255,(A,ARYSOD)                                                 
         LKOUT E                                                                
                                                                                
SODBTC   LKOUT R,X'00DE'           BATCH RECORDS                                
Array    LKOUT C,255,(A,ARYSOB),FILTROUT=TSTBATCH                               
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
TSTBATCH CLI   DLDBATCH,0          TEST DOWNLOADING BATCHES                     
         B     SETCCC                                                           
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SEARCH/SUBSCRIPTION BATCH DOWNLOAD             *         
***********************************************************************         
                                                                                
ARYSOB   LKOUT A,(R,NXTSOB),MULTIROW=Y,ROWNAME=DARBTCHD                         
                                                                                
Media    LKOUT C,1,DBTKAGMD,(R,EDTMED)                                          
MktNo    LKOUT C,2,DBTKMKT,LBIN                                                 
MktNm    LKOUT C,3,DBTKMKT,(R,EDTMKN),LEN=L'MKTNAME,ND=Y                        
SCall    LKOUT C,4,DBTKSTA,(R,EDTSTA)                                           
CltCd    LKOUT C,5,DBTKCLT,(R,EDTCLT),LEN=3,ND=Y                                
CltNm    LKOUT C,6,DBTKCLT,(R,EDTCLN),LEN=L'CNAME,ND=Y                          
CltTP    LKOUT C,35,DBTKCLT,HDRO,ND=Y,FILTROUT=TPOLCLTB                         
PrdCd    LKOUT C,7,DBTKPRD,(R,EDTPRD)                                           
PrdNm    LKOUT C,8,DBTKPRD,(R,EDTPRN),LEN=L'PNAME,ND=Y                          
PigCd    LKOUT C,9,DBTKPRD2,(R,EDTPRD),ND=Y                                     
PigNm    LKOUT C,10,DBTKPRD2,(R,EDTPRN),LEN=L'PNAME,ND=Y                        
EstNo    LKOUT C,11,DBTKEST,LBIN                                                
Array    LKOUT C,255,(A,ARYBTE)                                                 
Array    LKOUT C,255,(A,ARYSOB01)                                               
Array    LKOUT C,255,(A,ARYSOB20)                                               
E.O.R    LKOUT C,64,(D,B#WORKD,EFFS),HDRO                                       
                                                                                
         LKOUT E                                                                
                                                                                
TPOLCLTB L     R1,ACLTREC          SET CC EQUAL IF TPOL CLIENT                  
         CLI   CPROF-CKEY(R1),C'0'                                              
         BNE   EXITN                                                            
         B     EXITY                                                            
                                                                                
***********************************************************************         
* READ DARE BATCH RECORDS FOR OM SEARCH/SUBSCRIPTION ORDER DOWNLOAD   *         
***********************************************************************         
                                                                                
NXTSOB   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTSOB80                                                         
         GOTOR VDATCON,DMCB,(5,0),(0,WORK)                                      
         GOTOR VADDAY,DMCB,WORK,WORK+6,-90                                      
         GOTOR VDATCON,DMCB,(0,WORK+6),(2,TDYLS90D)                             
         XC    TDYLS90D,=X'FFFF'                                                
*                                                                               
         CLC   LP_QMAPN,SDSOLD#    TEST SUBSCRIPTION DOWNLOAD                   
         JNE   NXTSOB05                                                         
         ICM   R2,7,ASOL                                                        
         BZ    NOMORE                                                           
                                                                                
NXTSOB05 SR    RF,RF                                                            
         ICM   RF,7,AOST           TEST STATUS FILTERS PRESENT                  
         JZ    NXTSOB10                                                         
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(RF)                                            
         AHI   RF,LW_LN2Q                                                       
         BASR  RE,0                                                             
         CLI   0(RF),QUNSENT       TEST UNSENT ORDERS WANTED                    
         JE    NXTSOB10                                                         
         AHI   RF,L'ORDISTAT+L'ORDTTYPE                                         
         BCTR  R0,RE                                                            
         B     NOMORE                                                           
                                                                                
NXTSOB10 CLC   LP_QMAPN,SDSODD#    TEST SEARCH DOWNLOAD                         
         JNE   NXTSOB60                                                         
         CLI   DLDBMKTO,C'Y'       DOWNLOAD BATCH BY MARKETS-ORDER D/L          
         JNE   NXTSOB60                                                         
                                                                                
         L     R2,LP_AWMP                                                       
         USING LW_D,R2                                                          
         STCM  R2,7,AMKT           CONVERT TO LIST OF MARKETS                   
         MVI   MKTIND,LW_TLSTQ                                                  
         MVI   LW_TYPE,LW_TLSTQ                                                 
                                                                                
         XC    TSARREC,TSARREC                                                  
         MVI   SODOTYPE,SODOTMKT                                                
         MVC   SODOMED,QMEDA                                                    
         MVC   TSARSAV,SODOD                                                    
         LA    R3,LW_DATA2                                                      
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         J     NXTSOB40                                                         
                                                                                
NXTSOB30 GOTOR BUFFER,DMCB,('TSANXT',0)                                         
         JNE   NXTSOB50                                                         
NXTSOB40 CLI   SODOTYPE,SODOTMKT                                                
         JNE   NXTSOB50                                                         
                                                                                
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN                                                     
         AHI   R0,1                ADD 1                                        
         STCM  R0,3,LW_NUMN                                                     
         CHI   R0,61               (256-10)/4 = MAX ENTRIES IN ELEM2            
         JH    *+2                                                              
                                                                                
         MVC   0(L'SODOMKT,R3),SODOMKT                                          
         LA    R3,L'SODOMKT(R3)                                                 
         J     NXTSOB30                                                         
                                                                                
NXTSOB50 ST    R3,LP_AWMP                                                       
         SR    R3,R2                                                            
         STCM  R3,3,LW_LN                                                       
         DROP  R2                                                               
                                                                                
NXTSOB60 CLC   LP_QMAPN,SDSOLD#    TEST SUBSCRIPTION DOWNLOAD                   
         JNE   NXTSOB80                                                         
                                                                                
         CLC   =C'TM',AGENCY                                                    
         JNE   NXTSOB63                                                         
         XC    BTCHDRST,BTCHDRST   TMNY,CLIENT DSH & SPO ARE SPECIFIC           
         MVC   BTCHDRND,=X'FFFF'     TO AUG15/05 AND JUN15/05 RSPCTVLY          
         J     NXTSOB66              AND 90 DAYS PRIOR                          
                                                                                
NXTSOB63 GOTO1 VDATCON,DMCB,(5,0),(0,WORK)                                      
         GOTO1 VADDAY,DMCB,WORK,WORK+10,-90,0                                   
         GOTO1 VDATCON,DMCB,(0,WORK),(2,BTCHDRST)                               
         XC    BTCHDRST,=X'FFFF'   COMPLEMENT                                   
         GOTO1 VDATCON,DMCB,(0,WORK+10),(2,BTCHDRND)                            
         XC    BTCHDRND,=X'FFFF'   COMPLEMENT                                   
                                                                                
NXTSOB66 L     RE,LP_AWMP          BUILD A LIST OF AGENCY/MEDIAS                
         USING LW_D,RE                                                          
         STCM  RE,7,AMED           SET A(MEDIA ENTRY)                           
         MVI   LW_TYPE,LW_TLSTQ                                                 
         SR    R0,R0                                                            
         LA    RF,LW_DATA2                                                      
         ICM   R2,7,ASOL                                                        
         ICM   R3,3,LW_NUMN-LW_D(R2)                                            
         AHI   R2,LW_LN2Q                                                       
         USING SOLFD,R2                                                         
NXTSOB70 LTR   R0,R0               TEST FIRST TIME                              
         JZ    NXTSOB73                                                         
         CLC   SOLFMED,0(RF)       TEST SAME AS PREVIOUS                        
         JE    NXTSOB76                                                         
         AHI   RF,L'SOLFMED        BUMP POINTER IF DIFFERENT                    
NXTSOB73 MVC   0(L'SOLFMED,RF),SOLFMED                                          
         AHI   R0,1                                                             
NXTSOB76 AHI   R2,SOLFL                                                         
         JCT   R3,NXTSOB70                                                      
         STCM  R0,3,LW_NUMN                                                     
         LA    RE,L'SOLFMED(RF)                                                 
         DROP  R2                                                               
                                                                                
         MVC   AMKT,AALL           DEFAULT MARKET ENTRY                         
         MVC   ASTA,AALL           DEFAULT STATION ENTRY                        
         MVC   APRD1,AALL          DEFAULT PRODUCT ENTRY                        
         MVC   APIG,AALL           DEFAULT PIGGY ENTRY                          
         MVC   AEST,AALL           DEFAULT ESTIMATE ENTRY                       
         MVI   ESTIND,LW_TALLQ                                                  
                                                                                
NXTSOB80 CLC   LP_QMAPN,SDSOLD#    TEST SUBSCRIPTION DOWNLOAD                   
         JE    NXTSOB86                                                         
         OC    STRDATEC,STRDATEC   TEST ESTIMATE START DATE GIVEN               
         JZ    NXTSOB83                                                         
         OC    AEST,AEST           YES, DID WE FIND ANY ESTIMATES?              
         JZ    NOMORE              NONE, NO POINT LOOKING AT KEYS               
                                                                                
NXTSOB83 GOTOR (#NXTREC,ANXTREC),DMCB,DBTKEYT,('B#DBTREC',0),SAVED,    +        
               AFLTDBSK,AFLTDBT                                                 
         J     EXITY                                                            
                                                                                
NXTSOB86 GOTOR (#NXTREC,ANXTREC),DMCB,DDTKEYT,('B#DBTREC',0),SAVED,    +        
               AFLTDBK,AFLTDBT                                                  
*                                                                               
*************                                                                   
* BEYOND THIS POINT, SPECIAL TMNY CODE ONLY                                     
*************                                                                   
         CLC   =C'TM',AGENCY       TMNY,CLIENT DSH IS SPECIFIC                  
         JNE   EXITY                 TO AUG15/05 AND 90 DAYS PRIOR              
         CLC   =X'8E47',IOKEY+DDTKCLT-DDTKTYP   CLIENT DSH?                     
         JNE   NXTSOB88                                                         
         MVC   WORK,=X'FAF5F0F8F1F5'                                            
         J     NXTSOB90                                                         
*                                                                               
NXTSOB88 CLC   =X'C9EE',IOKEY+DDTKCLT-DDTKTYP   CLIENT SPO?                     
         JNE   EXITY                                                            
         MVC   WORK,=X'FAF5F0F6F1F5'    JUN15/05 AND 90 DAYS PRIOR              
*                                                                               
NXTSOB90 GOTO1 VDATCON,DMCB,(0,WORK),(2,HALF)                                   
         XC    HALF,=X'FFFF'       COMPLEMENT                                   
         CLC   IOKEY+DDTKDATE-DDTKTYP,HALF                                      
         JL    NXTSOB86                                                         
*                                                                               
NXTSOB99 GOTO1 VADDAY,DMCB,WORK,WORK+10,-90,0                                   
         GOTO1 VDATCON,DMCB,(0,WORK+10),(2,HALF)                                
         XC    HALF,=X'FFFF'       COMPLEMENT                                   
         CLC   IOKEY+DDTKDATE-DDTKTYP,HALF                                      
         JH    NXTSOB86                                                         
         J     EXITY                                                            
         DROP  RE                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR BATCH FLIGHT DETAILS                           *         
***********************************************************************         
                                                                                
ARYSOB20 LKOUT A,(R,NXTDBF),NROWS=1,ROWID=(DBFLTELD,DBFLTELQ),         +        
               ROWWIDTH=(V,DBFLTLEN,1),SETFILT=(DBFLTFLT,L'DBFLTFLT)            
                                                                                
FltNo    LKOUT C,22,DBFLTFLT,UBIN                                               
SComm    LKOUT C,23,DBFLTELD,(R,EDTSTD),ND=Y                                    
FComm    LKOUT C,24,DBFLTELD,(R,EDTFFT),ND=Y                                    
Flag1    LKOUT C,25,DBFLTFL1,HEXD,ND=Y                                          
Array    LKOUT C,255,(A,ARYBTC25)                                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* LOCATE NEXT FLIGHT ELEMENT ON BATCH RECORD                          *         
***********************************************************************         
                                                                                
NXTDBF   SR    R1,R1                                                            
         ICM   R1,7,ADBFEL                                                      
         JNZ   NXTDBF02                                                         
         L     R1,AIO5                                                          
         AHI   R1,DBTRFRST-DARBTCHD                                             
         USING DBFLTELD,R1         R1=A(BATCH RECORD)                           
         J     NXTDBF04                                                         
                                                                                
NXTDBF02 LLC   R0,DBFLTLEN         BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
                                                                                
NXTDBF04 CLI   DBFLTEL,EOR         TEST END OF RECORD                           
         BE    NOMORE                                                           
         CLI   DBFLTEL,DBFLTELQ    TEST FLIGHT ELEMENT                          
         JNE   NXTDBF02                                                         
         TM    DBFLTFL1,DBFLTDAR+DBFLTSNT                                       
         JNZ   NXTDBF02                                                         
         STCM  R1,7,ADBFEL                                                      
         ST    R1,LP_ADATA                                                      
         B     MORE                                                             
         DROP  R1                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT SALESPERSON DOWNLOAD                    *         
***********************************************************************         
                                                                                
ARYBTC25 LKOUT A,(D,B#DBTREC,DBTRFRST),EOT=EOR,                        +        
               ROWID=(DBSLPELD,DBSLPELQ),ROWWIDTH=(V,DBSLPLEN),        +        
               TESTFILT=(DBSLPFLT,L'DBSLPFLT)                                   
                                                                                
SPers    LKOUT C,26,DBSALESP,CHAR,ND=Y                                          
Flag2    LKOUT C,27,DBSALFL1,HEXD,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ESTIMATE VALUES DOWNLOAD                       *         
***********************************************************************         
                                                                                
ARYBTE   LKOUT A,(R,GETSOE),NROWS=1,ROWNAME=ESTHDR                              
                                                                                
SDate    LKOUT C,12,(D,B#WORKD,WORK),EDAT                                       
Edate    LKOUT C,13,(D,B#WORKD,WORK+L'ESTART),EDAT                              
Array    LKOUT C,255,(A,ARYBTF)                                                 
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR BATCH INFO ELEMENT DOWNLOAD                    *         
***********************************************************************         
                                                                                
ARYSOB01 LKOUT A,(D,B#DBTREC,DBTRFRST),EOT=EOR,                        +        
               ROWID=(DBINFELD,DBINFELQ),ROWWIDTH=(V,DBINFLEN)                  
                                                                                
Buyer    LKOUT C,18,DBINFBYR,CHAR,ND=Y                                          
ByrNm    LKOUT C,19,DBINFBYR,(R,EDTBYR),LEN=L'BYRFNAME,ND=Y                     
CDate    LKOUT C,20,DBINFDTC,JDAT,ND=Y                                          
TDate    LKOUT C,21,DBINFDTT,JDAT,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR BATCH FLIGHT DOWNLOAD                          *         
***********************************************************************         
                                                                                
ARYBTF   LKOUT A,(R,GETSOF),NROWS=1,ROWNAME=DFLRECD                             
                                                                                
Array    LKOUT C,255,(A,ARYBTF01)                                               
Array    LKOUT C,255,(A,ARYBTF05)                                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT INFO DOWNLOAD                           *         
***********************************************************************         
                                                                                
ARYBTF01 LKOUT A,(D,B#FLTREC,DFLEL),EOT=EOR,                           +        
               ROWID=(DFINFEL,DFINFELQ),ROWWIDTH=(V,DFINFLEN)                   
                                                                                
FNFSD    LKOUT C,14,DFINFSDT,BDAT                                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT DETAILS DOWNLOAD                        *         
***********************************************************************         
                                                                                
ARYBTF05 LKOUT A,(D,B#FLTREC,DFLEL),EOT=EOR,                           +        
               ROWID=(DFFLTEL,DFFLTELQ),ROWWIDTH=(V,DFFLTLEN)                   
                                                                                
FltNo    LKOUT C,15,DFFLTNUM,UBIN                                               
StrDt    LKOUT C,16,DFFLTSTR,BDAT                                               
EndDt    LKOUT C,17,DFFLTEND,BDAT                                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SEARCH ORDER DOWNLOAD                          *         
***********************************************************************         
                                                                                
ARYSOD   LKOUT A,(R,NXTSOD),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,255,(A,ARYSOL03)                                               
Array    LKOUT C,255,(A,ARYSOL01)                                               
Array    LKOUT C,255,(A,ARYSOO)                                                 
FltNo    LKOUT C,34,(D,B#SAVED,ORDFLT),CHAR,ND=Y                                
E.O.R    LKOUT C,64,(D,B#WORKD,EFFS),HDRO                                       
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER RECORDS FOR SEARCH ORDER DOWNLOAD                    *         
***********************************************************************         
                                                                                
NXTSOD   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTSOD12                                                         
*                                                                               
         CLI   CLTIND,LW_TALLQ     TEST ALL CLIENTS                             
         JNE   NXTSOD01                                                         
         CLI   MKTIND,LW_TALLQ     TEST ALL MARKETS                             
         JNE   NXTSOD01                                                         
         CLI   STAIND,LW_TALLQ     TEST ALL STATIONS                            
         JNE   NXTSOD01                                                         
         CLI   BYRIND,LW_TALLQ     TEST ALL BUYERS                              
         JNE   NXTSOD01                                                         
         CLI   ORDIND,LW_TALLQ     TEST ALL ORDERS                              
         JNE   NXTSOD01                                                         
         MVC   SVERROR,=AL2(1325)  TOO MANY RECORDS TO GO THROUGH,              
         B     EXITN                   PLEASE FILTER DOWN                       
*                                                                               
NXTSOD01 GOTOR BUFFER,DMCB,('TSAINI',0),('SODOKEYL',SODORECL)                   
         JNE   *+2                                                              
                                                                                
         XC    LORDVALS(LORDVALL),LORDVALS                                      
         MVI   DLDBYRNM,YESQ       SET BUYER NAME REQUIRED                      
         XC    BYRTAB#,BYRTAB#     AND CLEAR ENTRY COUNT                        
         ICM   RF,7,AMED                                                        
         MVC   QMEDX,LW_DATA1-LW_D(RF)                                          
         GOTOR (#EDTMED,AEDTMED),DMCB,QMEDX,,QMEDA                              
         JNE   *+2                                                              
         MVC   BUYMED,QMEDA        SET BUYMED FOR GETSTA ROUTINE                
         MVC   LORDVAGM,QMEDX      SET THIS FOR GETORD ROUTINE                  
                                                                                
         MVI   DLDBATCH,1          SET TO DOWNLOAD BATCH RECORDS                
         CLI   ORDIND,LW_TALLQ     TEST ORDER NUMBER PROVIDED                   
         JE    NXTSOD02                                                         
                                                                                
         MVI   DLDBATCH,0          YES - DON'T DOWNLOAD BATCH RECORDS           
         LA    R2,IOKEY                                                         
         USING DAREORDD,R2         READ FOR ORDER RECORD                        
         XC    DOKEY,DOKEY                                                      
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,QMEDX                                                    
         ICM   RF,7,AORD                                                        
         MVC   DOKORDER,LW_DATA1-LW_D(RF)                                       
         GOTOR (#IOEXEC,AIOEXEC),'IOBHI+IODIR+B#ORDREC'                         
         CLC   DOKEY(DOKSTA-DOKEY),IOKEYSAV                                     
         BNE   NOMORE                                                           
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ORDREC'                        
         BNE   NOMORE                                                           
         L     R1,IOADDR                                                        
         GOTOR GETORD,(R1)                                                      
         JNE   NOMORE              NO MORE IF STATION DOESN'T MATCH             
*                                                                               
         GOTOR ASETORD             SET ORDER VALUES                             
*                                                                               
         GOTOR CHKMKGDS            CHECK THE MAKEGOODS FOR THE NETWORK          
         JNE   NOMORE                                                           
         B     EXITY                                                            
         DROP  R2                                                               
                                                                                
NXTSOD02 MVC   APRD1,AALL          SET DEFAULT PRODUCT ENTRY                    
         MVC   APIG,AALL           SET DEFAULT PIGGY ENTRY                      
         MVC   AEST,AALL           SET DEFAULT ESTIMATE ENTRY                   
         MVI   ESTIND,LW_TALLQ                                                  
                                                                                
         OC    STRDATEC,STRDATEC   TEST ESTIMATE START DATE GIVEN               
         JZ    NXTSOD06                                                         
         CLI   CLTIND,LW_TSINQ     TEST CLIENT CODE GIVEN                       
         BNE   NOMORE                                                           
         XC    STRDATER(L'ENDDATEC),STRDATER                                    
         MVC   STRDATER+L'ENDDATEC(L'ENDDATEC),ENDDATEC                         
         MVC   ENDDATER(L'STRDATEC),STRDATEC                                    
         MVC   ENDDATER+L'STRDATEC(L'STRDATEC),EFFS                             
         XC    AEST,AEST           CLEAR THIS FOR FLTESP ROUTINE                
                                                                                
NXTSOD04 GOTOR (#NXTREC,ANXTREC),DMCB,ESPKEYT,('B#ESTREC',0),SAVED,    +        
               AFLTESP,0                                                        
         ICM   RE,7,AEST           POINT TO ESTIMATE ENTRY IN WMP               
         BZ    NOMORE              EXIT IF NO ESTIMATES FOUND                   
         MVI   ESTIND,LQ_TLSTQ     ESTIMATE LIST BUILT                          
                                                                                
         MVI   LP_RMODE,LP_RFRST   RESET SETKEY MODE                            
NXTSOD06 CLI   BYRIND,LW_TSINQ     TEST BUYER GIVEN                             
         JNE   NXTSOD08                                                         
                                                                                
         L     RE,LP_AWMP          CREATE MEDIA/BUYER DRIVER ENTRY              
         USING LW_D,RE                                                          
         MVI   LW_TYPE,LW_TSINQ                                                 
         ICM   RF,7,AMED                                                        
         MVC   LW_DATA1(L'DBCKAGMD),LW_DATA1-LW_D(RF)                           
         ICM   RF,7,ABYR                                                        
         MVC   LW_DATA1+L'DBCKAGMD(L'DBCKBYR),LW_DATA1-LW_D(RF)                 
         MVC   WORK(L'DBCKBYR),LW_DATA1-LW_D(RF)                                
         DROP  RE                                                               
         STCM  RE,7,AMED                                                        
         AHI   RE,LW_LN1Q+L'DBCKAGMD+L'DSKBYR                                   
         ST    RE,LP_AWMP                                                       
                                                                                
         CLI   MKTIND,LW_TSINQ     TEST MARKET GIVEN                            
         JNE   *+12                                                             
         LA    R0,DBMKEYT          YES - USE BUYER/MARKET KEY                   
         J     NXTSOD10                                                         
                                                                                
         CLI   CLTIND,LW_TSINQ     TEST CLIENT GIVEN                            
         JNE   *+12                                                             
         LA    R0,DBCKEYT          USE BUYER/CLIENT KEY                         
         J     NXTSOD10                                                         
                                                                                
         GOTOR VRCPACK,DMCB,(C'U',WORK),WORK+L'DBCKBYR                          
         ICM   RE,7,AMED                                                        
         MVC   LW_DATA1+L'DSKAGMD-LW_D(L'DSKBYR,RE),WORK+L'DBCKBYR              
         LA    R0,DSKKEYT          DEFAULT TO BUYER/STATION KEY                 
         J     NXTSOD10                                                         
                                                                                
NXTSOD08 LA    R0,DCKKEYT          USE CLIENT/STATION KEY                       
         CLI   STAIND,LW_TSINQ                                                  
         JE    *+8                                                              
         LA    R0,DCMKEYT          USE CLIENT/MARKET KEY                        
         OI    RUNI1,RUNIENIK      SET ESTIMATE NUMBER IN ORDER KEY             
                                                                                
NXTSOD10 ST    R0,AKEYTAB          SAVE A(DRIVER TABLE)                         
         J     NXTSOD14                                                         
                                                                                
NXTSOD12 CLI   ORDIND,LW_TALLQ     TEST PROCESSED SINGLE ORDER                  
         BNE   NOMORE                                                           
         CLC   SVORDKEY,IOKEY      DID WE LOSE OUR KEY SEQUENCE?                
         JE    NXTSOD14                                                         
         MVC   IOVALS(IOVALL),LORDIOVL   YES                                    
                                                                                
NXTSOD14 GOTOR (#NXTREC,ANXTREC),DMCB,AKEYTAB,('B#ORDREC',0),SAVED,    +        
               AFLTSOD,AGETORD                                                  
         BNE   EXITY                                                            
         MVC   LORDIOVL,IOVALS     SAVE FOR KEY SEQUENCE PROBLEM                
                                                                                
         TM    RUNI1,RUNIENIK      TEST ESTIMATE NUMBER IN ORDER KEY            
         JNZ   NXTSOD16                                                         
         CLI   ESTIND,LQ_TLSTQ     TEST ESTIMATE LIST BUILT                     
         JNE   NXTSOD16                                                         
         GOTOR LP_ASETK,DMCB,(1,ESTFLT),ORDEST,SAVED,('FF',LP_D)                
         JNE   NXTSOD14                                                         
                                                                                
NXTSOD16 GOTOR ASETORD             SET ORDER VALUES                             
*                                                                               
         GOTOR CHKMKGDS            REQUESTED NTWK APPEARS IN MAKEGOODS?         
         JNE   NXTSOD14            NO, NEXT ORDER THEN                          
*                                                                               
         ICM   RE,7,AOST           POINT TO STATUS FILTERS                      
         BZ    EXITY                                                            
         SR    R0,R0               APPLY STATUS FILTERS                         
         ICM   R0,3,LW_NUMN-LW_D(RE)                                            
         AHI   RE,LW_LN2Q          POINT TO STATUS/QUALIFIER ARRAY              
                                                                                
NXTSOD18 CLC   ORDISTAT,0(RE)      MATCH ORDER CURRENT STATUS                   
         JNE   NXTSOD20                                                         
         CLI   L'ORDISTAT(RE),FF   TEST TWO BYTE STATUS FILTER                  
         JE    *+14                                                             
         CLC   ORDPSTAT,L'ORDISTAT(RE)                                          
         JNE   NXTSOD20                                                         
*                                                                               
         CLI   L'ORDISTAT*2(RE),FF TEST STATUS QUALIFIER FILTER                 
         BE    EXITY                                                            
         CLI   ORDTFLAG,0          WAS ORDTTYPE SET OR JUST NULLS?              
         JE    NXTSOD20            NULLS                                        
         XR    R1,R1                                                            
         IC    R1,L'ORDISTAT*2(RE)                                              
         BASR  R4,0                                                             
         TM    ORDTTYPE,0                                                       
         EX    R1,0(R4)                                                         
         BNZ   EXITY                                                            
                                                                                
NXTSOD20 AHI   RE,L'ORDISTAT*2+L'ORDTTYPE                                       
         JCT   R0,NXTSOD18                                                      
         J     NXTSOD14            NO FILTERS APPLY - GET NEXT RECORD           
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER DOWNLOAD - SUPPLEMENTARY ID ELEMENT   *         
***********************************************************************         
                                                                                
ARYSOL03 LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOSPEL,DOSPELQ),ROWWIDTH=(V,DOSPLEN)                      
                                                                                
FADat    LKOUT C,1,(D,B#SAVED,ORDFADAT),CDAT,ND=Y                               
CStat    LKOUT C,2,(D,B#SAVED,ORDBSTAT),CHAR,ND=Y                               
SType    LKOUT C,3,(D,B#SAVED,ORDTTYPE),HEXD,FILTROUT=TSTFLAG3                  
RevNo    LKOUT C,4,DOSPREVN,LBIN                                                
Media    LKOUT C,5,(D,B#SAVED,ORDAM),(U,#EDTMED,$EDTMED)                        
MktNm    LKOUT C,7,DOSPMKT,(R,EDTMKN),LEN=L'MKTNAME,ND=Y                        
MktNo    LKOUT C,8,DOSPMKT,LBIN                                                 
Flag1    LKOUT C,24,DOSPFLG1,HEXD,ND=Y                                          
Flag2    LKOUT C,25,DOSPFLG2,HEXD,ND=Y                                          
STyp2    LKOUT C,35,(D,B#SAVED,ORDTTYPE),HEXD,FILTROUT=TSTFLAG7                 
Count    LKOUT C,45,DOSPVER#,LBIN                                               
URLTx    LKOUT C,46,(D,B#SAVED,ORDURLEL+1),(R,EDTOURL),ND=Y,           +        
               PCVERSION=2.5.0.6                                                
Array    LKOUT C,255,(A,ARYRLN),PCVERSION=2.5.0.6                               
PDest    LKOUT C,52,DOSPIDST,CHAR,ND=Y,PCVERSION=3.0.0.120                      
PMeth    LKOUT C,53,DOSPIMTH,CHAR,ND=Y,PCVERSION=3.0.0.120                      
GAPSq    LKOUT C,54,DOSPGAP#,LBIN,ND=Y,PCVERSION=3.0.0.120                      
                                                                                
         LKOUT E                                                                
                                                                                
TSTFLAG3 TM    ORDTFLAG,OTFTYP3    TEST IF ORDTTYPE HAS BEEN SET                
         BNZ   RTRNYES                                                          
         B     RTRNNO                                                           
                                                                                
TSTFLAG7 TM    ORDTFLAG,OTFTYP7    TEST IF SEND CANCEL HAS BEEN SET             
         BNZ   RTRNYES                                                          
         B     RTRNNO                                                           
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER DOWNLOAD - PRIMARY ID ELEMENT         *         
***********************************************************************         
                                                                                
ARYSOL01 LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOIDEL,DOIDELQ),ROWWIDTH=(V,DOIDLEN)                      
                                                                                
SCall    LKOUT C,6,DOISTA,(R,EDTSTA)                                            
CltCd    LKOUT C,10,DOIDCLT,(R,EDTCLT),LEN=3,ND=Y                               
CltNm    LKOUT C,9,DOIDCLT,(R,EDTCLN),LEN=L'CNAME,ND=Y                          
CltTP    LKOUT C,40,DOIDCLT,HDRO,ND=Y,FILTROUT=TPOLCLT                          
PrdCd    LKOUT C,12,DOIDPRD,(R,EDTPRD)                                          
PrdNm    LKOUT C,11,DOIDPRD,(R,EDTPRN),LEN=L'PNAME,ND=Y                         
PigCd    LKOUT C,14,DOIDPRD2,(R,EDTPRD),ND=Y                                    
PigNm    LKOUT C,13,DOIDPRD2,(R,EDTPRN),LEN=L'PNAME,ND=Y                        
EstNo    LKOUT C,15,DOIDEST,LBIN                                                
Array    LKOUT C,255,(A,ARYSOE)                                                 
Buyer    LKOUT C,22,DOIDBYR,CHAR,ND=Y                                           
ByrNm    LKOUT C,23,DOIDBYR,(R,EDTBYR),LEN=L'BYRFNAME,ND=Y                      
OrdNo    LKOUT C,26,(D,B#SAVED,ORDORDER),(U,#EDTORD,$EDTORD)                    
ConNo    LKOUT C,27,DOIDCON,CHAR,ND=Y                                           
LADat    LKOUT C,28,(D,B#SAVED,ORDLADAT),JDAT,ND=Y                              
                                                                                
         LKOUT E                                                                
                                                                                
TPOLCLT  L     R1,ACLTREC          SET CC EQUAL IF TPOL CLIENT                  
         CLI   CPROF-CKEY(R1),C'0'                                              
         BNE   EXITN                                                            
         B     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SUBSCRIBED/SEARCH ORDER MAKEGOOD DOWNLOAD                
***********************************************************************         
                                                                                
ARYSOO   LKOUT A,(R,NXTOMN),NROWS=1,ROWNAME=NOTVALS,ROWWIDTH=NOTVALL            
                                                                                
GCode    LKOUT C,29,NOTGROUP,CHAR,ND=Y                                          
CStat    LKOUT C,30,NOTSTAT,CHAR,ND=Y                                           
LADat    LKOUT C,31,NOTDATE,JDAT,ND=Y                                           
LATim    LKOUT C,37,NOTTIME,(R,EDTTIME)                                         
AdDat    LKOUT C,50,NOTCDATE,JDAT,ND=Y                                          
AdTim    LKOUT C,51,NOTCTIME,(R,EDTTIME)                                        
FMDat    LKOUT C,32,NOTFMIS,JDAT,ND=Y                                           
FODat    LKOUT C,33,NOTFOFF,JDAT,ND=Y                                           
MissNwk  LKOUT C,36,(A,ARYMNW),FILTROUT=TSTCABLE                                
OffrNwk  LKOUT C,38,(A,ARYONW),FILTROUT=TSTCABLE                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER EXPORT EMAIL ADDRESSES                   *         
***********************************************************************         
                                                                                
ARYSOEM  LKOUT A,(D,B#ORDREC,DORFRST),ROWID=(DOEMXEL,DOEMXELQ),EOT=EOR,+        
               ROWWIDTH=(V,DOEMXLEN)                                            
                                                                                
EList    LKOUT C,55,(A,ARYSELS),FILTROUT=TSTEFST                                
                                                                                
         LKOUT E                                                                
                                                                                
                                                                                
ARYSELS  LKOUT A,(*,DOEMXD2),ROWNAME=DOEMXEL,NROWS=*,ROWWIDTH=DOEMXLN2          
                                                                                
ESTyp    LKOUT C,55,DOEMXFLG,CHAR,ND=Y                                          
EAddr    LKOUT C,56,DOEMXTOK,(R,EDTEML),ND=Y                                    
                                                                                
         LKOUT E                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED NETWORK CODES                                     
***********************************************************************         
ARYMNW   LKOUT A,(R,SETMNTWK),NROWS=(B#SAVED,NUMMNWKS)                          
Ntwk     LKOUT C,36,(D,B#SAVED,NUMMNWKS),(R,EDTNTWK)                            
         LKOUT E                                                                
                                                                                
***********************************************************************         
* SHOW THE NETWORKS IN THE ORDER NOTICE RECORDS                                 
***********************************************************************         
SETMNTWK L     R6,AIO8                                                          
         ST    R6,LP_ADATA                                                      
         J     EXITY                                                            
***********************************************************************         
* SHOW THE CURRENT NETWORK                                                      
*                                                                               
* NOTE: THIS ROUTINE IS SHARED BY BOTH THE MISSED AND OFFERED                   
*       THE DATA POINTED TO IN THE "LKOUT C" IS JUST A PLACEHOLDER              
*         AND IS NECESSARY ONLY FOR LKOUT, WE DON'T ACTUALLY USE IT             
***********************************************************************         
EDTNTWK  L     R6,LP_ADATA                                                      
*                                                                               
         LLC   R1,0(R6)            FIRST BYTE OF STORAGE HOLD CURRENT           
         MHI   R1,L'STAPQNET          # OF THE NETWORK CODE TO SHOW             
         LA    R2,1(R1,R6)                                                      
*                                                                               
         L     RF,LP_AOUT                                                       
         MVC   0(L'STAPQNET,RF),0(R2)                                           
         LHI   RF,L'STAPQNET                                                    
         STCM  RF,15,LP_OLEN                                                    
*                                                                               
         LLC   R1,0(R6)            BUMP FOR NEXT TIME IN                        
         LA    R1,1(R1)                                                         
         STC   R1,0(R6)                                                         
         J     EXITY                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OFFERED NETWORK CODES                                    
***********************************************************************         
                                                                                
ARYONW   LKOUT A,(R,SETONTWK),NROWS=(B#SAVED,NUMONWKS)                          
Ntwk     LKOUT C,38,(D,B#SAVED,NUMONWKS),(R,EDTNTWK)                            
         LKOUT E                                                                
                                                                                
***********************************************************************         
* SHOW THE NETWORKS IN THE ORDER NOTICE RECORDS                                 
***********************************************************************         
SETONTWK L     R6,AIO8                                                          
         AHI   R6,1000                                                          
         ST    R6,LP_ADATA                                                      
         J     EXITY                                                            
*                                                                               
*&&DO                                                                           
***********************************************************************         
* ARRAY DEFINITION FOR SUBSCRIBED ORDER OFFER REP BUY COMMENTS        *         
***********************************************************************         
                                                                                
ARYRBC2  LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOCMELD,MOCMELQ),ROWWIDTH=(V,MOCMLEN)                     
                                                                                
Line#    LKOUT C,41,MOCMLINE,UBIN,ND=Y                                          
CText    LKOUT C,42,MOCMTEXT,CHAR,ND=Y,LEN=V                                    
                                                                                
         LKOUT E                                                                
*&&                                                                             
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ESTIMATE VALUES DOWNLOAD                       *         
***********************************************************************         
                                                                                
ARYSOE   LKOUT A,(R,GETSOE),NROWS=1,ROWNAME=ESTHDR                              
                                                                                
SDate    LKOUT C,16,(D,B#WORKD,WORK),EDAT                                       
Edate    LKOUT C,17,(D,B#WORKD,WORK+L'ESTART),EDAT                              
Array    LKOUT C,255,(A,ARYSOF)                                                 
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET ESTIMATE VALUES IF NECESSARY FOR ORDER DOWNLOADS                *         
***********************************************************************         
                                                                                
         USING GSWORKD,RC                                                       
GETSOE   MVC   GSIOSV,IOVALS                                                    
         XC    SODOD(SODORECL),SODOD                                            
         MVI   SODOTYPE,SODOTEST                                                
         MVC   SODOMED,ORDAM                                                    
         MVC   SODOCLT,ORDCLT                                                   
         MVC   SODOEST,ORDEST                                                   
         MVC   TSARSAV,SODOD                                                    
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         BE    NOMORE                                                           
         MVC   SODOD(SODORECL),TSARSAV                                          
         GOTOR BUFFER,DMCB,('TSAADD',0)                                         
         JNE   *+2                                                              
                                                                                
         LA    R2,IOKEY            READ POL ESTIMATE RECORD                     
         USING ESTHDR,R2                                                        
         XC    EKEY,EKEY                                                        
         MVC   EKEYAM,ORDAM                                                     
         MVC   EKEYCLT,ORDCLT                                                   
         MVC   EKEYPRD,POLPRD                                                   
         MVC   EKEYEST,ORDEST                                                   
         LA    R0,GSIO                                                          
         ST    R0,IOADDR                                                        
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IODIR'                                   
         JE    GSOE010                                                          
         MVC   IOVALS(IOVALL),GSIOSV                                            
         B     NOMORE                                                           
*                                                                               
GSOE010  GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL'                                  
         JNE   *+2                                                              
         LA    R2,GSIO                                                          
         MVC   WORK(L'ESTART+L'EEND),ESTART                                     
         MVC   IOVALS(IOVALL),GSIOSV                                            
         LA    R0,WORK                                                          
         ST    R0,LP_ADATA                                                      
         B     EXITY                                                            
         DROP  R2,RC                                                            
                                                                                
GSWORKD  DSECT                     ** GETSOE LOCAL WORKING STORAGE **           
GSIOSV   DS    XL(IOVALL)                                                       
GSIO     DS    XL(ESTHDR2Q)                                                     
SVRDEF   CSECT                                                                  
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SUBSCRIPTION FLIGHT DOWNLOAD                   *         
***********************************************************************         
                                                                                
ARYSOF   LKOUT A,(R,GETSOF),NROWS=1,ROWNAME=DFLRECD                             
                                                                                
Array    LKOUT C,255,(A,ARYSOF01)                                               
Array    LKOUT C,255,(A,ARYSOF05)                                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET FLIGHT RECORD FOR ORDER DOWNLOADS                               *         
***********************************************************************         
                                                                                
GETSOF   MVC   SVIOVALS,IOVALS                                                  
         MVC   LP_ADATA,AFLTREC                                                 
         LA    R1,IOKEY                                                         
         USING DFLRECD,R1                                                       
         XC    DFLKEY,DFLKEY                                                    
         MVI   DFLKTYP,DFLKTYPQ                                                 
         MVI   DFLKSUB,DFLKSUBQ                                                 
         MVC   DFLKAGMD,ORDAM                                                   
         MVC   DFLKCLT,ORDCLT                                                   
         MVC   DFLKPRD,POLPRD                                                   
         MVC   DFLKEST,ORDEST                                                   
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IODIR+B#FLTREC'                         
         JNE   GETSOFN                                                          
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#FLTREC'                        
         JNE   *+2                                                              
         MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     EXITY                                                            
                                                                                
GETSOFN  MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     NOMORE                                                           
         DROP  R1                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT INFO DOWNLOAD                           *         
***********************************************************************         
                                                                                
ARYSOF01 LKOUT A,(D,B#FLTREC,DFLEL),EOT=EOR,                           +        
               ROWID=(DFINFEL,DFINFELQ),ROWWIDTH=(V,DFINFLEN)                   
                                                                                
FNFSDat  LKOUT C,18,DFINFSDT,BDAT                                               
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR FLIGHT DETAILS DOWNLOAD                        *         
***********************************************************************         
                                                                                
ARYSOF05 LKOUT A,(D,B#FLTREC,DFLEL),EOT=EOR,                           +        
               ROWID=(DFFLTEL,DFFLTELQ),ROWWIDTH=(V,DFFLTLEN)                   
                                                                                
FltNo    LKOUT C,19,DFFLTNUM,UBIN                                               
StrDt    LKOUT C,20,DFFLTSTR,BDAT                                               
EndDt    LKOUT C,21,DFFLTEND,BDAT                                               
                                                                                
         LKOUT E                                                                
         EJECT                                                                  
***********************************************************************         
* ORDER & MAKEGD REPONSES FROM BUY AND OTHER LINK OVERLAYS                      
***********************************************************************         
                                                                                
REQOAR   LKREQ H,I#SDOOAR,POINTTO=REQULR,NEXTREQ=REQAPR   X'00E2'               
REQAPR   LKREQ H,I#SDOAPR,POINTTO=REQULR,NEXTREQ=REQREJ   X'00E3'               
REQREJ   LKREQ H,I#SDOREJ,POINTTO=REQULR,NEXTREQ=REQSAP   X'00E4'               
REQSAP   LKREQ H,I#SDOSAP,POINTTO=REQULR,NEXTREQ=REQAPY   X'00E5'               
REQAPY   LKREQ H,I#SDOAPY,POINTTO=REQULR,NEXTREQ=REQOFC   X'00E6'               
REQOFC   LKREQ H,I#SDOOFC,POINTTO=REQULR,NEXTREQ=REQULR   X'00E7'               
                                                                                
REQULR   LKREQ H,0,OUTOMR,NEXTREQ=REQLCKD                                       
Media    LKREQ F,D#MEDIA,(I,B#SAVED,MEDIND),CHAR,OLEN=L'BUYMED,        +        
               TEXT=SP#MED,COL=*                                                
Order    LKREQ F,D#ORDNO,(I,B#SAVED,ORDIND),CHAR,OLEN=8,TEXT=SP#ORDN,  +        
               COL=*                                                            
RecDA    LKREQ F,D#DA,(I,B#SAVED,RDAIND),HEXD,OLEN=L'BUYKDA,           +        
               TEXT=SP#SDBDA,COL=*                                              
PCKey    LKREQ F,D#PCKEY,(D,B#SAVED,PCKEYORD),CHAR,TEXT=SP#KEY,COL=*            
*********************************                                               
* STATION IS REQUIRED FOR THE X'00E7' CALL ESPECIALLY IF THE STATION            
* IS A CABLE STATION, WHOEVER CALLS THIS SHOULD KNOW                            
*                                                                               
* 2014-03-25  HWON                                                              
* THIS FIELD IS FILLED IN BY SPLNK16 AND IS ALREADY IN RAW FORMAT               
* THERE IS NO NEED TO CALL VALSTA AS THE HEX FORMAT IS SENT                     
*********************************                                               
Statn    LKREQ F,D#STA,(I,B#SAVED,STTNIND),HEXD,                       +        
               OLEN=L'QSTAX,MAXLEN=L'QSTAA,TEXT=SP#STA,COL=*                    
         LKREQ E                                                                
                                                                                
OUTOMR   LKOUT H                   ** RESPONSES **                              
                                                                                
OMRTIM   LKOUT R,255               CURRENT TIME                                 
CTime    LKOUT C,1,(D,B#WORKD,FULL),HEXD,FILTROUT=GETTIME                       
         LKOUT E                                                                
                                                                                
OMRORD   LKOUT R,X'00DA'           ORDER RECORD                                 
Array    LKOUT C,255,(A,ARYOMR)                                                 
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER RESPONSES                                *         
***********************************************************************         
                                                                                
ARYOMR   LKOUT A,(R,NXTOMR),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,255,(A,ARYORD),FILTROUT=TSTORDR                                
Array    LKOUT C,226,(A,ARYOBC),FILTROUT=TSTOBCR                                
Array    LKOUT C,X'0082',(A,ARYMKN)                                             
                                                                                
         LKOUT E                                                                
                                                                                
TSTORDR  TM    MAPI2,MAPIORDR      TEST D/L ORDER DETAILS                       
         B     SETCCC                                                           
                                                                                
TSTOBCR  TM    MAPI1,MAPIOBCR      TEST D/L ORDER BUYER COMMENTS                
         B     SETCCC                                                           
                                                                                
***********************************************************************         
* ORDER RESPONSES                                                     *         
***********************************************************************         
                                                                                
NXTOMR   CLI   LP_RMODE,LP_RFRST                                                
         BNE   NOMORE                                                           
         LA    R0,WORK                                                          
         ST    R0,LP_ADATA         SET A(DUMMY OUTPUT) IN CASE OF EXIT          
*                                                                               
         CLC   LP_QMAPN,SDOOFC#    TEST OFFER CHANGE RESPONSE                   
         JNE   NXTOMR20                                                         
*                                                                               
         ICM   RE,7,ARDA           DISK ADDRESS HAD BETTER BE PASSED            
         JZ    *+2                                                              
         MVC   IODAOVER,LW_DATA1-LW_D(RE)                                       
*                                                                               
         ICM   RE,7,ASTATN         SEE IF STATION WAS PASSED                    
         JZ    NXTOMR10            IT WAS NOT, ASSUME BROADCAST STATION         
         MVC   ORDBSTA,LW_DATA1-LW_D(RE)                                        
         CLI   ORDBSTA,X'E8'       IS THIS FOR A CABLE STATION?                 
         JNL   NXTOMR15            CABLE MAKEGOOD LIVES ON XSPF                 
*                                                                               
NXTOMR10 GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#NOTREC'                        
         JNE   *+2                                                              
*                                                                               
         BRAS  RE,FIXMGN           FIX MAKEGOOD NOTICE STATUS HISTORY           
*                                                                               
         L     R4,ANOTREC                                                       
         USING MNKEY,R4                                                         
         MVC   QMEDX,MNKAGMD                                                    
         MVC   ORDER#,MNKORDER                                                  
         J     NXTOMR40                                                         
*********                                                                       
* FOR OFFER CHANGE RESPONSE FOR A CABLE STATION                                 
*********                                                                       
NXTOMR15 GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#NOTREC'                     
         JNE   *+2                                                              
*                                                                               
         BRAS  RE,FIXMGN           FIX MAKEGOOD NOTICE STATUS HISTORY           
*                                                                               
         L     R4,ANOTREC                                                       
         USING MNXKEY,R4                                                        
         MVC   QMEDX,MNXKAGMD                                                   
         MVC   ORDER#,MNXKORDR                                                  
         J     NXTOMR40                                                         
         DROP  R4                                                               
         EJECT                                                                  
*********                                                                       
* NOT AN OFFER CHANGE RESPONSE, LP_QMAPN <> SDOOFC#                             
*********                                                                       
NXTOMR20 ICM   RE,7,ARDA           TEST DISK ADDRESS PASSED                     
         JZ    NXTOMR30                                                         
         CLI   LW_TYPE-LW_D(RE),LW_TSINQ                                        
         JNE   *+2                                                              
         MVC   IODAOVER,LW_DATA1-LW_D(RE)                                       
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ORDREC'                        
         JE    NXTOMR50                                                         
         DC    H'0'                                                             
                                                                                
NXTOMR30 ICM   RE,7,AMED           VALIDATE MEDIA CODE                          
         JZ    *+2                                                              
         CLI   LW_TYPE-LW_D(RE),LW_TSINQ                                        
         JNE   *+2                                                              
         MVC   WORK(L'QMEDA),LW_DATA1-LW_D(RE)                                  
         GOTOR (#VALMED,AVALMED),DMCB,WORK,,WORK                                
         JNE   *+2                                                              
                                                                                
         ICM   RE,7,AORD           VALIDATE ORDER NUMBER                        
         JZ    *+2                                                              
         CLI   LW_TYPE-LW_D(RE),LW_TSINQ                                        
         JNE   *+2                                                              
         MVC   WORK(8),LW_DATA1-LW_D(RE)                                        
         GOTOR (#VALORD,AVALORD),DMCB,WORK,8,ORDER#                             
                                                                                
NXTOMR40 LA    R2,IOKEY            READ ORDER RECORD                            
         USING DAREORDD,R2                                                      
         XC    DOKEY,DOKEY                                                      
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,QMEDX                                                    
         MVC   DOKORDER,ORDER#                                                  
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBHI+IODIR+B#ORDREC'                         
         JNE   *+2                                                              
         CLC   DOKEY(DOKSTA-DOKEY),IOKEYSAV                                     
         JNE   *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ORDREC'                        
         JNE   *+2                                                              
         DROP  R2                                                               
*                                                                               
NXTOMR50 XC    LORDVALS(LORDVALL),LORDVALS                                      
         L     R1,AORDREC                                                       
         GOTOR GETORD,(R1)                                                      
*                                                                               
         GOTOR ASETORD             SET ORDER VALUES                             
         B     EXITY                                                            
***********************************************************************         
* ARRAY DEFINITION FOR ORDER BUYER COMMENTS                           *         
***********************************************************************         
                                                                                
ARYOBC   LKOUT A,(R,NXTOBC),MULTIROW=Y,ROWNAME=DAREORDD                         
                                                                                
RecDA    LKOUT C,1,(D,B#SAVED,COMDA),HEXD,ND=Y                                  
ChkSm    LKOUT C,2,(D,B#SAVED,COMCKSM),HEXD,ND=Y                                
Array    LKOUT C,X'00E2',(A,ARYOBCM)                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* GET DARE ORDER BUYER COMMENTS                                       *         
***********************************************************************         
                                                                                
NXTOBC   GOTOR GETCOM,DOKCAGCQ                                                  
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER BUYER COMMENTS                           *         
***********************************************************************         
                                                                                
ARYOBCM  LKOUT A,(D,B#OBCREC,DORFRST),EOT=EOR,NEWEL=B,                 +        
               ROWID=(DOCOMELD,DOCOMELQ),ROWWIDTH=(V,DOCOMLEN)                  
                                                                                
BComm    LKOUT C,2,DOCOMTXT,CHAR,LEN=V,MAPMOD1=DOCOMLIN                         
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD NOTICE DOWNLOAD                       *         
***********************************************************************         
                                                                                
ARYMKN   LKOUT A,(R,NXTOMN),MULTIROW=Y                                          
                                                                                
Array    LKOUT C,255,(A,ARYOMN),FILTROUT=TSTBRDCS                               
Array    LKOUT C,255,(A,AXYOMN),FILTROUT=TSTCABLE,PCVERSION=4.5.0.0             
*                                                                               
Array    LKOUT C,255,(A,ARYPRC),FILTROUT=TSTNTDON,PCVERSION=4.6.0.233           
*                                                                               
Array    LKOUT C,255,(A,ARYOMO),FILTROUT=TSTOFFR                                
         LKOUT E                                                                
****************                                                                
* The following Array Blocks are very similar, but the address of               
*   the first element is different because of SPTFIL and XSPFIL.                
*   The (D,B#SAVED,NOTVALS) is acting as a dummy                                
****************                                                                
ARYOMN   LKOUT A,(D,B#SAVED,NOTVALS),NEWEL=Y,NROWS=1                            
Array    LKOUT C,X'0082',(A,ARYMNH),FILTROUT=TSTMNHD                            
Array    LKOUT C,X'0085',(A,ARYMNI),FILTROUT=TSTMNHD,                  +        
               PCVERSION=4.7.0.132                                              
Array    LKOUT C,X'0083',(A,ARYMNS),FILTROUT=TSTMNHD                            
Array    LKOUT C,X'0084',(A,ARYXBD),FILTROUT=TSTMISS                            
Array    LKOUT C,X'0086',(A,ARYMSC),FILTROUT=TSTMISS                            
Array    LKOUT C,X'0088',(A,ARYMSO),FILTROUT=TSTMISS                            
Array    LKOUT C,X'008A',(A,ARYMBC),FILTROUT=TSTMISS                            
Array    LKOUT C,X'008B',(A,ARYRCM),FILTROUT=TSTMNHD                            
         LKOUT E                                                                
*                                                                               
AXYOMN   LKOUT A,(D,B#SAVED,NOTVALS),NEWEL=Y,NROWS=1                            
Array    LKOUT C,X'0082',(A,ARYMNH),FILTROUT=TSTMNHD                            
Array    LKOUT C,X'0085',(A,AXYMNI),FILTROUT=TSTMNHD,                  +        
               PCVERSION=4.7.0.132                                              
Array    LKOUT C,X'0083',(A,AXYMNS),FILTROUT=TSTMNHD                            
Array    LKOUT C,X'0084',(A,AXYXBD),FILTROUT=TSTMISS                            
Array    LKOUT C,X'0086',(A,AXYMSC),FILTROUT=TSTMISS                            
Array    LKOUT C,X'0088',(A,AXYMSO),FILTROUT=TSTMISS                            
Array    LKOUT C,X'008A',(A,AXYMBC),FILTROUT=TSTMISS                            
Array    LKOUT C,X'008B',(A,AXYRCM),FILTROUT=TSTMNHD                            
         LKOUT E                                                                
                                                                                
TSTMNHD  TM    MAPI2,MAPIMNHD      TEST D/L MAKEGOOD NOTICE HEADER              
         B     SETCCC                                                           
                                                                                
TSTMISS  TM    MAPI2,MAPIMISS      TEST D/L MISSED BUYLINE DETAILS              
         B     SETCCC                                                           
                                                                                
TSTOFFR  TM    MAPI2,MAPIOFFD      TEST D/L OFFER DETAILS                       
         BZ    EXITN                                                            
TSTNTDON CLI   NOTCDONE,C'Y'       DONE W/MG NOTICE? D/L OTHER MG RECS?         
         B     EXIT                                                             
                                                                                
TSTBRDCS CLI   ORDBSTA,X'E8'       TEST FOR BROADCAST STATION                   
         BL    EXITY               LOWER THAN X'E8' IS BROADCAST                
         B     EXITN                                                            
                                                                                
TSTCABLE CLI   ORDBSTA,X'E8'       TEST FOR CABLE STATION                       
         BNL   EXITY               YES, IT IS                                   
         B     EXITN                                                            
*                                                                               
STNOTSTA L     R2,ANOTREC                                                       
         USING MNXKEY,R2                                                        
         MVC   NOTSTATN,MNXKSTTN   SAVE OFF STATION OF THE NOTICE REC           
         DROP  R2                                                               
         B     EXITY                                                            
***********************************************************************         
* GET MAKEGOOD RECORDS FOR ORDER DOWNLOADS                                      
***********************************************************************         
                                                                                
NXTOMN   LA    R0,NOTVALS                                                       
         ST    R0,LP_ADATA                                                      
         XC    NOTVALS(NOTVALL),NOTVALS                                         
                                                                                
         CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTOMN14                                                         
         MVI   NOTCDONE,C'N'       SET TO NOT DONE W/MG NOTICE (NXTOMN)         
*                                                                               
         CLC   LP_QMAPN,SDOOFC#    TEST OFFER CHANGE RESPONSE                   
         JNE   NXTOMN04                                                         
         ICM   RE,7,ARDA           TEST DISK ADDRESS PASSED                     
         JZ    *+2                                                              
         CLI   LW_TYPE-LW_D(RE),LW_TSINQ                                        
         JNE   *+2                                                              
         MVC   IODAOVER,LW_DATA1-LW_D(RE)                                       
*                                                                               
         ICM   RE,7,ASTATN         SEE IF STATION WAS PASSED                    
         JZ    NXTOMN12            IT WAS NOT, ASSUME BROADCAST STATION         
         MVC   ORDBSTA,LW_DATA1-LW_D(RE)                                        
         CLI   ORDBSTA,X'E8'       IS THIS FOR A CABLE STATION?                 
         JNL   NXTOMN38            YES, GETREC FOR XSPF                         
         J     NXTOMN12                                                         
*                                                                               
NXTOMN04 MVC   SVIOVALS,IOVALS     SAVE ORDER I/O VALUES                        
*                                                                               
         XC    IOKEY,IOKEY                                                      
                                                                                
         CLI   ORDBSTA,X'E8'       ORDER FOR A CABLE SYSCODE?                   
         JNL   NXTOMN26            YES                                          
***                                                                             
* READ OUR FIRST BROADCAST NOTICED RECORD                                       
***                                                                             
         LA    R2,IOKEY                                                         
         USING MNKEY,R2            READ FIRST NOTICE RECORD                     
         MVI   MNKTYPE,MNKTYPQ                                                  
         MVI   MNKSUBTY,MNKSTYPQ                                                
         MVC   MNKAGMD,ORDAM                                                    
         MVC   MNKBYR,ORDBUYER                                                  
         MVC   MNKORDER,ORDORDER                                                
*                                                                               
NXTOMN08 GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IODIR+B#NOTREC'                        
         JE    NXTOMN10                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         MVI   IOERR,0                                                          
NXTOMN10 CLC   MNKEY(MNKGROUP-MNKEY),IOKEYSAV   SAME ORDER?                     
         JE    NXTOMN12                                                         
         J     NXTOMNN                                                          
         DROP  R2                                                               
*                                                                               
NXTOMN12 MVI   NOTCDONE,C'Y'       SET TO DONE WITH NXTOMN                      
*                                          GO D/L OTHER MG RECORDS              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#NOTREC'                        
         JE    NXTOMN40                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         J     NXTOMN40                                                         
****                                                                            
* NOT FIRST TIME ANYMORE                                                        
*   OR                                                                          
* SEARCH DID NOT FIND THE NETWORK                                               
****                                                                            
*                                                                               
NXTOMN14 CLI   ORDBSTA,X'E8'       ORDER FOR A CABLE SYSCODE?                   
         JNL   NXTOMN16            YES                                          
*                                                                               
         CLC   LP_QMAPN,SDOOFC#    TEST OFFER CHANGE RESPONSE                   
         JE    EXITN                                                            
*                                                                               
         LA    R2,IOKEY            BUMP TO NEXT GROUP                           
         USING MNKEY,R2            READ FIRST NOTICE RECORD                     
         MVC   MNKEY,SVNOTKEY         OR STATION IF CABLE                       
         LLC   R0,MNKGROUP+L'MNKGROUP-1                                         
         AHI   R0,1                                                             
         STC   R0,MNKGROUP+L'MNKGROUP-1                                         
         J     NXTOMN08                                                         
         DROP  R2                                                               
*                                                                               
***************                                                                 
* For Cable, we can have more than 1 notice record                              
* We have the primary, that does NOT have station in the key,                   
* And we have a record for each network.  Currently, $BUY cannot handle         
*   more than 1 record for each network even though the key structure           
*   allows for it                                                               
***************                                                                 
NXTOMN16 CLC   LP_QMAPN,SDSODD#    SEARCH?                                      
         JE    NXTOMN35             GO READ NEXT MG NOTICE GROUP                
         CLC   LP_QMAPN,SDSOLD#    SUBSCRIPTION?                                
         JE    NXTOMN35             GO READ NEXT MG NOTICE GROUP                
***************                                                                 
* We are multi-order dl or response.                                            
***************                                                                 
         XC    PCKEYORD,PCKEYORD                                                
         CLI   NOTCDONE,C'Y'       STILL READING CABLE NOTICE RECS?             
         JNE   NXTOMN18             YES                                         
*                                   ELSE, RTRN FROM RD'G OTHER MG RECS?         
         CLC   LP_QMAPN,SDOOFC#    TEST OFFER CHANGE RESPONSE                   
         JE    EXITN                YES, EXIT AS WE ONLY D/L ONE MKGD           
         J     NXTOMN35             NO , READ NEXT GROUP                        
*                                                                               
*   ***SINCE WE DONT DO A DIR READ WE MUST SET THE READ SEQUENCE***             
*                                                                               
NXTOMN18 CLC   LP_QMAPN,SDOOFC#    TEST OFFER CHANGE RESPONSE                   
         JNE   NXTOMN22                                                         
         MVC   IOKEY(L'MNXKEY),SVNOTKEY  READ THE NOTICE RECORD                 
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IOXSPDIR+B#NOTREC'                     
*                                                                               
NXTOMN22 GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#NOTREC'                     
         JE    NXTOMN24                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
NXTOMN24 CLC   IOKEY(MNXKSTTN-MNXKEY),IOKEYSAV  SAME ORDER/MKGD GROUP?          
         JE    NXTOMN38                          YES, ANOTHER NETWORK           
*                                                                               
* WE PROCESSED ALL THE NOTICES FOR A MKGD GROUP, TIME TO READ OFFERS            
*                                                                               
         L     RE,ANOTREC                                                       
         MVI   MNXFRST-MNXKEY(RE),0  CLEAR ELEMS BUT LEAVE KEY INTACT           
*                                         FOR NXTOFF                            
         MVI   NOTCDONE,C'Y'       SET TO DONE WITH NOTICE (NXTOMN)             
         J     NXTOMNYS                    GO D/L OTHER MG RECORDS              
***                                                                             
* READ CABLE NOTICE RECORD                                                      
***                                                                             
NXTOMN26 LA    R2,IOKEY                                                         
         USING MNXKEY,R2           READ FIRST NOTICE RECORD                     
         MVI   MNXKTYPE,MNXKTYPQ                                                
         MVI   MNXKSBTY,MNXKSBTQ                                                
         MVC   MNXKAGMD,ORDAM                                                   
         MVC   MNXKORDR,ORDORDER                                                
         DROP  R2                                                               
*                                                                               
NXTOMN28 MVI   NOTCDONE,C'N'       SET TO NOT DONE WITH NOTICE (NXTOMN)         
         GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IOXSPDIR+B#NOTREC'                     
         JE    NXTOMN30                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
NXTOMN30 CLC   IOKEY(MNXKGRP-MNXKEY),IOKEYSAV   SAME ORDER?                     
         JNE   NXTOMNN                                                          
         OC    IOKEY+MNXKGRP-MNXKEY(L'MNXKGRP),IOKEY+MNXKGRP-MNXKEY             
         JZ    NXTOMN34            NO GROUP CODE, SKIP IT                       
         OC    IOKEY+MNXKSTTN-MNXKEY(L'MNXKSTTN),IOKEY+MNXKSTTN-MNXKEY          
         JZ    NXTOMN38            FIRST RECORD IS NON STATION!                 
*                                   OTHERWISE, SKIP IT                          
NXTOMN34 MVC   SVNOTKEY(L'MNXKEY),IOKEY  NO GROUP, READ NEXT GROUP              
*                                                                               
* IF WE GET HERE, WE ARE READING THE NEXT CABLE MAKEGOOD GROUP                  
*                                                                               
NXTOMN35 MVI   NOTCDONE,C'N'       SET TO NOT DONE WITH NOTICE (NXTOMN)         
         LA    R2,IOKEY                                                         
         USING MNXKEY,R2                                                        
         XC    IOKEY,IOKEY          GET NEXT GROUP FOR CABLE MAKEGOOD           
         MVC   MNXKEY(MNXKSTTN-MNXKEY),SVNOTKEY                                 
         LLC   R0,MNXKGRP+L'MNXKGRP-1                                           
         AHI   R0,1                                                             
         STC   R0,MNXKGRP+L'MNXKGRP-1                                           
         J     NXTOMN28                                                         
         DROP  R2                                                               
*                                                                               
NXTOMN38 GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#NOTREC'                     
         JE    NXTOMN40                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
* PREPROCESSING THE MISSED MAKEGOOD RECORD, COULD BE BROADCAST OR CABLE         
*                                                                               
NXTOMN40 BRAS  RE,FIXMGN           FIX MAKEGOOD NOTICE STATUS HISTORY           
                                                                                
         L     RE,ANOTREC                                                       
         USING MNKEY,RE                                                         
         LA    R2,MNRFRST                                                       
         LA    RF,MNRSTAT          RF = A(SPOT CONTROL BYTE)                    
*                                                                               
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JNZ   NXTOMN42             NO                                          
         LA    R2,MNXFRST                                                       
         LA    RF,MNXRSTAT         RF = A(X-SPOT CONTROL BYTE)                  
*                                                                               
NXTOMN42 OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JNZ   NXTOMN60             NO                                          
         OC    MNXKSTTN,MNXKSTTN   THE NOTICE STATUS RECORD?                    
         JZ    NXTOMN60             YES                                         
*                                                                               
         TM    0(RF),X'80'         IS NOTICE NON-STATUS REC DELETED?            
         JZ    NXTOMN60             NO, SHOW THE DETAILS                        
*                                                                               
         CLI   SVMNSTAT,MNSTCAN    WAS THE NOTICE STATUS CANCELLED?             
         JE    NXTOMN60             YES, SHOW THE DETAILS                       
         MVC   SVNOTKEY(L'MNXKEY),IOKEY                                         
         J     NXTOMN14             NO, SKIP NTWK BUT NOT MKGD GRP              
         DROP  RE                                                               
****                                                                            
* WE ARE HERE BECAUSE WE ARE SKIPPING THE MAKEGOOD GROUP                        
****                                                                            
NXTOMN54 XC    NOTVALS(NOTVALL),NOTVALS                                         
         LA    R2,IOKEY                                                         
         USING MNKEY,R2                                                         
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JZ    NXTOMN35             YES, READ THE NEXT GROUP                    
*                                                                               
NXTOMN56 GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IODIR+B#NOTREC'                        
         JE    NXTOMN10                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         J     NXTOMN10             DELETE IS OK                                
         DROP  R2                                                               
***                                                                             
* PROCESS THE MAKEGOOD                                                          
***                                                                             
NXTOMN60 L     R2,ANOTREC                                                       
         USING MNKEY,R2            READ FIRST NOTICE RECORD                     
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JZ    NXTOMN62            YES                                          
*                                                                               
         MVC   SVNOTKEY(L'MNKEY),MNKEY   SAVE KEY OF NOTICE RECORD              
         MVC   ORDAM,MNKAGMD       SET THESE AS WE MIGHT HAVE USE D/A           
         MVC   ORDORDER,MNKORDER                                                
         MVC   NOTGROUP,MNKGROUP                                                
         MVC   NOTSTAT2,MNRSTAT2                                                
         MVC   NOTDA,IODA          SET RECORD DISK ADDRESS                      
         GOTOR GETSUM,NOTCKSM      SET RECORD CHECK SUM                         
         LA    R2,MNRFRST                                                       
         J     NXTOMN68                                                         
*                                                                               
NXTOMN62 MVC   SVNOTKEY(L'MNXKEY),MNXKEY SAVE KEY OF NOTICE RECORD              
*                                                                               
         OC    MNXKSTTN,MNXKSTTN   NETWORK LVL NOTICE RECORDS?                  
         JNZ   NXTOMN64             YES, SKIP THIS, IT WAS SET ON THE           
*                                     BASE NOTICE GROUP RECORD                  
         L     RE,AIO8             CLEAR THE LIST OF NETWORKS                   
         LHI   RF,IO8LQ                                                         
         XCEFL                                                                  
         XC    NUMMNWKS,NUMMNWKS                                                
         XC    NUMONWKS,NUMONWKS                                                
*                                                                               
         MVC   ORDAM,MNXKAGMD      SET THESE AS WE MIGHT HAVE USE D/A           
         MVC   ORDORDER,MNXKORDR                                                
         MVC   NOTGROUP,MNXKGRP                                                 
         MVC   NOTSTAT2,MNXRLINK   WHY DID IT GET 2 BYTES FROM SPTFIL?          
         MVC   NOTDA,IODA          SET RECORD DISK ADDRESS                      
         MVI   NOTFILE,C'X'        D/A for XSPFIL                               
*                                                                               
         GOTOR GETXSUM,NOTCKSM     SET RECORD CHECK SUM FOR XSPFIL REC          
         J     NXTOMN66                                                         
*                                  ADD NETWORK TO LIST OF MISSED                
NXTOMN64 CLC   MNXRLEN,=X'002A'    EMPTY RECORD?                                
         JE    NXTOMN14             YES, SKIP NETWORK BUT NOT GROUP             
         GOTOR ADDNTWK,DMCB,(C'M',MNXKSTTN)                                     
*                                                                               
NXTOMN66 LA    R2,MNXFRST                                                       
         USING MNSTELD,R2                                                       
NXTOMN68 CLI   MNSTEL,EOR          TEST END OF RECORD OF MAKEGOOD               
         JE    NXTOMN77            EOR, NO MORE ELEMS                           
         CLI   MNSTEL,MNSTELQ      TEST STATUS ELEMENT                          
         JE    NXTOMN72                                                         
         CLI   MNSTEL,MNMSELQ      TEST MISSED BUYLINE ELEMENT                  
         JE    NXTOMN76                                                         
NXTOMN70 LLC   R0,MNSTLEN          BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         J     NXTOMN68                                                         
                                                                                
NXTOMN72 MVC   NOTCDATE,MNSTDATE   LAST MNSTELQ HAS CREATION DATE/TIME          
         MVC   NOTCTIME,MNSTTIME                                                
*                                                                               
         OC    NOTDATE,NOTDATE     TEST NOT FIRST TIME                          
         JNZ   NXTOMN70                                                         
         MVC   NOTDATE,MNSTDATE    GET DATE/TIME/STATUS FROM 1ST ELEM           
         MVC   NOTTIME,MNSTTIME                                                 
         MVC   NOTSTAT(L'MNSTSTAT),MNSTSTAT                                     
*                                                                               
         CLI   MNSTSTAT,MNSTDELV   WE HAVE A DELIVERED STATUS?                  
         JNE   NXTOMN73                                                         
         LLC   R1,MNSTLEN                                                       
         LA    RE,0(R2,R1)                                                      
         CLI   0(RE),MNSTELQ       YES, FIND OUT WHAT WAS DELIVERED             
         JNE   NXTOMN73                                                         
         LR    R2,RE                                                            
         MVC   NOTSTAT+1(L'MNSTSTAT),MNSTSTAT                                   
*                                                                               
NXTOMN73 MVC   SVMNSTAT,MNSTSTAT                                                
*                                                                               
         CLC   LP_QMAPN,SDMGED#    PENDING MKGD APPLY DOWNLOAD?                 
         JNE   NXTOMN70                                                         
         CLI   MNSTSTAT,MNSTHOLD   C'H' - ON HOLD                               
         JE    NXTOMN70             YES                                         
         CLI   MNSTSTAT,MNSTGOIN   C'G' - GOING TO BE OKAYED                    
         JE    NXTOMN70             YES,                                        
         J     NXTOMN54            NO, ONLY WANT PENDING APPLIES                
         DROP  R2                                                               
                                                                                
         USING MNMSELD,R2                                                       
NXTOMN76 OC    NOTFMIS,NOTFMIS     TEST FIRST MISSED DATE SET                   
         JZ    *+14                                                             
         CLC   MNMSBDAT,NOTFMIS    YES - IS THIS THE LOWEST?                    
         JH    NXTOMN70                                                         
         MVC   NOTFMIS,MNMSBDAT    SAVE FIRST (LOWEST) MISSED DATE              
         J     NXTOMN70                                                         
         DROP  R2                                                               
*                                                                               
NXTOMN77 CLI   SVMNSTAT,0          MAKEGOOD HAS NO STATUS?                      
         JE    NXTOMN54             YES, SKIP THE MKGD GROUP                    
         L     R2,ANOTREC                                                       
         USING MNKEY,R2                                                         
         LA    RF,MNRSTAT          RF = A(SPOT CONTROL BYTE)                    
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JNZ   NXTOMN78             NO                                          
         OC    MNXKSTTN,MNXKSTTN   THE NOTICE STATUS RECORD?                    
         JNZ   NXTOMN79             NO                                          
         LA    RF,MNXRSTAT         RF = A(X-SPOT CONTROL BYTE)                  
NXTOMN78 TM    0(RF),X'80'         IS NOTICE DELETED?                           
         JZ    NXTOMN79             NO, SHOW THE DETAILS                        
         CLI   SVMNSTAT,MNSTOKAY   OKAYED STATUS?                               
         JE    NXTOMN54             YES, SKIP THE MKGD GROUP                    
         DROP  R2                                                               
*                                                                               
* FOR SEARCH/SUBSCRIPTION DOWNLOAD                                              
*  IF BROADCAST, GO AND READ THE OFFER RECORD,                                  
*  O/W IF CABLE, MAKE SURE TO READ ALL MISSED NTWKS TO BLD MISSED NTWK          
*  LIST, THEN READ ALL OFFER NTWKS TO BLD OFFER NTWK LIST                       
*                                                                               
NXTOMN79 CLC   LP_QMAPN,SDSODD#    SEARCH?                                      
         JE    NXOMN79A                                                         
         CLC   LP_QMAPN,SDSOLD#    SUBSCRIPTION?                                
         JNE   NXTOMNYS                                                         
*                                                                               
NXOMN79A L     R2,ANOTREC                                                       
         USING MNKEY,R2                                                         
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JNZ   NXTOMN90            BRDCST MKGD ONLY HAS 1 NOTICE RC             
********                                                                        
* READ CABLE/X-SPOT-FILE MAKEGOOD NOTICE RECORDS                                
********                                                                        
         LA    R2,IOKEY            BUT MAKE SURE FOR THE SAME GRP               
         GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#NOTREC'                     
         JE    NXOMN79B                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*    CHECK IF WE HAVE MORE NOTICE RECORDS FOR THIS CABLE MKGD GROUP             
NXOMN79B CLC   MNXKEY(MNXKSTTN-MNXKEY),IOKEYSAV                                 
         JE    NXTOMN38            WE HAVE MORE                                 
********                                                                        
* READ CABLE/X-SPOT-FILE MAKEGOOD OFFER RECORDS                                 
********                                                                        
         USING MOXKEY,R2           R2=A(CABLE MKGD OFFER KEY)                   
         XC    MOXKEY,MOXKEY                                                    
         MVI   MOXKTYPE,MOXKTYPQ   X'0D' - TYPE EQUATE                          
         MVI   MOXKSBTY,MOXKSBTQ   X'37' - SUBTYPE EQUATE                       
         MVC   MOXKAGMD,ORDAM                                                   
         MVC   MOXKORDR,ORDORDER                                                
         MVC   MOXKMGCD,NOTGROUP                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IOXSPDIR+B#OFFREC'                     
         JE    NXTOMN80                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                  NO, ANY OTHER ERROR, DIE                    
*                                                                               
NXTOMN80 GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#OFFREC'                     
         JE    NXTOMN82                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
NXTOMN82 L     R2,AOFFREC                                                       
         OC    MOXKSTTN,MOXKSTTN   STATION OFFER RECORD?                        
         JZ    NXTOMN83                                                         
*                                  ADD NETWORK TO LIST OF OFFERED               
         CLC   MOXRLEN,=X'002A'    EMPTY RECORD?                                
         JE    NXTOMN86             SKIP IT                                     
         GOTOR ADDNTWK,DMCB,(C'O',MOXKSTTN)                                     
*                                                                               
NXTOMN83 LA    R2,MOXFRST                                                       
         USING MOBDELD,R2                                                       
NXTOMN84 CLI   MOBDEL,EOR          TEST END OF RECORD                           
         JE    NXTOMN86                                                         
         CLI   MOBDEL,MOBDELQ      TEST MAKEGOOD BUY DETAIL                     
         JNE   NXTOMN85                                                         
         OC    NOTFOFF,NOTFOFF     TEST FIRST OFFER DATE SET                    
         JZ    *+14                                                             
         CLC   MOBDBDAT,NOTFOFF    YES - IS THIS THE LOWEST                     
         JH    NXTOMN85                                                         
         MVC   NOTFOFF,MOBDBDAT    SAVE FIRST (LOWEST) OFFER DATE               
*                                                                               
NXTOMN85 LLC   R0,MOBDLEN          BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         J     NXTOMN84                                                         
         DROP  R2                                                               
*                                                                               
NXTOMN86 LA    R2,IOKEY            BUT MAKE SURE FOR THE SAME GRP               
         USING MOXKEY,R2                                                        
NXOMN86B GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#OFFREC'                     
         JE    NXOMN86D                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JO    NXOMN86B             SKIP IT                                     
         DC    H'0'                                                             
*    CHECK IF WE HAVE MORE OFFER RECORDS FOR THIS CABLE MKGD GROUP              
NXOMN86D CLC   MOXKEY(MOXKSTTN-MOXKEY),IOKEYSAV                                 
         JE    NXTOMN80            WE HAVE MORE FOR THIS GROUP                  
*                                                                               
         CLC   LP_QMAPN,SDSODD#    ARE WE SEARCHING?                            
         JNE   NXTOMNYS            NO                                           
         CLC   REQNTWK,SPACES      ANY REQUESTED NETWORK?                       
         JNH   NXTOMNYS            NONE                                         
*                                                                               
         XR    R1,R1                                                            
         ICM   R1,3,NUMMNWKS       ANY MISSED NETWORKS IN THIS GROUP?           
         JZ    NXTOMN88            NONE, MAYBE WE HAVE IN OFFERED LIST          
         L     RE,AIO8                                                          
         LA    RE,1(RE)                                                         
*                                                                               
NXOMN86L CLC   REQNTWK,0(RE)       FOUND THE REQUESTED NETWORK?                 
         JE    NXTOMNYS            YES, WE WANT THIS MAKEGOOD GROUP             
         LA    RE,L'REQNTWK(RE)    NO, CHECK ALL NETWORKS IN THIS LIST          
         JCT   R1,NXOMN86L                                                      
*                                                                               
NXTOMN88 XR    R1,R1               NOT IN MISSED, ANY OFFERED?                  
         ICM   R1,3,NUMONWKS       ANY MISSED NETWORKS IN THIS GROUP?           
         JZ    NXTOMN14            NONE, REQ NETWORK NOT IN THIS GROUP          
*                                                                               
         L     RE,AIO8             OFFERED LIST IS 1000 FROM BEG(AIO8)          
         AHI   RE,1001             FIRST BYTE IS RESERVED                       
*                                                                               
NXOMN88L CLC   REQNTWK,0(RE)       FOUND THE REQUESTED NETWORK?                 
         JE    NXTOMNYS            YES, WE WANT THIS MAKEGOOD GROUP             
         LA    RE,L'REQNTWK(RE)    NO, CHECK ALL NETWORKS IN THIS LIST          
         JCT   R1,NXOMN88L                                                      
*                                                                               
         J     NXTOMN14            NONE, REQ NETWORK NOT IN THIS GROUP          
*                                                                               
********                                                                        
* READ BROADCAAST/SPOT-FILE MAKEGOOD OFFER RECORDS                              
********                                                                        
NXTOMN90 LA    R2,IOKEY                                                         
         USING DAREMGOD,R2         R2=A(MAKEGOOD OFFER KEY)                     
         XC    MOKEY,MOKEY                                                      
         MVI   MOKTYPE,MOKTYPQ                                                  
         MVI   MOKSUBTY,MOKSTYPQ                                                
         MVC   MOKAGMD,ORDAM                                                    
         MVC   MOKORDER,ORDORDER                                                
         MVC   MOKMGCD,NOTGROUP                                                 
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IODIR+B#OFFREC'                        
         TM    IOERR,IOERNF        OFFER RECORD NOT FOUND?                      
         JZ    NXTOMN93                                                         
*                                  SOMETHING WRONG WITH THIS GROUP              
         MVC   IOKEY,SVNOTKEY      RESTORE NOTICE KEY SEQ                       
         GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IODIR+B#NOTREC'                        
         J     NXTOMN54                                                         
*                                                                               
NXTOMN93 GOTOR GETOFF              READ OFFER RECORD(S)                         
*                                                                               
         L     R2,AOFFREC                                                       
         LA    R2,MORFRST                                                       
         USING MOBDELD,R2                                                       
NXTOMN96 CLI   MOBDEL,EOR          TEST END OF RECORD                           
         JE    NXTOMNYS                                                         
         CLI   MOBDEL,MOBDELQ      TEST MAKEGOOD BUY DETAIL                     
         JNE   NXTOMN99                                                         
         OC    NOTFOFF,NOTFOFF     TEST FIRST OFFER DATE SET                    
         JZ    *+14                                                             
         CLC   MOBDBDAT,NOTFOFF    YES - IS THIS THE LOWEST                     
         JH    NXTOMN99                                                         
         MVC   NOTFOFF,MOBDBDAT    SAVE FIRST (LOWEST) OFFER DATE               
*                                                                               
NXTOMN99 LLC   R0,MOBDLEN          BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         J     NXTOMN96                                                         
         DROP  R2                                                               
*                                                                               
NXTOMNYS B     MORE                TELL DDLINK THERE IS MORE TO COME            
*                                                                               
NXTOMNN  MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     NOMORE                                                           
         EJECT                                                                  
***********************************************************************         
* ARRAY DEFINITION FOR REJECTION COMMENT DOWNLOAD                     *         
***********************************************************************         
                                                                                
ARYRCM   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=Y,EOT=EOR,                 +        
               ROWID=(MNMRJCD,MNMRJCQ),ROWWIDTH=(V,MNMRLEN)                     
                                                                                
CText    LKOUT C,0,MNMRTEXT,CHAR,MAPMOD=*,LEN=V                                 
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR REJECTION COMMENT DOWNLOAD                     *         
***********************************************************************         
                                                                                
AXYRCM   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=Y,EOT=EOR,                 +        
               ROWID=(MNMRJCD,MNMRJCQ),ROWWIDTH=(V,MNMRLEN)                     
                                                                                
CText    LKOUT C,0,MNMRTEXT,CHAR,MAPMOD=*,LEN=V                                 
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR PREVIOUS REJECTION COMMENT DOWNLOAD            *         
***********************************************************************         
ARYPRC   LKOUT A,(R,NXTPRC),MULTIROW=Y,ROWNAME=DAREMGCD                         
Array    LKOUT C,X'008D',(A,ARYPRC2)                                            
         LKOUT E                                                                
                                                                                
ARYPRC2  LKOUT A,(D,B#NOTRJC,MCXFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MCMRJCD,MCMRJCQ),ROWWIDTH=(V,MCMRJLEN),          +        
               SETFILT=(MCMRJDAT,L'MCMRJDAT+L'MCMRJTIM)                         
                                                                                
Rdate    LKOUT C,1,MCMRJDAT,JDAT,ND=Y                                           
Rtime    LKOUT C,2,MCMRJTIM,(R,EDTTIME)                                         
CText    LKOUT C,3,MCMRJTXT,CHAR,LEN=V                                          
Array    LKOUT C,255,(A,ARYPRC3)                                                
         LKOUT E                                                                
*                                                                               
ARYPRC3  LKOUT A,(D,B#NOTRJC,MCXFRST),EOT=EOR,                         +        
               ROWID=(MCMRJCD,MCMRJCQ2),ROWWIDTH=(V,MCMRJLEN),         +        
               TESTFILT=(MCMRJDAT,L'MCMRJDAT+L'MCMRJTIM)                        
CText    LKOUT C,3,MCMRJTXT,CHAR,MAPMOD=*,LEN=V                                 
                                                                                
         LKOUT E                                                                
*                                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MISSED SPOT COMMENTS                           *         
***********************************************************************         
                                                                                
ARYMSC   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=Y,EOT=EOR,                 +        
               ROWID=(MNMCELD,MNMCELQ),ROWWIDTH=(V,MNMCLEN)                     
                                                                                
Offer    LKOUT C,1,MNMCOFFR,UBIN,ND=Y                                           
RecNo    LKOUT C,2,MNMCREC,UBIN,ND=Y                                            
CLin#    LKOUT C,3,MNMCLINE,UBIN,ND=Y                                           
CText    LKOUT C,4,MNMCTEXT,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED SPOT COMMENTS                           *         
***********************************************************************         
                                                                                
AXYMSC   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=Y,EOT=EOR,                 +        
               ROWID=(MNMCELD,MNMCELQ),ROWWIDTH=(V,MNMCLEN)                     
                                                                                
Offer    LKOUT C,1,MNMCOFFR,UBIN,ND=Y                                           
RecNo    LKOUT C,2,MNMCREC,UBIN,ND=Y                                            
CLin#    LKOUT C,3,MNMCLINE,UBIN,ND=Y                                           
CText    LKOUT C,4,MNMCTEXT,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED SPOT ORBIT DESCRIPTION                  *         
***********************************************************************         
                                                                                
ARYMSO   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=Y,EOT=EOR,                 +        
               ROWID=(MNMOELD,MNMOELQ),ROWWIDTH=(V,MNMOLEN)                     
                                                                                
Offer    LKOUT C,1,MNMOOFFR,UBIN,ND=Y                                           
RecNo    LKOUT C,2,MNMOREC,UBIN,ND=Y                                            
SDays    LKOUT C,3,MNMODAYS,UBIN,ND=Y                                           
StDay    LKOUT C,4,MNMOSDAY,UBIN,ND=Y                                           
STime    LKOUT C,5,MNMOSTIM,UBIN,ND=Y                                           
ETime    LKOUT C,6,MNMOETIM,UBIN,ND=Y                                           
ProgN    LKOUT C,7,MNMOPROG,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED SPOT ORBIT DESCRIPTION                  *         
***********************************************************************         
                                                                                
AXYMSO   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=Y,EOT=EOR,                 +        
               ROWID=(MNMOELD,MNMOELQ),ROWWIDTH=(V,MNMOLEN)                     
                                                                                
Offer    LKOUT C,1,MNMOOFFR,UBIN,ND=Y                                           
RecNo    LKOUT C,2,MNMOREC,UBIN,ND=Y                                            
SDays    LKOUT C,3,MNMODAYS,UBIN,ND=Y                                           
StDay    LKOUT C,4,MNMOSDAY,UBIN,ND=Y                                           
STime    LKOUT C,5,MNMOSTIM,UBIN,ND=Y                                           
ETime    LKOUT C,6,MNMOETIM,UBIN,ND=Y                                           
ProgN    LKOUT C,7,MNMOPROG,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED BUYLINE COMMENT                         *         
***********************************************************************         
                                                                                
ARYMBC   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNMBCELD,MNMBCELQ),ROWWIDTH=(V,MNMBCLEN)                  
                                                                                
BLine    LKOUT C,1,MNMBCBUY,UBIN,ND=Y                                           
CLin#    LKOUT C,2,MNMBCLIN,UBIN,ND=Y                                           
CText    LKOUT C,3,MNMBCTXT,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED BUYLINE COMMENT                         *         
***********************************************************************         
                                                                                
AXYMBC   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNMBCELD,MNMBCELQ),ROWWIDTH=(V,MNMBCLEN)                  
                                                                                
BLine    LKOUT C,1,MNMBCBUY,UBIN,ND=Y                                           
CLin#    LKOUT C,2,MNMBCLIN,UBIN,ND=Y                                           
CText    LKOUT C,3,MNMBCTXT,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED BUYLINE DETAILS                         *         
***********************************************************************         
                                                                                
ARYXBD   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNMSELD,MNMSELQ),ROWWIDTH=(V,MNMSLEN),           +        
               SETFILT=(MNMSSEQN,L'MNMSSEQN)                                    
                                                                                
SeqNo    LKOUT C,1,MNMSSEQN,UBIN,ND=Y                                           
BDays    LKOUT C,2,MNMSDAYS,UBIN,ND=Y                                           
OOWSD    LKOUT C,3,MNMSOROT,UBIN,ND=Y                                           
STime    LKOUT C,4,MNMSSTIM,UBIN,ND=Y                                           
ETime    LKOUT C,5,MNMSETIM,UBIN,ND=Y                                           
Tsecs    LKOUT C,6,MNMSTSLN,UBIN,ND=Y                                           
BCost    LKOUT C,7,MNMSCOST,UBIN,ND=Y                                           
2BLin#   LKOUT C,8,MNMSBLN2,UBIN,ND=Y                                           
BLin#    LKOUT C,8,MNMSBLIN,UBIN,ND=Y,FILTROUT=TSTBLN2                          
BDate    LKOUT C,9,MNMSBDAT,JDAT,ND=Y                                           
BSpot    LKOUT C,10,MNMSNSPT,LBIN,ND=Y                                          
ProgN    LKOUT C,11,MNMSTEXT,CHAR,ND=Y,LEN=V                                    
Array    LKOUT C,255,(A,ARYMUUI)                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD MISSED UUID                                     
***********************************************************************         
                                                                                
ARYMUUI  LKOUT A,(D,B#NOTREC,MNRFRST),EOT=EOR,                         +        
               ROWID=(MNMSAAUD,MNMSAELQ),ROWWIDTH=(V,MNMSALEN),        +        
               TESTFILT=(MNMSAREC,L'MNMSAREC)                                   
                                                                                
UUIDTX   LKOUT C,20,MNMSAAU,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MISSED BUYLINE DETAILS                         *         
***********************************************************************         
                                                                                
AXYXBD   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNMSELD,MNMSELQ),ROWWIDTH=(V,MNMSLEN),           +        
               SETFILT=(MNMSSEQN,L'MNMSSEQN)                                    
                                                                                
Array    LKOUT P,,STNOTSTA                                                      
SeqNo    LKOUT C,1,MNMSSEQN,UBIN,ND=Y                                           
BDays    LKOUT C,2,MNMSDAYS,UBIN,ND=Y                                           
OOWSD    LKOUT C,3,MNMSOROT,UBIN,ND=Y                                           
STime    LKOUT C,4,MNMSSTIM,UBIN,ND=Y                                           
ETime    LKOUT C,5,MNMSETIM,UBIN,ND=Y                                           
Tsecs    LKOUT C,6,MNMSTSLN,UBIN,ND=Y                                           
BCost    LKOUT C,7,MNMSCOST,UBIN,ND=Y                                           
2BLin#   LKOUT C,8,MNMSBLN2,UBIN,ND=Y                                           
BLin#    LKOUT C,8,MNMSBLIN,UBIN,ND=Y,FILTROUT=TSTBLN2                          
BDate    LKOUT C,9,MNMSBDAT,JDAT,ND=Y                                           
BSpot    LKOUT C,10,MNMSNSPT,LBIN,ND=Y                                          
ProgN    LKOUT C,11,MNMSTEXT,CHAR,ND=Y,LEN=V                                    
Statn    LKOUT C,12,(D,B#SAVED,NOTSTATN),(R,ED2STA),ND=Y                        
Array    LKOUT C,255,(A,AXYMUUI)                                                
                                                                                
         LKOUT E                                                                
                                                                                
TSTBLN2  L     RF,LP_AINP          TEST USING 2-BYTE BUYLINE                    
         CLC   MNMSBLN2-MNMSELD(L'MNMSBLN2,RF),BZEROS                           
         BR    RE                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD MISSED UUID                                     
***********************************************************************         
                                                                                
AXYMUUI  LKOUT A,(D,B#NOTREC,MNXFRST),EOT=EOR,                         +        
               ROWID=(MNMSAAUD,MNMSAELQ),ROWWIDTH=(V,MNMSALEN),        +        
               TESTFILT=(MNMSAREC,L'MNMSAREC)                                   
                                                                                
UUIDTX   LKOUT C,20,MNMSAAU,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD NOTICE HEADER                         *         
***********************************************************************         
                                                                                
ARYMNH   LKOUT A,(D,B#SAVED,NOTVALS),NEWEL=Y,NROWS=1,ROWWIDTH=NOTVALL           
                                                                                
Group    LKOUT C,1,NOTGROUP,CHAR,ND=Y,FILTROUT=TSTNSMGE,SKIPCOLS=4              
RecDA    LKOUT C,2,NOTDA,HEXD,ND=Y                                              
ChkSm    LKOUT C,3,NOTCKSM,HEXD,ND=Y                                            
PCKey    LKOUT C,4,(D,B#SAVED,PCKEYORD),CHAR,ND=Y                               
NtSta    LKOUT C,5,NOTSTAT2,HEXD,ND=Y                                           
****FileInd  LKOUT C,6,NOTFILE,CHAR,FILTROUT=TSTCABLE,ND=Y                      
*                                                                               
Group    LKOUT C,1,NOTGROUP,CHAR,ND=Y,FILTROUT=TSTSDMGE,SKIPCOLS=5              
Gstat    LKOUT C,2,NOTSTAT,CHAR,ND=Y                                            
SDate    LKOUT C,3,NOTDATE,JDAT,ND=Y                                            
STime    LKOUT C,4,NOTTIME,(R,EDTTIME)                                          
RecDA    LKOUT C,5,NOTDA,HEXD,ND=Y                                              
ChkSm    LKOUT C,6,NOTCKSM,HEXD,ND=Y                                            
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD STATUS ELEMENT                                  
***********************************************************************         
                                                                                
ARYMNI   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNIFELD,MNIFELQ),ROWWIDTH=(V,MNIFLEN)                     
                                                                                
MNFlag   LKOUT C,1,MNIFFLG1,HEXD                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD STATUS ELEMENT                                  
***********************************************************************         
                                                                                
AXYMNI   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNIFELD,MNIFELQ),ROWWIDTH=(V,MNIFLEN)                     
                                                                                
MNFlag   LKOUT C,1,MNIFFLG1,HEXD                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD STATUS ELEMENT                                  
***********************************************************************         
                                                                                
ARYMNS   LKOUT A,(D,B#NOTREC,MNRFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNSTELD,MNSTELQ),ROWWIDTH=(V,MNSTLEN)                     
                                                                                
Stats    LKOUT C,1,MNSTSTAT,CHAR                                                
SDate    LKOUT C,2,MNSTDATE,JDAT                                                
STime    LKOUT C,3,MNSTTIME,(R,EDTTIME)                                         
Error    LKOUT C,4,MNSTERRN,LBIN,,ROWID=(MNSTLEN,MNSTELNQ),ND=Y                 
StFlag   LKOUT C,5,MNSTFLAG,HEXD,ROWID=(MNSTLEN,MNSTFLNQ),             +        
               PCVERSION=4.7.0.132,ND=Y                                         
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD STATUS ELEMENT                                  
***********************************************************************         
                                                                                
AXYMNS   LKOUT A,(D,B#NOTREC,MNXFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MNSTELD,MNSTELQ),ROWWIDTH=(V,MNSTLEN)                     
                                                                                
Stats    LKOUT C,1,MNSTSTAT,CHAR                                                
SDate    LKOUT C,2,MNSTDATE,JDAT                                                
STime    LKOUT C,3,MNSTTIME,(R,EDTTIME)                                         
Error    LKOUT C,4,MNSTERRN,LBIN,,ROWID=(MNSTLEN,MNSTELNQ),ND=Y                 
StFlag   LKOUT C,5,MNSTFLAG,HEXD,ROWID=(MNSTLEN,MNSTFLNQ),             +        
               PCVERSION=4.7.0.132,ND=Y                                         
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD OFFER DOWNLOAD                        *         
***********************************************************************         
                                                                                
ARYOMO   LKOUT A,(R,NXTOFF),MULTIROW=Y,ROWNAME=DAREMGOD                         
                                                                                
Array    LKOUT C,255,(A,ARYMOF)                                                 
                                                                                
         LKOUT E                                                                
                                                                                
ARYMOF   LKOUT A,(D,B#SAVED,NOTVALS),NEWEL=Y,NROWS=1                            
Array    LKOUT C,255,(A,ARYBMOF),FILTROUT=TSTBRDCS                              
Array    LKOUT C,255,(A,ARYCMOF),FILTROUT=TSTCABLE,PCVERSION=4.5.0.0            
         LKOUT E                                                                
                                                                                
ARYBMOF  LKOUT A,(D,B#SAVED,NOTVALS),NEWEL=Y,NROWS=1                            
Array    LKOUT C,X'008C',(A,ARYMGH)                                             
Array    LKOUT C,X'008E',(A,ARYMGO),FILTROUT=TSTOBUY                            
         LKOUT E                                                                
                                                                                
ARYCMOF  LKOUT A,(D,B#SAVED,NOTVALS),NEWEL=Y,NROWS=1                            
Array    LKOUT C,X'008C',(A,ARYMGH)                                             
Array    LKOUT C,X'008E',(A,AXYMGO),FILTROUT=TSTOBUY                            
         LKOUT E                                                                
                                                                                
TSTOBUY  TM    MAPI2,MAPIOBUY      TEST D/L OFFER BUY DETAILS                   
         B     SETCCC                                                           
                                                                                
***********************************************************************         
* READ DARE MKGD OFFER RECORDS - IO3 CONTAINS MKGD NOTICE RECORD                
***********************************************************************         
                                                                                
NXTOFF   LA    R2,IOKEY                                                         
         USING DAREMGOD,R2         RE=A(MAKEGOOD KEY)                           
         L     R3,AIO3                                                          
         USING DAREMGND,R3         RF=A(NOTICE RECORD)                          
*                                                                               
         CLI   LP_RMODE,LP_RFRST   FIRST TIME IN?                               
         JE    NXTOFF05             YES                                         
         OC    MNXKSPAR,MNXKSPAR    NO, CABLE?                                  
         JZ    NXTOFF20              YES, GO GET NEXT REC                       
         J     NOMORE                O/W, EXIT WITH NOMORE                      
*                                                                               
NXTOFF05 XC    IOKEY,IOKEY                                                      
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JZ    NXTOFF10            YES                                          
*                                                                               
         MVI   MOKTYPE,MOKTYPQ                                                  
         MVI   MOKSUBTY,MOKSTYPQ                                                
         MVC   MOKAGMD,MNKAGMD                                                  
         MVC   MOKORDER,MNKORDER                                                
         MVC   MOKMGCD,MNKGROUP                                                 
         GOTOR GETOFF              READ OFFER RECORDS                           
         MVC   LP_ADATA,AOFFREC    SET A(OFFER RECORD)                          
         J     EXITY                                                            
*                                                                               
NXTOFF10 DS    0H                                                               
         MVI   MOXKTYPE,MOXKTYPQ   X'0D' - TYPE EQUATE                          
         MVI   MOXKSBTY,MOXKSBTQ   X'37' - SUBTYPE EQUATE                       
         MVC   MOXKAGMD,MNXKAGMD                                                
         MVC   MOXKORDR,MNXKORDR                                                
         MVC   MOXKMGCD,MNXKGRP                                                 
*                                                                               
NXTOFF20 GOTOR GETXOFF                                                          
         JNE   NOMORE                                                           
         MVC   LP_ADATA,AOFFREC    SET A(OFFER RECORD)                          
         J     EXITY                                                            
*                                                                               
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* READ REJECTION COMMENT RECORDS - IO3 CONTAINS MKGD NOTICE RECORD              
***********************************************************************         
                                                                                
NXTPRC   DS    0H                                                               
         LA    R2,IOKEY                                                         
         USING DAREMGCD,R2         RE=A(MAKEGOOD KEY)                           
         L     R3,AIO3                                                          
         USING DAREMGND,R3         RF=A(NOTICE RECORD)                          
*                                                                               
         CLI   LP_RMODE,LP_RFRST   FIRST TIME IN?                               
         JNE   NXTPRC30                                                         
*        MVC   SVIOVALS,IOVALS                                                  
*                                                                               
         CLI   ORDSTAX,X'E8'       CABLE STATION?                               
         JNL   NXTPRC10                                                         
                                                                                
         XC    IOKEY,IOKEY                                                      
         MVI   MCXKTYPE,MCXKTYPQ   X'0D' - TYPE EQUATE                          
         MVI   MCXKSBTY,MCXKSBTQ   X'3B' - SUBTYPE EQUATE                       
         MVC   MCXKAGMD,MNKAGMD                                                 
         MVC   MCXKORDR,MNKORDER                                                
         MVC   MCXKGRP,MNKGROUP                                                 
         J     NXTPRC20                                                         
                                                                                
NXTPRC10 XC    IOKEY,IOKEY         CABLE STATION                                
         MVI   MCXKTYPE,MCXKTYPQ   X'0D' - TYPE EQUATE                          
         MVI   MCXKSBTY,MCXKSBTQ   X'3B' - SUBTYPE EQUATE                       
         MVC   MCXKAGMD,MNXKAGMD                                                
         MVC   MCXKORDR,MNXKORDR                                                
         MVC   MCXKGRP,MNXKGRP                                                  
*                                                                               
NXTPRC20 GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IOXSPDIR+B#NOTRJC'                     
         J     NXTPRC40                                                         
*                                                                               
NXTPRC30 GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#NOTRJC'                     
NXTPRC40 JE    NXTPRC50                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
NXTPRC50 CLC   IOKEY(MCXKDTYP-MCXKEY),IOKEYSAV                                  
         JNE   NXTPRCNM                                                         
*                                                                               
NXTPRC60 GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#NOTRJC'                     
         JE    NXTPRC70                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
NXTPRC70 MVC   LP_ADATA,ANOTRJC    SET A(REJ COMMENT RECORD)                    
         J     MORE                                                             
*                                                                               
NXTPRCNM DS    0H                                                               
*        MVC   IOVALS,SVIOVALS                                                  
         J     NOMORE                                                           
         DROP  R2,R3                                                            
         EJECT                                                                  
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD HEADER DOWNLOAD                       *         
***********************************************************************         
                                                                                
ARYMGH   LKOUT A,(D,B#SAVED,OFFVALS),NEWEL=Y,NROWS=1,ROWWIDTH=OFFVALL, +        
               ROWNAME=OFFVALS                                                  
                                                                                
Array    LKOUT C,255,(A,ARYMGC),FILTROUT=TSTBRDCS,SKIPCOLS=4                    
RecDa    LKOUT C,3,OFFDA1,HEXD,ND=Y                                             
ChkSm    LKOUT C,4,OFFCKSM1,HEXD,ND=Y                                           
RecDa    LKOUT C,5,OFFDA2,HEXD,ND=Y                                             
ChkSm    LKOUT C,6,OFFCKSM2,HEXD,ND=Y                                           
*                                                                               
Array    LKOUT C,255,(A,AXYMGC),FILTROUT=TSTCBMNH,SKIPCOLS=4                    
RecDa    LKOUT C,3,OFFDA1,HEXD,ND=Y                                             
ChkSm    LKOUT C,4,OFFCKSM1,HEXD,ND=Y                                           
RecDa    LKOUT C,5,OFFDA2,HEXD,ND=Y                                             
ChkSm    LKOUT C,6,OFFCKSM2,HEXD,ND=Y                                           
                                                                                
         LKOUT E                                                                
                                                                                
TSTCBMNH CLI   ORDBSTA,X'E8'       TEST FOR CABLE STATION                       
         BL    EXITN               NO, IT ISN'T                                 
         L     R6,AOFFREC                                                       
         OC    MOXKSTTN-MOXKEY(L'MOXKSTTN,R6),MOXKSTTN-MOXKEY(R6)               
         BZ    EXITY               YES, IT IS                                   
         B     EXITN                                                            
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DOWNLOAD                          *         
***********************************************************************         
                                                                                
ARYMGO   LKOUT A,(D,B#OFFREC,MORFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MOMBELD,MOMBELQ),ROWWIDTH=(V,MOMBLEN),           +        
               SETFILT=(MOMBOFFR,L'MOMBOFFR+L'MOMBREC)                          
                                                                                
Offer    LKOUT C,1,MOMBOFFR,UBIN,ND=Y                                           
RecNo    LKOUT C,2,MOMBREC,UBIN,ND=Y                                            
BDays    LKOUT C,3,MOMBDAYS,UBIN,ND=Y                                           
OOWSD    LKOUT C,4,MOMBOROT,UBIN,ND=Y                                           
STime    LKOUT C,5,MOMBSTIM,UBIN,ND=Y                                           
Etime    LKOUT C,6,MOMBETIM,UBIN,ND=Y                                           
TSecs    LKOUT C,7,MOMBTSLN,UBIN,ND=Y                                           
BCost    LKOUT C,8,MOMBCOST,UBIN,ND=Y                                           
P1Shr    LKOUT C,9,MOMBPTIM,UBIN,ND=Y                                           
SType    LKOUT C,10,MOMBSTYP,CHAR,ND=Y                                          
DayPt    LKOUT C,11,MOMBDYPT,CHAR,ND=Y                                          
ProgN    LKOUT C,12,MOMBPROG,CHAR,ND=Y,LEN=V                                    
AdjCd    LKOUT C,13,MOMBELD,(R,FNDADJ),ND=Y,LEN=2                               
Array    LKOUT P,,CLRVARS                                                       
Array    LKOUT C,255,(A,ARYMBR),FILTROUT=FNDMOD                                 
Array    LKOUT C,255,(A,ARYBMD),FILTROUT=TSTMODNF                               
Array    LKOUT C,255,(A,ARYMBNTD)                                               
Array    LKOUT C,255,(A,ARYRBD)      Seller Demo values as a comment            
Array    LKOUT C,255,(A,ARYRBC)                                                 
Array    LKOUT C,255,(A,ARYMOD)                                                 
Array    LKOUT C,255,(A,ARYMBU)                                                 
Array    LKOUT C,255,(A,ARYMBD)                                                 
Array    LKOUT C,255,(A,ARYMPC)                                                 
Array    LKOUT C,255,(A,ARYMRC)                                                 
Array    LKOUT C,255,(A,ARYMGE),PCVERSION=2.7.0.0                               
Array    LKOUT C,255,(A,ARYBBC)                                                 
C2Cst    LKOUT C,38,(D,B#SAVED,MGDCOST2),(R,EDTCS2),LEN=8,ND=Y                  
RepCd    LKOUT C,39,(D,B#SAVED,MGDREPCD),(R,EDTREP),LEN=3,ND=Y                  
Array    LKOUT C,255,(A,ARYOUUI)                                                
                                                                                
         LKOUT E                                                                
*                                                                               
CLRVARS  XC    OFFSDFLG,OFFSDFLG      new offer buyline                         
         XC    OFFADEM,OFFADEM                                                  
         XC    OFFDEM#,OFFDEM#                                                  
         B     EXIT                                                             
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DOWNLOAD                          *         
***********************************************************************         
                                                                                
AXYMGO   LKOUT A,(D,B#OFFREC,MOXFRST),NEWEL=B,EOT=EOR,                 +        
               ROWID=(MOMBELD,MOMBELQ),ROWWIDTH=(V,MOMBLEN),           +        
               SETFILT=(MOMBOFFR,L'MOMBOFFR+L'MOMBREC)                          
                                                                                
Offer    LKOUT C,1,MOMBOFFR,UBIN,ND=Y                                           
RecNo    LKOUT C,2,MOMBREC,UBIN,ND=Y                                            
BDays    LKOUT C,3,MOMBDAYS,UBIN,ND=Y                                           
OOWSD    LKOUT C,4,MOMBOROT,UBIN,ND=Y                                           
STime    LKOUT C,5,MOMBSTIM,UBIN,ND=Y                                           
Etime    LKOUT C,6,MOMBETIM,UBIN,ND=Y                                           
TSecs    LKOUT C,7,MOMBTSLN,UBIN,ND=Y                                           
BCost    LKOUT C,8,MOMBCOST,UBIN,ND=Y                                           
P1Shr    LKOUT C,9,MOMBPTIM,UBIN,ND=Y                                           
SType    LKOUT C,10,MOMBSTYP,CHAR,ND=Y                                          
DayPt    LKOUT C,11,MOMBDYPT,CHAR,ND=Y                                          
ProgN    LKOUT C,12,MOMBPROG,CHAR,ND=Y,LEN=V                                    
AdjCd    LKOUT C,13,MOMBELD,(R,FNDADJ),ND=Y,LEN=2                               
Array    LKOUT P,,CLRVARS                                                       
Array    LKOUT C,255,(A,ARYMBR),FILTROUT=FNDMOD                                 
Array    LKOUT C,255,(A,ARYBMD),FILTROUT=TSTMODNF                               
Array    LKOUT C,255,(A,AXYMBNTD)                                               
Array    LKOUT C,255,(A,AXYRBD)      Seller Demo values as a comment            
Array    LKOUT C,255,(A,AXYRBC)                                                 
Array    LKOUT C,255,(A,AXYMOD)                                                 
Array    LKOUT C,255,(A,AXYMBU)                                                 
Array    LKOUT C,255,(A,AXYMBD)                                                 
Array    LKOUT C,255,(A,AXYMPC)                                                 
Array    LKOUT C,255,(A,AXYMRC)                                                 
Array    LKOUT C,255,(A,AXYMGE),PCVERSION=2.7.0.0                               
Array    LKOUT C,255,(A,AXYBBC)                                                 
C2Cst    LKOUT C,38,(D,B#SAVED,MGDCOST2),(R,EDTCS2),LEN=8,ND=Y                  
RepCd    LKOUT C,39,(D,B#SAVED,MGDREPCD),(R,EDTREP),LEN=3,ND=Y                  
Array    LKOUT P,,STOFFSTA                                                      
Statn    LKOUT C,50,(D,B#SAVED,OFFSTATN),(R,ED2STA),ND=Y                        
Array    LKOUT C,255,(A,AXYUUI)                                                 
                                                                                
         LKOUT E                                                                
*                                                                               
STOFFSTA L     R2,AOFFREC                                                       
         USING MOXKEY,R2                                                        
         MVC   OFFSTATN,MOXKSTTN   SAVE OFF STATION OF THE NOTICE REC           
         DROP  R2                                                               
         B     EXITY                                                            
                                                                                
***********************************************************************         
* LOCATE PROGRAM ADJACENCY CODE IN OFFER RECORD                       *         
***********************************************************************         
                                                                                
FNDADJ   L     R1,LP_AINP                                                       
         USING MOMBSELD,R1         R1=A(MAKEGOOD BUY ELEMENT)                   
         XC    MGDVALS(MGDVALL),MGDVALS                                         
         J     FNDADJ06                                                         
                                                                                
FNDADJ02 CLI   MOMBSEL,EOR         TEST END OF RECORD                           
         BE    XCOLEN                                                           
         CLI   MOMBSEL,MOMBELQ     X'20' BUY ELEMENT                            
         BE    XCOLEN                                                           
         CLI   MOMBSEL,MOBDELQ     X'50' MAKEGOOD BUY ELEMENT                   
         BE    XCOLEN                                                           
         CLI   MOMBSEL,MOMBSELQ    X'21' SUPPLEMENTAL ELEMENT                   
         JNE   FNDADJ06                                                         
                                                                                
         MVC   MGDCOST2,MOMBSCS2                                                
         MVC   MGDREPCD,MOMBSREP                                                
         MVC   MGDFLAG,MOMBSFLG                                                 
                                                                                
         L     RF,LP_AOUT                                                       
         MVC   0(L'MOMBSADJ,RF),MOMBSADJ                                        
         CLI   0(RF),0             NOTHING TO OUTPUT?                           
         BE    XCOLEN              EXIT                                         
                                                                                
         L     RE,ACLTREC          FORMAT PROGRAM ADJACENCY CODE                
         CLI   CPROF+9-CLTRECD(RE),C'1'                                         
         BE    EXITY                                                            
         ICM   R3,8,MOMBSADJ                                                    
         SLDL  R2,4                                                             
         SLL   R2,4                                                             
         SLDL  R2,4                                                             
         STCM  R2,3,0(RF)                                                       
         OI    0(RF),C'0'                                                       
         OI    1(RF),C'0'                                                       
         B     EXITY                                                            
                                                                                
FNDADJ06 LLC   R0,MOMBSLEN         BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         J     FNDADJ02                                                         
                                                                                
***********************************************************************         
* OUTPUT COST2 FOR THE OFFER WHICH WAS EXTRACTED IN FNDADJ ROUTINE              
***********************************************************************         
                                                                                
EDTCS2   OC    MGDCOST2,MGDCOST2                                                
         JNZ   EDTCS210                                                         
         CLI   MGDFLAG,0           NO FLAG TO SAVE COS2 OF $0.00?               
         BE    XCOLEN              NOPE, NULL                                   
                                                                                
EDTCS210 L     RF,LP_AOUT                                                       
         XR    R1,R1                                                            
         ICM   R1,7,MGDCOST2                                                    
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  0(8,RF),DUB                                                      
         B     EXITY                                                            
                                                                                
***********************************************************************         
* FIND OFFER DEMO ELEMENT AND SAVE OR CONSTRUCT A NEW ONE             *         
***********************************************************************         
                                                                                
FNDMOD   MVI   MODFOUND,NOQ        SET MODMEL NOT FOUND                         
         MVI   MONTDFND,NOQ        SET MONTEL NOT FOUND                         
                                                                                
         L     R1,LP_AINP                                                       
         USING MOMBELD,R1          EXTRACT OFFER/RECORD                         
         MVC   MGDOFFR(L'MOMBOFFR+L'MOMBREC),MOMBOFFR                           
                                                                                
FNDMOD10 LLC   R0,MOMBLEN          BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         CLI   MOMBEL,EOR          TEST END OF RECORD                           
         JE    FNDMOD30                                                         
         CLI   MOMBEL,MOMBELQ      TEST X'20' MAKEGOOD BUY ELEMENT              
         JE    FNDMOD30                                                         
         DROP  R1                                                               
*                                                                               
         USING MODMELD,R1          LOCATE APPROPRIATE DEMO ELEMENT              
         CLI   MODMEL,MODMELQ      TEST X'60' DEMO ELEMENT                      
         JNE   FNDMOD20                                                         
         CLC   MODMOFFR(L'MODMOFFR+L'MODMREC),MGDOFFR                           
         JNE   FNDMOD30                                                         
         MVI   MODFOUND,YESQ       SET DEMO ELEMENT FOUND/CONSTRUCTED           
*                                                                               
         LLC   RF,MODMLEN                                                       
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         MVC   ELEM(0),MODMELD                                                  
         EX    RF,0(RE)                                                         
         LA    RE,ELEM+1(RF)                                                    
         MVI   0(RE),EOR                                                        
         J     FNDMOD10                                                         
         DROP  R1                                                               
*                                                                               
         USING MONTELD,R1          LOCATE APPROPRIATE DEMO ELEMENT              
FNDMOD20 CLI   MONTEL,MONTELQ      TEST X'5E' NON-TRAD DEMO ELEMENT             
         JNE   FNDMOD10                                                         
         CLC   MONTOFFR(L'MONTOFFR+L'MONTREC),MGDOFFR                           
         JNE   FNDMOD10                                                         
         MVI   MONTDFND,YESQ       SET DEMO ELEMENT FOUND/CONSTRUCTED           
         J     FNDMOD10                                                         
         DROP  R1                                                               
*                                                                               
FNDMOD30 CLI   MODFOUND,YESQ       TEST MODMEL ELEM FOUND?                      
         JE    FNDMODY                                                          
         CLI   MONTDFND,YESQ       TEST MONTEL ELEM FOUND?                      
         JE    FNDMODN              YES, EXIT                                   
*                                                                               
FNDMOD50 CLI   MDDFOUND,YESQ       TEST OFFER DEFAULT DEMO REC FOUND            
         JNE   FNDMODN              NO, EXIT                                    
         CLI   REDODEMS,0          TEST REDO DEMO LOOKUPS                       
         JNE   FNDMODN              YES, EXIT                                   
                                                                                
         L     RF,AMDDREC          POINT TO OFFER DEMO RECORD                   
         USING DAREMGOD,RF                                                      
         LA    R1,MORFRST          POINT TO CATEGORY ELEMENT                    
         OC    MOXKSPAR,MOXKSPAR   CABLE DARE MAKEGOOD?                         
         JNZ   *+8                                                              
         LA    R1,MOXFRST          POINT TO CATEGORY ELEMENT                    
         DROP  RF                                                               
                                                                                
         USING MODCELD,R1                                                       
         CLI   MODCEL,MODCELQ      ENSURE THIS IS A CATEGORY ELEMENT            
         JNE   FNDMODN                                                          
         LA    RE,MODCELD          SAVE A(CATEGORY ELEMENT)                     
                                                                                
         USING MODVELD,R1          LOCATE APPROPRIATE DEMO ELEMENT              
FNDMOD60 LLC   R0,MODVLEN          BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         CLI   MODVEL,EOR          TEST END OF RECORD                           
         JE    FNDMODN                                                          
         CLI   MODVEL,MODVELQ                                                   
         JNE   FNDMOD60                                                         
         CLC   MODVOFFR(L'MODVOFFR+L'MODVREC),MGDOFFR                           
         JNE   FNDMOD60                                                         
         MVI   MODFOUND,YESQ       SET DEMO ELEMENT FOUND/CONSTRUCTED           
                                                                                
         LA    R2,ELEM             CONSTRUCT DEMO ELEMENT                       
         USING MODMELD,R2                                                       
         XC    MODMELD(L'ELEM),MODMELD                                          
         MVI   MODMEL,MODMELQ                                                   
         MVC   MODMOFFR(L'MODMOFFR+L'MODMREC),MODVOFFR                          
                                                                                
         LLC   R0,MODCLEN-MODCELD(RE)                                           
         SHI   R0,MODCLN1Q                                                      
         AHI   RE,MODCLN1Q                                                      
         LA    RF,MODMDEMO         MOVE CATEGORIES TO DEMO ELEMENT              
FNDMOD70 MVC   0(L'MODCDEMO,RF),0(RE)                                           
         AHI   RF,L'MODMDEMO                                                    
         AHI   RE,L'MODCDEMO                                                    
         SHI   R0,L'MODCDEMO                                                    
         JP    FNDMOD70                                                         
                                                                                
         SR    RF,R2               CALCULATE/SET ELEMENT LENGTH                 
         STC   RF,MODMLEN                                                       
                                                                                
         LLC   R0,MODVLEN                                                       
         SHI   R0,MODVLN1Q                                                      
         AHI   R1,MODVLN1Q                                                      
         LA    RF,MODMDEMO+4       MOVE VALUES TO DEMO ELEMENT                  
FNDMOD80 MVC   0(L'MODVDEMO,RF),0(R1)                                           
         AHI   RF,L'MODMDEMO                                                    
         AHI   R1,L'MODVDEMO                                                    
         SHI   R0,L'MODVDEMO                                                    
         JP    FNDMOD80                                                         
FNDMODY  B     EXITY                                                            
*                                                                               
FNDMODN  DS    0H                                                               
         CLI   SVMNSTAT,MNSTNEW    IF STATUS IS NEITHER NEW NOR                 
         BE    EXITN                                                            
         CLI   SVMNSTAT,MNSTAMND   AMENDED?                                     
         BE    EXITN                                                            
         MVI   MODFOUND,YESQ       THEN SKIP DEMO LOOKUPS                       
         MVI   MONTDFND,YESQ                                                    
         B     EXITN                                                            
         DROP  R1                                                               
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD (MISSING) DEMOS DOWNLOAD              *         
***********************************************************************         
                                                                                
ARYBMD   LKOUT A,(R,BLDMOD),NROWS=1                                             
                                                                                
Array    LKOUT C,255,(A,ARYMBRV)                                                
Array    LKOUT C,255,(A,ARYMBRS),FILTROUT=TSTMGDEM                              
                                                                                
         LKOUT E                                                                
                                                                                
TSTMGDEM DS    0H                                                               
         TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         BZ    RTRNNO               NO, SKIP IF NOT OFFLINE                     
*                                                                               
         L     RF,LP_ALPXD         GET ADDRESS OF EXTENSION BLOCK               
         TM    (LP_XTRAV-LP_XD)+(XIFLAG1-XTRAINFD)(RF),XIROSYS+XIROMODE         
         BNZ   RTRNNO          IF READONLY SYSTEM OR MODE, DON'T UPLOAD         
*                                                                               
         OC    OFFDEM#,OFFDEM#     TEST ANY DEMOS LOOKED UP                     
         B     SETCCC                                                           
                                                                                
***********************************************************************         
* BUILD MAKEGOOD DEMO ELEMENT                                         *         
***********************************************************************         
                                                                                
         USING BMWORKD,RC                                                       
         USING GDEMBLKD,BMBLOCK                                                 
BLDMOD   MVC   BMIOSAVE,IOVALS                                                  
         XC    WORK,WORK                                                        
         MVC   WORK(L'PROFKSDO),PROFS01W                                        
         MVC   WORK+04(L'AGENCY),AGENCY                                         
         MVC   WORK+06(L'QMEDA),QMEDA                                           
         MVC   WORK+07(L'QCLTA),QCLTA                                           
         MVI   WORK+10,C'*'                                                     
         L     RF,ACLTREC                                                       
         MVC   WORK+11(L'COFFICE),COFFICE-CLTRECD(RF)                           
         GOTOR VGETPROF,DMCB,WORK,PROF1WV,VDATAMGR                              
                                                                                
         L     R3,AMOMBEL                                                       
         USING MOMBELD,R3          R3=A(MAKEGOOD BUY ELEMENT)                   
                                                                                
         LA    R0,GDEMBLKD                                                      
         LHI   R1,GDEMBLKL                                                      
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
                                                                                
         L     RF,LP_ATWA          COPY THE 2 DECIMAL FLAG                      
         MVC   GD002DP,SVS002DP-TWAD(RF)                                        
         MVC   GD002DPI,SVS00A2DI-TWAD(RF)                                      
                                                                                
         XC    WORK,WORK                                                        
         MVC   WORK(4),MOMBOFFR    OFFER #, REC #, DAY BITS, ROT START          
         LR    RE,R3                                                            
BLDMOD10 LLC   R0,1(RE)            FIND THE BUY DETAIL THAT MATCHES             
         AR    RE,R0                                                            
         CLI   0(RE),0                                                          
         JE    BLDMOD20                                                         
         CLI   0(RE),MOBDELQ         SHOULD HAVE A MATCHING X'50'               
         JNE   BLDMOD10                                                         
         USING MOBDELD,RE                                                       
         CLC   MOBDOFFR(2),WORK        FOR THE OFFER # AND REC #                
         JNE   BLDMOD10                                                         
         MVC   WORK+4(4),MOBDBDAT      SAVE START DATE AND # OF WEEKS           
         J     BLDMOD10            LOOP BACK IN CASE NON-CONTIGUOUS             
         DROP  RE                                                               
                                                                                
BLDMOD20 OC    WORK+4(4),WORK+4      SHOULD HAVE A MATCHING                     
         JZ    *+2                                                              
                                                                                
         GOTOR VDATCON,DMCB,(8,WORK+4),(0,WORK+10)                              
         CLI   WORK+7,1            ONE WEEK?                                    
         JNH   BLDMOD30            SAME BASE DATE THEN                          
         LLC   RF,WORK+7                                                        
         BCTR  RF,0                                                             
         MHI   RF,7                                                             
         ST    RF,DMCB+8                                                        
         GOTOR VADDAY,DMCB,WORK+10,WORK+10,,0                                   
                                                                                
BLDMOD30 XR    RF,RF               2 WEEKS OF BITS IN HIGH ORDER 2              
         ICM   RF,4,WORK+2         BYTES OF RF                                  
         SLL   RF,1                                                             
         ICM   RF,8,WORK+2                                                      
                                                                                
         CLI   WORK+3,0            NO ROTATION START?                           
         JE    BLDMOD40            TREAT AS MONDAY                              
         LLC   RE,WORK+3                                                        
         BCTR  RE,0                                                             
         SLA   RF,1(RE)            ALIGN TO THE ROTATION +1                     
         LA    RE,1                CAN'T CYCLE PAST THE WEEK                    
BLDMOD40 SLA   RF,1                                                             
         JNO   BLDMOD50                                                         
         STC   RE,WORK+8                                                        
BLDMOD50 LA    RE,1(RE)                                                         
         CHI   RE,7                                                             
         JL    BLDMOD40                                                         
                                                                                
         LLC   RE,WORK+8                                                        
         ST    RE,DMCB+8                                                        
         GOTOR VADDAY,DMCB,WORK+10,WORK+10,,0                                   
         GOTOR VDATCON,DMCB,(0,WORK+10),(3,WORK+16)                             
         MVC   GDOFRLBK,WORK+16                                                 
                                                                                
BLDMOD60 MVC   GDMEDX,ORDAM                                                     
         MVC   GDCLTX,ORDCLT                                                    
         MVC   GDESTX,ORDEST                                                    
         MVC   GDPRDX,ORDPRD                                                    
         LA    RE,BMIO                                                          
         STCM  RE,7,GDAESTR        REDUCED WORK AREA, NO MORE IO9               
         MVC   GDSTAX,ORDSTAX                                                   
         MVC   GDDAYS,MOMBDAYS                                                  
         MVC   GDSTIM(L'GDSTIM+L'GDETIM),MOMBSTIM                               
                                                                                
         LA    RF,PROF1WV          SEND TO GETDEM A(1W PROFILE)                 
         STCM  RF,7,GDA1W                                                       
                                                                                
         GOTOR (#GETDEM,AGETDEM),GDEMBLKD                                       
         JNE   BLDMODNM                                                         
                                                                                
         LA    R2,ELEM                                                          
         USING MODMELD,R2          R2=A(OUTPUT DEMO ELEMENT)                    
         MVI   MODMEL,MODMELQ                                                   
         MVC   MODMOFFR(L'MODMOFFR+L'MODMREC),MGDOFFR                           
                                                                                
         LA    R1,MODMDEMO                                                      
         STCM  R1,15,OFFADEM                                                    
         ST    R1,LP_ADATA                                                      
         LA    RE,GDESTDEM                                                      
         LA    RF,GDDEMV                                                        
         SR    R0,R0                                                            
BLDMOD70 CLI   0(RE),FF            TEST END OF DEMO LIST                        
         JE    BLDMOD90                                                         
*&&DO                                                                           
         CLI   1(RE),C'D'          D MODIFER DEMO?                              
         JE    BLDMOD82                                                         
*&&                                                                             
         AHI   R0,1                BUMP NUMBER OF DEMOS                         
         MVC   0(3,R1),0(RE)       MOVE IN DEMO CATEGORY                        
         MVC   4(4,R1),0(RF)       MOVE IN DEMO VALUE                           
*                                                                               
BLDMOD80 AHI   R1,L'MODMDEMO                                                    
BLDMOD82 AHI   RE,3                                                             
         AHI   RF,4                                                             
         J     BLDMOD70                                                         
                                                                                
BLDMOD90 MVI   0(R1),EOR           SET END OF SEND ELEMENTS                     
         SR    R1,R2                                                            
         STC   R1,MODMLEN          SET ELEMENT LENGTH                           
         STCM  R0,3,OFFDEM#        SET NUMBER OF DEMOS TO SEND                  
*                                                                               
BLDMODX  MVC   IOVALS,BMIOSAVE                                                  
         B     EXITY                                                            
BLDMODNM MVC   IOVALS,BMIOSAVE                                                  
         B     NOMORE                                                           
         DROP  R2,R3,RC                                                         
BMWORKD  DSECT                     ** BLDMOD LOCAL WORKING STORAGE **           
         DS    0F                                                               
BMIOSAVE DS    XL(IOVALL)                                                       
BMBLOCK  DS    XL(GDEMBLKL)        GETDEM INTERFACE BLOCK                       
BMIO     DS    XL(2*ONEK)          2K IS ENUF STORAGE FOR RECORD                
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD SEND UPLOAD MISSING DEMOS             *         
***********************************************************************         
                                                                                
ARYMBRS  LKOUT A,(D,B#WORKD,ELEM),EOT=EOR,                             +        
               ROWID=(MODMELD,MODMELQ),ROWWIDTH=(V,MODMLEN)                     
                                                                                
ULoad    LKRUN H,I#SDOUMD                                                       
         LKOUT C,1,(D,B#SAVED,OFFDA1),QVAL                                      
         LKOUT C,2,(D,B#SAVED,OFFFILE),QVAL                                     
         LKOUT C,3,MODMELD,QVAL,LEN=V                                           
         LKRUN E                                                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD OFFER UUID                            *         
***********************************************************************         
                                                                                
ARYOUUI  LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOMBAAUD,MOMBAELQ),ROWWIDTH=(V,MOMBALEN),        +        
               TESTFILT=(MOMBAOFR,L'MOMBAOFR+L'MOMBAREC)                        
                                                                                
UuidTx   LKOUT C,51,MOMBAAU,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD REP BUY COMMENTS                      *         
***********************************************************************         
                                                                                
ARYRBC   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOBCELD,MOBCELQ),ROWWIDTH=(V,MOBCLEN),           +        
               TESTFILT=(MOBCOFFR,L'MOBCOFFR+L'MOBCREC)                         
                                                                                
Line#    LKOUT C,17,MOBCLINE,(R,EDTCMLN),ND=Y                                   
*Line#    LKOUT C,17,MOBCLINE,UBIN,ND=Y                                         
CText    LKOUT C,18,MOBCTEXT,CHAR,ND=Y,LEN=V                                    
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD SELLER DEMO VALUES AS A COMMENT FOR             
* X'5F' ELEMENT                                                                 
***********************************************************************         
ARYRBD   LKOUT A,(D,B#WORKD,WORK),NROWS=1                                       
PRout    LKOUT P,(B#SVRDEF,BLDESTOR),SETROUT                                    
Array    LKOUT C,255,(A,ARYRBD1)                                                
Array    LKOUT C,255,(A,ARYRBD2)                                                
         LKOUT E                                                                
*                                                                               
ARYRBD1  LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MONTELD,MOSNTELQ),ROWWIDTH=(V,MONTLEN),          +        
               TESTFILT=(MONTOFFR,L'MONTOFFR+L'MONTREC)                         
Line#    LKOUT C,17,MONTEL,(R,EDTSLDM),ND=Y                                     
CatVals  LKOUT C,18,MONTEL,(R,EDTDEMV),ND=Y                                     
                                                                                
         LKOUT E                                                                
*                                                                               
ARYRBD2  LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MODMELD,MOSDELQ),ROWWIDTH=(V,MODMLEN),           +        
               TESTFILT=(MODMOFFR,L'MODMOFFR+L'MODMREC)                         
Line#    LKOUT C,17,MODMEL,(R,EDTSLDM),ND=Y                                     
CatVals  LKOUT C,18,MODMEL,(R,EDTDEMV),ND=Y                                     
                                                                                
         LKOUT E                                                                
*&&DO                                                                           
ARYRBD2  LKOUT A,(D,B#SDMREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MONTELD,MOSNTELQ),ROWWIDTH=(V,MONTLEN),          +        
               TESTFILT=(MONTOFFR,L'MONTOFFR+L'MONTREC)                         
Line#    LKOUT C,17,MONTEL,(R,EDTSLDM),ND=Y                                     
CatVals  LKOUT C,18,MONTEL,(R,EDTDEMV),ND=Y                                     
                                                                                
         LKOUT E                                                                
*&&                                                                             
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD SELLER DEMO VALUES AS A COMMENT FOR             
* X'62' AND X'5F' ELEMENTS                                                      
***********************************************************************         
                                                                                
AXYRBD   LKOUT A,(D,B#WORKD,WORK),NROWS=1                                       
*                                                                               
PRout    LKOUT P,(B#SVRDEF,BLDESTOR),SETROUT                                    
Array    LKOUT C,255,(A,AXYRBD1)                                                
Array    LKOUT C,255,(A,AXYRBD2),FILTROUT=TSTMSDR                               
Array    LKOUT C,255,(A,AXYRBNTD),FILTROUT=TSTMSDR                              
         LKOUT E                                                                
*                                                                               
AXYRBD1  LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MODMELD,MOSDELQ),ROWWIDTH=(V,MODMLEN),           +        
               TESTFILT=(MODMOFFR,L'MODMOFFR+L'MODMREC)                         
Line#    LKOUT C,17,MODMEL,(R,EDTSLDM),ND=Y                                     
CatVals  LKOUT C,18,MODMEL,(R,EDTDEMV),ND=Y                                     
                                                                                
         LKOUT E                                                                
*                                                                               
AXYRBD2  LKOUT A,(D,B#SDMREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MODMELD,MOSDELQ),ROWWIDTH=(V,MODMLEN),           +        
               TESTFILT=(MODMOFFR,L'MODMOFFR+L'MODMREC)                         
Line#    LKOUT C,17,MODMEL,(R,EDTSLDM),ND=Y                                     
CatVals  LKOUT C,18,MODMEL,(R,EDTDEMV),ND=Y                                     
                                                                                
         LKOUT E                                                                
*                                                                               
AXYRBNTD LKOUT A,(D,B#SDMREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MONTELD,MOSNTELQ),ROWWIDTH=(V,MONTLEN),          +        
               TESTFILT=(MONTOFFR,L'MONTOFFR+L'MONTREC)                         
Line#    LKOUT C,17,MONTEL,(R,EDTSLDM),ND=Y                                     
CatVals  LKOUT C,18,MONTEL,(R,EDTDEMV),ND=Y                                     
                                                                                
         LKOUT E                                                                
                                                                                
TSTMSDR  CLI   MSDFOUND,C'Y'                                                    
         BR    RE                                                               
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD OFFER UUID                            *         
***********************************************************************         
                                                                                
AXYUUI   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOMBAAUD,MOMBAELQ),ROWWIDTH=(V,MOMBALEN),        +        
               TESTFILT=(MOMBAOFR,L'MOMBAOFR+L'MOMBAREC)                        
                                                                                
UuidTx   LKOUT C,51,MOMBAAU,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD REP BUY COMMENTS                                
* IF THERE WAS SELLER DEMO VALUES, THEN THE LINE # NEEDS TO BE                  
*   INCREASED BY 1                                                              
***********************************************************************         
                                                                                
AXYRBC   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOBCELD,MOBCELQ),ROWWIDTH=(V,MOBCLEN),           +        
               TESTFILT=(MOBCOFFR,L'MOBCOFFR+L'MOBCREC)                         
                                                                                
*****Line#    LKOUT C,17,MOBCLINE,UBIN,ND=Y                                     
Line#    LKOUT C,17,MOBCLINE,(R,EDTCMLN),ND=Y                                   
CText    LKOUT C,18,MOBCTEXT,CHAR,ND=Y,LEN=V                                    
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD ORBIT DESCRIPTION DOWNLOAD            *         
***********************************************************************         
                                                                                
ARYMOD   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MORNELD,MORNELQ),ROWWIDTH=(V,MORNLEN),           +        
               TESTFILT=(MORNOFFR,L'MORNOFFR+L'MORNREC)                         
                                                                                
ODays    LKOUT C,19,MORNDAYS,UBIN,ND=Y                                          
StDay    LKOUT C,20,MORNSDAY,UBIN,ND=Y                                          
STime    LKOUT C,21,MORNSTIM,UBIN,ND=Y                                          
ETime    LKOUT C,22,MORNETIM,UBIN,ND=Y                                          
ProgN    LKOUT C,23,MORNPROG,CHAR,ND=Y                                          
DemVl    LKOUT C,34,MORNDEM,(R,EDTDVL2B)                                        
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD ORBIT DESCRIPTION DOWNLOAD            *         
***********************************************************************         
                                                                                
AXYMOD   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MORNELD,MORNELQ),ROWWIDTH=(V,MORNLEN),           +        
               TESTFILT=(MORNOFFR,L'MORNOFFR+L'MORNREC)                         
                                                                                
ODays    LKOUT C,19,MORNDAYS,UBIN,ND=Y                                          
StDay    LKOUT C,20,MORNSDAY,UBIN,ND=Y                                          
STime    LKOUT C,21,MORNSTIM,UBIN,ND=Y                                          
ETime    LKOUT C,22,MORNETIM,UBIN,ND=Y                                          
ProgN    LKOUT C,23,MORNPROG,CHAR,ND=Y                                          
DemVl    LKOUT C,34,MORNDEM,(R,EDTDVL2B)                                        
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DETAIL DOWNLOAD                   *         
***********************************************************************         
                                                                                
ARYMBD   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOBDELD,MOBDELQ),ROWWIDTH=(V,MOBDLEN),           +        
               TESTFILT=(MOBDOFFR,L'MOBDOFFR+L'MOBDREC)                         
                                                                                
SeqNo    LKOUT C,25,MOBDSEQ,UBIN,ND=Y                                           
BCost    LKOUT C,26,MOBDCOST,UBIN,ND=Y                                          
SDate    LKOUT C,27,MOBDBDAT,JDAT,ND=Y                                          
Weeks    LKOUT C,28,MOBDNWKS,UBIN,ND=Y                                          
SpPWk    LKOUT C,29,MOBDNSPW,UBIN,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD BUY DETAIL DOWNLOAD                   *         
***********************************************************************         
                                                                                
AXYMBD   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOBDELD,MOBDELQ),ROWWIDTH=(V,MOBDLEN),           +        
               TESTFILT=(MOBDOFFR,L'MOBDOFFR+L'MOBDREC)                         
                                                                                
SeqNo    LKOUT C,25,MOBDSEQ,UBIN,ND=Y                                           
BCost    LKOUT C,26,MOBDCOST,UBIN,ND=Y                                          
SDate    LKOUT C,27,MOBDBDAT,JDAT,ND=Y                                          
Weeks    LKOUT C,28,MOBDNWKS,UBIN,ND=Y                                          
SpPWk    LKOUT C,29,MOBDNSPW,UBIN,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD GROUP COMMENT DOWNLOAD                *         
***********************************************************************         
                                                                                
ARYMGC   LKOUT A,(D,B#OFFREC,MORFRST),EOT=EOR,                         +        
               ROWID=(MOCMELD,MOCMELQ),ROWWIDTH=(V,MOCMLEN)                     
                                                                                
Line#    LKOUT C,1,MOCMLINE,UBIN,ND=Y                                           
CText    LKOUT C,2,MOCMTEXT,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR MAKEGOOD GROUP COMMENT DOWNLOAD                *         
***********************************************************************         
                                                                                
AXYMGC   LKOUT A,(D,B#OFFREC,MOXFRST),EOT=EOR,                         +        
               ROWID=(MOCMELD,MOCMELQ),ROWWIDTH=(V,MOCMLEN)                     
                                                                                
Line#    LKOUT C,1,MOCMLINE,UBIN,ND=Y                                           
CText    LKOUT C,2,MOCMTEXT,CHAR,ND=Y,LEN=V                                     
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER DOWNLOAD                                 *         
***********************************************************************         
                                                                                
ARYORD   LKOUT A,(D,B#ORDREC,DAREORDD),NROWS=1,ROWWIDTH=1000                    
                                                                                
PCKey    LKOUT C,1,(D,B#SAVED,PCKEYORD),CHAR,ND=Y                               
Order    LKOUT C,10,DOKORDER,(U,#EDTORD,$EDTORD)                                
OrdCr    LKOUT C,28,(D,B#SAVED,ORDCREAT),JDAT,ND=Y                              
LADat    LKOUT C,24,(D,B#SAVED,ORDLADAT),JDAT,ND=Y                              
CStat    LKOUT C,31,(D,B#SAVED,ORDBSTAT),CHAR,ND=Y                              
RecDA    LKOUT C,38,(D,B#SAVED,ORDDA),HEXD,ND=Y                                 
CkSum    LKOUT C,39,(D,B#SAVED,ORDCKSM),HEXD,ND=Y                               
1stED    LKOUT C,40,(D,B#SAVED,ORDFEDAT),JDAT,ND=Y                              
Array    LKOUT C,255,(A,ARYORD01)                                               
Array    LKOUT C,255,(A,ARYORD03)                                               
Array    LKOUT C,255,(A,ARYORD25)                                               
Array    LKOUT C,255,(A,ARYORD50)                                               
Array    LKOUT C,255,(A,ARYOGP),FILTROUT=TSTXTRA,PCVERSION=3.0.0.120            
Array    LKOUT C,255,(A,ARYOEM),PCVERSION=3.0.0.120                             
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER DOWNLOAD - PRIMARY ID ELEMENT         *         
***********************************************************************         
                                                                                
ARYORD01 LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOIDEL,DOIDELQ),ROWWIDTH=(V,DOIDLEN)                      
                                                                                
PrdCd    LKOUT C,3,DOIDPRD,(U,#EDTPRD,$EDTPRD)                                  
PigCd    LKOUT C,4,DOIDPRD2,(U,#EDTPRD,$EDTPRD),ND=Y                            
FltNo    LKOUT C,6,DOIDFLTN,LBIN,ND=Y                                           
***********************************************************************         
* CODE HAS BEEN COMMENTED OUT, UNTIL NEW SAT IS REVISITED -HWON 11/8/16         
***********************************************************************         
*SMrkt    LKOUT C,7,DOISTA,(R,EDTDMKT),FILTROUT=TSTOMMD,ND=Y                    
SCall    LKOUT C,8,DOISTA,(R,EDTSTA)                                            
Buyer    LKOUT C,11,DOIDBYR,CHAR,ND=Y                                           
Array    LKOUT C,255,(A,ARYSPR),FILTROUT=TSTSPPER                               
Array    LKOUT C,255,(A,ARYNML),FILTROUT=TSTNORML                               
ConNo    LKOUT C,15,DOIDCON,CHAR,ND=Y                                           
SCom1    LKOUT C,32,DOISCOM1,CHAR,ND=Y                                          
SCom2    LKOUT C,33,DOISCOM2,CHAR,ND=Y                                          
Scom3    LKOUT C,34,DOISCOM3,CHAR,ND=Y                                          
SType    LKOUT C,35,(D,B#SAVED,ORDTTYPE),HEXD,FILTROUT=TSTFLAG3                 
ByrNm    LKOUT C,37,DOIDBYR,(R,EDTBYR),LEN=L'BYRFNAME,ND=Y                      
STyp2    LKOUT C,44,(D,B#SAVED,ORDTTYPE),HEXD,FILTROUT=TSTFLAG7                 
                                                                                
         LKOUT E                                                                
                                                                                
TSTOMMD  CLC   LP_QMAPN,SDOMMD#    Muliple order download?                      
         BR    RE                                                               
                                                                                
TSTSPPER CLC   ORDSPFFS,EFFS       SPECIAL IF X'FFFF' IN 1ST 2 BYTES            
         BR    RE                                                               
                                                                                
TSTNORML CLC   ORDSPFFS,EFFS       NORMAL TEXT SALESPERSON?                     
         BE    RTRNNO              NO                                           
         B     RTRNYES                                                          
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR SPECIAL PERSON (SALES/POINT)                   *         
***********************************************************************         
                                                                                
ARYSPR   LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOIDEL,DOIDELQ),ROWWIDTH=(V,DOIDLEN)                      
                                                                                
PwrCD    LKOUT C,42,DOIDREPA,CHAR                                               
SPerC    LKOUT C,43,DOIDSALC,HEXD                                               
SPERN    LKOUT C,13,DOIDSPER,(R,EDTPER),LEN=40,ND=Y                             
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER ERROR CODE                               *         
***********************************************************************         
                                                                                
ARYNML   LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOIDEL,DOIDELQ),ROWWIDTH=(V,DOIDLEN)                      
                                                                                
SPers    LKOUT C,13,DOIDSPER,CHAR,ND=Y                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER DOWNLOAD - SUPPLEMENTARY ID ELEMENT   *         
***********************************************************************         
                                                                                
ARYORD03 LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOSPEL,DOSPELQ),ROWWIDTH=(V,DOSPLEN)                      
                                                                                
Flag1    LKOUT C,9,DOSPFLG1,HEXD,ND=Y                                           
RevNo    LKOUT C,12,DOSPREVN,LBIN                                               
Flag2    LKOUT C,14,DOSPFLG2,HEXD,ND=Y                                          
Destn    LKOUT C,16,DOSPDEST,CHAR,ND=Y                                          
Methd    LKOUT C,17,DOSPMTHD,CHAR,ND=Y                                          
TData    LKOUT C,21,DOSPTDAT,CHAR,ND=Y                                          
Trade    LKOUT C,20,DOSPTMTH,CHAR,ND=Y                                          
CrUId    LKOUT C,22,DOSPCRTR,(R,EDTUID),LEN=L'CTIKID,ND=Y                       
CrPID    LKOUT C,23,DOSPCPID,(R,EDTPID),LEN=L'SAPALPID,ND=Y                     
FADat    LKOUT C,30,(D,B#SAVED,ORDFADAT),CDAT,ND=Y                              
SOOFE    LKOUT C,36,DOSPFSTA,(R,EDTSTA),ND=Y                                    
Count    LKOUT C,45,DOSPVER#,LBIN                                               
URLTx    LKOUT C,46,(D,B#SAVED,ORDURLEL+1),(R,EDTOURL),ND=Y,           +        
               PCVERSION=2.5.0.6                                                
Array    LKOUT C,255,(A,ARYRLN),PCVERSION=2.5.0.6                               
PDest    LKOUT C,52,DOSPIDST,CHAR,ND=Y,PCVERSION=3.0.0.120                      
PMeth    LKOUT C,53,DOSPIMTH,CHAR,ND=Y,PCVERSION=3.0.0.120                      
GAPSq    LKOUT C,54,DOSPGAP#,LBIN,ND=Y,PCVERSION=3.0.0.120                      
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER REJECTION LINES ELEMENT               *         
***********************************************************************         
                                                                                
ARYRLN   LKOUT A,(D,B#SAVED,ORDRLINS),NROWS=(B#SAVED,ORDNRLNS),        +        
               ROWWIDTH=L'DRLINTXT                                              
                                                                                
RejLn    LKOUT C,47,(D,B#SAVED,ORDRLINS),LBIN                                   
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER DOWNLOAD - DEMO ELEMENT               *         
***********************************************************************         
                                                                                
ARYORD25 LKOUT A,(D,B#SAVED,ORDDEMO),NROWS=(B#SAVED,ORDDEMN),          +        
               ROWWIDTH=L'ORDDEMO                                               
                                                                                
PRout    LKOUT P,(B#SVRDEF,BLDESTOR),SETROUT                                    
PRout    LKOUT P,,INITDEMS                                                      
DemCat   LKOUT C,41,ORDDEMO,(R,EDTDCD)                                          
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR OM ORDER DOWNLOAD - INBOX INFORMATION          *         
***********************************************************************         
                                                                                
ARYORD50 LKOUT A,(D,B#ORDREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOWIGEL,DOWIGELQ),ROWWIDTH=(V,DOWIGLEN)                   
                                                                                
FaxNo    LKOUT C,19,DOWIGFXN,CHAR,FILTROUT=TSTFAXNO,ND=Y                        
EMail    LKOUT C,26,DOWIGRPP,CHAR,FILTROUT=TSTEMAIL,ND=Y,              +        
               PCVERSION=3.0.0.120                                              
Prefx    LKOUT C,26,DOWIGRPP,CHAR,FILTROUT=TSTXMAIL,ND=Y                        
OffCd    LKOUT C,27,DOWIGRPO,CHAR,FILTROUT=TSTXMAIL,ND=Y                        
                                                                                
         LKOUT E                                                                
                                                                                
TSTFAXNO L     RF,LP_AINP          TEST USING FAX METHOD                        
         CLI   DOWIGMTH-DOWIGELD(RF),C'F'                                       
         BR    RE                                                               
                                                                                
TSTEMAIL L     RF,LP_AINP          TEST USING EMAIL METHOD                      
         CLI   DOWIGMTH-DOWIGELD(RF),C'E'                                       
         BR    RE                                                               
                                                                                
TSTXMAIL L     RF,LP_AINP          TEST NOT USING EMAIL METHOD                  
         CLI   DOWIGMTH-DOWIGELD(RF),C'E'                                       
         B     SETCCC                                                           
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER EXPORT GAP TOKEN                         *         
***********************************************************************         
                                                                                
ARYOGP   LKOUT A,(D,B#OMXREC,DORFRST),EOT=EOR,                         +        
               ROWID=(DOEGTEL,DOEGTELQ),ROWWIDTH=(V,DOEGTLEN)                   
                                                                                
GTokn    LKOUT C,49,DOETOKEN,CHAR,LEN=V,ND=Y                                    
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR ORDER EXPORT EMAIL ADDRESSES                   *         
***********************************************************************         
                                                                                
ARYOEM   LKOUT A,(D,B#ORDREC,DORFRST),ROWID=(DOEMXEL,DOEMXELQ),EOT=EOR,+        
               ROWWIDTH=(V,DOEMXLEN)                                            
                                                                                
EList    LKOUT C,50,(A,ARYELS),FILTROUT=TSTEFST                                 
                                                                                
         LKOUT E                                                                
                                                                                
TSTEFST  TM    ORDTFLAG,OEFRST     TEST FIRST EMAIL FOUND                       
         IPM   R0                  SAVE CC                                      
         OI    ORDTFLAG,OEFRST     SET FIRST EMAIL FOUND                        
         SPM   R0                  RESTORE CC                                   
         BR    RE                                                               
                                                                                
ARYELS   LKOUT A,(*,DOEMXD2),ROWNAME=DOEMXEL,NROWS=*,ROWWIDTH=DOEMXLN2          
                                                                                
ESTyp    LKOUT C,50,DOEMXFLG,CHAR,ND=Y                                          
EAddr    LKOUT C,51,DOEMXTOK,(R,EDTEML),ND=Y                                    
                                                                                
         LKOUT E                                                                
         EJECT                                                                  
***********************************************************************         
* LOCKED ORDER DOWNLOAD REQUEST   (X'00E9')                           *         
***********************************************************************         
                                                                                
REQLCKD  LKREQ H,I#SDORDL,OUTOML,NEXTREQ=REQBOX                                 
LockDA   LKREQ F,1,(I,B#SAVED,ALCK),HEXD,OLEN=L'$LCKLSDA,ARRAY=S,      +        
               MAXLEN=L'$LCKLSDA*2,SORT=NO,TEXT=SP#SDBDA                        
LockPCKy LKREQ F,2,,CHAR,OLEN=L'$LCKLSPK,TEXT=SP#KEY,ARRAY=E                    
         LKREQ E                                                                
                                                                                
OUTOML   LKOUT H                   ** LOCKED ORDERS DOWNLOAD **                 
         LKOUT R,X'01B2'                                                        
Array    LKOUT C,255,(A,ARYLCKD)                                                
         LKOUT X                                                                
                                                                                
***********************************************************************         
* ARRAY DEFINITION FOR LOCKED ORDER DOWNLOAD                          *         
***********************************************************************         
                                                                                
ARYLCKD  LKOUT A,(R,NXTDLK),MULTIROW=Y                                          
                                                                                
OrdNo    LKOUT C,1,(D,B#SAVED,ORDORDER),(U,#EDTORD,$EDTORD)                     
PCKey    LKOUT C,2,(D,B#SAVED,PCKEYORD),CHAR,ND=Y                               
RecDA    LKOUT C,3,(D,B#SAVED,ORDDA),HEXD,ND=Y                                  
CkSum    LKOUT C,4,(D,B#SAVED,ORDCKSM),HEXD,ND=Y                                
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* CHECK FOR DARE LOCKED ORDERS                                        *         
***********************************************************************         
                                                                                
NXTDLK   MVC   LP_ADATA,AIO3                                                    
         CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTDLK02                                                         
         ICM   R2,15,ALCK                                                       
         JZ    *+2                                                              
         USING LW_D,R2                                                          
                                                                                
         XR    R4,R4                                                            
         ICM   R4,3,LW_NUMN        GET NUMBER OF DATA VALUES                    
         LA    R2,LW_DATA2         POINT TO FIRST DATA VALUE                    
         J     NXTDLK04                                                         
                                                                                
NXTDLK02 XR    R2,R2               R2=A(CURRENT LOCK REQUEST)                   
         ICM   R2,7,ACURLCK                                                     
         LLC   R4,CURLCKLF         R4=# OF LOCK REQUESTS LEFT                   
         J     NXTDLK06                                                         
                                                                                
         USING $LCKLSTD,R2                                                      
NXTDLK04 STC   R4,CURLCKLF                                                      
         STCM  R2,7,ACURLCK                                                     
                                                                                
         MVC   IODAOVER,$LCKLSDA   READ THE ORDER RECORD                        
         OC    IODAOVER,IODAOVER   ENSURE GOOD DISK ADDRESS                     
         JZ    *+2                                                              
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL+IO3'                              
         JNE   NXTDLK06                                                         
                                                                                
         L     R3,AIO3             SETTING UP FOR LKOUT                         
         USING DAREORDD,R3                                                      
         MVC   ORDORDER,DOKORDER                                                
         MVC   ORDBSTA,DOKSTA                                                   
         MVC   PCKEYORD,$LCKLSPK                                                
         MVC   ORDDA,IODA          SET ORDER DISK ADDRESS                       
         GOTOR GETSUM,ORDCKSM      SET ORDER CHECK SUM                          
         B     EXITY                                                            
                                                                                
NXTDLK06 AHI   R2,$LCKLSTL         NEXT ARRAY ENTRY                             
         JCT   R4,NXTDLK04                                                      
         B     NOMORE                                                           
         DROP  R2,R3                                                            
                                                                                
$LCKLSTD DSECT                                                                  
$LCKLSDA DS    XL4                 DISK ADDRESS                                 
$LCKLSPK DS    CL12                PCKEY                                        
$LCKLSTL EQU   *-$LCKLSTD                                                       
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* BATCH ORDER EXPORT DOWNLOAD (X'00EA')                               *         
***********************************************************************         
                                                                                
REQBOX   LKREQ H,I#SDBOXD,OUTBOX,NEXTREQ=REQUESTX                               
Media    LKREQ F,1,(I,B#SAVED,MEDIND),(U,#VALMED,$VALMED),             +        
               OLEN=L'CKEYAM,MAXLEN=L'QMEDA,TEXT=SP#MED,COL=*                   
OrdNo    LKREQ F,2,(I,B#SAVED,ORDIND),(U,#VALORD,$VALORD),LIST=F,      +        
               SORT=N,OLEN=L'DOKORDER,TEXT=SP#ORDN,COL=*                        
ComCd    LKREQ F,3,(I,B#SAVED,COMIND),CHAR,LIST=Y,OLEN=L'COMKCOM,      +        
               TEXT=SP#COMCD,COL=*                                              
PrdCd    LKREQ F,4,(I,B#SAVED,PEFIND),CHAR,OLEN=L'PKEYPRD,TEXT=SP#PRO, +        
               COL=*,ARRAY=S                                                    
EstCd    LKREQ F,5,,LBIN,OLEN=L'OCOMKEST,TEXT=SP#EST,COL=*                      
FltNo    LKREQ F,6,,LBIN,OLEN=L'OCOMKFLT,TEXT=SP#FLGHT,COL=*,ARRAY=E            
ByrCd    LKREQ F,7,(I,B#SAVED,BYRIND),CHAR,LIST=F,OLEN=L'BYRKBYR,      +        
               TEXT=SP#BUYER,COL=*                                              
         LKREQ E                                                                
                                                                                
OUTBOX   LKOUT H                   ** BATCH ORDER EXPORT **                     
                                                                                
BOXSNP   LKOUT R,1                 BUY SNAPSHOT                                 
Array    LKOUT C,255,(A,ARYBOX)                                                 
         LKOUT E                                                                
                                                                                
BOXSCO   LKOUT R,X'00D2'           STANDARD COMMENTS                            
Array    LKOUT C,X'00D2',(A,ARYSDSC)                                            
         LKOUT E                                                                
                                                                                
BOXOCO   LKOUT R,X'00D9'           ORDER COMMENTS                               
Array    LKOUT C,X'00D9',(A,ARYACOM)                                            
         LKOUT E                                                                
                                                                                
BOXBYR   LKOUT R,X'00D3'           BUYERS                                       
Array    LKOUT C,X'00D3',(A,ARYBYR)                                             
         LKOUT E                                                                
                                                                                
         LKOUT X                                                                
                                                                                
ARYBOX   LKOUT A,(R,NXTBOX),MULTIROW=Y,ROWNAME=BOXVALS                          
                                                                                
OrdNo    LKOUT C,1,BOXORD#,(U,#EDTORD,$EDTORD)                                  
LSDat    LKOUT C,2,BOXDATE,JDAT,ND=Y                                            
LSTim    LKOUT C,3,BOXTIME,(R,EDTTIME)                                          
PRout    LKOUT P,,GETCDT           GET CURRENT DATE & TIME                      
CDate    LKOUT C,4,(D,B#WORKD,WORK),CDAT                                        
CTime    LKOUT C,5,(D,B#WORKD,WORK+2),CHAR,LEN=4                                
Array    LKOUT C,2,(A,ARYOHS)                                                   
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* READ ORDER RECORD AND EXTRACT LATEST SENT DATE/TIME                 *         
***********************************************************************         
                                                                                
NXTBOX   CLI   LP_RMODE,LP_RFRST   TEST FIRST TIME                              
         JNE   NXTBOX02                                                         
         ICM   R1,7,AMED           EXTRACT AGENCY/MEDIA CODE                    
         JZ    *+2                                                              
         MVC   QMEDX,LW_DATA1-LW_D(R1)                                          
         MVC   RQMEDIA,QMEDX       SET MEDIA FOR OTHER RECORDS                  
         XC    QCLTX,QCLTX         INITIALIZE CLIENT                            
         ICM   R1,7,AORD                                                        
         JZ    *+2                                                              
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         JZ    *+2                                                              
         STC   R0,ORDIND           SET NUMBER OF ORDERS RECEIVED                
         AHI   R1,LW_DATA2-LW_D                                                 
         STCM  R1,7,AORD           SET A(FIRST ORDER NUMBER)                    
                                                                                
NXTBOX02 XC    BOXVALS(BOXVALL),BOXVALS                                         
         SR    R0,R0               GET SEQUENCE NUMBER                          
         ICM   R0,1,ORDIND                                                      
         BZ    NOMORE                                                           
         BCTR  R0,0                DECREMENT                                    
         STC   R0,ORDIND           SET NEXT SEQUENCE NUMBER                     
         ICM   R1,7,AORD           R1=A(ORDER NUMBER)                           
         MVC   BOXORD#,0(R1)       SET ORDER NUMBER                             
         AHI   R1,L'DOKORDER                                                    
         STCM  R1,7,AORD           POINT TO NEXT ORDER NUMBER                   
         LA    R0,BOXVALS                                                       
         ST    R0,LP_ADATA         POINT TO OUTPUT VALUES                       
                                                                                
         LA    R2,IOKEY                                                         
         USING DAREORDD,R2         BUILD KEY OF ORDER RECORD                    
         XC    DOKEY,DOKEY                                                      
         MVI   DOKTYPE,DOKTYPQ                                                  
         MVI   DOKSUBTY,DOKSTYPQ                                                
         MVC   DOKAGMD,QMEDX                                                    
         MVC   DOKORDER,BOXORD#                                                 
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBHI+IODIR+B#ORDREC'                         
         JNE   *+2                                                              
         CLC   DOKEY(DOKSTA-DOKEY),IOKEYSAV                                     
         JNE   *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ORDREC'                        
         JNE   *+2                                                              
                                                                                
         L     R2,AORDREC                                                       
         LA    R2,DORFRST                                                       
         USING DOIDELD,R2                                                       
         SR    R0,R0                                                            
NXTBOX04 CLI   DOIDEL,0            TEST END OF RECORD                           
         JE    NXTBOX12                                                         
         CLI   DOIDEL,DOIDELQ                                                   
         JNE   NXTBOX06                                                         
         OC    QCLTX,QCLTX         TEST FIRST CLIENT                            
         JNZ   *+10                                                             
         MVC   QCLTX,DOIDCLT       YES - SAVE IT                                
         CLC   DOIDCLT,QCLTX       ALL ORDERS MUST BE FOR THE SAME ONE          
         JE    NXTBOX08                                                         
         DC    H'0'                MIXED CLIENT CODES                           
                                                                                
         USING DOSTELD,R2          LOCATE FIRST SENT ELEMENT                    
NXTBOX06 CLI   DOSTEL,DOSTELQ      TEST STATUS ELEMENT                          
         JNE   NXTBOX08                                                         
         CLI   DOSTSTAT,DSENT      TEST SENT STATUSES                           
         JE    NXTBOX10                                                         
         CLI   DOSTSTAT,DFXSENT                                                 
         JE    NXTBOX10                                                         
         CLI   DOSTSTAT,DEMSENT                                                 
         JE    NXTBOX10                                                         
         CLI   DOSTSTAT,DFXRSNT                                                 
         JE    NXTBOX10                                                         
                                                                                
NXTBOX08 IC    R0,DOSTLEN          BUMP TO NEXT ELEMENT ON RECORD               
         AR    R2,R0                                                            
         J     NXTBOX04                                                         
                                                                                
NXTBOX10 MVC   BOXDATE,DOSTDATE    SET LAST SENT DATE                           
         MVC   BOXTIME,DOSTTIME    SET LAST SENT TIME                           
                                                                                
NXTBOX12 B     EXITY                                                            
         DROP  R2                                                               
*                                                                               
* GET CURRENT DATE AND TIME, IN WORK(2) & WORK+2(4), RESP                       
*                                                                               
GETCDT   TIME  DEC                 GET CURRENT TIME HHMMSSUU                    
         SRL   R0,16                DROP SECONDS & MILLISECS                    
         SLL   R0,4                                                             
         STCM  R0,15,DUB1                                                       
         OI    DUB1+3,X'0C'        'OR' IN PACKED SIGN VALUE                    
         AP    DUB1(4),=P'600'     ADJUST TO REAL (EST) TIME                    
*                                                                               
         GOTOR VDATCON,DMCB,(5,0),(0,DUB)   THE TIME                            
*                                                                               
         CP    DUB1(4),=P'2400'    PAST MIDNIGHT?                               
         JL    GETCDT1                                                          
         SP    DUB1(4),=P'2400'    YES, BUMP TO NEXT DAY AND ADJUST             
         GOTOR VADDAY,DMCB,DUB,DUB,F'1'                                         
*                                                                               
GETCDT1  GOTOR VDATCON,DMCB,(0,DUB),(2,WORK)                                    
         OI    DUB1+3,X'0F'                                                     
         UNPK  WORK+2(4),DUB1(4)                                                
         B     EXITY                                                            
                                                                                
ARYOHS   LKOUT A,(R,NXTOHS),MULTIROW=Y,ROWNAME=OHISRECD                         
                                                                                
BLin#    LKOUT C,1,OHISBKLN,LBIN,ND=Y                                           
BLin#2bt LKOUT C,1,OHISBKL2,LBIN,ND=Y                                           
Rottn    LKOUT C,2,OBDDAY,LBIN                                                  
StTim    LKOUT C,3,OBDTIME,LBIN,LEN=2                                           
EnTim    LKOUT C,4,OBDTIME+2,LBIN,LEN=2                                         
PRouc    LKOUT P,OBDELEM,SETCST                                                 
BCost    LKOUT C,5,(D,B#SAVED,OHSRATE),LBIN                                     
CInds    LKOUT C,6,OBDCIND,HEXD,LEN=L'OBDCIND+L'OBDCIND2                        
SptLn    LKOUT C,7,OBDSEC,LBIN                                                  
Progm    LKOUT C,8,OBDPROG,CHAR                                                 
Statn    LKOUT C,9,(D,B#SAVED,OHSQSTA),CHAR                                     
PRout    LKOUT P,OBDDEMS,SETOHD                                                 
Array    LKOUT C,16,(A,ARYOHSD)                                                 
PRout    LKOUT P,OHISRECD,BLDOHW                                                
Array    LKOUT C,3,(A,ARYOHW)                                                   
Array    LKOUT C,4,(A,ARYOHO)                                                   
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* READ ORDER HISTORY RECORDS                                          *         
***********************************************************************         
                                                                                
NXTOHS   GOTOR (#NXTREC,ANXTREC),DMCB,OHSKEYT,('B#OHSREC',0),          +        
               ('$NXTRXSP',SAVED),0,0                                           
         JNE   EXITY                                                            
         L     R4,AOHSREC                                                       
         CLI   OBDELEM-OHISRECD(R4),OBDELEMQ                                    
         JNE   NXTOHS                                                           
*                                                                               
         MVC   BYTE,OHISBKAM-OHISRECD(R4)    LETS SET BUYMED                    
         NI    BYTE,X'0F'                                                       
         MVI   BUYMED,C'T'                                                      
         CLI   BYTE,X'01'                                                       
         JE    NXTOHS10                                                         
         MVI   BUYMED,C'R'                                                      
         CLI   BYTE,X'02'                                                       
         JE    NXTOHS10                                                         
         MVI   BUYMED,C'X'                                                      
         CLI   BYTE,X'04'                                                       
         JNE   *+2                                                              
*                                                                               
NXTOHS10 GOTOR GETSTA,OHISBKMK-OHISRECD(R4)                                     
         MVC   OHSQSTA,STAPQSTA                                                 
         B     EXITY                                                            
                                                                                
SETCST   L     R1,LP_AINP          SET NUMBER OF DEMOS                          
         SR    R0,R0                                                            
         ICM   R0,7,OBDCOST-OBDELEM(R1)                                         
         TM    OBDCIND-OBDELEM(R1),BDCMINSQ  TEST MINUS RATE                    
         JZ    *+6                                                              
         LNR   R0,R0                                                            
         TM    OBDCIND2-OBDELEM(R1),BDCNBRDQ DEFAULT IS PENNIES                 
         JZ    *+8                 UNLESS THE INDICATOR SAYS NOT                
         MHI   R0,100              CONVERT TO PENNIES                           
         STCM  R0,15,OHSRATE                                                    
         LTR   R0,R0                                                            
         B     SETCCC                                                           
                                                                                
SETOHD   L     R1,LP_AINP          SET NUMBER OF DEMOS                          
         SR    R0,R0                                                            
         LHI   RF,(OBDELEMX-OBDDEMS)/L'OBDDEMS                                  
SETOHD02 OC    0(L'OBDDEMS,R1),0(R1)                                            
         JZ    SETOHD04                                                         
         AHI   R1,L'OBDDEMS                                                     
         AHI   R0,1                                                             
         JCT   RF,SETOHD02                                                      
SETOHD04 STCM  R0,3,OHSDEM#                                                     
         LTR   R0,R0                                                            
         B     SETCCC                                                           
                                                                                
ARYOHSD  LKOUT A,(*,OBDDEMS),NROWS=(B#SAVED,OHSDEM#),                  +        
               ROWNAME=OHISRECD,ROWWIDTH=L'OBDDEMS                              
                                                                                
PRout    LKOUT P,(B#SVRDEF,BLDESTOH),SETROUT                                    
PRout    LKOUT P,,INITDEMS                                                      
DemCd    LKOUT C,16,OBDDEMS,(R,EDTDCD)    History demos                         
DemIn    LKOUT C,17,OBDDEMS+4,HEXD,LEN=1  ** ND=Y TEMPORARILY REMOVED           
DemVl    LKOUT C,18,OBDDEMS+4,(R,EDTDVL),LEN=4                                  
                                                                                
         LKOUT E                                                                
                                                                                
***********************************************************************         
* BUILD REGULAR WEEK ARRAY FOR SENDING                                *         
***********************************************************************         
                                                                                
BLDOHW   L     R2,LP_AINP                                                       
         AHI   R2,OBDELEM-OHISRECD                                              
         USING OHSPTEL,R2                                                       
         SR    R0,R0                                                            
BLDOHW02 CLI   OHSPTEL,0                                                        
         JE    *+2                                                              
         CLI   OHSPTEL,OHSPTELQ                                                 
         JE    *+14                                                             
         IC    R0,OHSPTLN                                                       
         AR    R2,R0                                                            
         J     BLDOHW02                                                         
                                                                                
         SR    RE,RE               RE=NUMBER OF ENTRIES IN TABLE                
         IC    R0,OHSPTLN                                                       
         SHI   R0,OHDSPTS-OHSPTEL                                               
         JZ    BLDOHW14                                                         
         LA    R2,OHDSPTS                                                       
         LA    R1,OHSWKS                                                        
         LHI   RF,1                RF=WEEK SEQUENCE NUMBER                      
         DROP  R2                                                               
                                                                                
BLDOHW04 CLI   0(R2),0             TEST ANY SPOTS THIS WEEK                     
         JNE   *+10                                                             
         SR    R3,R3               CLEAR EXPECTED WEEK SEQUENCE NUMBER          
         J     BLDOHW12                                                         
                                                                                
         LTR   RE,RE               TEST FIRST ENTRY TO BE ADDED                 
         JZ    BLDOHW08                                                         
         CR    R3,RF               TEST WEEK IN SEQUENCE                        
         JNE   BLDOHW08                                                         
         CLC   0(1,R2),WORK        TEST NUMBER OF SPOTS THE SAME                
         JNE   BLDOHW08                                                         
         SHI   R1,L'OHSWKS         POINT TO PREVIOUS ENTRY                      
         LLC   R4,1(R1)            BUMP NUMBER OF EXTRA WEEKS THE SAME          
         AHI   R4,1                                                             
         STC   R4,1(R1)                                                         
         AHI   R1,L'OHSWKS         POINT BACK TO NEXT WEEK                      
         J     BLDOHW10                                                         
                                                                                
BLDOHW08 STC   RF,0(R1)            SET WEEK NUMBER                              
         MVI   1(R1),0             SET NUMBER OF EXTRA WEEKS                    
         MVC   2(1,R1),0(R2)       SET NUMBER OF SPOTS                          
         MVC   WORK(1),0(R2)       SAVE NUMBER OF SPOTS                         
         AHI   R1,L'OHSWKS         BUMP OUTPUT TABLE POINTER                    
         AHI   RE,1                BUMP NUMBER OF ENTRIES IN TABLE              
                                                                                
BLDOHW10 LA    R3,1(RF)            SET NEXT EXPECTED WEEK NUMBER                
                                                                                
BLDOHW12 AHI   RF,1                BUMP WEEK NUMBER                             
         AHI   R2,L'OHDSPTS        BUMP TO NEXT WEEK                            
         JCT   R0,BLDOHW04         DO FOR NUMBER OF WEEKS                       
                                                                                
BLDOHW14 STCM  RE,3,OHSWKS#        SET NUMBER OF WEEKS                          
         B     EXITY                                                            
                                                                                
ARYOHW   LKOUT A,(D,B#SAVED,OHSWKS),NEWEL=Y,NROWS=(B#SAVED,OHSWKS#),   +        
               ROWWIDTH=L'OHSWKS                                                
                                                                                
         LKOUT C,1,OHSWKS+0,LBIN,LEN=1         WEEK#                            
         LKOUT C,2,OHSWKS+1,LBIN,LEN=1,ND=Y    # OF EXTRA WEEKS                 
         LKOUT C,3,OHSWKS+2,LBIN,LEN=1         # OF SPOTS                       
                                                                                
         LKOUT E                                                                
                                                                                
ARYOHO   LKOUT A,(D,B#OHSREC,OBDELEM),EOT=EOR,NEWEL=B,                 +        
               ROWID=(OHCOVEL,OHCOVELQ),ROWWIDTH=(V,OHCOVLN)                    
                                                                                
PRout    LKOUT P,OHCCOST,SETOCOST                                               
COver    LKOUT C,1,(D,B#WORKD,WORK),LBIN,LEN=L'OHCCOST                          
PRout    LKOUT P,OHCOVEL,BLDOOW                                                 
Array    LKOUT C,2,(A,ARYOOW)                                                   
                                                                                
         LKOUT E                                                                
                                                                                
SETOCOST L     R1,LP_AINP          SET OVERRIDE COST VALUE IN WORK              
         MVC   WORK(L'OHCCOST),0(R1)                                            
         NI    WORK,FF-X'80'                                                    
         BR    RE                                                               
                                                                                
***********************************************************************         
* BUILD COST OVERRIDE WEEK ARRAY FOR SENDING                          *         
***********************************************************************         
                                                                                
BLDOOW   L     R2,LP_AINP                                                       
         USING OHCOVEL,R2                                                       
         LLC   R0,OHCOVLN                                                       
         SHI   R0,OHCSPOTS-OHCOVEL                                              
         JNP   EXITY               NO OVERRIDES IN ELEMENT                      
*        DC    H'0'                                                             
         LA    R2,OHCSPOTS         R2=A(SPOTS PER WEEK ARRAY                    
         LA    R1,OHOWKS           R1=A(OUTPUT ARRAY)                           
         SR    RE,RE               RE=NUMBER OF OUTPUT ENTRIES                  
         LHI   RF,1                RF=WEEK SEQUENCE NUMBER                      
                                                                                
BLDOOW02 CLI   0(R2),0             TEST ANY SPOTS THIS WEEK                     
         JE    BLDOOW04                                                         
         STC   RF,0(R1)            SET WEEK NUMBER                              
         MVC   1(1,R1),0(R2)       SET NUMBER OF SPOTS                          
         AHI   R1,L'OHOWKS         BUMP OUTPUT ARRAY POINTER                    
         AHI   RE,1                BUMP NUMBER OF OUTPUT ENTRIES                
                                                                                
BLDOOW04 AHI   RF,1                BUMP WEEK NUMBER                             
         AHI   R2,L'OHCSPOTS       BUMP SPOT POINTER                            
         JCT   R0,BLDOOW02         DO FOR NUMBER OF WEEKS                       
                                                                                
         STCM  RE,3,OHOWKS#        SET NUMBER OF ARRAY ENTRIES                  
         B     EXITY                                                            
                                                                                
ARYOOW   LKOUT A,(D,B#SAVED,OHOWKS),NROWS=(B#SAVED,OHOWKS#),           +        
               ROWWIDTH=L'OHOWKS                                                
                                                                                
         LKOUT C,2,OHOWKS+0,LBIN,LEN=1                                          
         LKOUT C,3,OHOWKS+1,LBIN,LEN=1                                          
                                                                                
         LKOUT E                                                                
                                                                                
REQUESTX LKREQ X                                                                
         EJECT                                                                  
*                                                                               
* GET THE DARE ROUTING CODE AND SET IN SVDARERC                                 
*                                                                               
GTDARRT  NTR1  LABEL=NO                                                         
         L     R6,AIO3             READ USER-ID RECORD AND SET                  
         USING CTIREC,R6           DARE ROUTING CODE IN TWA                     
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKNUM,LP_USRID                                                 
         MVC   IOKEY(L'CTIKEY),CTIKEY                                           
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO3'                            
         JNE   *+2                                                              
                                                                                
         LA    R6,CTIDATA          R2=A(FIRST ELEMENT ON ID RECORD)             
         USING CTUSAD,R6                                                        
         SR    R0,R0                                                            
GTDARRT5 CLI   CTUSAEL,EOR         TEST END OF RECORD                           
         JE    GTDARRTX            NO DARE ROUTING SO USE PROFILE AS IS         
         CLI   CTUSAEL,CTUSAELQ    TEST US AGENCY EXTRA INFO ELEMENT            
         JE    *+14                                                             
         IC    R0,CTUSALEN         BUMP TO NEXT ELEMENT ON RECORD               
         AR    R6,R0                                                            
         J     GTDARRT5                                                         
         L     RE,LP_ATWA                                                       
         MVC   SVDARERC-TWAD(,RE),CTUSADRC                                      
GTDARRTX J     EXIT                                                             
         DROP  R6                                                               
***********************************************************************         
* ADD TO LIST OF MISSED NETWORKS                                                
*  - CLOBBERS AIO8 AS IT BUILD THE LIST THERE                                   
***********************************************************************         
ADDNTWK  NTR1  LABEL=NO                                                         
         LR    R2,R1                                                            
         XC    STAPACKD(STAPACKL),STAPACKD                                      
         MVI   STAPACT,C'U'        CONVERT TO ALPHA FORMAT                      
         MVC   STAPAGY,LP_AGY                                                   
         L     RF,AAGYREC                                                       
         MVC   STAPCTRY,AGYPCNDA-AGYHDR(RF)                                     
         MVI   STAPMED,C'T'        MEDIA T FOR CABLE                            
         MVC   STAPACOM,ACOMFACS                                                
         XR    R1,R1                                                            
         ICM   R1,7,1(R2)                                                       
         MVC   STAPSTA,0(R1)       UNPACK THIS BINARY STATION                   
         GOTOR VSTAPACK,STAPACKD                                                
         CLI   STAPERR,0           CAN'T UNPACK BINARY STATION?                 
         JNE   ADNTWKX             NO GOOD                                      
*                                  STAPQNET SHOULD BE SET                       
         L     R6,AIO8                                                          
         XR    R1,R1                                                            
         ICM   R1,3,NUMMNWKS                                                    
         CLI   0(R2),C'M'          MISSED NETWORK?                              
         JE    ADNTWK10            YES                                          
         AHI   R6,1000             NO, HALFWAY AIO8 IS OFFERED NTWKS            
         XR    R1,R1                                                            
         ICM   R1,3,NUMONWKS                                                    
*                                                                               
ADNTWK10 LA    R6,1(R6)            R6 = A(FIRST ENTRY)                          
*                                                                               
         CHI   R1,0                ANY ENTRIES?                                 
         JE    ADNTWK50            NONE, THIS WILL BE OUR FIRST                 
*                                                                               
ADNTWK20 CLC   STAPQNET,0(R6)      DO WE ALREADY HAVE THIS NETWORK?             
         JE    ADNTWKX                                                          
*                                                                               
         LA    R6,L'STAPQNET(R6)   CHECK ALL THE ENTRIES                        
         JCT   R1,ADNTWK20                                                      
*                                                                               
ADNTWK50 MVC   0(L'STAPQNET,R6),STAPQNET                                        
*                                                                               
         LA    RF,NUMMNWKS                                                      
         CLI   0(R2),C'M'          MISSED NETWORK?                              
         JE    *+8                                                              
         LA    RF,NUMONWKS                                                      
*                                                                               
         XR    R1,R1                                                            
         ICM   R1,3,0(RF)                                                       
         LA    R1,1(R1)                                                         
         STCM  R1,3,0(RF)          YES, UPDATE THE STORED NUMBER                
*                                                                               
ADNTWKX  B     EXITY                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* CHECK IF REQUEST NETWORK IS IN THE MAKEGOODS                                  
***********************************************************************         
                                                                                
CHKMKGDS NTR1  LABEL=NO                                                         
         MVC   SVIOVALS,IOVALS                                                  
         CLC   REQNTWK,SPACES      ANY REQUESTED NETWORK?                       
         JNH   CKMKGDYS            NONE                                         
*                                                                               
         CLI   ORDSTAX,X'E8'       CABLE STATION?                               
         JL    CKMKGDYS            NO, CAN'T HAVE NETWORK                       
*                                                                               
         XC    STAPACKD(STAPACKL),STAPACKD                                      
         MVI   STAPACT,C'U'        CONVERT TO PACKED FORMAT                     
         MVC   STAPAGY,LP_AGY                                                   
         L     RF,AAGYREC                                                       
         MVC   STAPCTRY,AGYPCNDA-AGYHDR(RF)                                     
         MVI   STAPMED,C'T'        MEDIA T FOR CABLE                            
         MVC   STAPACOM,ACOMFACS                                                
         MVC   STAPSTA,ORDSTAX     GET ALPHA STATION CALL LETTERS               
         GOTOR VSTAPACK,STAPACKD                                                
         CLI   STAPERR,0           CAN'T UNPACK BINARY STATION?                 
         JNE   CKMKGDNO            NO GOOD                                      
*                                                                               
         MVC   STAPQNET,REQNTWK                                                 
         MVI   STAPACT,C'P'        NOW WE PACK SYSCODE WITH THE NETWORK         
         GOTOR VSTAPACK,STAPACKD                                                
         CLI   STAPERR,0           PACK SYSCODE AND NETWORK                     
         JNE   CKMKGDNO            WE CAN'T, NO GOOD                            
*                                                                               
         L     R3,AORDREC          R3=A(ORDER RECORD)                           
         USING DAREORDD,R3                                                      
         XC    IOKEY,IOKEY                                                      
         LA    R2,IOKEY                                                         
         USING MNXKEY,R2                                                        
         MVI   MNXKTYPE,MNXKTYPQ   X'0D' - TYPE                                 
         MVI   MNXKSBTY,MNXKSBTQ   X'36' - SUBTYPE                              
         MVC   MNXKAGMD,DOKAGMD                                                 
         MVC   MNXKORDR,DOKORDER                                                
         DROP  R3                                                               
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOHID+IOXSPDIR+IO3'                           
         JE    CKMKGD10                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    CKMKGDNO            NO, SOME OTHER ERROR, EXITN                  
*                                                                               
CKMKGD10 CLC   IOKEY(MNXKGRP-MNXKEY),IOKEYSAV   STILL SAME ORDER?               
         JNE   CKMKGD50                         MAYBE FOR OFFERS?               
*                                                                               
CKMKGD15 MVC   MNXKSTTN,STAPSTA    FOR THIS NOTICE, LOOK FOR STATN              
         GOTOR (#IOEXEC,AIOEXEC),'IOHID+IOXSPDIR+IO3'                           
         JE    CKMKGD20                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    CKMKGDNO            SOME OTHER ERROR, EXITN                      
*                                                                               
CKMKGD20 CLC   IOKEY(MNXKSEQ-MNXKEY),IOKEYSAV   HAVE NOTICE FOR STA?            
         JE    CKMKGDYS                         YES                             
         CLC   IOKEY(MNXKGRP-MNXKEY),IOKEYSAV   STILL SAME ORDER?               
         JNE   CKMKGD50                         MAYBE FOR OFFERS?               
         CLC   MNXKSTTN,STAPSTA    STATION IS LOWER?                            
         JL    CKMKGD15            YES, SET STATION THEN                        
*                                                                               
         XR    RF,RF               NO, HIGHER                                   
         ICM   RF,7,MNXKGRP        INCREMENT GROUP CODE                         
         LA    RF,1(RF)                                                         
         STCM  RF,7,MNXKGRP                                                     
         J     CKMKGD15            AND SET THE STATION                          
*                                                                               
CKMKGD50 L     R3,AORDREC          R3=A(ORDER RECORD)                           
         USING DAREORDD,R3                                                      
         XC    IOKEY,IOKEY                                                      
         LA    R2,IOKEY                                                         
         USING MOXKEY,R2                                                        
         MVI   MOXKTYPE,MOXKTYPQ   X'0D' - TYPE                                 
         MVI   MOXKSBTY,MOXKSBTQ   X'37' - SUBTYPE                              
         MVC   MOXKAGMD,DOKAGMD                                                 
         MVC   MOXKORDR,DOKORDER                                                
         DROP  R3                                                               
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOHID+IOXSPDIR+IO6'                           
         JE    CKMKGD60                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    CKMKGDNO            NO, SOME OTHER ERROR, EXITN                  
*                                                                               
CKMKGD60 CLC   IOKEY(MOXKMGCD-MOXKEY),IOKEYSAV   STILL SAME ORDER?              
         JNE   CKMKGDNO                         MAYBE FOR OFFERS?               
*                                                                               
CKMKGD65 MVC   MOXKSTTN,STAPSTA    FOR THIS OFFER, LOOK FOR STATN               
         GOTOR (#IOEXEC,AIOEXEC),'IOHID+IOXSPDIR+IO6'                           
         JE    CKMKGD70                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    CKMKGDNO                                                         
*                                                                               
CKMKGD70 CLC   IOKEY(MOXKSEQ-MOXKEY),IOKEYSAV   HAVE OFFER FOR STA?             
         JE    CKMKGDYS                         YES                             
         CLC   IOKEY(MOXKMGCD-MOXKEY),IOKEYSAV  STILL SAME ORDER?               
         JNE   CKMKGDNO                         MAYBE FOR OFFERS?               
         CLC   MOXKSTTN,STAPSTA    STATION IS LOWER?                            
         JL    CKMKGD65            YES, SET STATION THEN                        
*                                                                               
         XR    RF,RF               NO, HIGHER                                   
         ICM   RF,7,MOXKMGCD       INCREMENT GROUP CODE                         
         LA    RF,1(RF)                                                         
         STCM  RF,7,MOXKMGCD                                                    
         J     CKMKGD65            AND SET THE STATION                          
*                                                                               
CKMKGDYS MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     EXITY                                                            
*                                                                               
CKMKGDNO MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     EXITN                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* READ THE DAGY ROUTE RECORDS TO SEE IF WE NEED TO REPLACE THE OFFICE *         
* OF THE REP                                                          *         
***********************************************************************         
                                                                                
GETAGR   NTR1  LABEL=NO                                                         
         OC    DAREROUT,DAREROUT   HAVE ROUTING CODE?                           
         JZ    GETAGRX             NO                                           
*                                                                               
         LA    R2,IOKEY            SEE IF THERE IS A DAGYROUT RECORD            
         USING AGRKEY,R2           FOR THE DARE ROUTING CODE                    
         XC    AGRKEY,AGRKEY                                                    
         MVI   AGRKSYS,AGRKSYSQ                                                 
         MVI   AGRKTYP,AGRKTYPQ                                                 
         MVC   AGRKMEDA,QMEDA                                                   
         MVC   AGRKAGRT,DAREROUT                                                
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOGENDIR+IO4'                            
         JNE   GETAGRX             NO DAGYROUT REC, USE SAME OFFICE             
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOGENFIL+IO4'                           
         JNE   GETAGRX                                                          
                                                                                
         L     R2,IOADDR           R2=A(AGENCY ROUTING RECORD)                  
         LA    R2,AGRFSTEL         R2=A(FIRST ELEMENT ON RECORD)                
         USING AGROVRD,R2                                                       
GETAGR02 CLI   AGROVRC,EOR         TEST END OF RECORD                           
         JE    GETAGRX                                                          
         CLI   AGROVRC,AGROVRCQ    TEST REP OFFICE OVERRIDE ELEMENT             
         JNE   GETAGR04                                                         
*                                  SAME AS OUR REP?                             
         CLC   AGROVRCR,DAPTCODE-DAREPTD+R4RDRTAB                               
         JNE   GETAGR04            NO, KEEP LOOKING                             
         MVC   R4ROVOFF,AGROVROF   SET OVERRIDE OFFICE                          
         J     GETAGRX                                                          
GETAGR04 LLC   R0,AGROVRLN         BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         J     GETAGR02                                                         
                                                                                
GETAGRX  B     EXITY                                                            
         DROP  R2                                                               
         EJECT                                                                  
***********************************************************************         
* GET DARE ORDER COMMENT RECORDS/ORDER URL RECORD                     *         
***********************************************************************         
                                                                                
GETCOM   CLI   LP_RMODE,LP_RFRST                                                
         BNE   NOMORE                                                           
         MVC   SVIOVALS,IOVALS                                                  
         L     RF,AORDREC                 GET A(ORDER RECORD)                   
         MVC   IOKEY(L'DOKEY),0(RF)       BUILD KEY OFF ORDER KEY               
         STC   R1,IOKEY+(DOKCMT-DOKEY)    SET CMT TYPE OVERRIDE                 
         GOTOR (#IOEXEC,AIOEXEC),'IOBRD+IODIR+B#OBCREC'                         
         JNE   GETCOMN                                                          
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#OBCREC'                        
         JNE   GETCOMN                                                          
         MVC   COMDA,IODA          SET COMMENT DISK ADDRESS                     
         GOTOR GETSUM,COMCKSM      SET COMMENT CHECK SUM                        
         MVC   LP_ADATA,AOBCREC                                                 
         MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     EXITY                                                            
                                                                                
GETCOMN  MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     NOMORE                                                           
         EJECT                                                                  
***********************************************************************         
* READ DARE MAKEGOOD OFFER RECORDS                                              
*                                                                               
* NTRY:- IOKEY CONTAINS KEY OF OFFER RECORD TO READ                             
*                                                                               
* NOTE:- THERE MAY BE TWO OFFER RECORDS - IF THERE ARE, THE ELEMENTS            
*        FROM THE SECOND RECORD ARE ATTACHED TO THE END OF THE FIRST            
*        WHICH EFFECTIVELY MEANS THAT I/O AREA 5 CANNOT BE USED                 
*        WHILE OFFER RECORD ARRAYS ARE BEING PROCESSED.  IN ADDITION            
*        THERE MAY ALSO BE AN OFFER DEMO RECORD - IF THERE IS THE               
*        RECORD IS READ AND MDDFOUND IS SET TO YESQ                             
*                                                                               
* NOTE:  WE'RE NOT USING THIS ROUTINE FOR CABLE ORDERS                          
***********************************************************************         
                                                                                
GETOFF   NTR1  LABEL=NO                                                         
         XC    OFFVALS(OFFVALL),OFFVALS                                         
         MVI   MDDFOUND,NOQ        SET OFFER DEMO RECORD NOT FOUND              
         MVI   MSDFOUND,NOQ        SET SELLER DEMO RECORD NOT FOUND             
*                                                                               
         LA    R2,IOKEY                                                         
         USING MOKEY,R2            R2=A(MAKEGOOD OFFER KEY)                     
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IODIR+B#OFFREC'                        
         JE    *+12                                                             
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#OFFREC'                        
         JE    *+12                                                             
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
         MVC   OFFDA1,IODA         SET RECORD 1 DISK ADDRESS                    
         GOTOR GETSUM,OFFCKSM1     SET RECORD 1 CHECK SUM                       
*                                                                               
* CHECK FOR SPANNED MKGD OFFER RECORD                                           
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IODIR+B#OFFRC2'                        
         JE    GETOFF10                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
                                                                                
GETOFF10 CLC   MOKEY(MOKSEQ-MOKEY),IOKEYSAV                                     
         JNE   GETOFF15                                                         
         CLI   MOKSEQ,MOKSEQDQ     X'FF' LOOKUP DEMO?                           
         JE    GETOFF15                                                         
         CLI   MOKSEQ,MOKSQSDQ     X'FE' SELLER DEMO?                           
         JE    GETOFF15                                                         
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#OFFRC2'                        
         JE    GETOFF12                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         CLI   SVMNSTAT,MNSTCAN    DELETED BECAUSE OF CANCELLED?                
         JNE   GETOFF15             NO, DON'T JOIN                              
*                                                                               
GETOFF12 MVC   OFFDA2,IODA         SET RECORD 2 DISK ADDRESS                    
         GOTOR GETSUM,OFFCKSM2     SET RECORD 2 CHECK SUM                       
*                                                                               
         L     R2,AOFFREC          JOIN THE TWO RECORDS TOGETHER                
         SR    RE,RE                                                            
         ICM   RE,3,MORLEN                                                      
         LA    RE,DAREMGOD(RE)                                                  
         CLI   0(RE),EOR                                                        
         JNE   *+2                                                              
         L     R1,AOFFRC2                                                       
         SR    RF,RF                                                            
         ICM   RF,3,MORLEN-DAREMGOD(R1)                                         
*                                                                               
         LA    R2,0(RF,R1)         R2 = A(BYTE) AFTER EOR IN AIO5               
         XC    0(2,R2),0(R2)                                                    
         AHI   RF,2                FORCE MOVE OF THE 2 BYTE OF X'00'S           
*                                                                               
         SHI   RF,MORFRST-DAREMGOD                                              
         LA    R0,MORFRST-DAREMGOD(R1)                                          
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
*                                                                               
* CHECK FOR SELLER DEMO RECORD (XSPOT FILE)                                     
*                                                                               
GETOFF15 L     R2,AOFFREC                                                       
         MVC   IOKEY(MOKSEQ-MOKEY),0(R2)                                        
         MVI   IOKEY+(MOKSEQ-MOKEY),MOKSQSDQ                                    
         GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IODIR+B#SDMREC'                        
         JNE   GETOFF20                                                         
*                                                                               
GETOFF17 CLC   IOKEY(L'MOKEY),IOKEYSAV  RECORD FOUND?                           
         JNE   GETOFF20                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#SDMREC'                        
         JNE   *+2                                                              
         MVI   MSDFOUND,YESQ       SET SELLER DEMO RECORD FOUND                 
*                                                                               
* CHECK FOR DEMO RECORD (SPOTFILE)                                              
*                                                                               
GETOFF20 L     R2,AOFFREC                                                       
         MVC   IOKEY(MOKSEQ-MOKEY),0(R2)                                        
         MVI   IOKEY+(MOKSEQ-MOKEY),MOKSEQDQ                                    
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IODIR+B#MDDREC'                        
         TM    IOERR,IOERNF        TEST RECORD NOT FOUND                        
         JNZ   EXITY                                                            
         CLI   IOERR,0             TEST RECORD FOUND                            
         JE    GETOFF30                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
GETOFF30 GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#MDDREC'                        
         JE    GETOFF40                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
                                                                                
GETOFF40 MVI   MDDFOUND,YESQ       SET OFFER DEMO RECORD FOUND                  
         J     EXITY                                                            
         DROP  R2                                                               
         EJECT                                                                  
*                                                                               
************                                                                    
* SAME AS ABOVE BUT THIS SUPPORTS CABLE X-SPOT MAKEGOOD OFFER                   
************                                                                    
GETXOFF  NTR1  LABEL=NO                                                         
         MVI   MSDFOUND,NOQ        SET SELLER DEMO RECORD NOT FOUND             
         MVI   MDDFOUND,NOQ        SET OFFER DEMO RECORD NOT FOUND              
*                                                                               
         LA    R2,IOKEY                                                         
         USING MOXKEY,R2           R2=A(MAKEGOOD OFFER KEY)                     
*                                                                               
         CLI   LP_RMODE,LP_RFRST   FIRST TIME IN?                               
         JNE   GTXOFF20             NO                                          
         XC    OFFVALS(OFFVALL),OFFVALS                                         
         MVI   OFFFILE,C'X'        D/A FOR XSPFIL                               
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IOXSPDIR+B#OFFREC'                     
         JE    *+12                                                             
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#OFFREC'                     
         JNE   *+2                                                              
*                                                                               
         MVC   OFFDA1,IODA         SET RECORD DISK ADDRESS                      
         GOTOR GETXSUM,OFFCKSM1     SET RECORD CHECK SUM                        
*                                                                               
* CHECK FOR SPANNED MKGD OFFER RECORD                                           
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#OFFRC2'                     
         JE    GTXOFF10                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
GTXOFF10 CLC   MOXKEY(MOXKSEQ-MOKEY),IOKEYSAV                                   
         JNE   GTXOFFX                                                          
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#OFFRC2'                     
         JE    GTXOFF15                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
         CLI   SVMNSTAT,MNSTCAN    DELETED BECAUSE OF CANCELLED?                
         JNE   GTXOFFX              NO, DON'T JOIN                              
*                                                                               
GTXOFF15 MVC   OFFDA2,IODA         SET RECORD 2 DISK ADDRESS                    
         GOTOR GETXSUM,OFFCKSM2    SET RECORD 2 CHECK SUM                       
*                                                                               
         BRAS  RE,GTXOFFJN         JOIN AOFFREC AND AOFFRC2                     
         J     GTXOFFX                                                          
*                                                                               
* READ THE NETWORK OFFER RECORDS                                                
*                                                                               
GTXOFF20 L     RF,AOFFREC          READ MKGD OFFER NTWK SEREC                   
         XC    IOKEY,IOKEY                                                      
         MVC   IOKEY(MOXKDTYP-MOXKEY),0(RF)                                     
         MVI   IOKEY+MOXKDTYP-MOXKEY,X'FF'                                      
         MVI   IOKEY+MOXKSEQ-MOXKEY,X'FF'                                       
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IOXSPDIR+B#OFFREC'                     
         J     GTXOFF27                                                         
*                                                                               
GTXOFF25 GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#OFFREC'                     
GTXOFF27 JE    GTXOFF30                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                 DIE IF ANY OTHER HORRIBLE ERROR              
         CLI   SVMNSTAT,MNSTCAN    DELETED BECAUSE OF CANCELLED?                
         JNE   GTXOFF25            NO, READ THE NEXT ONE                        
*                                                                               
GTXOFF30 CLC   IOKEY(MOXKSTTN-MOXKEY),IOKEYSAV  SAME ORDER/GROUP?               
         JNE   GTXOFFN                                                          
         CLC   MOXKSTTN,HZEROS     HAVE STATION?                                
         JE    GTXOFF25             NO, SKIP IT                                 
         ICM   RF,3,MOXKDTYP        IS IT A BASE NETWORK REC?                   
         JNZ   GTXOFF25              NO, SKIP IT                                
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#OFFREC'                     
         JNE   *+2                                                              
         MVC   OFFDA1,IODA         SET RECORD DISK ADDRESS                      
         MVI   OFFFILE,C'X'        D/A FOR XSPFIL                               
*                                                                               
* CHECK FOR SPANNED MKGD OFFER RECORD                                           
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBSQD+IOXSPDIR+B#OFFRC2'                     
         JE    GTXOFF40                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
                                                                                
GTXOFF40 CLC   MOXKEY(MOXKSEQ-MOKEY),IOKEYSAV                                   
         JNE   GTXOFF45                                                         
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#OFFRC2'                     
         JE    *+12                                                             
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
         BRAS  RE,GTXOFFJN         JOIN AOFFREC AND AOFFRC2                     
*                                                                               
* CHECK FOR SELLER DEMO RECORD (XSPOT FILE)                                     
*                                                                               
GTXOFF45 L     RF,AOFFREC          READ MKGD OFFER NTWK SELLER DEMO REC         
         XC    IOKEY,IOKEY                                                      
         MVC   IOKEY(MOXKSEQ-MOXKEY),0(RF)                                      
         MVI   IOKEY+(MOXKDTYP-MOXKEY),MOXKSDMQ    X'FE'                        
         GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IOXSPDIR+B#SDMREC'                     
         JE    GTXOFF50                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                 DIE IF ANY OTHER HORRIBLE ERROR              
         CLI   SVMNSTAT,MNSTCAN    DELETED BECAUSE OF CANCELLED?                
         JNE   GTXOFF60            NO, READ THE NEXT ONE                        
*                                                                               
GTXOFF50 CLC   IOKEY(L'MOXKEY),IOKEYSAV  RECORD FOUND?                          
         JNE   GTXOFF60                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#SDMREC'                     
         JNE   *+2                                                              
         MVI   MSDFOUND,YESQ       SET SELLER DEMO RECORD FOUND                 
*                                                                               
* CHECK FOR DEMO RECORD (XSPOT FILE)                                            
*                                                                               
GTXOFF60 L     RF,AOFFREC          READ MKGD OFFER NTWK DEMO DEF REC            
         XC    IOKEY,IOKEY                                                      
         MVC   IOKEY(MOXKSEQ-MOXKEY),0(RF)                                      
         MVI   IOKEY+(MOXKDTYP-MOXKEY),MOXKDDMQ    X'FF'                        
         GOTOR (#IOEXEC,AIOEXEC),'IOBHID+IOXSPDIR+B#MDDREC'                     
         CLI   IOERR,0             TEST RECORD FOUND                            
         JE    GTXOFF90                                                         
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JZ    *+2                                                              
*                                                                               
GTXOFF90 CLC   IOKEY(L'MOXKEY),IOKEYSAV  RECORD FOUND?                          
         JNE   GTXOFFX                                                          
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOXSPFIL+B#MDDREC'                     
         JNE   *+2                                                              
         MVI   MDDFOUND,YESQ       SET OFFER DEMO RECORD FOUND                  
GTXOFFX  J     EXITY                                                            
GTXOFFN  J     EXITN                                                            
*&&DO                                                                           
GTXOFFN  L     R2,AOFFREC                                                       
         XC    IOKEY,IOKEY                                                      
         MVC   IOKEY(MOXKSEQ-MOXKEY),0(R2)                                      
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IOXSPDIR+B#OFFREC'                     
         JE    MORE                                                             
         TM    IOERR,IOEDEL        TEST DELETED                                 
         JNZ   MORE                                                             
         DC    H'0'                                                             
*&&                                                                             
         DROP  R2                                                               
*                                                                               
* ROUTINE TO JOIN AOFFREC WITH AOFFRC2                                          
*                                                                               
GTXOFFJN NTR1  LABEL=*                                                          
         L     R2,AOFFREC          JOIN THE TWO RECORDS TOGETHER                
         SR    RE,RE                                                            
         ICM   RE,3,MOXRLEN-DAREMGOD(R2)                                        
         LA    RE,0(RE,R2)                                                      
         CLI   0(RE),EOR           RE = A(BYTE) AFTER EOR IN AOFFREC            
         JNE   *+2                                                              
         L     R1,AOFFRC2                                                       
         SR    RF,RF                                                            
         ICM   RF,3,MOXRLEN-DAREMGOD(R1)                                        
*                                                                               
         LA    R2,0(RF,R1)         R2 = A(BYTE) AFTER EOR IN AOFFRC2            
         XC    0(2,R2),0(R2)                                                    
         AHI   RF,2                FORCE MOVE OF THE 2 BYTE OF X'00'S           
*                                                                               
         SHI   RF,MOXFRST-DAREMGOD                                              
         LA    R0,MOXFRST-DAREMGOD(R1)                                          
         LR    R1,RF                                                            
         MVCL  RE,R0                                                            
         J     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE USER-ID (USED ONLY FOR SALESPERSON DOWNLOAD - X'00D7')     *         
***********************************************************************         
                                                                                
VALUID   XC    REPOFF,REPOFF                                                    
         LM    R2,R4,LP_AINP                                                    
         LA    R1,IOKEY                                                         
         USING CTIREC,R1                                                        
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         BCTR  R3,0                                                             
         BASR  RE,0                                                             
         MVC   CTIKID(0),0(R2)                                                  
         EX    R3,0(RE)                                                         
         OC    CTIKID,SPACES                                                    
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO3'                            
         JE    VALUID02                                                         
                                                                                
         LM    R2,R4,LP_AINP                                                    
         LA    R1,IOKEY                                                         
         MVC   IOKEY,IOKEYSAV                                                   
         LA    R3,CTIKID-2(R3)     FORCE -NY ID AS REDI XML DO NOT              
         MVC   REPOFF,0(R3)                                                     
         MVC   0(2,R3),=C'NY'                                                   
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE+IO3'                            
         BNE   EXIT                                                             
         DROP  R1                                                               
                                                                                
         USING CTIREC,R2                                                        
VALUID02 L     R2,IOADDR                                                        
         LA    R2,CTIDATA                                                       
         SR    R0,R0                                                            
         USING CTAGYD,R2                                                        
VALUID04 CLI   CTAGYEL,0                                                        
         BE    EXITN                                                            
         CLI   CTAGYEL,CTAGYELQ                                                 
         JE    *+14                                                             
         IC    R0,CTAGYLEN                                                      
         AR    R2,R0                                                            
         J     VALUID04                                                         
         MVC   REPAGY,CTAGYID                                                   
         MVC   0(L'CTAGYID,R4),CTAGYID                                          
                                                                                
         L     R2,IOADDR                                                        
         USING CTIREC,R2                                                        
                                                                                
         GOTOR VGETDARE,DMCB,(C'U',0),CTIKID,AIO8,A(IO8LQ),VDATAMGR             
         JNE   VALUIDX                                                          
                                                                                
         L     RE,AIO8                                                          
         USING DAREPTD,RE                                                       
         OC    REPOFF,REPOFF       REPOFF ALREADY SET FROM ABOVE                
         JNZ   VALUIDX             AFTER FORCING -NY ?                          
                                                                                
         TM    DAPTFLG1,DPF1NOOF   X'80'- DOES THE REP APPEND OFFICE?           
         JO    VALUIDX             NO                                           
         SR    RF,RF                                                            
         IC    RF,DAPTLPFX                                                      
         LA    RF,CTIKID(RF)                                                    
         MVC   REPOFF,0(RF)        GET THE OFFICE                               
                                                                                
VALUIDX  B     EXITY                                                            
         DROP  R2,RE                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE PRODUCT CODE                                               *         
***********************************************************************         
                                                                                
VALPRC   LM    R2,R4,LP_AINP                                                    
         CLC   POLPRD,0(R2)        'POL' IS INVALID                             
         BE    EXITN                                                            
         CLC   ALLPRD,0(R2)        'ALL' IS INVALID                             
         BE    EXITN                                                            
         GOTOR (#VALPRD,AVALPRD),LP_AINP                                        
         BNE   EXIT                                                             
         SR    R0,R0                                                            
         IC    R0,0(R4)                                                         
         STCM  R0,7,0(R4)                                                       
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE A STATION CODE AND SET MARKET                              *         
***********************************************************************         
                                                                                
VALSTN   MVC   QSTAA,SPACES        GET STATION CALL LETTERS                     
         L     RF,LP_AINP                                                       
         L     R1,LP_ILEN                                                       
         SHI   R1,1                                                             
         BASR  RE,0                                                             
         MVC   QSTAA(0),0(RF)      STATION CODE (ALPHA)                         
         EX    R1,0(RE)                                                         
                                                                                
         MVI   LP_VPARM,$VALSPAK   SET PACKED STATION                           
         GOTOR (#VALSTA,AVALSTA),DMCB,QSTAA,L'QSTAA,STAPACKD                    
         BNE   EXIT                                                             
         L     RF,LP_AOUT                                                       
         MVC   0(L'STAPSTA,RF),STAPSTA                                          
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE STATION CALL LETTERS FOR OM READ FOR ROUTES                *         
***********************************************************************         
                                                                                
VALSCL   LM    R2,R4,LP_AINP                                                    
         MVI   LP_VPARM,$VALSPAK                                                
         GOTOR (#VALSTA,AVALSTA),DMCB,(R2),(R3),WORK                            
         MVC   STACALL1,WORK+(STAPQSTA-STAPACKD)                                
         MVC   0(L'STAPSTA,R4),WORK+(STAPSTA-STAPACKD)                          
         B     EXIT                                                             
                                                                                
***********************************************************************         
* VALIDATE ORDER STATUS                                               *         
***********************************************************************         
                                                                                
VALSTA   LM    R2,R4,LP_AINP                                                    
         MVC   0(L'ORDISTAT,R4),0(R2)                                           
         MVI   L'ORDISTAT(R4),FF                                                
         CHI   R3,1                                                             
         BE    EXITY                                                            
         MVC   L'ORDISTAT(L'ORDPSTAT,R4),L'ORDISTAT(R2)                         
         B     EXITY                                                            
                                                                                
***********************************************************************         
* VALIDATE ORDER STATUS QUALIFIER                                     *         
***********************************************************************         
                                                                                
VALQUA   LM    R2,R4,LP_AINP                                                    
         CLI   0(R2),C'*'          TEST ALL                                     
         JNE   *+12                                                             
         MVI   0(R4),FF                                                         
         B     EXITY                                                            
         CLI   0(R2),C'P'          TEST PARTIAL CONFIRM                         
         JNE   *+12                                                             
         MVI   0(R4),DCNFMCOM                                                   
         B     EXITY                                                            
         CLI   0(R2),C'F'          TEST FULL CONFIRM                            
         JNE   *+12                                                             
         MVI   0(R4),DCNFMFUL                                                   
         B     EXITY                                                            
         CLI   0(R2),C'A'          TEST REJECT AMEND                            
         JNE   *+12                                                             
         MVI   0(R4),DRJTAMND                                                   
         B     EXITY                                                            
********                                                                        
* TAKE CARE USING CANCEL STATUS AS SENT/SENDING USE A DIFFERENT BIT             
*   THAN CANCEL CONFIRMED AND CANCEL REJECTED (MODIFIED IN NXTSOD)              
********                                                                        
         CLI   0(R2),C'C'          TEST CANCELLED                               
         BNE   EXITN                                                            
         MVI   0(R4),DCNFMCAN      X'01' - WORKS FOR BOTH CONF & REJ            
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* VALIDATE CLIENT/MARKET FOR SUBSCRIPTION ORDER DOWNLOAD              *         
***********************************************************************         
                                                                                
VALSCM   LM    R2,R4,LP_AINP                                                    
         CLI   0(R2),C'*'          TEST ALL MARKET/CLIENT SUBSCRIPTION          
         BE    EXITY                                                            
         CLC   =C'ALL',0(R2)       TEST ALL MARKET/CLIENT SUBSCRIPTION          
         BE    EXITY                                                            
                                                                                
         MVC   TEMP,SPACES                                                      
         SHI   R3,1                                                             
         BASR  RE,0                                                             
         MVC   TEMP(0),0(R2)                                                    
         EX    R3,0(RE)                                                         
         ICM   R0,15,SCANCHAR                                                   
         GOTOR VSCANNER,DMCB,(C'C',TEMP),ELEM,(R0)                              
         SR    R0,R0                                                            
         ICM   R0,1,4(R1)                                                       
         BZ    EXITN                                                            
         STC   R0,0(R4)                                                         
         AHI   R4,1                                                             
         LA    R2,ELEM                                                          
                                                                                
         CLI   LP_VPARM,SOLFMKTQ   TEST MARKET VALIDATION                       
         JNE   VALSCM04                                                         
         CHI   R0,SOLFMKT$         TEST TOO MANY MARKETS                        
         BH    EXITN                                                            
                                                                                
VALSCM02 TM    2(R2),X'80'         TEST NUMERIC                                 
         BZ    EXITN                                                            
         OC    4(2,R2),4(R2)       AND NOT GREATER THAN 64K                     
         BNZ   EXITN                                                            
         MVC   0(L'SOLFMKT,R4),6(R2)                                            
         AHI   R2,32                                                            
         AHI   R4,L'SOLFMKT                                                     
         JCT   R0,VALSCM02                                                      
         B     EXITY                                                            
                                                                                
VALSCM04 CLI   LP_VPARM,SOLFCLTQ   TEST CLIENT VALIDATION                       
         BNE   EXITN                                                            
         CHI   R0,SOLFCLT$         TEST TOO MANY CLIENTS                        
         BH    EXITN                                                            
                                                                                
VALSCM06 LLC   RF,0(R2)                                                         
         GOTOR (#VALCLT,AVALCLT),DMCB,12(R2),(RF),(R4)                          
         BNE   EXITN                                                            
         AHI   R2,32                                                            
         AHI   R4,L'SOLFCLT                                                     
         JCT   R0,VALSCM06                                                      
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO VALIDATE PRODUCT CODE                                    *         
***********************************************************************         
                                                                                
VALPRD   CLC   LP_QMAPN,SDORDL#    LOCKED ORDERS REQUEST DOES NOT CARE          
         JE    VALPRD02            ABOUT BPOL AND TPOL RULES                    
                                                                                
         L     R1,ACLTREC                                                       
         CLI   CPROF-CLTRECD(R1),C'0'                                           
         JNE   VALPRD02                                                         
         L     R1,LP_AINP          FOR TRUE POOL ENSURE POL PRODUCT             
         CLC   POLPRD,0(R1)                                                     
         JE    VALPRD02                                                         
         LHI   R0,1220             RETURN ERROR IF NOT                          
         STCM  R0,3,LP_ERROR                                                    
         XC    0(3,R1),0(R1)       CLEAR THIS OUT FOR THE ERROR OFFLINE         
         B     EXITN                                                            
                                                                                
VALPRD02 GOTOR (#VALPRD,AVALPRD),LP_AINP                                        
         B     EXIT                                                             
                                                                                
***********************************************************************         
* ROUTINE TO VALIDATE MARKET FOR BUY DOWNLOAD                         *         
***********************************************************************         
                                                                                
VALMKT   L     R1,LP_AINP                                                       
         L     RF,LP_ILEN                                                       
         SHI   RF,1                                                             
         MVC   DUB,EZEROS                                                       
         BASR  RE,0                                                             
         MVZ   DUB(0),0(R1)                                                     
         EX    RF,0(RE)                                                         
         CLC   DUB,EZEROS                                                       
         BNE   EXITN                                                            
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         PACK  DUB,0(0,R1)                                                      
         OI    DUB+L'DUB-1,X'0F'                                                
         LA    R1,IOKEY                                                         
         USING MKTRECD,R1                                                       
         XC    MKTKEY,MKTKEY                                                    
         MVI   MKTKTYPE,MKTKTYPQ                                                
         MVC   MKTKMED,QMEDA                                                    
         UNPK  MKTKMKT,DUB                                                      
         MVC   MKTKAGY,LP_AGY                                                   
         MVC   MKTKFILL,EZEROS                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOSTAFIL+IO5'                            
         BNE   EXITN                                                            
         CVB   R0,DUB                                                           
         L     R1,LP_AOUT                                                       
         STCM  R0,3,0(R1)                                                       
         B     EXITY                                                            
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO VALIDATE MARKET FOR BUY DOWNLOAD                         *         
***********************************************************************         
                                                                                
VALMKN   L     R1,LP_AINP                                                       
         CLI   0(R1),C'*'          TEST ALL MARKET/CLIENT SUBSCRIPTION          
         JNE   VALMKN02                                                         
         L     R1,LP_AOUT                                                       
         MVI   0(R1),C'*'                                                       
         B     EXITY                                                            
                                                                                
VALMKN02 L     RF,LP_ILEN                                                       
         SHI   RF,1                                                             
         MVC   DUB,EZEROS                                                       
         BASR  RE,0                                                             
         MVZ   DUB(0),0(R1)                                                     
         EX    RF,0(RE)                                                         
         CLC   DUB,EZEROS                                                       
         BNE   EXITN                                                            
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         PACK  DUB,0(0,R1)                                                      
         OI    DUB+L'DUB-1,X'0F'                                                
         L     R1,LP_AOUT                                                       
         UNPK  0(L'MKTKMKT,R1),DUB                                              
         CLC   LP_QMAPN,SDMCOM#    READ MARKET RECORD AND CVB                   
         JE    *+14                FOR MCOM AND SCOM                            
         CLC   LP_QMAPN,SDSCOM#                                                 
         BNE   EXITY                                                            
         LA    R1,IOKEY                                                         
         USING MKTRECD,R1                                                       
         XC    MKTKEY,MKTKEY                                                    
         MVI   MKTKTYPE,MKTKTYPQ                                                
         MVC   MKTKMED,QMEDA                                                    
         L     RE,LP_AOUT                                                       
         MVC   MKTKMKT,0(RE)                                                    
         MVC   MKTKAGY,LP_AGY                                                   
         MVC   MKTKFILL,EZEROS                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOSTAFIL+IO5'                            
         BNE   EXITN                                                            
         CVB   R0,DUB                                                           
         L     R1,LP_AOUT                                                       
         STCM  R0,3,0(R1)                                                       
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO VALIDATE BUYER CODE                                      *         
***********************************************************************         
                                                                                
VALBYR   LM    R2,R4,LP_AINP                                                    
         MVC   WORK(3),SPACES      ENFORCE 3 CHARACTER BUYER                    
         BCTR  R3,0                                                             
         BASR  RE,0                                                             
         MVC   WORK(0),0(R2)                                                    
         EX    R3,0(RE)                                                         
         OC    WORK(3),SPACES                                                   
         GOTOR VRCPACK,DMCB,(C'P',WORK),(R4)                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* EDIT TIME FROM X'HHMM' TO C'HHMM'                                             
***********************************************************************         
EDTTIME  LM    R2,R4,LP_AINP                                                    
         LLH   RE,0(R2)            PREP TIME AS PACK DECIMAL                    
         SLL   RE,4                                                             
         STCM  RE,15,FULL2                                                      
         OI    FULL2+3,X'0F'       BUT SET SO UNPK CONVERTS TO EBCDIC           
         UNPK  0(4,R4),FULL2                                                    
         LA    RE,4                ALWAYS OUTPUT TIME AS 4 CHARACTERS           
         STCM  RE,15,LP_OLEN        WITH LEADING 0'S                            
         B     EXITY                                                            
***********************************************************************         
* EDIT PRODUCT CODE                                                   *         
***********************************************************************         
                                                                                
EDTPRC   LM    R2,R4,LP_AINP                                                    
                                                                                
         OC    0(L'OCOMKPRD,R2),0(R2)                                           
         JNZ   *+14                                                             
         XC    LP_OLEN,LP_OLEN     CLEAR OUTPUT LENGTH IF NOTHING THERE         
         B     EXITY                                                            
                                                                                
         CLC   ALLPRD,0(R2)        TEST 'ALL'                                   
         JE    *+14                                                             
         CLC   POLPRD,0(R2)        TEST 'POL'                                   
         JNE   *+14                                                             
         MVC   0(L'OCOMKPRD,R4),0(R2)                                           
         B     EXITY                                                            
                                                                                
         AHI   R2,2                R2=A(PRODUCT NUMBER)                         
         GOTOR (#EDTPRD,AEDTPRD),DMCB,(R2),(R3),(R4)                            
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* EDIT MEDIA CODE AND SET QMEDX/QMEDA                                 *         
***********************************************************************         
                                                                                
EDTMED   GOTOR (#EDTMED,AEDTMED),LP_AINP                                        
         L     R1,LP_AINP                                                       
         MVC   QMEDX,0(R1)                                                      
         L     R1,LP_AOUT                                                       
         MVC   QMEDA,0(R1)                                                      
         B     EXITY                                                            
                                                                                
***********************************************************************         
* EDIT REP CODE                                                       *         
***********************************************************************         
                                                                                
EDTREP   L     RF,LP_AINP                                                       
         OC    0(L'MGDREPCD,RF),0(RF)                                           
         BZ    XCOLEN                                                           
         GOTOR VRCPACK,DMCB,(C'U',(RF)),LP_AOUT                                 
         B     EXITY                                                            
                                                                                
***********************************************************************         
* EDIT MARKET NAME                                                    *         
***********************************************************************         
                                                                                
EDTMKN   XC    SODOD(SODORECL),SODOD                                            
         MVI   SODOTYPE,SODOTMKT                                                
         MVC   SODOMED,QMEDA                                                    
         L     R1,LP_AINP                                                       
         MVC   SODOMKT,0(R1)                                                    
         MVC   TSARSAV,SODOD                                                    
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         BE    XCOLEN                                                           
         MVC   SODOD(SODORECL),TSARSAV                                          
         GOTOR BUFFER,DMCB,('TSAADD',0)                                         
         JNE   *+2                                                              
                                                                                
         SR    R0,R0               READ MARKET RECORD AND SEND NAME             
         ICM   R0,3,SODOMKT                                                     
         CVD   R0,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         MVC   SVIOVALS,IOVALS                                                  
         LA    R1,IOKEY                                                         
         USING MKTREC,R1                                                        
         XC    MKTKEY,MKTKEY                                                    
         MVI   MKTKTYPE,MKTKTYPQ                                                
         MVC   MKTKMED,QMEDA                                                    
         UNPK  MKTKMKT,DUB                                                      
         MVC   MKTKAGY,LP_AGY                                                   
         MVC   MKTKFILL,EZEROS                                                  
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOSTAFIL+IO3'                            
         L     R1,IOADDR                                                        
         JE    *+14                                                             
         MVI   MKTNAME,C'?'                                                     
         MVC   MKTNAME+1(L'MKTNAME-1),MKTNAME                                   
         L     RF,LP_AOUT                                                       
         MVC   0(L'MKTNAME,RF),MKTNAME                                          
         MVC   IOVALS(IOVALL),SVIOVALS                                          
         B     EXITY                                                            
         DROP  R1                                                               
                                                                                
***********************************************************************         
* EDIT CLIENT CODE                                                    *         
***********************************************************************         
                                                                                
EDTCLT   XC    LORDVCLT,LORDVCLT                                                
         XC    SODOD(SODORECL),SODOD                                            
         MVI   SODOTYPE,SODOTCLT                                                
         MVC   SODOMED,ORDAM                                                    
         L     R1,LP_AINP                                                       
         MVC   SODOCLT,0(R1)                                                    
         MVC   TSARSAV,SODOD                                                    
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         JNE   EDTCLT02                                                         
         L     R1,LP_AOUT                                                       
         MVC   0(L'SODOCODE,R1),SODOCODE                                        
         L     R2,ACLTREC          RESTORE BRAND/POL TRENDS                     
         MVC   CPROF-CKEY(1,R2),SODOCPOL   CLIENT MIGHT NOT BE SAME             
         B     EXITY                                                            
                                                                                
EDTCLT02 CLC   QMEDX,ORDAM         DID OUR AGY/MD CHANGE?                       
         JE    *+10                                                             
         MVC   QMEDX,ORDAM         YES, PROBLEM WITH SAME QCLT DIFF MED         
                                                                                
         GOTOR (#EDTCLT,AEDTCLT),LP_AINP                                        
         MVC   SODOD(SODOKEYL),TSARSAV                                          
         MVC   LORDVCLT,SODOCLT                                                 
         L     R1,LP_AOUT                                                       
         MVC   SODOCODE,0(R1)                                                   
         L     R2,ACLTREC          SAVE CLT BRAND/POL TRENDS                    
         MVC   SODOCPOL,CPROF-CKEY(R2)                                          
         GOTOR BUFFER,DMCB,('TSAADD',0)                                         
         JNE   *+2                                                              
                                                                                
         L     R2,ACLTREC          ADD BUFFER ENTRIES FOR PRODUCT CODES         
         AHI   R2,CPLDATA-CLTHDR                                                
         USING CPLDATA,R2                                                       
         LHI   R0,CPLDMAXN                                                      
         MVI   SODOTYPE,SODOTPRD                                                
EDTCLT04 CLI   CPLPMNEM,0          TEST END OF PRODUCT LIST                     
         BE    EXITY                                                            
         MVC   SODOPRD,CPLPNUMB                                                 
         MVC   SODOCODE,CPLPMNEM                                                
         MVI   SODOINDS,0                                                       
         GOTOR BUFFER,DMCB,('TSAADD',0)                                         
         JNE   *+2                                                              
         AHI   R2,CPLDATAL                                                      
         JCT   R0,EDTCLT04                                                      
         B     EXITY                                                            
         DROP  R2                                                               
                                                                                
***********************************************************************         
* EDIT CLIENT NAME                                                    *         
***********************************************************************         
                                                                                
EDTCLN   OC    LORDVCLT,LORDVCLT   TEST FIRST TIME FOR NEW CLIENT               
         BZ    XCOLEN                                                           
         L     R1,ACLTREC          RETURN CLIENT NAME                           
         L     RF,LP_AOUT                                                       
         MVC   0(L'CNAME,RF),CNAME-CLTHDR(R1)                                   
         B     EXITY                                                            
                                                                                
***********************************************************************         
* Edit market # for multiple order download                                     
*                                                                               
* NOTE:  This will be the current market being processed for                    
*  THIS IS FOR SPOT AUTHORIZATION TRACKER                                       
***********************************************************************         
***********************************************************************         
* CODE HAS BEEN COMMENTED OUT, UNTIL NEW SAT IS REVISITED -HWON 11/8/16         
***********************************************************************         
*&&DO                                                                           
EDTDMKT  DS    0H                                                               
         OC    ORDMKT,ORDMKT                                                    
         BZ    XCOLEN                                                           
         XR    R1,R1                                                            
         ICM   R1,3,ORDMKT                                                      
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'                                                      
*                                                                               
         L     R1,LP_AOUT                                                       
         UNPK  0(L'STAPQMKT,R1),DUB                                             
*                                                                               
         LA    R0,L'STAPQMKT                                                    
         STCM  R0,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
*&&                                                                             
***********************************************************************         
* EDIT STATION CODE                                                   *         
*                                                                               
* NOTE:  ADDSTA routine strips off the network                                  
***********************************************************************         
                                                                                
EDTSTA   L     R1,LP_AINP                                                       
         OC    0(L'STAPSTA,R1),0(R1)                                            
         BZ    XCOLEN                                                           
*                                                                               
         GOTOR ADDSTA              ADD TO STATION LIST IF NECESSARY             
*                                                                               
EDTSTA02 XC    WORK2(L'STAPMKT),WORK2                                           
         MVC   WORK2+L'STAPMKT(L'STAPSTA),0(R1)                                 
         GOTOR GETSTA,WORK2                                                     
         L     R1,LP_AOUT                                                       
         MVC   0(L'STAPQSTA+L'STAPQNET,R1),STAPQSTA                             
         LHI   R0,L'STAPQSTA+L'STAPQNET                                         
         STCM  R0,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* EDIT cable station code                                                       
***********************************************************************         
                                                                                
ED2STA   L     R1,LP_AINP                                                       
         OC    0(L'STAPSTA,R1),0(R1)                                            
         BZ    XCOLEN                                                           
*                                                                               
         XC    WORK2(L'STAPMKT),WORK2                                           
         MVC   WORK2+L'STAPMKT(L'STAPSTA),0(R1)                                 
         MVC   BUYMED,QMEDA                                                     
         GOTOR GETSTA,WORK2                                                     
         L     R1,LP_AOUT                                                       
****     MVC   0(L'STAPQSTA+L'STAPQNET,R1),STAPQSTA                             
****     LHI   R0,L'STAPQSTA+L'STAPQNET                                         
         MVC   0(L'STAPQNET,R1),STAPQNET                                        
         LHI   R0,L'STAPQNET                                                    
         STCM  R0,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* EDIT STATION CODE                                                   *         
***********************************************************************         
                                                                                
EDTSTC   L     RF,LP_AINP                                                       
         CLC   LP_QMAPN,SDSCOM#    TEST SCOM DOWNLOAD                           
         JNE   EDTSTC02                                                         
         ICM   R1,15,LP_ILEN                                                    
         JZ    *+2                                                              
         AHI   R1,-1                                                            
         BASR  RE,0                                                             
         CLC   0(0,RF),HZEROS      DO WE HAVE AN ALL STATION?                   
         EX    R1,0(RE)                                                         
         JNE   EDTSTC02                                                         
         L     RE,LP_AOUT                                                       
         MVC   0(L'QSTAA,RE),0(RF)                                              
         B     EXITY                                                            
                                                                                
EDTSTC02 CLI   0(RF),X'00'         IS THIS A MARKET?                            
         JNE   EDTSTC04                                                         
         SR    R1,R1                                                            
         ICM   R1,7,0(RF)                                                       
         CVD   R1,DUB                                                           
         OI    DUB+L'DUB-1,X'0F'                                                
         UNPK  WORK(L'QSTAA),DUB                                                
         L     RE,LP_AOUT                                                       
         MVC   0(L'QSTAA,RE),WORK                                               
         LA    R0,L'QSTAA                                                       
         STCM  R0,15,LP_OLEN                                                    
         B     EXITY                                                            
                                                                                
EDTSTC04 XC    WORK2(L'STAPMKT),WORK2                                           
         MVC   WORK2+L'STAPMKT(L'STAPSTA),0(RF)                                 
         MVC   BUYMED,QMEDA                                                     
         GOTOR GETSTA,WORK2                                                     
         L     R1,LP_AOUT                                                       
         MVC   0(L'STAPQSTA+L'STAPQNET,R1),STAPQSTA                             
         LHI   R0,L'STAPQSTA+L'STAPQNET                                         
         STCM  R0,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* EDIT SALESPERSON/POINTPERSON NAME                                   *         
***********************************************************************         
                                                                                
         USING EPRWORKD,RC                                                      
EDTPER   MVC   EPRIOSAV,IOVALS     SAVE CURRENT I/O VALUES                      
         L     RF,LP_AINP                                                       
         MVC   EPRPWRCD,2(RF)      SAVE THE POWER CODE OF REP                   
         MVC   EPRSALCD,4(RF)               SALESPERSON CODE                    
                                                                                
         LA    R2,IOKEY                                                         
         USING GSPLRECD,R2         READ SALESPERSON RECORD                      
         XC    GSPLKEY,GSPLKEY                                                  
         MVI   GSPLKTYP,GSPLRECQ   X'000071' RECORDS                            
                                                                                
         MVI   GSPLKSTP,1          SALESPERSON TYPE                             
         TM    ORDFL1,DOSPPPER     POINTEPERSON?                                
         JZ    *+8                                                              
         MVI   GSPLKSTP,2          POINTPERSON TYPE                             
         MVC   GSPLKSRP,EPRPWRCD                                                
         MVC   GSPLKSAL,EPRSALCD                                                
                                                                                
         LA    R1,EPRIO                                                         
         ST    R1,IOADDR                                                        
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOGENDIR'                                
         JNE   EDTPERN                                                          
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOGENFIL'                               
         JNE   EDTPERN                                                          
                                                                                
         L     R2,IOADDR                                                        
         AHI   R2,GSPLFRST                                                      
EDTPER02 CLI   0(R2),0                                                          
         JE    EDTPERN                                                          
         CLI   0(R2),X'02'         NEED NEW INFORMATION ELEMENT                 
         JE    EDTPER04                                                         
         LLC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         J     EDTPER02                                                         
                                                                                
         USING GSPLNFCD,R2                                                      
EDTPER04 L     RF,LP_AOUT                                                       
         CLC   GSPLNFFR,SPACES     FIRST NAME > SPACES?                         
         JNH   EDTPER08                                                         
         MVC   0(L'GSPLNFFR,RF),GSPLNFFR                                        
         LA    RF,L'GSPLNFFR-1(RF)                                              
EDTPER06 CLI   0(RF),C' '          SQUASH FIRST NAME DOWN                       
         JH    *+8                                                              
         JCT   RF,EDTPER06                                                      
                                                                                
         LA    RF,1(RF)                                                         
         MVI   0(RF),C' '          IN CASE ALL 20 BYTES USED                    
         LA    RF,1(RF)                                                         
                                                                                
EDTPER08 CLC   GSPLNFLS,SPACES                                                  
         JNH   EDTPERY                                                          
         MVC   0(L'GSPLNFFR,RF),GSPLNFLS                                        
                                                                                
EDTPERY  MVC   IOVALS(IOVALL),EPRIOSAV                                          
         B     EXITY                                                            
                                                                                
EDTPERN  MVC   IOVALS(IOVALL),EPRIOSAV                                          
         B     XCOLEN                                                           
         DROP  R2,RC                                                            
                                                                                
EPRWORKD DSECT                     ** EDTPER LOCAL WORKING STORAGE **           
EPRPWRCD DS    CL2                 POWER CODE                                   
EPRSALCD DS    XL3                 SALESPERSON CODE                             
EPRIOSAV DS    XL(IOVALL)          TO STORE THE CURRENT I/O VALUES              
EPRIO    DS    XL(ONEK)            1K IS ENUF STORAGE FOR RECORD                
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* EDIT BUYER NAME IF NOT SENT ALREADY                                 *         
***********************************************************************         
                                                                                
         USING EBWORKD,RC                                                       
EDTBYR   MVC   EBIOSAVE,IOVALS                                                  
         L     RF,LP_AINP                                                       
         MVC   EBBUYER,0(RF)                                                    
         OC    EBBUYER,EBBUYER     TEST BUYER CODE SET                          
         JZ    EDTBYRN                                                          
         CLC   LP_QMAPN,SDOMSD#    TEST SINGLE ORDER DOWNLOAD                   
         JE    EDTBYR02                                                         
         CLI   DLDBYRNM,0          TEST BUYER NAME REQUIRED                     
         JE    EDTBYRN                                                          
         LH    R0,BYRTAB#                                                       
         GOTOR VBINSRCH,DMCB,(1,(RF)),ABYRTAB,(R0),L'BYRTAB,L'BYRTAB,  +        
               BYRMAXN                                                          
         MVC   BYRTAB#,10(R1)      SET N'TABLE ENTRIES                          
         CLI   0(R1),0             TEST BUYER NAME PREVIOUSLY SENT              
         JE    EDTBYRN                                                          
                                                                                
EDTBYR02 LA    R2,IOKEY                                                         
         USING BYRRECD,R2          READ BUYER RECORD                            
         XC    BYRKEY,BYRKEY                                                    
         MVI   BYRKTYP,BYRKTYPQ                                                 
         MVI   BYRKSUB,BYRKSUBQ                                                 
         MVC   BYRKAM,QMEDX                                                     
         MVC   BYRKBYR,EBBUYER                                                  
         LA    R1,EBIO                                                          
         ST    R1,IOADDR                                                        
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IODIR'                                   
         JNE   EDTBYRN                                                          
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL'                                  
         JNE   EDTBYRN                                                          
         L     R2,IOADDR                                                        
         L     RF,LP_AOUT                                                       
         MVC   0(L'BYRFNAME,RF),BYRFNAME                                        
         MVC   IOVALS(IOVALL),EBIOSAVE                                          
         B     EXITY                                                            
                                                                                
EDTBYRN  MVC   IOVALS(IOVALL),EBIOSAVE                                          
         B     XCOLEN                                                           
         DROP  R2,RC                                                            
                                                                                
EBWORKD  DSECT                     ** EDTBYR LOCAL WORKING STORAGE **           
EBBUYER  DS    CL(L'BYRKBYR)                                                    
EBIOSAVE DS    XL(IOVALL)                                                       
EBIO     DS    XL(ONEK)                                                         
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* EDIT PRODUCT CODE                                                   *         
***********************************************************************         
                                                                                
EDTPRD   L     R1,LP_AINP                                                       
         CLI   0(R1),0             TEST ANYTHING PASSED                         
         BE    XCOLEN                                                           
                                                                                
         LHI   R0,L'CPLPMNEM       LOOK UP PRODUCT IN BUFFER                    
         STCM  R0,15,LP_OLEN                                                    
         XC    SODOD(SODORECL),SODOD                                            
         MVI   SODOTYPE,SODOTPRD                                                
         MVC   SODOMED,ORDAM                                                    
         MVC   SODOCLT,ORDCLT                                                   
         MVC   SODOPRD,0(R1)                                                    
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         L     R1,LP_AOUT                                                       
         MVI   0(R1),C'?'                                                       
         MVC   1(L'SODOCODE-1,R1),0(R1)                                         
         JNE   *+10                                                             
         MVC   0(L'SODOCODE,R1),SODOCODE                                        
         B     EXITY                                                            
                                                                                
***********************************************************************         
* EDIT PRODUCT NAME                                                   *         
***********************************************************************         
                                                                                
         USING EPNWORKD,RC                                                      
EDTPRN   L     R1,LP_AINP                                                       
         CLI   0(R1),0             TEST ANYTHING PASSED                         
         BE    XCOLEN                                                           
                                                                                
         XC    SODOD(SODORECL),SODOD                                            
         MVI   SODOTYPE,SODOTPRD                                                
         MVC   SODOMED,ORDAM                                                    
         MVC   SODOCLT,ORDCLT                                                   
         MVC   SODOPRD,0(R1)                                                    
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         BNE   XCOLEN                                                           
         TM    SODOINDS,SODOISNT   TEST ALREADY SENT PRODUCT NAME               
         BNZ   XCOLEN                                                           
         OI    SODOINDS,SODOISNT                                                
         GOTOR BUFFER,DMCB,('TSAWRT',0)                                         
         JNE   *+2                                                              
                                                                                
         MVC   EPNIOSV,IOVALS      SAVE CURRENT I/O VALUES                      
         LA    R2,IOKEY                                                         
         USING PKEY,R2             READ PRODUCT RECORD                          
         XC    PKEY,PKEY                                                        
         MVC   PKEYAM,ORDAM                                                     
         MVC   PKEYCLT,SODOCLT                                                  
         MVC   PKEYPRD,SODOCODE                                                 
                                                                                
         LA    R0,EPNIO                                                         
         ST    R0,IOADDR                                                        
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IODIR'                                   
         JNE   EDTPRNN                                                          
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL'                                  
         JNE   EDTPRNN                                                          
         LA    R2,EPNIO                                                         
         L     RF,LP_AOUT                                                       
         MVC   0(L'PNAME,RF),PNAME                                              
         MVC   IOVALS(IOVALL),EPNIOSV                                           
         B     EXITY                                                            
                                                                                
EDTPRNN  MVC   IOVALS(IOVALL),EPNIOSV                                           
         B     XCOLEN                                                           
         DROP  R2,RC                                                            
                                                                                
EPNWORKD DSECT                     ** EDTPRN LOCAL WORKING STORAGE **           
EPNIOSV  DS    XL(IOVALL)          I/O VALUES SAVE AREA                         
EPNPRDN  DS    X                   PRODUCT NUMBER                               
EPNIO    DS    XL1024              I/O AREA                                     
SVRDEF   CSECT                                                                  
         EJECT                                                                  
**********************************************************************          
* EDIT USER-ID                                                       *          
**********************************************************************          
                                                                                
         USING EUWORKD,RC                                                       
         USING CTIREC,EUIO                                                      
EDTUID   L     R1,LP_AINP          R1=A(PASSWORD NUMBER)                        
         OC    0(L'CTIKNUM,R1),0(R1)                                            
         BZ    XCOLEN                                                           
                                                                                
         MVC   EUIOSAVE,IOVALS     SAVE CURRENT I/O VALUES                      
                                                                                
         XC    CTIKEY,CTIKEY                                                    
         MVI   CTIKTYP,CTIKTYPQ                                                 
         MVC   CTIKNUM,0(R1)                                                    
         MVC   IOKEY,CTIKEY                                                     
         LA    R1,CTIREC                                                        
         ST    R1,IOADDR                                                        
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE'                                
         JNE   EDTUID06                                                         
                                                                                
         LA    R1,CTIDATA          R1=A(FIRST ELEMENT ON ID RECORD)             
         USING CTDSCD,R1                                                        
EDTUID02 CLI   CTDSCEL,EOR         TEST END OF RECORD                           
         JE    EDTUID06                                                         
         CLI   CTDSCEL,CTDSCELQ    TEST DESCRIPTION ELEMENT                     
         JE    EDTUID04                                                         
         LLC   R0,CTDSCLEN                                                      
         AR    R1,R0                                                            
         J     EDTUID02                                                         
EDTUID04 L     RF,LP_AOUT          RETURN USER-ID                               
         MVC   0(L'CTIKID,RF),CTDSC                                             
                                                                                
EDTUID06 MVC   IOVALS(IOVALL),EUIOSAVE                                          
         B     EXITY                                                            
         DROP  RC,R1                                                            
                                                                                
EUWORKD  DSECT                     ** EDTUID LOCAL WORKING STORAGE **           
EUIOSAVE DS    XL(IOVALL)          SAVED I/O VALUES                             
EUIO     DS    XL1000              I/O AREA                                     
SVRDEF   CSECT                                                                  
         EJECT                                                                  
**********************************************************************          
* EDIT PERSON ID AND EXTRACT PERSON NAME FROM PID RECORD             *          
**********************************************************************          
                                                                                
         USING EPWORKD,RC                                                       
         USING SA0REC,EPIO                                                      
EDTPID   MVC   EPIOSAVE,IOVALS     SAVE CURRENT I/O VALUES                      
         XC    PERNAME,PERNAME     CLEAR PERSON NAME                            
         LHI   R0,L'SAPALPID                                                    
         ST    R0,LP_OLEN                                                       
         L     R1,LP_AINP          R1=A(PASSWORD NUMBER)                        
         OC    0(L'SA0KNUM,R1),0(R1)                                            
         JZ    EDTPIDN                                                          
                                                                                
         XC    SA0KEY,SA0KEY       READ PERSON PASSWORD RECORD                  
         MVI   SA0KTYP,SA0KTYPQ                                                 
         MVC   SA0KNUM,0(R1)                                                    
         L     R1,LP_ASECD                                                      
         MVC   SA0KAGY,SECAGY-SECD(R1)                                          
         MVC   IOKEY,SA0KEY                                                     
         LA    R1,EPIO                                                          
         ST    R1,IOADDR                                                        
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOCTFILE'                                
         JNE   EDTPIDN                                                          
                                                                                
         LA    R1,SA0DATA                                                       
         USING SAPALD,R1                                                        
EDTPID02 CLI   SAPALEL,EOR         TEST END OF RECORD                           
         JE    EDTPIDN                                                          
         CLI   SAPALEL,SAPALELQ    TEST NEW SECURITY PERSON ELEMENT             
         JE    EDTPID04                                                         
         LLC   R0,SAPALLN          BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         J     EDTPID02                                                         
                                                                                
EDTPID04 L     RF,LP_AOUT                                                       
         MVC   0(L'SAPALPID,RF),SAPALPID                                        
                                                                                
         USING SAPEREC,EPIO                                                     
         XC    SAPEKEY,SAPEKEY     READ NEW SECURITY PERSON RECORD              
         MVI   SAPETYP,SAPETYPQ                                                 
         MVI   SAPESUB,SAPESUBQ                                                 
         L     R1,LP_ASECD                                                      
         MVC   SAPEAGY,SECAGY-SECD(R1)                                          
         MVC   SAPEPID,0(RF)                                                    
         MVC   IOKEY,SA0KEY                                                     
         GOTOR (#IOEXEC,AIOEXEC),'IOHI+IOCTFILE'                                
         JNE   *+2                                                              
         CLC   SAPEKEY(SAPEAGY-SAPEKEY),IOKEYSAV                                
         JNE   EDTPIDY                                                          
                                                                                
         LA    R1,SAPEDATA         LOCATE PERSONNEL DETAILS ELEMENT             
         USING SANAMD,R1                                                        
EDTPID06 CLI   SANAMEL,EOR                                                      
         JE    EDTPIDY                                                          
         CLI   SANAMEL,SANAMELQ                                                 
         JE    EDTPID08                                                         
         LLC   R0,SANAMLN                                                       
         AR    R1,R0                                                            
         J     EDTPID06                                                         
                                                                                
EDTPID08 MVC   EPNAMIND,SANAMIND                                                
         LA    R1,SANAMES                                                       
         LA    R2,PERNAME                                                       
         USING SANAMES,R1                                                       
                                                                                
         TM    EPNAMIND,SANAMIFN   TEST FIRST NAME PRESENT                      
         JZ    EDTPID10                                                         
         LLC   RF,SANAMELN                                                      
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         MVC   0(0,R2),SANAME                                                   
         EX    RF,0(RE)                                                         
         LA    R2,1(R2,RF)                                                      
         MVI   0(R2),C' '                                                       
         AHI   R2,1                                                             
         LA    R1,2(RF,R1)                                                      
                                                                                
EDTPID10 TM    EPNAMIND,SANAMIMN   TEST MIDDLE NAME PRESENT                     
         JZ    EDTPID12                                                         
         LLC   RF,SANAMELN                                                      
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         MVC   0(0,R2),SANAME                                                   
         EX    RF,0(RE)                                                         
         LA    R2,1(R2,RF)                                                      
         MVI   0(R2),C' '                                                       
         AHI   R2,1                                                             
         LA    R1,2(RF,R1)                                                      
                                                                                
EDTPID12 TM    EPNAMIND,SANAMILN   TEST LAST NAME PRESENT                       
         JZ    EDTPIDY                                                          
         LLC   RF,SANAMELN                                                      
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         MVC   0(0,R2),SANAME                                                   
         EX    RF,0(RE)                                                         
         J     EDTPIDY                                                          
         DROP  R1                                                               
                                                                                
EDTPIDN  MVC   IOVALS(IOVALL),EPIOSAVE                                          
         B     XCOLEN                                                           
                                                                                
EDTPIDY  MVC   IOVALS(IOVALL),EPIOSAVE                                          
         B     EXITY                                                            
         DROP  RC                                                               
                                                                                
EPWORKD  DSECT                     ** EDTPID LOCAL WORKING STORAGE **           
EPIOSAVE DS    XL(IOVALL)          SAVED I/O VALUES                             
EPNAMIND DS    XL(L'SANAMIND)      NAME INDICATORS                              
EPIO     DS    XL1000              I/O AREA                                     
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* EDIT DEMO CODE FROM MAKEGOOD BUY OFFER DEMO ELEMENT                 *         
***********************************************************************         
         USING EDCWORKD,RC                                                      
*&&DO                                                                           
EDTGDCD  MVI   SVDEMORG,SVDMOGD    GOAL DEMO, GET NTDEM FROM EST REC            
         J     EDTDCD                                                           
EDTEDCD  MVI   SVDEMORG,SVDMOED    EST DEMO,  GET NTDEM FROM EST REC            
         J     EDTDCD                                                           
EDTBDCD  MVI   SVDEMORG,SVDMOBD    BUY DEMO,  GET NTDEM FROM BUY REC            
         J     EDTDCD                                                           
*&&                                                                             
*                                                                               
EDTDCD   DS    0H                                                               
         MVI   SVDEMTYP,0                                                       
*                                                                               
         L     R2,LP_AINP                                                       
         USING EDEMLIS1,R2                                                      
         CLC   EDEMLIS1,HZEROS     ANY MORE?                                    
         JZ    EXITN                NO                                          
*                                                                               
         LLC   RF,EDEMLNU1                                                      
         ICM   RF,B'0010',EDEMLIS1  BYTE1&3 ZERO, NON-TRADITIONAL?              
         LTR   RF,RF               HAVE NON-TRADITIONAL DEMO CAT?               
         JZ    GETNTDEM             YES                                         
*                                                                               
EDTDCD05 MVC   SVDEMTYP,EDEMLTY1   SAVE DEMO TYPE                               
*                                                                               
EDTDCD10 GOTOR (#EDTDCD,AEDTDCD),DMCB,LP_AINP,0,LP_AOUT                         
         MVC   LP_OLEN,DMCB+4      SET OUTPUT LENGTH                            
*                                                                               
* SAVE DEMO TYPE (SVDEMTYP) TO A DEMO LIST (SVDEMTYL)                           
*                                                                               
EDTDCD20 LA    RE,SVDEMTYL                                                      
         LA    RF,SVDEMTYL+L'SVDEMTYL-1                                         
EDTDCD30 CR    RE,RF               TOO MANY FOR LIST                            
         JH    *+2                  YES, DIE                                    
         CLI   0(RE),0             FOUND EMPTY SLOT?                            
         JE    EDTDCD40             YES                                         
         LA    RE,1(RE)             NO, BUMPT TO NEXT SLOT                      
         J     EDTDCD30                                                         
EDTDCD40 MVC   0(1,RE),SVDEMTYP                                                 
         J     EXITY                                                            
***                                                                             
* GET ESTIMATE NON-TRADITIONAL DEMO NAME                                        
***                                                                             
GETNTDEM DS    0H                                                               
         LLC   R4,EDEMLTY1         R4 = NON-TRAD DEMO INDEX                     
         OC    LP_VRSN,LP_VRSN     ONLY IF NO VERSION                           
         JZ    GTNTDM05                                                         
         CLC   LP_VRSN,V460050     OR VERSION 4.6.0.50 AND HIGHER               
         JNL   GTNTDM05             GET NON-TRAD NAME                           
         MVI   EDEMLTY1,X'21'      TRANSFORM TO USER DEF                        
         LA    RE,10(R4)           ADD 10 THE INDEX AND                         
         STC   RE,EDEMLNU1         START AT +10 (U11,U12,U13,...,U30)           
         J     EDTDCD05                                                         
*                                                                               
GTNTDM05 MVC   EDIOSAVE,IOVALS                                                  
         ICM   RF,15,AROUTADR      GET HOOK TO BUILD ESTIMATE KEY               
         JZ    *+2                  DIE IF WE DON'T HAVE ONE                    
         BASR  RE,RF               BUILD ESTIMATE KEY IN KEY                    
*                                                                               
         L     RE,AESTREC                                                       
         CLC   IOKEY(L'EKEY),0(RE)  ALREADY HAVE ESTIMATE RECORD?               
         JE    GTNTDM10             YES                                         
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IODIR+B#ESTREC'                        
         JNE   *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ESTREC'                        
         JNE   *+2                                                              
*                                                                               
         L     RE,AESTREC                                                       
GTNTDM10 LA    RE,ENONTDMS-ESTHDR(RE)  RE=A(START OF NONTRAD DEMO LIST)         
         SHI   R4,1                SUB 1 FROM INDEX                             
         MHI   R4,L'ENONTDMS       MULTIPLE * LENGTH OF ENTRY                   
         AR    R4,RE               ADD OFFSET TO START OF LIST                  
         LA    RE,20*L'ENONTDMS(RE)                                             
         LA    RF,8                SET RETURN LENGTH                            
         CR    R4,RE               BEYOND LIST?                                 
         JNL   *+14                 YES, RETURN ????????                        
         CLC   0(L'NTDDMONM,R4),SPACES  HAVE SHORT NAME?                        
         JH    *+12                      YES                                    
         LA    R4,=C'????????'     NO, RETURN ???????? FOR NAME                 
         LA    RF,4                                                             
*                                                                               
         MVC   SVDEMTYP,0(R4)      SAVE DEMO TYPE                               
*                                                                               
         L     RE,LP_AOUT                                                       
         MVC   0(L'ENONTDMS,RE),0(R4)  SET NON-TRAD DEMO CAT AS OUTPUT          
         ST    RF,LP_OLEN          AND SET LENGTH                               
         MVC   IOVALS(IOVALL),EDIOSAVE                                          
         J     EDTDCD20                                                         
         DROP  R2,RC                                                            
*                                                                               
EDCWORKD DSECT                     ** EDTDCD LOCAL WORKING STORAGE **           
EDIOSAVE DS    XL(IOVALL)          SAVED I/O VALUES                             
SVRDEF   CSECT                                                                  
         EJECT                                                                  
                                                                                
*************************************************                               
* BUILD ESTIMATE RECORD BASED OFF ORDER RECORD                                  
*************************************************                               
BLDESTOR DS    0H                                                               
         XC    IOKEY,IOKEY                                                      
BEO      USING ESTHDR,IOKEY                                                     
         MVC   BEO.EKEYAM,ORDAM                                                 
         MVC   BEO.EKEYCLT,ORDCLT                                               
         MVC   BEO.EKEYPRD,=C'POL'                                              
         MVC   BEO.EKEYEST,ORDEST                                               
         BR    RE                                                               
         EJECT                                                                  
         DROP  BEO                                                              
*&&DO                                                                           
         L     R1,AORDREC          GET THE ESTIMATE FROM THE ORDER              
         USING DAREORDD,R1                                                      
*                                  MAKE SURE WE HAVE ORDER REC                  
         CLI   DOKTYPE,DOKTYPQ     X'0D'?                                       
         JNE   *+2                                                              
         CLI   DOKSUBTY,DOKSTYPQ   X'34'?                                       
         JNE   *+2                                                              
         CLI   DOKCMT,X'00'        BASE ORDER RECORD?                           
         JNE   *+2                                                              
         DROP  R1                                                               
*                                                                               
         XC    IOKEY,IOKEY                                                      
         LA    RF,IOKEY                                                         
         USING ESTHDR,RF                                                        
         MVC   EKEYAM,DOKAGMD-DOKEY(R1)                                         
*                                                                               
         LA    R1,DORFRST-DOKEY(R1)  POINT TO THE FIRST ELEMENT                 
BESTO010 CLI   0(R1),0                                                          
         JE    *+2                                                              
         CLI   0(R1),DOIDELQ       X'01' - PRIMARY ID ELEMENT?                  
         JE    BESTO020                                                         
         LLC   R0,1(R1)                                                         
         AR    R1,R0                                                            
         J     BESTO010                                                         
*                                                                               
         USING DOIDELD,R1                                                       
*                                                                               
BESTO020 MVC   EKEYCLT,DOIDCLT                                                  
         MVC   EKEYPRD,=C'POL'                                                  
         MVC   EKEYEST,DOIDEST                                                  
         BR    RE                                                               
         EJECT                                                                  
         DROP  RF,R1                                                            
*&&                                                                             
*                                                                               
*************************************************                               
* BUILD ESTIMATE RECORD BASED OFF ORDER HISTORY RECORD                          
*************************************************                               
BLDESTOH DS    0H                                                               
         L     R1,AOHSREC          BLD ESTIMATE KEY OFF ORD-HIST REC            
         USING OHISRECD,R1                                                      
*                                  MAKE SURE WE HAVE ORDER HISTORY REC          
         CLI   OHISTYP,OHISTYQ     X'0D'?                                       
         JNE   *+2                                                              
         CLI   OHISSTYP,OHISSTYQ   X'1B'?                                       
         JNE   *+2                                                              
*                                                                               
         XC    IOKEY,IOKEY                                                      
         LA    RF,IOKEY                                                         
         USING ESTHDR,RF                                                        
         MVC   EKEYAM,OHISBKAM                                                  
         MVC   EKEYCLT,OHISBKCL                                                 
         MVC   EKEYPRD,=C'POL'                                                  
         MVC   EKEYEST,OHISBKES                                                 
         BR    RE                                                               
         EJECT                                                                  
         DROP  RF,R1                                                            
***********************************************************************         
* EDIT 2 BYTE DEMO VALUE (HOB - X'40' 2 DECIMAL)                      *         
***********************************************************************         
                                                                                
EDTDVL2B L     R1,LP_AINP                                                       
         XC    FULL,FULL                                                        
         MVC   FULL+2(2),0(R1)                                                  
         TM    0(R1),NDEM2DEC                                                   
         JZ    *+12                                                             
         NI    FULL+2,FF-NDEM2DEC                                               
         OI    FULL,NDEM2DEC                                                    
         J     EDTDVL01                                                         
         EJECT                                                                  
***********************************************************************         
* EDIT DEMO VALUE FROM MAKEGOOD BUY OFFER DEMO ELEMENT                *         
***********************************************************************         
                                                                                
         USING EDVWORKD,RC                                                      
EDTDVL   L     R1,LP_AINP                                                       
         MVI   OFFOVER,0                                                        
         MVC   FULL(4),0(R1)                                                    
         TM    FULL,MODMOVRD                                                    
         JZ    *+12                                                             
         MVI   OFFOVER,YESQ                                                     
         NI    FULL,FF-(MODMOVRD)                                               
EDTDVL01 ST    RE,EDVSVRE                                                       
         GOTOR ADJPRC                                                           
         L     RE,EDVSVRE                                                       
         ICM   R0,15,FULL                                                       
         L     RF,LP_AOUT                                                       
         CLC   LP_QMAPN,SDMGED#    PENDING MKGD APPLY DOWNLOAD?                 
         JNE   EDTDVL02            NO                                           
         CURED (R0),(10,(RF)),2,ALIGN=LEFT,ZERO=NOBLANK                         
         J     EDTDVL04                                                         
                                                                                
EDTDVL02 CURED (R0),(10,(RF)),0,ALIGN=LEFT,ZERO=NOBLANK                         
EDTDVL04 ST    R0,LP_OLEN                                                       
         B     EXITY                                                            
         DROP  RC                                                               
                                                                                
EDVWORKD DSECT                     ** EDTDVL LOCAL WORKING STORAGE **           
EDVSVRE  DS    F                   SAVE RE                                      
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* EDIT URL FOR MO CONFIRMS                                            *         
***********************************************************************         
                                                                                
EDTURL   L     R1,LP_AINP                                                       
         USING DOCM2ELD,R1                                                      
         L     R2,LP_AOUT                                                       
         LLC   RF,DOCM2LEN                                                      
         SHI   RF,DOCM2OVH+1                                                    
         BASR  RE,0                                                             
         MVC   0(0,R2),DOCM2TXT                                                 
         EX    RF,0(RE)                                                         
         LA    R2,1(RF,R2)                                                      
         AHI   RF,1                                                             
         STCM  RF,15,LP_OLEN                                                    
         LA    RF,DOCM2OVH(R1,RF)                                               
         CLC   DOCM2REV(L'DOCM2REV+L'DOCM2LIN),DOCM2REV-DOCM2ELD(RF)            
         BNE   EXITY                                                            
         LR    R1,RF                                                            
         LLC   RF,DOCM2LEN                                                      
         SHI   RF,DOCM2OVH+1                                                    
         BASR  RE,0                                                             
         MVC   0(0,R2),DOCM2TXT                                                 
         EX    RF,0(RE)                                                         
         AHI   RF,1                                                             
         A     RF,LP_OLEN                                                       
         ST    RF,LP_OLEN                                                       
         B     EXITY                                                            
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* EDIT URL FOR MO REJECTS                                             *         
***********************************************************************         
                                                                                
EDTRURL  L     R1,LP_AINP                                                       
         USING DRURLELD,R1                                                      
         L     R2,LP_AOUT                                                       
         LLC   RF,DRURLLEN                                                      
         SHI   RF,DRURLOVH+1                                                    
         BASR  RE,0                                                             
         MVC   0(0,R2),DRURLTXT                                                 
         EX    RF,0(RE)                                                         
         LA    R2,1(RF,R2)                                                      
         AHI   RF,1                                                             
         STCM  RF,15,LP_OLEN                                                    
         B     EXITY                                                            
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* EDIT STANDARD COMMENT CODE (DBFLTSTD)                               *         
***********************************************************************         
                                                                                
EDTSTD   L     R1,LP_AINP                                                       
         USING DBFLTELD,R1                                                      
         TM    DBFLTFL1,DBFLTBSC                                                
         BZ    XCOLEN                                                           
         L     RF,LP_AOUT                                                       
         MVC   0(L'DBFLTSTD,RF),DBFLTSTD                                        
         LHI   R0,L'DBFLTSTD                                                    
         STCM  R0,15,LP_OLEN                                                    
         B     EXITY                                                            
                                                                                
***********************************************************************         
* EDIT FREE FORM TEXT (DBFLTTXT/DBFLTFFT)                             *         
***********************************************************************         
                                                                                
EDTFFT   L     R1,LP_AINP                                                       
         LA    RF,DBFLTTXT                                                      
         TM    DBFLTFL1,DBFLTBSC   TEST OM V2.0                                 
         JZ    *+8                                                              
         LA    RF,DBFLTFFT                                                      
         LLC   R0,DBFLTLEN                                                      
         AR    R0,R1                                                            
         CR    R0,RF                                                            
         BNH   XCOLEN                                                           
         LR    R1,RF                                                            
         SR    R0,RF                                                            
         LR    RF,R0                                                            
         ST    RF,LP_OLEN                                                       
         BCTR  RF,0                                                             
         L     R2,LP_AOUT                                                       
         BASR  RE,0                                                             
         MVC   0(0,R2),0(R1)                                                    
         EX    RF,0(RE)                                                         
         B     EXITY                                                            
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* CHECK SEARCH FILTERS                                                          
***********************************************************************         
                                                                                
CHKFLT   MVI   DLDBMKTO,C'N'                                                    
*                                                                               
         ICM   RE,7,AOST           POINT TO STATUS FILTERS                      
         BZ    EXITY                                                            
         SR    R0,R0               APPLY STATUS FILTERS                         
         ICM   R0,3,LW_NUMN-LW_D(RE)                                            
         AHI   RE,LW_LN2Q          POINT TO STATUS/QUALIFIER ARRAY              
*                                                                               
CHKFLT10 CLC   =C'ba',0(RE)        TEST FOR SENT OR SENDING                     
         JE    *+12                                                             
         CLI   0(RE),C'a'                                                       
         JNE   CHKFLT20                                                         
         CLI   L'ORDISTAT*2(RE),DCNFMCAN   CANCEL (X'01')?                      
         JNE   CHKFLT20                                                         
         MVI   L'ORDISTAT*2(RE),DOSTCNCL    SEND HAS ITS OWN BIT                
CHKFLT20 AHI   RE,L'ORDISTAT*2+L'ORDTTYPE                                       
         JCT   R0,CHKFLT10                                                      
*                                                                               
         TM    CLTIND,LW_TALLQ                                                  
         BNO   EXITY                                                            
         TM    MKTIND,LW_TALLQ                                                  
         BNO   EXITY                                                            
         TM    STAIND,LW_TALLQ                                                  
         BNO   EXITY                                                            
         OC    OSTIND,OSTIND                                                    
         BNZ   EXITY                                                            
         TM    ORDIND,LW_TALLQ                                                  
         BNO   EXITY                                                            
         OC    STRDATEC,STRDATEC                                                
         BNZ   EXITY                                                            
         OC    ENDDATEC,ENDDATEC                                                
         BO    EXITY                                                            
         MVI   DLDBMKTO,C'Y'                                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* ADD NEW STATION TO LIST OF STATIONS FOR READ FOR ROUTES DOWNLOAD    *         
***********************************************************************         
                                                                                
ADDSTA   STM   RE,R1,12(RD)                                                     
                                                                                
         ICM   RE,15,ASTALST       RE=A(STATION LIST WMP ENTRY)                 
         JZ    ADDSTAX                                                          
                                                                                
         CLI   0(R1),X'E8'         ARE WE CABLE?                                
         JL    *+8                                                              
         NI    2(R1),X'80'         YES, ONLY WANT SYSCODE LEVEL                 
                                                                                
         USING LW_D,RE                                                          
         LA    RF,LW_DATA2         POINT TO STATION LIST                        
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN        GET ENTRY COUNT SO FAR                       
         JZ    ADDSTA04                                                         
ADDSTA02 CLC   0(L'DOKSTA,RF),0(R1)                                             
         JE    ADDSTAX             EXIT IF ALREADY HAVE THIS STATION            
         AHI   RF,L'DOKSTA                                                      
         JCT   R0,ADDSTA02                                                      
         ICM   R0,3,LW_NUMN        ADD NEW ENTRY TO END OF LIST                 
                                                                                
ADDSTA04 AHI   R0,1                BUMP ENTRY COUNT                             
         STCM  R0,3,LW_NUMN                                                     
         MVC   0(L'DOKSTA,RF),0(R1)                                             
         XC    L'DOKSTA(L'DOKSTA,RF),L'DOKSTA(RF)                               
                                                                                
ADDSTAX  LM    RE,R1,12(RD)                                                     
         BR    RE                                                               
         DROP  RE                                                               
         EJECT                                                                  
***********************************************************************         
* EDIT THE URL TEXT FOR THE ORDER                                     *         
***********************************************************************         
                                                                                
EDTOURL  L     RF,LP_AOUT          SEND OUT THE URL TEXT WE SAVED               
         LLC   R1,ORDURLEL                                                      
         STCM  R1,15,LP_OLEN                                                    
                                                                                
         BASR  RE,0                                                             
         MVC   0(0,RF),ORDURLEL+1                                               
         EX    R1,0(RE)                                                         
         LA    R1,1(R1)                                                         
         STCM  R1,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* Edit out seller demo comment line number, always 1 and 2, and set flg         
***********************************************************************         
                                                                                
EDTSLDM  DS    0H                                                               
         L     RE,LP_AINP                                                       
         L     RF,LP_AOUT                                                       
         CLI   0(RE),MOSDELQ       X'62' - NIELSEN SELLER DEMO?                 
         JNE   EDTSLDM5                                                         
         OI    OFFSDFLG,OFFSDEM    Seller demo values exists for this           
*                                    offer line                                 
         MVI   0(RF),C'1'          default line number is 1                     
         TM    OFFSDFLG,OFFSNDEM   Seller nontrad demo values exists?           
         JZ    *+8                 no, leave line number as 1                   
         MVI   0(RF),C'2'          yes, set line number to 2                    
         J     EDTSLDM9                                                         
*                                                                               
EDTSLDM5 CLI   0(RE),MOSNTELQ      X'5F' - NON-TRAD SELLER DEMO?                
         JNE   *+2                                                              
         OI    OFFSDFLG,OFFSNDEM   Seller Nontrad demo values exist for         
*                                    this offer line                            
         MVI   0(RF),C'1'          default line number is 1                     
         TM    OFFSDFLG,OFFSDEM    Seller demo values exists?                   
         JZ    *+8                 no, leave line number as 1                   
         MVI   0(RF),C'2'          yes, set line number to 2                    
         J     EDTSLDM9                                                         
*                                                                               
EDTSLDM9 LA    R1,1                                                             
         STCM  R1,15,LP_OLEN       set output length of 1                       
         J     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* Edit out seller demo categories and values                                    
***********************************************************************         
         USING EDVWORKD,RC                                                      
EDTDEMV  DS    0H                                                               
*        L     R2,LP_AOUT                                                       
*        MVC   0(22,RF),=C'RHOMES=2.4,RAD1849=1.8'                              
*        LA    R1,22                                                            
*                                                                               
* GET THE ESTIMATE RECORD TO BUILD SVUSRNMS AND SVNTDMS                         
*                                                                               
         ICM   RF,15,AROUTADR      GET HOOK TO BUILD ESTIMATE KEY               
         JZ    *+2                  DIE IF WE DON'T HAVE ONE                    
         BASR  RE,RF               BUILD ESTIMATE KEY IN KEY                    
*                                                                               
         L     RE,AESTREC                                                       
         CLC   IOKEY(L'EKEY),0(RE)  ALREADY HAVE ESTIMATE RECORD?               
         JE    EDTDM10              YES                                         
*                                                                               
         GOTOR (#IOEXEC,AIOEXEC),'IOBRDD+IODIR+B#ESTREC'                        
         JNE   *+2                                                              
         GOTOR (#IOEXEC,AIOEXEC),'IOBGET+IOFIL+B#ESTREC'                        
         JNE   *+2                                                              
*                                                                               
         L     RE,AESTREC                                                       
EDTDM10  MVC   SVUSRNMS,EUSRNMS-ESTHDR(RE)                                      
         XC    SVNTDMS,SVNTDMS                                                  
         CLC   ELEN-ESTHDR(L'ELEN,RE),=AL2(ESTHDR2Q)                            
         JL    *+10                                                             
         MVC   SVNTDMS,ENONTDMS-ESTHDR(RE)                                      
*                                                                               
* BUILD SVDEMCAT, SVDEMVAL, & SVNUMDEM                                          
*                                                                               
         L     RE,LP_AINP                                                       
         CLI   0(RE),MOSDELQ       X'62' - NIELSEN SELLER DEMO?                 
         JE    EDTTDM00                                                         
         CLI   0(RE),MOSNTELQ      X'5F' - NON-TRAD SELLER DEMO?                
         JE    EDTNDM00                                                         
         DC    H'0'                ANYTHING ELSE, HAVE A PROBLEM                
*                                                                               
* USE TRADITIONAL (IE NIELSEN), X'62' MOSDELQ, DEMO ELEMENT                     
*                                                                               
         USING MODMELD,RE                                                       
EDTTDM00 LLC   R0,MODMLEN                                                       
         SHI   R0,MODMOVRH           R0 = (# OF DEMOS) * 8 BYTES                
         LR    R1,R0                 COPY THE # OF DEMOS * 8 BYTES              
         SRL   R1,3                  R1 = # OF DEMO CATEGORIES                  
         STC   R1,SVNUMDEM           STORE NUMBER FOR LATER                     
         LA    R2,MODMDEMO           R2 = A(FIRST DEMO)                         
         DROP  RE                                                               
*                                                                               
         LA    RF,SVDEMCAT                                                      
         XC    SVDEMCAT,SVDEMCAT                                                
         LA    RE,SVDEMVAL                                                      
         XC    SVDEMVAL,SVDEMVAL                                                
EDTTDM10 MVC   0(3,RF),0(R2)                                                    
         MVC   0(4,RE),4(R2)         GRAB VALUE AS WELL                         
*                                                                               
         LA    RE,4(RE)              NEXT DEMO                                  
         LA    RF,3(RF)                                                         
         LA    R2,8(R2)                                                         
         JCT   R1,EDTTDM10           LOOP BACK IF THERE ARE MORE DEMOS          
         J     EDTDM20                                                          
*                                                                               
* USE NON-TRADITIONAL, X'5F' MOSNTELQ , DEMO ELEMENT                            
*                                                                               
         USING MONTELD,RE                                                       
EDTNDM00 LLC   R1,MONTLEN                                                       
         SHI   R1,MONTOVRH           R1 = (# OF DEMOS) * 8 BYTES                
         SR    R0,R0                 SETUP FOR DIVIDE                           
         LHI   RF,9                  SETUP RF FOR DIVIDE BY 9                   
         DR    R0,RF                 R1 = # OF DEMO CATEGORIES                  
         STC   R1,SVNUMDEM           STORE NUMBER FOR LATER                     
         LA    R2,MONTDEMO           R2 = A(FIRST DEMO)                         
         DROP  RE                                                               
*                                                                               
         LA    RF,SVDEMCAT                                                      
         XC    SVDEMCAT,SVDEMCAT                                                
         LA    RE,SVDEMVAL                                                      
         XC    SVDEMVAL,SVDEMVAL                                                
EDTNDM10 MVC   0(3,RF),0(R2)         GRAB DEMO CATEGORY                         
         MVC   0(4,RE),4(R2)         GRAB VALUE AS WELL                         
*                                                                               
         LA    RE,4(RE)              NEXT DEMO                                  
         LA    RF,3(RF)                                                         
         LA    R2,L'MONTDEMO(R2)                                                
         JCT   R1,EDTNDM10           LOOP BACK IF THERE ARE MORE DEMOS          
         J     EDTDM20                                                          
*                                                                               
* WE'RE READY FOR TO CALL DEMOCON                                               
*                                                                               
EDTDM20  XC    ELEM,ELEM             NOW TO CONVERT TO DEMO CAT TEXT            
         LA    RE,SVDBLOCK           WE'LL USE SVDBLOCK FOR DBLOCK              
         USING DBLOCKD,RE                                                       
         MVC   DBCOMFCS,ACOMFACS                                                
         MVC   DBFILE(3),=C'TP '                                                
         MVI   DBSELMED,C'T'                                                    
         DROP  RE                                                               
*                                                                               
         XC    DMCB(8),DMCB                                                     
         MVC   DMCB+4(4),=X'D9000AE0'  DEMOCON                                  
         L     RF,ACOMFACS         LOAD FACILITIES OVERLAYS                     
         L     RF,CCALLOV-COMFACSD(RF)                                          
         GOTO1 (RF),DMCB           GET ADDRESS OF DEMOCON                       
*                                                                               
         L     RF,0(R1)            RF=A(DEMOCON)                                
         GOTO1 (RF),(R1),(SVNUMDEM,SVDEMCAT),(13,ELEM),(C'S',SVDBLOCK),+        
               (0,SVUSRNMS),(0,SVNTDMS)                                         
         CLI   DMCB,X'FF'         HAVE ERROR?                                   
         JE    *+2                 YES, CAN'T CONTINUE, DIE                     
*                                                                               
         L     RE,LP_AOUT          TIME FOR FORMAT THE SELLER                   
         LLC   R1,SVNUMDEM         DEMO CATEGORIES=VALUES                       
         LA    R2,ELEM                                                          
         LA    R3,SVDEMVAL                                                      
*                                                                               
EDTDM50  MVC   0(11,RE),0(R2)      REDUCE ANY TRAILING SPACES                   
         LA    RF,10(RE)                                                        
EDTDM55  CR    RF,RE               EMPTY STRING?                                
         JNH   *+2                                                              
         CLI   0(RF),C' '          NO MORE TRAILING SPACES                      
         JH    EDTDM60                                                          
         JCT   RF,EDTDM55                                                       
*                                                                               
EDTDM60  MVI   1(RF),C'='          AFTER NON-SPACE, PUT THE '='                 
         LA    RE,2(RF)            RE = A(1ST DIGIT OF 6 DIGIT VALUE)           
*                                                                               
         LR    R0,RE               save a(output area)                          
         BRAS  RE,OUTDVAL                                                       
         LR    RE,R0               get new a(output area)                       
*                                                                               
EDTDM70  CHI   R1,1                WILL WE HAVE ANOTHER?                        
         JE    EDTDM80                                                          
         MVC   0(2,RE),=C', '       PREPARE FOR THE NEXT DEMO                   
         LA    RE,2(RE)                                                         
*                                                                               
         LA    R2,11(R2)                                                        
         LA    R3,4(R3)                                                         
         JCT   R1,EDTDM50                                                       
*                                                                               
EDTDM80  L     RF,LP_AOUT                                                       
         SR    RE,RF                                                            
*                                                                               
EDTDMX   STCM  RE,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* OUTPUT THE DEMO VALUE                                                         
*                                                                               
* ON INPUT:   (R0)                 A(OUTPUT TEXT)                               
*             (R3)                 A(DEMO BIT AND VALUE)                        
***********************************************************************         
OUTDVAL  NTR1                                                                   
         LR    RE,R0                                                            
         XR    R0,R0                                                            
         ICM   R0,7,1(R3)                                                       
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  1(6,RE),DUB         0123456                                      
*                                                                               
         TM    0(R3),MODM2DEC      X'40' - TWO DECIMAL PRECISION?               
         JNZ   OUTDV10                                                          
         MVC   0(5,RE),1(RE)                                                    
         MVI   5(RE),C'.'                                                       
         J     OUTDV15                                                          
*                                  WE'LL HAVE LEADING ZEROS                     
OUTDV10  MVC   0(4,RE),1(RE)                                                    
         MVI   4(RE),C'.'                                                       
*                                  WE'LL HAVE LEADING ZEROS                     
OUTDV15  LA    R6,7                7 CHARACTERS WITH THE DECIMAL POINT          
         LR    RF,RE                                                            
OUTDV20  CLI   0(RF),C'0'          DO WE HAVE A LEADING ZERO?                   
         JNE   OUTDV30                                                          
         CLI   1(RF),C'.'          YES, IS IT ZERO AND A DECIMAL PT?            
         JE    OUTDV30                                                          
         LA    RF,1(RF)            A LEADING ZERO WE CAN GET RID OF             
         JCT   R6,OUTDV20          ONE LESS CHARACTER                           
*                                                                               
OUTDV30  BCTR  R6,0                                                             
         BASR  R2,0                                                             
         MVC   0(0,RE),0(RF)                                                    
         EX    R6,0(R2)                                                         
         LA    RE,1(R6,RE)                                                      
         XC    0(8,RE),0(RE)                                                    
         LR    R0,RE                                                            
*                                                                               
OUTDVX   XIT1  REGS=(R0)                                                        
*                                                                               
EDVWORKD DSECT                     ** EDTDEMV LOCAL WORKING STORAGE **          
SVDBLOCK DS    XL300                                                            
SVNUMDEM DS    XL1                 # OF DEMOS                                   
SVDEMCAT DS    10XL3               ROOM FOR 10 DEMO CATEGORIES                  
SVDEMVAL DS    10XL4                        10 DEMO VALUES AND BIT              
SVUSRNMS DS    CL28                                                             
SVNTDMS  DS    CL(20*L'ENONTDMS)                                                
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* Edit out offered line's comment line number                                   
***********************************************************************         
                                                                                
EDTCMLN  L     R1,LP_AINP          For seller demo values, the comment          
         L     RF,LP_AOUT                                                       
*                                                                               
         LLC   RE,0(R1)            Get the comment line number                  
         TM    OFFSDFLG,OFFSDEM    HAVE TRAD SELLER DEMOS?                      
         JZ    *+8                                                              
         LA    RE,1(RE)            yes, increment line number by 1              
*                                                                               
         TM    OFFSDFLG,OFFSNDEM   HAVE NON-TRAD SELLER DEMOS?                  
         JZ    *+8                                                              
         LA    RE,1(RE)            yes, increment line number by 1              
*                                                                               
         CVD   RE,DUB              COMMENT LINE # MAX OF 3 DIGITS               
         OI    DUB+7,X'0F'                                                      
*                                                                               
         LA    R1,2                                                             
         CHI   RE,99               WE USED ALL 3 DIGITS?                        
         JH    EDTCL10             YES                                          
*                                                                               
         LA    R1,1                                                             
         CHI   RE,9                2 DIGITS?                                    
         JH    EDTCL10             YES                                          
         XR    R1,R1               NO, ONLY 1 DIGIT                             
*                                                                               
EDTCL10  BASR  RE,0                                                             
         UNPK  0(0,RF),DUB                                                      
         EX    R1,0(RE)                                                         
         LA    R1,1(R1)                                                         
*                                                                               
EDTCLX   STCM  R1,15,LP_OLEN                                                    
         B     EXITY                                                            
         EJECT                                                                  
**********************************************************************          
* EDIT EMAIL TOKEN AND EXTRACT EMAIL ADDRESS FROM EMAIL RECORD       *          
**********************************************************************          
                                                                                
         USING EMWORKD,RC                                                       
         USING EMLRECD,EMIO                                                     
EDTEML   MVC   EMIOSAVE,IOVALS     SAVE CURRENT I/O VALUES                      
         L     R1,LP_AINP          R1=A(EMAIL TOKEN)                            
         OC    0(L'EMLKTOK,R1),0(R1)                                            
         JZ    EDTEMLN                                                          
                                                                                
         XC    EMLKEY,EMLKEY       READ FOR THE EMAIL TOKEN                     
         MVI   EMLKTYP,EMLKTYPQ                                                 
         MVI   EMLKSUB,EMLKSUBQ                                                 
         MVC   EMLKAGY,AGENCY                                                   
         MVC   EMLKTOK,0(R1)                                                    
                                                                                
         MVC   IOKEY,EMLKEY                                                     
         LA    R1,EMIO                                                          
         ST    R1,IOADDR                                                        
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IOXSPDIR'                                
         JNE   EDTEMLN                                                          
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOXSPFIL'                               
         JNE   EDTEMLN                                                          
                                                                                
         LA    R1,EMLELS                                                        
         USING EMLELD,R1                                                        
         SR    R0,R0                                                            
EDTEML02 CLI   EMLEL,EOR           TEST END OF RECORD                           
         JE    EDTEMLN                                                          
         CLI   EMLEL,EMLELQ        TEST EMAIL ADDRESS ELEMENT                   
         JE    EDTEML04                                                         
         IC    R0,EMLLEN           BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         J     EDTEML02                                                         
                                                                                
EDTEML04 LLC   RF,EMLLEN                                                        
         SHI   RF,EMLLENQ                                                       
         ST    RF,LP_OLEN                                                       
                                                                                
         BCTR  RF,0                                                             
         L     R2,LP_AOUT                                                       
         BASR  RE,0                                                             
         MVC   0(0,R2),EMLADDR                                                  
         EX    RF,0(RE)                                                         
         MVC   IOVALS(IOVALL),EMIOSAVE                                          
         B     EXITY                                                            
                                                                                
EDTEMLN  MVC   IOVALS(IOVALL),EMIOSAVE                                          
         B     XCOLEN                                                           
         DROP  RC                                                               
                                                                                
EMWORKD  DSECT                     ** EDTEML LOCAL WORKING STORAGE **           
EMIOSAVE DS    XL(IOVALL)          SAVED I/O VALUES                             
EMIO     DS    XL2000              EMAIL ADDRESS RECORD                         
SVRDEF   CSECT                                                                  
                                                                                
***********************************************************************         
* ROUTINE TO ADJUST DEMO PRECISION TO 1 OR TWO DECIMAL PLACES BASED   *         
* ON VALUE ITSELF AND PROFILE OPTION - VALUE PASSED IN FULL(4)        *         
***********************************************************************         
                                                                                
***********************************************************************         
* ROUTINE TO ADJUST DEMO PRECISION TO 1 OR TWO DECIMAL PLACES BASED   *         
* ON VALUE ITSELF AND PROFILE OPTION - VALUE PASSED IN FULL(4)        *         
***********************************************************************         
                                                                                
ADJPRC   STM   RE,R2,12(RD)                                                     
         L     R2,LP_ATWA                                                       
         USING TWAD,R2                                                          
                                                                                
         TM    FULL,NDEM2DEC       TEST DEMO AT 2 DECIMAL PLACES                
         JNZ   ADJPRC02            YES                                          
*                                  HAVE 1 DECIMAL PREC DEMO                     
         BRAS  RE,CHKPRC           DOES AGENCY USE 2 DECIMAL PREC               
         JNE   ADJPRCX              NO - LEAVE IT ALONE                         
         L     R0,FULL             ADJUST 1 DECIMAL PRECISION TO 2              
         MHI   R0,10                                                            
         ST    R0,FULL                                                          
         J     ADJPRCX                                                          
*                                  HAVE 2 DECIMAL PREC DEMO                     
ADJPRC02 NI    FULL,FF-NDEM2DEC    TURN OFF 2 DECIMAL PLACE FLAG                
         BRAS  RE,CHKPRC           TEST AGENCY USES 2 DECIMAL PREC              
         JE    ADJPRCX              YES - LEAVE IT ALONE                        
         L     R0,FULL             ADJUST 2 DECIMAL PRECISION TO 1              
         SRDA  R0,31               R1=2*FULL                                    
         LHI   RF,10                                                            
         DR    R0,RF                                                            
         AHI   R1,1                                                             
         SRA   R1,1                                                             
         ST    R1,FULL                                                          
                                                                                
ADJPRCX  LM    RE,R2,12(RD)                                                     
         BR    RE                                                               
*                                                                               
CHKPRC   SR    R1,R1               FORCE DUMP AT CHKPRCX IF R1 NOT SET          
*&&DO                                                                           
         CLI   SVDEMORG,SVDMOBD    BUY DEMO?                                    
         JNE   CHKPRC10                                                         
*&&                                                                             
         OC    LP_VRSN,LP_VRSN     HAVE SBTK VERSION?                           
         JZ    *+14                                                             
         CLC   LP_VRSN,V470037     SBTK V4.7.0.37 OR LOWER?                     
         JL    CHKPRCR              -YES, ASSUME RATING                         
*                                                                               
         CLI   QMEDA,C'R'          IF MEDIA R                                   
         JNE   CHKPRC05             NO                                          
         LA    R1,=C'N'            ONLY SUPPORT 1-DEC RTGS/IMPS                 
         J     CHKPRCX                                                          
*                                                                               
CHKPRC05 CLI   QMEDA,C'X'          IF MEDIA X                                   
         JNE   CHKPRC10             NO                                          
         LA    R1,=C'Y'             DFLT SUPPORT 2-DEC RTGS                     
         CLI   SVDEMTYP,C'R'       IF RATING                                    
         JE    CHKPRCX              SUPPORT 2-DEC RATS                          
         CLI   SVDEMTYP,C'E'       OR EXTENDED                                  
         JE    CHKPRCX              SUPPORT 2-DEC RATS                          
         LA    R1,=C'N'            ELSE, SUPPORT 1-DEC IMPS                     
         J     CHKPRCX                                                          
*                                                                               
CHKPRC10 CLI   QMEDA,C'T'          IF MEDIA T                                   
         JNE   *+2                                                              
         CLI   SVDEMTYP,C'R'       RATING                                       
         JE    CHKPRCR                                                          
         CLI   SVDEMTYP,C'E'       EXTENDED                                     
         JNE   CHKPRCI                                                          
*                                                                               
CHKPRCR  DS    0H                  HAVE RATING/EXTENDED DEMO                    
*&&DO                                                                           
         CLI   SVDEMORG,SVDMOGD    GOAL DEMO?                                   
         JNE   *+8                                                              
         LA    R1,PROFG0V+7                                                     
         CLI   SVDEMORG,SVDMOBD    BUY DEMO?                                    
         JNE   *+8                                                              
*&&                                                                             
CHKPRCRZ LA    R1,SVS002DP                                                      
         J     CHKPRCX                                                          
*                                                                               
CHKPRCI  DS    0H                  HAVE IMPRESSION DEMO                         
*&&DO                                                                           
         CLI   SVDEMORG,SVDMOGD    GOAL DEMO?                                   
         JNE   *+8                                                              
         LA    R1,PROFG0V+8                                                     
         CLI   SVDEMORG,SVDMOBD    BUY DEMO?                                    
         JNE   *+8                                                              
*&&                                                                             
         LA    R1,SVS00A2DI                                                     
CHKPRCX  CLI   0(R1),C'Y'          TEST 2-DEC PRECISION,                        
         BR    RE                   AND RETURN CC                               
         DROP  R2                                                               
*                                                                               
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO GET STATION CALL LETTERS                                 *         
*                                                                     *         
* NTRY:- R1=A(COMPRESSED MARKET/STATION)                              *         
***********************************************************************         
                                                                                
GETSTA   NTR1  LABEL=NO                                                         
         XC    STAPACKD(STAPACKL),STAPACKD                                      
         MVI   STAPACT,C'U'                                                     
         MVC   STAPAGY,LP_AGY                                                   
         L     RF,AAGYREC                                                       
         MVC   STAPCTRY,AGYPCNDA-AGYHDR(RF)                                     
         MVC   STAPMED,BUYMED                                                   
         MVC   STAPACOM,ACOMFACS                                                
         MVC   STAPMKST,0(R1)                                                   
         GOTOR VSTAPACK,STAPACKD                                                
         CLI   STAPMED,RADMEDQ     TEST RADIO                                   
         JE    GETSTA02                                                         
         CLC   STAPQNET,SPACES     TEST CABLE CHANNEL SET                       
         JE    *+8                                                              
         MVI   STAPQSTA+L'STAPQSTA-1,C'/'                                       
         J     GETSTAX                                                          
                                                                                
GETSTA02 LLC   R0,STAPQSTA+L'STAPQSTA-1                                         
         LA    RE,STAPQSTA+L'STAPQSTA-2                                         
         CLI   0(RE),C' '                                                       
         JH    *+8                                                              
         JCT   RE,*-8                                                           
         MVI   1(RE),C'-'                                                       
         STC   R0,2(RE)                                                         
         MVI   3(RE),C' '                                                       
                                                                                
GETSTAX  B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* GET CHECK SUM FOR A SPTFIL RECORD                                   *         
***********************************************************************         
                                                                                
GETSUM   STM   RE,R2,12(RD)                                                     
         LR    R2,R1               R2=A(CHECK SUM DESTINATION FIELD)            
         L     RE,IOADDR                                                        
         SR    RF,RF                                                            
         ICM   RF,3,BUYRLEN-BUYREC(RE)                                          
         SR    R0,R0                                                            
         CKSM  R0,RE                                                            
         JO    *-4                                                              
         STCM  R0,15,0(R2)                                                      
         LM    RE,R2,12(RD)                                                     
         BR    RE                                                               
                                                                                
***********************************************************************         
* GET CHECK SUM FOR A XSPFIL RECORD                                   *         
***********************************************************************         
                                                                                
GETXSUM  STM   RE,R2,12(RD)                                                     
         LR    R2,R1               R2=A(CHECK SUM DESTINATION FIELD)            
         L     RE,IOADDR                                                        
         SR    RF,RF                                                            
         ICM   RF,3,MNXRLEN-MNXKEY(RE)                                          
         SR    R0,R0                                                            
         CKSM  R0,RE                                                            
         JO    *-4                                                              
         STCM  R0,15,0(R2)                                                      
         LM    RE,R2,12(RD)                                                     
         BR    RE                                                               
         EJECT                                                                  
                                                                                
GETTIME  LR    R2,RE               GET CURRENT TIME IN TU'S IN FULL             
         TIME  TU                                                               
         ST    R0,FULL                                                          
         LR    RE,R2                                                            
         CR    RE,RE                                                            
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* INITIALIZE REQUEST DATES                                            *         
***********************************************************************         
                                                                                
INIDAT   NTR1  LABEL=NO                                                         
         OC    QSTRDATE,QSTRDATE   SET START DATES                              
         JZ    INIDAT02                                                         
         GOTOR VDATCON,DMCB,QSTRDATE,(3,STRDATEB)                               
         GOTOR (RF),(R1),QSTRDATE,(2,STRDATEC)                                  
         GOTOR VGETDAY,DMCB,QSTRDATE,WORK                                       
         MVC   STRDMONC,STRDATEC                                                
         CLI   0(R1),1             TEST START DATE IS A MONDAY                  
         JE    INIDAT02                                                         
         SR    R0,R0               NO - GET DATE OF PREVIOUS MONDAY             
         ICM   R0,1,0(R1)                                                       
         JZ    *+2                                                              
         SHI   R0,1                                                             
         LNR   R0,R0                                                            
         GOTOR VADDAY,DMCB,QSTRDATE,WORK,(R0)                                   
         GOTOR VDATCON,DMCB,WORK,(2,STRDMONC)                                   
                                                                                
INIDAT02 CLC   QENDDATE,EFFS       SET END DATES                                
         JE    INIDATX                                                          
         GOTOR VDATCON,DMCB,QENDDATE,(3,ENDDATEB)                               
         GOTOR (RF),(R1),QENDDATE,(2,ENDDATEC)                                  
                                                                                
INIDATX  B     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* INTERFACE TO TSAR (ONLINE) OR BUFFERIN (OFFLINE)                    *         
***********************************************************************         
                                                                                
         USING BUFFD,FLMBUF                                                     
BUFFER   NTR1  LABEL=NO                                                         
         LR    R2,R1                                                            
         MVC   TSACTN,0(R2)                                                     
                                                                                
         CLI   TSACTN,TSAINI       TEST INITIALIZATION CALL                     
         JNE   BUFFER02                                                         
         XC    TSARBLK,TSARBLK     CLEAR TSAR BLOCK                             
         MVI   TSACTN,TSAINI                                                    
         LA    R0,TSARREC                                                       
         ST    R0,TSAREC                                                        
         MVC   TSACOM,ACOMFACS                                                  
         MVI   TSPAGN,8                                                         
         OI    TSINDS,TSINODSK+TSIXTTWA                                         
         MVC   TSKEYL,4(R2)                                                     
         MVC   TSRECL,6(R2)                                                     
                                                                                
BUFFER02 TM    LP_FLAG,LP_FOFFL    TEST OFFLINE                                 
         JNZ   BUFFER04            YES                                          
         GOTOR VTSAR,TSARD         ELSE USE TSAR                                
         BE    EXIT                                                             
         CLI   TSERRS,TSEDUP       ALLOW DUPLICATE KEY ERROR                    
         B     EXIT                                                             
                                                                                
BUFFER04 LHI   R0,BUFFAINI         CONVERT TSAR ACTION CODE TO BUFFERIN         
         CLI   TSACTN,TSAINI                                                    
         JNE   BUFFER06                                                         
         LLC   RE,TSKEYL                                                        
         SR    RF,RF                                                            
         ICM   RF,3,TSRECL                                                      
         SR    RF,RE                                                            
         STCM  RE,3,BUFFLKEY       SET KEY LENGTH                               
         STCM  RF,3,BUFFLCOM       SET COMMENT LENGTH                           
         J     BUFFER08                                                         
                                                                                
BUFFER06 LHI   R0,BUFFAPUT                                                      
         CLI   TSACTN,TSAADD                                                    
         JE    BUFFER08                                                         
         CLI   TSACTN,TSAWRT                                                    
         JE    BUFFER08                                                         
         LHI   R0,BUFFASEQ                                                      
         CLI   TSACTN,TSANXT                                                    
         JE    BUFFER08                                                         
         MVC   TSARSAV,TSARREC                                                  
         LHI   R0,BUFFARDH                                                      
         CLI   TSACTN,TSARDH                                                    
         JNE   *+2                                                              
                                                                                
BUFFER08 GOTOR ABUFFRIN,DMCB,((R0),BUFFD),TSARREC,ACOMFACS                      
         CLI   TSACTN,TSARDH                                                    
         JNE   BUFFER10                                                         
         LLC   RF,TSKEYL                                                        
         BCTR  RF,0                                                             
         BASR  RE,0                                                             
         CLC   TSARREC(0),TSARSAV                                               
         EX    RF,0(RE)                                                         
         JE    BUFFER10                                                         
         OI    BUFFERRS-BUFFPARM(R1),BUFFERNF                                   
                                                                                
BUFFER10 MVC   TSERRS,BUFFERRS-BUFFPARM(R1)                                     
         CLI   TSERRS,0                                                         
         B     EXIT                                                             
         EJECT                                                                  
***********************************************************************         
* RESOLVE CLIENT DETAILS FOR BUY DOWNLOADS                            *         
***********************************************************************         
                                                                                
RESCLT   NTR1  LABEL=NO                                                         
         GOTOR (#GETCLT,AGETCLT)                                                
         BNE   EXIT                                                             
         GOTOR (#EDTCLT,AEDTCLT),DMCB,QCLTX,,QCLTA                              
RESCLTX  B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* SET VALUES FROM CURRENT ORDER RECORD                                *         
***********************************************************************         
                                                                                
SETORD   NTR1  LABEL=NO                                                         
         L     R2,AORDREC                                                       
         USING DAREORDD,R2         R2=A(DARE ORDER RECORD)                      
         ST    R2,LP_ADATA                                                      
         LA    R0,ORDOVALS                                                      
         LHI   R1,ORDOVALL                                                      
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
                                                                                
         MVC   FULL,DOKORDER                                                    
         XC    FULL,EFFS                                                        
*                                                                               
         TM    FULL,X'80'          NEW STYLE ORDER NUMBER?                      
         JZ    STORD020             NO                                          
         LA    R6,DORFRST           YES                                         
STORD010 CLI   0(R6),0                                                          
         JE    *+2                                                              
         CLI   0(R6),DOSPELQ       X'03' ELEM                                   
         JE    STORD015                                                         
         LLC   R0,1(R6)                                                         
         AR    R6,R0                                                            
         J     STORD010                                                         
*                                                                               
         USING DOSPELD,R6                                                       
STORD015 MVC   ORDCREAT,DOSPCDAT   GRAB CREATION DATE FROM ELEM                 
         J     STORD023                                                         
         DROP  R6                                                               
*                                                                               
STORD020 SR    R1,R1               EXTRACT ORDER CREATEION DATE FROM            
         ICM   R1,3,FULL            OLD STYLE ORDER NUMBER                      
         CVD   R1,DUB                                                           
         ZAP   FULL,DUB                                                         
         SRP   DUB,61,0                                                         
         AP    DUB,=P'90'                                                       
         SRP   DUB,3,0                                                          
         AP    DUB,FULL+2(2)                                                    
         ICM   R1,15,DUB+4                                                      
         SRL   R1,4                                                             
         STCM  R1,7,ORDCREAT       PWOS JULIAN                                  
                                                                                
STORD023 MVC   ORDSTAX,DOKSTA      SET PACKED STATION VALUE                     
         GOTOR ADDSTA,ORDSTAX      ADD TO STATION LIST IF NECESSARY             
         MVI   ORDISTAT,QUNSENT    SET INTERNAL STATUS AS UNSENT                
                                                                                
         MVC   ORDDA,IODA          SET ORDER DISK ADDRESS                       
         GOTOR GETSUM,ORDCKSM      SET ORDER CHECK SUM                          
                                                                                
         MVC   SVIOVALS,IOVALS                                                  
         MVI   ORDEXTRA,NOQ        SET EXTRA RECORD DOESN'T EXIST               
         MVC   IOKEY(L'DOKEY),DOKEY                                             
         MVI   IOKEY+(DOKCMT-DOKEY),DOKEXTRA                                    
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IODIR+IO6'                               
         JNE   STORD025                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL+IO6'                              
         JNE   STORD025                                                         
         MVI   ORDEXTRA,YESQ       SET EXTRA RECORD DOES EXIST                  
                                                                                
STORD025 MVC   IOVALS(IOVALL),SVIOVALS                                          
                                                                                
         LA    R2,DORFRST          POINT TO FIRST RECORD ELEMENT                
         USING DOSTELD,R2                                                       
         MVI   ORDTFLAG,0                                                       
         MVI   ORDCSTAT,QUNSENT    '-' IS DEFAULT UNSENT STATUS                 
                                                                                
STORD030 CLI   DOSTEL,EOR          TEST END OF RECORD                           
         JE    STORD090                                                         
         CLI   DOSTEL,DOSTELQ      TEST STATUS ELEMENT                          
         JE    STORD040                                                         
                                                                                
         LLC   R0,DOSTLEN          BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         J     STORD030                                                         
                                                                                
STORD040 MVC   ORDLADAT,DOSTDATE   SET LAST ACTIVITY DATE                       
         MVC   ORDCSTAT,DOSTSTAT   SET CURRENT STATUS                           
         MVC   ORDISTAT,DOSTSTAT   SET CURRENT STATUS (INTERNAL)                
         CLI   DOSTLEN,DOSTLNQ3    TEST ELEMENT CARRIES STATUS TYPE             
         JNE   STORD050                                                         
         OI    ORDTFLAG,OTFTYP3    SET FLAG                                     
         MVC   ORDTTYPE,DOSTTYPE   EXTRACT STATUS TYPE                          
*                                                                               
* PRIOR TO V4.6.0.156, SBTK INCORRECTLY SHOWS CANCELLED REJECTED STATUS         
* AS AMENDED STATUS. SO IF LT V4.6.0.156, JUST SHOW REJECT                      
*                                                       -HWON 7/25/2017         
         CLI   DOSTSTAT,QRJCT      HAVE A REJECT TYPE STATUS?                   
         JNE   STORD060             NO                                          
         CLI   DOSTTYPE,0          RJCT/AMEND STATUS?                           
         JE    STORD060             YES                                         
         OC    LP_VRSN,LP_VRSN     HAVE SBTK VER#?                              
         JZ    STORD060             NO, OK TO SHOW CANCELLED REJECTED           
         CLC   LP_VRSN,V4600156    SBTK VER# GTE V4.6.0.156                     
         JNL   STORD060             YES, SHOW CANCELLED REJECT                  
         NI    ORDTFLAG,X'FF'-OTFTYP3                                           
         J     STORD060                                                         
                                                                                
STORD050 CLI   DOSTLEN,DOSTLNQ7    SEND HAS A STATUS TYPE CANCEL                
         JNE   STORD060                                                         
         OI    ORDTFLAG,OTFTYP7    SET FLAG                                     
         MVC   ORDTTYPE,DOSTTYP2   EXTRACT STATUS TYPE                          
                                                                                
STORD060 CLI   DOSTSTAT,DDLVRD     TEST DELIVERED STATUS                        
         JE    *+8                                                              
         CLI   DOSTSTAT,DFXDLVD                                                 
         JE    *+8                                                              
         CLI   DOSTSTAT,DEMDLVD                                                 
         JNE   STORD070                                                         
         LLC   R0,DOSTLEN          YES - BUMP TO NEXT ELEMENT                   
         AR    R2,R0                                                            
         CLI   DOSTEL,DOSTELQ      TEST THIS IS A STATUS ELEMENT                
         JNE   STORD070                                                         
                                                                                
         CLI   DOSTSTAT,QCFMD      IF CONFIRMED OR REJECTED IS THE NEXT         
         JE    STORD040            STATUS ELEMENT, THEN IGNORE                  
         CLI   DOSTSTAT,QRJCT      THE DELIVERED STATUS                         
         JE    STORD040                                                         
                                                                                
         MVC   ORDPSTAT,DOSTSTAT   YES - SET PREVIOUS STATUS                    
                                                                                
         CLI   DOSTLEN,DOSTLNQ7    SEND HAS A STATUS TYPE CANCEL                
         JNE   STORD070                                                         
         OI    ORDTFLAG,OTFTYP7    SET FLAG                                     
         MVC   ORDTTYPE,DOSTTYP2   EXTRACT STATUS TYPE                          
                                                                                
STORD070 CLI   DOSTSTAT,DSENT      TEST SENT                                    
         JNE   STORD080            NO, LOOP UNTIL END FOR 1ST EDI               
         MVC   ORDFEDAT,DOSTDATE   SET ONLY FOR EDI SENDS                       
                                                                                
STORD080 LLC   R0,DOSTLEN          BUMP TO NEXT ELEMENT                         
         AR    R2,R0                                                            
         CLI   DOSTEL,EOR          TEST TIL END OF RECORD                       
         JE    STORD090                                                         
         CLI   DOSTEL,DOSTELQ      TEST STATUS ELEMENT                          
         JE    STORD070                                                         
         J     STORD080                                                         
                                                                                
STORD090 L     R2,AORDREC          LOCATE DEMO CATEGORY ELEMENT                 
         USING DAREORDD,R2                                                      
         LA    R2,DORFRST                                                       
         USING DODEMELD,R2                                                      
STORD100 CLI   DODEMEL,EOR         END OF RECORD?                               
         JE    STORD120                                                         
         CLI   DODEMEL,DODEMELQ    DEMO ELEMENT?                                
         JE    STORD110                                                         
         LLC   R0,DODEMLEN                                                      
         AR    R2,R0                                                            
         J     STORD100                                                         
                                                                                
STORD110 SR    R1,R1                                                            
         ICM   R1,1,DODEMNUM       R1=NUMBER OF DEMO CATEGORIES                 
         JNZ   *+12                                                             
         MVI   ORDDEMN+L'ORDDEMN-1,1                                            
         J     STORD120                                                         
*                                                                               
         CHI   R1,4                HAVE MORE THAN 4?                            
         JNH   STORD111             NO                                          
         OC    LP_VRSN,LP_VRSN     HAVE SBTK VER#?                              
         JZ    STORD111             NO                                          
         CLC   LP_VRSN,=AL1(4,6,0,120) SBTK VER# LTE V4.6.0.120                 
         JH    STORD111                 NO                                      
         LA    R1,4                     YES, ONLY D/L 4 DEMOS O/W SBTK          
*                                         WILL RTE                              
STORD111 STCM  R1,3,ORDDEMN                                                     
         MHI   R1,L'DODEMOS                                                     
         LA    R0,ORDDEMO                                                       
         LA    RE,DODEMOS                                                       
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
         DROP  R2                                                               
                                                                                
STORD120 MVI   ORDFL1,0                                                         
         XC    ORDVALS(ORDVALL),ORDVALS                                         
                                                                                
         L     R2,AORDREC          LOCATE DEMO CATEGORY ELEMENT                 
         USING DAREORDD,R2                                                      
         LA    R2,DORFRST          EXTRACT TRADE TYPE & DATA                    
         USING DOSPELD,R2                                                       
STORD130 CLI   DOSPEL,EOR                                                       
         JE    STORD150                                                         
         CLI   DOSPEL,DOSPELQ                                                   
         JE    STORD140                                                         
         LLC   R0,DOSPLEN                                                       
         AR    R2,R0                                                            
         J     STORD130                                                         
                                                                                
STORD140 MVC   ORDFL1,DOSPFLG1                                                  
         MVC   ORDREVN,DOSPREVN                                                 
                                                                                
         CLI   DOSPLEN,DOSPTMTH-DOSPELD                                         
         JNH   STORD150                                                         
         MVC   ORDMTHD,DOSPTMTH                                                 
         MVC   ORDDATA,DOSPTDAT                                                 
         MVC   ORDFADAT,DOSPFAID                                                
         CLC   DOSPFAID,EFFS                                                    
         JNE   *+10                                                             
         XC    ORDFADAT,ORDFADAT                                                
                                                                                
         XC    ORDSCNT,ORDSCNT                                                  
         CLI   DOSPLEN,DOSPTLNQ                                                 
         JNH   *+10                                                             
         MVC   ORDSCNT,DOSPVER#                                                 
         DROP  R2                                                               
                                                                                
         CLI   ORDCSTAT,QCFMD      STATUS OF ORDER IS CONFIRMED?                
         JE    STORD150                                                         
         CLI   ORDCSTAT,QRJCT      STATUS OF ORDER IS REJECTED?                 
         JNE   SETORDX                                                          
                                                                                
STORD150 MVC   SVIOVALS,IOVALS                                                  
         L     R2,AORDREC                                                       
         USING DAREORDD,R2                                                      
         XC    IOKEY,IOKEY                                                      
         MVC   IOKEY(L'DOKEY),DOKEY                                             
         MVI   IOKEY+DOKCMT-DOKEY,DOKCURLQ                                      
         MVI   BYTE2,DOCM2ELQ                                                   
         CLI   ORDCSTAT,QRJCT                                                   
         JNE   STORD160                                                         
         MVI   IOKEY+DOKCMT-DOKEY,DOKRURLQ                                      
         MVI   BYTE2,DRURLELQ                                                   
                                                                                
STORD160 GOTOR (#IOEXEC,AIOEXEC),'IORD+IODIR+IO7'                               
         JE    STORD170                                                         
         MVC   IOVALS(IOVALL),SVIOVALS                                          
         J     SETORDX                                                          
                                                                                
STORD170 GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL+IO7' **THIS MAY OVERFLOW*         
         JNE   *+2                                 **INTO IO8**                 
         XR    R2,R2                                                            
         ICM   R2,7,IOADDR+1                                                    
                                                                                
         MVC   IOVALS(IOVALL),SVIOVALS                                          
                                                                                
         USING DAREORDD,R2                                                      
         AHI   R2,DORFRST-DOKEY                                                 
STORD180 CLI   0(R2),0             EOR?                                         
         JE    SETORDX                                                          
         CLC   BYTE2,0(R2)         MATCH ON ELCODE WE WANT?                     
         JE    STORD190                                                         
         LLC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         J     STORD180                                                         
                                                                                
STORD190 CLI   ORDCSTAT,QRJCT                                                   
         JE    STORD200                                                         
         USING DOCM2ELD,R2                                                      
         CLC   ORDREVN,DOCM2REV                                                 
         JNE   SETORDX                                                          
         LLC   R1,1(R2)                                                         
         SHI   R1,DOCM2OVH+1                                                    
         STC   R1,ORDURLEL                                                      
         BASR  RE,0                                                             
         MVC   ORDURLEL+1(0),DOCM2TXT                                           
         EX    R1,0(RE)                                                         
         J     SETORDX                                                          
                                                                                
         USING DRURLELD,R2                                                      
STORD200 CLC   ORDSCNT,DRURLVER                                                 
         JNE   SETORDX                                                          
         LLC   R1,1(R2)                                                         
         SHI   R1,DRURLOVH+1                                                    
         STC   R1,ORDURLEL                                                      
         BASR  RE,0                                                             
         MVC   ORDURLEL+1(0),DRURLTXT                                           
         EX    R1,0(RE)                                                         
                                                                                
         LLC   R0,1(R2)            LOOK FOR REJECTION LINES                     
         AR    R2,R0                                                            
         CLI   0(R2),DRLINELQ                                                   
         JNE   SETORDX                                                          
         USING DRLINELD,R2                                                      
         CLC   ORDSCNT,DRLINVER                                                 
         JNE   SETORDX                                                          
         LLC   R1,DRLINLEN                                                      
         SHI   R1,DRLINOVH+1                                                    
                                                                                
         BASR  RE,0                                                             
         MVC   ORDRLINS(0),DRLINTXT                                             
         EX    R1,0(RE)                                                         
         AHI   R1,1                                                             
         SRL   R1,1                DIVIDE BY 2 AS LINES ARE 2 BYTES             
         STCM  R1,3,ORDNRLNS                                                    
         DROP  R2                                                               
                                                                                
SETORDX  B     EXITY                                                            
         EJECT                                                                  
***********************************************************************         
* ADD ESTIMATE TO LIST OF ESTIMATES                                   *         
***********************************************************************         
                                                                                
         USING EPKEY,IOKEY                                                      
FLTESP   GOTOR LP_AAWMP,DMCB,(L'EPKEYEST,EPKEYEST),ESTIND,255,LP_D              
         J     EXITN               NEVER READ ESTIMATE RECORDS                  
         EJECT                                                                  
***********************************************************************         
* APPLY 'SUBSCRIBED ORDER DOWNLOAD' FILTERS TO DARE ORDER KEY                   
***********************************************************************         
                                                                                
FSL      USING DAREORDD,IOKEY                                                   
FLTSOL   ICM   R1,7,ASOL           POINT TO FILTER ELEMENT IN WMP               
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         AHI   R1,LW_LN2Q                                                       
         USING SOLFD,R1            R1=A(FILTER ENTRY)                           
*                                  FULL+0(2) = CLIENT VALUE                     
         XC    FULL,FULL           FULL+2(2) = MARKET VALUE                     
                                                                                
FLTSOL02 CLC   FSL.DBCKAGMD(L'SOLFMED+L'SOLFBYR),SOLFMED                        
         JNE   FLTSOL70                                                         
                                                                                
***********************************************************************         
* LOOK AT THE CLIENTS                                                 *         
***********************************************************************         
                                                                                
CC       SR    R2,R2                                                            
         ICM   R2,1,SOLFCLT#       TEST ALL CLIENT SUBSCRIPTION                 
         JZ    FLTSOL30            TAKE                                         
                                                                                
         LA    RF,SOLFCLT          APPLY CLIENT FILTERS                         
FLTSOL10 CLC   FSL.DBCKCLT,0(RF)                                                
         JE    FLTSOL45                                                         
         JH    FLTSOL25                                                         
                                                                                
FLTSOL15 OC    FULL(2),FULL        WE HAVE A PROPOSED CLIENT?                   
         JZ    FLTSOL20            NO, WE HAVE ONE NOW                          
         CLC   0(2,RF),FULL                                                     
         JH    FLTSOL25                                                         
FLTSOL20 MVC   FULL(2),0(RF)                                                    
                                                                                
FLTSOL25 AHI   RF,L'SOLFCLT                                                     
         JCT   R2,FLTSOL10                                                      
         J     FLTSOL70                                                         
                                                                                
FLTSOL30 CLC   QCLTX,FSL.DBCKCLT   ALREADY PASS LIMIT ACCESS?                   
         JE    FLTSOL45                                                         
         MVC   QMEDX,FSL.DBCKAGMD                                               
         MVC   QCLTX,FSL.DBCKCLT                                                
         ST    RE,FULL2                                                         
         GOTOR (#GETCLT,AGETCLT)   GETCLT CALLS LIMCLT                          
         L     RE,FULL2                                                         
         JE    FLTSOL45                                                         
         MVC   FSL.DBCKMKT,=X'FFFF'                                             
         J     FLTSOLN                                                          
                                                                                
FLTSOL45 MVC   FULL(2),FSL.DBCKCLT                                              
                                                                                
***********************************************************************         
* LOOK AT THE MARKETS                                                 *         
***********************************************************************         
                                                                                
FLTSOL50 SR    R2,R2                                                            
         ICM   R2,1,SOLFMKT#       TEST ALL MARKET SUBSCRIPTION                 
         JZ    FLTSOLY                                                          
         LA    RF,SOLFMKT          APPLY MARKET FILTERS                         
FLTSOL55 CLC   FSL.DBCKMKT,0(RF)                                                
         JE    FLTSOLY                                                          
         JH    FLTSOL65                                                         
                                                                                
FLTSOL60 OC    FULL+2(2),FULL+2    WE HAVE A PROPOSED VALUE?                    
         JZ    *+14                NO, WE HAVE ONE NOW                          
         CLC   0(2,RF),FULL+2                                                   
         JH    FLTSOL65                                                         
         MVC   FULL+2(2),0(RF)                                                  
                                                                                
FLTSOL65 AHI   RF,L'SOLFMKT                                                     
         JCT   R2,FLTSOL55                                                      
                                                                                
FLTSOL70 AHI   R1,SOLFL            BUMP TO NEXT FILTER ENTRY                    
         JCT   R0,FLTSOL02         DO FOR NUMBER OF ENTRIES                     
                                                                                
FLTSOL75 CLC   FSL.DBCKCLT,FULL    WE HAVE A MATCH ON CLIENT?                   
         JE    FLTSOL90            YES, BUT NOT ON MKT                          
         OC    FULL(2),FULL        DO WE HAVE A PROPOSED CLIENT?                
         JNZ   FLTSOL80            YES                                          
         XR    R2,R2                                                            
         ICM   R2,7,FSL.DBCKAGMD   BUMP  "AGYMD/BUYER"                          
         AHI   R2,1                                                             
         STCM  R2,7,FSL.DBCKAGMD                                                
FLTSOL80 MVC   FSL.DBCKCLT,FULL                                                 
         XC    FSL.DBCKMKT(L'DBCKMKT+L'DBCKORDR),FSL.DBCKMKT                    
         J     FLTSOLN                                                          
                                                                                
FLTSOL90 OC    FULL+2(2),FULL+2    DO WE HAVE A PROPOSED MARKET?                
         JNZ   FLTSOL52                                                         
         XR    R2,R2                                                            
         ICM   R2,3,FSL.DBCKCLT                                                 
         AHI   R2,1                                                             
         STCM  R2,3,FSL.DBCKCLT                                                 
                                                                                
FLTSOL52 MVC   FSL.DBCKMKT,FULL+2                                               
         XC    FSL.DBCKORDR,FSL.DBCKORDR                                        
                                                                                
FLTSOLN  LTR   RE,RE               DOES NOT MATCH ANY FILTER                    
         BR    RE                                                               
                                                                                
FLTSOLY  MVC   ORDAM,FSL.DBCKAGMD  SET ORDER VALUES FROM BATCH KEY              
         MVC   ORDCLT,FSL.DBCKCLT                                               
         CR    RE,RE               APPLIED TO AT LEAST ONE FILTER               
         BR    RE                                                               
         DROP  R1,FSL                                                           
         EJECT                                                                  
SOLFD    DSECT                     ** SUBSCRIPTION FILTERS **                   
SOLFMED  DS    XL(L'DBCKAGMD)      AGENCY/MEDIA CODE                            
SOLFBYR  DS    CL(L'DBCKBYR)       BUYER CODE                                   
                                                                                
SOLFCLTQ EQU   C'C'                VPARM VALUE FOR CLIENT                       
SOLFCLT$ EQU   6                   MAXIMUM NUMBER OF CLIENT ENTRIES             
SOLFCLT# DS    X                   NUMBER OF CLIENT ENTRIES (0=ALL)             
SOLFCLT  DS    (SOLFCLT$)XL(L'DBCKCLT)                                          
SOLFCLTL EQU   *-SOLFCLT#          LENGTH OF CLIENT FILTERS                     
                                                                                
SOLFMKTQ EQU   C'M'                VPARM VALUE FOR MARKET                       
SOLFMKT$ EQU   6                   MAXIMUM NUMBER OF MARKET ENTRIES             
SOLFMKT# DS    X                   NUMBER OF MARKET ENTRIES (0=ALL)             
SOLFMKT  DS    (SOLFMKT$)XL(L'DBCKMKT)                                          
SOLFMKTL EQU   *-SOLFMKT#          LENGTH OF MARKET FILTERS                     
                                                                                
SOLFL    EQU   *-SOLFD                                                          
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* APPLY SEARCH FILTER TO DARE BATCH KEY                               *         
***********************************************************************         
         USING DBTKEY,IOKEY                                                     
FLTDBSK  CLI   CLTIND,LW_TALLQ     TEST ALL CLIENTS                             
         JNE   FLTSODY                                                          
                                                                                
         CLC   QCLTX,DBTKCLT       ALREADY PASS LIMIT ACCESS?                   
         JE    FLTDBSKY                                                         
         MVC   QMEDX,DBTKAGMD                                                   
         MVC   QCLTX,DBTKCLT                                                    
         ST    RE,FULL2                                                         
         GOTOR (#GETCLT,AGETCLT)   GETCLT CALLS LIMCLT                          
         L     RE,FULL2                                                         
         JE    FLTDBSKY                                                         
         MVI   DBTKCLT+1,X'FF'     BUMP TO NEXT CLT                             
FLTDBSKN LTR   RE,RE               DOES NOT MATCH ANY FILTER                    
         BR    RE                                                               
                                                                                
FLTDBSKY CR    RE,RE               APPLIED TO AT LEAST ONE FILTER               
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* APPLY SUBSCRIPTION FILTERS TO DARE BATCH KEY                        *         
***********************************************************************         
                                                                                
         USING DBTKEY,IOKEY                                                     
FLTDBK   ICM   R1,7,ASOL           POINT TO FILTER ELEMENT IN WMP               
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         AHI   R1,LW_LN2Q                                                       
         USING SOLFD,R1            R1=A(FILTER ENTRY)                           
*                                  FULL+0(2) = MARKET VALUE                     
         XC    FULL,FULL           FULL+2(2) = CLIENT VALUE                     
                                                                                
FLTDBK05 CLC   DDTKAGMD,SOLFMED                                                 
         JNE   FLTDBK75                                                         
                                                                                
***********************************************************************         
* LOOK AT THE MARKETS                                                 *         
***********************************************************************         
                                                                                
         SR    R2,R2               LOOK AT THE MARKETS                          
         ICM   R2,1,SOLFMKT#       TEST ALL MARKET SUBSCRIPTION                 
         JZ    FLTDBK30                                                         
         LA    RF,SOLFMKT          APPLY MARKET FILTERS                         
FLTDBK10 CLC   DDTKMKT,0(RF)                                                    
         JL    FLTDBK15                                                         
         JH    FLTDBK25                                                         
         MVC   FULL(2),DDTKMKT     MARKET IS SAME                               
         J     FLTDBK30                                                         
                                                                                
FLTDBK15 OC    FULL(2),FULL        WE HAVE A PROPOSED VALUE?                    
         JZ    FLTDBK20            NO, WE HAVE ONE NOW                          
         CLC   0(2,RF),FULL                                                     
         JH    FLTDBK25                                                         
FLTDBK20 MVC   FULL(2),0(RF)                                                    
                                                                                
FLTDBK25 AHI   RF,L'SOLFMKT                                                     
         JCT   R2,FLTDBK10                                                      
         J     FLTDBK75                                                         
                                                                                
***********************************************************************         
* LOOK AT THE CLIENTS                                                 *         
***********************************************************************         
                                                                                
FLTDBK30 SR    R2,R2                                                            
         ICM   R2,1,SOLFCLT#       TEST ALL CLIENT SUBSCRIPTION                 
         JNZ   FLTDBK55                                                         
         CLC   QCLTX,DDTKCLT        ALREADY PASS LIMIT ACCESS?                  
         JE    FLTDBKY                                                          
         MVC   QMEDX,DDTKAGMD                                                   
         MVC   QCLTX,DDTKCLT                                                    
         ST    RE,FULL2                                                         
         GOTOR (#GETCLT,AGETCLT)   GETCLT CALLS LIMCLT                          
         L     RE,FULL2                                                         
         JE    FLTDBKY                                                          
         LLH   RF,DDTKCLT                                                       
         AHI   RF,1                SKIP THIS CLIENT                             
         STCM  RF,3,DDTKCLT                                                     
         J     FLTDBKN                                                          
                                                                                
FLTDBK55 LA    RF,SOLFCLT          APPLY CLIENT FILTERS                         
FLTDBK60 CLC   DDTKCLT,0(RF)                                                    
         JE    FLTDBKY                                                          
         JH    FLTDBK72                                                         
                                                                                
FLTDBK65 OC    FULL+2(2),FULL+2    WE HAVE A PROPOSED CLIENT?                   
         JZ    FLTDBK70            NO, WE HAVE ONE NOW                          
         CLC   0(2,RF),FULL+2                                                   
         JH    FLTDBK72                                                         
FLTDBK70 MVC   FULL+2(2),0(RF)                                                  
                                                                                
FLTDBK72 AHI   RF,L'SOLFCLT                                                     
         JCT   R2,FLTDBK60                                                      
                                                                                
FLTDBK75 AHI   R1,SOLFL            BUMP TO NEXT FILTER ENTRY                    
         JCT   R0,FLTDBK05         DO FOR NUMBER OF ENTRIES                     
                                                                                
FLTDBK80 ICM   R2,1,SOLFMKT#       TEST ALL MARKET SUBSCRIPTION                 
         JZ    FLTDBK90                                                         
         CLC   DDTKMKT,FULL        WE HAVE A MATCH ON MARKET?                   
         JE    FLTDBK90            YES, BUT MIGHT NOT ON CLT                    
         OC    FULL(2),FULL        DO WE HAVE A PROPOSED MARKET?                
         JNZ   FLTDBK85                                                         
         LLC   R1,DDTKAGMD                                                      
         LA    R1,1(R1)                                                         
         STC   R1,DDTKAGMD                                                      
FLTDBK85 MVC   DDTKMKT,FULL                                                     
         XC    DDTKCLT(DBTKSTAT-DDTKCLT),DDTKCLT                                
         J     FLTDBKN                                                          
                                                                                
FLTDBK90 CLC   DDTKCLT,FULL+2      WE HAVE A MATCH ON CLIENT?                   
         JE    FLTDBKY             YES                                          
         OC    FULL+2(2),FULL+2                                                 
         JNZ   FLTDBK95                                                         
         XR    R1,R1                                                            
         ICM   R1,3,DDTKMKT                                                     
         LA    R1,1(R1)                                                         
         STCM  R1,3,DDTKMKT                                                     
FLTDBK95 MVC   DDTKCLT,FULL+2                                                   
         XC    DDTKDATE(DBTKSTAT-DDTKDATE),DDTKDATE                             
                                                                                
FLTDBKN  LTR   RE,RE               DOES NOT MATCH ANY FILTER                    
         BR    RE                                                               
                                                                                
FLTDBKY  MVC   ORDAM,DDTKAGMD      SET ORDER VALUES FROM BATCH KEY              
         MVC   ORDCLT,DDTKCLT                                                   
         CR    RE,RE               APPLIED TO AT LEAST ONE FILTER               
         BR    RE                                                               
         DROP  R1                                                               
         EJECT                                                                  
***********************************************************************         
* ROUTINE TO APPLY FILTERS TO DARE BATCH RECORDS                      *         
***********************************************************************         
                                                                                
FLTDBT   LR    R2,R1                                                            
         USING DARBTCHD,R2                                                      
         MVC   ORDAM,DBTKAGMD      SET ORDER VALUES FROM BATCH KEY              
         MVC   ORDMKT,DBTKMKT                                                   
         MVC   ORDCLT,DBTKCLT                                                   
         MVC   ORDPRD,DBTKPRD                                                   
         MVC   ORDPIG,DBTKPRD2                                                  
         MVC   ORDEST,DBTKEST                                                   
         GOTOR (#EDTMED,AEDTMED),DMCB,ORDAM,,BUYMED                             
                                                                                
         XC    WORK(L'DBINFBYR),WORK                                            
         LA    R1,DBTRFRST                                                      
         USING DBINFELD,R1                                                      
         CLI   DBINFEL,DBINFELQ    TEST INFO ELEMENT PRESENT                    
         JNE   FLTDBT02                                                         
         OC    DBINFBYR,DBINFBYR   TEST BUYER ON BATCH RECORD                   
         JZ    FLTDBT02                                                         
         MVC   WORK(L'DBINFBYR),DBINFBYR                                        
                                                                                
FLTDBT02 CLI   BYRIND,0            BUYER FILTER UNSPECIFIED                     
         JE    FLTDBT04                                                         
         CLI   BYRIND,LW_TALLQ     TEST ALL BUYERS                              
         JE    FLTDBT04                                                         
         CLC   LP_QMAPN,SDSODD#    TEST SEARCH DOWNLOAD                         
         BE    EXITN               - DON'T SEND BATCH                           
         OC    WORK(L'DBINFBYR),WORK                                            
         JZ    FLTDBT04                                                         
         ICM   RF,7,ABYR                                                        
         CLC   DBINFBYR,LW_DATA1-LW_D(RF)                                       
         BNE   EXITN                                                            
                                                                                
FLTDBT04 LA    R1,DBTRFRST                                                      
         USING DBFLTELD,R1         R1=A(BATCH RECORD)                           
         SR    RE,RE                                                            
         XC    ADBFEL,ADBFEL                                                    
FLTDBT06 CLI   DBFLTEL,EOR         TEST END OF RECORD                           
         JNE   *+14                                                             
         LTR   RE,RE               TEST ANY FLIGHTS                             
         JZ    FLTDBT08                                                         
         B     EXITN                                                            
                                                                                
         CLI   DBFLTEL,DBFLTELQ    TEST FLIGHT ELEMENT                          
         JNE   *+16                                                             
         AHI   RE,1                BUMP FLIGHT COUNT                            
         TM    DBFLTFL1,DBFLTDAR+DBFLTSNT                                       
         JZ    FLTDBT08                                                         
                                                                                
         LLC   R0,DBFLTLEN         BUMP TO NEXT ELEMENT                         
         AR    R1,R0                                                            
         J     FLTDBT06                                                         
                                                                                
FLTDBT08 CLC   LP_QMAPN,SDSOLD#    TEST SUBSCRIPTION DOWNLOAD                   
         BNE   EXITY                                                            
         OC    WORK(L'DBINFBYR),WORK                                            
         JZ    FLTDBT10                                                         
         GOTOR VRCPACK,DMCB,(C'P',WORK),WORK+L'DBINFBYR                         
         MVC   WORK(L'SOLFBYR),WORK+L'DBINFBYR                                  
                                                                                
FLTDBT10 ICM   R1,7,ASOL           APPLY SUBSCRIPTION FILTERS                   
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         AHI   R1,LW_LN2Q                                                       
         USING SOLFD,R1            R1=A(SUBSCRIPTION FILTERS)                   
                                                                                
FLTDBT12 CLC   SOLFMED,ORDAM       TEST MEDIA                                   
         JNE   FLTDBT16                                                         
                                                                                
         OC    WORK(L'SOLFBYR),WORK                                             
         JZ    *+14                                                             
         CLC   SOLFBYR,WORK        TEST BUYER                                   
         JNE   FLTDBT16                                                         
                                                                                
         SR    RE,RE                                                            
         ICM   RE,1,SOLFCLT#                                                    
         JZ    FLTDBT14                                                         
         LA    RF,SOLFCLT                                                       
         CLC   ORDCLT,0(RF)        TEST CLIENT(S)                               
         JE    FLTDBT14                                                         
         AHI   RF,L'SOLFCLT                                                     
         JCT   RE,*-14                                                          
         J     FLTDBT16                                                         
                                                                                
FLTDBT14 SR    RE,RE                                                            
         ICM   RE,1,SOLFMKT#                                                    
         BZ    EXITY                                                            
         LA    RF,SOLFMKT                                                       
         CLC   ORDMKT,0(RF)        TEST MARKET(S)                               
         BE    EXITY                                                            
         AHI   RF,L'SOLFMKT                                                     
         JCT   RE,*-14                                                          
                                                                                
FLTDBT16 AHI   R1,SOLFL            BUMP TO NEXT FILTER TABLE ENTRY              
         JCT   R0,FLTDBT12         DO FOR NUMBER OF FILTERS                     
         B     EXITN                                                            
         DROP  R1,R2                                                            
         EJECT                                                                  
***********************************************************************         
* * APPLY 'SEARCH ORDER DOWNLOAD' FILTERS TO DARE ORDER KEY           *         
***********************************************************************         
                                                                                
FSD      USING DAREORDD,IOKEY                                                   
FLTSOD   CLI   CLTIND,LW_TALLQ     TEST ALL CLIENTS                             
         JNE   FLTSODY                                                          
*                                                                               
         LA    R2,FSD.DCKCLT                                                    
         CLI   FSD.DCKSUBTY,DCKSTYPQ   CLIENT/STATION PASSIVE?                  
         JE    FLTSOD5                                                          
*                                                                               
         LA    R2,FSD.DCMKCLT                                                   
         CLI   FSD.DCMKSTYP,DCMKSTYQ   CLIENT/MARKET PASSIVE?                   
         JE    FLTSOD5                                                          
*                                                                               
         LA    R2,FSD.DBMKCLT                                                   
         CLI   FSD.DBMKSTYP,DBMKSTYQ   BUYER/MARKET PASSIVE?                    
         JE    FLTSOD5                                                          
*                                                                               
         LA    R2,FSD.DBCKCLT                                                   
         CLI   FSD.DBCKSTYP,DBCKSTYQ   BUYER/CLIENT PASSIVE?                    
         JE    FLTSOD5                                                          
*                                                                               
         CLI   FSD.DSKSUBTY,DSKSTYPQ   BUYER/STATION PASSIVE?                   
         JE    FLTSODY                                                          
         DC    H'0'                                                             
*                                                                               
FLTSOD5  CLC   QCLTX,0(R2)         ALREADY PASS LIMIT ACCESS?                   
         JE    FLTSODY                                                          
         MVC   QMEDX,FSD.DCKAGMD                                                
         MVC   QCLTX,0(R2)                                                      
         ST    RE,FULL2                                                         
         GOTOR (#GETCLT,AGETCLT)   GETCLT CALLS LIMCLT                          
         L     RE,FULL2                                                         
         JE    FLTSODY                                                          
         DROP  FSD                                                              
*                                                                               
         LH    RF,0(R2)            BUMP KEY TO NEXT CLIENT                      
         AHI   RF,1                                                             
         STCM  RF,3,0(R2)                                                       
         MVI   2(R2),X'00'                                                      
FLTSODN  LTR   RE,RE               DOES NOT MATCH ANY FILTER                    
         BR    RE                                                               
                                                                                
FLTSODY  CR    RE,RE               APPLIED TO AT LEAST ONE FILTER               
         BR    RE                                                               
         EJECT                                                                  
***********************************************************************         
* APPLY CHECK FOR CHANGES FILTERS TO ORDER ACTIVITY PASSIVE POINTER   *         
***********************************************************************         
                                                                                
FC4      USING DAREORDD,IOKEY                                                   
FLTC4C   XC    ORDTOKNS(ORDTOKNL),ORDTOKNS                                      
         SR    RE,RE               RE=REQUEST MATCH COUNT                       
         ICM   R1,7,AC4C           POINT TO REQUEST ARRAY IN WMP                
         SR    R0,R0                                                            
         ICM   R0,3,LW_NUMN-LW_D(R1)                                            
         AHI   R1,LW_LN2Q                                                       
         USING C4CQD,R1            R1=A(REQUEST ENTRY)                          
                                                                                
FLTC4C02 CLC   FC4.DODKAGMD(L'C4CQMED),C4CQMED                                  
         JNE   FLTC4C10                                                         
                                                                                
         OC    C4CQBYR,C4CQBYR     APPLY BUYER FILTER                           
         JZ    *+14                                                             
         CLC   C4CQBYR,FC4.DODKBYR                                              
         JNE   FLTC4C10                                                         
                                                                                
         SR    R2,R2                                                            
         ICM   R2,1,C4CQCLT#       TEST ALL CLIENT SUBSCRIPTION                 
         JZ    FLTC4C04                                                         
         LA    RF,C4CQCLT          APPLY CLIENT FILTERS                         
         CLC   FC4.DODKCLT,0(RF)                                                
         JE    FLTC4C04                                                         
         AHI   RF,L'C4CQCLT                                                     
         JCT   R2,*-14                                                          
         J     FLTC4C10                                                         
                                                                                
FLTC4C04 SR    R2,R2                                                            
         ICM   R2,1,C4CQMKT#       TEST ALL MARKET SUBSCRIPTION                 
         JZ    FLTC4C06                                                         
         LA    RF,C4CQMKT          APPLY MARKET FILTERS                         
         CLC   FC4.DODKMKT,0(RF)                                                
         JE    FLTC4C06                                                         
         AHI   RF,L'C4CQMKT                                                     
         JCT   R2,*-14                                                          
         J     FLTC4C10                                                         
                                                                                
FLTC4C06 CLI   C4CQESTN,0          APPLY ESTIMATE FILTER                        
         JE    *+14                                                             
         CLC   C4CQESTN,FC4.DODKEST                                             
         JNE   FLTC4C10                                                         
                                                                                
         CLI   C4CQPRDN,0          APPLY PRODUCT FILTER                         
         JE    FLTC4C08                                                         
         CLI   C4CQPRDN,POLPRDQ                                                 
         JE    FLTC4C08                                                         
         CLC   C4CQPRDN,FC4.DODKPRD                                             
         JNE   FLTC4C10                                                         
                                                                                
FLTC4C08 AHI   RE,1                BUMP MATCH COUNT                             
         CHI   RE,1                                                             
         JH    *+14                                                             
         MVC   ORDTOKN1,C4CQTOKN   SET TOKEN 1                                  
         J     FLTC4C10                                                         
         MVC   ORDTOKN2,C4CQTOKN   SET TOKEN 2                                  
         J     FLTC4C12                                                         
                                                                                
FLTC4C10 AHI   R1,C4CQL            BUMP TO NEXT FILTER ENTRY                    
         JCT   R0,FLTC4C02         DO FOR NUMBER OF ENTRIES                     
         LTR   RE,RE               TEST MATCHES ANY REQUEST                     
         BZ    EXITN               NO - NOT APPLICABLE                          
                                                                                
C4       USING C4CRECD,TSARREC                                                  
FLTC4C12 MVC   C4.C4CRAGM,FC4.DODKAGMD AGENCY/MEDIA                             
         MVC   C4.C4CRORD,FC4.DODKORDR ORDER NUMBER                             
         MVC   C4.C4CRGRP,FC4.DODKGPCD MAKEGOOD GROUP CODE                      
         MVC   TSARSAV,C4.C4CRECD                                               
         GOTOR BUFFER,DMCB,('TSARDH',0)                                         
         JE    EXITN                   PREVIOUSLY SENT                          
         MVC   C4.C4CRECD(C4CRRECL),TSARSAV                                     
         GOTOR BUFFER,DMCB,('TSAADD',0)                                         
         JNE   *+2                                                              
         MVC   ORDAM,FC4.DODKAGMD      EXTRACT VALUES FROM KEY                  
         MVC   ORDATIME,FC4.DODKTIME                                            
         XC    ORDATIME,EFFS                                                    
         MVC   ORDORDER,FC4.DODKORDR                                            
         MVC   ORDGROUP,FC4.DODKGPCD   (MISSING INSTRUCTION)                    
         J     EXITY                                                            
         DROP  R1,C4,FC4                                                        
                                                                                
C4CQD    DSECT                     ** CHECK FOR CHANGES REQUEST **              
C4CQMED  DS    XL(L'DODKAGMD)      AGENCY/MEDIA CODE                            
C4CQBYR  DS    CL(L'DODKBYR)       BUYER CODE                                   
                                                                                
C4CQCLTQ EQU   SOLFCLTQ            VPARM VALUE FOR CLIENT                       
C4CQCLT$ EQU   SOLFCLT$            MAXIMUM NUMBER OF CLIENT ENTRIES             
C4CQCLT# DS    X                   NUMBER OF CLIENT ENTRIES (0=ALL)             
C4CQCLT  DS    (C4CQCLT$)XL(L'DODKCLT)                                          
C4CQCLTL EQU   *-C4CQCLT#          LENGTH OF CLIENT FILTERS                     
                                                                                
C4CQMKTQ EQU   SOLFMKTQ            VPARM VALUE FOR MARKET                       
C4CQMKT$ EQU   SOLFCLT$            MAXIMUM NUMBER OF MARKET ENTRIES             
C4CQMKT# DS    X                   NUMBER OF MARKET ENTRIES (0=ALL)             
C4CQMKT  DS    (C4CQMKT$)XL(L'DODKMKT)                                          
C4CQMKTL EQU   *-C4CQMKT#          LENGTH OF MARKET FILTERS                     
                                                                                
C4CQESTN DS    XL(L'DODKEST)       ESTIMATE NUMBER                              
C4CQPRDN DS    XL(L'DODKPRD)       PRODUCT NUMBER                               
                                                                                
C4CQTOKN DS    CL4                 REQUEST TOKEN                                
C4CQL    EQU   *-C4CQD                                                          
                                                                                
C4CRECD  DSECT                     ** CHECK FOR CHANGES BUFFER **               
C4CRAGM  DS    XL(L'DODKAGMD)      AGENCY/MEDIA                                 
C4CRORD  DS    XL(L'DODKORDR)      ORDER NUMBER                                 
C4CRGRP  DS    XL(L'DODKGPCD)      MAKEGOOD GROUP CODE                          
C4CRKEYL EQU   *-C4CRECD                                                        
C4CRRECL EQU   *-C4CRECD                                                        
                                                                                
SVRDEF   CSECT                                                                  
         EJECT                                                                  
***********************************************************************         
* EXTRACT VALUES FROM ORDER RECORD AND OPTIONALLY APPLY FILTERS       *         
***********************************************************************         
                                                                                
GETORD   NTR1  LABEL=NO                                                         
         MVC   SVORDKEY,IOKEY      SAVE CURRENT KEY                             
         MVC   SVIOADDR,IOADDR     AND I/O ADDRESS                              
         LR    R4,R1                                                            
         USING DAREORDD,R4         R4=A(ORDER RECORD)                           
         LA    R2,DORFRST                                                       
         SR    R0,R0                                                            
                                                                                
         SR    R3,R3                                                            
         USING MGCOLELD,R2         R2=A(FIRST ELEMENT ON ORDER RECORD)          
GETORD10 CLI   MGCOLEL,DOIDELQ     TEST PRIMARY ID ELEMENT                      
         JE    GETORD15                                                         
         CLI   MGCOLEL,DOSPELQ     TEST SUPPL ELEMENT                           
         JE    GETORD25                                                         
         CLI   MGCOLEL,MGCOLELQ    TEST COLOR ELEMENT                           
         JE    GETORD30                                                         
         CLI   MGCOLEL,EOR         TEST END OF RECORD                           
         JNE   GETORD20                                                         
         TM    MAPI1,MAPILORD+MAPIORDD                                          
         JNZ   GETORD30                                                         
         J     GETORDN             NO - EXIT WITH CC NOT EQUAL                  
                                                                                
GETORD15 LA    R3,MGCOLEL          YES - POINT TO IT                            
GETORD20 LLC   R0,MGCOLLEN         ELSE CONTINUE SEARCH                         
         AR    R2,R0                                                            
         J     GETORD10                                                         
                                                                                
         USING DOSPELD,R2                                                       
GETORD25 TM    DOSPDKYF,DOSPFCCD+DOSPFNSN  CONCEDED OR NEVER SENT?              
         JZ    GETORD20                                                         
         J     GETORDN                     YES, EXIT WITH CC NOT EQUAL          
                                                                                
         USING DOIDELD,R3                                                       
GETORD30 LTR   R3,R3               ENSURE WE HAVE PRIMARY ID ELEMENT            
         JZ    *+2                                                              
                                                                                
         CLC   DOKAGMD,LORDVAGM    TEST CHANGE OF AGENCY/MEDIA                  
         JE    GETORD40                                                         
         XC    LORDVALS(LORDVALL),LORDVALS                                      
         MVC   LORDVAGM,DOKAGMD    AND SAVE CURRENT AGENCY/MEDIA                
         GOTOR (#EDTMED,AEDTMED),DMCB,LORDVAGM,,QMEDA                           
         MVC   BUYMED,QMEDA        SET BUYMED FOR GETSTA ROUTINE                
                                                                                
GETORD40 TM    MAPI2,MAPIFSTA      TEST APPLY STATION FILTER                    
         JZ    GETORD50                                                         
         ICM   RF,7,ASTA           TEST STATION RESOLVED                        
         JZ    GETORD50                                                         
         CLI   LW_TYPE-LW_D(RF),LW_TSINQ                                        
         JNE   GETORD50                                                         
         CLC   DOISTA,LW_DATA1-LW_D(RF)                                         
         JNE   GETORDN                                                          
                                                                                
GETORD50 MVC   ORDAM,DOKAGMD       SAVE AGENCY/MEDIA CODE                       
         MVC   ORDCLT,DOIDCLT      SAVE CLIENT                                  
         MVC   ORDORDER,DOKORDER   SAVE ORDER NUMBER                            
         MVC   ORDBSTA,DOKSTA      SAVE BINARY STATION CODE                     
         MVC   ORDBUYER,DOIDBYR    SAVE BUYER ID                                
         MVC   ORDPRD,DOIDPRD      SAVE PRODUCT                                 
         MVC   ORDPIG,DOIDPRD2     SAVE PIGGYBACK PRODUCT                       
         MVC   ORDEST,DOIDEST      SAVE ESTIMATE NUMBER                         
**                                                                              
* CHECK IF FLIGHT RECORD EXISTS, THEN SEND FLIGHT                               
**                                                                              
         XC    ORDFLT,ORDFLT       CLEAR IT JUST IN CASE OF JUNK                
         LA    RE,IOKEY                                                         
         USING DFLRECD,RE                                                       
         XC    DFLKEY,DFLKEY                                                    
         MVI   DFLKTYP,DFLKTYPQ                                                 
         MVI   DFLKSUB,DFLKSUBQ                                                 
         MVC   DFLKAGMD,ORDAM                                                   
         MVC   DFLKCLT,ORDCLT                                                   
         MVC   DFLKPRD,POLPRD                                                   
         MVC   DFLKEST,ORDEST                                                   
         DROP  RE                                                               
                                                                                
         GOTOR (#IOEXEC,AIOEXEC),'IORD+IODIR+IO2'                               
         JNE   GETORD55                                                         
         GOTOR (#IOEXEC,AIOEXEC),'IOGET+IOFIL+IO2'                              
         JNE   *+2                                                              
         L     RE,AIO2                                                          
         CLI   24(RE),0            IS RECORD EMPTY?                             
         JE    GETORD55                                                         
*                                                                               
*  IF FLT REC FOUND, DISPLAY THE FLT.                                           
*                                                                               
         EDIT  (B1,DOIDFLTN),(2,ORDFLT),ZERO=NOBLANK,,ALIGN=LEFT                
*                                                                               
GETORD55 XC    ORDSPFFS,ORDSPFFS   CLEAR THIS IN CASE OF JUNK                   
         CLC   DOIDFFS,EFFS        NEW SALESPERSON KEY?                         
         JNE   GETORD60                                                         
         MVC   ORDSPFFS,DOIDFFS    SAVE SALESPERSON/POINTPERSON                 
         MVC   ORDSPPWR,DOIDREPA                                                
         MVC   ORDSPSCD,DOIDSALC                                                
                                                                                
GETORD60 TM    MAPI1,MAPILORD      TEST LOCKED ORDER DOWNLOAD                   
         JZ    GETORDY                                                          
                                                                                
         LA    R2,DORFRST                                                       
         USING DOSTELD,R2          LOCATE TRANSMISSION ELEMENT                  
GETORD70 CLI   DOSTEL,EOR          TEST END OF RECORD                           
         JE    GETORDN                                                          
         CLI   DOSTEL,DOSTELQ      TEST TRANSMISSION ELEMENT                    
         JE    GETORD80                                                         
         LLC   R0,DOSTLEN                                                       
         AR    R2,R0                                                            
         J     GETORD70                                                         
                                                                                
GETORD80 LAY   R1,ORDLOCKS         LOOK UP STATUS IN UNLOCK TABLE               
         LHI   R0,ORDLOCKN                                                      
         BASR  RE,0                                                             
         CLC   DOSTSTAT,0(R1)      REJECT IF STATUS FOUND                       
         JE    GETORDN                                                          
         AHI   R1,L'ORDLOCKS                                                    
         BCTR  R0,RE                                                            
                                                                                
GETORDY  L     R1,ACLTREC          TEST WE HAVE CLIENT RECORD AROUND            
         CLC   ORDCLT,CKEYCLT-CLTRECD(R1)                                       
         JE    GETORDY2                                                         
         MVC   QMEDX,ORDAM         NO - GO GET IT                               
         MVC   QCLTX,ORDCLT                                                     
         GOTOR (#GETCLT,AGETCLT)                                                
         JNE   GETORDN                                                          
GETORDY2 LHI   RE,1                KEEP THIS ORDER RECORD                       
         J     GETORDX                                                          
                                                                                
GETORDN  SR    RE,RE               REJECT THIS ORDER RECORD                     
                                                                                
GETORDX  MVC   IOKEY,SVORDKEY      RESTORE SAVED I/O VALUES                     
         MVC   IOADDR,SVIOADDR                                                  
         B     EXITSET             SET CONDITION CODE ON EXIT                   
         DROP  R2,R3,R4                                                         
         EJECT                                                                  
***********************************************************************         
* FIX MAKEGOOD NOTICE STATUS HISTORY                                            
*  ON ENTRY :   IOADDR HAS ADDRESS OF IO CONTAINING NOTICE RECORD               
***********************************************************************         
FIXMGN   NTR1  LABEL=*                                                          
         L     R4,ANOTREC                                                       
         CLC   =X'0D36',0(R4)      MUST BE A DARE MAKEGOOD NOTICE REC           
         JNE   *+2                 DIE OTHERWISE                                
*                                                                               
         USING MNKEY,R4                                                         
         LA    R2,MNRFRST-MNKEY(R4)                                             
         OC    MNXKSPAR,MNXKSPAR   CABLE DARE MAKEGOOD?                         
         JNZ   FXMG10              NO                                           
         OC    MNXKSTTN,MNXKSTTN   ANY STATION?                                 
         JNZ   EXITY               YES, NO STATUS TO FIX                        
         LA    R2,MNXFRST-MNXKEY(R4)                                            
*                                                                               
         USING MNSTELD,R2                                                       
FXMG10   CLI   MNSTSTAT,MNSTDELV   WE DON'T CARE ABOUT DELIVERED STATUS         
         JNE   EXITY                                                            
         LR    RE,R2               IF SO, MAKE REAL STATUS APPEAR FIRST         
         LLC   R1,1(R2)                                                         
         AR    R2,R1                                                            
*                                                                               
         CLI   MNSTSTAT,MNSTGOIN                                                
         JE    FXMG20                                                           
         CLI   MNSTSTAT,MNSTHOLD                                                
         JE    FXMG20                                                           
         CLI   MNSTSTAT,MNSTSAPP                                                
         JNE   EXITY                                                            
*                                                                               
FXMG20   MVC   ELEM(MNSTLENQ),0(RE)          SWITCH THE ORDER                   
         MVC   0(MNSTLENQ,RE),0(R2)                                             
         MVC   0(MNSTLENQ,R2),ELEM                                              
         J     EXITY                                                            
         DROP  R2,R4                                                            
         EJECT                                                                  
GLOBALS  DS    0D                  ** GLOBAL LITERALS **                        
         LTORG                                                                  
                                                                                
SETCCC   BE    *+8                 SET CONVERSE CONDITION CODE                  
         CR    RE,RE               CC=EQUAL IF INDICATOR ON                     
         BR    RE                                                               
         LTR   RE,RE               CC=NOT EQUAL IF INDICATOR OFF                
         BR    RE                                                               
                                                                                
MORE     MVI   LP_RMODE,LP_RMORE   TELL DDLINK TO CALL ME AGAIN                 
         B     EXITY                                                            
                                                                                
NOMORE   MVI   LP_RMODE,LP_RLAST   SET NO MORE RECORDS & EXIT                   
         B     EXITY                                                            
                                                                                
XCOLEN   XC    LP_OLEN,LP_OLEN     CLEAR OUTPUT FIELD LENGTH & EXIT             
         B     EXITY                                                            
                                                                                
RTRNYES  CR    RE,RE               RETURN WITH CC=EQUAL                         
         BR    RE                                                               
                                                                                
RTRNNO   LTR   RE,RE               RETURN WITH CC=NOT EQUAL                     
         BR    RE                                                               
                                                                                
EXITN    LHI   RE,0                                                             
         B     EXITSET                                                          
EXITY    LHI   RE,1                                                             
EXITSET  CHI   RE,1                                                             
EXIT     XIT1  ,                                                                
                                                                                
WORKLEN  DC    AL2(((WORKL+7)/8)*8)                                             
                                                                                
SPTPTMAP DC    AL2(86)             SPOT RECORD MAP NUMBER                       
                                                                                
SDOCOM#  DC    AL2(I#SDOCOD)       OCOM DOWNLOAD                                
SDSCOM#  DC    AL2(I#SDSCOD)       STATION COME DOWNLOAD                        
SDMCOM#  DC    AL2(I#SDMCOD)       MARKET COME DOWNLOAD                         
                                                                                
MAPTAB   DS    0XL4                ** MAP/INDICATORS TABLE **                   
                                                                                
SDORDD#  DC    AL2(I#SDORDD)       ORDER DOWNLOAD                               
         DC    AL1(MAPILORD)                                                    
         DC    AL1(0)                                                           
                                                                                
SDORDL#  DC    AL2(I#SDORDL)       LOCKED ORDER DOWNLOAD                        
         DC    AL1(MAPILORD)                                                    
         DC    AL1(0)                                                           
                                                                                
SDMGED#  DC    AL2(I#SDMGED)       MAKEGOOD PENDING APPLY DOWNLOAD              
         DC    AL1(MAPIMGDD)                                                    
*        DC    AL1(MAPIAMCE)                                                    
         DC    AL1(MAPIAMCE+MAPIMISS+MAPIOFFD+MAPIOBUY+MAPIMNHD)                
                                                                                
SDSODD#  DC    AL2(I#SDSODD)       SEARCH ORDER DOWNLOAD                        
         DC    AL1(MAPIORDD)                                                    
         DC    AL1(MAPIAMCE+MAPIFSTA)                                           
                                                                                
SDSOLD#  DC    AL2(I#SDSOLD)       SUBSCRIBED ORDER DOWNLOAD                    
         DC    AL1(MAPIORDD)                                                    
         DC    AL1(0)                                                           
                                                                                
SDOMMD#  DC    AL2(I#SDOMMD)       MULTIPLE ORDER DOWNLOAD                      
         DC    AL1(MAPIORDD+MAPINOTD+MAPIR4RD)                                  
         DC    AL1(MAPIAMCE+MAPIMISS+MAPIOFFD+MAPIOBUY+MAPIMNHD)                
                                                                                
SDOMSD#  DC    AL2(I#SDOMSD)       SINGLE ORDER DOWNLOAD                        
         DC    AL1(MAPIORDD)                                                    
         DC    AL1(0)                                                           
                                                                                
SDOOAR#  DC    AL2(I#SDOOAR)       ORDER ACTIVITY RESPONSE                      
         DC    AL1(MAPIORDD+MAPIOBCR)                                           
         DC    AL1(MAPIORDR)                                                    
                                                                                
SDOAPR#  DC    AL2(I#SDOAPR)       OFFER APPROVE RESPONSE                       
         DC    AL1(MAPIORDD+MAPINOTD)                                           
         DC    AL1(MAPIOFFD+MAPIOBUY+MAPIMNHD+MAPIORDR+MAPIMISS)                
                                                                                
SDOREJ#  DC    AL2(I#SDOREJ)       OFFER REJECT RESPONSE                        
         DC    AL1(MAPIORDD+MAPINOTD)                                           
         DC    AL1(MAPIOFFD+MAPIMNHD+MAPIORDR+MAPIMISS)                         
                                                                                
SDOSAP#  DC    AL2(I#SDOSAP)       OFFER SELF-APPLY RESPONSE 13988              
         DC    AL1(MAPIORDD+MAPINOTD)                                           
         DC    AL1(MAPIOFFD+MAPIOBUY+MAPIMNHD+MAPIORDR+MAPIMISS)                
                                                                                
SDOAPY#  DC    AL2(I#SDOAPY)       OFFER APPLY RESPONSE                         
         DC    AL1(MAPIORDD+MAPINOTD)                                           
         DC    AL1(MAPIOFFD+MAPIOBUY+MAPIMNHD+MAPIORDR+MAPIMISS)                
                                                                                
SDOOFC#  DC    AL2(I#SDOOFC)       OFFER CHANGE RESPONSE                        
         DC    AL1(MAPIORDD+MAPINOTD)                                           
         DC    AL1(MAPIOFFD+MAPIOBUY+MAPIMNHD+MAPIMISS)                         
                                                                                
SDOUMD#  DC    AL2(I#SDOUMD)       UPLOAD MAKEGOOD DEMOS                        
         DC    AL1(0)                                                           
         DC    AL1(MAPIUDEM)                                                    
                                                                                
SDBOX#   DC    AL2(I#SDBOXD)       BATCH ORDER EXPORT                           
         DC    AL1(0)                                                           
         DC    AL1(MAPIAMCE)                                                    
                                                                                
MAPTABN  EQU   (*-MAPTAB)/L'MAPTAB                                              
                                                                                
MODLUSA  DC    C'R',C'I',AL1(0)                                                 
MODLCAN  DC    C'E',C'R',C'I',AL1(0)                                            
                                                                                
MGDTRTAB DC    C'ABCDEFGHJK'       MAKEGOOD CODE TRANSLATION                    
BITLIST  DC    X'8040201008040201'                                              
PZERO    DC    P'0'                                                             
BZEROS   DC    X'0000'                                                          
EZEROS   DC    C'00000000'                                                      
HZEROS   DC    X'000000000000'                                                  
DEFAGY   EQU   EZEROS              DEFAULT AGENCY CODE FOR DAYPARTS             
UNKNOWN  DC    C'*Unknown'                                                      
HEX80    DC    X'80'                                                            
HEXC0    DC    X'C0'                                                            
                                                                                
DMKEY    DC    C'DMKEY   '                                                      
STAFIL   DC    C'STATION'                                                       
SPTDIR   DC    C'SPTDIR '                                                       
SPTFIL   DC    C'SPTFILE'                                                       
XSPDIR   DC    C'XSPDIR '                                                       
XSPFIL   DC    C'XSPFILE'                                                       
GENDIR   DC    C'GENDIR '                                                       
GENFIL   DC    C'GENFIL '                                                       
TRFDIR   DC    C'TRFDIR '                                                       
                                                                                
PROFKSDO DS    0CL4                ** ORDER PROFILE KEYS **                     
         DC    C'sDAR'                                                          
         DC    C'S0OM'                                                          
         DC    C'S0DX'                                                          
         DC    C'S0D2'                                                          
PROFNSDO EQU   (*-PROFKSDO)/L'PROFKSDO                                          
                                                                                
PROFS01W DC    C'S01W'                                                          
PROFS0FX DC    C'S0FX'                                                          
                                                                                
SCANCHAR DC    C',=/',AL1(FF)      DELIMITERS FOR SUBSCRIPTION FILTERS          
         EJECT                                                                  
ESTFLT   LKKEY H,ORDEST,SAVED      ** ESTIMATE FILTER **                        
         LKKEY WMP,ORDEST,AEST                                                  
         LKKEY E                                                                
                                                                                
COMKEYT  LKKEY H,COMKEY            ** STANDARD COMMENT DRIVER **                
         LKKEY LIT,COMKTYP,COMKTYPQ                                             
         LKKEY LIT,COMKSUB,COMKSUBQ                                             
         LKKEY SIN,COMKAM,RQMEDIA                                               
         LKKEY WMP,COMKCOM,ACOM                                                 
         LKKEY LIT,COMKSPR,0                                                    
         LKKEY E                                                                
                                                                                
OCSKEYT  LKKEY H,OCOMKEY           ** STATION COMMENT DRIVER **                 
         LKKEY SIN,OCOMKTYPE,COMTYPEQ                                           
         LKKEY WMP,OCOMKAGY,AMED                                                
         LKKEY LIT,OCOMCTYPE,C'T'                                               
         LKKEY WMP,OCOMKCLT,ACLT                                                
         LKKEY WMP,OCOMKPRD,APRD                                                
         LKKEY WMP,OCOMKEST,AEST                                                
         LKKEY WMP,OCOMKSTA,ASTATN                                              
         LKKEY E                                                                
                                                                                
OCMKEYT  LKKEY H,OCOMKEY           ** MARKET COMMENT DRIVER **                  
         LKKEY SIN,OCOMKTYPE,COMTYPEQ                                           
         LKKEY WMP,OCOMKAGY,AMED                                                
         LKKEY LIT,OCOMCTYPE,C'M'                                               
         LKKEY WMP,OCOMKCLT,ACLT                                                
         LKKEY WMP,OCOMKPRD,APRD                                                
         LKKEY WMP,OCOMKEST,AEST                                                
         LKKEY LIT,OCOMKSPR,0                                                   
         LKKEY WMP,OCOMKMKT,AMKT                                                
         LKKEY E                                                                
                                                                                
BYRKEYT  LKKEY H,BYRKEY            ** BUYER DRIVER **                           
         LKKEY LIT,BYRKTYP,BYRKTYPQ                                             
         LKKEY LIT,BYRKSUB,BYRKSUBQ                                             
         LKKEY SIN,BYRKAM,RQMEDIA                                               
         LKKEY WMP,BYRKBYR,ABYR                                                 
         LKKEY LIT,BYRKSPR,0                                                    
         LKKEY E                                                                
                                                                                
SALKEYT  LKKEY H,GSPLPKEY          ** RADIO PASSIVE SPERSON DRIVER **           
         LKKEY LIT,GSPLPMAJ,0                                                   
         LKKEY LIT,GSPLPMIN,0                                                   
         LKKEY LIT,GSPLPTYP,GSPLPTYQ                                            
         LKKEY SIN,GSPLPSTP,PERTYPE                                             
         LKKEY SIN,GSPLKSRP,REPAGY                                              
         LKKEY SIN,GSPKPOFF,REPOFF                                              
         LKKEY ALL,GSPKPCOD                                                     
         LKKEY LIT,GSPLKSPR,0                                                   
         LKKEY E                                                                
                                                                                
DSTKEYT  LKKEY H,DSTAKEY           ** DARE STATION DRIVER TABLE **              
         LKKEY LIT,DSTAKSYS,DSTAKSYSQ                                           
         LKKEY LIT,DSTAKTYP,DSTAKTYPQ                                           
         LKKEY LIT,DSTAKSPR1,0                                                  
         LKKEY SIN,DSTAKMEDA,R4RMEDIA                                           
         LKKEY SIN,DSTAKSTIN,STACALL2                                           
         LKKEY ALL,DSTAKEFDA                                                    
         LKKEY LIT,DSTAKSPR2,0                                                  
         LKKEY E                                                                
                                                                                
UIDKEYT  LKKEY H,CTIKEY            ** REP USERID DRIVER TABLE **                
         LKKEY LIT,CTIKTYP,CTIKTYPQ                                             
         LKKEY LIT,CTIKSPAR,0                                                   
         LKKEY RNG,CTIKID,UIDRNGE                                               
         LKKEY E                                                                
                                                                                
FAXKEYT  LKKEY H,CTFXKEY           ** FAX DRIVER TABLE **                       
         LKKEY LIT,CTFXKTYP,CTFXEQU                                             
         LKKEY LIT,CTFXSPR1,0                                                   
         LKKEY SIN,CTFXAGY,DARADM                                               
         LKKEY LIT,CTFXSPR2,0                                                   
         LKKEY RNG,CTFXCODE,FAXRNGE                                             
         LKKEY LIT,CTFXSUBC+L'CTFXSPR3,0                                        
         LKKEY E                                                                
                                                                                
DSRKEYT  LKKEY H,DSRKEY            ** DESTN RECORD DRIVER **                    
         LKKEY LIT,DSRKTYPE,DSRKTYPQ                                            
         LKKEY LIT,DSRKSBTY,DSRKSBTQ                                            
         LKKEY WMP,DSRKAGMD,AMED                                                
         LKKEY SIN,DSRKSTA,STAPCODE                                             
         LKKEY ALL,DSRKCLT                                                      
         LKKEY LIT,DSRKREST,0                                                   
         LKKEY E                                                                
                                                                                
ESPKEYT  LKKEY H,EPKEY             ** ESTIMATE POINTER DRIVER **                
         LKKEY LIT,EPKEYTYP,EPKEYTYQ                                            
         LKKEY LIT,EPKEYSUB,EPKEYSBQ                                            
         LKKEY WMP,EPKEYAM,AMED                                                 
         LKKEY WMP,EPKEYCLT,ACLT                                                
         LKKEY RNG,EPKEYSDT,STRDATER                                            
         LKKEY RNG,EPKEYEDT,ENDDATER                                            
         LKKEY NZR,EPKEYEST                                                     
         LKKEY SIN,EPKEYPRD,POLPRD                                              
         LKKEY E                                                                
                                                                                
FLTKEYT  LKKEY H,DFLKEY            ** FLIGHT DRIVER TABLE **                    
         LKKEY LIT,DFLKTYP,DFLKTYPQ                                             
         LKKEY LIT,DFLKSUB,DFLKSUBQ                                             
         LKKEY WMP,DFLKAGMD,AMED                                                
         LKKEY WMP,DFLKCLT,ACLT                                                 
         LKKEY SIN,DFLKPRD,POLPRD                                               
         LKKEY WMP,DFLKEST,AEST                                                 
         LKKEY LIT,DFLKREST,0                                                   
         LKKEY E                                                                
                                                                                
DCKKEYT  LKKEY H,DOKEY             ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DCKTYPE,DCKTYPQ                                              
         LKKEY LIT,DCKSUBTY,DCKSTYPQ                                            
         LKKEY WMP,DCKAGMD,AMED                                                 
         LKKEY WMP,DCKCLT,ACLT                                                  
         LKKEY WMP,DCKPRD,APRD1                                                 
         LKKEY WMP,DCKEST,AEST                                                  
         LKKEY WMP,DCKSTA,ASTA                                                  
         LKKEY WMP,DCKPRD2,APIG                                                 
         LKKEY ALL,DCKFLTNM,,L'DCKFLTNM+L'DCKFLAG                               
         LKKEY E                                                                
*                                                                               
DCKKEY2T LKKEY H,DOKEY             ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DCKTYPE,DCKTYPQ                                              
         LKKEY LIT,DCKSUBTY,DCKSTYPQ                                            
         LKKEY WMP,DCKAGMD,AMED                                                 
         LKKEY WMP,DCKCLT,ACLT                                                  
         LKKEY WMP,DCKPRD,APRD1                                                 
         LKKEY WMP,DCKEST,AEST                                                  
         LKKEY WMP,DCKSTA,ASTA                                                  
         LKKEY WMP,DCKPRD2,APIG                                                 
         LKKEY WMP,DCKFLTNM,AFLT                                                
         LKKEY ALL,DCKFLAG,L'DCKFLAG                                            
         LKKEY E                                                                
                                                                                
DCMKEYT  LKKEY H,DOKEY             ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DCMKTYPE,DCKTYPQ                                             
         LKKEY LIT,DCMKSTYP,DCMKSTYQ                                            
         LKKEY WMP,DCMKAGMD,AMED                                                
         LKKEY WMP,DCMKCLT,ACLT                                                 
         LKKEY WMP,DCMKPRD,APRD1                                                
         LKKEY WMP,DCMKEST,AEST                                                 
         LKKEY WMP,DCMKMKT,AMKT                                                 
         LKKEY ALL,DCMKORDR                                                     
         LKKEY E                                                                
                                                                                
DBCKEYT  LKKEY H,DOKEY             ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DBCKTYPE,DBCKTYPQ                                            
         LKKEY LIT,DBCKSTYP,DBCKSTYQ                                            
         LKKEY WMP,DBCKAGMD,AMED,L'DBCKAGMD+L'DBCKBYR                           
         LKKEY WMP,DBCKCLT,ACLT                                                 
         LKKEY WMP,DBCKMKT,AMKT                                                 
         LKKEY ALL,DBCKORDR                                                     
         LKKEY E                                                                
                                                                                
DBMKEYT  LKKEY H,DOKEY             ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DBMKTYPE,DBMKTYPQ                                            
         LKKEY LIT,DBMKSTYP,DBMKSTYQ                                            
         LKKEY WMP,DBMKAGMD,AMED,L'DBMKAGMD+L'DBMKBYR                           
         LKKEY WMP,DBMKMKT,AMKT                                                 
         LKKEY WMP,DBMKCLT,ACLT                                                 
         LKKEY ALL,DBMKORDR                                                     
         LKKEY E                                                                
                                                                                
DSKKEYT  LKKEY H,DOKEY             ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DSKTYPE,DSKTYPQ                                              
         LKKEY LIT,DSKSUBTY,DSKSTYPQ                                            
         LKKEY WMP,DSKAGMD,AMED,L'DSKAGMD+L'DSKBYR                              
         LKKEY WMP,DSKSTA,ASTA                                                  
         LKKEY ALL,DSKORD                                                       
         LKKEY E                                                                
                                                                                
DODKEYT  LKKEY H,DODKEY            ** DARE ORDER DRIVER TABLE **                
         LKKEY LIT,DODKTYPE,DODKTYPQ                                            
         LKKEY LIT,DODKSTYP,DODKSTYQ                                            
         LKKEY LIT,DODKSTYP+L'DODKSTYP,0,DODKAGMD-(DODKSTYP+L'DODKSTYP)         
         LKKEY WMP,DODKAGMD,AMED                                                
         LKKEY SIN,DODKDATE,TODAYCMP                                            
         LKKEY WMP,DODKTIME,ATIM                                                
         LKKEY ALL,DODKCLT,,DODKGPCD+L'DODKGPCD-DODKCLT                         
         LKKEY E                                                                
                                                                                
DBTKEYT  LKKEY H,DBTKEY            ** DARE BATCH DRIVER TABLE **                
         LKKEY LIT,DBTKTYP,DBTKTYPQ                                             
         LKKEY LIT,DBTKSTYP,DBTKSTYQ                                            
         LKKEY WMP,DBTKAGMD,AMED                                                
         LKKEY WMP,DBTKMKT,AMKT                                                 
         LKKEY WMP,DBTKSTA,ASTA                                                 
         LKKEY WMP,DBTKCLT,ACLT                                                 
         LKKEY WMP,DBTKPRD,APRD1                                                
         LKKEY WMP,DBTKEST,AEST                                                 
         LKKEY WMP,DBTKPRD2,APIG                                                
         LKKEY E                                                                
                                                                                
DDTKEYT  LKKEY H,DBTKEY            ** DARE BATCH DRIVER TABLE **                
         LKKEY LIT,DDTKTYP,DDTKTYPQ                                             
         LKKEY LIT,DDTKSTYP,DDTKSTYQ                                            
         LKKEY WMP,DDTKAGMD,AMED                                                
         LKKEY WMP,DDTKMKT,AMKT                                                 
         LKKEY WMP,DDTKCLT,ACLT                                                 
         LKKEY RNG,DDTKDATE,BTCHDRNG                                            
         LKKEY ALL,DDTKTMTU                                                     
         LKKEY E                                                                
                                                                                
OHSKEYT  LKKEY H,OHISKEY           ** ORDER HISTORY DRIVER TABLE **             
         LKKEY LIT,OHISTYP,OHISTYQ                                              
         LKKEY LIT,OHISSTYP,OHISSTYQ                                            
         LKKEY LIT,OHISSPR1,0                                                   
         LKKEY SIN,OHISORD,BOXORD#                                              
         LKKEY WMP,OHISBKAM,AMED                                                
         LKKEY ALL,OHISBKCL,,L'OHISBUYK-L'OHISBKAM                              
         LKKEY E                                                                
         EJECT                                                                  
FLMBUF   BUFFD TYPE=D,KEYLEN=0,COMLEN=0,BUFFERS=10                              
                                                                                
LVALUES  DS    0F                  ** LITERALS MOVED TO SAVED **                
         DC    A(FLTESP)                                                        
         DC    A(FLTSOL)                                                        
         DC    A(FLTC4C)                                                        
         DC    A(FLTDBK)                                                        
         DC    A(FLTDBSK)                                                       
         DC    A(FLTDBT)                                                        
         DC    A(GETORD)                                                        
         DC    A(SETORD)                                                        
         DC    A(FLTSOD)                                                        
                                                                                
         DC    AL1(4,6,0,50)       ASSOCIATED WITH LABEL V460050                
         DC    AL1(4,6,0,156)      ASSOCIATED WITH LABEL V4600156               
         DC    AL1(4,7,0,37)       ASSOCIATED WITH LABEL V470037                
                                                                                
         DC    C'D7'                                                            
         DC    C'POL'                                                           
         DC    C'ALL'                                                           
         DC    X'0000FF'                                                        
         DC    X'0D0C'                                                          
         EJECT                                                                  
         DS    0H                                                               
***********************************************************************         
* NOTE: DSTA RECORD NEEDS A X'31' ELEMENT FOR THE RECEIVING ID SO     *         
* THAT THE DARE DISPATCHER KNOWS THIS IS HARD-CODED                   *         
***********************************************************************         
HOVTAB   DS    0XL(HOVTABL)        ** HOME ID OVERRIDE TABLE **                 
         DC    C'QATT',C'SJ',C'NY'                                              
         DC    C'PKUV',C'SJ',C'DA'                                              
         DC    C'PKST',C'SJ',C'DA'                                              
         DC    C'PWAT',C'SJ',C'AT'                                              
         DC    C'PWGN',C'SJ',C'CH'                                              
         DC    C'PKSA',C'SJ',C'DA'                                              
         DC    C'PKDF',C'SJ',C'DA'  ADDED OCT13/06                              
         DC    C'YYML',C'SJ',C'AT'  ADDED FEB12/07                              
         DC    C'YYMO',C'SJ',C'AT'  ADDED 2007APR30                             
         DC    C'YYCN',C'SJ',C'LA'  ADDED 2008JUL03                             
                                                                                
         DC    C'WCAU',C'RP',C'PH'                                              
                                                                                
         DC    C'WMAQ',C'H9',C'CH'                                              
         DC    C'WMAQ',C'RP',C'CH'                                              
         DC    C'WMAQ',C'BN',C'CH'                                              
         DC    C'WMAQ',C'H7',C'CH'                                              
         DC    C'WMAQ',C'GZ',C'CH'                                              
                                                                                
         DC    C'WNBC',C'YN',C'NY'                                              
         DC    C'WNBC',C'H7',C'NY'                                              
         DC    C'WNBC',C'GZ',C'NY'                                              
         DC    C'WNBC',C'MC',C'NY'                                              
         DC    C'WNBC',C'TH',C'NY'                                              
         DC    C'WNBC',C'WI',C'NY'                                              
         DC    C'WNBC',C'UB',C'NY'                                              
                                                                                
         DC    C'WATL',C'GZ',C'AT'                                              
         DC    C'WATL',C'FR',C'AT'   ADDED 2009MAY26                            
         DC    C'WATL',C'H7',C'NY'   ADDED 2009JUN01                            
         DC    C'WATL',C'H7',C'AT'   ADDED 2010DEC06                            
                                                                                
         DC    C'WXIA',C'FR',C'AT'   ADDED 2009MAY26                            
         DC    C'WXIA',C'H7',C'NY'   ADDED 2009JUN01                            
         DC    C'WXIA',C'H7',C'AT'   ADDED 2010DEC06                            
*&&DO                                                                           
* AS OF FEB11/2010, THESE STATION ARE NOW GOING NATION TO REPPAK                
         DC    C'KUVN',C'GZ',C'DA'                                              
         DC    C'KUVN',C'H7',C'DA'                                              
         DC    C'KUVN',C'TR',C'DA'                                              
         DC    C'KUVN',C'UB',C'DA'                                              
         DC    C'KUVN',C'OO',C'DA'                                              
         DC    C'KUVN',C'YN',C'DA'   SET FOR 2007-07-16                         
         DC    C'KUVN',C'FR',C'DA'   SET FOR 2007-07-23                         
         DC    C'KUVN',C'M2',C'DA'   SET FOR 2008-09-30                         
                                                                                
         DC    C'KSTR',C'GZ',C'DA'                                              
         DC    C'KSTR',C'H7',C'DA'                                              
         DC    C'KSTR',C'TR',C'DA'                                              
         DC    C'KSTR',C'UB',C'DA'                                              
         DC    C'KSTR',C'OO',C'DA'                                              
         DC    C'KSTR',C'YN',C'DA'   SET FOR 2007-07-16                         
         DC    C'KSTR',C'FR',C'DA'   SET FOR 2007-07-23                         
         DC    C'KSTR',C'M2',C'DA'   SET FOR 2008-09-30                         
*&&                                                                             
         DC    C'KSAT',C'GZ',C'DA'                                              
         DC    C'KSAT',C'MC',C'DA'                                              
         DC    C'KSAT',C'YN',C'DA'                                              
         DC    C'KSAT',C'H7',C'DA'                                              
         DC    C'KSAT',C'RP',C'DA'                                              
         DC    C'KSAT',C'QU',C'DA'                                              
         DC    C'KSAT',C'G7',C'DA'                                              
         DC    C'KSAT',C'TR',C'DA'                                              
         DC    C'KSAT',C'UB',C'DA'                                              
         DC    C'KSAT',C'FR',C'DA'   SET FOR 2007-07-23                         
         DC    C'KSAT',C'B$',C'KC'   SET FOR 2007-10-02                         
         DC    C'KSAT',C'PC',C'DA'   SET FOR 2008-02-25                         
         DC    C'KSAT',C'M2',C'DA'   SET FOR 2008-07-09                         
         DC    C'KSAT',C'H7',C'NY'   SET FOR 2008-07-25                         
         DC    C'KSAT',C'JS',C'AK'   SET FOR 2012-02-07                         
         DC    C'KSAT',C'JS',C'CH'   SET FOR 2012-02-07                         
         DC    C'KSAT',C'JS',C'DA'   SET FOR 2012-02-07                         
         DC    C'KSAT',C'JS',C'IN'   SET FOR 2012-02-07                         
         DC    C'KSAT',C'JS',C'IR'   SET FOR 2012-02-07                         
         DC    C'KSAT',C'JS',C'JK'   SET FOR 2012-02-07                         
         DC    C'KSAT',C'JS',C'NY'   SET FOR 2012-02-07                         
                                                                                
         DC    C'NSAT',C'GZ',C'DA'                                              
         DC    C'NSAT',C'MC',C'DA'                                              
         DC    C'NSAT',C'YN',C'DA'                                              
         DC    C'NSAT',C'H7',C'DA'                                              
         DC    C'NSAT',C'RP',C'DA'                                              
         DC    C'NSAT',C'QU',C'DA'                                              
         DC    C'NSAT',C'G7',C'DA'                                              
         DC    C'NSAT',C'TR',C'DA'                                              
         DC    C'NSAT',C'UB',C'DA'                                              
         DC    C'NSAT',C'FR',C'DA'   SET FOR 2007-07-23                         
         DC    C'NSAT',C'B$',C'KC'   SET FOR 2007-10-02                         
         DC    C'NSAT',C'PC',C'DA'   SET FOR 2008-02-25                         
         DC    C'NSAT',C'M2',C'DA'   SET FOR 2008-07-09                         
         DC    C'NSAT',C'H7',C'NY'   SET FOR 2008-07-25                         
                                                                                
         DC    C'RSAT',C'GZ',C'DA'                                              
         DC    C'RSAT',C'MC',C'DA'                                              
         DC    C'RSAT',C'YN',C'DA'                                              
         DC    C'RSAT',C'H7',C'DA'                                              
         DC    C'RSAT',C'RP',C'DA'                                              
         DC    C'RSAT',C'QU',C'DA'                                              
         DC    C'RSAT',C'G7',C'DA'                                              
         DC    C'RSAT',C'TR',C'DA'                                              
         DC    C'RSAT',C'UB',C'DA'                                              
         DC    C'RSAT',C'FR',C'DA'   SET FOR 2007-07-23                         
         DC    C'RSAT',C'B$',C'KC'   SET FOR 2007-10-02                         
         DC    C'RSAT',C'PC',C'DA'   SET FOR 2008-02-25                         
         DC    C'RSAT',C'M2',C'DA'   SET FOR 2008-07-09                         
         DC    C'RSAT',C'H7',C'NY'   SET FOR 2008-07-25                         
                                                                                
         DC    C'KDFI',C'GZ',C'DA'   SET FOR 2006-11-27                         
         DC    C'KDFI',C'H7',C'DA'   SET FOR 2007-09-11                         
         DC    C'KDFI',C'FR',C'DA'   SET FOR 2008-01-22                         
         DC    C'KDFI',C'M2',C'DA'   SET FOR 2008-07-08                         
         DC    C'KDFI',C'YN',C'DA'   SET FOR 2008-08-08                         
         DC    C'KDFI',C'H7',C'NY'   SET FOR 2009-03-04                         
         DC    C'KDFI',C'GZ',C'CH'   SET FOR 2009-07-17                         
                                                                                
         DC    C'KDFW',C'GZ',C'DA'   SET FOR 2006-11-27                         
         DC    C'KDFW',C'H7',C'DA'   SET FOR 2007-09-11                         
         DC    C'KDFW',C'FR',C'DA'   SET FOR 2008-01-22                         
         DC    C'KDFW',C'M2',C'DA'   SET FOR 2008-07-08                         
         DC    C'KDFW',C'YN',C'DA'   SET FOR 2008-07-08                         
         DC    C'KDFW',C'GZ',C'CH'   SET FOR 2009-01-16                         
         DC    C'KDFW',C'H7',C'NY'   SET FOR 2009-03-04                         
                                                                                
         DC    C'WGCL',C'GZ',C'AT'   SET FOR 2007-02-12                         
         DC    C'WGCL',C'GZ',C'CH'   SET FOR 2008-12-18                         
         DC    C'WGCL',C'YN',C'AT'   SET FOR 2008-12-18                         
         DC    C'WGCL',C'H7',C'AT'   SET FOR 2008-12-18                         
         DC    C'WGCL',C'M2',C'AT'   SET FOR 2008-12-18                         
         DC    C'WGCL',C'FR',C'AT'   SET FOR 2008-12-18                         
                                                                                
         DC    C'WUPA',C'GZ',C'AT'   SET FOR 2007-05-14                         
         DC    C'WUPA',C'RP',C'AT'   SET FOR 2007-07-16                         
         DC    C'WUPA',C'M2',C'AT'   SET FOR 2008-06-30                         
         DC    C'WUPA',C'YN',C'AT'   SET FOR 2008-06-30                         
         DC    C'WUPA',C'H7',C'AT'   SET FOR 2008-06-30                         
         DC    C'WUPA',C'FR',C'AT'   SET FOR 2008-06-30                         
         DC    C'WUPA',C'UB',C'AT'   SET FOR 2008-09-11                         
         DC    C'WUPA',C'H7',C'NY'   SET FOR 2009-01-23                         
         DC    C'WUPA',C'WI',C'AT'   SET FOR 2009-05-11                         
                                                                                
         DC    C'KOBI',C'BN',C'LA'   SET FOR 2008-07-07                         
         DC    C'KOBI',C'YN',C'SF'   SET FOR 2008-07-07                         
         DC    C'KOBI',C'M2',C'SF'   SET FOR 2008-07-07                         
         DC    C'KOBI',C'H7',C'SF'   SET FOR 2008-07-07                         
         DC    C'KOBI',C'FR',C'SF'   SET FOR 2008-07-07                         
         DC    C'KOBI',C'FR',C'LA'   SET FOR 2008-07-25                         
         DC    C'KOBI',C'UB',C'NY'   SET FOR 2009-03-04                         
                                                                                
         DC    C'KGO ',C'GZ',C'LA'   SET FOR 2008-02-25                         
                                                                                
         DC    C'KCNC',C'OO',C'SE'   SET FOR 2008-09-17                         
                                                                                
         DC    C'KPRC',C'RP',C'DA'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'GZ',C'CH'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'YN',C'DA'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'H7',C'DA'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'H7',C'NY'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'M2',C'DA'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'FR',C'DA'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'FR',C'NY'   SET FOR 2008-12-08                         
         DC    C'KPRC',C'OO',C'DA'   SET FOR 2009-03-12                         
         DC    C'KPRC',C'WI',C'AT'   SET FOR 2009-04-24                         
                                                                                
         DC    C'OPRC',C'RP',C'DA'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'GZ',C'CH'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'YN',C'DA'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'H7',C'DA'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'H7',C'NY'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'M2',C'DA'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'FR',C'DA'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'FR',C'NY'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'OO',C'DA'   SET FOR 2011-03-18                         
         DC    C'OPRC',C'WI',C'AT'   SET FOR 2011-03-18                         
                                                                                
         DC    C'WPCH',C'YN',C'AT'   SET FOR 2008-12-22                         
         DC    C'WPCH',C'H7',C'AT'   SET FOR 2008-12-22                         
         DC    C'WPCH',C'M2',C'AT'   SET FOR 2008-12-22                         
         DC    C'WPCH',C'FR',C'AT'   SET FOR 2008-12-22                         
                                                                                
         DC    C'WNYW',C'YN',C'NY'   SET FOR 2009-01-07                         
         DC    C'WNYW',C'H7',C'NY'   SET FOR 2009-01-07                         
         DC    C'WNYW',C'M2',C'NY'   SET FOR 2009-01-07                         
         DC    C'WNYW',C'FR',C'NY'   SET FOR 2009-01-07                         
                                                                                
         DC    C'WWOR',C'YN',C'NY'   SET FOR 2009-01-07                         
         DC    C'WWOR',C'H7',C'NY'   SET FOR 2009-01-07                         
         DC    C'WWOR',C'M2',C'NY'   SET FOR 2009-01-07                         
         DC    C'WWOR',C'FR',C'NY'   SET FOR 2009-01-07                         
                                                                                
         DC    C'WAGA',C'YN',C'AT'   SET FOR 2009-01-07                         
         DC    C'WAGA',C'H7',C'AT'   SET FOR 2009-01-07                         
         DC    C'WAGA',C'M2',C'AT'   SET FOR 2009-01-07                         
         DC    C'WAGA',C'FR',C'AT'   SET FOR 2009-01-07                         
         DC    C'WAGA',C'H7',C'NY'   SET FOR 2009-01-23                         
                                                                                
         DC    C'WFXT',C'YN',C'BO'   SET FOR 2009-01-07                         
         DC    C'WFXT',C'H7',C'BO'   SET FOR 2009-01-07                         
         DC    C'WFXT',C'M2',C'BO'   SET FOR 2009-01-07                         
         DC    C'WFXT',C'FR',C'BO'   SET FOR 2009-01-07                         
         DC    C'WFXT',C'H7',C'NY'   SET FOR 2009-01-16                         
                                                                                
         DC    C'WJBK',C'YN',C'DE'   SET FOR 2009-01-07                         
         DC    C'WJBK',C'H7',C'DE'   SET FOR 2009-01-07                         
         DC    C'WJBK',C'M2',C'DE'   SET FOR 2009-01-07                         
         DC    C'WJBK',C'FR',C'DE'   SET FOR 2009-01-07                         
                                                                                
         DC    C'KLSR',C'FR',C'SF'   SET FOR 2009-01-09                         
                                                                                
         DC    C'KEVU',C'FR',C'SF'   SET FOR 2009-01-09                         
                                                                                
         DC    C'WFLD',C'YN',C'CH'   SET FOR 2009-01-14                         
         DC    C'WFLD',C'H7',C'CH'   SET FOR 2009-01-14                         
         DC    C'WFLD',C'M2',C'CH'   SET FOR 2009-01-14                         
         DC    C'WFLD',C'FR',C'CH'   SET FOR 2009-01-14                         
                                                                                
         DC    C'WPWR',C'YN',C'CH'   SET FOR 2009-01-14                         
         DC    C'WPWR',C'H7',C'CH'   SET FOR 2009-01-14                         
         DC    C'WPWR',C'M2',C'CH'   SET FOR 2009-01-14                         
         DC    C'WPWR',C'FR',C'CH'   SET FOR 2009-01-14                         
                                                                                
         DC    C'KTTV',C'YN',C'LA'   SET FOR 2009-01-14                         
         DC    C'KTTV',C'H7',C'LA'   SET FOR 2009-01-14                         
         DC    C'KTTV',C'M2',C'LA'   SET FOR 2009-01-14                         
         DC    C'KTTV',C'FR',C'LA'   SET FOR 2009-01-14                         
                                                                                
         DC    C'KCOP',C'YN',C'LA'   SET FOR 2009-01-14                         
         DC    C'KCOP',C'H7',C'LA'   SET FOR 2009-01-14                         
         DC    C'KCOP',C'M2',C'LA'   SET FOR 2009-01-14                         
         DC    C'KCOP',C'FR',C'LA'   SET FOR 2009-01-14                         
                                                                                
         DC    C'WDIV',C'GZ',C'CH'   SET FOR 2009-03-26                         
         DC    C'WDIV',C'FR',C'DE'   SET FOR 2009-03-26                         
         DC    C'WDIV',C'H7',C'DE'   SET FOR 2009-03-26                         
         DC    C'WDIV',C'BN',C'DE'   SET FOR 2009-03-26                         
         DC    C'WDIV',C'MC',C'DE'   SET FOR 2009-03-26                         
         DC    C'WDIV',C'WI',C'CH'   SET FOR 2009-03-26                         
                                                                                
         DC    C'WCVB',C'FR',C'BO'   SET FOR 2009-04-06                         
         DC    C'WCVB',C'H7',C'NY'   SET FOR 2009-04-06                         
                                                                                
         DC    C'WPIX',C'FR',C'NY'   SET FOR 2010-01-29                         
         DC    C'WPIX',C'H7',C'NY'   SET FOR 2010-01-29                         
                                                                                
HOVTABN  EQU   (*-HOVTAB)/L'HOVTAB                                              
                                                                                
HOVTABD  DSECT                                                                  
HOVTSTA  DS    CL4                 STATION CODE                                 
HOVTAGY  DS    CL2                 AGENCY POWER CODE                            
HOVTOFF  DS    CL2                 AGENCY OFFICE                                
HOVTABL  EQU   *-HOVTABD                                                        
SVRDEF   CSECT                                                                  
                                                                                
***********************************************************************         
* LIST OF ROUTING CODES THAT CAN EDI EVEN THOUGH FAX RADIO ONLY IS    *         
* SET TO "Y"                                                          *         
***********************************************************************         
                                                                                
         DS    0H                                                               
KTZRDYTB DS    0CL(L'DAREROUT)     LIST OF ROUTING CODES THAT CAN EDI           
         DC    C'SJ NY'            SJR NEW YORK                                 
         DC    C'H7 NY'            MINDSHARE NEW YORK                           
         DC    C'TMENY'            MEDIAVEST NEW YORK                           
         DC    C'TMEAT'            MEDIAVEST ATLANTA                            
         DC    C'TMEDA'            MEDIAVEST DALLAS                             
         DC    C'RP CH'            RUBIN CHICAGO                                
         DC    C'RP LA'            RUBINE LA                                    
         DC    C'STRCH'            STARCOM CH, 12-26-06                         
         DC    C'H7 DN'            MINDSHARE DENVER, 2007JAN16                  
         DC    C'H7 DE'            MINDSHARE DETROIT, 2007JAN29                 
         DC    C'GPMNY'            MINDSHARE MSNYSGM, 2007JAN29                 
         DC    C'MAXNY'            MINDSHARE MSNYSMX, 2007JAN29                 
         DC    C'H7 AT'            MINDSHARE ATLANTA, 2007FEB05                 
         DC    C'H7 SF'            MINDSHARE SAN FRANCISCO, 2007FEB05           
         DC    C'TMEDE'            MEDIAVEST DENVER, 2007FEB05                  
         DC    C'RP AT'            RUBIN     ATLANTA, 2007FEB19                 
         DC    C'RP BO'            RUBIN     BOSTON , 2007FEB19                 
         DC    C'RP DA'            RUBIN     DALLAS , 2007FEB19                 
         DC    C'H7 MI'            MINDSHARE MIAMI,   2007MAR05                 
         DC    C'RP PH'            RUBIN     PHILLY,  2007MAR05                 
         DC    C'RP PO'            RUBIN     PORTLND, 2007MAR05                 
         DC    C'H7 DA'            MINDSHARE DALLAS,  2007MAR12                 
         DC    C'H7 LA'            MINDSHARE LA,      2007MAR27                 
         DC    C'TMECH'            MEDIEEDGE CHICAGO, 2007MAR27                 
         DC    C'TMELA'            MEDIAEDGE LA,      2007MAR27                 
         DC    C'MPGBO'            MPG       BOSTON,  2007APR22                 
         DC    C'STLCH'            STARLINK  CHICAGO  2007MAY14                 
         DC    C'MPGNY'            MPG       NEW YORK 2007MAY21                 
         DC    C'MPGCH'            MPG       CHICAGO  2007JUL23                 
         DC    AL1(FF)             END OF TABLE                                 
         EJECT                                                                  
*                                                                               
* BLOCK ADDRESS                                                                 
*                                                                               
B#B3IO1  EQU   3                   IO1 --------------------------------         
B#AGYREC EQU   3                   IO1 - AGENCY RECORD                          
*                                  IO1 --------------------------------         
                                                                                
B#B4IO2  EQU   4                   IO2 --------------------------------         
B#CLTREC EQU   4                   IO2 - CLIENT RECORD                          
*                                  IO2 --------------------------------         
                                                                                
B#B5IO3  EQU   5                   IO3 --------------------------------         
B#NOTREC EQU   5                   IO3 - MAKEGOOD NOTICE RECORD                 
ANOTREC  EQU   LP_BLKS+((B#NOTREC-1)*L'LP_BLKS),,C'A'                           
B#COMREC EQU   5                   IO3 - STANDARD COMMENT RECORD                
B#BYRREC EQU   5                   IO3 - BUYER RECORD                           
B#SALREC EQU   5                   IO3 - RADIO PERSON RECORD                    
B#OCOREC EQU   5                   IO3 - OCOM RECORD                            
AOCOREC  EQU   LP_BLKS+((B#OCOREC-1)*L'LP_BLKS),,C'A'                           
B#SDRREC EQU   5                   IO3 - SELF-DEFINING RECORD                   
ASDRREC  EQU   LP_BLKS+((B#SDRREC-1)*L'LP_BLKS),,C'A'                           
B#DSTREC EQU   5                   IO3 - DARE STATION RECORD                    
ADSTREC  EQU   LP_BLKS+((B#DSTREC-1)*L'LP_BLKS),,C'A'                           
*                                  IO3 --------------------------------         
                                                                                
B#B6IO4  EQU   6                   IO4 --------------------------------         
B#OFFREC EQU   6                   IO4 - MAKEGOOD OFFER RECORD                  
AOFFREC  EQU   LP_BLKS+((B#OFFREC-1)*L'LP_BLKS),,C'A'                           
B#NOTRJC EQU   6                   IO4 - NOTICE REJECTION COMMENT REC           
ANOTRJC  EQU   LP_BLKS+((B#NOTRJC-1)*L'LP_BLKS),,C'A'                           
B#UIDREC EQU   6                   IO4 - USER-ID RECORD                         
AUIDREC  EQU   LP_BLKS+((B#UIDREC-1)*L'LP_BLKS),,C'A'                           
B#FAXREC EQU   6                   IO4 - FAX INFORMATION RECORD                 
B#DSRREC EQU   6                   IO4 - DESTN RECORD                           
*                                  IO4 --------------------------------         
                                                                                
B#B7IO5  EQU   7                   IO5 --------------------------------         
B#ORDREC EQU   7                   IO5 - DARE ORDER RECORD                      
AORDREC  EQU   LP_BLKS+((B#ORDREC-1)*L'LP_BLKS),,C'A'                           
B#DBTREC EQU   7                   IO5 - DARE BATCH RECORD                      
B#OHSREC EQU   7                   IO5 - ORDER HISTORY RECORD                   
AOHSREC  EQU   LP_BLKS+((B#OHSREC-1)*L'LP_BLKS),,C'A'                           
B#OFFRC2 EQU   7                   IO5 - MAKEGOOD OFFER RECORD 2                
AOFFRC2  EQU   LP_BLKS+((B#OFFRC2-1)*L'LP_BLKS),,C'A'                           
*                                  IO5 --------------------------------         
                                                                                
B#B8IO6  EQU   8                   IO6 --------------------------------         
B#SDMREC EQU   8                   IO6 - SELLER DEMO RECORD                     
B#OMXREC EQU   8                   IO6 - OM EXTRA ORDER DETAILS                 
*                                  IO6 --------------------------------         
                                                                                
B#B9IO7  EQU   9                   IO7 --------------------------------         
B#FLTREC EQU   9                   IO7 - FLIGHT RECORD                          
AFLTREC  EQU   LP_BLKS+((B#FLTREC-1)*L'LP_BLKS),,C'A'                           
B#MDDREC EQU   9                   IO7 - OFFER DEMO RECORD                      
AMDDREC  EQU   LP_BLKS+((B#MDDREC-1)*L'LP_BLKS),,C'A'                           
*                                  IO7 --------------------------------         
                                                                                
B#B10IO8 EQU   10                  IO8 --------------------------------         
B#ESTREC EQU   10                  IO8 - ESTIMATE RECORD                        
AESTREC  EQU   LP_BLKS+((B#ESTREC-1)*L'LP_BLKS),,C'A'                           
B#OBCREC EQU   10                  IO8 - DARE ORDER COMMENT                     
AOBCREC  EQU   LP_BLKS+((B#OBCREC-1)*L'LP_BLKS),,C'A'                           
*                                  IO8 --------------------------------         
                                                                                
B#SVRDEF EQU   12                  SERVER                                       
                                                                                
CANAGYQ  EQU   C'C'                CANADIAN AGENCY IDENTIFIER                   
RADMEDQ  EQU   C'R'                RADIO MEDIA                                  
TELMEDQ  EQU   C'T'                TELEVISION MEDIA                             
CANMEDQ  EQU   C'C'                CANADIAN MEDIA LETTER                        
USAMEDQ  EQU   C'T'                USA MEDIA LETTER                             
QUNSENT  EQU   C'-'                DUMMY EQUATE FOR UNSENT ORDER                
                                                                                
EOR      EQU   0                   END OF RECORD ELEMENT                        
CBLSUFQ  EQU   X'B0'               SUFFIX FOR CABLE STATIONS                    
DLTGELQ  EQU   X'18'               DEALER CML/TAG ASSIGN ELEMENT                
PDELEMQ  EQU   X'22'               POST BUY DEMO ORIGINAL ELEMENT               
SDELEMQ  EQU   X'23'               POST BUY DEMO SPILL ELEMENT                  
DLOVELQ  EQU   X'24'               DEMO LOOK-UP OVERRIDE ELEMENT                
UPELEMQ  EQU   X'62'               UPGRADE ELEMENT                              
IDELEMQ  EQU   X'70'               ID ELEMENT                                   
CMELEMQ  EQU   X'66'               COMMENT ELEMENT                              
MGRCELQ  EQU   X'65'               MAKEGOOD REASON CODE ELEMENT                 
COS2ELQ  EQU   X'71'               COST2 ELEMENT                                
C2FCELQ  EQU   X'73'               COST2 FACTOR ELEMENT                         
ACTVELQ  EQU   X'99'               BUY ACTIVITY ELEMENT                         
DPTKTYPQ EQU   X'08'               DAYPART RECORD CODE                          
EQUKTYPQ EQU   X'09'               EQUIVALENCY HEADER RECORD TYPE               
POLPRDQ  EQU   FF                  POOL PRODUCT NUMBER                          
SEC30Q   EQU   30                  DEFAULT SECONDS LENGTH                       
         EJECT                                                                  
         DS    0H                                                               
ORDLOCKS DS    0CL(L'DOSTSTAT)     ** UNLOCKED ORDER STATUSES **                
         DC    AL1(QRJCT)          REJECTED                                     
         DC    AL1(QCFMD)          CONFIRMED                                    
         DC    AL1(QUNDARE)        UNDARED                                      
         DC    AL1(QNODARE)        NOT DARE ANY MORE                            
         DC    AL1(QERRORED)       SF ERROR                                     
         DC    AL1(QRECALL)        RECALLING IS OKAY FOR AUTO-RECALL            
         DC    AL1(QRCLAPPR)       RECALL OF APPROVED ORDER                     
         DC    AL1(QRCLDELN)       RECALL OF DELIVERED ORDER                    
         DC    AL1(QRCLTRNS)       RECALL AND TRANSMITTED TO STATION            
         DC    AL1(QRCLWIP)        RECALL AND WORK IN PROGRESS                  
         DC    AL1(QEMPTY)         NO BUYS WHEN THIS ORDER WAS SENT             
         DC    AL1(QBYRCNFM)       BUYER CONFIRMED                              
         DC    AL1(QSNTXCNF)       SENT CANCELLED, RECALL CONF W/COM            
         DC    AL1(QSNTXREJ)       SENT CANCELLED, RECALLED REJECTED            
ORDLOCKN EQU   (*-ORDLOCKS)/L'ORDLOCKS                                          
                                                                                
***********************************************************************         
* SPECIAL TABLE FOR NONDARE REP, STATION, AGENCY & OFFICE             *         
***********************************************************************         
                                                                                
         DS    0H                                                               
GTRSAOTB DS    0XL(NONDARL)                                                     
         DC    C'WHO',C'YYM ',C'**',C'AT'   ALL AGENCIES IN ATLANTA             
         DC    C'WHO',C'YYMU',C'**',C'AT'                                       
         DC    AL1(FF)                                                          
         DS    0H                                                               
                                                                                
       ++INCLUDE DDVSREPTAB                                                     
                                                                                
***********************************************************************         
* SPECIAL TABLE FOR REP, AGENCY & OFFICE                              *         
***********************************************************************         
                                                                                
         DS    0H                                                               
GTRAOTAB DC    C'ROB',C'SJ ',C'CH'                                              
         DC    C'MOB',C'SJR',C'LA'  DAMN!! WHY IS IT SJR AND NOT SJ???          
                                                                                
         DC    C'ABC',C'STR',C'CH'  STARCOM/STARLINK                            
         DC    C'ABC',C'STL',C'CH'                                              
                                                                                
         DC    C'ABC',C'GMP',C'AT'  GM PLANWORKS                                
         DC    C'ABC',C'GMP',C'CH'                                              
         DC    C'ABC',C'GMP',C'DA'                                              
         DC    C'ABC',C'GMP',C'DE'                                              
         DC    C'ABC',C'GMP',C'LA'                                              
         DC    C'ABC',C'GMP',C'MI'                                              
         DC    C'ABC',C'GMP',C'NY'                                              
                                                                                
         DC    C'ABC',C'RP ',C'LA'  RUBEN POSTAER                               
         DC    C'ABC',C'RP ',C'PH'                                              
         DC    C'ABC',C'RP ',C'DA'                                              
         DC    C'ABC',C'RP ',C'AT'                                              
         DC    C'ABC',C'RP ',C'CH'                                              
                                                                                
         DC    C'ABC',C'RPD',C'LA'  RUBEN POSTAER DIRECT                        
                                                                                
         DC    C'ABC',C'KWG',C'NY'  KWG, SEND TO ABC                            
                                                                                
         DC    C'ABC',C'MUW',C'CA'  MULLEN                                      
         DC    C'ABC',C'MUW',C'BO'                                              
         DC    C'ABC',C'MUW',C'AT'  MULLEN ATLANTA DOES NOT EXIST, BUT          
*                                    ENTRY HELPS US ROUTE TO ABC-AT             
*&&DO                                                                           
         DC    C'ABC',C'STR',C'LA'  TAKEN OUT NOV30/05 AS PER KLEF              
                                                                                
         DC    C'ABC',C'GMP',C'CA'  THESE OFFICES WILL GO IN LATER              
         DC    C'ABC',C'GMP',C'EF'                                              
         DC    C'ABC',C'GMP',C'HO'                                              
         DC    C'ABC',C'GMP',C'NO'                                              
         DC    C'ABC',C'GMP',C'SL'                                              
         DC    C'ABC',C'GMP',C'SE'                                              
*&&                                                                             
         DC    C'UNI',C'***',C'AT' ADDED OCT22/07                               
         DC    C'UNI',C'***',C'DA'       OCT22/07                               
         DC    C'UNI',C'***',C'NY'       OCT22/07                               
         DC    C'UNI',C'***',C'CH' ADDED NOV01/07                               
         DC    C'UNI',C'***',C'DE'       NOV01/07                               
         DC    C'UNI',C'***',C'SA'       NOV08/07                               
         DC    C'UNI',C'***',C'LA'       JAN18/08                               
         DC    C'UNI',C'***',C'SF'       FEB07/08                               
         DC    C'UNI',C'***',C'MI'       MAR14/08                               
         DC    C'UNI',C'***',C'TT'       AUG22/11                               
         DC    AL1(FF)                                                          
                                                                                
RAOTABD  DSECT                     REP/AGY-OFFICE TABLE DSECT                   
RAOTREP  DS    CL3                 NON-DARE REP TO MATCH AGAINST SVREP          
RAOTRAGY DS    CL3                 AGENCY ROUTING CODE                          
RAOTOFF  DS    CL2                 OFFICE IN ROUTING CODE                       
RAOTABL  EQU   *-RAOTABD                                                        
SVRDEF   CSECT                                                                  
         EJECT                                                                  
                                                                                
****COPIED HW                                                                   
SAVED    DSECT                     ** DSECT TO COVER SAVED STORAGE **           
                                                                                
WVALUES  DS    0X                  ** LITERAL VALUES **                         
                                                                                
ADCONS   DS    0A                  ** RELOCATED ADDRESS CONSTANTS **            
AFLTESP  DS    A                   A(ESTIMATE POINTER FILTER ROUTINE)           
AFLTSOL  DS    A                   A(SUBSCRIPTION FILTER ROUTINE)               
AFLTC4C  DS    A                   A(CHECK FOR CHANGES FILTER ROUTINE)          
AFLTDBK  DS    A                   A(DARE BATCH SUBSSC KEY FILTER ROUT)         
AFLTDBSK DS    A                   A(DARE BATCH SEARCH KEY FILTER ROUT)         
AFLTDBT  DS    A                   A(DARE BATCH REC FILTER ROUTINE)             
AGETORD  DS    A                   A(DARE ORDER GET/FILTER ROUTINE)             
ASETORD  DS    A                   A(DARE ORDER SET ROUTINE)                    
AFLTSOD  DS    A                   A(DARE ORDER SEARCH FILTER ROUTINE)          
ADCONSN  EQU   (*-ADCONS)/L'ADCONS                                              
                                                                                
V460050  DS    XL4                 PC VERSION 4.6.0.50                          
V4600156 DS    XL4                 PC VERSION 4.6.0.156                         
V470037  DS    XL4                 PC VERSION 4.7.0.37                          
                                                                                
DARADM   DS    CL2                 DARE AGENCY CODE                             
POLPRD   DS    CL3                 POL PRODUCT CODE                             
ALLPRD   DS    CL3                 C'ALL'                                       
POLPRDX  DS    XL3                 X'0000FF'                                    
COMTYPEQ DS    XL2                 COMMENT RECORD TYPE                          
                                                                                
WVALUEL  EQU   *-WVALUES                                                        
                                                                                
AMASTC   DS    A                   A(MASTC)                                     
ABUFFRIN DS    A                   A(BUFFERIN)                                  
AKEYTAB  DS    A                   A(DRIVER TABLE)                              
AROUTADR DS    A                                                                
                                                                                
ARECUP   DS    V                   RECUP FROM COMFACS                           
                                                                                
RUNMODE  DS    XL(L'RUNPMODE)      DDLINK/RUNNER CALLING MODE                   
                                                                                
SVIOADDR DS    XL(L'IOADDR)        SAVED RECORD ADDRESS                         
SVNOTKEY DS    0XL(L'IOKEY)        SAVED NOTICE KEY                             
SVORDKEY DS    XL(L'IOKEY)        SAVED ORDER KEY                               
SVDSTKEY DS    XL(L'DSTAKEY)       SAVED DARE STATION KEY                       
SVUIDKEY DS    XL(L'CTIKEY)        SAVED USER-ID KEY                            
                                                                                
MAPI     DS    0XL(L'MAPI1+L'MAPI2)                                             
                                                                                
MAPI1    DS    X                   ** MAP INDICATOR BYTE 1 **                   
MAPIORDD EQU   X'80'               ORDER DOWNLOAD                               
MAPINOTD EQU   X'40'               DOWNLOAD NOTICE DETAILS                      
MAPIBUYD EQU   X'20'               BUY DOWNLOAD                                 
MAPIOBCR EQU   X'10'               DOWNLOAD ORDER BUYER COMMENTS                
*        EQU   X'08'               N/D                                          
MAPILORD EQU   X'04'               LOCKED ORDER DOWNLOAD                        
MAPIMGDD EQU   X'02'               MAKEGOOD DOWNLOAD                            
MAPIR4RD EQU   X'01'               ROUTES DOWNLOAD                              
                                                                                
MAPI2    DS    X                   ** MAP INDICATOR BYTE 2 **                   
MAPIAMCE EQU   X'80'               RESOLVE AGENCY/MEDIA/CLIENT/EST              
MAPIMISS EQU   X'40'               DOWNLOAD MISSED BUYLINE DETAILS              
MAPIOFFD EQU   X'20'               DOWNLOAD OFFER DETAILS                       
MAPIOBUY EQU   X'10'               DOWNLOAD OFFER BUY DETAILS                   
MAPIMNHD EQU   X'08'               DOWNLOAD MAKEGOOD NOTICE HEADER              
MAPIORDR EQU   X'04'               DOWNLOAD ORDER DETAILS                       
MAPIUDEM EQU   X'02'               UPLOAD MAKEGOOD DEMOS                        
MAPIFSTA EQU   X'01'               APPLY STATION FILTER IN GETORD S/R           
                                                                                
RUNI1    DS    X                   ** RUN INDICATOR BYTE 1 **                   
RUNICANA EQU   X'80'               CANADIAN AGENCY                              
RUNIENIK EQU   X'40'               ESTIMATE NUMBER IN ORDER KEY                 
RUNIMARK EQU   X'20'               MARKET NAME SENT                             
                                                                                
SVERROR  DS    XL(L'LP_ERROR)      ERROR NUMBER                                 
                                                                                
BUYMED   DS    C                   MEDIA CODE FOR BUY RECORDS                   
                                                                                
NOTCDONE DS    C                   FLAG DONE WITH MKGD NOTICE (NXTOMN)          
MDDFOUND DS    C                   MAKEGOOD DEMO RECORD FOUND                   
MODFOUND DS    C                   MAKEGOOD NIELSEN DEMO ELEMENT FOUND          
MONTDFND DS    C                   MAKEGOOD NON-TRAD DEMO ELEMENT FOUND         
MSDFOUND DS    C                   MAKEGOOD SELLER DEMO RECORD FOUND            
                                                                                
AMOMBEL  DS    A                   A(MAKEGOOD BUY ELEMENT)                      
ABYRTAB  DS    A                   A(BUYER CODE SENT TABLE)                     
BYRMAXN  DS    A                   MAXIMUM N'BYRTAB ENTRIES                     
ADBFEL   DS    A                   A(FLIGHT ELEMENT ON BATCH RECORD)            
                                                                                
TSARBLK  DS    XL(TSARDL)          TSAR BLOCK                                   
TSARREC  DS    XL16                TSAR RECORD                                  
TSARSAV  DS    XL16                TSAR RECORD SAVE AREA                        
                                                                                
UPLVALS  DS    0X                  ** UPLOAD VALUES **                          
                                                                                
OFFDA    DS    XL(L'IODA)          DISK ADDRESS OF OFFER RECORD                 
OFFDASV  DS    XL(L'IODA)          SAVED DISK ADDRESS OF OFFER RECORD           
OFFFLSV  DS    X                                                                
                                                                                
OFFDAACT DS    X                   ** ACTION CODE **                            
OFFDAERR EQU   1                   IN ERROR                                     
OFFDAADD EQU   2                   ADD                                          
OFFDAPUT EQU   3                   PUT                                          
                                                                                
UPLVALL  EQU   *-UPLVALS                                                        
                                                                                
REQVALS  DS    0F                  ** REQUEST VALUES **                         
                                                                                
MEDIND   DS    X                   MEDIA                                        
AMED     DS    AL3                                                              
                                                                                
CLTIND   DS    X                   CLIENT                                       
ACLT     DS    AL3                                                              
                                                                                
MKTIND   DS    X                   MARKET                                       
AMKT     DS    AL3                                                              
                                                                                
STAIND   DS    X                   STATION                                      
ASTA     DS    AL3                                                              
                                                                                
PRDIND   DS    X                   PRODUCT (NUMBER)                             
APRD     DS    AL3                                                              
                                                                                
PIGIND   DS    X                   PIGGYBACK PRODUCT (NUMBER)                   
APIG     DS    AL3                                                              
                                                                                
PRDIND1  DS    X                   PRODUCT (CODE)                               
APRD1    DS    AL3                                                              
                                                                                
PRDIND2  DS    X                   PRODUCT (CODE)                               
APRD2    DS    AL3                                                              
                                                                                
ESTIND   DS    X                   ESTIMATE                                     
AEST     DS    AL3                                                              
                                                                                
ESTIND2  DS    X                   ESTIMATE (BUILT FROM POOL ESTIMATES)         
AEST2    DS    AL3                                                              
                                                                                
FLTIND   DS    0X                                                               
PDVIND   DS    X                                                                
AFLT     DS    0AL3                                                             
APDV     DS    AL3                                                              
                                                                                
STTNIND  DS    0X                                                               
RRADIND  DS    0X                                                               
COMIND   DS    X                                                                
ASTATN   DS    0AL3                                                             
ACOM     DS    AL3                                                              
                                                                                
PEFIND   DS    X                   PRODUCT/ESTIMATE/FLIGHT                      
APEF     DS    AL3                                                              
                                                                                
C4CIND   DS    0X                  CHECK FOR CHANGES REQUEST ARRAY              
SOLIND   DS    X                   SUBSCRIPTION FILTERS                         
AC4C     DS    0AL3                                                             
ASOL     DS    AL3                                                              
                                                                                
DEMIND   DS    X                   DEMOS                                        
ADEM     DS    AL3                                                              
                                                                                
ORDIND   DS    X                                                                
AORD     DS    AL3                 ORDER NUMBER(S)                              
                                                                                
ALCK     DS    AL4                 A(LOCKED ORDERS REQUEST ENTRIES)             
                                                                                
RDAIND   DS    X                                                                
ATIM     DS    0AL3                TIME                                         
ARDA     DS    AL3                 RECORD DISK ADDRESS                          
                                                                                
BYRIND   DS    X                   BUYER                                        
ABYR     DS    AL3                                                              
                                                                                
OSTIND   DS    0X                                                               
TOKIND   DS    X                                                                
AOST     DS    0AL3                ORDER STATUS/QUALIFIER ARRAY                 
ATOK     DS    AL3                 RECORD TOKEN                                 
                                                                                
ERRIND   DS    X                   BUY ERRORS                                   
AERR     DS    AL3                                                              
                                                                                
PCKEY    DS    CL(#$PCKEY)         PC KEY                                       
PCKEYORD DS    CL12                PC KEY FOR ORDERS                            
OLOCK    DS    C                   ORDER LOCKED                                 
                                                                                
AGENCY   DS    CL(L'AGYKAGY)       AGENCY CODE                                  
                                                                                
REDODEMS DS    X                   REDO DEMO LOOKUPS?                           
                                                                                
DLDBATCH DS    0X                  DOWNLOAD BATCHES?                            
DLDBYRNM DS    X                   DOWNLOAD BUYER NAME?                         
DLDBMKTO DS    X                   DOWNLOAD BATCH FOR MKTS ALRDY D/L'D          
                                                                                
STRDATEB DS    XL3                 REQUEST START DATE (BINARY)                  
ENDDATEB DS    XL3                 REQUEST END DATE (BINARY)                    
                                                                                
STRDATEC DS    XL2                 REQUEST START DATE (COMPRESSED)              
ENDDATEC DS    XL2                 REQUEST END DATE (COMPRESSED)                
STRDMONC DS    XL2                 REQUEST START MONDAY (COMPRESSED)            
                                                                                
SVMNSTAT DS    CL1                 SAVED MKGD NOTICE STATUS CODE                
REQNTWK  DS    CL3                 REQUESTED DDS NETWORK CODE                   
PRDCDE   DS    XL(L'OCOMKPRD)      PRODUCT CODE FOR OCOMMENTS                   
ESTNO    DS    XL(L'OCOMKEST)      ESTIMATE NUMBER FOR OCOMMENTS                
FLTNO    DS    XL(L'OCOMKFLT)      FLIGHT NUMBER FOR OCOMMENTS                  
PERTYPE  DS    X                   PERSON TYPE                                  
STACALL2 DS    CL(L'DSTAKSTIN)     STATION CALL LETTERS (CALLER)                
STAPCODE DS    XL(L'DSRKSTA)       STATION CODE                                 
                                                                                
C4TIME   DS    0XL4                TIME(CHECK FOR CHANGES)                      
ASTALST  DS    A                   A(STATION LIST FOR ROUTES DOWNLOAD)          
ASTALSTX DS    A                   A(END OF STATION LIST)                       
                                                                                
ASTACUR  DS    A                   A(CURRENT STATION ENTRY)                     
         ORG   ASTACUR                                                          
CURLCKLF DS    X                   # OF LOCK REQUESTS LEFT                      
ACURLCK  DS    AL3                 A(CURRENT LOCK REQUEST ENTRY)                
                                                                                
ASLNTAB  DS    A                   A(SPOT LENGTH TABLE FOR AGY/MED)             
                                                                                
REQVALL  EQU   *-REQVALS                                                        
                                                                                
AALL     DS    AL3                 ALL VALUE WMP ENTRY                          
ANZR     DS    AL3                 NON-ZERO VALUE WMP ENTRY                     
                                                                                
TODAYCMP DS    0XL2                TODAY'S DATE (COMPRESSED)                    
STRDATER DS    XL(L'STRDATEC*2)    ESTIMATE START DATE RANGE                    
ENDDATER DS    XL(L'ENDDATEC*2)    ESTIMATE END DATE RANGE                      
                                                                                
RQMEDIA  DS    CL(L'MKTKMED)       REQ MEDIA CODE                               
REPAGY   DS    CL(L'TWAAGY)        REQUESTED AGENCY ALPHA ID                    
REPOFF   DS    CL2                 REP OFFICE                                   
                                                                                
DAREAGYV DS    0X                  ** DARE AGENCY VALUES **                     
DAREROUT DS    0CL(L'CTUSADRC)     DARE ROUTING CODE                            
DAREAGYC DS    CL3                 DARE AGENCY CODE                             
DAREOFFC DS    CL2                 OFFICE CODE                                  
DAREAGYL EQU  *-DAREAGYV                                                        
                                                                                
STACALL1 DS    CL(L'DSTAKSTIN)     STATION CALL LETTERS (VALSCL)                
                                                                                
SVDEMORG DS    C                   DEMO ORIGIN                                  
SVDMOED  EQU   C'E'                - ESTIMATE DEMO                              
SVDMOGD  EQU   C'G'                - GOAL DEMO                                  
SVDMOBD  EQU   C'B'                - BUY DEMO                                   
SVDEMTYP DS    C                   SAVED DEMO TYPE                              
SVDEMTYL DS    CL20                LIST OF SAVED DEMO TYPES                     
                                                                                
SVIOVALS DS    XL(IOVALL)          SAVED I/O VALUES                             
                                                                                
OUTVALS  DS    0X                  ** OUTPUT VALUES **                          
                                                                                
PROFV    DS    0XL16               ** PROFILE VALUES **                         
PROF1WV  DS    0XL(L'PROFV)        SPOT/1W PROFILE VALUES                       
PROFDARV DS    XL(L'PROFV)         SPOT/DAR PROFILE VALUES                      
PROFOMV  DS    XL(L'PROFV)         SPOT/OM PROFILE VALUES                       
PROFDXV  DS    XL(L'PROFV)         SPOT DX PROFILE VALUES                       
PROFD2V  DS    XL(L'PROFV)         SPOT/D2 PROFILE VALUES                       
PROFL    EQU   *-PROFV                                                          
         ORG   PROFV+(PROFNSDO*L'PROFV)                                         
                                                                                
STASTAL  EQU   L'STAPQSTA+L'STAPQNET                                            
                                                                                
ORDBUYER DS    CL(L'DOIDBYR)       BUYER ID                                     
ORDAM    DS    XL(L'DOKAGMD)       AGENCY/MEDIA CODE                            
ORDCLT   DS    XL(L'DOIDCLT)       CLIENT CODE                                  
ORDORDER DS    XL(L'DOKORDER)      ORDER NUMBER                                 
ORDBSTA  DS    XL(L'DOKSTA)        BINARY STATION CODE                          
ORDGROUP DS    CL(L'DODKGPCD)      MAKEGOOD GROUP CODE                          
ORDATIME DS    XL(L'DODKTIME)      ACTIVITY TIME (TU'S)                         
ORDTOKNS DS    0X                  ** REQUEST TOKENS **                         
ORDTOKN1 DS    CL(L'C4CQTOKN)      TOKEN 1                                      
ORDTOKN2 DS    CL(L'C4CQTOKN)      TOKEN 2                                      
ORDTOKNL EQU   *-ORDTOKNS                                                       
                                                                                
ORDVALS  DS    0X                  ** ORDER VALUES **                           
ORDMTHD  DS    CL(L'DOSPTMTH)      TRADE METHOD                                 
ORDDATA  DS    CL(L'DOSPTDAT)      TRADE DATA                                   
ORDVALL  EQU   *-ORDVALS                                                        
                                                                                
ORDMKT   DS    XL(L'DBTKMKT)       MARKET NUMBER                                
ORDPRD   DS    XL(L'DOIDPRD)       PRODUCT NUMBER                               
ORDPIG   DS    XL(L'DOIDPRD2)      PIGGYBACK PRODUCT NUMBER                     
ORDEST   DS    XL(L'DOIDEST)       ESTIMATE NUMBER                              
ORDFLT   DS    CL2                                                              
*ORDFLT   DS    XL(L'DOIDFLTN)      FLIGHT NUMBER                               
ORDSPFFS DS    XL(L'DOIDFFS)       X'FFFF' IF NEW SALESPERSON KEY               
ORDSPPWR DS    XL(L'DOIDREPA)      POWER CODE OF REP                            
ORDSPSCD DS    XL(L'DOIDSALC)      PERSON CODE                                  
ORDFL1   DS    XL1                 FROM DOSPFLG1 FOR POINTPERSON                
ORDER#   DS    XL(L'DOKORDER)      ORDER NUMBER                                 
ORDSTA   DS    CL6                 STATION CODE, NEED ROOM FOR -A               
NUMMNWKS DS    XL2                 NUMBER OF MISSED NETWORKS IN AIO8            
NUMONWKS DS    XL2                 NUMBER OF OFFERED NETWORKS IN AIO8           
                                                                                
ORDOVALS DS    0X                  ** OM ORDER VALUES ** SET BY SETORD          
ORDDA    DS    XL(L'IODA)          DISK ADDRESS                                 
ORDCKSM  DS    XL4                 CHECK SUM                                    
ORDSTAX  DS    XL(L'DOKSTA)        PACKED STATION VALUE                         
ORDCREAT DS    XL(L'DOSTDATE)      DATE CREATE (FROM ORDER NUMBER)              
ORDLADAT DS    XL(L'DOSTDATE)      LAST ACTIVITY DATE                           
ORDFEDAT DS    XL(L'DOSTDATE)      FIRST EDI SEND DATE                          
ORDFADAT DS    XL(L'DOSPFAID)      FIRST AIR DATE                               
ORDBSTAT DS    0CL(L'DOSTSTAT*2)   ** CURRENT & PREVIOUS STATUS **              
ORDCSTAT DS    CL(L'DOSTSTAT)      CURRENT STATUS                               
ORDPSTAT DS    CL(L'DOSTSTAT)      PREVIOUS STATUS                              
ORDISTAT DS    CL(L'DOSTSTAT)      CURRENT STATUS (INTERNAL)                    
ORDTTYPE DS    XL(L'DOSTTYPE)      CURRENT STATUS TYPE                          
ORDEXTRA DS    C                   YESQ IF EXTRA RECORD EXISTS                  
ORDTFLAG DS    C                   YESQ IF ORDTTYPE IS SET                      
OTFTYP3  EQU   X'80'               ORDTTYPE FROM EXTENDED STATUS                
OTFTYP7  EQU   X'40'               ORDTTYPE FROM SEND (CANCEL)                  
OEFRST   EQU   X'20'               ORDER EXTRA FIRST EMAIL SENT                 
ORDIDV   DS    0X                  ** ID VALUES **                              
ORDCOMP  DS    XL(L'DOSTIDNM)      COMPANY ID                                   
ORDRECV  DS    XL(L'DOSTIDNM)      RECEIVER ID                                  
ORDIDVL  EQU   *-ORDIDV                                                         
ORDREVN  DS    XL1                 REVISION NUMBER                              
ORDSCNT  DS    XL2                 ORDER SEND COUNT                             
ORDDEMN  DS    AL2                 N'DEMOS TO PRINT ON ORDER                    
ORDDEMO  DS    64XL(L'DODEMOS)     DEMO CATEGORIES                              
ORDURLEL DS    XL256               L'(URL TEXT) + URL TEXT                      
ORDNRLNS DS    XL2                 N'REJECTED LINES                             
ORDRLINS DS    128XL2              REJECTED LINES                               
PERNAME  DS    CL62                PERSON NAME                                  
ORDOVALL EQU   *-ORDOVALS                                                       
                                                                                
COMVALS  DS    0X                  ** COMMENT RECORD VALUES **                  
COMDA    DS    XL(L'IODA)          RECORD DISK ADDRESS                          
COMCKSM  DS    XL4                 RECORD CHECK SUM                             
                                                                                
MGDVALS  DS    0X                  ** SUPPLEMENTAL MAKEGOOD VALUES **           
MGDCOST2 DS    XL(L'MOMBSCS2)      COST 2 (DISCOUNT COST)                       
MGDREPCD DS    CL(L'MOMBSREP)      REP CODE                                     
MGDFLAG  DS    XL(L'MOMBSFLG)      FLAGS                                        
MGDOFFR  DS    XL(L'MOMBOFFR)      OFFER NUMBER                                 
MGDREC   DS    XL(L'MOMBREC)       RECORD NUMBER                                
MGDVALL  EQU   *-MGDVALS                                                        
                                                                                
NOTVALS  DS    0X                  ** NOTICE VALUES **                          
NOTGROUP DS    CL(L'MNKGROUP)      GROUP CODE                                   
NOTSTAT  DS    CL(L'MNSTSTAT*2)    GROUP STATUS (2 BYTES FOR DLNNOT)            
NOTSTAT2 DS    XL(L'MNRSTAT2)      GROUP STATUS BYTES SET 2                     
NOTDATE  DS    XL(L'MNSTDATE)      STATUS DATE                                  
NOTTIME  DS    XL(L'MNSTTIME)      STATUS TIME                                  
NOTCDATE DS    XL(L'MNSTDATE)      CREATION DATE                                
NOTCTIME DS    XL(L'MNSTTIME)      CREATION TIME                                
NOTFMIS  DS    XL(L'MNMSBDAT)      FIRST MISSED DATE                            
NOTFOFF  DS    XL(L'MOBDBDAT)      FIRST OFFER DATE                             
NOTDA    DS    XL(L'IODA)          DISK ADDRESS                                 
NOTFILE  DS    CL1                 F-SPTFIL (default), X-XSPFIL                 
NOTCKSM  DS    XL4                 CHECK SUM                                    
NOTSTATN DS    XL3                 BINARY STATION OF NOTICE                     
NOTVALL  EQU   *-NOTVALS                                                        
                                                                                
OFFVALS  DS    0X                  ** OFFER VALUES **                           
OFFADEM  DS    AL4                 A(FIRST MODMDEMO)                            
OFFDEM#  DS    XL2                 NUMBER OF DEMOS IN MODMEL                    
OFFOVER  DS    C                   YESQ=CURRENT DEMO IS OVERRIDE                
OFFDA1   DS    XL(L'IODA)          RECORD 1 DISK ADDRESS                        
OFFCKSM1 DS    XL4                 RECORD 1 CHECK SUM                           
OFFDA2   DS    XL(L'IODA)          RECORD 2 DISK ADDRESS                        
OFFCKSM2 DS    XL4                 RECORD 2 CHECK SUM                           
OFFFILE  DS    CL1                 F-SPTFIL (default), X-XSPFIL                 
OFFSTATN DS    XL3                 BINARY STATION OF OFFER                      
OFFSDFLG DS    XL1                 SELLER DEMO FLAG                             
OFFSDEM  EQU   X'80'               Offer has seller demos                       
OFFSNDEM EQU   X'40'               Offer has seller Non-trad demos              
OFFVALL  EQU   *-OFFVALS                                                        
                                                                                
BTCHDRNG DS    0XL(L'DDTKDATE*2)   BATCH DATE RANGE                             
BTCHDRST DS    XL(L'DDTKDATE)                                                   
BTCHDRND DS    XL(L'DDTKDATE)                                                   
TDYLS90D DS    XL2                 TODAY'S DATE LESS 90 DAYS (FF COMPL)         
TDYLS90S DS    XL2                 SPECIAL FOR TMNY, CLT DSH & SPO              
OUTVALL  EQU   *-OUTVALS                                                        
                                                                                
         ORG   OUTVALS                                                          
FAXRNGE  DS    0XL(L'CTFXCODE*2)   ** REP FAX KEY READING RANGE **              
FAXRSTR  DS    XL(L'CTFXCODE)      START OF RANGE                               
FAXREND  DS    XL(L'CTFXCODE)      END OF RANGE                                 
                                                                                
UIDRNGE  DS    0XL(L'DRREPPFX*2)   ** REP USER KEY READING RANGE **             
UIDRSTR  DS    XL(L'DRREPPFX)      START OF RANGE                               
UIDREND  DS    XL(L'DRREPPFX)      END OF RANGE                                 
                                                                                
R4RDRTAB DS    XL(DAPTLENQ)        REP ENTRY FROM DARETAB                       
                                                                                
R4RFLAG1 DS    X                   ** READ FOR ROUTES FLAGS 1 **                
R4RFDSTA EQU   X'80'               DONE WITH DARE STATION RECORDS               
R4RFDAGY EQU   X'40'               DONE WITH DAGYROUT RECORDS                   
R4RFUSER EQU   X'20'               DONE WITH USER-ID RECORDS                    
R4RFRFAX EQU   X'10'               DONE WITH REP FAX RECORDS                    
R4RFDFLT EQU   X'08'               DEFAULT ROUTE SET                            
R4RFGRFX EQU   X'04'               GOT A REP FAX RECORD                         
R4RFUID0 EQU   X'02'               FIRST FOR NEXT TIME - USER-IDS               
R4RFFRST EQU   X'01'               FIRST FOR NEXT TIME                          
                                                                                
R4RFLAG2 DS    X                   ** READ FOR ROUTES FLAGS 2 **                
R4RFREDI EQU   X'80'               SENT EDI OBJECT OUT ALREADY FOR REP          
R4RRPIBX EQU   X'40'               GOING TO HAVE REP/INBOX AS DEFAULT           
R4RCANFX EQU   X'02'               COMPANY-ID CAN FAX AS PER EDICT              
R4RFXRAD EQU   X'01'               FAX ALL RADIO ORDERS                         
                                                                                
R4ROVOFF DS    CL(L'AGROVROF)      OVERRIDE OFFICE CODE                         
                                                                                
R4RHOMEV DS    0C                  ** HOME MARKET VALUES **                     
R4RHOMEM DS    CL(L'DSTAHOMCT)     HOME MARKET CITY                             
R4RHOMER DS    CL(L'DSTAHOMIC)     HOME MARKET RECEIVING ID                     
R4RHOMEL EQU   *-R4RHOMEV                                                       
*                                                                               
R4RA2NDR DS    A                   A(LIST OF 2ND REPS)                          
R4R2NDPF DS    CL(L'DRREPPFX)      2ND REP PREFIX (USERID)                      
R4R2NDOF DS    CL(L'DAREOFFC)      OFFICE CODE FOR 2ND REP                      
*                                                                               
R4RVALS  DS    0X                  ** READ FOR ROUTES VALUES **                 
                                                                                
R4RSCALL DS    CL(L'DSTAKSTIN)     STATION CALL LETTERS                         
R4REFFDT DS    XL(L'DSTAKEFDA)     STATION EFFECTIVE DATE (BINARY)              
R4RNCALL DS    CL(L'DSTASTA)       NEW STATION CALL LETTERS                     
R4RNEFFD DS    XL(L'DSTASTADT)     NEW STATION EFFECTIVE DATE (JULIAN)          
                                                                                
R4RDESTN DS    C                   ** DESTINATION **                            
R4RDSTAQ EQU   C'S'                STATION                                      
R4RDREPQ EQU   C'R'                REP                                          
                                                                                
R4RUSRID DS    CL(L'DRREPPFX)      USER-ID                                      
R4ROFFIC DS    CL(L'DAREOFFC)      OFFICE CODE                                  
R4RDFLTR DS    C                   DEFAULT ROUTE                                
R4RDNEDI DS    C                   NO EDI INFO                                  
                                                                                
R4RCONV  DS    0X                  ** CONTACT VALUES **                         
R4RFAXNO DS    CL(L'CTFX1NUM)      TELEPHONE NUMBER                             
R4RATTN  DS    CL(L'CTFX2ATT)      ATTENTION NAME                               
R4RPHONE DS    CL(L'CTFX4TEL)      PHONE NUMBER                                 
R4RCONL  EQU   *-R4RCONV                                                        
                                                                                
R4RVALX  DS    0X                                                               
R4RVALL  EQU   *-R4RVALS                                                        
                                                                                
R4RMEDIA DS    CL(L'DSTAKMEDA)     MEDIA CODE                                   
                                                                                
PROFFXV  DS    XL(L'PROFV)         SPOT/FX PROFILE VALUES                       
                                                                                
         ORG   OUTVALS                                                          
BOXVALS  DS    0X                  ** BATCH ORDER EXPORT VALUES **              
BOXORD#  DS    XL(L'DOKORDER)      ORDER NUMBER                                 
BOXDATE  DS    XL(L'DOSTDATE)      LAST SENT DATE                               
BOXTIME  DS    XL(L'DOSTTIME)      LAST SENT TIME                               
BOXREV#  DS    XL(L'DOSPREVN)      WHAT REVISION # WILL BE IF SENDING           
OHSRATE  DS    XL4                 RATE ADJUSTED WITH INDICATORS                
OHSQSTA  DS    CL8                 STATION CALL LETTERS                         
OHSDEM#  DS    AL2                 NUMBER OF DEMOS IN OBDDEMS                   
         ORG   OHSDEM#                                                          
OHOWKS#  DS    AL2                 NUMBER OF ENTRIES IN OHOWKS                  
OHOWKS   DS    53XL2               WEEK NUMBER/NUMBER OF SPOTS                  
         ORG   OHSDEM#                                                          
OHSWKS#  DS    AL2                 NUMBER OF ENTRIES IN OHSWKS                  
OHSWKS   DS    53XL3               WEEK NUMBER/NUMBER OF SPOTS                  
BOXVALL  EQU   *-BOXVALS                                                        
         ORG                                                                    
                                                                                
BYRTAB#  DS    H                   N'ENTRIES IN BYRTAB                          
BYRTAB   DS    0XL(L'DOIDBYR)      BUYER NAME SENT TABLE                        
         DS    (16*ONEK)X          THIS AREA IS ONLY USED OFFLINE               
BYRTMAX2 EQU   (*-BYRTAB)/L'BYRTAB MAXIMUM N'TABLE ENTRIES (OFFLINE)            
BYRTMAX1 EQU   (IO7LQ+IO8LQ)/L'BYRTAB  MAX N'TABLE ENTRIES (ONLINE)             
                                                                                
SODOD    DSECT                     ** SOD OPTIMIZATION BUFFER **                
SODOTYPE DS    X                   ** RECORD TYPE **                            
SODOTCLT EQU   1                   CLIENT RECORD                                
SODOTPRD EQU   2                   PRODUCT RECORD                               
SODOTEST EQU   3                   ESTIMATE RECORD                              
SODOTMKT EQU   4                   MARKET RECORD                                
SODOMED  DS    X                   MEDIA OR AGENCY/MEDIA                        
SODOMKT  DS    0XL(L'DCMKMKT)      MARKET NUMBER                                
SODOCLT  DS    XL(L'DCMKCLT)       CLIENT CODE                                  
SODOPRD  DS    0XL(L'DCMKPRD)      PRODUCT CODE                                 
SODOEST  DS    XL(L'DCMKEST)       ESTIMATE NUMBER                              
SODOKEYL EQU   *-SODOD                                                          
SODOCODE DS    CL3                 CLIENT/PRODUCT CODE                          
SODOCPOL DS    0XL(L'SODOINDS)     CLIENT'S BRAND/POL TRENDS                    
SODOINDS DS    X                   ** INDICATORS **                             
SODOISNT EQU   X'80'               RECORD VALUES SENT                           
SODORECL EQU   *-SODOD                                                          
                                                                                
       ++INCLUDE DDDARETABD                                                     
         EJECT                                                                  
       ++INCLUDE SPLNKWRK                                                       
                                                                                
CLTRECD  DSECT                                                                  
         ORG   CKEYCLT+L'CKEYCLT                                                
CKEYREST DS    XL(L'CKEY-(*-CKEY))                                              
                                                                                
PRDRECD  DSECT                                                                  
         ORG   PKEYPRD+L'PKEYPRD                                                
PKEYREST DS    XL(L'PKEY-(*-PKEY))                                              
                                                                                
ESTRECD  DSECT                                                                  
         ORG   EKEYEST+L'EKEYEST                                                
EKEYREST DS    XL(L'EKEY-(*-EKEY))                                              
                                                                                
WORKD    DSECT                     ** REDEFINE OVERWORK (1K) **                 
         ORG   OVERWORK                                                         
*                                                                               
LR4RVALS DS    0X                  ** LAST READ FOR ROUTES VALUES **            
LR4RSTAP DS    XL(L'STAPCODE)      LAST STATION CODE                            
LR4RREPC DS    CL(L'DAPTCODE)      LAST REP CODE                                
LR4RSCLL DS    CL(L'DSTAKSTIN)     STATION CALL LETTERS                         
LR4RSEFF DS    XL(L'DSTAKEFDA)     STATION EFFECTIVE DATE                       
LR4RVALL EQU   *-LR4RVALS                                                       
         ORG   LR4RVALS                                                         
                                                                                
LORDVALS DS    0X                  ** LAST ORDER VALUES **                      
LORDVAGM DS    XL(L'QMEDX)         LAST AGENCY/MEDIA                            
LORDVCLT DS    XL(L'SODOCLT)       LAST CLIENT                                  
LORDIOVL DS    XL(IOVALL)          TO SAVE IOVALS AS IT MIGHT GET BLOWN         
LORDVALL EQU   *-LORDVALS                                                       
                                                                                
         DS    XL(ONEK-(*-OVERWORK)) PROTECTION SO WE DON'T GO OVER 1K          
         ORG                                                                    
                                                                                
* OTHER INCLUDED DSECTS                                                         
         PRINT OFF                                                              
       ++INCLUDE CTGENRAD          MSTREET RECORDS                              
       ++INCLUDE CTGENFILE                                                      
CTFXREC  DSECT                                                                  
         ORG   CTFXKTYP+L'CTFXKTYP                                              
CTFXSPR1 DS    XL(CTFXAGY-*)                                                    
         ORG   CTFXAGY+L'CTFXAGY                                                
CTFXSPR2 DS    XL(CTFXCODE-*)                                                   
         ORG   CTFXSUBC+L'CTFXSUBC                                              
CTFXSPR3 DS    XL(CTFXLEN-*)                                                    
         ORG                                                                    
*PREFIX=D                                                                       
       ++INCLUDE CTGENSTAD                                                      
STAKEYD  DSECT                                                                  
         ORG   STAKTYP+L'STAKTYP                                                
STAKSPR1 DS    XL(DSTAKMEDA-*)                                                  
         ORG   STAKEFDA+L'STAKEFDA                                              
STAKSPR2 DS    XL(DSTAKSTAT-*)                                                  
*PREFIX=                                                                        
       ++INCLUDE CTGENAGRD                                                      
       ++INCLUDE CTGENEDICT                                                     
       ++INCLUDE DDBUFFD                                                        
       ++INCLUDE DDTSARD                                                        
       ++INCLUDE FASSBOFF                                                       
       ++INCLUDE FAFACTS                                                        
       ++INCLUDE FAWSSVRD                                                       
       ++INCLUDE FAXTRAINF                                                      
       ++INCLUDE GEGENSDR                                                       
       ++INCLUDE SEACSFILE                                                      
       ++INCLUDE SPEDUPD                                                        
       ++INCLUDE SPGENBUY                                                       
       ++INCLUDE SPGENCLRST                                                     
         ORG   CLSTEL01+L'CLSTEL01                                              
CLS01LEN DS    X                                                                
CLS01ELQ EQU   X'01'                                                            
         ORG                                                                    
       ++INCLUDE SPGENDAYPT                                                     
       ++INCLUDE SPGENDRBTC                                                     
       ++INCLUDE SPGENDRFLT                                                     
DFLRECD  DSECT                                                                  
         ORG   DFLKEST+L'DFLKEST                                                
DFLKREST DS    XL(L'DFLKEY-(*-DFLKEY))                                          
       ++INCLUDE SPGENDRORD                                                     
DAREORDD DSECT                                                                  
         ORG   DOKEY                                                            
DODKEY   DS    0XL32                                                            
       ++INCLUDE SPGENORHIS                                                     
OHISRECD DSECT                                                                  
         ORG   OHISSTYP+L'OHISSTYP                                              
OHISSPR1 DS    XL((OHISORD-OHISRECD)-(OHISSTYP+L'OHISSTYP-OHISRECD))            
       ++INCLUDE SPGENDRMKN                                                     
       ++INCLUDE SPGENDRMKO                                                     
       ++INCLUDE SPGENDREV                                                      
       ++INCLUDE SPGENDESTN                                                     
       ++INCLUDE SPGENDRMRC                                                     
DESTNRCD DSECT                                                                  
         ORG   DSRKCLT+L'DSRKCLT                                                
DSRKREST DS    XL(L'DSRKEY-(DSRKCLT+L'DSRKCLT-DSRKEY))                          
       ++INCLUDE SPGENESTD                                                      
       ++INCLUDE SPGENEQU                                                       
       ++INCLUDE SPGENXLK                                                       
       ++INCLUDE SPGETBUBLD                                                     
       ++INCLUDE SPSTAPACKD                                                     
       ++INCLUDE SPSTABLK                                                       
       ++INCLUDE SPTRCMML                                                       
STARECD  DSECT                                                                  
       ++INCLUDE SPGENSTA                                                       
       ++INCLUDE SPGENSTEQ                                                      
       ++INCLUDE SPGENSDEF                                                      
       ++INCLUDE GEGENSPSAL                                                     
         ORG   GSPKPCOD+L'GSPKPCOD                                              
GSPLKSPR DS    XL(L'GSPLKEY-(*-GSPLKEY))                                        
       ++INCLUDE SPADAVCOM                                                      
         ORG   COMKCOM+L'COMKCOM                                                
COMKSPR  DS    XL(L'COMKEY-(*-COMKEY))                                          
       ++INCLUDE SPADBUYER                                                      
         ORG   BYRKBYR+L'BYRKBYR                                                
BYRKSPR  DS    XL(L'BYRKEY-(*-BYRKEY))                                          
*PREFIX=O                                                                       
COMD     DSECT                                                                  
       ++INCLUDE SPGENCOM                                                       
         ORG   COMKSTA                                                          
COMKSPR  DS    XL1                 SPARE FOR MARKET NUMBER                      
         ORG                                                                    
COMELQ   EQU   X'05'                                                            
         ORG   COMELEN+L'COMELEN                                                
COMMENT  DS    0C                                                               
*PREFIX=                                                                        
       ++INCLUDE SPGENWIPW                                                      
       ++INCLUDE SPGENEMAIL                                                     
REPRECD  DSECT                                                                  
       ++INCLUDE SPGENREP                                                       
       ++INCLUDE SPGENPURP                                                      
       ++INCLUDE SPGENREAS                                                      
       ++INCLUDE DEDEMTABD                                                      
       ++INCLUDE SPGENDDEV                                                      
DBLOCKD  DSECT                                                                  
       ++INCLUDE DEDBLOCK                                                       
       ++INCLUDE GEGENEDI                                                       
       ++INCLUDE DDGETDARED                                                     
         PRINT ON                                                               
                                                                                
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'196SPLNK32   11/03/20'                                      
         END                                                                    

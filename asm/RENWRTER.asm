*          DATA SET RENWRTER   AT LEVEL 045 AS OF 01/10/17                      
*PHASE T00AAAB,+0                                                               
*INCLUDE PRINT                                                                  
*INCLUDE PRNTBL                                                                 
*INCLUDE UNBOOK                                                                 
*INCLUDE ALTBCMON                                                               
*        TITLE 'RENWRTER - T00AAA - WRITER FOR REP'                             
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP'                             
***********************************************************************         
*                                                                     *         
* REGISTER USAGE -                                                    *         
*        R0 - WORK REG                                                *         
*        R1 - WORK REG                                                *         
*        R2 - WORK REG                                                *         
*        R3 - WORK REG                                                *         
*        R4 - WORK REG & GETEL PTR                                    *         
*        R5 - WORK REG                                                *         
*        R6 - BASE REG                                                *         
*        R7 - BASE REG                                                *         
*        R8 - BASE REG                                                *         
*        R9 - POINTER TO SUBSYSD                                      *         
*        RA - POINTER TO GLOBALD                                      *         
*        RB - FIRST BASE                                              *         
*        RC - POINTER TO GEND                                         *         
*        RD - SAVE AREA POINTER                                       *         
*        RE - GOTO1 REG                                               *         
*        RF - GOTO1 REG                                               *         
*                                                                     *         
***********************************************************************         
*                                                                     *         
*  LEV 44    JUN04/14 AGYNUM KEYWORD SUPPORT                          *         
*  LEV 40    MAY15/11 PRO-RATED KEYWORDS                              *         
*  LEV 81    NOV12/90 DON'T CK PERIOD DATE FOR SALES ALL ACT TOTALS   *         
*  LEV 82    NOV14/90 DON'T ALLOW PERIOD OVERRIDE FOR AACT TOTALS     *         
*  LEV 83    DEC06/90 SET PAPER WORK RECS REQD FOR ACTIVITY TOTALS    *         
*                     DOUBLE COUNTS FOR COMBINED STATIONS             *         
*            END TOMBSTONE                                                      
***********************************************************************         
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - INIT'                      
***********************************************************************         
*                                                                     *         
*        PROGRAM INITIALIZATION                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         PRINT NOGEN                                                            
RENWRTER CSECT                                                                  
         NMOD1 0,RENWRTER                                                       
*                                                                               
         L     RA,0(R1)            ESTABLISH DRIVER WORKING STORAGE             
         USING GLOBALD,RA                                                       
*                                                                               
         L     RC,GLAWORKD         ESTABLISH GENCON WORKING STORAGE             
         USING GEND,RC                                                          
*                                                                               
         L     R9,ASUBSYSD         ESTABLISH WRITER WORKING STORAGE             
         USING SUBSYSD,R9                                                       
*                                                                               
         LA    R7,RENWRIOD         ESTABLISH NWRIO WORKAREA                     
         USING RENWRIOD,R7                                                      
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - WRHOOK'                    
***********************************************************************         
*                                                                     *         
*        DETERMINE HOOK CALL                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WRHOOK   DS    0H                                                               
*                                                                               
         CLI   GLHOOK,GLRESOLV     RESOLVE ADDRESSES                            
         BE    WRRESLV                                                          
         CLI   GLHOOK,GLROUT       EXECUTE ROUTINE                              
         BE    WREXEC                                                           
         CLI   GLHOOK,GLPUTSRT     PUT SORT RECORD                              
         BE    WRPUTSRT                                                         
         CLI   GLHOOK,GLPRINT      PRINT OUTPUT LINE                            
         BE    WRPRNTLN                                                         
*                                                                               
WRHOOKX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - WRRESLV'                   
***********************************************************************         
*                                                                     *         
*        RESOLVE ROUTINE ADDRESS                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WRRESLV  DS    0H                                                               
*                                                                               
*        INITIAL SPACES WORKAREA                                                
*                                                                               
         MVI   RESPACES,C' '                                                    
         MVC   RESPACES+1(L'RESPACES-1),RESPACES                                
*                                                                               
*        SET WRITER ADDRESSES                                                   
*                                                                               
         L     RF,=A(BLDLBL)                                                    
         ST    RF,BLDLBLA                                                       
*                                                                               
         L     RF,=A(GENOUTR)                                                   
         ST    RF,GENOUTA                                                       
*                                                                               
         L     RF,=A(FNDFLTR)                                                   
         ST    RF,FNDFLTRA                                                      
*                                                                               
*        FIND ROUTINE ADDRESS IN LIST                                           
*                                                                               
         L     R1,=A(ROUTLIST)     POINT TO LIST OF ROUTINES                    
*                                                                               
WRRSLOOP DS    0H                                                               
*                                                                               
         CLI   0(R1),X'FF'         DONE IF END OF TABLE REACHED                 
         BE    WRRSDONE                                                         
*                                                                               
         CLC   GLLABEL,0(R1)       MATCH ROUTINE NAME TO THAT IN LIST           
         BE    WRRSFND                                                          
*                                                                               
WRRSCONT DS    0H                                                               
*                                                                               
         LA    R1,12(R1)           BUMP TO NEXT ENTRY IN ROUTINE LIST           
         B     WRRSLOOP                                                         
*                                                                               
WRRSFND  DS    0H                  ROUTINE NAME FOUND IN LIST                   
*                                                                               
         MVC   GLAROUT,8(R1)       RETURN ADDRESS                               
*                                                                               
WRRSDONE DS    0H                                                               
*                                                                               
*        INIT DROP/SUPPRESS TABLE                                               
*                                                                               
         TM    REQCFOPT,REQCFDPQ   SKIP IF DROP OPTION NOT BEING USED           
         BNO   WRRSDRPX                                                         
*                                                                               
*TEST                                                                           
         L     RF,=A(WREXDTBC)                                                  
         MVI   0(RF),0                                                          
*TEST                                                                           
         L     RF,=A(WREXDPTB)     POINT TO DROP TABLE                          
         LA    R0,WREXDTMQ         NUMBER OF ELEMENTS IN TABLE                  
*                                                                               
         XC    0(WREXDTLQ,RF),0(RF) INIT AN ENTRY IN TABLE                      
         LA    RF,WREXDTLQ(RF)     BUMP TO NEXT ENTRY                           
         BCT   R0,*-10                                                          
*                                                                               
WRRSDRPX DS    0H                                                               
*                                                                               
WRRESLVX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - WREXEC'                    
***********************************************************************         
*                                                                     *         
*        EXECUTE A ROUTINE                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WREXEC   DS    0H                                                               
*                                                                               
*        COMMON INITIALIZATION                                                  
*                                                                               
         MVC   WORK,RESPACES       PRESET WORK AREAS                            
         ZAP   DUB,=P'0'                                                        
*                                                                               
         L     R2,GLAIFLD          R2=A(INPUT)                                  
         L     R3,GLAOFLD          R3=A(OUTPUT)                                 
*                                                                               
         CLI   GLMODE,GLOUTPUT                                                  
         BE    WREXOUT                                                          
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - WREXIN'                    
***********************************************************************         
*                                                                     *         
*        EXECUTE AN INPUT ROUTINE                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WREXIN   DS    0H                                                               
*                                                                               
         CLI   SORTSW,C'D'         IF SORT DELETE DONE                          
         BNE   *+8                                                              
         MVI   SORTSW,0               RESET SORTSW                              
*                                                                               
*        FIND FILTER AREA ADDRESS                                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,GLARGS+6       GET KEYWORD NUMBER                           
         BZ    WRXIFLTX             NONE GIVEN                                  
*                                                                               
         LA    RE,FLTAREAL         LENGTH OF FILTER SAVEAREA                    
         BCTR  RF,0                DECREMENT FOR INDEXING                       
         MR    RE,RE               CALCULATE INDEX AMOUNT                       
*                                                                               
         L     RE,AFLTTAB          POINT TO FILTER SAVEAREAS                    
         LA    RE,0(RF,RE)         POINT TO THIS KEYWORD'S AREA                 
         ST    RE,FLTFLTRA         SAVE ADDRESS                                 
*                                                                               
         GOTO1 =A(COLFLTR)         APPLY COLUMN FILTERS                         
         BNE   WREXECX               DROP RECORD                                
*                                                                               
WRXIFLTX DS    0H                                                               
*                                                                               
         L     R1,GLADTENT                                                      
         USING DRIND,R1                                                         
*                                                                               
         MVC   MYILEN,DRINLEN      SAVE INPUT LEN & TYPE                        
         MVC   MYITYPE,DRINTYPE                                                 
*                                                                               
         TM    REQCFOPT,REQCFDPQ   SKIP IF DROP OPTION NOT BEING USED           
         BNO   WRIXDRPX                                                         
*                                                                               
         L     RF,=A(WREXDTBC)     POINT TO DROP TABLE CONTROL BYTE             
         TM    0(RF),WREXDCFQ      SKIP IF TABLE FILLED ALREADY                 
         BO    WRIXDRPX                                                         
*                                                                               
         CLI   GLARGS+6,0          SKIP IF KEYWORD NUMBER NOT KNOWN             
         BE    WRIXDRPX                                                         
*                                                                               
*        IF KEYWORD USING DROP OPTION                                           
*           ADD AN ENTRY FOR IT TO THE DROP/SUPPRESS TABLE                      
*                                                                               
*        CHECK IF KEYWORD IS USING DROP OPTION                                  
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQWRCFL),(2,=AL2(RKQCFDRP)),0                
*                                                                               
         OC    8(4,R1),8(R1)                                                    
         BZ    WRIXDRPX            NO SUPPRESSION                               
*                                                                               
         L     RF,=A(WREXDPTB)     POINT TO DROP PROCESSING TABLE               
         LA    R0,WREXDTMQ         MAX NUMBER OF ENTRIES IN TABLE               
*                                                                               
WRIXDPLP DS    0H                                                               
*                                                                               
         CLI   WREXDTKY-WREXDPTB(RF),0 USE FIRST EMPTY SLOT                     
         BE    WRIXDPFD                                                         
*                                                                               
         CLC   GLARGS+6(1),WREXDTKY-WREXDPTB(RF)  DONE IF KYWD IN TABLE         
         BE    WRIXDPDN                ALREADY                                  
*                                                                               
WRIXDPCN DS    0H                                                               
         LA    RF,WREXDTLQ(RF)     BUMP TO NEXT TABLE ENTRY                     
         BCT   R0,WRIXDPLP                                                      
         DC    H'0'                NO ROOM IN TABLE                             
*                                                                               
WRIXDPFD DS    0H                  ADD KEYWORD TO TABLE                         
*                                                                               
         L     R1,GLADTENT                                                      
         USING DRIND,R1                                                         
*                                                                               
         MVC   WREXDTKY-WREXDPTB(L'WREXDTKY,RF),GLARGS+6  KYWD NUMBER           
         MVC   WREXDTLN-WREXDPTB(L'WREXDTLN,RF),DRINFLEN  FLD LENGTH            
         MVC   WREXDTRP-WREXDPTB(L'WREXDTRP,RF),DRINREP   REPETITIONS           
         MVC   WREXDTTP-WREXDPTB(L'WREXDTTP,RF),DRINTYPE  DATATYPE              
*                                                                               
         B     WRIXDRPX                                                         
*                                                                               
WRIXDPDN DS    0H                                                               
*                                                                               
*TEST                                                                           
*        L     RF,=A(WREXDTBC)                                                  
*        OI    0(RF),WREXDCFQ      INDICATE TABLE FILLED                        
*TEST                                                                           
*                                                                               
WRIXDRPX DS    0H                                                               
*                                                                               
WRXIGO   DS    0H                                                               
*                                                                               
*        BECAUSE NOT ALL ROUTINES SAVE REGISTERS ON ENTRY                       
*        WE NEED SPECIAL CODE TO FORCE RETURN TO HERE                           
*                                                                               
         LA    RE,WRXIRET         POINT TO RETURN POINT                         
*                                                                               
WRXISAV  NTR1                      SAVE CURRENT REGISTERS                       
*                                                                               
         L     RF,GLAROUT       ** BRANCH TO I/O ROUTINE **                     
         BASR  RE,RF                                                            
*                               ROUTINES THAT SAVE REGS RETURN HERE             
         XIT1                   UNSAVE REGISTERS                                
*                                                                               
WRXIRET DS    0H                  EVERYONE WINDS UP HERE                        
*                                                                               
         CLI   GLARGS+7,C'$'       IF DATA NOT TO BE FLOWCHARTED                
         BE    WRXIFLW                                                          
*                                                                               
         TM    STACKSW,STCKMRGQ       SKIP IF NOT MERGING DATA                  
         BNO   WRXIFLWX                                                         
*                                                                               
         B     WRXIFLW10              DO END OF RECORD STACKING ROUTINE         
*                                                                               
WRXIFLW  DS    0H                                                               
*                                                                               
         GOTO1 =A(DOFLW)           FLOWCHART DATA                               
*                                                                               
         CLI   FLOWDATA,C'Y'          IF SIGNIFICANT DATA FOUND                 
         BNE   WRXIFLWX                                                         
*                                                                               
         TM    STACKSW,STACKYQ        AND STACKING                              
         BNO   WRXIFLWX                                                         
*                                                                               
WRXIFLW10 DS   0H                                                               
*                                                                               
         NI    STACKSW,X'FF'-STCKINIQ  TURN OFF INIT SWITCH                     
*                                                                               
         GOTO1 =A(XSTACK)          GO HANDLE STACKING FOR DATA                  
*                                                                               
WRXIFLWX DS    0H                                                               
*                                                                               
         B     WREXECX                                                          
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - WREXOUT'                   
***********************************************************************         
*                                                                     *         
*        EXECUTE AN OUTPUT ROUTINE                                    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WREXOUT  DS    0H                  OUT ADDRESS                                  
*                                                                               
*        IF ADV OR AGY DATA NEEDED BUT NOT SORTED ON                            
*              THE CORRESPONDING TABLES WERE NOT FILLED                         
*                  FILL THEM NOW                                                
*                                                                               
WREXADV  DS    0H                                                               
*                                                                               
         TM    READCNTL,READCFLQ   SKIP IF ADV TABLE ALREADY FILLED             
         BO    WREXADVN                                                         
*                                                                               
         TM    READCNTL,READCFTQ   SKIP IF ADV WAS FILTERED                     
         BO    WREXADVN               TABLE WAS FILLED ON INPUT                 
*                                                                               
         TM    READCNTL,READCSRQ   SKIP IF ADV VALUES SORTED                    
         BO    WREXADVN               TABLE WAS FILLED ON INPUT                 
*                                                                               
         ICM   R2,15,READVTBA      SKIP IF NO ADV TABLE PRESENT                 
         BZ    WREXADVX                                                         
         USING ADVTTABD,R2         ESTABLISH ADV TABLE                          
*                                                                               
*        READ TABLE ENTRY                                                       
*        USE KEY TO READ IN RECORD                                              
*        FILL IN REMAINDER OF TABLE ENTRY FROM RECORD                           
*                                                                               
         ICM   R0,15,ADVTBSRP+8    GET NUMBER OF RECORDS IN TABLE               
         BZ    WREXADVX            IGNORE IF TABLE EMPTY                        
*                                                                               
         L     R3,ADVTBSRP+4       POINT TO FIRST RECORD IN TABLE               
         USING ADVTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R4,KEY              ESTABLISH RADVKEY                            
         USING RADVKEY,R4                                                       
*                                                                               
         MVC   AIO,REAIO1          READ INTO I/O AREA 1                         
*                                                                               
WREXADVL DS    0H                                                               
*                                                                               
         MVC   RADVKEY,ADVTKEY     SET TO KEY IN TABLE                          
*                                                                               
         CLC   RADVKREP,REREP      IF REP CHANGES                               
         BE    *+8                                                              
         BRAS  RE,NEWREP              SET UP FOR NEW REP                        
*                                                                               
         GOTO1 HIGH                READ IN DIRECTORY POINTER                    
*                                                                               
         CLC   RADVKEY,ADVTKEY     MATCH KEYS                                   
         BNE   WREXADVC            RECORD NOT FOUND                             
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
*                                                                               
*        SAVE DECRIPTION ELEMENT                                                
*                                                                               
         LA    R6,34(R6)           POINT TO FIRST ELEMENT IN RECORD             
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R6)            GET ELEMENT LENGTH                           
*                                                                               
         CLI   0(R6),0             DONE AT END OF RECORD                        
         BE    WREXADV1                                                         
         CLI   0(R6),X'01'         FIND DESCRIPTION ELEMENT                     
         BE    *+16                                                             
         IC    RF,1(R6)            GET ELEMENT LENGTH                           
         LA    R6,0(RF,R6)         BUMP TO NEXT ELEMENT                         
         B     *-24                                                             
*                                                                               
         MVC   ADVTELM,0(R6)       SAVE DESCRIPTION ELEMENT                     
*                                     NOT ALL USED                              
WREXADV1 DS    0H                                                               
*                                                                               
WREXADVC DS    0H                  NEXT DIRECTORY POINTER                       
*                                                                               
         A     R3,ADVTBSRP+12      POINT TO NEXT ENTRY IN TABLE                 
         BCT   R0,*+8              DECREMENT ENTRY COUNTER                      
         B     WREXADVD            DONE                                         
*                                                                               
         B     WREXADVL                                                         
*                                                                               
WREXADVD DS    0H                  KEY FOUND                                    
*                                                                               
         OI    READCNTL,READCFLQ   ADV TABLE HAS BEEN FILLED                    
*                                                                               
WREXADVX DS    0H                                                               
*                                                                               
         L     R2,GLAIFLD          R2=A(INPUT)                                  
         L     R3,GLAOFLD          R3=A(OUTPUT)                                 
*                                                                               
WREXADVN DS    0H                                                               
*                                                                               
WREXPRD  DS    0H                                                               
*                                                                               
         TM    REPRCNTL,REPRCFLQ   SKIP IF PRD TABLE ALREADY FILLED             
         BO    WREXPRDN                                                         
*                                                                               
         TM    REPRCNTL,REPRCFTQ   SKIP IF PRD WAS FILTERED                     
         BO    WREXPRDN               TABLE WAS FILLED ON INPUT                 
*                                                                               
         TM    REPRCNTL,REPRCSRQ   SKIP IF PRD VALUES SORTED                    
         BO    WREXPRDN               TABLE WAS FILLED ON INPUT                 
*                                                                               
         ICM   R2,15,REPRDTBA      SKIP IF NO PRD TABLE PRESENT                 
         BZ    WREXPRDX                                                         
         USING PRDTTABD,R2         ESTABLISH PRD TABLE                          
*                                                                               
*        READ TABLE ENTRY                                                       
*        USE KEY TO READ IN RECORD                                              
*        FILL IN REMAINDER OF TABLE ENTRY FROM RECORD                           
*                                                                               
         ICM   R0,15,PRDTBSRP+8    GET NUMBER OF RECORDS IN TABLE               
         BZ    WREXPRDX            IGNORE IF TABLE EMPTY                        
*                                                                               
         L     R3,PRDTBSRP+4       POINT TO FIRST RECORD IN TABLE               
         USING PRDTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R4,KEY              ESTABLISH RPRDKEY                            
         USING RPRDKEY,R4                                                       
*                                                                               
         MVC   AIO,REAIO1          READ INTO I/O AREA 1                         
*                                                                               
WREXPRDL DS    0H                                                               
*                                                                               
         MVC   RPRDKEY,PRDTKEY     SET TO KEY IN TABLE                          
*                                                                               
         CLC   RPRDKREP,REREP      IF REP CHANGES                               
         BE    *+8                                                              
         BRAS  RE,NEWREP              SET UP FOR NEW REP                        
*                                                                               
         GOTO1 HIGH                READ IN DIRECTORY POINTER                    
*                                                                               
         CLC   RPRDKEY,PRDTKEY     MATCH KEYS                                   
         BNE   WREXPRDC            RECORD NOT FOUND                             
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R6,AIO              POINT TO FOUND RECORD                        
*                                                                               
*        SAVE DECRIPTION ELEMENT                                                
*                                                                               
         LA    R6,34(R6)           POINT TO FIRST ELEMENT IN RECORD             
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R6)            GET ELEMENT LENGTH                           
*                                                                               
         CLI   0(R6),0             DONE AT END OF RECORD                        
         BE    WREXPRD1                                                         
         CLI   0(R6),X'01'         FIND DESCRIPTION ELEMENT                     
         BE    *+16                                                             
         IC    RF,1(R6)            GET ELEMENT LENGTH                           
         LA    R6,0(RF,R6)         BUMP TO NEXT ELEMENT                         
         B     *-24                                                             
*                                                                               
         MVC   PRDTELM,0(R6)       SAVE DESCRIPTION ELEMENT                     
*                                     NOT ALL USED                              
WREXPRD1 DS    0H                                                               
*                                                                               
WREXPRDC DS    0H                  NEXT DIRECTORY POINTER                       
*                                                                               
         A     R3,PRDTBSRP+12      POINT TO NEXT ENTRY IN TABLE                 
         BCT   R0,*+8              DECREMENT ENTRY COUNTER                      
         B     WREXPRDD            DONE                                         
*                                                                               
         B     WREXPRDL                                                         
*                                                                               
WREXPRDD DS    0H                  KEY FOUND                                    
*                                                                               
         OI    REPRCNTL,REPRCFLQ   ADV TABLE HAS BEEN FILLED                    
*                                                                               
WREXPRDX DS    0H                                                               
*                                                                               
         L     R2,GLAIFLD          R2=A(INPUT)                                  
         L     R3,GLAOFLD          R3=A(OUTPUT)                                 
*                                                                               
WREXPRDN DS    0H                                                               
*                                                                               
WREXAGY  DS    0H                                                               
*                                                                               
         TM    REAGCNTL,REAGCFLQ   SKIP IF AGY TABLE ALREADY FILLED             
         BO    WREXAGYN                                                         
*                                                                               
         TM    REAGCNTL,REAGCFTQ   SKIP IF AGY WAS FILTERED                     
         BO    WREXAGYN               TABLE WAS FILLED ON INPUT                 
*                                                                               
         TM    REAGCNTL,REAGCSRQ   SKIP IF AGY VALUES SORTED                    
         BO    WREXAGYN               TABLE WAS FILLED ON INPUT                 
*                                                                               
         ICM   R2,15,REAG2TBA      SKIP IF NO AGY TABLE PRESENT                 
         BZ    WREXAGYX                                                         
         USING AGYTTABD,R2         ESTABLISH AGY TABLE                          
*                                                                               
*        READ TABLE ENTRY                                                       
*        USE KEY TO READ IN RECORD                                              
*        FILL IN REMAINDER OF TABLE ENTRY FROM RECORD                           
*                                                                               
         ICM   R0,15,AGYTBSRP+8    GET NUMBER OF RECORDS IN TABLE               
         BZ    WREXAGYX            IGNORE IF TABLE EMPTY                        
*                                                                               
         L     R3,AGYTBSRP+4       POINT TO FIRST RECORD IN TABLE               
         USING AGYTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R4,KEY              ESTABLISH RAGY2KEY                           
         USING RAGY2KEY,R4                                                      
*                                                                               
         MVC   AIO,REAIO1          READ INTO I/O AREA 1                         
*                                                                               
WREXAGYL DS    0H                                                               
*                                                                               
         MVC   RAGY2KEY,AGYTKEY    SET TO KEY IN TABLE                          
*                                                                               
         CLC   RAGK2REP,REREP      IF REP CHANGES                               
         BE    *+8                                                              
         BRAS  RE,NEWREP              SET UP FOR NEW REP                        
*                                                                               
         GOTO1 HIGH                READ IN DIRECTORY POINTER                    
*                                                                               
         CLC   RAGY2KEY,AGYTKEY    MATCH KEYS                                   
         BNE   WREXAGYC            KEY NOT FOUND                                
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
         L     R4,REAIO1           POINT TO FOUND RECORD                        
         USING RAGY2REC,R4                                                      
*                                                                               
*        SAVE DATA FOR AGENCY                                                   
*                                                                               
         USING RAG2ELEM,R6         ESTABLISH AGENCY ELEMENT                     
*                                                                               
         MVI   ELCODE,X'1F'        FIND AGENCY DECRIPTION ELEMENT               
         LR    R6,R4               START OF RECORD                              
         BRAS  RE,GETEL                                                         
         BNE   *+14                ELEMENT NOT FOUND                            
         MVC   AGYTELM,RAG2ELEM    SAVE AGENCY ELEMENT                          
         MVI   AGYTELM+1,L'AGYTELM RESET ELEMENT LENGTH                         
*                                                                               
         USING RAGY2FXE,R6         ESTABLISH FAX ELEMENT                        
*                                                                               
         MVI   ELCODE,X'10'        FIND FAX ELEMENT                             
         LR    R6,R4                                                            
         BAS   RE,GETEL                                                         
         BNZ   *+14                ELEMENT NOT FOUND                            
         MVC   AGYTFAX,RAGY2FXE    SAVE FAX ELEMENT                             
         MVI   AGYTFAX+1,L'AGYTFAX RESET ELEMENT LENGTH                         
*                                                                               
         USING RAGY2AE1,R6         ESTABLISH ADDRESS ELEMENT                    
*                                                                               
         MVI   ELCODE,X'20'        FIND ADDRESS ELEMENT                         
         LR    R6,R4                                                            
         BAS   RE,GETEL                                                         
         BNZ   *+14                ELEMENT NOT FOUND                            
         MVC   AGYTEXAD,RAGY2AE1   SAVE ADDRESS ELEMENT                         
         MVI   AGYTEXAD+1,L'AGYTEXAD RESET ELEMENT LENGTH                       
*                                                                               
WREXAGYC DS    0H                  NEXT DIRECTORY POINTER                       
*                                                                               
         LA    R4,KEY              RESET KEY POINTER                            
*                                                                               
         A     R3,AGYTBSRP+12      POINT TO NEXT ENTRY IN TABLE                 
         BCT   R0,*+8              DECREMENT ENTRY COUNTER                      
         B     WREXAGYD            DONE                                         
*                                                                               
         B     WREXAGYL                                                         
*                                                                               
WREXAGYD DS    0H                  KEY FOUND                                    
*                                                                               
         OI    REAGCNTL,REAGCFLQ   AGY TABLE HAS BEEN FILLED                    
*                                                                               
WREXAGYX DS    0H                                                               
*                                                                               
         L     R2,GLAIFLD          R2=A(INPUT)                                  
         L     R3,GLAOFLD          R3=A(OUTPUT)                                 
*                                                                               
WREXAGYN DS    0H                                                               
*                                                                               
         MVC   OUTAREA,RESPACES    PRESET SOME FIELDS FOR OUTPUT                
*                                                                               
         TM    REQCFOPT,REQCFDPQ   IF PRINTING ONLY IF THERE IS DATA            
         BNO   WREXONDX               (DROP OPTION BEING USED)                  
*                                                                               
         CLI   SORTSW,C'P'         SKIP IF ALREADY PRINTING LINE                
         BE    WREXONDX                                                         
*                                                                               
         MVI   SORTSW,C'X'         INIT PRINT SWITCH TO SUPPRESS                
*                                                                               
WREXONDX DS    0H                                                               
*                                                                               
         CLC   GLLABEL,=CL8'NOREPORT' SKIP IF GRAND TOTALS                      
         BE    *+10                                                             
         LTR   R2,R2               SKIP IF NO INPUT AVAILABLE                   
         BZ    WREXOUTX                                                         
*                                                                               
         L     R1,GLADTENT         POINT TO DRIVE TABLE ENTRY                   
         USING DROD,R1             ESTABLISH AS OUTPUT ELEMENT                  
*                                                                               
         CLI   DROLTYP,C'N'        NO PRINT - NOT INTERESTED                    
         BE    WREXOUTX                                                         
*                                                                               
         MVC   MYPOSO,DROPOS       SAVE PRINT POSITION AND                      
         MVC   MYOLEN,DROLEN       OUTPUT AREA WIDTH                            
*                                                                               
         L     R1,GLATHID                                                       
         USING GLINTD,R1                                                        
*                                                                               
         CLC   GLLEVEL,GLDETLEV    CLEAR ACCUMULATORS IF LEVEL                  
         BNL   WREXECXS                 LOWER THAN DETAIL LEVEL                 
*                                                                               
*****    GOTO1 =A(CLEARCUM)        CLEAR ACCUMULATORS                           
*                                                                               
WREXECXS DS    0H                  POST ACCUMULATORS                            
*                                                                               
*****    GOTO1 =A(POSTCUM)         POST ACCUMULATORS                            
*                                                                               
         GOTO1 BLDLBLA             BUILD LABEL FROM HEADLINES                   
*                                                                               
WREXECGO DS    0H               ** BRANCH TO I/O ROUTINE **                     
*                                                                               
*        BECAUSE NOT ALL ROUTINES SAVE REGISTERS ON ENTRY                       
*        WE NEED SPECIAL CODE TO FORCE RETURN TO HERE                           
*                                                                               
         LA    RE,WREXORET         POINT TO RETURN POINT                        
WREXOSAV NTR1                      SAVE CURRENT REGISTERS                       
*                                                                               
         L     RF,GLAROUT       ** BRANCH TO I/O ROUTINE **                     
         BASR  RE,RF                                                            
*                               ROUTINES THAT SAVE REGS RETURN HERE             
         XIT1                   UNSAVE REGISTERS                                
*                                                                               
WREXORET DS    0H                  EVERYONE WINDS UP HERE                       
*                                                                               
*        CHECK IF PRINTING TO BE SUPPRESSED IF THIS KEYWORD HAS NO              
*        DATA TO PRINT                                                          
*                                                                               
         TM    REQCFOPT,REQCFDPQ   SKIP IF DROP OPTION NOT BEING USED           
         BNO   WREXDRPX               SOMEWHERE                                 
*                                                                               
         CLI   SORTSW,C'P'         SKIP IF ALREADY PRINTING LINE                
         BE    WREXDRPX                                                         
*                                                                               
*        CHECK IF THIS IS ONE OF THE KEYWORDS                                   
*                                                                               
         L     RF,=A(WREXDPTB)     POINT TO DROP PROCESSING TABLE               
         LA    R0,WREXDTMQ         MAX NUMBER OF ENTRIES IN TABLE               
*                                                                               
WREXDPLP DS    0H                                                               
*                                                                               
         CLI   WREXDTKY-WREXDPTB(RF),0 DONE CHECKING AT END OF TABLE            
         BE    WREXDPDN                                                         
*                                                                               
         CLC   GLARGS+6(1),WREXDTKY-WREXDPTB(RF)  IS THIS ONE OF THE            
         BE    WREXDPFD                KEYWORDS?                                
*                                                                               
WREXDPCN DS    0H                                                               
         LA    RF,WREXDTLQ(RF)     BUMP TO NEXT TABLE ENTRY                     
         BCT   R0,WREXDPLP                                                      
*                                                                               
WREXDPDN DS    0H                                                               
*                                                                               
         B     WREXDRPX            NOT IN TABLE - DON'T CHECK FOR DATA          
*                                                                               
WREXDPFD DS    0H                  KEYWORD USING DROP OPTION                    
*                                                                               
         CLI   GLHOOK,GLEDIT       SKIP IF DRIVER NOT DOING EDIT                
         BNE   WREXDEDN                                                         
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,WREXDTRP-WREXDPTB(RF)   NUMBER OF REPETIONS                 
         BZ    WREXDRPX            IGNORE                                       
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,WREXDTLN-WREXDPTB(RF)   FIELD LENGTH                        
         BZ    WREXDRPX            IGNORE                                       
*                                                                               
         BCTR  RE,0                DECREMENT FOR EXECUTE                        
*                                                                               
*        TEST FOR DATA TO BE EDITTED BY DRIVER                                  
*                                                                               
WREXDATL DS    0H                                                               
*                                                                               
         CLI   WREXDTTP-WREXDPTB(RF),C'P' IF PACKED DATA                        
         BNE   WREXDAT1                                                         
*                                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         OC    0(0,R2),0(R2)       DATA MUST BE NON NULLS                       
         BZ    WREXDATC                                                         
*                                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         CP    =P'0',0(0,R2)       DATA MUST BE NE ZERO                         
         BNE   WREXDATF                                                         
         B     WREXDATC            ELSE CHECK NEXT REPETION                     
*                                                                               
WREXDAT1 DS    0H                                                               
*                                                                               
         CLI   WREXDTTP-WREXDPTB(RF),C'C' IF CHARACTER DATA                     
         BNE   WREXDAT2                                                         
*                                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R2),RESPACES       DATA MUST BE GT SPACES                    
         BH    WREXDATF                                                         
         B     WREXDATC            ELSE CHECK NEXT REPETION                     
*                                                                               
WREXDAT2 DS    0H                  ELSE DATA ID BINARY OR HEX                   
*                                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         OC    0(0,R2),0(R2)       DATA MUST BE NON NULLS                       
         BNZ   WREXDATF                                                         
*                                                                               
WREXDATC DS    0H                                                               
         LA    RF,WREXDTLQ(RF)     BUMP TO NEXT REPETITION                      
         BCT   R0,WREXDATL                                                      
         B     WREXDATD            NO DATA TO EDIT OR PRINT                     
*                                                                               
WREXDATF DS    0H                  DATA TO BE PRINTED                           
*                                                                               
         B     WREXDRPR            PRINT LINE                                   
*                                                                               
WREXDATD DS    0H                                                               
*                                                                               
         B     WREXDRPX            DON'T CHANGE PRINTING STATUS                 
*                                                                               
*        WE FORMATTED THE OUTPUT - CHECK IF ANYTHING TO PRINT                   
*                                                                               
WREXDEDN DS    0H                  WE FORMATTED OUTPUT                          
*                                                                               
         L     R1,GLADTENT         POINT TO DRIVE TABLE ENTRY                   
         USING DROD,R1             ESTABLISH AS OUTPUT ELEMENT                  
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DROLEN         OUTPUT LENGTH                                
         BZ    WREXDRPX            SKIP IF NOTHING PRINTED                      
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),RESPACES    CHECKS FOR PRINTED OUTPUT                    
         BNH   WREXDRPX            NOTHING PRINTED                              
*                                                                               
WREXDRPR DS    0H                                                               
*                                                                               
         MVI   SORTSW,C'P'         SOMETHING PRINTED - FORCE PRINTING           
*                                                                               
WREXDRPX DS    0H                                                               
*                                                                               
*        CHECK IF THIS FIELD IS BEING COUNTED                                   
*                                                                               
         TM    REQCFOPT,REQCFCTQ   SKIP IF NO FIELD BEING COUNTED               
         BNO   WREXECO2                                                         
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQWRCFL),(2,=AL2(RKQCFCT)),0                 
*                                                                               
         OC    8(4,R1),8(R1)                                                    
         BZ    WREXECO2            NO COUNTING                                  
*                                                                               
         GOTO1 =A(COUNT)           GO PROCESS COUNT FUNCTION                    
*                                  IN PRWRICFL                                  
*                                                                               
WREXECO2 DS    0H                                                               
*                                                                               
WREXOUTX DS    0H                                                               
*                                                                               
WREXECX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         DROP  R1                                                               
*                                                                               
*        TABLE OF KEYWORD INPUT CHARACTERISTICS                                 
*              USED FOR DROP/SUPPRESS OPTION                                    
*                                                                               
WREXDTBC DS    XL1                 DROP TABLE CONTROL BYTE                      
WREXDCFQ EQU   X'80'               TABLE FILLED                                 
*                                                                               
WREXDPTB DS    0D                                                               
WREXDTKY DS    XL1                 KEYWORD NUMBER                               
WREXDTLN DS    XL1                 INPUT LENGTH                                 
WREXDTRP DS    XL1                 NUMBER OF REPETITIONSS                       
WREXDTTP DS    XL2                 INPUT TYPE - P,C,X,B                         
WREXDTLQ EQU   *-WREXDPTB          TABLE ENTRY LENGTH                           
WREXDTMQ EQU   32                  MAXIMUM NUMBER OF ENTRIES IN TABLE           
*                                                                               
         DS    (WREXDTMQ-1)XL(WREXDTLQ)  REST OF TABLE                          
*                                                                               
         TITLE 'RENWRTER - PUT RECORD TO SORT - PUTSRT'                         
***********************************************************************         
*                                                                     *         
*        DRIVER ABOUT TO PASS RECORD TO SORT                          *         
*                                                                     *         
* NTRY   SORTSW  - C'N' OR C'D' - DROP RECORD FROM SORT               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
WRPUTSRT DS    0H                                                               
*                                                                               
         TM    STACKSW,STACKYQ+STCKINIQ   DROP IF STACKING AND INIT SW          
         BO    WRPTSRT1                      STILL ON                           
*                                                                               
WRPTSRT0 DS    0H                                                               
*                                                                               
         CLI   SORTSW,C'N'         IF SORT SWITCH IS ON                         
         BE    *+8                                                              
         CLI   SORTSW,C'D'         IF SORT SWITCH IS ON                         
         BNE   WRPTSRTX                                                         
*                                                                               
WRPTSRT1 DS    0H                                                               
*                                                                               
         MVI   GLHOOK,GLDONT          DON'T PUT RECORD TO SORT                  
         MVI   SORTSW,C'D'            INDICATE A DELETION DONE                  
*                                                                               
*        NEED THIS TRICK BECAUSE DRIVER ADDS EXTRA RECORD FOR EACH              
*        LEVEL OF TOTALLING AND SO NEED TO DELETE SEVERAL RECORDS BUT           
*        ALSO NEED TO KNOW WHEN TO RESET SWITCH. SINCE ALL RECORDS ARE          
*        ADDED CONSECUTIVELY WITHOUT INVOKING ANY OF OUR ROUTINES               
*        WE SHOULD BE SAFE IN RESETTING WHEN NEXT EXECUTED ROUTINE              
*        SEES A C'D' AS SWITCH VALUE.                                           
*                                                                               
WRPTSRTX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'REWRITER - ABOUT TO PRINT A LINE - WRPRNTLN'                    
***********************************************************************         
*                                                                     *         
*        DRIVER ABOUT TO PRINT A LINE                                 *         
*                                                                     *         
* NTRY   SORTSW  - C'X' DON'T PRINT THE LINE                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
WRPRNTLN DS    0H                                                               
*                                                                               
         CLI   SORTSW,C'X'         IF NO PRINT SWITCH IS ON                     
         BNE   *+8                                                              
         MVI   GLHOOK,GLDONT          DON'T PRINT LINE                          
*                                                                               
         MVI   SORTSW,0            CLEAR SWITCH                                 
*                                                                               
WRPRNTLX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - ROUTS'                     
***********************************************************************         
*                                                                     *         
*              COMPUTE ROUTINES                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 3                                                                
ICOMPUTE ZAP   0(8,R2),=P'0'       ZERO OUT                                     
         XIT1                                                                   
*                                                                               
OCOMPUTE L     R1,GLATHID                                                       
         USING GLINTD,R1                                                        
*                                                                               
         CLC   GLLEVEL,GLDETLEV                                                 
         BE    OCOMPOK                 ONLY PRINT WHEN DETAIL                   
*                                                                               
         TM    GLARGS+11,X'80'     NO TOTAL TO PRINT                            
         BO    OCOMPX                                                           
*                                                                               
OCOMPOK  MVI   GLHOOK,GLEDIT       COMPUTE                                      
OCOMPX   XIT1                                                                   
*                                                                               
GENOUT   DS    0H                                                               
         GOTO1 GENOUTA                                                          
         XIT1                                                                   
         EJECT                                                                  
*              ODDMENTS                                                         
*                                                                               
XIT      XIT1                                                                   
*                                                                               
         GETEL (R6),DATADISP,ELCODE                                             
         EJECT                                                                  
*              LTORG ETC                                                        
*                                                                               
       ++INCLUDE DEDBLOCK                                                       
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
         TITLE 'RENWRTER - T00AAA - WRITER FOR REP - ROUTLIST'                  
***********************************************************************         
*                                                                     *         
*              ROUTINE ADDRESS LOOK-UP TABLE                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ROUTLIST DS    0F                                                               
*                                                                               
*        NEW ROUTINES                                                           
*                                                                               
         DC    C'OADR    '         GENERIC ADDRESS ROUTINE                      
         DC    A(OADR)                                                          
*                                                                               
         DC    C'IAGY    '         AGENCY RECORD DATA                           
         DC    A(IAGY)                                                          
*                                                                               
         DC    C'IBCD    '         BUY CODE DATA                                
         DC    A(IBCD)                                                          
*                                                                               
         DC    C'OBCD    '         BUY CODE DATA                                
         DC    A(OBCD)                                                          
*                                                                               
         DC    C'IBIT    '         TEST IF BIT ON OR OFF                        
         DC    A(IBIT)                                                          
*                                                                               
         DC    C'IBUD    '         BUDGET DOLLARS                               
         DC    A(IBUD)                                                          
*                                                                               
         DC    C'ICTG    '         CATEGORY INPUT                               
         DC    A(ICTG)                                                          
*                                                                               
         DC    C'ICLS    '         CLASS    INPUT                               
         DC    A(ICLS)                                                          
*                                                                               
         DC    C'ICOMBO  '         COMBO CALL LETTERS                           
         DC    A(ICOMBO)                                                        
*                                                                               
         DC    C'ICOMM   '         COMMENTS                                     
         DC    A(ICOMM)                                                         
         DC    C'OCOMM   '                                                      
         DC    A(OCOMM)                                                         
*                                                                               
         DC    C'ICOMRTE '         COMMISSION RATE                              
         DC    A(ICOMRTE)                                                       
         DC    C'OCOMRTE '                                                      
         DC    A(OCOMRTE)                                                       
*                                                                               
         DC    C'ICON    '         CONTRACT RECORD DATA SOURCE                  
         DC    A(ICON)                                                          
*                                                                               
         DC    C'OCON    '         CONTRACT NUMBER PRINT                        
         DC    A(OCON)                                                          
*                                                                               
         DC    C'ICTY    '         CONTRACT TYPE                                
         DC    A(ICTY)                                                          
*                                                                               
         DC    C'ICST    '         COMPETITVE STATIONS DATA                     
         DC    A(ICST)                                                          
         DC    C'OCST    '         COMPETITVE STATIONS DATA                     
         DC    A(OCST)                                                          
*                                                                               
         DC    C'ODATE   '         GENERALIZED DATE OUTPUT ROUTINE              
         DC    A(ODATE)                                                         
*                                                                               
         DC    C'IDEV    '         CONTRACT DEVELOPMENTAL ELEMENT               
         DC    A(IDEV)                                                          
*                                                                               
         DC    C'IDOL    '         GENERALIZED CONTRACT DOLLARS ROUTINE         
         DC    A(IDOL)                                                          
         DC    C'ODOL    '         GENERALIZED CONTRACT DOLLARS ROUTINE         
         DC    A(ODOL)                                                          
*                                                                               
         DC    C'IDUMMY  '         DUMMY INPUT  ROUTINE                         
         DC    A(IDUMMY)                                                        
         DC    C'ODUMMY  '         DUMMY OUTPUT ROUTINE                         
         DC    A(ODUMMY)                                                        
*                                                                               
         DC    C'IELM    '         GENERALIZED INPUT FROM AN ELEMENT            
         DC    A(IELM)                                                          
*                                                                               
         DC    C'IID     '         GENERALIZED INPUT FOR CODE AND NAME          
         DC    A(IID)                                                           
         DC    C'OID     '         GENERALIZED OUTPUT FOR CODE AND NAME         
         DC    A(OID)                                                           
*                                                                               
         DC    C'ODATA   '         GENERALIZED OUTPUT                           
         DC    A(ODATA)                                                         
*                                                                               
         DC    C'IMKT    '         MARKET                                       
         DC    A(IMKT)                                                          
         DC    C'OMKT    '                                                      
         DC    A(OMKT)                                                          
*                                                                               
         DC    C'IMREP   '         MASTER REP                                   
         DC    A(IMREP)                                                         
*                                                                               
         DC    C'ONUM    '         PRINT NUMBER                                 
         DC    A(ONUM)                                                          
*                                                                               
         DC    C'IOWN    '         OWNER                                        
         DC    A(IOWN)                                                          
         DC    C'OOWN    '                                                      
         DC    A(OOWN)                                                          
*                                                                               
         DC    C'IPAC    '         PACING                                       
         DC    A(IPAC)                                                          
         DC    C'OPAC    '                                                      
         DC    A(OPAC)                                                          
*                                                                               
         DC    C'OPC     '         PER CENT TO FINAL/BUDGET                     
         DC    A(OPC)                                                           
*                                                                               
         DC    C'IPER    '         PERIOD                                       
         DC    A(IPER)                                                          
         DC    C'OPER    '                                                      
         DC    A(OPER)                                                          
*                                                                               
         DC    C'IPND    '         CONTRACT PENDING SCREEN                      
         DC    A(IPND)                                                          
         DC    C'OPND    '                                                      
         DC    A(OPND)                                                          
*                                                                               
         DC    C'IPTP    '         POINT PERSON                                 
         DC    A(IPTP)                                                          
*                                                                               
         DC    C'IPRD    '         PRODUCT                                      
         DC    A(IPRD)                                                          
         DC    C'OPRD    '                                                      
         DC    A(OPRD)                                                          
*                                                                               
         DC    C'IPWC    '         PAPERWORK COUNTING RECORD                    
         DC    A(IPWC)                                                          
*                                                                               
         DC    C'IREG    '         REGION                                       
         DC    A(IREG)                                                          
*                                                                               
         DC    C'IRRG    '         RGON DATA ROUTINES                           
         DC    A(IRRG)                                                          
         DC    C'ORRG    '                                                      
         DC    A(ORRG)                                                          
*                                                                               
         DC    C'ISAL    '         SALESPERSON                                  
         DC    A(ISAL)                                                          
*                                                                               
         DC    C'ITEM    '         DIV+TEAM                                     
         DC    A(ITEM)                                                          
*                                                                               
         DC    C'ISTA    '         STATION                                      
         DC    A(ISTA)                                                          
         DC    C'OSTA    '                                                      
         DC    A(OSTA)                                                          
         DC    C'HSTA    '                                                      
         DC    A(HSTA)                                                          
*                                                                               
         DC    C'OSTAFAX '         STATION FAX NUMBER                           
         DC    A(OSTAFAX)                                                       
*                                                                               
         DC    C'ISTACK  '         STACKING - INPUT                             
         DC    A(ISTACK)                                                        
*                                                                               
         DC    C'XSTACK  '         STACKING - OUTPUT                            
         DC    A(XSTACK)                                                        
*                                                                               
         DC    C'OTEL    '         TELEPHONE NUMBER                             
         DC    A(OTEL)                                                          
*                                                                               
         DC    C'ITER    '         TERRITORY                                    
         DC    A(ITER)                                                          
*                                                                               
         DC    C'NOREPORT'         GRAND TOTAL LABEL ROUTINE                    
         DC    A(NOREPORT)                                                      
*                                                                               
         DC    C'ICOMPUTE',A(ICOMPUTE)    COMPUTE RTNS                          
         DC    C'OCOMPUTE',A(OCOMPUTE)                                          
*                                                                               
*MN                                                                             
         DC    C'ODARE   '         DARE ORDER#/STATUS                           
         DC    A(ODARE)                                                         
*                                                                               
         DC    C'OCPE    '         ADV/PRD1/PRD2/EST                            
         DC    A(OCPE)                                                          
*                                                                               
         DC    C'OINBOX  '         INBOX                                        
         DC    A(OINBOX)                                                        
*                                                                               
         DC    C'OMGO    '         MGO                                          
         DC    A(OMGO)                                                          
*MN                                                                             
*                                                                               
         DC    X'FF'                                                            
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - NEW REP ROUTINE - NEWREP'                            
***********************************************************************         
*                                                                     *         
*        SET UP TO READ RECORDS FROM A NEW REP'S FILES                *         
*                                                                     *         
* NTRY   R4==>  KEY TO BE READ                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
NEWREP   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   0(R4),RADVKTYQ      POINT TO REP DEPENDING ON KEY TYPE           
         JNE   *+8                                                              
         LA    R5,RADVKREP-RADVKEY(R4) ADV KEY                                  
*                                                                               
         CLI   0(R4),RPRDKTYQ      POINT TO REP DEPENDING ON KEY TYPE           
         JNE   *+8                                                              
         LA    R5,RPRDKREP-RPRDKEY(R4) PRD KEY                                  
*                                                                               
         CLI   0(R4),RAGYKTYQ      POINT TO REP DEPENDING ON KEY TYPE           
         JNE   *+8                                                              
         LA    R5,RAGYKREP-RAGYKEY(R4) AGY KEY                                  
*                                                                               
         CLI   0(R4),RRDPKTYQ      POINT TO REP DEPENDING ON KEY TYPE           
         JNE   *+8                                                              
         LA    R5,RRDPKREP-RRDPKEY(R4) DAYPART KEY                              
*                                                                               
         CLI   0(R4),RSTAKTYQ      POINT TO REP DEPENDING ON KEY TYPE           
         JNE   *+8                                                              
         LA    R5,RSTAKREP-RSTAKEY(R4) STATION KEY                              
*                                                                               
         ICM   R2,15,REREPTBA      POINT TO REP TABLE                           
         JZ    NEWREPX             SKIP IF NOT PRESENT                          
         USING REPTTABD,R2         ESTABLISH TABLE                              
*                                                                               
         LA    R3,REPTTAB          USE 1ST TABLE ENTRY TO CONTRUCT KEY          
         USING REPTENT,R3                                                       
*                                                                               
         LA    R4,REPTKEY          ESTABLISH REP KEY                            
         USING RREPKEY,R4                                                       
         XC    RREPKEY,RREPKEY     INIT KEY                                     
*                                                                               
         MVI   RREPKTYP,RREPKTYQ   SET RECORD TYPE                              
         MVC   RREPKREP,0(R5)      SET REP                                      
*                                                                               
         GOTO1 BINSRCH,REPTBSRP,('BSPFIND',RREPKEY)  FIND REP IN TABLE          
*                                                                               
         CLI   BSPCNTL-BSPPRMS+REPTBSRP,BSPNF  SKIP IF NOT FOUND                
         JE    NEWREPX                                                          
*                                                                               
         ICM   R3,15,BSPAREC-BSPPRMS+REPTBSRP POINT TO FOUND ENTRY              
         JZ    NEWREPX             SKIP IF NOT FOUND                            
*                                                                               
         MVC   REREP,RREPKREP-RREPKEY+REPTKEY   SET TO NEW REP                  
*                                                                               
         ICM   RF,15,REUTLA        POINT TO UTLS                                
         JZ    *+10                ADDRESS NOT FOUND                            
         MVC   4(1,RF),REPTSE      SET NEW SE NUMBER                            
*                                                                               
NEWREPX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - FIND CORRECT REP - SETREP'                           
***********************************************************************         
*                                                                     *         
*        SET CORRECT REP IN KEY FOR RECORD TYPE                       *         
*                                                                     *         
*        GLARGS AL1(RECORD ID)                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
SETREP   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   REDMREP,REREP       DEFAULT TO CURRENT REP                       
*                                                                               
         OC    REMREP,REMREP       DONE IF NO MASTER REP KNOWN                  
         BZ    SETREPX                                                          
*                                                                               
         TM    REKYWTYP,REKYREPQ   IF REP IN REQUEST                            
         BO    STRPREPX                                                         
*                                                                               
         MVC   REDMREP,REMREP         USE IT INSTEAD                            
*                                                                               
         B     SETREPX                                                          
*                                                                               
STRPREPX DS    0H                                                               
*                                                                               
         L     R1,=A(INTEREP)      POINT TO REP TRANSLATION TAB                 
*                                                                               
STRPLOOP DS    0H                                                               
*                                                                               
         CLI   RTABID(R1),0        DONE AT END OF TABLE                         
         BE    STRPDONE                                                         
*                                                                               
         CLC   REREP,RTABSUB(R1)   MATCH ON SUBSIDIARY REP                      
         BNE   STRPCONT                                                         
*                                                                               
         CLC   RTABID(1,R1),GLARGS MATCH ON RECORD TYPE                         
         BE    STRPFND                                                          
*                                                                               
STRPCONT DS    0H                                                               
*                                                                               
         LA    R1,RTABELEN(R1)     BUMP TO NEXT TABLE ENTRY                     
         B     STRPLOOP                                                         
*                                                                               
STRPFND  DS    0H                                                               
*                                                                               
         MVC   REDMREP,RTABMAST(R1)  SAVE DATAMGR REP                           
*                                                                               
STRPDONE DS    0H                                                               
*                                                                               
SETREPX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
*                                                                               
         TITLE 'RENWRTER - PRINT ADDRESS KEYWORD - OADR'                        
***********************************************************************         
*                                                                     *         
*        ROUTINE TO HANDLE KEYWORDS BASED ON AN ID AND ADDRESS        *         
*                                                                     *         
*             DATA FOUND IN TABLES                                    *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*                                                                     *         
*NTRY    R2==>  CODE                                                  *         
*                                                                     *         
*EXIT                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OADR     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        SEARCH TABLE TO FIND WHERE DATA TO BE FOUND                            
*                                                                               
         L     R4,=A(IDTAB)        TABLE OF IDS AND SOURCES                     
         USING IDENTD,R4           ESTABLISH A TABLE ENTRY                      
*                                                                               
         CLI   0(R4),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    OADRX                                                            
         CLC   GLARGS(1),IDRECID   MATCH DATA TYPES                             
         BE    *+12                                                             
         LA    R4,IDENTL(R4)       BUMP TO NEXT ENTRY IN TABLE                  
         B     *-22                                                             
*                                                                               
*        TABLE FORMAT   RECORD ID OF WHERE DATA LOCATED,A(LOOKUP TABLE)         
*                       IELM PARAMETERS FOR CODE                                
*                       IELM PARAMETERS FOR NAME                                
*                       ACTUAL LENGTH OF NAME                                   
*                                                                               
         LA    R1,0(R2)            POINT TO DRIVER INPUT                        
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCDELN          CODE LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R2),RESPACES    SKIP IF NO CODE                              
         BNH   OADRX                                                            
*                                                                               
*        USING CODE FIND ENTRY IN LOOK UP TABLE AND PRINT                       
*                                                                               
         SR    R8,R8                                                            
         ICM   R8,7,IDLKUPTA       POINT TO LOOK UP TABLE                       
         BZ    OADRX               SKIP IF TABLE ADDRESS NOT FOUND              
*                                                                               
*        USING CODE FIND ENTRY IN LOOKUP TABLE                                  
*        R1 ==> CODE                                                            
*        RF =   EXECUTE LENGTH OF CODE                                          
*                                                                               
         LA    R8,RENWRIOD(R8)     RE-LOCATE ADDRESS                            
*                                                                               
         ICM   R8,15,0(R8)         POINT TO TABLE                               
         BZ    OADRX                 NONE AVAILABLE                             
*                                                                               
         CLI   GLARGS,RAG2KTYQ     SKIP IF AGENCY ADDRESS                       
         BE    OADRAGY                                                          
*                                                                               
         USING STDTTABD,R8         ESTABLISH TABLE PARAMETERS                   
*                                                                               
         ST    R7,OADRR7SV         SAVE DSECT POINTER                           
*                                                                               
         LM    R5,R7,STDTBXLE      LOAD BXLE REGISTERS FOR TABLE                
         USING STDTENT,R5          ESTABLISH TABLE ENTRY                        
*                                                                               
         SR    R0,R0                                                            
         IC    R0,IDCDEDSP         DISP OF CODE IN KEY OR ELEMENT               
*                                                                               
OADRNTLP DS    0H                                                               
*                                                                               
         LA    RE,STDTKEY          CODE IN KEY                                  
*                                                                               
         AR    RE,R0               POINT TO CODE IN TABLE ENTRY                 
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R1),0(RE)       MATCH CODE TO TABLE ENTRY                    
         BE    OADRNTFD                                                         
*                                                                               
OADRNTCN DS    0H                                                               
*                                                                               
         BXLE  R5,R6,OADRNTLP      BUMP TO NEXT TABLE ENTRY                     
*                                                                               
OADRNTDN DS    0H                                                               
*                                                                               
         L     R7,OADRR7SV         RESTORE DSECT POINTER                        
*                                                                               
         B     OADRX               NO TABLE ENTRY FOUND                         
*                                                                               
OADRNTFD DS    0D                                                               
*                                                                               
         L     R7,OADRR7SV         RESTORE DSECT POINTER                        
*                                                                               
*        PRINT ADDRESS                                                          
*                                                                               
         LA    R1,STDTELM          USE STORED ELEMENT                           
*                                                                               
         B     OADRAGYN                                                         
*                                                                               
*        FIND AGENCY IN TABLE                                                   
*                                                                               
OADRAGY  DS    0H                                                               
*                                                                               
         USING AGYTTABD,R8         ESTABLISH AGENCY TABLE                       
*                                                                               
         XC    AGYTKEY,AGYTKEY                                                  
         LA    R6,AGYTKEY          BUILD SEARCH KEY                             
         USING RAGY2KEY,R6                                                      
*                                                                               
         MVC   RAGK2TYP(1),GLARGS  RECORD TYPE                                  
         MVC   RAGK2AGY(8),0(R2)   AGY/AOF/REP FROM INPUT                       
*                                                                               
         GOTO1 BINSRCH,AGYTBSRP,('BSPFIND',AGYTKEY)   FIND ENTRY                
*                                                                               
         CLI   BSPCNTL-BSPPRMS+AGYTBSRP,BSPNF DONE IF NOT FOUND                 
         BE    OADRAGYX                                                         
*                                                                               
         ICM   R5,15,BSPAREC-BSPPRMS+AGYTBSRP POINT TO ENTRY                    
         BZ    OADRAGYX            NOTHING FOUND                                
*                                                                               
         USING AGYTENT,R5          ESTABLISH TABLE ENTRY                        
*                                                                               
         CLI   GLARGS+2,C'M'       IF MAILING ADDRESS                           
         BNE   OADRAGNX               PRINT NAME                                
*                                                                               
         MVC   0(L'RAG2NAM2,R3),RAG2NAM2-RAG2ELEM+AGYTELM                       
*                                                                               
         CLC   0(L'RAG2NAM2,R3),RESPACES  IF NO CONTRACT ADDRESS                
         BH    *+10                          USE SCREEN NAME                    
         MVC   0(L'RAG2NAM1,R3),RAG2NAM1-RAG2ELEM+AGYTELM                       
*                                                                               
         LA    R3,198(R3)             BUMP TO NEXT PRINT LINE                   
*                                                                               
OADRAGNX DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,MYOLEN           OUTPUT LENGTH                                
*                                                                               
         CHI   RF,L'RAGY2AD1       CAN'T EXCEED DATA LENGTH                     
         BNH   *+8                                                              
         LHI   RF,L'RAGY2AD1                                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         CLI   GLARGS+2,C'2'       SKIP IF ADDRESS LINE 2 ONLY                  
         BE    *+22                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),RAGY2AD1-RAGY2AE1+AGYTEXAD  ADDR LINE 1                  
         LA    R3,198(R3)             BUMP TO NEXT PRINT LINE                   
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   RAGY2AD2-RAGY2AE1+AGYTEXAD,RESPACES  SKIP IF NO LINE 2           
         BNH   OADR2LNX                                                         
*                                                                               
         CLI   GLARGS+2,C'1'       SKIP IF ADDRESS LINE 1 ONLY                  
         BE    *+22                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),RAGY2AD2-RAGY2AE1+AGYTEXAD  ADDR LINE 2                  
         LA    R3,198(R3)             BUMP TO NEXT PRINT LINE                   
*                                                                               
OADR2LNX DS    0H                                                               
*                                                                               
         CLI   GLARGS+2,C'1'       SKIP IF LINES 1 OR 2 WANTED                  
         BE    *+8                                                              
         CLI   GLARGS+2,C'2'                                                    
         BE    OADRCTYX                                                         
*                                  SKIP IF NO STATE TO PRINT                    
         CLC   RAGY2STE-RAGY2AE1+AGYTEXAD,RESPACES                              
         BNH   OADRCTYX                                                         
*                                                                               
         MVC   0(20,R3),RAGY2CTY-RAGY2AE1+AGYTEXAD CITY                         
*                                                                               
         MVC   21(2,R3),RAGY2STE-RAGY2AE1+AGYTEXAD STATE                        
*                                                                               
         MVC   24(10,R3),RAGY2ZIP-RAGY2AE1+AGYTEXAD ZIP CODE                    
*                                                                               
OADRCTYX DS    0H                                                               
*                                                                               
OADRAGYX DS    0H                                                               
         B     OADRX                                                            
*                                                                               
         DROP  R5                                                               
*                                                                               
OADRAGYN DS    0H                                                               
*                                                                               
*        OFFICE ADDRESS                                                         
*                                                                               
         CLI   GLARGS,ROFFKTYQ     SKIP IF NOT OFFICE ADDRESS                   
         BNE   OADROFFN                                                         
*                                                                               
         USING ROFFELEM,R1         ESTABLISH AGENCY ELEMENT                     
*                                                                               
         SR    RF,RF                                                            
         IC    RF,MYOLEN           OUTPUT LENGTH                                
*                                                                               
         CLM   RF,1,=AL1(L'ROFFADD1) CAN'T EXCEED DATA LENGTH                   
         BNH   *+8                                                              
         ICM   RF,1,=AL1(L'ROFFADD1)                                            
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         OC    ROFFADD1,RESPACES                                                
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),ROFFADD1    LINE 1 OF ADDRESS                            
*                                                                               
         OC    ROFFADD2,RESPACES                                                
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   198(0,R3),ROFFADD2  LINE 2 OF ADDRESS                            
*                                                                               
         OC    ROFFSTT,RESPACES                                                 
*                                                                               
         MVC   2*198(2,R3),ROFFSTT   STATE                                      
*                                                                               
         OC    ROFFZIP,RESPACES                                                 
*                                                                               
         MVC   2*198+4(10,R3),ROFFZIP  ZIP CODE                                 
*                                                                               
         B     OADRX                                                            
*                                                                               
OADROFFN DS    0H                                                               
*                                                                               
OADRX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
OADRR7SV DS    F                   DSECT POINTER SAVEAREA                       
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - AGENCY - IAGY'                               
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT DATA      FROM AGENCY RECORD              *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IELM                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IAGY     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ICM   R3,15,REAG2TA       POINT TO CURRENT AG2TAB ENTRY                
         BZ    IAGYX               NONE AVAILABLE                               
         USING AGYTENT,R3          ESTABLISH AGYTAB ENTRY                       
*                                                                               
         CLI   GLARGS+1,RAGY2CDQ   MUST BE LOOKING IN FAX ELEMENT               
         BNE   IAGYX                                                            
*                                                                               
         LA    R1,AGYTFAX          POINT TO FAX ELEMENT                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+2         GET DISPLACEMENT TO DATA                     
         LA    R1,0(RF,R1)         POINT TO DATA                                
*                                                                               
         ICM   RF,1,GLARGS+3       DATA LENGTH                                  
         BZ    IAGYX               NONE WANTED                                  
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R1)       PAST DATA TO DRIVER                          
*                                                                               
IAGYX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - EXTRACT GENERIC ELEMENT DATA - IBCD'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT BUY CODES                                   *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = C'B' - BUY CODE                                   *         
*                   C'1' - BUY TYPE 1                                 *         
*                   C'2' - BUY TYPE 2                                 *         
*        GLARGS+2 = C'B' - BOTH CODE AND DESCRIPTION                  *         
*                   C'C' - CODE ONLY                                  *         
*                   C'N' - DESCRIPTION - SORTED BY CODE               *         
*                   C'C' - DESCRIPTION - SORTED BY DESCRIPTION        *         
*                                                                     *         
*        R2==>  DRIVER INPUT AREA                                     *         
*                                                                     *         
*EXIT   0-?    -  DATA                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IBCD     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+1,C'B'       IF BUY CODE                                  
         BNE   IBCDBCDN                                                         
*                                                                               
         LR    R1,R2               ASSUME NOT SORTING BY DESCRIPTION            
*                                                                               
         CLI   GLARGS+2,C'A'       IF SORTING BY DESC                           
         BNE   *+8                                                              
         LA    R1,L'REBCD+L'RSPBDESC(R1)    POINT TO END OF RETURN AREA         
*                                                                               
         MVC   0(L'REBCD,R1),REBCD    RETURN CODE                               
*                                                                               
         CLI   GLARGS+2,C'A'       IF NOT SORTING BY DESC                       
         BNE   IBCDX                  DONE                                      
*                                                                               
         ICM   R6,15,REBCDTA       POINT TO BCD TABLE ENTRY                     
         BZ    IBCDX                  NONE AVAILABLE                            
*                                                                               
         USING BCDTENT,R6          ESTABLSIH TABLE ENTRY                        
*                                                                               
         LA    RF,BCDTELM          POINT TO ELEMENT                             
         USING RSPBELEM,RF         ESTABLSIH ELEMENT                            
*                                                                               
         MVC   L'REBCD(L'RSPBDESC,R2),RSPBDESC  RETURN DESC                     
*                                                                               
         B     IBCDX                                                            
*                                                                               
         DROP  RF                                                               
*                                                                               
IBCDBCDN DS    0H                  BUY TYPES                                    
*                                                                               
         LA    R3,REBT1            ASSUME BUY TYPE 1                            
         ICM   R6,15,REBT1TA       POINT TO TABLE ENTRY                         
*                                                                               
         CLI   GLARGS+1,C'1'       IF NOT BUY TYPE 1 MUST BE BUY TYPE 2         
         BE    *+12                                                             
         LA    R3,REBT2               POINT TO BUY TYPE 2                       
         ICM   R6,15,REBT2TA          POINT TO TABLE ENTRY                      
                                                                                
         LR    R1,R2               ASSUME NOT SORTING BY DESCRIPTION            
*                                                                               
         CLI   GLARGS+2,C'A'       IF SORTING BY DESC                           
         BNE   *+8                                                              
         LA    R1,L'REBT1+L'RSPBDESC(R1)    POINT TO END OF RETURN AREA         
*                                                                               
         MVC   0(L'REBT1,R1),0(R3)      RETURN CODE                             
*                                                                               
         CLI   GLARGS+2,C'A'       IF NOT SORTING BY DESC                       
         BNE   IBCDX                  DONE                                      
*                                                                               
         LTR   R6,R6               POINT TO BCD TABLE ENTRY                     
         BZ    IBCDX                  NONE AVAILABLE                            
*                                                                               
         USING BCDTENT,R6          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    RF,BCDTELM          POINT TO ELEMENT                             
         USING RSPBELEM,RF         ESTABLSIH ELEMENT                            
         MVC   L'REBT1(L'RSPBDESC,R2),RSPBDESC  RETURN DESC                     
*                                                                               
         DROP  RF                                                               
*                                                                               
IBCDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - EXTRACT GENERIC ELEMENT DATA - OBCD'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT BUY CODES                                   *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = C'B' - BUY CODE                                   *         
*                   C'1' - BUY TYPE 1                                 *         
*                   C'2' - BUY TYPE 2                                 *         
*        GLARGS+2 = C'B' - BOTH CODE AND DESCRIPTION                  *         
*                   C'C' - CODE ONLY                                  *         
*                   C'N' - DESCRIPTION - SORTED BY CODE               *         
*                   C'C' - DESCRIPTION - SORTED BY DESCRIPTION        *         
*                                                                     *         
*        R2==>  DRIVER INPUT AREA                                     *         
*                                                                     *         
*EXIT   0-?    -  DATA                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OBCD     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         LA    RF,L'REBCD          ASSUME BUY CODE                              
*                                                                               
         CLI   GLARGS+1,C'B'       IF NOT BUY CODE                              
         BE    *+8                                                              
         LA    RF,L'REBT1             MUST BE A BUY TYPE                        
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         CLI   GLARGS+2,C'C'       IF CODE ONLY                                 
         BE    *+8                                                              
         CLI   GLARGS+2,C'B'       OR BOTH CODE AND DESCRIPTION                 
         BNE   OBCD10                                                           
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CODEAREA(0),0(R2)        PRINT CODE                              
*                                                                               
OBCD10   DS    0H                                                               
*                                                                               
         CLI   GLARGS+2,C'C'       IF CODE ONLY                                 
         BE    OBCDX                  DONE                                      
*                                                                               
         LR    R1,R2               ASSUME CODE AT FRONT OF INPUT                
*                                                                               
         CLI   GLARGS+2,C'A'       IF ALPHA SORT                                
         BNE   *+8                                                              
         LA    R1,L'RSPBDESC+1(RF,R2)  CODE AT BACK                             
*                                                                               
         ICM   R4,15,REBCDTBA      POINT TO BUY CODE TABLE                      
         BZ    OBCDX                  NONE AVAILABLE                            
*                                                                               
         USING BCDTTABD,R4         ESTABLISH TABLE                              
*                                                                               
         ICM   R6,15,BCDTSTRA      POINT TO FIRST TABLE ENTRY                   
         BZ    OBCDX               TABLE EMPTY                                  
*                                                                               
         USING BCDTENT,R6          ESTABLISH TABLE ENTRY                        
*                                                                               
OBCDLOOP DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'B'       IF BUY CODE                                  
         BNE   OBCDLP10                                                         
*                                                                               
         CLI   RSPBKTCD-RSPBKEY+BCDTKEY,1  MUST BE A BUY CODE ENTRY             
         BNE   OBCDCONT                                                         
         B     OBCDLP20                                                         
*                                                                               
OBCDLP10 DS    0H                  ELSE MUST BE A BUY TYPE KEY                  
*                                                                               
         CLI   RSPBKTCD-RSPBKEY+BCDTKEY,0  MUST BE A BUY TYPE ENTRY             
         BNE   OBCDCONT                                                         
*                                                                               
OBCDLP20 DS    0H                                                               
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R1),RSPBKCOD-RSPBKEY+BCDTKEY  MATCH ON CODE                  
         BE    OBCDFND                                                          
*                                                                               
OBCDCONT DS    0H                                                               
*                                                                               
         A     R6,BCDTLEN          BUMP TO NEXT TABLE ENTRY                     
         C     R6,BCDTENDA         CHECK FOR END OF TABLE                       
         BNH   OBCDLOOP                                                         
*                                                                               
OBCDDONE DS    0H                                                               
*                                                                               
         B     OBCDX               NO DESCRIPTION AVAILABLE                     
*                                                                               
OBCDFND  DS    0H                  ENTRY IN TABLE FOUND                         
*                                  RETURN DESCRIPTION                           
         MVC   NAMEAREA(L'RSPBDESC),RSPBDESC-RSPBELEM+BCDTELM                   
*                                                                               
OBCDX    DS    0H                                                               
*                                                                               
         GOTO1 GENOUTA             PRINT ENTRY                                  
*                                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - EXTRACT GENERIC ELEMENT DATA - IBIT'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT INFORMATION IF A BIT IS ON                  *         
*                                                                     *         
*        ROUTINE FIRST FINDS BYTE VIA IELM AND THEN TESTS BIT         *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = ELEMENT ID                                        *         
*        GLARGS+2 = DATA DISPLACEMENT                                 *         
*        GLARGS+3 = DATA LENGTH                                       *         
*        GLARGS+4 = BIT TO BE TESTED                                  *         
*        GLARGS+5 = VALUE IF BIT ON                                   *         
*                                                                     *         
*        R2==>  DRIVER INPUT AREA                                     *         
*                                                                     *         
*EXIT   0-?    -  DATA                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IBIT     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   IBITARGS,GLARGS     SAVE GLARGS                                  
         XC    GLARGS+4(2),GLARGS+4 KILL BYTES 5 & 6                            
*                                                                               
         BRAS  RE,IELM             FIND DATA IN RECORD                          
*                                                                               
         MVC   GLARGS,IBITARGS     RESTORE GLARGS                               
*                                                                               
         MVC   IBITSAVE,0(R2)      SAVE RETURNED DATA                           
         MVI   0(R2),0             CLEAR DRIVER INPUT                           
*                                                                               
         MVC   IBITBYTE,GLARGS+4   COPY BIT TO BE TESTED                        
*                                                                               
         NC    IBITBYTE,IBITSAVE   TEST IF BIT IS ON                            
         BZ    *+10                                                             
         MVC   0(1,R2),GLARGS+5    ON - DISPLAY VALUE                           
*                                                                               
IBITX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IBITARGS DS    XL(L'GLARGS)        GLARGS SAVEAREAL                             
IBITSAVE DS    XL1                 IELM RESULTS SAVEAREA                        
IBITBYTE DS    XL1                 WORKAREA                                     
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - BUDGET DOLLARS - INPUT - IBUD'                       
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT CONTRACT DOLLARS FROM BUDMONTAB           *         
*                                                                     *         
*NTRY    GLARGS   = RECORD ID                                         *         
*                   AL1(RBUDKTYQ) - STATION BUDGETS                   *         
*                   AL1(ROBDKTYQ) - OFFICE  BUDGETS                   *         
*                   AL1(RBSPKTYQ) - SALESPERON BUDGETS                *         
*                   AL1(RBSSKTYQ) - STATION/SALESPERSON BUDGETS       *         
*        GLARGS+1 = DISPLACEMENT INTO BUDGET   BUCKETS                *         
*        GLARGS+2 = TYPE OF BUDGET    BUDGET   BUCKETS                *         
*                   X'80' - STATION                                   *         
*                   X'40' - OFFICE                                    *         
*                   X'20' - CONTRACT TYPE                             *         
*                   X'10' - COMPANY                                   *         
*                   ANY OR ALL BITS MAYBE ON                          *         
*        GLARGS+3 = SPARE                                             *         
*        GLARGS+4 = FIELD TYPE                                        *         
*                   C'C' - CURRENT                                    *         
*                   C'P' - PRIOR                                      *         
*                   C'2' - 2 YEAR PRIOR                               *         
*                   C'N' - NEXT YEAR                                  *         
*        GLARGS+9 = PERIOD START YMD BINARY                           *         
*        GLARGS+12= PERIOD END   YMD BINARY                           *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IBUD     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REANWMON         POINT TO BUDGET DOLLARS TABLE                
         USING BDMNTABD,R4         ESTABLISH MONTH TABLE AREA                   
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**'  SKIP IF NOT BUDGET TABLE            
         BNE   IBUDX                                                            
*                                                                               
         CLI   BDMTBDTP,X'15'      IF SALESPERSON BUDGET                        
         BNE   IBUDSALN                                                         
*                                                                               
         MVC   HALF(1),GLARGS      FIND RECORD TYPE                             
         NI    HALF,X'FF'-X'F0'    KILL TOP 4 BITS                              
         CLC   BDMTBDT2,HALF       MAKE SURE CORRECT DATA AVAILABLE             
         BNE   IBUDX                                                            
*                                                                               
         B     IBUDTYPX                                                         
*                                                                               
IBUDSALN DS    0H                                                               
*                                                                               
         MVC   HALF(1),GLARGS      FIND RECORD TYPE                             
         NI    HALF,X'FF'-X'E0'    KILL TOP 3 BITS                              
         CLC   BDMTBDTP,HALF       MAKE SURE CORRECT DATA AVAILABLE             
         BNE   IBUDX                                                            
*                                                                               
IBUDTYPX DS    0H                                                               
*                                                                               
         CLI   REBTPS,0            SKIP IF ALL TYPES WANTED                     
         BE    *+20                                                             
         MVC   HALF(1),BDMTSBTP    COPY BUDGET TYPE INDICATORS                  
         NC    HALF(1),REBTPS      TEST IF WANTED BUDGET                        
         BZ    IBUDX               NO                                           
*                                                                               
         CLI   REBTPO,0            SKIP IF ALL TYPES WANTED                     
         BE    *+20                                                             
         MVC   HALF(1),BDMTOBTP    COPY BUDGET TYPE INDICATORS                  
         NC    HALF(1),REBTPO      TEST IF WANTED BUDGET                        
         BZ    IBUDX               NO                                           
*                                                                               
         CLI   REBTPSP,0           SKIP IF ALL TYPES WANTED                     
         BE    *+20                                                             
         MVC   HALF(1),BDMTSPTP    COPY BUDGET TYPE INDICATORS                  
         NC    HALF(1),REBTPSP     TEST IF WANTED BUDGET                        
         BZ    IBUDX               NO                                           
*                                                                               
         CLI   REBTPSS,0           SKIP IF ALL TYPES WANTED                     
         BE    *+20                                                             
         MVC   HALF(1),BDMTSSTP    COPY BUDGET TYPE INDICATORS                  
         NC    HALF(1),REBTPSS     TEST IF WANTED BUDGET                        
         BZ    IBUDX               NO                                           
*                                                                               
         OC    RECFCTY,RECFCTY     IF CONTRACT TYPE COLUMN FILTER               
         JZ    IBUDCTPX                                                         
         CLC   BDMTCTP,RECFCTY        IF MATCH ON CONTRACT TYPE                 
         JNE   *+16                                                             
         CLI   RECFCTYC,FLTEQQ           IF CONTRACT TYPE ONLY                  
         JE    IBUDCTPX                     KEEP FOR REPORT                     
         J     IBUDX                     ELSE REJECT                            
*                                     ELSE NO MATCH ON CONTRACT TYPE            
         CLI   RECFCTYC,FLTEQQ           IF CONTRACT TYPE ONLY                  
         JE    IBUDX                        DROP                                
*                                        ELSE KEEP                              
IBUDCTPX DS    0H                                                               
*                                                                               
         LA    R5,BDMTNTRY         FIRST MONTH ENTRY                            
         USING BDMTNTRY,R5         ESTABLISH TABLE ENTRY                        
*                                                                               
         ZAP   0(8,R2),=P'0'       INIT DOLLAR BUCKET                           
*                                                                               
IBUDLOOP DS    0H                                                               
*                                                                               
         OC    BDMTDTS(BDMTDTSL),BDMTDTS   DONE IF NO DATE PRESENT              
         BZ    IBUDDONE                                                         
*                                                                               
         CLC   REYMSTRP(2),BDMTCURB    BUCKET MUST BE FOR PERIOD                
         BH    IBUDCONT              USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),BDMTCURB                                             
         BL    IBUDCONT                                                         
*                                                                               
         OC    RECURSTB(2),RECURSTB   SKIP IF NO CURRENT PERIOD                 
         BZ    *+24                                                             
         CLC   RECURSTB(2),BDMTCURB   BUCKET MUST BE FOR CURR PERIOD            
         BH    IBUDCONT              USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),BDMTCURB                                             
         BL    IBUDCONT                                                         
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BNZ   *+10                                                             
         OC    GLARGS+12(2),GLARGS+12    SKIP IF NO DATES GIVEN                 
         BZ    IBUD10                                                           
*                                                                               
         CLC   GLARGS+9(2),BDMTCURB      BUCKET MUST BE FOR KYW PERIOD          
         BH    IBUDCONT                                                         
         CLC   GLARGS+12(2),BDMTCURB                                            
         BL    IBUDCONT                                                         
*                                                                               
IBUD10   DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+1         GET DISPLACEMENT INTO DOLLARS                
*                                                                               
         LA    R1,BDMTBCK(RF)      POINT TO BUCKET                              
*                                                                               
         ICM   RF,15,0(R1)         RETURN DOLLARS                               
         CVD   RF,DUB                                                           
*                                                                               
         AP    0(8,R2),DUB         ADD TO DRIVER INPUT                          
*                                                                               
IBUDCONT DS    0H                                                               
*                                                                               
         LA    R5,BDMTNTRL(R5)     BUMP TO NEXT BUCKET                          
*                                                                               
         B     IBUDLOOP                                                         
*                                                                               
IBUDDONE DS    0H                                                               
*                                                                               
IBUDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'RENWRTER - INPUT - CATEGORY - ICTG'                             
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT CATEGORY    FROM A DETAIL RECORD          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICTG     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         GOTO1 =A(SETREP)          FIND CORRECT REP                             
*                                                                               
         CLI   FLAVOR,C'R'         IF RGON REPORT                               
         BNE   ICTGRRGX                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RGON WORKAREA                       
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    ICTGX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    ICTGX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    ICTGX                                                            
*                                                                               
                                                                                
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    ICTGX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    ICTGX                                                            
*                                                                               
*        FIND CATEGORY AS A DATATYPE                                            
*                                                                               
         LA    R0,8                MAX 8                                        
         LA    R1,RRGWDT1          FIRST DATATYPE                               
         LA    RE,RRGWDAT1         FIRST RETURNED DATA                          
*                                                                               
         CLI   0(R1),RCTGKTYQ      MATCH DATATYPE                               
         BE    *+20                                                             
         LA    R1,L'RRGWDT1+L'RRGWDA1(R1) NEXT DATATYPE                         
         LA    RE,L'RRGWDAT1(RE)   NEXT RETURNED DATA                           
         BCT   R0,*-16                                                          
         B     ICTGX               CATEGORY NOT A DATATYPE                      
*                                                                               
         MVC   ICTGSCTG,0(RE)      SAVE CATEGORY                                
         B     ICTGCTGX                                                         
*                                                                               
ICTGRRGX DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         BNE   ICTGCONN                                                         
*                                                                               
*        EXTRACT CATEGORY'S CODE FROM CONTRACT                                  
*                                                                               
ICTGCON  DS    0H                                                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ICTGPRDN               NO ELEMENT                                
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
*        FIND CATEGORY CODE FOR CONTRACT                                        
*                                                                               
         CLC   RCONCTGY,RESPACES   IF CATEGORY CODE FOUND                       
         BNH   ICTGCONN                                                         
*                                                                               
         MVC   ICTGSCTG,RCONCTGY      SAVE CATEGORY CODE                        
*                                                                               
         B     ICTGCTGX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
ICTGCONN DS    0H                                                               
*                                                                               
*        LOOK FOR CONTRACT PRODUCT AND USE ITS CATEGORY                         
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         CLC   RCONPRD,RESPACES    IF THERE IS A CONTRACT PRODUCT               
         BNH   ICTGPRDN               NO                                        
*                                                                               
         DROP  R4                                                               
*                                                                               
         ICM   R8,15,REPRDTBA      POINT TO PRODUCT TABLE                       
         BZ    ICTGPRDN            SKIP IF NO PRODUCT TABLE                     
*                                                                               
         USING PRDTTABD,R8         ESTABLISH PRODUCT TABLE                      
*                                                                               
         ICM   R0,15,PRDTBSRP+8    GET NUMBER OF RECORDS IN TABLE               
         BZ    ICTGPRDN            IGNORE IF TABLE EMPTY                        
*                                                                               
         L     R3,PRDTBSRP+4       POINT TO FIRST RECORD IN TABLE               
         USING PRDTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
ICTGPRDL DS    0H                  FIND PRODUCT ENTRY                           
*                                                                               
         CLC   REDMREP,RPRDKREP-RPRDKEY+PRDTKEY   MATCH REP                     
         BNE   ICTGPRDC                                                         
         CLC   READV,RPRDKADV-RPRDKEY+PRDTKEY   MATCH ADV                       
         BNE   ICTGPRDC                                                         
         CLC   RCONPRD,RPRDKPRD-RPRDKEY+PRDTKEY MATCH PRODUCT CODE              
         BE    ICTGPRDF                                                         
*                                                                               
ICTGPRDC DS    0H                                                               
*                                                                               
         A     R3,PRDTBSRP+12      BUMP TO NEXT ENTRY                           
         BCT   R0,ICTGPRDL         PRODUCT NOT FOUND                            
         B     ICTGPRDN                                                         
*                                                                               
ICTGPRDF DS    0H                                                               
*                                                                               
         LA    R6,PRDTELM          ESTABLISH PRODUCT DESCRIPTION                
         USING RPRDELEM,R6                                                      
*                                                                               
         CLC   RPRDCATG,RESPACES   IF CATEGORY EXISTS                           
         BNE   ICTGPRDN                                                         
*                                                                               
         MVC   ICTGSCTG,RPRDCATG      SAVE IT                                   
*                                                                               
         B     ICTGCTGX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
ICTGPRDN DS    0H                  NO PRODUCT FOR CONTRACT                      
*                                                                               
         ICM   R3,15,READVTA       POINT TO ADVERTISER TABLE ENTRY              
         BZ    ICTGX               GIVE UP IF NO ENTRY                          
*                                                                               
         USING ADVTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         MVC   ICTGSCTG,RADVCATG-RADVELEM+ADVTELM  SAVE CTG CODE                
*                                                                               
         DROP  R3                                                               
*                                                                               
ICTGCTGX DS    0H                                                               
*                                                                               
         CLC   ICTGSCTG,RESPACES   GIVE UP IF NO CODE FOUND                     
         BNH   ICTGX                                                            
*                                                                               
*        BUILD SORT OUTPUT                                                      
*                                                                               
         CLI   GLARGS+1,C'S'             IF NOT SORTING BY NAME                 
         BE    *+10                                                             
         MVC   0(L'RCONCTGY,R2),ICTGSCTG    RETURN CATEGORY CODE                
*                                                                               
         LA    R5,L'RCONCTGY(R2)            POINT TO NAME AREA                  
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R5,10(R5)              BUMP PAST NAMEAREA                        
*                                                                               
*        BUILD LOOK UP DATA                                                     
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         MVC   0(L'RCONKREP,R5),REDMREP    SET REP CODE                         
         LA    R5,L'RCONKREP(R5)           BUMP TO NEXT AREA                    
*                                                                               
         MVC   0(L'RCONCTGY,R5),ICTGSCTG   SET CTG CODE                         
         LA    R5,L'RCONCTGY(R5)           BUMP TO NEXT AREA                    
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   ICTGCNMX                                                         
*                                                                               
         LA    R3,WORK                POINT TO A WORKAREA                       
*                                                                               
         GOTO1 =A(OID)                LOOK UP NAME IN TABLE                     
*                                                                               
         LA    R5,L'RCONCTGY(R2)      POINT TO NAME AREA                        
         MVC   0(10,R5),NAMEAREA      ADD NAME TO OUTPUT                        
*                                  ONLY 10 CHS TO SAVE SPACE IN SORT KY         
*                                                                               
ICTGCNMX DS    0H                                                               
*                                                                               
ICTGCNMN DS    0H                                                               
*                                                                               
ICTGX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ICTGSCTG DS    XL(L'RCONCTGY)      CATEGORY CODE SAVEAREA                       
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - CLASS - ICLS'                                
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT CLASS       FROM A DETAIL RECORD          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICLS     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   ICLSARGS,GLARGS     SAVE ARGUMENTS                               
*                                                                               
*        HANDLE RGON REPORT                                                     
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   ICLSRGNN                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    ICLSX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    ICLSX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    ICLSX                                                            
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    ICLSX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    ICLSX                                                            
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-18                                                          
         B     ICLSX               NO DATA TYPE MATCH                           
*                                                                               
         MVC   ICLSSCLS,0(R1)      SAVE CONTRACT TYPE                           
*                                                                               
         B     ICLSFND             CONTRACT TYPE FOUND                          
*                                                                               
ICLSRGNN DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
*        FIRST FIND CATEGORY                                                    
*                                                                               
         XC    WORK,WORK                                                        
         LA    R2,WORK             INIT DRIVER INPUT AREA                       
*                                                                               
         MVI   GLARGS,RCTGKTYQ     SET DATA TYPE                                
         MVI   GLARGS+1,C'S'       SORT BY NAME - FORCES                        
*                                    SYSTEM TO LOOK UP ENTRY IN CTG TBL         
*                                                                               
         GOTO1 =A(ICTG)            FIND CATEGORY                                
*                                                                               
         MVC   GLARGS,ICLSARGS     RESTORE ARGUMENTS                            
         L     R2,GLAIFLD          R2=A(INPUT)                                  
*                                                                               
         ICM   R5,15,RECTGTA       POINT TO TABLE ENTRY                         
         BZ    ICLSX               NO CATEGORY FOUND                            
*                                                                               
         USING CTGTENT,R5          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R6,CTGTELM          ESTABLISH CATEGORY DESC ELEMENT              
         USING RCTGELEM,R6                                                      
*                                                                               
         MVC   ICLSSCLS,RCTGCLSS   SAVE CATEGORY'S CLASS                        
*                                                                               
ICLSFND  DS    0H                                                               
*                                                                               
         CLC   ICLSSCLS,RESPACES   GIVE UP IF NO CODE FOUND                     
         BNH   ICLSX                                                            
*                                                                               
*        BUILD SORT OUTPUT                                                      
*                                                                               
         CLI   GLARGS+1,C'S'             IF NOT SORTING BY NAME                 
         BE    *+10                                                             
         MVC   0(L'RCLSKCLS,R2),ICLSSCLS    RETURN CLASS CODE                   
*                                                                               
         LA    R5,L'RCLSKCLS(R2)   POINT TO NAME AREA                           
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R5,10(R5)              BUMP PAST NAME AREA                       
*                                                                               
*        BUILD LOOK UP DATA                                                     
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         MVC   0(L'RCONKREP,R5),REDMREP    SET REP CODE                         
         LA    R5,L'RCONKREP(R5)           BUMP TO NEXT AREA                    
*                                                                               
         MVC   0(L'RCLSKCLS,R5),ICLSSCLS    RETURN CLASS CODE                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   ICLSCNMX                                                         
*                                                                               
         XC    WORK,WORK                                                        
         LA    R3,WORK                POINT TO A WORKAREA                       
*                                                                               
         GOTO1 =A(OID)                LOOK UP NAME IN TABLE                     
*                                                                               
         LA    R5,L'RCLSKCLS(R2)      POINT TO NAME AREA                        
*                                                                               
         MVC   0(10,R5),NAMEAREA      ADD NAME TO OUTPUT                        
*                                  ONLY 10 CHS TO SAVE SPACE IN SORT KY         
*                                                                               
ICLSCNMX DS    0H                                                               
*                                                                               
ICLSCNMN DS    0H                                                               
*                                                                               
ICLSX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ICLSSCLS DS    XL(L'RCLSKCLS)      CLASS CODE SAVEAREA                          
ICLSARGS DS    CL16                GLARGS SAVEAREA                              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - COMBINATION CALL LETTERS - INPUT - ICOMBO'           
***********************************************************************         
*                                                                     *         
*        ROUTINE TO RETRIEVE COMBINATION CALL LETTERS FROM STATION REC*         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICOMBO   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO3           ESTABLISH STATION RECORD                     
         USING RSTAREC,R4                                                       
*                                                                               
         CLI   RSTAKTYP,X'02'      SKIP IF NOT A STATION RECORD                 
         BNE   ICOMBOX                                                          
*                                                                               
         MVC   0(5,R2),RESPACES    INIT RETURNED DATA                           
*                                                                               
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT                       
         SR    RF,RF                                                            
*                                                                               
ICMBLOOP DS    0H                                                               
*                                                                               
         USING RSTACSEL,R6         ESTABLISH COMBINATION STN ELM                
*                                                                               
         CLI   RSTACSEL,0          DONE AT END OF RECORD                        
         BE    ICMBDONE                                                         
*                                                                               
         CLI   RSTACSEL,X'0A'      FIND COMBINATION STATION ELEMENT             
         BNE   ICMBCONT                                                         
*                                                                               
         CLI   RSTACS+4,C'C'       SKIP UNLESS BAND C                           
         BE    ICMBFND                                                          
*                                                                               
ICMBCONT DS    0H                                                               
*                                                                               
         IC    RF,RSTACSLN         ELEMENT LENGTH                               
         LA    R6,RSTACSEL(RF)     BUMP TO NEXT ELEMENT                         
         B     ICMBLOOP                                                         
*                                                                               
ICMBDONE DS    0H                                                               
*                                                                               
         B     ICOMBOX                                                          
*                                                                               
ICMBFND  DS    0H                  COMBINATION STAION FOUND                     
*                                                                               
         MVC   0(L'RSTACS,R2),RSTACS RETURN STATION CALL LETTERS                
*                                                                               
ICOMBOX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - COMMENTS - ICOMM'                                    
***********************************************************************         
*                                                                     *         
*        REPORTS MANUAL OR LIBRARY COMMENTS                           *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+0 - RECORD INDICATOR                                  *         
*        GLARGS+1 - ELEMENT INDICATOR                                 *         
*                                                                     *         
*EXIT    0(4,R2)           -  DISK ADDRESS OF SOURCE RECORD           *         
*        4(1,R2)           -  SE           OF SOURCE RECORD           *         
*                                                                     *         
*        COMMENT WILL BE CHOPPED INTO OUTPUT COLUMN                   *         
*           FOR A MAXIMUM OF 20 LINES                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICOMM    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R3,REAIO1           DEFAULT TO CONTRACT RECORD                   
         MVC   ICOMMDSK,RECONKEY+28 SAVE DISK ADDRESS                           
*                                                                               
         CLI   GLARGS,X'02'        USE STATION RECORD IF REQUIRED               
         BNE   ICOMMSTN                                                         
*                                                                               
         L     R3,REAIO3                                                        
         MVC   ICOMMDSK,RESTAKEY+28 SAVE DISK ADDRESS                           
         B     ICOMMFRX                                                         
*                                                                               
ICOMMSTN DS    0H                                                               
*                                                                               
         CLI   GLARGS+5,C'F'       IF FORECAST                                  
         BE    *+8                                                              
         CLI   GLARGS+5,C'P'       OR PENDING COMMENTS                          
         BE    *+8                                                              
         CLI   GLARGS+5,C'C'       OR CPN     COMMENTS                          
         BNE   *+12                                                             
         TM    REPERTYP,REPRCURQ   MUST BE A CURRENT YEAR CONTRACT              
         BNO   ICOMMX                                                           
*                                                                               
         CLI   GLARGS+5,C'F'       SKIP IF NOT FORECAST                         
         BE    *+8                                                              
         CLI   GLARGS+5,C'P'       OR PENDING COMMENTS                          
         BNE   ICOMMFRX                                                         
*                                                                               
         L     R4,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,R4         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQCFAAD),0,0  FIND ASATDATE FILTER           
         BNZ   ICMMAADX            NONE FOUND                                   
*                                                                               
         ICM   R5,15,DMCB+8        POINT TO FOUND ASATDATE FILTER               
         BZ    ICMMAADX            NONE FOUND                                   
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,FLTFVLEN-FLTCTL(R5) FILTER LENGTH                           
         BZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         SR    R0,R0                                                            
         IC    R0,REQAADFN         NUMBER OF ASATDATE FILTERS                   
         AH    R0,=H'1'            ALLOW FOR TOTAL REPORT                       
         L     RE,REAADTBA         POINT TO ASATDATES TABLE                     
*                                                                               
ICMMAADL DS    0H                                                               
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   FLTFVAL-FLTCTL(0,R5),0(RE)  MATCH THIS COL FILTER                
         BE    ICMMAADF            FILTER FOUND                                 
*                                                                               
ICMMAADC DS    0H                                                               
*                                                                               
         AHI   R4,NWMTENTL         BUMP TO NEXT TABLE                           
         LA    RE,6(RE)            BUMP TO NEXT ASATDATES                       
         BCT   R0,ICMMAADL                                                      
*                                                                               
         DC    H'0'                SHOULD NOT BE HERE                           
*                                                                               
ICMMAADF DS    0H                  CORRECT TABLE FOUND                          
*                                                                               
ICMMAADX DS    0H                                                               
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         BZ    ICOMMFF                                                          
*                                                                               
         CLI   GLARGS+5,C'F'       IF FORECASTING DATA                          
         BNE   *+12                                                             
         CLI   CSFRCAST(RF),C'Y'      CONTRACT MUST BE FORECAST CONT            
         BNE   ICOMMFF                                                          
*                                                                               
         CLI   GLARGS+5,C'P'       IF PENDING DATA WANTED                       
         BNE   *+28                                                             
         CLI   CSPENDNG(RF),C'Y'      CONTRACT MUST BE PENDING                  
         BE    *+8                                                              
         CLI   CSPENDNG(RF),C'P'                                                
         BNE   ICOMMFF                                                          
         CLI   CSFRCAST(RF),C'Y'      CONTRACT MUST NOT BE FORECASTING          
         BE    ICOMMFF                                                          
*                                                                               
ICOMMFRX DS    0H                                                               
*                                                                               
*        LOOK FOR COMMENT ELEMENT                                               
*                                                                               
         LA    R6,34(R3)           POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             NO COMMENT IF END OF RECORD                  
         BE    ICOMMFF                                                          
         CLC   0(1,R6),GLARGS+1    MATCH ON ELEMENT CODE                        
         BE    *+16                                                             
         IC    RF,1(R6)            BUMP TO NEXT ELEMENT                         
         LA    R6,0(RF,R6)                                                      
         B     *-26                                                             
*                                  COMMENT ELEMENT FOUND                        
*        FORMAT DRIVER INPUT                                                    
*                                                                               
         MVC   0(4,R2),ICOMMDSK    SET DISK ADDRESS                             
*                                                                               
         MVC   4(1,R2),RESE        PASS SE NUMBER                               
*                                                                               
         B     ICOMMX                                                           
*                                                                               
*        NO COMMENT - FORCE TO SORT LAST                                        
*                                                                               
ICOMMFF  DS    0H                                                               
*                                                                               
         MVC   0(5,R2),=XL5'00'    NO COMMENT TO PRINT                          
*                                                                               
ICOMMX   DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
ICOMMDSK DS    XL4                 DISK ADDRESS                                 
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - CONTRACT/BUY COMMENTS - OCOMM'                       
***********************************************************************         
*                                                                     *         
*        REPORTS STANDARD OR FREEFORM COMMENTS FROM BUY OR CONTRACT   *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+0 - RECORD INDICATOR 'C'/'B'                          *         
*        GLARGS+1 - ELEMENT INDICATOR                                 *         
*                                                                     *         
*        0(4,R2)           -  DISK ADDRESS OF SOURCE RECORD           *         
*        4(1,R2)           -  SE           OF SOURCE RECORD           *         
*                                                                     *         
*EXIT    COMMENT CHOPPED TO COLUMN WIDTH                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OCOMM    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   0(R2),X'FF'         SKIP IF NO COMMENT AVAILABLE                 
         BE    OCOMMX                                                           
*                                                                               
         LA    R6,0(R2)            POINT TO DISK ADDRESS                        
*                                                                               
         MVC   OCOMMDAS,0(R6)      SAVE NEW DISK ADDR & SE                      
*                                                                               
         OC    OCOMMDAS(R4),OCOMMDAS SKIP IF NO DISK ADDRESS AVAILABLE          
         BZ    OCOMMX                                                           
*                                                                               
         XC    KEY,KEY                                                          
         MVC   KEY+28(4),0(R6)                                                  
*                                                                               
         CLI   4(R6),0             SKIP IF NO SE NUMBER PASSED                  
         BE    OCOMM10                                                          
*                                                                               
         L     RF,REUTLA           POINT TO UTLA                                
         MVC   OCOMMSES,4(RF)      SAVE CURRENT SE NUMBER                       
         MVC   4(1,RF),4(R6)       CHANGE SE NUMBER FOR FILES                   
*                                                                               
OCOMM10  DS    0H                                                               
*                                                                               
         L     RF,REAIO1                                                        
         ST    RF,AIO                                                           
         OI    DMINBTS,8          PASS DELETED RECORDS                          
*                                                                               
         GOTO1 GETREC             READ IN RECORD                                
*                                                                               
*        FORMAT COMMENT                                                         
*                                                                               
         L     R6,GLADTENT         ESTABLISH OUTPUT DESC ELEMENT                
         USING DROD,R6                                                          
*                                                                               
*        GET COMMENTS FOR TYPE                                                  
*                                                                               
         GOTO1 =A(GETCOM),DMCB,(GLARGS+1,AIO),(OCOMMSE,=C'NOSQ'),0,0            
*                                                                               
         TM    REQPOPT,REQPOCUT    IF CUTTING TO COLUMN WIDTH                   
         BNO   OCOMMCTN                                                         
*                                                                               
         ICM   R5,15,DMCB+8           ADDRESS OF WORK AREA FROM GETCOM          
         BZ    OCOMMDN                   NO COMMENT TO PRINT                    
*                                                                               
         ZIC   RF,DROLEN              GET OUTPUT LENGTH                         
         BCTR  RF,0                   DECREMENT FOR EXECUTE                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),0(R5)          PRINT COMMENT                             
*                                                                               
         B     OCOMMD1                                                          
*                                                                               
OCOMMCTN DS    0H                                                               
*                                                                               
*        CHOP COMMENT                                                           
*                                                                               
         ICM   R5,15,DMCB+8        ADDRESS OF COMMENT TABLE                     
         BZ    OCOMMDN                SKIP IF TABLE NOT PRESENT                 
*                                                                               
         ICM   RF,15,DMCB+12       COMMENT LENGTH                               
         BZ    OCOMMDN             NO COMMENT                                   
*                                                                               
         LA    R0,OCOMMCHN         MAXIMUM NUMBER OF OUTPUT LINES               
*                                                                               
         GOTO1 CHOPPER,DMCB,(0,0(R5)),(DROLEN,0(R3)),                  X        
               (198,(R0)),C'LEN=',(RF)                                          
*                                                                               
OCOMMD1  DS    0H                  COMMENT WAS PRINTED                          
*                                                                               
*                                                                               
*        CHECK IF KEYWORD IS USING DROP OPTION                                  
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQWRCFL),(2,=AL2(RKQCFDRP)),0                
*                                                                               
         OC    8(4,R1),8(R1)                                                    
         BZ    OCOMMDN             NO DROP OPTION                               
*                                                                               
         MVI   SORTSW,C'P'         FORCE PRINTING OF LINE                       
*                                                                               
OCOMMDN  DS    0H                                                               
*                                                                               
         CLI   OCOMMSE,0           SKIP IF NO SE NUMBER PASSED                  
         BE    *+14                                                             
         L     RF,REUTLA           POINT TO UTLA                                
         MVC   4(1,RF),OCOMMSES    RESTORE CURRENT SE NUMBER                    
*                                                                               
OCOMMX   DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
OCOMMDAS DC    XL5'00'             DISK ADDR & SE SAVEAREA                      
         ORG   *-1                                                              
OCOMMSE  DS    X                   SE                                           
*                                                                               
OCOMMSES DS    X                   CURRENT SE SAVEAREA                          
*                                                                               
OCOMMCHN EQU   20                  NUMBER OF LINES IN WORKAREA                  
OCOMMCHP DS    (OCOMMCHN)XL80      COMMENT CHOP AREA                            
         DC    CL80' '             EXTRA LINE                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'REWRITER - BUILDS COMMENT TABLE - GETCOM'                       
***********************************************************************         
*                                                                     *         
*        BUILDS A COMMENT IN A TABLE AND OPTIONALLY SQUASHES IT       *         
*                                                                     *         
*NTRY                                                                 *         
*        PARMS+0  - COMMENT ELEMENT IDENTIFIER                        *         
*        PARMS+1-3- A(RECORD KEY)                                     *         
*                                                                     *         
*        PARM1+0  - SE NUMBER                                         *         
*        PARM1+1-3- A('NOSQ') FOR NO SQUASHING OPTION                 *         
*                                                                     *         
*EXIT                                                                 *         
*        PARM2+0-3- A(TABLE OF COMMENTS)                              *         
*        PARM3+0-3- COMMENT LENGTH                                    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
GETCOM   NMOD1 200,**#GCOM                                                      
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
*                                                                               
         ST    RC,GCOMCOMA         SET COMMENT RECORD AREA ADDRESS              
*                                                                               
         L     RC,GLAWORKD         RESET WORKING STORAGE POINTER                
         USING GEND,RC                                                          
*                                                                               
         ST    R1,GCOMPRMA         SAVE PARAMETER LIST POINTER                  
         MVC   GCOMPRMS,0(R1)      SAVE PARAMETERS                              
*                                                                               
         L     R4,GCOMTBLA         POINT TO COMMENT TABLE                       
*                                                                               
         ST    R4,GCOMNXTA         INIT ADDRESS OF NEXT COMMENT                 
*                                                                               
         MVI   0(R4),C' '          INIT COMMENT TABLE TO SPACES                 
         LA    R1,GCOMTBLL-1                                                    
         MOVE  (1(R4),(R1)),0(R4)                                               
*                                                                               
*        FIND COMMENT ELEMENTS IN TABLE                                         
*                                                                               
         CLI   GCOMSE,0            SKIP IF SE NOT PASSED                        
         BE    GCOM10                                                           
*                                                                               
         ICM   RF,15,REUTLA           RESET UTL                                 
         BZ    GCOM10                    NO ADDRESS GIVEN                       
*                                                                               
         MVC   GCOMSESV,4(RF)            SAVE CURRENT SE                        
         MVC   4(1,RF),GCOMSE         WITH PASSED SE                            
*                                                                               
GCOM10   DS    0H                                                               
*                                                                               
         L     R6,GCOMRECA                                                      
         LA    R6,34(R6)           POINT TO FIRST ELEMENT IN RECORD             
*                                                                               
GCOMLOOP DS    0H                                                               
*                                                                               
         CLI   0(R6),0             DONE IF END OF RECORD REACHED                
         BE    GCOMLPDN                                                         
*                                                                               
         CLC   0(1,R6),GLARGS+1    FIND DESIRED ELEMENT                         
         BNE   GCOMLPCN                                                         
*                                                                               
         USING RCONCMEL,R6         ESTABLISH CONTRACT COMMENT ELEMENT           
*                                     ALSO WORKS FOR ANY TYPE                   
*                                     COMMENT ELEMENT                           
*                                                                               
         CLI   RCONCMLN,2             SKIP IF NO DATA?                          
         BNH   GCOMLPCN                                                         
*                                                                               
         CLC   =C'C=',RCONCMNT     IF  NOT STANDARD COMMENT                     
         BE    GCOMSTD                                                          
         CLC   =C'SC=',RCONCMNT    AND  NOT SFM COMMENT                         
         BE    GCOMSFM                                                          
*                                                                               
*        SAVE FREEFORM COMMENT IN TABLE                                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,RCONCMLN         ELEMENT LENGTH                               
         AHI   RF,-3               EXECUTE LENGTH OF COMMENT                    
*                                                                               
         LA    R1,RCONCMNT         POINT TO COMMENT                             
*                                                                               
GCOMLCNX DS    0H                                                               
*                                                                               
         B     GCOMLCAD            GO ADD COMMENT                               
*                                                                               
GCOMLCNN DS    0H                                                               
*                                                                               
         B     GCOMLPCN            UNKNOWN RECORD TYPE                          
*                                                                               
GCOMLCAD DS    0H                                                               
*                                                                               
*        MOVE COMMENT TO COMMENT TABLE                                          
*              RF =   COMMENT EXECUTE LENGTH                                    
*              R1 ==> COMMENT                                                   
*                                                                               
         L     R4,GCOMNXTA         A(NEXT AVAILABLE SPACE)                      
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R4),0(R1)                                                    
*                                                                               
         LA    R4,2(RF,R4)         BUMP POINTER TO NEXT TABLE ENTRY             
         ST    R4,GCOMNXTA         FORCE SPACE BETWEEN COMMENTS                 
*                                                                               
         B     GCOMLPCN                                                         
*                                                                               
GCOMSTD  DS    0H                  STANDARD COMMENT                             
*                                                                               
*        STANDARD COMMENTS MUST BE CONTRACT RECORD                              
*                                                                               
         USING RCONCMEL,R6         ESTABLISH CONTRACT COMMENT ELEMENT           
*                                                                               
         ST    R6,GCOMELMA         SAVE COMMENT ELEMENT POINTER                 
*                                                                               
         L     R5,GCOMRECA         POINT TO PASSED RECORD                       
         USING RCONREC,R5          ESTABLISH AS CONTRACT RECORD                 
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY              ESTABLISH COMMENT KEY                        
         USING RCMTKEY,R4                                                       
*                                                                               
         MVI   RCMTKTYP,X'2E'      RECORD ID                                    
         MVC   RCMTKREP,RCONKREP   REP CODE                                     
         MVC   RCMTKOFF,=X'FFFF'   OFFICE CODE                                  
*                                                                               
         MVC   RCMTKCDE,RESPACES   INIT COMMENT CODE                            
*                                                                               
         SR    RF,RF                                                            
         IC    RF,RCONCMLN         COMMENT ELEMENT LENGTH                       
         AHI   RF,-5               EXECUTE LENGTH OF CODE                       
         BM    GCOMLPCN            NO CODE                                      
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RCMTKCDE(0),RCONCMNT+2 COMMENT CODE                              
*                                                                               
         B     GCOMREAD            GO READ COMMENT RECORD                       
*                                                                               
GCOMSFM  DS    0H                  SFM OFFICE COMMENT                           
*                                                                               
*        SFM OFFICE COMMENTS MUST BE CONTRACT RECORD                            
*                                                                               
         USING RCONCMEL,R6         ESTABLISH CONTRACT COMMENT ELEMENT           
*                                                                               
         ST    R6,GCOMELMA         SAVE COMMENT ELEMENT POINTER                 
*                                                                               
         L     R5,GCOMRECA         POINT TO PASSED RECORD                       
         USING RCONREC,R5          ESTABLISH AS CONTRACT RECORD                 
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY              ESTABLISH OFFICE COMMENT KEY                 
         USING ROCMKEY,R4                                                       
*                                                                               
         MVI   ROCMKTYP,X'34'      RECORD ID                                    
         MVC   ROCMKREP,RCONKREP   REP CODE                                     
         MVC   ROCMKOFC,RCONKOFF   OFFICE CODE                                  
         MVC   ROCMKNUM,RCONCMNT+3 NUMBER                                       
         MVI   ROCMKPAG,C'0'       PAGE NOT USED YET                            
*                                                                               
GCOMREAD DS    0H                  READ COMMENT RECORD                          
*                                                                               
         GOTO1 HIGH                                                             
*                                                                               
         USING RCMTKEY,R4          ESTABLISH COMMENT KEY                        
*                                                                               
         CLC   RCMTKEY,KEYSAVE                                                  
         BNE   GCOMLPCN            COMMENT NOT FOUND                            
*                                                                               
         MVC   GCOMAIOS,AIO        SAVE CURRENT IO AREA ADDRESS                 
*                                                                               
         MVC   AIO,GCOMCOMA        SET UP WHERE REC IS TO BE READ               
*                                                                               
         GOTO1 GETREC                                                           
*                                                                               
         MVC   AIO,GCOMAIOS        RESTORE CURRENT IO AREA ADDRESS              
*                                                                               
         L     R6,GCOMCOMA         POINT TO COMMENT RECORD                      
         LA    R6,34(R6)           POINT TO FIRST ELEMENT                       
*                                                                               
GCOMSTDL DS    0H                                                               
*                                                                               
         CLI   0(R6),0             DONE IF END OF RECORD REACHED                
         BE    GCOMSTDD                                                         
*                                                                               
         CLI   0(R6),X'02'         SEARCH FOR COMMENT ELEMENTS                  
         BNE   GCOMSTDC                                                         
*                                                                               
         LA    R1,2(R6)            COMMENT START                                
         ZIC   RF,1(R6)            ELEMENT LENGTH                               
         SH    RF,=H'3'            SKIP IF NO COMMENT AVAILABLE                 
         BM    GCOMSTDC                                                         
*                                                                               
         L     RE,GCOMNXTA         SAVE COMMENT IN TABLE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RE),0(R1)                                                    
*                                                                               
         LA    RE,2(RF,RE)         UPDATE NEXT ELEMENT POINTER                  
         ST    RE,GCOMNXTA           WITH SPACE BETWEEN SEGMENTS                
*                                                                               
GCOMSTDC DS    0H                  LOOP CONTINUATION                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R6)          BUMP TO NEXT ELEMENT IN RECORD               
         LA    R6,0(RF,R6)                                                      
         B     GCOMSTDL                                                         
*                                                                               
GCOMSTDD DS    0H                                                               
*                                                                               
         L     R6,GCOMELMA         RESTORE A(CONTRACT COMMENT ELEMENT)          
*                                                                               
GCOMLPCN DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,1(R6)          BUMP TO NEXT ELEMENT IN RECORD               
         BZ    GCOMLPDN            NONE AVAILABLE                               
         LA    R6,0(RF,R6)                                                      
         B     GCOMLOOP                                                         
*                                                                               
GCOMLPDN DS    0H                                                               
*                                                                               
         ICM   RF,15,REUTLA           RESET UTL                                 
         BZ    *+10                      NO ADDRESS GIVEN                       
         MVC   4(1,RF),GCOMSESV       WITH CURRENT SE                           
*                                                                               
         L     R3,GCOMTBLA         START OF COMMENT TABLE                       
*                                                                               
         L     RF,GCOMPRMA         POINT TO CALLER'S PARAMETERES                
         ST    R3,8(RF)            INITIALIZE A(TABLE)                          
*                                                                               
         L     R0,GCOMNXTA         CALCULATE COMMENT LENGTH                     
*                                  AS END MINUS START                           
         SR    R0,R3                                                            
         LTR   R5,R0               SAVE LENGTH FOR SQUASHER                     
         BNP   GCOMSQX             NOTHING FOUND                                
*                                                                               
         ST    R5,12(RF)           RETURN LENGTH TO CALLER                      
*                                                                               
         ICM   RE,15,GCOMPRMS+4    GET PARAMETER                                
         BZ    *+14                                                             
         CLC   =C'NOSQ',0(RE)      NO SQUASH OPTION                             
         BE    GCOMSQX                                                          
*                                                                               
*                                  SQUASH COMMENT                               
         GOTO1 SQUASHER,GCOMDMCB,GCOMTBLA,(R5)                                  
*                                                                               
         L     R1,GCOMPRMA         POINT TO PARAMETER LIST                      
         MVC   12(4,R1),GCOMDMCB+4 RETURN SQUASHED LENGTH                       
*                                                                               
GCOMSQX  DS    0H                                                               
*                                                                               
GCOMX    DS    0H                                                               
         XIT1                                                                   
GCOMPRMA DS    F                   A(PARAMETER LIST)                            
*                                                                               
GCOMPRMS DS    0XL16               PARAMETER LIST SAVEAREA                      
GCOMRECA DS    0A                  A(RECORD)                                    
GCOMELID DS    XL1                 ELEMENT ID                                   
         DS    XL3                                                              
GCOMNOSQ DS    0A                  A(NO SQUASH OPTION)                          
GCOMSE   DS    XL1                 SE NUMBER                                    
         DS    XL3                                                              
*                                                                               
GCOMDMCB DS    6A                  WORK PARAMETER LIST                          
*                                                                               
GCOMNXTA DS    A                   A(NEXT ENTRY IN TABLE)                       
GCOMELMA DS    A                   A(CURRENT COMMENT ELEMENT)                   
GCOMCOMA DS    A                   A(COMMENT RECORD  I/OAREA)                   
GCOMAIOS DS    A                   A(CURRENT I/OAREA ADDRESS)                   
GCOMSESV DS    XL1                 CURRENT SE SAVEAREA                          
*                                                                               
GCOMTBLL EQU   L'BIGTABLE          TABLE LENGTH                                 
GCOMTBLA DC    A(BIGTABLE)         A(COMMENT TABLE)                             
*                                                                               
BIGTABLE DS    XL(30*80)           COMMENT BUILD AREA                           
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - COMMENTS - ICOMRTE'                                  
***********************************************************************         
*                                                                     *         
*        REPORTS COMMISSION RATE                                      *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+0 - RECORD INDICATOR                                  *         
*          GLARGS+1 - FIELD  INDICATOR                                *         
*                     C'R' - COMMISSION RATE                          *         
*                                                                     *         
*EXIT    0(4,R2)           -  RATE                                    *         
*        4(1,R2)           -  RATE TYPE                               *         
*                             X'80' - STATION                         *         
*                             X'40' - OFFICE                          *         
*                             X'20' - ADVERTISER                      *         
*                             X'10' - CONTRACT TYPE                   *         
*                               IF ONE BIT ON THEN PREVIOUS ARE ALSO  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICOMRTE  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ICM   R8,15,RECOMTBA      POINT TO COMMISSION RATE TABLE               
         BZ    ICOMRTEX            SKIP IF NO TABLE                             
*                                                                               
         SR    RF,RF                                                            
*                                                                               
         OC    RECURSTB(2),RECURSTB  SKIP IF NO CURRENT PERIOD                  
         BZ    *+8                                                              
         LA    RF,RECURSTB              SET TO USE CURRENT DATES                
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BZ    *+8                                                              
         LA    RF,GLARGS+9               SET TO USE COLUMN DATES                
*                                                                               
         LTR   RF,RF               SKIP IF NO DATE                              
         BZ    ICOMRTEX                                                         
*                                                                               
         USING COMTTABD,R8         ESTABLISH RATE TABLE                         
*                                                                               
         LM    R3,R5,COMTBXLE      GET BXLE PARAMETERS FOR TABLE                
*                                                                               
         CR    R3,R5                                                            
         BNL   ICOMRTEX            IGNORE IF TABLE EMPTY                        
*                                                                               
         USING COMTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         XC    ICRENTSV,ICRENTSV   INIT SAVEAREA                                
         XC    ICRINDSV,ICRINDSV                                                
*                                                                               
         XC    ICRIND,ICRIND       INDICATORS ACCUMULATOR                       
*                                                                               
ICRLOOP  DS    0H                  FIND RATE ENTRY                              
*                                                                               
         LA    R6,COMTKEY          ESTABLISH KEY IN ENTRY                       
         USING RCOMKEY,R6                                                       
*                                                                               
         CLC   RCOMKSTA,RESTA      MATCH STA                                    
         BNE   ICRDONE                                                          
*                                                                               
         OI    ICRIND,ICRISTAQ     INDICATE STATION MATCH                       
*                                                                               
         OC    RCOMKOFF,RCOMKOFF   SKIP IF NO OFFICE IN KEY                     
         BZ    ICROFFFD                                                         
*                                                                               
         CLC   RCOMKOFF,REOFF      MATCH ON OFFICE                              
         BL    ICRCONT                                                          
         BH    ICRDONE                                                          
*                                                                               
         OI    ICRIND,ICRIOFFQ     INDICATE OFFICE MATCH                        
*                                                                               
ICROFFFD DS    0H                                                               
*                                                                               
         OC    RCOMKADV,RCOMKADV   SKIP IF NO ADVERTISER IN KEY                 
         BZ    ICRADVFD                                                         
*                                                                               
         CLC   RCOMKADV,READV      MATCH ON ADVERTISER                          
         BL    ICRCONT                                                          
         BH    ICRDONE                                                          
*                                                                               
         OI    ICRIND,ICRIADVQ     INDICATE ADVERTISER MATCH                    
*                                                                               
ICRADVFD DS    0H                                                               
*                                                                               
         OC    RCOMKTPE,RCOMKTPE   SKIP IF NO CONTRACT TYPE IN KEY              
         BZ    ICRCTYFD                                                         
*                                                                               
         CLC   RCOMKTPE,RECTY      MATCH ON CONTRACT TYPE                       
         BL    ICRCONT                                                          
         BH    ICRDONE                                                          
*                                                                               
         OI    ICRIND,ICRICTYQ     INDICATE CONTRACT TYPE MATCH                 
*                                                                               
ICRCTYFD DS    0H                                                               
*                                                                               
         CLC   RCOMKDAT,3(RF)      MUST BE BEFORE PERIOD END                    
         BH    ICRDTEX                                                          
*                                                                               
         ST    R3,ICRENTSV         SAVE ENTRY POINTER                           
         MVC   ICRINDSV,ICRIND     SAVE INDICATORS                              
         MVI   ICRIND,0            RESET INDICATORS                             
*                                                                               
ICRDTEX  DS    0H                                                               
*                                                                               
ICRCONT  DS    0H                                                               
*                                                                               
         BXLE  R3,R4,ICRLOOP       NEXT TABLE ENTRY                             
*                                                                               
ICRDONE  DS    0H                                                               
*                                                                               
*        A(CORRECT TABLE ENTRY) IN ICRENTSV                                     
*                                                                               
*                                                                               
         ICM   R3,15,ICRENTSV      POINT TO CORRECT TABLE ENTRY                 
         BZ    ICOMRTEX            NONE FOUND                                   
*                                                                               
         LA    R6,COMTELM          POINT TO RATE ELEMENT                        
         USING RCOMELEM,R6         ESTABLISH RATE ELEMENT                       
*                                                                               
         CLI   RCOMCODE,X'01'      SKIP IF WRONG ELEMENT                        
         BNE   ICOMRTEX                                                         
*                                                                               
         MVC   0(4,R2),RCOMRAT1    RETURN COMMISSION RATE                       
         MVC   4(1,R2),ICRINDSV    RETURN KEY INDICATORS                        
*                                                                               
ICOMRTEX DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
ICRENTSV DS    A                   A(LAST FOUND TABLE ENTRY)                    
*                                                                               
ICRIND   DS    X                   KEY TYPE INDICATORS                          
ICRISTAQ EQU   X'80'                 STATION       IN KEY                       
ICRIOFFQ EQU   X'40'                 OFFICE        IN KEY                       
ICRIADVQ EQU   X'20'                 ADVERTISER    IN KEY                       
ICRICTYQ EQU   X'10'                 CONTRACT TYPE IN KEY                       
*                                                                               
ICRINDSV DS    X                   INDS FOR LAST FOUND TABLE ENTRY              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - CONTRACT/BUY COMMENTS - OCOMRTE'                     
***********************************************************************         
*                                                                     *         
*        PRINTS COMMISSION RATE                                       *         
*                                                                     *         
*NTRY                                                                 *         
*        0(4,R2)           -  COMMISSION RATE                         *         
*        4(1,R2)           -  RATE TYPE                               *         
*                             X'80' - STATION                         *         
*                             X'40' - OFFICE                          *         
*                             X'20' - ADVERTISER                      *         
*                             X'10' - CONTRACT TYPE                   *         
*                               IF ONE BIT ON THEN PREVIOUS ARE ALSO  *         
*                                                                     *         
*EXIT    COMMISSION RATE WITH SOURCE INDICATOR                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OCOMRTE  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         OC    0(5,R2),0(R2)       SKIP IF NO INPUT                             
         BZ    OCOMRTEX                                                         
*                                                                               
         EDIT  (B4,0(R2)),(8,0(R3)),4,TRAIL=C'%' PRINT RATE                     
*                                                                               
         TM    4(R2),X'40'         IF OFFICE RATE                               
         BNO   OCOMRTE1                                                         
*                                                                               
         MVC   8(3,R3),=C'OFF'      INDICATE SO                                 
*                                                                               
         TM    4(R2),X'20'         IF ADV    RATE                               
         BNO   OCOMRTE1                                                         
*                                                                               
         MVC   8(3,R3),=C'ADV'      INDICATE SO                                 
*                                                                               
         TM    4(R2),X'10'         IF CTY    RATE                               
         BNO   OCOMRTE1                                                         
*                                                                               
         MVC   8(3,R3),=C'CTY'      INDICATE SO                                 
*                                                                               
OCOMRTE1 DS    0H                                                               
*                                                                               
OCOMRTEX DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT - ICON'          
***********************************************************************         
*                                                                     *         
*        ROUTINE TO RETRIEVE DATA FROM CONTRACT RECORD                *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        GLARGS+1 -  C'#' - CONTRACT  NUMBER                          *         
*                    C'S' - CONTRACT  STATUS                          *         
*                    C'C' - CONTRACTS COUNT                           *         
*                    C'A' - CONTRACTS ACTIVITY                        *         
*                    C'I' - CONTRACT  INVOICE                         *         
*                    C'M' - CONTRACT  LAST CHANGE DATE                *         
*                    C'P' - CONTRACT  PERIOD                          *         
*                    C'X' - CONTRACTS CONNECTION TYPE                 *         
*         GLARGS+2 -  X'02' - BUYS            RELATED                 *         
*                     X'03' - CONTRACT HEADER RELATED                 *         
*                     X'04' - AVAIL           RELATED                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICON     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO1           POINT TO CURRENT CONTRACT RECORD             
         USING RCONREC,R4          ESTABLISH RECORD                             
*                                                                               
         CLI   RCONKTYP,X'0C'      SKIP IF NOT A CONTRACT RECORD                
         BNE   ICONX                                                            
*                                                                               
         CLC   GLARGS+1(2),=C'CC'  IF CURRENT YR CONTRACT COUNT                 
         BNE   ICONCURN                                                         
*                                                                               
         CLC   REFCURSB,RECONEND   IF OUTSIDE CURRENT DATES, DROP               
         BH    ICONX                                                            
         CLC   REFCUREB,RECONSTR                                                
         BL    ICONX                                                            
*                                                                               
         B     ICONDTEX                                                         
*                                                                               
ICONCURN DS    0H                                                               
*                                                                               
         CLC   GLARGS+1(2),=C'CP'  IF PRIOR YR CONTRACT COUNT                   
         BNE   ICONPRIN                                                         
*                                                                               
         CLC   REFPRISB,RECONEND   IF OUTSIDE PRIOR DATES, DROP                 
         BH    ICONX                                                            
         CLC   REFPRIEB,RECONSTR                                                
         BL    ICONX                                                            
*                                                                               
         B     ICONDTEX                                                         
*                                                                               
ICONPRIN DS    0H                                                               
*                                                                               
         B     ICONDTEX            REPORT ALL CONTRACTS                         
*                                                                               
         CLC   REQPSTRB,RECONEND   IF OUTSIDE DATES, DON'T COUNT                
         BH    ICONX                                                            
         CLC   REQPENDB,RECONSTR                                                
         BL    ICONX                                                            
*                                                                               
         OC    RECURSTB(2),RECURSTB  SKIP IF NO CURRENT PERIOD                  
         BZ    *+24                                                             
         CLC   RECURSTB(2),RECNBENB  CONTRACT MUST BE FOR CURR PERIOD           
         BH    ICONX                                                            
         CLC   RECURENB(2),RECNBSTB    COMPARE BROADCAST MONTHS                 
         BL    ICONX                                                            
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BNZ   *+10                                                             
         OC    GLARGS+12(2),GLARGS+12    SKIP IF NO DATES GIVEN                 
         BZ    ICON10                                                           
*                                                                               
         CLC   GLARGS+9(2),RECNBENB    CONTRACT MUST BE FOR KYW PERIOD          
         BH    ICONX                                                            
         CLC   GLARGS+12(2),RECNBSTB    COMPARE BROADCAST MONTHS                
         BL    ICONX                                                            
*                                                                               
ICONDTEX DS    0H                                                               
*                                                                               
ICON10   DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'#'       CONTRACT NUMBER                              
         BE    ICN#                                                             
*                                                                               
         CLI   GLARGS+1,C'C'       CONTRACT COUNTS                              
         BE    ICNCT                                                            
*                                                                               
         CLI   GLARGS+1,C'S'       CONTRACT STATUS                              
         BE    ICNSTAT                                                          
*                                                                               
         CLI   GLARGS+1,C'P'       CONTRACT PERIOD                              
         BE    ICNPER                                                           
*                                                                               
         CLI   GLARGS+1,C'I'       CONTRACT INVOICE                             
         BE    ICNIV                                                            
*                                                                               
         CLI   GLARGS+1,C'M'       CONTRACT LAST CHANGE DATE                    
         BE    ICNCHG                                                           
*                                                                               
         CLI   GLARGS+1,C'X'       CONTRACT CONNECTION                          
         BE    ICNCNT                                                           
*                                                                               
         CLI   GLARGS+1,C'A'       DARE AGENCY ORDER NUMBER                     
         BE    ICNDAR                                                           
*                                                                               
         B     ICONX               UNKNOWN FIELD                                
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT - ICN#'          
***********************************************************************         
*                                                                     *         
*        CONTRACT NUMBER                                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICN#     DS    0H                  CONTRACT NUMBER                              
*                                                                               
         MVC   0(4,R2),RCONKCON    RETURN CONTRACT NUMBER                       
*                                                                               
*        DETERMINE IF COMBINATION FLAG NEEDED                                   
*                                                                               
         LR    R6,R4               FIND COMBO ELEMENT                           
         MVI   ELCODE,X'17'                                                     
         BRAS  RE,GETEL                                                         
*                                                                               
         USING RCONCBEL,R6         ESTABLISH AS COMBO ELEMENT                   
*                                                                               
         JNE   *+8                 SKIP IF NOT FOUND                            
         MVI   4(R2),C'C'          FLAG AS COMBO CONTRACT                       
*                                                                               
ICN#X    DS    0H                                                               
         B     ICONX                                                            
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT -ICNDAR'         
***********************************************************************         
*                                                                     *         
*        DARE AGENCY ORDER NUMBER                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNDAR   DS    0H                  DARE AGENCY ORDER NUMBER                     
*                                                                               
         LR    R6,R4               R6 = A(CONTRACT RECORD)                      
         MVI   ELCODE,X'1D'        FIND X'1D' ELEMENT                           
         BRAS  RE,GETEL            HAVE DARE AGENCY ORDER ELEMENT?              
         BNE   ICONX               NO - EXIT                                    
*                                                                               
         USING RCONDREL,R6         DARE AGENCY ORDER ELEMENT DSECT              
         TM    RCONDRFG,X'80'      LINKED TO AGENCY ORDER?                      
         BZ    ICONX               NO - EXIT                                    
         MVC   0(4,R2),RCONDRLK    RETURN DARE AGENCY ORDER NUMBER              
         DROP  R6                  DROP USING                                   
*                                                                               
ICNDARX  DS    0H                                                               
         B     ICONX                                                            
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT - ICNCT'         
***********************************************************************         
*                                                                     *         
*        CONTRACTS COUNT                                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNCT    DS    0H                                                               
*                                                                               
         ZAP   0(8,R2),=P'0'       INIT CONTRACT COUNTER                        
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
*        IF CONTRACT PRODUCES MULTIPLE PASSES TO DRIVER                         
*        WE ONLY WANT TO COUNT IT ONCE                                          
*                                                                               
         LA    R5,ICNCTKYS         POINT TO SAVED KEYS                          
*                                                                               
         CLI   0(R5),0             DONE AT END OF TABLE                         
         BE    *+22                                                             
         CLC   0(1,R5),GLARGS+6    MATCH FIELD NUMBER                           
         BE    *+18                MATCH FOUND                                  
         LA    R5,1+L'RCONKEY+6(R5)  BUMP TO NEXT KEY AREA                      
         B     *-22                                                             
         MVC   0(1,R5),GLARGS+6    ADD ENTRY TO TABLE FOR FIELD                 
*                                                                               
         CLC   RECURSTB(6),1+L'RCONKEY(R5)  IF CURRENT DATES NEW                
         BE    *+10                                                             
         XC    1(L'RCONKEY,R5),1(R5)            CLEAR OLD KEY                   
*                                                                               
         CLC   RCONKEY,1(R5)       SKIP IF CONTRACT KEY UNCHANGED               
         BE    ICNCTX                                                           
*                                                                               
         MVC   1(L'RCONKEY,R5),RCONKEY        SAVE NEW KEY                      
         MVC   1+L'RCONKEY(6,R5),RECURSTB     SAVE CURRENT DATES                
*                                                                               
         ZAP   0(8,R2),=P'1'       COUNT AS 1 CONTRACT                          
*                                                                               
         CLI   RESTA+4,C'C'        IF A COMBINED STATION                        
         BNE   *+10                                                             
         ZAP   0(8,R2),=P'2'       COUNT AS 2 CONTRACTS                         
*                                                                               
ICNCTX   DS    0H                                                               
         B     ICONX                                                            
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT-ICNSTAT'         
***********************************************************************         
*                                                                     *         
*        REPORT CONTRACT STATUS - CONFIRMED/UNCONFIRMED DOLLARS       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNSTAT  DS    0H                                                               
*                                                                               
         L     RF,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,RF         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         BZ    ICNSTATX                                                         
*                                                                               
         DROP  RF                                                               
*                                                                               
         MVC   0(2,R2),=C'UC'      DEFAULT IS UNCONFIRMED DOLLARS               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IF DOLLARS ARE CONFIRMED                     
         BNO   *+10                                                             
         MVC   0(2,R2),=C'CF'         CHANGE SPECIFICATION                      
*                                                                               
ICNSTATX DS    0H                                                               
         B     ICONX                                                            
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT-ICNPER'          
***********************************************************************         
*                                                                     *         
*        REPORT CONTRACT PERIOD                                       *         
*        GLARGS+2    C'P'  PERIOD START AND END                       *         
*                    C'S'  PERIOD START                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNPER   DS    0H                                                               
*                                                                               
*        DEFAULT TO ORIGINAL CONTRACT PERIOD                                    
*                                                                               
         LR    R6,R4                                                            
         MVI   ELCODE,X'01'                                                     
         BRAS  RE,GETEL                                                         
         BNE   ICNPER10            ELEMENT NOT FOUND                            
*                                                                               
         USING RCONELEM,R6         ESTABLISH AS DESCRIPTION ELEMENTS            
*                                                                               
         LA    R1,RCONDATE         POINT TO ORIGINAL CONTRACT DATES             
*                                                                               
ICNPER10 DS    0H                                                               
*                                                                               
*        CHECK FOR CUT BACK CONTRACT DATES                                      
*                                                                               
         LR    R6,R4               FIND RANDOM FLAG ELEMENT                     
         MVI   ELCODE,X'1E'                                                     
         BRAS  RE,GETEL                                                         
         BNE   ICNPER50            ELEMENT NOT FOUND                            
*                                                                               
         USING RCONRFLT,R6         ESTABLISH AS RANDOM FLAG ELEMENT             
*                                                                               
         OC    RCONRFLT,RCONRFLT   SKIP IF DATES NOT THERE                      
         BZ    ICNPER50                                                         
*                                                                               
         LA    R1,RCONRFLT         POINT TO REVISED PERIOD                      
*                                                                               
ICNPER50 DS    0H                  PUT OUT DATES                                
*                                                                               
         LA    RF,6                NORMALLY START AND END DATES                 
*                                                                               
         CLI   GLARGS+2,C'S'       IF JUST START DATE                           
         BNE   *+8                                                              
         LA    RF,3                   CUT BACK LENGTH                           
*                                                                               
         CLI   GLARGS+2,C'E'       IF JUST END   DATE                           
         BNE   *+12                                                             
         LA    RF,3                   CUT BACK LENGTH                           
         LA    R1,3(R1)               BUMP TO END DATE                          
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R1)       RETURN DATE(S)                               
*                                                                               
ICNPERX DS     0H                                                               
         B     ICONX                                                            
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT-ICNCHG'          
***********************************************************************         
*                                                                     *         
*        REPORT CONTRACT LAST CHANGE DATE                             *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNCHG   DS    0H                                                               
*                                                                               
*        FIND CONTRACT HEADER ELEMENT                                           
*                                                                               
         LR    R6,R4                                                            
         MVI   ELCODE,X'01'                                                     
         BRAS  RE,GETEL                                                         
         BNE   ICNCHGX             ELEMENT NOT FOUND                            
*                                                                               
         USING RCONELEM,R6         ESTABLISH AS DESCRIPTION ELEMENTS            
*                                                                               
         LA    R1,RCONMODD         POINT TO LAST CHANGE DATE                    
*                                                                               
         OC    RCONMODD,RCONMODD   IF NO LAST CHANGE DATE                       
         BNZ   *+8                                                              
         LA    R1,RCONHDRD           DEFAULT TO HEADER CREATION DATE            
*                                                                               
         MVC   0(3,R2),0(R1)       RETURN DATE                                  
*                                                                               
ICNCHGX DS     0H                                                               
         B     ICONX                                                            
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT-ICNIV'           
***********************************************************************         
*                                                                     *         
*        REPORT CONTRACT INVOICE DATA                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNIV    DS    0H                                                               
*                                                                               
         LR    R6,R4               FIND INVOICE ELEMENT                         
         MVI   ELCODE,X'18'                                                     
         BRAS  RE,GETEL                                                         
         JNE   ICNIVX              NONE FOUND                                   
*                                                                               
         USING RCONDVEL,R6         ESTABLISH AS INVOICE # ELEMENT               
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,RCONDVI#       GET NUMBER OF INVOICES                       
         BZ    ICNIVDN             NO INVOICES                                  
*                                                                               
         SR    RF,RF                                                            
         LA    R1,RCONDVIL         POINT TO FIRST INVOICE                       
         USING RCONDVIL,R1         ESTABLISH INVOICE DATA                       
*                                                                               
ICNIVLP  DS    0H                                                               
*                                                                               
         CLC   REQPSTRB(2),RCONDVID  SKIP IF OUTSIDE DATES                      
         BH    ICNIVCN                                                          
         CLC   REQPENDB(2),RCONDVID                                             
         BL    ICNIVCN                                                          
*                                                                               
         OC    RECURSTB(2),RECURSTB    SKIP IF NO CURRENT PERIOD                
         BZ    *+24                                                             
         CLC   RECURSTB(2),RCONDVID    INVOICE MUST BE FOR CURR PERIOD          
         BH    ICNIVCN                                                          
         CLC   RECURENB(2),RCONDVID    COMPARE BROADCAST MONTHS                 
         BL    ICNIVCN                                                          
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BNZ   *+10                                                             
         OC    GLARGS+12(2),GLARGS+12    SKIP IF NO DATES GIVEN                 
         BZ    ICNIV10                                                          
*                                                                               
         CLC   GLARGS+9(2),RCONDVID      INVOICE MUST BE FOR KYW PERIOD         
         BH    ICNIVCN                                                          
         CLC   GLARGS+12(2),RCONDVID     COMPARE BROADCAST MONTHS               
         BL    ICNIVCN                                                          
*                                                                               
ICNIV10  DS    0H                                                               
*                                                                               
         CLI   GLARGS+2,C'D'       IF DATE WANTED                               
         BNE   *+14                                                             
         MVC   0(2,R2),RCONDVID       RETURN DATE                               
         B     ICNIVDN                ONLY ONE DATE ALLOWED                     
*                                                                               
         CLI   GLARGS+2,C'#'       IF INVOICE NUMBER WANTED                     
         BNE   ICNIV#N                                                          
*                                                                               
         IC    RF,RCONDVIL         GET SEGMENT LENGTH                           
         AHI   RF,-3               SUBTRACT OVERHEAD                            
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),RCONDVIN    PASS BACK INVOICE NUMBER                     
*                                                                               
         B     ICNIVDN             ONLY ONE NUMBER ALLOWED                      
*                                                                               
ICNIV#N  DS    0H                                                               
*                                                                               
ICNIVCN  DS    0H                                                               
*                                                                               
         IC    RF,RCONDVIL         GET SEGMENT LENGTH                           
         LA    R1,0(RF,R1)         BUMP TO NEXT SEGMENT                         
         BCT   R0,ICNIVLP                                                       
*                                                                               
ICNIVDN  DS    0H                                                               
*                                                                               
ICNIVX   DS    0H                                                               
*                                                                               
         B     ICONX                                                            
*                                  KEY SAVEAREAS                                
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT-ICNCNT'          
***********************************************************************         
*                                                                     *         
*        REPORT CONTRACT CONNECTION TYPE                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
ICNCNT   DS    0H                                                               
*                                                                               
         MVI   0(R2),C'3'          DEFAULT TO MANUAL CONNECTION                 
*                                                                               
         LR    R6,R4               FIND DARE ELEMENT                            
         MVI   ELCODE,X'1D'                                                     
         BRAS  RE,GETEL                                                         
         JNE   ICNCNTX             NONE FOUND                                   
*                                                                               
         USING RCONDREL,R6         ESTABLISH AS DARE ORDER ELM                  
*                                                                               
         TM    RCONDRFG,X'06'      IF DARE ORDER                                
         BNZ   *+8                                                              
         MVI   0(R2),C'1'             FLAG AS SUCH                              
*                                                                               
         TM    RCONDRF2,X'01'      IF XML CONNECTION                            
         BNO   *+8                    RESET FLAG                                
         MVI   0(R2),C'2'                                                       
*                                                                               
ICNCNTX  DS    0H                                                               
*                                                                               
         B     ICONX                                                            
*                                                                               
ICONX    DS    0H                                                               
         XIT1                                                                   
*                                  KEY SAVEAREAS                                
ICNCTKYS DS    16XL(1+L'RCONKEY+6)   FLD NUMBER,CONTRACT KEY,DATES              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD SPECIAL OUTPUT - OCON'               
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT SPECIAL FIELDS IN CONTRACT RECORD           *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        GLARGS+1 -  C'#' - CONTRACT NUMBER                           *         
*                                                                     *         
*                 -  C'D' - CONTRACT DATES                            *         
*                                                                     *         
*                 -  C'X' - CONTRACT AGENCY CONNECTION                *         
*                                                                     *         
*        R2==>  XL4 CONTRACT NUMBER                                   *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OCON     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+1,C'#'       CONTRACT NUMBER                              
         BE    OCON#                                                            
*                                                                               
         CLI   GLARGS+1,C'D'       CONTRACT DATES                               
         BE    OCOND                                                            
*                                                                               
         CLI   GLARGS+1,C'X'       CONTRACT CONNECTION                          
         BE    OCONC                                                            
*                                                                               
         CLI   GLARGS+1,C'A'       DARE AGENCY CONTRACT NUMBER?                 
         BE    OCONA                                                            
*                                                                               
         B     OCONX               UNKNOWN FIELD                                
*                                                                               
OCON#    DS    0H                                                               
*                                                                               
         OC    0(4,R2),0(R2)       SKIP IF NO DATA PROVIDED                     
         BZ    OCON#X                                                           
*                                                                               
         UNPK  CODEAREA(9),0(5,R2)  NUMBER IS PWOS                              
         MVI   CODEAREA+8,C' '      CLEAR EXTRA BYTE                            
*                                                                               
         CLI   4(R2),C' '          IF THERE IS A TRAILING INDICATOR             
         BNH   *+10                                                             
         MVC   CODEAREA+8(1),4(R2)    PRINT IT                                  
*                                                                               
         GOTO1 GENOUTA                                                          
*                                                                               
OCON#X   DS    0H                                                               
*                                                                               
         B     OCONX                                                            
*                                                                               
OCONA    DS    0H                                                               
*                                                                               
         OC    0(4,R2),0(R2)       SKIP IF NO DATA PROVIDED                     
         BZ    OCONAX                                                           
*                                                                               
         GOTO1 HEXOUT,DMCB,0(R2),CODEAREA,4,=C'TOG'                             
*                                                                               
         GOTO1 GENOUTA                                                          
*                                                                               
OCONAX   DS    0H                                                               
*                                                                               
         B     OCONX                                                            
*                                                                               
OCOND    DS    0H                  CONTRACT DATES                               
*                                                                               
         OC    0(6,R2),0(R2)       SKIP IF NO DATA                              
         BZ    OCONDX                                                           
*                                                                               
         LA    R0,X'10'+X'03'      PAIR OF BINARY DATES                         
         GOTO1 DATCON,DMCB,((R0),0(R2)),(17,0(R3))                              
*                                                                               
OCONDX   DS    0H                                                               
*                                                                               
         B     OCONX                                                            
*                                                                               
OCONC    DS    0H                  CONTRACT CONNECTION                          
*                                                                               
         OC    0(1,R2),0(R2)       SKIP IF NO DATA                              
         BZ    OCONCX                                                           
*                                                                               
         LA    R1,OCONCTB          POINT TO CONNECTION TABLE                    
         LA    R0,OCONCTB#         NUMBER OF TABLE ENTRIES                      
*                                                                               
         CLC   0(1,R2),0(R1)       MATCH TO TABLE ENTRY                         
         BE    *+16                                                             
         LA    R1,OCONCTBL(R1)     BUMP TO NECT TABLE ENTRY                     
         BRCT  R0,*-14                                                          
         B     OCONCX              NO ENTRY IN TABLE                            
*                                                                               
         MVC   0(6,R3),1(R1)       MOVE DESCRIPTION TO OUTPUT                   
*                                                                               
OCONCX   DS    0H                                                               
*                                                                               
         B     OCONX                                                            
*                                                                               
OCONCTB  DS    0C                  TRANSLATE TABLE FOR CONNECTION               
         DC    C'1',CL6'DARE'      TYPE,TRANSLATION                             
OCONCTBL EQU   *-OCONCTB           TABLE ENTRY LENGTH                           
*                                                                               
         DC    C'2',CL6'XML'                                                    
         DC    C'3',CL6'MANUAL'                                                 
OCONCTB# EQU   (*-OCONCTB)/OCONCTBL # OF ENTRIES IN TABLE                       
*                                                                               
OCONX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - CONTRACT TYPE - ICTY'                        
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT CONTRACT TYPE FROM CONTRACT RECORD        *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICTY     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   ICTYRGNN                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    ICTYX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    ICTYX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    ICTYX                                                            
*                                                                               
                                                                                
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    ICTYX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    ICTYX                                                            
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-18                                                          
         B     ICTYX               NO DATA TYPE MATCH                           
*                                                                               
         MVC   ICTYSCTY,0(R1)      SAVE CONTRACT TYPE                           
*                                                                               
         B     ICTYFND             CONTRACT TYPE FOUND                          
*                                                                               
ICTYRGNN DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         BNE   ICTYCONN                                                         
*                                                                               
*        EXTRACT CONTRACT TYPE'S CODE FROM CONTRACT                             
*                                                                               
ICTYCON  DS    0H                                                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ICTYX                  NO ELEMENT                                
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
*        FIND CONTRACT TYPE CODE FOR CONTRACT                                   
*                                                                               
         MVC   ICTYSCTY,RCONTYPE      SAVE CONTRACT TYPE CODE                   
*                                                                               
         B     ICTYFND                                                          
*                                                                               
ICTYCONN DS    0H                                                               
*                                                                               
*        SHOULD BE BUDGET RECORD                                                
*                                                                               
         L     R4,REANWMON         POINT TO BUDGET MONTH TABLE                  
         USING BDMNTABD,R4         ESTABLISH TABLE                              
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**' SKIP IF NOT BUDGET TABLE             
         BNE   ICTYBUDN                                                         
*                                                                               
         MVC   ICTYSCTY,BDMTCTP    RETRIEVE CONTRACT TYPE                       
*                                                                               
         B     ICTYFND                                                          
*                                                                               
ICTYBUDN DS    0H                                                               
*                                                                               
         B     ICTYX               UNIDENTIFIED DATA SOURCE                     
*                                                                               
ICTYFND  DS    0H                                                               
*                                                                               
         CLC   ICTYSCTY,RESPACES   GIVE UP IF NO CODE FOUND                     
         BNH   ICTYX                                                            
*                                                                               
*        BUILD SORT OUTPUT                                                      
*                                                                               
         CLI   GLARGS+1,C'S'             IF NOT SORTING BY NAME                 
         BE    *+10                                                             
         MVC   0(L'RCTYKCTY,R2),ICTYSCTY    RETURN CONTRACT TYPE CODE           
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY WANTED                     
         BE    ICTYCNMX                                                         
*                                                                               
         LA    R5,L'RCTYKCTY(R2)            POINT TO NAME AREA                  
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R5,10(R5)              BUMP PAST NAMEAREA                        
*                                                                               
*        BUILD LOOK UP DATA                                                     
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         MVC   0(L'RCONKREP,R5),REDMREP    SET REP CODE                         
         LA    R5,L'RCONKREP(R5)           BUMP TO NEXT AREA                    
*                                                                               
         MVC   0(L'RCTYKCTY,R5),ICTYSCTY   SET CTY CODE                         
         LA    R5,L'RCTYKCTY(R5)           BUMP TO NEXT AREA                    
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   ICTYCNMX                                                         
*                                                                               
         LA    R3,WORK                POINT TO A WORKAREA                       
*                                                                               
         GOTO1 =A(OID)                LOOK UP NAME IN TABLE                     
*                                                                               
         LA    R5,L'RCTYKCTY(R2)      POINT TO NAME AREA                        
         MVC   0(10,R5),NAMEAREA      ADD NAME TO OUTPUT                        
*                                  ONLY 10 CHS TO SAVE SPACE IN SORT KY         
*                                                                               
ICTYCNMX DS    0H                                                               
*                                                                               
ICTYX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ICTYSCTY DS    XL(L'RCTYKCTY)      CONTRACT TYPE CODE SAVEAREA                  
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - CONTRACT TYPE - ICST'                        
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT COMPETIVE STATIONS DATA FROM CONTRACT     *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  RECORD ID X'0C' FOR CONTRACT                     *         
*        GLARGS+1 -  DATA ID                                          *         
*                    C'%' - MARKET SHARE AS PER CENT                  *         
*                    C'$' - MARKET DOLLARS                            *         
*                    C'B' - DATE OF FIRST BUYLINE                     *         
*                    C'M' - MARKET TOTAL DOLLARS                      *         
*                    C'P' - REP STATION SHARE AS PER CENT             *         
*                    C'S' - CONTRACT STATUS - WIN/LOSS                *         
*                                                                     *         
*EXIT                                                                 *         
*        R2==>  C'P' & C'%' - PL8 STATION DOLLARS                     *         
*                             PL8 MARKET DOLLARS                      *         
*               C'B'        - PL3 BINARY DATE                         *         
*               C'S'        - PL4'N' N=1 IF PENDING    ELSE N=0       *         
*                             PL4'N',N=1 IF INCOMPLETE ELSE N=0       *         
*                             PL4'N',N=1 IF A LOSS     ELSE N=0       *         
*                             PL4'N',N=1 IF A WIN      ELSE N=0       *         
*               C'$' & C'M' - PL8 DOLLARS                             *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICST     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   ICSTARGS,GLARGS     SAVE ARGUMENTS                               
*                                                                               
         CLI   FLAVOR,C'C'         SKIP IF NOT CONTRACT REPORT                  
         BE    *+8                                                              
         CLI   FLAVOR,C'F'         SKIP IF NOT CONTRACT REPORT                  
         BNE   ICSTX                                                            
*                                                                               
         ICM   R4,15,REAIO1                                                     
         BZ    ICSTX                                                            
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         BNE   ICSTX                                                            
*                                                                               
*        DETERMINE DATA TYPE                                                    
*                                                                               
         CLI   ICSTARGS+1,C'B'     FIRST BUYLINE CREATION DATE                  
         BE    ICSTBCD                                                          
*                                                                               
         CLI   ICSTARGS+1,C'S'     STATUS - WON LOSS                            
         BE    ICSTSTAT                                                         
*                                                                               
*        FOLLOWING MAY DEPEND ON CURRENT OR PRIOR DATES                         
*                                                                               
         LA    RF,REFCURSB         ASSUME CURRENT DATES NEEDED                  
         CLI   GLARGS+2,C'P'       CHECK IF PRIOR DATES NEEDED                  
         BNE   *+8                                                              
         LA    RF,REFPRISB         YES - POINT TO PRIOR DATE RANGE              
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BNZ   *+10                                                             
         OC    GLARGS+12(2),GLARGS+12    SKIP IF NO DATES GIVEN                 
         BZ    ICSTRNGX                                                         
*                                                                               
         GOTOR CNVBRD,ICSTPRMS,GLARGS+9,ICSTBSTR   FIND BROADCAST DATES         
*                                                                               
         LA    RF,ICSTBSTR               USE DATES IN ARGUMENTS                 
*                                                                               
ICSTRNGX DS    0H                                                               
*                                                                               
         CLC   RCONDATE(3),3(RF)   CONTRACT MUST OVERLAP DATE RANGE             
         BH    ICSTX                  START AFTER  END   OF RANGE               
         CLC   RCONDATE+3(3),0(RF)                                              
         BL    ICSTX                  END   BEFORE START OF RANGE               
*                                                                               
         CLI   ICSTARGS+1,C'%'     COMPETITIVE STAS SHARE                       
         BE    ICSTSHR                                                          
*                                                                               
         CLI   ICSTARGS+1,C'$'     COMPETITIVE STAS DOLLARS                     
         BE    ICSTSHR                                                          
*                                                                               
         CLI   ICSTARGS+1,C'M'     MARKET TOTAL DOLLARS                         
         BE    ICSTMKT                                                          
*                                                                               
         CLI   ICSTARGS+1,C'P'     REP STATION SHARE                            
         BE    ICSTSHR                                                          
*                                                                               
         B     ICSTX               UNKNOWN DATATYPE                             
*                                                                               
         EJECT                                                                  
*                                                                               
*        FIND DATE OF FIRST BUYLINE                                             
*                                                                               
ICSTBCD  DS    0H                                                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ICSTX                  NO ELEMENT                                
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         TM    RCONMODR,X'70'      SKIP IF NO FIRST BUYLINE                     
         BZ    *+10                                                             
         MVC   0(3,R2),RCONCREA    RETURN CREATION/BUYLINE 1 DATE               
*                                                                               
ICSTBCDX DS    0H                                                               
*                                                                               
         B     ICSTX                                                            
*                                                                               
         EJECT                                                                  
*                                                                               
*        FIND STATION'S SHARE OR DOLLARS                                        
*                                                                               
ICSTSHR  DS    0H                                                               
*                                                                               
*        FIND STATION CALL LETTERS                                              
*                                                                               
         ICM   R5,15,REAIO3        POINT TO STATION RECORD                      
         BZ    ICSTSHRX            NO STATION AVAILABLE                         
*                                                                               
         USING RSTAREC,R5          ESTABLISH STATION RECORD                     
*                                                                               
         CLI   RSTAKTYP,RSTAKTYQ   DONE IF NOT A STATION RECORD                 
         BNE   ICSTSHRX                                                         
*                                                                               
         CLI   ICSTARGS+1,C'P'     IF LOOKING FOR REP'D STATION SHARE           
         BNE   *+20                                                             
         MVC   ICSTSTAC,RSTAKSTA      USE REPORTING STATION                     
         MVC   ICSTAFF,RSTAAFFL       SAVE AFFILIATION                          
         B     ICSTSSTX                                                         
*                                                                               
*        FIND STATION IN MARKETS ELEMENTS                                       
*                                                                               
         CLI   ICSTARGS+11,0       SKIP IF NOT FLOWCHARTING BY STATION          
         BE    ICSTSHRX                                                         
*                                                                               
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
         SR    R0,R0               INIT STATION COUNTER                         
*                                                                               
ICSTSSTL DS    0H                                                               
*                                                                               
         USING RSTAMKEL,R6         ESTABLISH SPL ELEMENT                        
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ICSTSHRX               STATION NOT IN MARKET                     
*                                                                               
         CLI   0(R6),X'02'         FIND STATIONS IN MARKET ELEMENT              
         BNE   ICSTSSTC                                                         
*                                                                               
         AH    R0,=H'1'            BUMP STATION COUNTER                         
*                                                                               
         CLM   R0,1,ICSTARGS+11    CHECK IF STATION DESIRED                     
         BE    ICSTSSTF                                                         
*                                                                               
ICSTSSTC DS    0H                                                               
*                                                                               
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     ICSTSSTL                                                         
*                                                                               
ICSTSSTF DS    0H                  STATION FOUND                                
*                                                                               
         MVC   ICSTSTAC,RSTAMKST   SAVE CALL LETTERS                            
         MVC   ICSTAFF,RSTAMKAF    SAVE AFFILIATION                             
*                                                                               
         DROP  R6                                                               
*                                                                               
ICSTSSTX DS    0H                                                               
*                                                                               
*        FIND SPL ELEMENT                                                       
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
ICSTSPLP DS    0H                                                               
*                                                                               
         USING RCONSPEL,R6         ESTABLISH SPL ELEMENT                        
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ICSTSHRX               NO ELEMENT                                
*                                                                               
         CLI   0(R6),X'06'         FIND SPL ELEMENT                             
         BE    ICSTSPFD                                                         
*                                                                               
ICSTSPCN DS    0H                                                               
*                                                                               
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     ICSTSPLP                                                         
*                                                                               
ICSTSPFD DS    0H                                                               
*                                                                               
*        FIND STATION MINI-ELEMENT                                              
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,RCONSPNU       NUMBER OF STATIONS                           
         BZ    ICSTSHRX            NO STATIONS IN MARKET                        
*                                                                               
         LA    R3,RCONSPST         START OF STATIONS                            
         USING RCONSPST,R3         ESTABLISH STATION MINI-ELEMENT               
*                                                                               
         CLC   RCONSPST,ICSTSTAC   FIND STATION MINI-ELEMENT                    
         BE    *+16                                                             
         LA    R3,L'RCONSPST+L'RCONSPAM(R3) NEXT MINI-ELEMENT                   
         BCT   R0,*-14                                                          
         B     ICSTSHRX            NO MINI-ELEMENT FOR STATION                  
*                                                                               
         BAS   RE,ICSTTTL          GET MARKET TOTALS                            
*                                                                               
*        FIND DOLLAR SHARE FOR COMPETITIVE STATIONS                             
*                                                                               
ICSTDLR  DS    0H                                                               
*                                                                               
         CLI   ICSTARGS+1,C'$'     IF DOLLARS WANTED                            
         BNE   ICSTDLRN                                                         
*                                                                               
         ICM   RF,15,RCONSPAM         GET BUCKET                                
         CVD   RF,DUB                                                           
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         TM    RCONSPES,X'04'         IF BUCKETS ARE NOT PERCENTAGES            
         BO    ICSTDLR1                                                         
*                                                                               
         ZAP   ICSTOVR$,0(8,R2)          THEY ARE DOLLARS                       
         BAS   RE,ICSTALOC               ALLOCATE TO CONTRACT PERIOD            
         ZAP   0(8,R2),ICSTOVR$          RETURN ALLOCATED DOLLARS               
*                                                                               
         B     ICSTDLRX                  DONE                                   
*                                                                               
ICSTDLR1 DS    0H                     ELSE BUCKETS ARE PERCENTS                 
*                                                                               
         ZAP   ICSTWORK,ICSTMKTL           MARKET TOTAL                         
         MP    ICSTWORK,0(8,R2)            * STATION PERCENTAGE                 
         SRP   ICSTWORK,64-4,5             ROUND TO 2 DECIMALS                  
         ZAP   0(8,R2),ICSTWORK            RETURN STATION DOLLARS               
*                                                                               
ICSTDLRX DS    0H                                                               
         B     ICSTSHRX                                                         
*                                                                               
ICSTDLRN DS    0H                                                               
*                                                                               
*        PERCENTS WANTED                                                        
*                                                                               
ICSTPCT  DS    0H                                                               
*                                                                               
         ZAP   8(8,R2),ICSTMKTL    RETURN MARKET  DOLLARS                       
*                                                                               
         CLI   ICSTARGS+1,C'P'     IF REP'D STATION SHARE WANTED                
         BNE   *+14                                                             
         ZAP   0(8,R2),ICSTSTTL       RETURN REP'D STATION DOLLARS              
         B     ICSTPCTX                                                         
*                                                                               
         TM    RCONSPES,X'04'      IF BUCKETS ARE NOT PERCENTAGES               
         BO    ICSTPCT1                                                         
*                                                                               
         ICM   RF,15,RCONSPAM                                                   
         CVD   RF,ICSTOVR$            THEY ARE DOLLARS                          
         BAS   RE,ICSTALOC            ALLOCATE TO CONTRACT PERIOD               
         ZAP   0(8,R2),ICSTOVR$       RETURN ALLOCATED DOLLARS                  
*                                                                               
         B     ICSTPCTX                                                         
*                                                                               
ICSTPCT1 DS    0H                                                               
*                                  ELSE BUCKETS ARE PERCENTS                    
         ICM   RF,15,RCONSPAM         GET BUCKET                                
         CVD   RF,DUB                                                           
         ZAP   0(8,R2),DUB                                                      
         ZAP   ICSTWORK,ICSTMKTL      MARKET TOTAL                              
         MP    ICSTWORK,0(8,R2)       * STATION PERCENTAGE                      
         SRP   ICSTWORK,64-4,5        ROUND TO 2 DECIMALS                       
         ZAP   0(8,R2),ICSTWORK       RETURN STATION DOLLARS                    
*                                                                               
ICSTPCTX DS    0H                                                               
*                                                                               
ICSTSHRX DS    0H                                                               
*                                                                               
         B     ICSTX                                                            
*                                                                               
         DROP  R3,R6                                                            
*                                                                               
*        RETURN MARKET TOTAL DOLLARS                                            
*                                                                               
ICSTMKT  DS    0H                                                               
*                                                                               
*        FIND SPL ELEMENT                                                       
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ICSTSHRX               NO ELEMENT                                
         CLI   0(R6),X'06'         FIND SPL ELEMENT                             
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONSPEL,R6         ESTABLISH SPL ELEMENT                        
*                                                                               
         BAS   RE,ICSTTTL          GET MARKET TOTAL DOLLARS                     
*                                                                               
         ZAP   0(8,R2),ICSTMKTL    RETURN MARKET TOTAL DOLLARS                  
*                                                                               
ICSTMKTX DS    0H                                                               
         B     ICSTX                                                            
*                                                                               
*        DETERMINE WHETHER A WIN OR LOSS                                        
*                                                                               
ICSTSTAT DS    0H                                                               
*                                                                               
         L     R6,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,R6         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         ICM   R6,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         BZ    ICSTSTAX                                                         
*                                                                               
         DROP  R6                                                               
*                                                                               
         ZAP   0(4,R2),=P'0'       INIT OUTPUT                                  
         ZAP   4(4,R2),=P'0'                                                    
         ZAP   8(4,R2),=P'0'                                                    
         ZAP   12(4,R2),=P'0'                                                   
*                                                                               
         CLI   CSPENDNG(R6),C'Y'   IF PENDING                                   
         BE    *+8                                                              
         CLI   CSPENDNG(R6),C'P'   IF PENDING                                   
         BNE   *+14                                                             
         ZAP   0(4,R2),=P'1'          SET INDICATOR                             
         B     ICSTSTAX                                                         
*                                                                               
         TM    CSFRMISC(R6),X'80'  IF INCOMPLETE                                
         BNO   *+14                                                             
         ZAP   4(4,R2),=P'1'          SET INDICATOR                             
         B     ICSTSTAX                                                         
*                                                                               
         CLI   CSSPLOSS(R6),C'Y'   IF A LOSS                                    
         BNE   *+14                                                             
         ZAP   8(4,R2),=P'1'          SET INDICATOR                             
         B     ICSTSTAX                                                         
*                                                                               
         ZAP   12(4,R2),=P'1'      ELSE A WINNER                                
*                                                                               
ICSTSTAX DS    0H                                                               
*                                                                               
ICSTX    DS    0H                                                               
         MVC   GLARGS,ICSTARGS     RESTORE ARGUMENTS                            
         XIT1                                                                   
*                                                                               
ICSTBKDA DC    XL4'0C000000'       CURRENT BOOKED DOLLARS ARGUMENTS             
ICSTBKDP DC    XL4'0C180000'       PRIOR   BOOKED DOLLARS ARGUMENTS             
*                                                                               
ICSTARGS DS    XL16                GLARGS SAVEAREA                              
*                                                                               
ICSTSTAC DS    CL5                 STATION CALL LETTERS                         
ICSTAFF  DS    CL3                 STATION AFFILIATION                          
         DS    0D                  ALIGNMENT                                    
ICSTOVR$ DS    PL8                 OVERRIDE DOLLARS                             
*                                                                               
ICSTCBKD DS    PL8                 CURRENT BOOKED DOLLARS FOR STATION           
ICSTMKTL DS    PL8                 MARKET TOTAL DOLLARS                         
ICSTSTTL DS    PL8                 REP'D STATION TOTAL DOLLARS                  
*                                                                               
ICSTSTPC DS    PL8                 STATION PER CENT                             
*                                                                               
ICSTWORK DS    0PL16               PACKED WORKAREA                              
ICSTQUOT DS    PL8                 QUOTIENT                                     
ICSTRMDR DS    PL8                 REMAINDER                                    
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'RENWRTER - INPUT - CONTRACT TYPE - ICSTTTL'                     
***********************************************************************         
*                                                                     *         
*        ROUTINE TO CALCULATE MARKET AND REP'D STATION DOLLARS        *         
*                                                                     *         
*NTRY    R6    ===>  RCONSPEL ELEMENT                                 *         
*        I/O1     -  CONTRACT RECORD                                  *         
*                                                                     *         
*EXIT    ICSTMKTL - TOTAL DOLLARS FOR MARKET                          *         
*        ICSTSTTL - TOTAL DOLLARS FOR REP'D STATION                   *         
*        ICSTSTPC - PER CENT FOR REP'D STATION                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICSTTTL  NTR1  LABEL=*                                                          
*                                                                               
*        FIND SPL ELEMENT                                                       
*                                                                               
         ZAP   ICSTSTTL,=P'0'      INIT REP'D STATION DOLLARS                   
         ZAP   ICSTMKTL,=P'0'      INIT MARKET        DOLLARS                   
         ZAP   ICSTSTPC,=P'0'      INIT REP'D STATION PER CENT                  
*                                                                               
         USING RCONSPEL,R6         ESTABLISH SPL ELEMENT                        
*                                                                               
*        SPL BUCKETS ARE PER CENTS                                              
*                                                                               
         TM    RCONSPES,X'04'      IF BUCKETS ARE PER CENTS                     
         BNO   ICSTTPCN                                                         
*                                                                               
         ICM   RF,15,RCONSPAM         REP'D STATION'S PER CENT                  
         CVD   RF,DUB                   IS IN FIRST MINI-ELEMENT                
         ZAP   ICSTSTPC,DUB                                                     
*                                                                               
*******  TM    RCONSPES,X'60'         SKIP IF NO OVERRIDES                      
         TM    RCONSPES,X'40'         SKIP IF NOT A LOSS                        
         BNO   ICSTTOVN                                                         
*                                                                               
*        FIND ACTIVITY ELEMENT FOR OVERRIDES                                    
*                                                                               
         LR    R5,R6               COPY ELEMENT POINTER                         
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R5),0             CHECK FOR END OF RECORD                      
         BE    ICSTTPCX               NO ELEMENT                                
         CLI   0(R5),X'08'         FIND ACTIVITY ELEMENT                        
         BE    *+16                                                             
         IC    RF,1(R5)                                                         
         LA    R5,0(RF,R5)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         ICM   RF,15,RCONAC$$-RCONACEL(R5)   GET OVERRIDE DOLLARS               
         CVD   RF,ICSTOVR$                                                      
         SRP   ICSTOVR$,2,0        ADD IN PENNIES                               
*                                                                               
         BAS   RE,ICSTALOC         ALLOC OVERRIDE $'S TO BUCKET PERIOD          
*                                                                               
         TM    RCONSPES,X'40'      IF TOTAL BUDGET                              
         BNO   ICSTTMKN                                                         
*                                                                               
         ZAP   ICSTMKTL,ICSTOVR$      USE AS MARKET DOLLARS                     
         ZAP   ICSTSTTL,=P'0'         REP'D STATION TOTAL DOLLARS               
*                                                                               
         B     ICSTTPCX                                                         
*                                                                               
ICSTTMKN DS    0H                                                               
*                                                                               
         TM    RCONSPES,X'20'      IF REP'D STATION DOLLARS                     
         BNO   ICSTTPCX                  SHOULDN'T HAPPEN                       
*                                                                               
         ZAP   ICSTSTTL,ICSTOVR$      SAVE AS STATION DOLLARS                   
*                                                                               
         ZAP   ICSTWORK,ICSTSTTL      CALCULATE MARKET TOTAL AS                 
         SRP   ICSTWORK,5,0           REP'D STATION TOTAL/STATION PCT.          
*                                                                               
         CP    ICSTSTPC,=P'0'      IF NO PERCENTAGE FOR STATION                 
         BNE   ICSTTPC1                                                         
*                                                                               
         ZAP   ICSTSTTL,=P'0'         KILL STATION TOTAL                        
         B     ICSTTPCX                                                         
*                                                                               
ICSTTPC1 DS    0H                                                               
*                                                                               
         DP    ICSTWORK,ICSTSTPC                                                
         SRP   ICSTQUOT,64-1,5                                                  
         ZAP   ICSTMKTL,ICSTQUOT      MARKET TOTAL                              
*                                                                               
         B     ICSTTPCX                                                         
*                                                                               
*        BUCKETS ARE PERCENTS WITHOUT OVERRIDES                                 
*                                                                               
ICSTTOVN DS    0H                                                               
*                                                                               
         LA    RF,ICSTBKDA         ASSUME CURRENT DOLLARS WANTED                
         CLI   GLARGS+2,C'P'       IF PRIOR DOLLARS WANTED                      
         BNE   ICSTDL1                                                          
*                                                                               
         LA    RF,ICSTBKDP            USE APPROPRIATE ARGUMENTS                 
         SR    RE,RE                                                            
*                                                                               
         ICM   RE,1,GLARGS+9       IF START YEAR PRESENT                        
         BZ    *+12                                                             
         AHI   RE,1                   BUMP BY A YEAR                            
         STC   RE,GLARGS+9                                                      
*                                                                               
         ICM   RE,1,GLARGS+12      IF END   YEAR PRESENT                        
         BZ    *+12                                                             
         AHI   RE,1                   BUMP BY A YEAR                            
         STC   RE,GLARGS+12                                                     
*                                                                               
ICSTDL1  DS    0H                                                               
*                                                                               
         MVC   GLARGS(4),0(RF)     FIND BOOKED DOLLARS                          
         GOTO1 =A(IDOL)                                                         
         ZAP   ICSTSTTL,0(8,R2)                                                 
         ZAP   0(8,R2),=P'0'       RE-INIT RETURN AREA                          
*                                                                               
         ZAP   ICSTWORK,ICSTSTTL   CURRENT BOOKED DOLLARS                       
         SRP   ICSTWORK,5,0        *100000 FOR SETTING DECIMAL                  
*                                                                               
         CP    ICSTSTPC,=P'0'      NO DECIMAL DIVIDE                            
         BE    *+22                                                             
         DP    ICSTWORK,ICSTSTPC   MARKET DOLLARS                               
         SRP   ICSTQUOT,64-1,5     ROUND TO PENNIES                             
         ZAP   ICSTMKTL,ICSTQUOT   SAVE MARKET DOLLARS                          
*                                                                               
ICSTTPCX DS    0H                                                               
*                                                                               
         B     ICSTTTLX                                                         
*                                                                               
ICSTTPCN DS    0H                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
*        SPL ELEMENT BUCKETS ARE DOLLARS                                        
*                                                                               
ICSTTDL  DS    0H                                                               
*                                                                               
*        MARKET TOTAL IS SUM OF DOLLARS FOR ALL STATIONS IN MARKET              
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,RCONSPNU       NUMBER OF STATIONS                           
         BZ    ICSTTDLX            NONE                                         
*                                                                               
         ICM   RF,15,RCONSPAM      REP STATION'S DOLLARS                        
         CVD   RF,DUB                                                           
         ZAP   ICSTSTTL,DUB                                                     
*                                                                               
*        ALLOCATE REP'D STATION'S DOLLARS TO CONTRACT PERIOD                    
*                                                                               
         ZAP   ICSTOVR$,ICSTSTTL   MOVE STATION DOLLARS TO WORKAREA             
         BAS   RE,ICSTALOC         ALLOC OVERRIDE $'S TO BUCKET PERIOD          
         ZAP   ICSTSTTL,ICSTOVR$   CAPTURE ALLOCATED DOLLARS                    
*                                                                               
         LA    R3,RCONSPST         START OF STATIONS                            
         USING RCONSPST,R3         ESTABLISH STATION MINI-ELEMENT               
*                                                                               
*        TOTAL DOLLARS IN MARKET                                                
*                                                                               
         ICM   RF,15,RCONSPAM      STATION'S DOLLARS                            
         CVD   RF,DUB                                                           
         AP    ICSTMKTL,DUB                                                     
         LA    R3,L'RCONSPST+L'RCONSPAM(R3) NEXT MINI-ELEMENT                   
         BCT   R0,*-18                                                          
*                                                                               
*        ALLOCATE MARKET DOLLARS TO CONTRACT PERIOD                             
*                                                                               
         ZAP   ICSTOVR$,ICSTMKTL   MOVE MARKET DOLLARS TO WORKAREA              
         BAS   RE,ICSTALOC         ALLOC OVERRIDE $'S TO BUCKET PERIOD          
         ZAP   ICSTMKTL,ICSTOVR$   CAPTURE ALLOCATED DOLLARS                    
*                                                                               
*        GET REP'D STATION'S PER CENT                                           
*                                                                               
         ZAP   ICSTWORK,ICSTSTTL   GET REP'D STATION'S DOLLARS                  
         SRP   ICSTWORK,5,0        SCALE UP FOR PERCENT                         
         CP    ICSTMKTL,=P'0'      NO DECIMAL DIVIDE                            
         BE    *+22                                                             
         DP    ICSTWORK,ICSTMKTL   STATION/MARKET DOLLARS                       
         ZAP   ICSTSTPC,ICSTQUOT                                                
         SRP   ICSTSTPC,64-1,5     ROUND TO 4 DECIMALS                          
*                                                                               
ICSTTDLX DS    0H                                                               
         B     ICSTTTLX                                                         
*                                                                               
ICSTTTLX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'RENWRTER - INPUT - CONTRACT TYPE - ICSTALOC'                    
***********************************************************************         
*                                                                     *         
*        ROUTINE TO ALLOCATE MARKET OR STATION OVVERIDE DOLLARS       *         
*        BASED ON NUMBER OF DAYS CURRENT BUCKET PERIOD                *         
*        OVERLAPS CONTRACT PERIOD                                     *         
*                                                                     *         
*NTRY    ICSTOVR$ -  DOLLARS TO BE ALLOCATED                          *         
*        I/O1     -  CONTRACT RECORD                                  *         
*                                                                     *         
*EXIT    ICSTOVR$ - DOLLARS TO BE USED AS THE OVERRIDE                *         
*        ICSTSTPC - PER CENT FOR REP'D STATION                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ICSTALOC NTR1  LABEL=*                                                          
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         LA    R3,REFCURSB         ASSUME CURRENT DATES WANTED                  
         CLI   ICSTARGS+2,C'P'     IF PRIOR DATES NEEDED                        
         BNE   *+8                                                              
         LA    R3,REFPRISB            SWITCH POINTER                            
*                                                                               
         CLC   RCONDATE(3),0(R3)   IF CONTRACT WITHIN DATE RANGE                
         BL    *+14                                                             
         CLC   RCONDATE+3(3),3(R3)                                              
         BNH   ICSTALOX               NO ALLOCATION NEEDED                      
*                                                                               
         LA    R5,RCONDATE         ASSUME CONTRACT STARTS LATER                 
*                                                                               
         CLC   RCONDATE(3),0(R3)   IF CONTRACT STARTS BEFORE PERIOD             
         BNL   *+8                                                              
         LA    R5,0(R3)               POINT TO PERIOD START                     
*                                                                               
         GOTO1 DATCON,DMCB,(3,0(R5)),ICSTSTRT    START OF OVERLAP               
*                                                                               
         LA    R5,RCONDATE+3       ASSUME CONTRACT ENDS EARLIER                 
*                                                                               
         CLC   RCONDATE+3(3),3(R3)   IF CONTRACT ENDS   BEFORE PERIOD           
         BNH   *+8                                                              
         LA    R5,3(R3)                 POINT TO PERIOD END                     
*                                                                               
         GOTO1 DATCON,DMCB,(3,0(R5)),ICSTEND     END OF OVERLAP                 
*                                                                               
         GOTO1 PERVERT,DMCB,ICSTSTRT,ICSTEND   DAYS IN OVERLAP                  
         MVC   ICSTOVLP,DMCB+8     RETRIEVE OVERLAP DAYS                        
*                                                                               
         GOTO1 DATCON,DMCB,(3,RCONDATE),ICSTCSTC     CONTRACT START             
         GOTO1 DATCON,DMCB,(3,RCONDATE+3),ICSTCENC   CONTRACT END               
*                                                                               
         GOTO1 PERVERT,DMCB,ICSTCSTC,ICSTCENC  CON DAYS                         
         MVC   ICSTCDYS,DMCB+8     RETRIEVE CONTRACT DAYS                       
*                                                                               
*        ALLOCATE DOLLARS BASED ON OVERLAP                                      
*                                                                               
         ZAP   ICSTWORK,ICSTOVR$   OVERRIDE DOLLARS                             
         LH    RF,ICSTOVLP                                                      
         CVD   RF,DUB                                                           
         MP    ICSTWORK,DUB        * OVERLAP DAYS                               
         LH    RF,ICSTCDYS                                                      
         CVD   RF,DUB                                                           
         DP    ICSTWORK,DUB        / CONTRACT DAYS                              
         ZAP   ICSTOVR$,ICSTQUOT   OVERLAP DOLLARS TO USE                       
*                                                                               
ICSTALOX DS    0H                                                               
         XIT1                                                                   
*                                                                               
ICSTCSTC DS    CL6                 CONTRACT START IN YYMMDD                     
ICSTCENC DS    CL6                 CONTRACT END   IN YYMMDD                     
ICSTSTRT DS    CL6                 OVERLAP  START IN YYMMDD                     
ICSTEND  DS    CL6                 OVERLAP  END   IN YYMMDD                     
ICSTOVLP DS    H                   NUMBER OF DAYS IN OVERLAP                    
ICSTCDYS DS    H                   NUMBER OF DAYS IN CONTRACT                   
ICSTBSTR DS    XL3                 PERIOD BROADCAST START - YMD                 
ICSTBEND DS    XL3                 PERIOD BROADCAST END   - YMD                 
ICSTPRMS DS    6F                  WORK PARAMETER LIST                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - COMPETITIVE STATIONS - OUTPUT - OCST'                
***********************************************************************         
*                                                                     *         
*        CALCULATE STATION PERCENTS                                   *         
*NTRY                                                                 *         
*                                                                     *         
*                                                                     *         
*        R2==>  DRIVER INPUT AL1(LENGTH),C'DATA'                      *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OCST     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+1,C'S'       CHECK FOR STATUS OUTPUT                      
         BE    OCSTSTAT                                                         
*                                                                               
*                                                                               
*        DIVIDE FIRST NUMBER BY SECOND AND REPORT 4 DECIMALS AS %               
*                                                                               
         ZAP   OCSTWORK,0(8,R2)    NUMERATOR                                    
*                                                                               
         ZAP   0(8,R2),=P'0'       INIT OUTPUT                                  
*                                                                               
         CP    8(8,R2),=P'0'       DONE IF NO DENOMINATOR                       
         BE    OCSTX                                                            
*                                                                               
         SRP   OCSTWORK,5,0        *100000 FOR 4 DECIMALS                       
*                                                                               
         DP    OCSTWORK,8(8,R2)    DENOMINATOR                                  
*                                                                               
         SRP   OCSTQUOT,64-1,5     REDUCE TO 4 DECIMALS                         
*                                                                               
         ZAP   0(8,R2),OCSTQUOT    RETURN PERCENT                               
*                                                                               
         MVI   GLHOOK,GLEDIT       TELL DRIVER TO EDIT RESULT                   
*                                                                               
         B     OCSTX                                                            
*                                                                               
*        WON/LOSS STATUS                                                        
*                                                                               
OCSTSTAT DS    0H                                                               
*                                                                               
         ZAP   OCSTWORK,0(4,R2)    ADD UP THE VARIOUS CATEGORIES                
         AP    OCSTWORK,4(4,R2)                                                 
         AP    OCSTWORK,8(4,R2)                                                 
         AP    OCSTWORK,12(4,R2)                                                
*                                                                               
         CP    OCSTWORK,=P'1'      SKIP IF MORE THAN ONE                        
         BH    OCSTST20                                                         
*                                                                               
         CP    0(4,R2),=P'1'       IF PENDING                                   
         BNE   *+14                                                             
         MVC   0(5,R3),=C' PEND'      PRINT 'PEND'                              
         B     OCSTSTAX                                                         
*                                                                               
         CP    4(4,R2),=P'1'       IF INCOMPLETE                                
         BNE   *+14                                                             
         MVC   0(5,R3),=C' INC '      PRINT 'INC '                              
         B     OCSTSTAX                                                         
*                                                                               
         CP    8(4,R2),=P'1'       IF A LOSS                                    
         BNE   *+14                                                             
         MVC   0(5,R3),=C' LOSS'      PRINT 'LOSS'                              
         B     OCSTSTAX                                                         
*                                                                               
         CP    12(4,R2),=P'1'      IF A WIN                                     
         BNE   *+14                                                             
         MVC   0(5,R3),=C' WIN '      PRINT 'WIN '                              
         B     OCSTSTAX                                                         
*                                                                               
         B     OCSTSTAX                                                         
*                                                                               
OCSTST20 DS    0H                  MULTIPLE WINS/LOSSES/ETC                     
*                                                                               
         LR    R1,R3               COPY OUTPUT POINTER                          
*                                                                               
         CP    0(4,R2),=P'0'       SKIP IF NO PENDINGS                          
         BE    OCSTST30                                                         
*                                                                               
         EDIT  (P4,0(R2)),(5,0(R1)),0,TRAIL=C'P'                                
*                                                                               
         LA    R1,198(R1)          BUMP TO NEXT OUTPUT LINE                     
*                                                                               
OCSTST30 DS    0H                                                               
*                                                                               
         CP    4(4,R2),=P'0'       SKIP IF NO INCOMPLETES                       
         BE    OCSTST40                                                         
*                                                                               
         EDIT  (P4,4(R2)),(5,0(R1)),0,TRAIL=C'I'                                
*                                                                               
         LA    R1,198(R1)          BUMP TO NEXT OUTPUT LINE                     
*                                                                               
OCSTST40 DS    0H                                                               
*                                                                               
         CP    8(4,R2),=P'0'       SKIP IF NO LOSSES                            
         BE    OCSTST60                                                         
*                                                                               
         EDIT  (P4,8(R2)),(5,0(R1)),0,TRAIL=C'L'                                
*                                                                               
         LA    R1,198(R1)          BUMP TO NEXT OUTPUT LINE                     
*                                                                               
OCSTST60 DS    0H                                                               
*                                                                               
         CP    12(4,R2),=P'0'      SKIP IF NO WINS                              
         BE    OCSTST80                                                         
*                                                                               
         EDIT  (P4,12(R2)),(5,0(R1)),0,TRAIL=C'W'                               
*                                                                               
         LA    R1,198(R1)          BUMP TO NEXT OUTPUT LINE                     
*                                                                               
OCSTST80 DS    0H                                                               
*                                                                               
OCSTSTAX DS    0H                                                               
*                                                                               
OCSTX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
OCSTWORK DS    0PL16               PACKED WORKAREA                              
OCSTQUOT DS    PL8                 QUOTIENT                                     
OCSTRMDR DS    PL8                 REMAINDER                                    
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT = INPUT - ODATA'                              
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT INPUT UNCHANGED. MAY HAVE TO ADD LABEL      *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        GLARGS+1 -  INDICATES WHERE OUTPUT IS TO PRINT IN HEADLINES  *         
*                    C'C' - CODEAREA                                  *         
*                    C'N' - NAMEAREA                                  *         
*        GLARGS+2 -  FILL CHARACTER IN CASE THERE IS NO DATA          *         
*                                                                     *         
*        R2==>  DRIVER INPUT AL1(LENGTH),C'DATA'                      *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ODATA    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         LA    RE,NAMEAREA         DEFAULT TO NAMEAREA                          
*                                                                               
         CLI   GLARGS+1,C'C'       CHECK IF CODEAREA TO BE USED                 
         BNE   *+8                                                              
         LA    RE,CODEAREA         PRINT IN CODEAREA                            
*                                                                               
         LA    RF,L'NAMEAREA       MAX LENGTH OF OUTPUT AREA                    
*                                                                               
         CLI   0(R2),C' '          IF FIRST BYTE IS LESS THAN SPACE             
         BNL   ODATA1                 THEN WE HAVE A LENGTH                     
*                                                                               
         CLM   RF,1,0(R2)          IF DATA SHORTER THAN AREA                    
         BNH   *+12                                                             
         ICM   RF,1,0(R2)             USE DATA LENGTH                           
         BZ    ODATAX                 THERE MUST BE DATA                        
*                                                                               
         LA    R1,1(R2)            START OF DATA                                
*                                                                               
         B     ODATA2              WE HAVE DATA LENGTH                          
*                                                                               
ODATA1   DS    0H                  HAVE PURE DATA WITH NO LENGTH BYTE           
*                                                                               
         L     R1,GLADTENT         ESTABLISH DRIVETABLE ENTRY                   
         USING DROD,R1                                                          
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,DROLEN         GET COLUMN WIDTH                             
         BZ    ODATAX              MUST HAVE A LENGTH                           
*                                                                               
         CR    RF,R0               USE SMALLER OF TWO LENGTHS                   
         BNH   *+6                                                              
         LR    RF,R0                                                            
*                                                                               
         DROP  R1                                                               
*                                                                               
         LA    R1,0(R2)            START OF DATA                                
*                                                                               
ODATA2   DS    0H                                                               
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,RE),0(R1)                                                    
*                                                                               
ODATXTX  DS    0H                                                               
*                                                                               
*        IF A FILL CHARACTER IS GIVEN AND THERE IS NOTHIN TO PRINT              
*           THE SYSTEM FILLS IN THE OUTPUT WITH THE FILL CHARACTER              
*                                                                               
ODAFILL  DS    0H                                                               
*                                                                               
         CLI   GLARGS+2,0          IF THERE IS A FILL CHARACTER GIVEN           
         BE    ODAFILLX                                                         
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,RE),ODSPACES    AND THERE IS NO DATA IN FIELD                
         BH    ODAFILLX                                                         
*                                                                               
         LA    R0,1(RF)            NUMBER OF OUTPUT POSITIONS                   
         LA    R1,0(RE)            START OF OUTPUT                              
*                                                                               
         MVC   0(1,R1),GLARGS+2    PUT OUT FILL CHARACTER                       
         LA    R1,1(R1)            BUMP OUTPUT POINTER                          
         BCT   R0,*-10                                                          
*                                                                               
ODAFILLX DS    0H                                                               
*                                                                               
ODATAX   DS    0H                                                               
         GOTO1 GENOUTA                                                          
         XIT1                                                                   
*                                                                               
ODSPACES DC    CL64' '                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*MN                                                                             
         TITLE 'RENWRTER - OUTPUT = ADV/PR1/PR2/EST - OCPE'                     
***********************************************************************         
*                                                                     *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        GLARGS+1 -  INDICATES WHERE OUTPUT IS TO PRINT IN HEADLINES  *         
*                    C'C' - CODEAREA                                  *         
*        GLARGS+2 -  FILL CHARACTER IN CASE THERE IS NO DATA          *         
*                                                                     *         
*        R2==>  DRIVER INPUT AL1(LENGTH),C'DATA'                      *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OCPE     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   0(4,R3),0(R2)       MOVE IN CLIENT (AGENCY ADV)                  
         OC    0(4,R3),RESPACES                                                 
                                                                                
         MVC   4(1,R3),UNPRNT      WILL CHANGE ON EVERY PRINT                   
         CLI   UNPRNT,X'41'        TO PREVENT THE SUPRESSION OF                 
         BNE   *+12                DUPLICATE ENTRIES                            
         MVI   UNPRNT,X'40'                                                     
         B     *+16                                                             
         CLI   UNPRNT,X'40'                                                     
         BNE   *+8                                                              
         MVI   UNPRNT,X'41'                                                     
                                                                                
         CLI   DOWNOPT,C'Y'        IF DOWNLOADING INSERT A SLASH TO             
         BNE   *+8                 DELIMIT THE DATA                             
         MVI   4(R3),C'/'                                                       
                                                                                
         LA    R3,198(R3)          BUMP TO NEXT PRINT LINE                      
         MVC   0(4,R3),4(R2)       MOVE IN PRODUCT 1                            
         MVI   4(R3),C'/'          SLASH DELIMITER                              
         MVC   5(4,R3),12(R2)      MOVE IN PRODUCT 2                            
         OC    0(9,R3),RESPACES                                                 
                                                                                
         CLI   DOWNOPT,C'Y'        IF DOWNLOADING INSERT A SLASH TO             
         BNE   *+8                 DELIMIT THE DATA                             
         MVI   9(R3),C'/'                                                       
                                                                                
         LA    R3,198(R3)          BUMP TO NEXT PRINT LINE                      
         MVC   0(4,R3),8(R2)       MOVE IN 4 CHAR ESTIMATE                      
         OC    0(4,R3),RESPACES                                                 
         CLC   0(4,R3),RESPACES    IF IT IS NOT THERE, USE THE                  
         BNE   OCPEX               EXTENDED ESTIMATE                            
         MVC   0(10,R3),16(R2)                                                  
*                                                                               
OCPEX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
UNPRNT   DC    XL1'40'                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - DARE ORDER # SPECIAL OUTPUT - ODARE'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT SPECIAL FIELDS IN CONTRACT RECORD           *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        GLARGS+1 -  C'#' - CONTRACT NUMBER                           *         
*                                                                     *         
*        R2==>  XL4 CONTRACT NUMBER                                   *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ODARE    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         OC    8(4,R2),8(R2)       SKIP IF NO DATA PROVIDED                     
         BZ    ODAREX                                                           
*                                                                               
         MVC   0(8,R3),0(R2)       MOVE IN DARE ORDER STATUS                    
*                                                                               
         XC    WORK,WORK           EDIT IN DARE ORDER NUMBER                    
         UNPK  WORK(9),8(5,R2)     NUMBER IS PWOS                               
         MVC   198(8,R3),WORK                                                   
*                                                                               
ODAREX   EQU   *                                                                
         XIT1                                                                   
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT = INBOX - OINBOX'                             
***********************************************************************         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AL1(LENGTH),C'DATA'                      *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OINBOX   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   1(3,R3),0(R2)                                                    
         OC    1(3,R3),RESPACES                                                 
                                                                                
         XIT1                                                                   
         LTORG                                                                  
*                                                                               
         DROP                                                                   
         TITLE 'RENWRTER - OUTPUT = MGO - OMGO'                                 
***********************************************************************         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AL1(LENGTH),C'DATA'                      *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OMGO     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         EDIT  (P4,0(R2)),(8,WORK),0                                            
         MVC   WORK(1),UNPRTMGO       WILL CHANGE ON EVERY PRINT                
         CLI   UNPRTMGO,X'41'           TO PREVENT THE SUPRESSION OF            
         BNE   *+12                                                             
         MVI   UNPRTMGO,X'40'                                                   
         B     *+16                                                             
         CLI   UNPRTMGO,X'40'                                                   
         BNE   *+8                                                              
         MVI   UNPRTMGO,X'41'                                                   
                                                                                
         MVC   0(8,R3),WORK                                                     
                                                                                
         XIT1                                                                   
*                                                                               
UNPRTMGO DC    XL1'40'                                                          
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*MN                                                                             
*                                                                               
         TITLE 'RENWRTER - DATE FIELD - OUTPUT - ODATE'                         
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT A DATE                                      *         
*                                                                     *         
*NTRY    GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = INPUT  DATE FORMAT FOR DATCON                     *         
*        GLARGS+2 = OUTPUT DATE FORMAT FOR DATCON                     *         
*        GLARGS+3 = DISPLACEMENT OF DATE IN INPUT                     *         
*        GLARGS+4 = DISPLACEMENT OF POSSIBLE TRAILING CH IN INPUT     *         
*        REQPOPT    REQPOYYM   DATE IN YYMMDD FORMAT                  *         
*                   REQPOCTY   DATE HAS CENTURY IN YEAR               *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ODATE    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        BUILD LABEL AREA FOR HEADLINES                                         
*                                                                               
         MVC   CODEAREA,RESPACES   INIT CODEAREA                                
         MVC   NAMEAREA,RESPACES   INIT NAMEAREA                                
*                                                                               
         CLI   0(R2),0             SKIP IF NO DATE PRESENT                      
         BE    ODATEX                                                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+3         DISPLACEMENT OF DATE IN INPUT                
         LA    R2,0(RF,R2)         POINT TO DATE                                
*                                                                               
         SR    R0,R0                                                            
         IC    R0,GLARGS+1         INPUT DATE FORMAT                            
*                                                                               
         SR    R5,R5                                                            
         ICM   R5,1,GLARGS+2       OUTPUT DATE FORMAT                           
         BZ    ODATE1              NUMERIC OUTPUT YYMMDD                        
*                                                                               
         CLI   GLARGS+1,3          IF BINARY INPUT                              
         BNE   *+8                                                              
         CLI   2(R2),0             AND NO DAYS                                  
         BNE   *+8                                                              
         LA    R5,1(R5)                CHANGE TO NEXT OUTPUT TYPE               
*                                                                               
ODATE1   DS    0H                                                               
*                                                                               
         TM    REQPOPT,REQPOYYM    IF NUMERIC OUTPUT WANTED                     
         BNO   *+8                                                              
         LA    R5,0                   RESET OUTPUT DATE FORMAT                  
*                                                                               
         LA    R4,NAMEAREA         DEFAULT PRINT POSITION                       
*                                                                               
         CLM   R5,1,ODTYYM         IF NUMERIC OUTPUT                            
         BNE   *+12                                                             
         TM    REQPOPT,REQPOCTY    AND CENTURY INCLUDED                         
         BNO   *+8                                                              
         LA    R4,2(R4)               BUMP OUTPUT POINTER                       
*                                                                               
         LA    R5,X'20'(R5)        PRINTABLE DATES ONLY                         
*                                                                               
         TM    REQPOPT,REQPOCTY    IF CENTURY INCLUDED                          
         BNO   *+8                                                              
         LA    R5,X'40'(R5)           SET INDICATOR                             
*                                                                               
         GOTO1 DATCON,DMCB,((R0),(R2)),((R5),(R4))  PRINT DATE                  
*                                                                               
         CLM   R5,1,ODTYYM         IF NUMERIC OUTPUT                            
         BNE   ODATE6                                                           
*                                                                               
         TM    REQPOPT,REQPOCTY    AND CENTURY INCLUDED                         
         BNO   ODATE5                                                           
*                                                                               
         MVC   NAMEAREA(2),=C'19'  TWENTIETH IS DEFAULT CENTURY                 
*                                                                               
         CLC   NAMEAREA+2(2),=C'50'   IF BEFORE MID-CENTURY                     
         BNL   *+10                                                             
         MVC   NAMEAREA(2),=C'20'   USE TWENTY-FIRST CENTURY                    
*                                                                               
ODATE5   DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,3          IF BINARY INPUT                              
         BNE   *+8                                                              
         CLI   2(R2),0             AND NO DAYS                                  
         BNE   *+10                                                             
         MVC   4(2,R4),=C'  '          KILL DAYS IN DATE                        
*                                                                               
ODATE6   DS    0H                                                               
*                                                                               
         CLI   GLARGS+4,0          IF THERE IS A TRAILING CHARACTER             
         BE    ODATE7                                                           
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+4            GET DISPLACEMENT IN INPUT                 
*                                                                               
         LA    RE,0(RF,R2)            POINT TO TRAILING CHARACTER               
*                                                                               
         LA    RF,L'NAMEAREA          MAX OUTPUT LENGTH                         
         LA    R1,NAMEAREA-1(RF)      LAST OF INPUT                             
*                                                                               
         CLI   0(R1),C' '             FIND END OF DATE                          
         BH    *+10                                                             
         BCTR  R1,0                   BACK UP A BYTE                            
         BCT   RF,*-10                                                          
*                                                                               
         MVC   1(1,R1),0(RE)          ADD ON TRAILING CHARACTER                 
*                                                                               
ODATE7   DS    0H                                                               
*                                                                               
ODATEX   DS    0H                                                               
*                                                                               
         GOTO1 GENOUTA                                                          
*                                                                               
         XIT1                                                                   
*                                                                               
ODTYYM   DC    X'00'               NUMERIC DATE OUTPUT FORMAT                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - CONTRACT DEVELOP TYPE/PERSON - IDEV'         
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT DEVELOPMENT CONTRACT TYPE/SALESPERSON     *         
*        DATA IN X'18' ELEMENT OF CONTRACT                            *         
*        IF CODE MUST EVENTUALLY LOOK IT UP IN TABLES                 *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IDEV     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        HANDLE RGON REPORT                                                     
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   IDEVRGNN                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    IDEVX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    IDEVX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    IDEVX                                                            
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    IDEVX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    IDEVX                                                            
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-18                                                          
         B     IDEVX               NO DATA TYPE MATCH                           
*                                                                               
         CLI   GLARGS,RDCTKTYQ     CONTRACT TYPE                                
         BE    IDEVRDCT                                                         
         CLI   GLARGS,RDSPKTYQ     SALESPERSON                                  
         BE    IDEVRDSP                                                         
*                                                                               
         B     IDEVX               UNKNOWN DATA TYPE                            
*                                                                               
IDEVRDCT DS    0H                                                               
*                                                                               
         MVC   IDEVSDCT,0(R1)      SAVE CONTRACT TYPE                           
*                                                                               
         B     IDEVDCTF            CONTRACT TYPE FOUND                          
*                                                                               
IDEVRDSP DS    0H                                                               
*                                                                               
         MVC   IDEVSDSP,0(R1)      SAVE CONTRACT TYPE                           
*                                                                               
         B     IDEVDSPF            CONTRACT TYPE FOUND                          
*                                                                               
IDEVRGNN DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         BNE   IDEVCONN                                                         
*                                                                               
*                                                                               
*        FIND CONTRACT DEVELOPMENT ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IDEVX                  NO OWNER CODE                             
         CLI   0(R6),X'18'         FIND DEVELOPMENT ELEMENT                     
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONDVEL,R6         ESTABLISH DEVELOPMENT ELEMENT                
*                                                                               
         CLI   GLARGS,RDCTKTYQ     CONTRACT TYPE                                
         BE    IDVDCT                                                           
         CLI   GLARGS,RDSPKTYQ     SALESPERSON                                  
         BE    IDVDSP                                                           
*                                                                               
         B     IDEVX               UNKNOWN DATA TYPE                            
*                                                                               
IDVDCT   DS    0H                  DEVELOPMENTAL CONTRACT TYPE                  
*                                                                               
         MVC   IDEVSDCT,RCONDVCT   SAVE CONTRACT TYPE                           
*                                                                               
         B     IDEVDCTF                                                         
*                                                                               
IDEVCONN DS    0H                                                               
*                                                                               
*        SHOULD BE BUDGET RECORD                                                
*                                                                               
         L     R4,REANWMON         POINT TO BUDGET MONTH TABLE                  
         USING BDMNTABD,R4         ESTABLISH TABLE                              
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**' SKIP IF NOT BUDGET TABLE             
         BNE   IDEVBUDN                                                         
*                                                                               
         MVC   IDEVSDCT,BDMTDCT    RETRIEVE DEVELOP CONTRACT TYPE               
*                                                                               
         B     IDEVDCTF                                                         
*                                                                               
IDEVBUDN DS    0H                                                               
*                                                                               
         B     IDEVX               UNIDENTIFIED DATA SOURCE                     
*                                                                               
IDEVDCTF DS    0H                                                               
*                                                                               
         CLC   IDEVSDCT,RESPACES   SKIP IF NO CODE FOUND                        
         BNH   IDVDCTX                                                          
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RCONDVCT,R2),IDEVSDCT RETURN CODE                            
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IDVDCTX                                                          
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'RCONDVCT(R2)    POINT TO LOOK UP CODE AREA                  
*                                                                               
         CLI   GLARGS+1,C'S'       SKIP IF NOT SORTING BY NAME                  
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RCONDVCT,R1),IDEVSDCT     SET OWN CODE                       
         LA    R1,L'RCONDVCT(R1)    BUMP TO NEXT AREA                           
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   IDVDCTX                                                          
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'RCONDVCT(10,R2),NAMEAREA    ADD NAME TO OUTPUT                 
*                                                                               
IDVDCTX  DS    0H                                                               
*                                                                               
         B     IDEVX                                                            
*                                                                               
IDVDSP   DS    0H                  DEVELOPMENTAL SALESPERSON                    
*                                                                               
         MVC   IDEVSDSP,RCONDVSP   SAVE DEVELOPMENTAL PERSON                    
*                                                                               
IDEVDSPF DS    0H                                                               
*                                                                               
         CLC   IDEVSDSP,RESPACES   SKIP IF NO CODE FOUND                        
         BNH   IDVDSPX                                                          
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RCONDVSP,R2),IDEVSDSP RETURN CODE                            
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IDVDSPX                                                          
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'RCONDVSP(R2)    POINT TO LOOK UP CODE AREA                  
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING ON NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RCONDVSP,R1),IDEVSDSP     SET OWN CODE                       
         LA    R1,L'RCONDVSP(R1)    BUMP TO NEXT AREA                           
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   IDVDSPX                                                          
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'RCONDVSP(10,R2),NAMEAREA    ADD NAME TO OUTPUT                 
*                                                                               
IDVDSPX  DS    0H                                                               
*                                                                               
         B     IDEVX                                                            
*                                                                               
IDEVX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IDEVSDCT DS    XL(L'RCONDVCT)      DEVELOPMENTL CONTRACT TYPE SAVEAREA          
IDEVSDSP DS    XL(L'RCONDVSP)      DEVELOPMENTL PERSON        SAVEAREA          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - DUMMY INPUT ROUTINE - INPUT - IDUMMY'                
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PUT A NON-NULL VALUE IN INPUT TO DRIVER           *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IDUMMY   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVI   0(R2),1             FORCE NON-NULL INPUT                         
*                                                                               
IDUMMYX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - DUMMY OUTPUT ROUTINE - OUTPUT - ODUMMY'              
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT A BLANK KEYWORD                             *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ODUMMY   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVI   0(R3),C' '          PRINT A BLANK KEYWORD                        
*                                                                               
ODUMMYX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - CONTRACT DOLLARS - INPUT - IDOL'                     
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT CONTRACT DOLLARS FROM NEWMONTB            *         
*                                                                     *         
*NTRY    GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = DISPLACEMENT INTO CONTRACT BUCKETS                *         
*        GLARGS+2 = VALUE OF FLAG BYTE                                *         
*        GLARGS+3 = DISPLACEMENT TO BUCKET TO USE IF FLAG IS ON       *         
*                   IF GLARGS+2 NULLS                                 *         
*                   C'M' - MARKET DOLLARS INSTEAD OF STATION          *         
*        GLARGS+4 = FIELD TYPE                                        *         
*                   C'C' - CURRENT                                    *         
*                   C'P' - PRIOR                                      *         
*                   C'2' - 2 YEAR PRIOR                               *         
*                   C'N' - NEXT YEAR                                  *         
*        GLARGS+5 = DATA TYPE                                         *         
*                   C'C' - ALL      CONTRACTS                         *         
*                   C'P' - PENDING  CONTRACTS ONLY                    *         
*                   C'F' - FORECAST CONTRACTS ONLY                    *         
*        GLARGS+9 = PERIOD START YMD BINARY                           *         
*        GLARGS+12= PERIOD END   YMD BINARY                           *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IDOL     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     RF,REAIO1           SKIP IF NO CONTRACT RECORD IN CORE           
         CLI   0(RF),RCONKTYQ                                                   
         BNE   IDOLX                                                            
*                                                                               
         ICM   R4,15,REANWMON      POINT TO CONTRACT DOLLARS TABLE              
         BZ    IDOLX               SKIP IF NO TABLE AVAILABLE                   
         USING NWMNTABD,R4         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQCFAAD),0,0  FIND ASATDATE FILTER           
         BNZ   IDOLAADX            NONE FOUND                                   
*                                                                               
         ICM   R5,15,DMCB+8        POINT TO FOUND ASATDATE FILTER               
         BZ    IDOLAADX            NONE FOUND                                   
*                                                                               
         XC    IDOLAFLT,IDOLAFLT   INIT FILTER VALUE                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,FLTFVLEN-FLTCTL(R5) FILTER LENGTH                           
         BZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   IDOLAFLT(0),FLTFVAL-FLTCTL(R5)      SAVE FILTER                  
*                                                                               
         SR    R0,R0                                                            
         IC    R0,REQAADFN         NUMBER OF ASATDATE FILTERS                   
         AH    R0,=H'1'            ALLOW FOR TOTAL REPORT                       
         L     R3,REAADTBA         POINT TO ASATDATES TABLE                     
*                                                                               
IDOLAADL DS    0H                                                               
*                                                                               
         CLC   IDOLAFLT,0(R3)      MATCH THIS COL FILTER                        
         BE    IDOLAADF            FILTER FOUND                                 
*                                                                               
IDOLAADC DS    0H                                                               
*                                                                               
         A     R4,=A(NWMTENTL)     BUMP TO NEXT TABLE                           
         LA    R3,6(R3)            BUMP TO NEXT ASATDATES                       
         BCT   R0,IDOLAADL                                                      
*                                                                               
         DC    H'0'                SHOULD NOT BE HERE                           
*                                                                               
IDOLAADF DS    0H                  CORRECT TABLE FOUND                          
*                                                                               
IDOLAADX DS    0H                                                               
*                                                                               
         CLI   GLARGS+5,C'P'       IF PENDING OR FORECAST DOLLARS               
         BE    *+8                                                              
         CLI   GLARGS+5,C'F'                                                    
         BNE   IDOLPNDX                                                         
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         BZ    IDOLX                                                            
*                                                                               
         CLI   GLARGS+5,C'F'       IF FORECASTING DOLLARS                       
         BNE   *+12                                                             
         CLI   CSFRCAST(RF),C'Y'      CONTRACT MUST BE FORECAST CONT            
         BNE   IDOLX                                                            
*                                                                               
         CLI   GLARGS+5,C'P'       IF PENDING DOLLARS TO BE REPORTED            
         BNE   *+28                                                             
         CLI   CSPENDNG(RF),C'Y'      CONTRACT MUST BE PENDING                  
         BE    *+8                                                              
         CLI   CSPENDNG(RF),C'P'                                                
         BNE   IDOLX                                                            
         CLI   CSFRCAST(RF),C'Y'      AND NOT FORECASTING                       
         BE    IDOLX                                                            
*                                                                               
IDOLPNDX DS    0H                                                               
*                                                                               
         LA    R5,NWMTNWMT         FIRST MONTH ENTRY                            
         ZAP   0(8,R2),=P'0'       INIT DOLLAR BUCKET                           
*                                                                               
IDOLLOOP DS    0H                                                               
*                                                                               
         OC    0(6,R5),0(R5)       DONE IF NO DATE PRESENT                      
         BZ    IDOLDONE                                                         
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD OPTION IN PLAY                        
         BNO   *+18                                                             
         CLC   REQYTDSB(2),CURDATE(R5)   BUCKET MUST BE FOR YTD PERIOD          
         BH    IDOLCONT                                                         
         B     IDOLYTD1                                                         
*                                                                               
         CLC   REYMSTRP(2),CURDATE(R5) BUCKET MUST BE FOR PERIOD                
         BH    IDOLCONT              USING YM OF BROADCAST MONTH                
*                                                                               
IDOLYTD1 DS    0H                                                               
*                                                                               
         CLC   REYMENDP(2),CURDATE(R5)                                          
         BL    IDOLCONT                                                         
*                                                                               
         OC    RECURSTB(2),RECURSTB   SKIP IF NO CURRENT PERIOD                 
         BZ    IDOLYTD5                                                         
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD OPTION IN PLAY                        
         BNO   *+18                                                             
         CLC   REQYTDSB(2),CURDATE(R5)   BUCKET MUST BE FOR YTD PERIOD          
         BH    IDOLCONT                                                         
         B     IDOLYTD2                                                         
*                                                                               
         CLC   RECURSTB(2),CURDATE(R5) BUCKET MUST BE FOR CURR PERIOD           
         BH    IDOLCONT              USING YM OF BROADCAST MONTH                
*                                                                               
IDOLYTD2 DS    0H                                                               
*                                                                               
         CLC   RECURENB(2),CURDATE(R5)                                          
         BL    IDOLCONT                                                         
*                                                                               
IDOLYTD5 DS    0H                                                               
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BNZ   *+10                                                             
         OC    GLARGS+12(2),GLARGS+12    SKIP IF NO DATES GIVEN                 
         BZ    IDOL10                                                           
*                                                                               
         CLC   GLARGS+9(2),CURDATE(R5)   BUCKET MUST BE FOR KYW PERIOD          
         BH    IDOLCONT                                                         
         CLC   GLARGS+12(2),CURDATE(R5)                                         
         BL    IDOLCONT                                                         
*                                                                               
IDOL10   DS    0H                                                               
*                                                                               
*        IF DIRECT RESPONSE OR PAID PROGRAMMING OPTION                          
*              CHECK CONTRACT IS CORRECT TYPE                                   
*              AND BUCKET ON OR AFTER CUTOFF DATE                               
*                                                                               
IDOLDRP  DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBODRQ+REQBOPPQ   SKIP IF NEITHER OPTION ON           
         BZ    IDOLDRPX                                                         
*                                                                               
         L     RF,REAIO1           POINT TO CONTRACT RECORD                     
         USING RCONREC,RF          ESTABLISH CONTRACT RECORD                    
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT A CONTRACT RECORD                
         BNE   IDOLDRPX                                                         
*                                                                               
         L     RE,REREPTA          POINT TO REP TABLE ENTRY                     
*                                                                               
         TM    REQBLLOP,REQBODRQ   IF DIRECT RESPONSE OPTION                    
         BNO   *+14                                                             
         CLC   RCONTYPE,RREPPROF+8-RREPELEM+REPTELM-REPTENT(RE)                 
         BNE   IDOLDRPX            SKIP IF NOT DR CONTRACT                      
*                                                                               
         TM    REQBLLOP,REQBOPPQ   IF PAID PROGRAMMING OPTION                   
         BNO   *+14                                                             
         CLC   RCONTYPE,RREPPROF+9-RREPELEM+REPTELM-REPTENT(RE)                 
         BNE   IDOLDRPX            SKIP IF NOT PP CONTRACT                      
*                                                                               
*        CHECK BUCKET DATE AGAINST CUTOFF DATE                                  
*              CURRENT AND PRIOR KEYWORDS HAVE THEIR OWN CUTOFF DATE            
*                                                                               
         CLI   GLARGS+4,C'C'       IF A CURRENT KEYWORD                         
         BNE   *+14                                                             
         CLC   CURDATE(2,R5),NWMTCTCR    DROP IF AFTER CUTOFF DATE              
         BH    IDOLCONT                                                         
*                                                                               
         CLI   GLARGS+4,C'P'       IF A PRIOR KEYWORD                           
         BNE   *+14                                                             
         CLC   PRIDATE(2,R5),NWMTCTPR    DROP IF AFTER CUTOFF DATE              
         BH    IDOLCONT                                                         
*                                                                               
         CLI   GLARGS+4,C'2'       IF A 2 YEAR PRIOR KEYWORD                    
         BNE   *+14                                                             
         CLC   PRI2DATE(2,R5),NWMTCT2P    DROP IF AFTER CUTOFF DATE             
         BH    IDOLCONT                                                         
*                                                                               
         CLI   GLARGS+4,C'N'       IF A NEXT YEAR KEYWORD                       
         BNE   *+14                                                             
         CLC   NEXTDATE(2,R5),NWMTCTNX    DROP IF AFTER CUTOFF DATE             
         BH    IDOLCONT                                                         
*                                                                               
         DROP  RF                                                               
*                                                                               
IDOLDRPX DS    0H                                                               
*                                                                               
*        CHECK ON BILLING OPTIONS                                               
*                                                                               
         TM    REQBLLOP,REQBOR1Q+REQBOR2Q+REQBOR3Q+REQBOR5Q                     
         BZ    IDOLROPX            SKIP IF NONE WANTED                          
*                                                                               
*        DETERMINE DATE FOR BUCKET                                              
*                                                                               
         LA    RF,CURDATE(R5)      DEFAULT TO CURRENT BUCKET                    
*                                                                               
         CLI   GLARGS+4,C'2'       IF 2YR PRIOR BUCKET                          
         BNE   *+8                                                              
         LA    RF,PRI2DATE(R5)        USE 2YR PRIOR DATE                        
*                                                                               
         CLI   GLARGS+4,C'P'       IF  PRIOR BUCKET                             
         BNE   *+8                                                              
         LA    RF,PRIDATE(R5)         USE PRIOR DATE                            
*                                                                               
         CLI   GLARGS+4,C'N'       IF NEXT YEAR BUCKET                          
         BNE   *+8                                                              
         LA    RF,NEXTDATE(R5)        USE NEXT YEAR DATE                        
*                                                                               
*        R1 BILLING OPTION                                                      
*              ALL BILLING THROUGH LEAVE DATE                                   
*              ALL BILLING FROM JOIN DATE                                       
*                                                                               
IDOLR1   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR1Q                                                
         BNO   IDOLR1N             SKIP IF NOT R1 OPTION                        
*                                                                               
         CLC   0(2,RF),RESTEND     DROP IF BUCKET DATE AFTER LEAVE DT           
         BH    IDOLCONT                                                         
*                                                                               
         CLC   NWMTAADT,RESTSTR    DROP IF ASATDATE BEFORE JOINED DATE          
         BL    IDOLCONT                                                         
*                                                                               
         CLC   0(2,RF),RESTSTR     DROP IF BUCKET DATE BEFORE JOINED DT         
         BL    IDOLCONT                                                         
*                                                                               
IDOLR1X  DS    0H                                                               
         B     IDOLROPX            KEEP BUCKET                                  
*                                                                               
IDOLR1N  DS    0H                                                               
*                                                                               
*        R2 BILLING OPTION                                                      
*              ALL BILLING THROUGH LEAVE DATE BUT ONLY FOR COMPARABLE           
*                  MONTHS                                                       
*              ALL BILLING FROM JOIN DATE                                       
*                                                                               
IDOLR2   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR2Q                                                
         BNO   IDOLR2N             SKIP IF NOT R2 OPTION                        
*                                                                               
         CLC   RESTEND,NWMTAADT    OKAY IF LEFT AFTER ASATDATE                  
         BH    IDOLR2LX                                                         
*                                                                               
         CLC   0(2,RF),RESTEND     DROP IF BUCKET DATE AFTER LEAVE DT           
         BH    IDOLCONT                                                         
*                                                                               
         CLC   RESTEND(2),CURDATE(R5) DROP IF LEAVE DATE BEFORE CURRENT         
         BL    IDOLCONT               KEEPS ONLY LIKE MONTHS                    
*                                                                               
IDOLR2LX DS    0H                                                               
*                                                                               
         CLC   NWMTAADT,RESTSTR    DROP IF ASATDATE BEFORE JOINED DATE          
         BL    IDOLCONT                                                         
*                                                                               
         CLC   RESTSTR,REQPSTRB    KEEP IF JOINED BEFORE REQUEST START          
         BL    IDOLR2X                                                          
*                                                                               
         CLC   RESTSTR(2),CURDATE(R5) DROP IF JOINED AFTER CURRENT DATE         
         BH    IDOLCONT               KEEPS ONLY LIKE MONTHS                    
*                                                                               
IDOLR2X  DS    0H                                                               
         B     IDOLROPX            KEEP BUCKET                                  
*                                                                               
IDOLR2N  DS    0H                                                               
*                                                                               
*        R3 BILLING OPTION                                                      
*              LIKE MONTHS THROUGH LEAVE DATE                                   
*              NO BILLING FOR JOINED STATIONS                                   
*                                                                               
IDOLR3   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR3Q                                                
         BNO   IDOLR3N             SKIP IF NOT R3 OPTION                        
*                                                                               
         CLC   RESTEND,NWMTAADT    OKAY IF LEFT AFTER ASATDATE                  
         BH    IDOLR3LX                                                         
*                                                                               
         CLC   RESTEND(2),CURDATE(R5) DROP IF LEAVE DATE BEFORE CURRENT         
         BL    IDOLCONT               KEEPS ONLY LIKE MONTHS                    
*                                                                               
IDOLR3LX DS    0H                                                               
*                                                                               
         CLC   NWMTAADT,RESTSTR    DROP IF JOINED AFTER ASATDATE                
         BL    IDOLCONT                                                         
*                                                                               
         CLC   RESTSTR,REQPSTRB    DROP IF JOINED AFTER REQUEST START           
         BH    IDOLCONT                                                         
*                                                                               
IDOLR3X  DS    0H                                                               
         B     IDOLROPX            KEEP BUCKET                                  
*                                                                               
IDOLR3N  DS    0H                                                               
*                                                                               
*        R5 BILLING OPTION                                                      
*              CURRENT AND PRIOR DATES MUST BE REPPED BY SOME                   
*              SUBSIDARY. SKIP IF NON-CURRENT OR PRIOR BUCKET                   
*                                                                               
IDOLR5   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR5Q                                                
         BNO   IDOLR5N             SKIP IF NOT R5 OPTION                        
*                                                                               
         CLI   GLARGS+4,C'C'       MUST BE CURRENT OR PRIOR BUCKET              
         BE    *+8                                                              
         CLI   GLARGS+4,C'P'                                                    
         BNE   IDOLX                                                            
*                                                                               
         L     RE,RESJLTA          POINT TO JOIN/LEAVE TABLE ENTRY              
*                                     FOR STATION                               
*                                                                               
         USING SJLTENT,RE          ESTABLISH ENTRY                              
*                                                                               
*        CURRENT DATE MUST BE COVERED                                           
*                                                                               
         LA    R8,SJLTDTES         POINT TO LIST OF JOIN/LEAVE DATES            
         USING SJLTDTES,R8         ESTABLISH DATES                              
*                                                                               
IDOLJLCL DS    0H                                                               
*                                                                               
         OC    SJLTDTES(SJLTDTEL),SJLTDTES   DONE AT END OF LIST                
         BZ    IDOLJLCD                                                         
*                                                                               
         CLC   CURDATE(2,R5),SJLTJOIN    AFTER JOIN DATE                        
         BL    IDOLJLCC                                                         
*                                                                               
         CLC   CURDATE(2,R5),SJLTLEAV    BEFORE CORRESPONDING LEAVE DTE         
         BNH   IDOLJLCF                                                         
*                                                                               
IDOLJLCC DS    0H                                                               
*                                                                               
         LA    R8,SJLTDTEL(R8)     BUMP TO NEXT SET OF DATES                    
         B     IDOLJLCL                                                         
*                                                                               
IDOLJLCD DS    0H                  CURRENT DATE NOT COVERED                     
         B     IDOLX                                                            
*                                                                               
         DROP  R8                                                               
*                                                                               
IDOLJLCF DS    0H                  CURRENT COVERED BY JOIN/LEAVE DATES          
*                                                                               
*        PRIOR DATE MUST BE COVERED                                             
*                                                                               
         LA    R8,SJLTDTES         POINT TO LIST OF JOIN/LEAVE DATES            
         USING SJLTDTES,R8         ESTABLISH DATES                              
*                                                                               
IDOLJLPL DS    0H                                                               
*                                                                               
         OC    SJLTDTES(SJLTDTEL),SJLTDTES   DONE AT END OF LIST                
         BZ    IDOLJLPD                                                         
*                                                                               
         CLC   PRIDATE(2,R5),SJLTJOIN    AFTER JOIN DATE                        
         BL    IDOLJLPC                                                         
*                                                                               
         CLC   PRIDATE(2,R5),SJLTLEAV    BEFORE CORRESPONDING LEAVE DTE         
         BNH   IDOLJLPF                                                         
*                                                                               
IDOLJLPC DS    0H                                                               
*                                                                               
         LA    R8,SJLTDTEL(R8)     BUMP TO NEXT SET OF DATES                    
         B     IDOLJLPL                                                         
*                                                                               
IDOLJLPD DS    0H                  PRIOR DATE NOT COVERED                       
         B     IDOLX                                                            
*                                                                               
         DROP  R8,RE                                                            
*                                                                               
IDOLJLPF DS    0H                  PRIOR COVERED BY JOIN/LEAVE DATES            
*                                                                               
IDOLR5X  DS    0H                                                               
         B     IDOLROPX            KEEP BUCKET                                  
*                                                                               
IDOLR5N  DS    0H                                                               
*                                                                               
IDOLROPX DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+1         GET DISPLACEMENT INTO DOLLARS                
*                                                                               
         CLI   GLARGS+2,0          IF FLAG BYTE PRESENT                         
         BE    IDOL20                                                           
*                                                                               
         MVC   HALF(1),FLAG6(R5)      COPY FLAG BYTE                            
*                                                                               
         CLI   GLARGS+5,C'T'       IF TRADE KEYWORD                             
         BNE   *+10                                                             
         MVC   HALF(1),FLAG7(R5)      USE FLAG7                                 
*                                                                               
         NC    HALF(1),GLARGS+2                                                 
         BZ    IDOL20                 FLAG NOT ON                               
*                                                                               
         IC    RF,GLARGS+3            ELSE USE SECOND BUCKET                    
*                                                                               
IDOL20   DS    0H                                                               
*                                                                               
         LA    R1,BUCKDISP(RF,R5)  POINT TO BUCKET                              
*                                                                               
         ICM   RF,15,0(R1)         RETURN DOLLARS                               
         CVD   RF,DUB                                                           
*                                                                               
         AP    0(8,R2),DUB         ADD TO DRIVER INPUT                          
*                                                                               
IDOLCONT DS    0H                                                               
*                                                                               
         LA    R5,NEXTBUCK(R5)     BUMP TO NEXT BUCKET                          
*                                                                               
         B     IDOLLOOP                                                         
*                                                                               
IDOLDONE DS    0H                                                               
*                                                                               
         CLI   GLARGS+2,0          IF NO STATUS BYTE PRESENT                    
         BNE   IDOLMKTX                                                         
         CLI   GLARGS+3,C'M'       AND IF MKT DLRS INSTEAD OF STATION           
         BNE   IDOLMKTX                                                         
*                                                                               
         CP    0(8,R2),=P'0'       SKIP IF NO STATION DOLLARS EXIST             
         BE    IDOLMKTX                                                         
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT SPECIFIC DATA              
         BNZ   *+14                                                             
         ZAP   0(8,R2),=P'0'          NO DOLLARS IF NO DATA                     
         B     IDOLMKTX                                                         
*                                                                               
         ICM   RE,15,CSMKTDOL(RF)  MARKET DOLLARS                               
         CVD   RE,DUB                                                           
         ZAP   IDOLMULT,DUB        MARKET DOLLARS                               
*                                                                               
         MP    IDOLMULT,0(8,R2)    * STATION PENDING DOLLARS                    
         SRP   IDOLMULT,1,0        *10 FOR ROUNDING                             
*                                                                               
         ICM   RE,15,CSSHRDOL(RF)  SHARE DOLLARS                                
         BNZ   *+14                                                             
         ZAP   0(8,R2),=P'0'          RETURN 0 IF NO STATION $'S                
         B     IDOLMKTX                                                         
*                                                                               
         CVD   RE,DUB                                                           
         DP    IDOLMULT,DUB        / STATION SHARE DOLLARS                      
         SRP   IDOLQUOT,64-1,5     ROUND DOLLARS                                
         ZAP   0(8,R2),IDOLQUOT    RETURN MARKET DOLLARS                        
*                                                                               
IDOLMKTX DS    0H                                                               
*                                                                               
IDOLX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IDOLMPCA DC    X'0CD700000000'     ARGS FOR REP STA %                           
*                                                                               
         LTORG                                                                  
*                                                                               
IDOLAFLT DS    XL6                 FOUND ASATDATE FILTER                        
*                                                                               
         DS    0D                                                               
IDOLMULT DS    0PL16               PACKED MULTIPLICAND                          
IDOLQUOT DS    PL8                 QUOTIENT                                     
IDOLRMDR DS    PL8                 REMAINDER                                    
*                                                                               
IDOLWORK DS    XL16                WORKAREA                                     
IDOLARGS DS    XL16                GLARGS SAVEAREA                              
*                                                                               
         TITLE 'RENWRTER - CONTRACT DOLLARS - INPUT - ODOL'                     
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT CONTRACT DOLLARS                            *         
*          LET DRIVER PRINT OUTPUT UNLESS CUR$ BILLING OPTION         *         
*            IN EFFECT                                                *         
*          THEN WE NEED TO ROLL TOTALS ON OUR OWN BECAUSE ONLY        *         
*            LINES WITH NON-ZERO CURRENT DOLLARS ARE PRINTED AND ANY  *         
*            PRIOR YEAR DOLLARS ARE DROPPED FROM TOTALS.              *         
*                                                                     *         
*NTRY    GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = DISPLACEMENT INTO CONTRACT BUCKETS                *         
*        GLARGS+2 = VALUE OF FLAG BYTE                                *         
*        GLARGS+3 = DISPLACEMENT TO BUCKET TO USE IF FLAG IS ON       *         
*        GLARGS+4 = FIELD TYPE                                        *         
*                   C'C' - CURRENT                                    *         
*                   C'P' - PRIOR                                      *         
*                   C'2' - 2 YEAR PRIOR                               *         
*                   C'N' - NEXT YEAR                                  *         
*        GLARGS+9 = PERIOD START YMD BINARY                           *         
*        GLARGS+12= PERIOD END   YMD BINARY                           *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*        R3==>  DRIVER PRINT AREA                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ODOL     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC             ESTABLISH GENCON WORKAREA                    
*                                                                               
ODOLEDIT DS    0H                  HAVE DRIVER EDIT OUTPUT                      
*                                                                               
         MVI   GLHOOK,GLEDIT                                                    
*                                                                               
ODOLX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
*        TABLE USED TO ACCUMULATE TOTALS IN CUR$ REPORT                         
*                                                                               
ODL1STKY DC    X'00'               NUMBER OF FIRST CURRENT COLUMN               
*                                                                               
ODLTAB   DS    0D                  TABLE FOR ROLLING TOTALS                     
ODLENT   DS    0X                  START OF ENTRY IN TABLE                      
ODLTKYID DS    XL1                 KEYWORD NUMBER                               
         DS    XL7                 SPARE                                        
ODLTBKTS DS    0PL8                START OF TOTAL BUCKETS                       
         DS    (ODLTBKNQ)PL8       BUCKETS FOR TOTALLING                        
ODLTBKNQ EQU   20                  NUMBER OF TOTAL LEVELS                       
*                                                                               
ODLTABL  EQU   *-ODLTAB            LENGTH OF TABLE ENTRY                        
         DS    (ODLTMAXQ)XL(ODLTABL) REST OF TABLE                              
ODLTMAXQ EQU   20                  MAX ENTRIES IN TABLE                         
*                                  SAME AS MAX COLUMNS POSSIBLE IN RPT          
*                                                                               
         TITLE 'RENWRTER - EXTRACT GENERIC ELEMENT DATA - IELM'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT DATA FROM AN ELEMENT BASED ON DISPLACEMENT*         
*         AND LENGTH                                                  *         
*                                                                     *         
*        CONTRACT AND STAION RECORDS ARE IN CORE                      *         
*              OTHER DATA FOUND IN TABLES                             *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*                  X'02' - STATION    DATA   - STATION    RECORD      *         
*                  X'08' - ADVERTISER DATA   - ADVERTISER TABLE       *         
*                  X'0C' - CONTRACT   DATA   - CONTRACT   RECORD      *         
*                                                                     *         
*        GLARGS+1 = ELEMENT ID                                        *         
*        GLARGS+2 = DATA DISPLACEMENT                                 *         
*        GLARGS+3 = DATA LENGTH                                       *         
*        GLARGS+4 = DEFAULT VALUE                                     *         
*                                                                     *         
*        R2==>  DRIVER INPUT AREA                                     *         
*                                                                     *         
*EXIT   0-?    -  DATA                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IELM     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS,RCONKTYQ    IF CONTRACT SOURCE                            
         BNE   *+12                                                             
         L     R4,REAIO1             RECORD IS IN IO                            
         B     IELMREC                                                          
*                                                                               
         CLI   GLARGS,RSTAKTYQ    IF STATION  SOURCE                            
         BNE   *+12                                                             
         L     R4,REAIO3             RECORD IS IN IO3                           
         B     IELMREC                                                          
*                                                                               
*        SEARCH TABLE TO FIND WHERE DATA TO BE FOUND                            
*                                                                               
         LA    R1,IELMTAB          TABLE OF IDS AND SOURCES                     
*                                                                               
         CLI   0(R1),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    IELMX                                                            
         CLC   GLARGS(1),0(R1)     MATCH DATA TYPES                             
         BE    *+12                                                             
         LA    R1,IELMTABL(R1)     BUMP TO NEXT ENTRY IN TABLE                  
         B     *-22                                                             
*                                                                               
         SR    R3,R3                                                            
         ICM   R3,7,1(R1)          POINT TO TABLE ENTRY                         
         BNZ   IELMTBL1                                                         
*                                  IF NONE AVAILABLE                            
         L     R3,REAIO1           DEFAULT TO CONTRACT RECORD                   
*                                                                               
IELMTBL1 DS    0H                                                               
*                                                                               
         LA    R3,RENWRIOD(R3)     RE-LOCATE ADDRESS                            
*                                                                               
         ICM   R3,15,0(R3)         POINT TO TABLE                               
         BZ    IELMX                 NONE AVAILABLE                             
*                                                                               
         USING STDTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R6,STDTKEY          ASSUME DATA IN KEY                           
*                                                                               
         CLI   GLARGS+1,0          IF ELEMENT ID GIVEN                          
         BE    IELMTB1                                                          
*                                                                               
         LA    R6,STDTELM             USE STORED ELEMENT                        
         SR    RF,RF                                                            
*                                                                               
IELMTBLP DS    0H                                                               
*                                                                               
         CLI   0(R6),0             ELEMENT NOT FOUND                            
         BE    IELMX                                                            
*                                                                               
         CLC   GLARGS+1(1),0(R6)      MUST MATCH WANTED ELEMENT                 
         BE    IELMTBFD                                                         
*                                                                               
IELMTBCN DS    0H                                                               
*                                                                               
         IC    RF,1(R6)            ELEMENT LENGTH                               
         LA    R6,0(RF,R6)         POINT TO NEXT ELEMENT                        
         B     IELMTBFD                                                         
*                                                                               
IELMTBFD DS    0H                                                               
*                                                                               
IELMTB1  DS    0H                                                               
*                                                                               
         B     IELMELM                                                          
*                                                                               
IELMREC  DS    0H                  DETERMINE RECORD                             
*                                                                               
         LA    R6,0(R4)            ASSUME DATA IN KEY                           
*                                                                               
         CLI   GLARGS+1,0          IF ELEMENT ID GIVEN                          
         BE    IELMELM                                                          
*                                                                               
         LA    R6,RSTAELEM-RSTAKEY(R4) POINT TO FIRST ELEMENT IN RECORD         
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IELMX                                                            
         CLC   GLARGS+1(1),0(R6)   FIND ELEMENT                                 
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-26                                                             
*                                                                               
IELMELM  DS    0H                  R6==> REQUIRED ELEMENT                       
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+2         DISPLACEMENT OF DATA                         
*                                                                               
         CLI   GLARGS+1,0          IF NOT IN KEY                                
         BE    *+12                                                             
         CLM   RF,1,1(R6)             SKIP IF ELEMENT NOT LONG ENOUGH           
         BNL   IELMX                                                            
*                                                                               
         LA    R1,0(RF,R6)         POINT TO DATA                                
*                                                                               
         IC    RF,GLARGS+3         DATA LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R1)       PASS DATA TO DRIVER                          
*                                                                               
IELMOUTX DS    0H                                                               
*                                                                               
*        IF KEYWORD IS BEING FILTERED - FIND MASTER TYPE FILTER ENTRY           
*        AND DATA FAILS FILTER                                                  
*            DROP DATA FROM SORT                                                
*                                                                               
         CLI   GLARGS+6,0          SKIP IF NO FILTER ASKED FOR                  
*******  B     IELMFLTX                                                         
         BE    IELMFLTX                                                         
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQMTIC),0,0 SKIP IF NO MASTER                
         BNE   IELMFLTX                                                         
*                                                                               
         ICM   R1,15,8(1)          POINT TO RETURNED FILTER                     
         BZ    IELMFLTX            NONE FOUND                                   
*                                                                               
         MVC   HALF,FLTFVAL-FLTCTL(R1)  SAVE MASTER ICODE                       
*                                                                               
*        VALIDATE KEYWORD VALUE                                                 
*                                                                               
IELMIN   DS    0H                                                               
*                                                                               
*        MAKE INPUT TO DDVAL CHARACTER                                          
*                                                                               
         L     R1,GLADTENT         ESTABLISH DRIVETABLE ENTRY                   
         USING DRIND,R1                                                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+3         GET LENGTH                                   
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         CLI   DRINTYPE,C'C'       IF CHARATACTER                               
         BE    *+8                                                              
         CLI   DRINTYPE,C'X'       OR HEX                                       
         BNE   IELMINCX                                                         
*                                                                               
         MVC   IELMLEN,GLARGS+3       USE DATA AS IS                            
         XC    IELMWORK,IELMWORK                                                
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   IELMWORK(0),0(R2)   MOVE INPUT TO WORKAREA                       
*                                                                               
         B     IELMINX                                                          
*                                                                               
IELMINCX DS    0H                                                               
*                                                                               
         CLI   DRINTYPE,C'P'       IF PACKED                                    
         BE    *+8                                                              
         CLI   DRINTYPE,C'M'       OR MASKED                                    
         BNE   IELMINPX                                                         
*                                     NEED TO AVOID MASK                        
         MVI   IELMLEN,7              MAXIMUM 7 DIGITS                          
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         UNPK  IELMWORK(7),1(0,R2)    MOVE INPUT TO WORKAREA                    
*                                                                               
         OI    IELMWORK+6,X'F0'       FORCE SIGN                                
*                                                                               
         B     IELMINX                                                          
*                                                                               
IELMINPX DS    0H                                                               
*                                                                               
*                                                                               
         CLI   DRINTYPE,C'B'       IF BINARY                                    
         BNE   IELMINBX                                                         
*                                                                               
         MVI   IELMLEN,7              MAXIMUM 7 DIGITS                          
*                                                                               
         LA    RE,4                   MAX 4 BINARY BYTES                        
         SR    RE,RF                  NUMBER OF POSITIONS TO SHIFT              
*                                                                               
         ICM   RF,15,0(R2)            BINARY INPUT                              
*                                                                               
         BCT   RE,*+8                                                           
         B     *+12                   SHIFTING DONE                             
         SRL   RF,8                   SHIFT 1 POSITION RIGHT                    
         B     *-12                                                             
*                                                                               
         CVD   RF,DUB                 CVD                                       
         OI    DUB+7,X'0F'            FORCE SIGN                                
         UNPK  IELMWORK(7),DUB        UNPACK                                    
*                                                                               
         B     IELMINX                                                          
*                                                                               
IELMINBX DS    0H                                                               
*                                                                               
         B     IELMFLTX            IGNORE FILTERING                             
*                                                                               
IELMINX  DS    0H                                                               
*                                                                               
         L     R1,AVLPARMS         POINT TO DDVAL PARMS                         
*                                                                               
         GOTO1 VDDVAL,(R1),('VLPVALQ',HALF),(IELMLEN,IELMWORK),        X        
               AVLTAB,0,0,0                                                     
*                                                                               
         SP    IELMCTR,=P'0'                                                    
         BP    *+6                 TESTING                                      
         DC    H'0'                                                             
*                                                                               
         CLI   VLPERR-VLPARMS(R1),0   DROP IF ERRORS                            
         BNE   IELMDROP                                                         
*                                                                               
         L     R5,AVLTAB           POINT TO RETURNED TABLE ENTRY                
         USING VLTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R0,L'VLTICODE       USE INTERNAL CODE FOR SEARCH                 
         LA    RF,VLTICODE                                                      
*                                                                               
         TM    VLTIND,VLTNSLNQ     SKIP IF NO EXTRA DATA                        
         BNO   *+12                ELSE USE EXTRA DATA                          
         IC    R0,VLTEXTRA            LENGTH OF EXTRA DATA                      
         LA    RF,VLTEXTRA+1          EXTRA DATA                                
*                                                                               
         GOTO1 FNDFLTRA,DMCB,HALF,((R0),(RF)),0                                 
*                                                                               
         BNE   IELMDROP            PROBLEM WITH FILTERING                       
*                                                                               
IELMFLTX DS    0H                                                               
*                                                                               
         B     IELMX                                                            
*                                                                               
IELMDROP DS    0H                                                               
*                                                                               
         MVI   SORTSW,C'N'         DROP DATA FROM SORT                          
*                                                                               
IELMX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IELMCTR  DC    PL2'4'              TESTING COUNTER                              
IELMLEN  DS    X                   LENGTH FOR DDVAL                             
IELMWORK DS    XL32                INPUT FOR DDVAL                              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
*        TABLE TO DETERMINE WHERE ELEMENT IS                                    
*                                                                               
IELMTAB  DS    0D                                                               
         DC    AL1(RADVKTYQ),AL3(READVTA-RENWRIOD) ADVERTISER                   
IELMTABL EQU   *-IELMTAB           LENGTH OF TABLE ENTRY                        
         DC    AL1(RAGK2TYQ),AL3(REAG2TA-RENWRIOD) AGENCY                       
         DC    AL1(RCLSKTYQ),AL3(RECLSTA-RENWRIOD) CLASS                        
         DC    AL1(RCONKTYQ),AL3(0)                CONTRACT                     
         DC    AL1(RCTGKTYQ),AL3(RECTGTA-RENWRIOD) CATEGORY                     
         DC    AL1(RCTYKTYQ),AL3(RECTYTA-RENWRIOD) CONTRACT TYPE                
         DC    AL1(RDCTKTYQ),AL3(REDCTTA-RENWRIOD) DEVELOP CONT TYPE            
         DC    AL1(RDSPKTYQ),AL3(REDSPTA-RENWRIOD) DEVELOP SALES PERS           
         DC    AL1(RGRPKTYQ),AL3(REGRPTA-RENWRIOD) GROUP/SUBGROUP               
         DC    AL1(ROFFKTYQ),AL3(REOFFTA-RENWRIOD) OFFICE                       
         DC    AL1(ROWNKTYQ),AL3(REOWNTA-RENWRIOD) OWNER                        
         DC    AL1(RPTPKTYQ),AL3(REPTPTA-RENWRIOD) POINT PERSON                 
         DC    AL1(RPRDKTYQ),AL3(REPRDTA-RENWRIOD) PRODUCT                      
         DC    AL1(RREGKTYQ),AL3(REREGTA-RENWRIOD) REGION                       
         DC    AL1(RREPKTYQ),AL3(REREPTA-RENWRIOD) REP                          
         DC    AL1(RSALKTYQ),AL3(RESALTA-RENWRIOD) SALESPERSON                  
         DC    AL1(RSTAKTYQ),AL3(0)                STATION                      
         DC    AL1(RTEMKTYQ),AL3(RETEMTA-RENWRIOD) DIVISION/TEAM                
         DC    AL1(RTERKTYQ),AL3(RETERTA-RENWRIOD) DIVISION/TEAM                
IELMTABX DC    X'FF'               END OF TABLE                                 
*                                                                               
         TITLE 'RENWRTER - EXTRACT GENERIC CODE AND NAME KEYWORD -IID'          
***********************************************************************         
*                                                                     *         
*        ROUTINE TO HANDLE KEYWORDS BASED ON AN ID AND A              *         
*             FOLLOWING DESCRIPTION                                   *         
*                                                                     *         
*        CONTRACT AND STATION RECORDS ARE IN CORE                     *         
*              OTHER DATA FOUND IN TABLES                             *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = C'C' ID OR CODE ONLY                              *         
*                   C'B' ID AND NAME SORTED BY CODE                   *         
*                   C'N' NAME SORTED BY CODE                          *         
*                   C'S' NAME SORTED BY NAME                          *         
*                                                                     *         
*EXIT    R2==>  CODE,NAME,CODE IF ALL NEEDED                          *         
*               FIRST CODE MISSING IF SORTING BY NAME                 *         
*               TO SAVE SPACE ONLY 1ST 10 BYTES OF NAME PASSED        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IID      NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   IIDCODE,RESPACES    INIT CODE SAVEAREA                           
         MVC   IIDLKUP,RESPACES    INIT LOOK UP CODE AREA                       
         MVC   IIDNAME,RESPACES    INIT NAME AREA                               
*                                                                               
         MVC   IIDARGS,GLARGS      SAVE INPUT ARGUMENTS                         
*                                                                               
*        SEARCH TABLE TO FIND WHERE DATA TO BE FOUND                            
*                                                                               
         L     R4,=A(IDTAB)        TABLE OF IDS AND SOURCES                     
         USING IDENTD,R4           ESTABLISH A TABLE ENTRY                      
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,IIDARGS+2      RELATIVE ENTRY IN TABLE                      
         AH    R0,=H'1'            ENTRY NUMBER FOR BCT                         
*                                                                               
IIDTABLP DS    0H                                                               
*                                                                               
         CLI   0(R4),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    IIDTABDN                                                         
*                                                                               
         CLC   IIDARGS(1),IDRECID  MATCH DATA TYPES                             
         BNE   IIDTABCN                                                         
*                                                                               
         BCT   R0,*+8                                                           
         B     IIDTABFD            CORRECT ENTRY FOUND                          
*                                                                               
IIDTABCN DS    0H                                                               
*                                                                               
         LA    R4,IDENTL(R4)       BUMP TO NEXT ENTRY IN TABLE                  
         B     IIDTABLP                                                         
*                                                                               
IIDTABDN DS    0H                                                               
         B     IIDX                TABLE ENTRY NOT FOUND                        
*                                                                               
IIDTABFD DS    0H                                                               
*                                                                               
         SR    RF,RF               POINT TO LOOK UP TABLE                       
         ICM   RF,7,IDLKUPTA                                                    
         BZ    IIDTABX             SKIP IF NO TABLE AVAILABLE                   
*                                                                               
         LA    RF,RENWRIOD(RF)     RE-LOCATE ADDRESS                            
*                                                                               
         ICM   RF,15,0(RF)         POINT TO TABLE                               
         BNZ   IIDTABX             OKAY IF TABLE IS PRESENT                     
*                                                                               
         CLI   IIDARGS+1,C'C'      IF LOOKING FOR CODE ONLY                     
         BNE   IIDTB1DN                                                         
*                                                                               
         L     RF,REAIO1                                                        
         CLI   0(RF),RCONKTYQ      SKIP IF CONTRACT RECORD NOT IN CORE          
         BNE   IIDTB1DN                                                         
*                                                                               
         L     R4,=A(IDTAB1)          TRY SECOND TABLE IN CASE                  
*                                         IN CONTRACT KEY                       
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,IIDARGS+2      RELATIVE ENTRY IN TABLE                      
         AH    R0,=H'1'            ENTRY NUMBER FOR BCT                         
*                                                                               
IIDTB1LP DS    0H                                                               
*                                                                               
         CLI   0(R4),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    IIDTB1DN                                                         
*                                                                               
         CLC   IIDARGS(1),IDRECID  MATCH DATA TYPES                             
         BNE   IIDTB1CN                                                         
*                                                                               
         BCT   R0,*+8                                                           
         B     IIDTB1FD            CORRECT ENTRY FOUND                          
*                                                                               
IIDTB1CN DS    0H                                                               
*                                                                               
         LA    R4,IDENTL(R4)       BUMP TO NEXT ENTRY IN TABLE                  
         B     IIDTB1LP                                                         
*                                                                               
IIDTB1DN DS    0H                                                               
         B     IIDX                                                             
*                                                                               
IIDTB1FD DS    0H                                                               
*                                                                               
         MVI   GLARGS,RCONKTYQ     CHANGE TO USE CONTRACT RECORD                
*                                                                               
IIDTABX  DS    0H                                                               
*                                                                               
         GOTO1 =A(SETREP)          GET CORRECT REP                              
*                                                                               
*        TABLE FORMAT   RECORD ID OF WHERE DATA LOCATED                         
*                       IELM PARAMETERS FOR CODE                                
*                       IELM PARAMETERS FOR TABLE LOOKUP DATA                   
*                       IELM PARAMETERS FOR NAME                                
*                       ACTUAL LENGTH OF NAME                                   
*                                                                               
*        BUDGET KEYWORDS                                                        
*                                                                               
         L     R5,REAIO1           POINT TO RECORD IN CORE                      
         USING RCONKEY,R5          ASSUME A CONTRACT KEY                        
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   IF NOT A CONTRACT RECORD                     
         BE    IIDCON                                                           
*                                                                               
         CLI   RCONKTYP,RBUDKTYQ      SKIP IF NOT BUDGET KEYWORD                
         BE    *+8                                                              
         CLI   RCONKTYP,ROBDKTYQ      SKIP IF NOT BUDGET KEYWORD                
         BNE   IIDBUDN                                                          
*                                                                               
         L     R5,REANWMON         POINT TO BUDGET DOLLARS TABLE                
         USING BDMNTABD,R5         ESTABLISH MONTH TABLE AREA                   
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**'  SKIP IF NOT BUDGET TABLE            
         BNE   IIDX                                                             
*                                                                               
         CLI   IIDARGS,RREPKTYQ    IF REP KEYWORD                               
         BNE   *+14                                                             
         MVC   IIDCODE(L'REREP),BDMTREP RETURN REP CODE                         
         B     IIDBUDX                                                          
*                                                                               
         CLI   IIDARGS,ROFFKTYQ    IF OFFICE KEYWORD                            
         BNE   IIDBDOFN                                                         
*                                                                               
         MVC   IIDCODE(L'REOFF),BDMTOFF RETURN OFFICE CODE                      
*                                                                               
         B     IIDBUDX                                                          
*                                                                               
IIDBDOFN DS    0H                                                               
*                                                                               
         CLI   IIDARGS,RGRPKTYQ    IF SUBGROUP KEYWORD                          
         BNE   IIDBDSGN                                                         
*                                                                               
         MVC   IIDCODE(L'BDMTSGR),BDMTSGR   RETURN SUBGROUP CODE                
*                                                                               
         B     IIDBUDX                                                          
*                                                                               
IIDBDSGN DS    0H                                                               
*                                                                               
IIDBUDX  DS    0H                                                               
*                                                                               
         CLI   IIDARGS+1,C'C'         DONE IF CODE ONLY NEEDED                  
         BE    IIDNAMEX                                                         
*                                                                               
         B     IIDFND1                                                          
*                                                                               
IIDBUDN  DS    0H                                                               
*                                                                               
         CLI   FLAVOR,C'R'         OKAY IF RGON REPORT                          
         BE    IIDCON                                                           
*                                                                               
         B     IIDX                UNKNOWN DATA SOURCE                          
*                                                                               
IIDCON   DS    0H                  CONTRACT RECORD IN CORE                      
*                                                                               
*        RGON REPORTS                                                           
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   IIDRGNN                                                          
*                                                                               
         LA    R5,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R5                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    IIDX                                                             
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    IIDX                  USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    IIDX                                                             
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    IIDX                  USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    IIDX                                                             
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-18                                                          
         B     IIDX                NO DATA TYPE MATCH                           
*                                                                               
         MVC   IIDCODE,0(R1)       SAVE DATA                                    
*                                                                               
         B     IIDFND              DATA FOUND                                   
*                                                                               
IIDRGNN DS     0H                                                               
*                                                                               
*        CONTRACT DRIVEN REPORTS                                                
*                                                                               
         MVC   GLARGS+1(3),IDCDEPRM IELM PARAMETERS FOR CODE                    
*                                                                               
         GOTO1 =A(IELM)            FIND CODE                                    
*                                                                               
         MVC   IIDCODE,0(R2)       SAVE CODE                                    
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCDELN          CODE LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         XC    0(0,R2),0(R2)       CLEAR CODE FROM DRIVER INPUT                 
*                                                                               
IIDFND   DS    0H                                                               
*                                                                               
         CLI   IIDARGS+1,C'C'      DONE IF CODE ONLY NEEDED                     
         BE    IIDNAMEX                                                         
*                                                                               
         CLI   FLAVOR,C'R'         IF RGON REPORT                               
         BNE   IIDFNRGN                                                         
*                                                                               
IIDFND1  DS    0H                                                               
*                                                                               
         LA    R1,IIDLKUP          START OF LOOK UP CODE                        
*                                                                               
         TM    IDCLKCTL,IDCLKCRQ   SKIP IF REP AFTER CODE                       
         BO    *+14                                                             
         MVC   0(L'REREP,R1),REDMREP    ADD REP TO CODE                         
         LA    R1,L'REREP(R1)           BUMP TO NEXT AREA                       
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCDELN          CODE LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),IIDCODE     ADD CODE TO LOOK UP CODE                     
*                                                                               
         LA    R1,1(RF,R1)         NEXT AVAILABLE AREA                          
*                                                                               
         TM    IDCLKCTL,IDCLKCRQ   SKIP IF REP BEFORE CODE                      
         BNO   IIDFNRGX                                                         
*                                                                               
         CLI   IIDARGS,RAGK2TYQ       IF AGENCY KEYWORD                         
         BNE   *+8                                                              
         LA    R1,L'RAGK2AOF(R1)         ALLOW FOR OFFICE ID                    
*                                                                               
         MVC   0(L'REREP,R1),REDMREP     ADD REP TO CODE                        
         LA    R1,L'REREP(R1)            BUMP TO NEXT AREA                      
*                                                                               
IIDFNRGX DS    0H                                                               
*                                                                               
         B     IIDLKUPX                                                         
*                                                                               
IIDFNRGN DS    0H                                                               
*                                                                               
*        FIND DATA TO IDENTIFY RECORD IN TABLE                                  
*                                                                               
         MVC   GLARGS+1(3),IDCLKPRM IELM PARAMETERS FOR LOOKUP DATA             
*                                                                               
         GOTO1 =A(IELM)            FIND CODE                                    
*                                                                               
         MVC   IIDLKUP,0(R2)       SAVE DATA                                    
*                                                                               
         CLI   IIDARGS,RAGK2TYQ     IF AGENCY ALONE                             
         BNE   *+18                                                             
         CLI   IIDARGS+2,0            (OFFICE)                                  
         BNE   *+10                                                             
         MVC   IIDLKUP+4(2),RESPACES    KILL AGENCY OFFICE CODE                 
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCLKLN          CODE LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         XC    0(0,R2),0(R2)       CLEAR CODE FROM DRIVER INPUT                 
*                                                                               
IIDLKUPX DS    0H                                                               
*                                                                               
         CLI   IIDARGS,X'02'       IF STATION                                   
         BNE   IIDNAMEX                                                         
*                                                                               
         MVC   GLARGS+1(3),IDNAMPRM GET IELM PARAMETERS FOR NAME                
*                                                                               
         GOTO1 =A(IELM)            GET NAME                                     
*                                                                               
         MVC   IIDNAME,0(R2)       SAVE NAME                                    
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDNAMLN          NAME LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),RESPACES    CLEAR NAME FROM DRIVER INPUT                 
*                                                                               
IIDNAMEX DS    0H                                                               
*                                                                               
         MVC   GLARGS(16),IIDARGS  RESTORE GLARGS                               
*                                                                               
         LA    R1,0(R2)            POINT TO START OF DRIVER INPUT AREA          
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCDELN          GET CODE LENGTH                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         CLI   IIDARGS+1,C'S'      SKIP IF SORTING ON NAME                      
         BE    *+18                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),IIDCODE     PASS CODE                                    
*                                                                               
         LA    R1,1(RF,R1)         POINT TO NAME AREA                           
*                                                                               
         CLI   IIDARGS+1,C'C'      DONE IF CODE ONLY NEEDED                     
         BE    IIDX                                                             
*                                                                               
         CLI   IIDARGS,X'02'       IF STATION                                   
         BE    *+8                                                              
         CLI   IIDARGS+1,C'S'      OR SORTING ON NAME                           
         BNE   IIDCODEX                                                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDNAMLN             GET NAME LENGTH                           
         BCTR  RF,0                   DECREMENT FOR EXECUTE                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),IIDNAME        PASS NAME                                 
*                                                                               
         LA    R1,1(RF,R1)            POINT TO LOOK UP AREA                     
*                                                                               
IIDCODEX DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCLKLN          GET CODE LENGTH                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),IIDLKUP     PASS CODE                                    
*                                                                               
IIDNAMA  DS    0H                                                               
*                                                                               
         CLI   IIDARGS+1,C'S'      IF SORTING BY NAME                           
         BNE   IIDNAMAX                                                         
*                                                                               
         LA    R3,WORK                POINT TO A WORKAREA                       
*                                                                               
         GOTO1 =A(OID)                LOOK UP NAME IN TABLE                     
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCDELN          GET CODE LENGTH                              
         LA    R1,0(RF,R2)         START OF NAME                                
*                                                                               
         IC    RF,IDNAMLN          NAME LENGTH                                  
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),NAMEAREA    PASS NAME TO DRIVER                          
*                                                                               
IIDNAMAX DS    0H                                                               
*                                                                               
IIDX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
IIDCODE  DS    XL16                CODE SAVEAREA                                
IIDNAME  DS    XL32                NAME SAVEAREA                                
IIDLKUP  DS    XL16                CODE SAVEAREA                                
IIDARGS  DS    XL16                GLARGS SAVEAREA                              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
         TITLE 'RENWRTER - TABLE FOR RETRIEVING CODE AND NAME -IDTAB'           
***********************************************************************         
*                                                                     *         
*                                                                     *         
*        TABLE OF PARAMETERS FOR RETRIEVING CODE AND NAME             *         
*              AL1    - RECORD CODE                                   *         
*              AL3    - A(LOOK UP TABLE)                              *         
*        SORTING BY CODE                                              *         
*              XL1    - ELEMENT ID   FOR CODE - XL1'00' = KEY         *         
*              AL1    - DISPLACEMENT TO  CODE                         *         
*              AL1    - LENGTH       OF  CODE                         *         
*              AL1    - SPARE                                         *         
*        LOOKING UP CODE IN A TABLE                                   *         
*              XL1    - ELEMENT ID   FOR CODE - XL1'00' = KEY         *         
*              AL1    - DISPLACEMENT TO  CODE                         *         
*              AL1    - LENGTH       OF  CODE PLUS OTHER DATA FOR     *         
*                                        COMPLETE IDENTIFICATION      *         
*              AL1    - CONTROL                                       *         
*                       X'80' - REP IS AFTER CODE                     *         
*                                                                     *         
*        PRINTING NAME                                                *         
*              XL1    - ELEMENT ID   FOR NAME - XL1'00' = KEY         *         
*              AL1    - DISPLACEMENT TO  NAME                         *         
*              AL1    - LENGTH       OF  NAME FOR INPUT               *         
*              AL1    - LENGTH       OF  NAME FOR OUTPUT              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IDTAB    DS    0D                                                               
*                                                                               
         DC    AL1(RADVKTYQ),AL3(READVTBA-RENWRIOD) ADVERTISER                  
         DC    XL1'00',AL1(RADVKADV-RADVKEY,L'RADVKADV,0)                       
         DC   XL1'00',AL1(RADVKADV-RADVKEY,L'RADVKADV+L'RADVKREP,X'80')         
         DC    XL1'01',AL1(RADVNAME-RADVELEM,10,L'RADVNAME)  NAME               
*                                                                               
         DC    AL1(RAG2KTYQ),AL3(REAG2TBA-RENWRIOD) AGENCY                      
         DC    XL1'00',AL1(RAGK2AGY-RAGY2KEY,L'RAGK2AGY,0)                      
         DC    XL1'00',AL1(RAGK2AGY-RAGY2KEY,8,X'80')                           
         DC    XL1'1F',AL1(RAG2NAM1-RAG2ELEM,10,L'RAG2NAM1)  NAME               
*                                                                               
         DC    AL1(RAGK2TYQ),AL3(REAG2TBA-RENWRIOD) AGENCY OFFICE               
         DC    XL1'00',AL1(RAGK2AGY-RAGY2KEY,L'RAGK2AGY+L'RAGK2AOF,0)           
         DC    XL1'00',AL1(RAGK2AGY-RAGY2KEY,8,X'80')                           
         DC    XL1'1F',AL1(RAG2NAM1-RAG2ELEM,10,L'RAGYNAM1)  NAME               
*                                                                               
         DC    AL1(RCLSKTYQ),AL3(RECLSTBA-RENWRIOD) CLASS                       
         DC    XL1'00',AL1(RCLSKCLS-RCLSKEY,L'RCLSKCLS,0)    CODE               
         DC    XL1'00',AL1(RCLSKREP-RCLSKEY,L'RCLSKREP+L'RCLSKCLS,0)            
         DC    XL1'01',AL1(RCLSNAME-RCLSELEM,10,L'RCLSNAME)  NAME               
*                                                                               
         DC    AL1(RCONKTYQ),AL3(0)                CONTRACT                     
         DC    XL1'00',AL1(RCONKCON-RCONKEY,L'RCONKCON,0)    CODE               
         DC    XL1'00',AL1(RCONKCON-RCONKEY,L'RCONKCON,0)    CODE               
         DC    XL1'01',AL1(RCONBUYR-RCONELEM,L'RCONBUYR,L'RCONBUYR)             
*                                                                               
         DC    AL1(RCTGKTYQ),AL3(RECTGTBA-RENWRIOD) CATEGORY                    
         DC    XL1'00',AL1(RCTGKCTG-RCTGKEY,L'RCTGKCTG,0)    CODE               
         DC    XL1'00',AL1(RCTGKREP-RCTGKEY,L'RCTGKREP+L'RCTGKCTG,0)            
         DC    XL1'01',AL1(RCTGNAME-RCTGELEM,10,L'RCTGNAME)  NAME               
*                                                                               
         DC    AL1(RCTYKTYQ),AL3(RECTYTBA-RENWRIOD) CONTRACT TYPE               
         DC    XL1'00',AL1(RCTYKCTY-RCTYKEY,L'RCTYKCTY,0)    CODE               
         DC    XL1'00',AL1(RCTYKREP-RCTYKEY,L'RCTYKREP+L'RCTYKCTY,0)            
         DC    XL1'01',AL1(RCTYDESC-RCTYELEM,10,L'RCTYDESC)  NAME               
*                                                                               
         DC    AL1(RDCTKTYQ),AL3(REDCTTBA-RENWRIOD) DEVELOP CONT TYPE           
         DC    XL1'00',AL1(RDCTKCTY-RDCTKEY,L'RDCTKCTY,0)    CODE               
         DC    XL1'00',AL1(RDCTKREP-RDCTKEY,L'RDCTKREP+L'RDCTKCTY,0)            
         DC    XL1'01',AL1(RDCTDESC-RDCTELEM,10,L'RDCTDESC)  NAME               
*                                                                               
         DC    AL1(RDSPKTYQ),AL3(REDSPTBA-RENWRIOD) DEVELOP SALES PERS          
         DC    XL1'00',AL1(RDSPKSAL-RDSPKEY,L'RDSPKSAL,0)    CODE               
         DC    XL1'00',AL1(RDSPKREP-RDSPKEY,L'RDSPKREP+L'RDSPKSAL,0)            
         DC    XL1'01',AL1(RDSPNAME-RDSPELEM,10,L'RDSPNAME)  NAME               
*                                                                               
         DC    AL1(RGRPKTYQ),AL3(REGRPTBA-RENWRIOD) GROUP                       
         DC    XL1'00',AL1(RGRPKGRP-RGRPKEY,1,0)             CODE               
         DC    XL1'00',AL1(RGRPKREP-RGRPKEY,L'RGRPKREP+1,0)                     
         DC    XL1'01',AL1(RGRPNAME-RGRPELEM,10,L'RGRPNAME)  NAME               
*                                                                               
         DC    AL1(RGRPKTYQ),AL3(REGRPTBA-RENWRIOD) SUBGROUP                    
         DC    XL1'00',AL1(RGRPKGRP-RGRPKEY,L'RGRPKGRP,0)    CODE               
         DC    XL1'00',AL1(RGRPKREP-RGRPKEY,L'RGRPKREP+L'RGRPKGRP,0)            
         DC    XL1'01',AL1(RGRPSBNM-RGRPELEM,10,L'RGRPSBNM)  NAME               
*                                                                               
         DC    AL1(RMKTKTYQ),AL3(REMKTTBA-RENWRIOD) MARKET                      
         DC    XL1'00',AL1(RMKTKMKT-RMKTKEY,L'RMKTKMKT,0)    CODE               
         DC    XL1'00',AL1(RMKTKREP-RMKTKEY,L'RMKTKREP+L'RMKTKMKT,0)            
         DC    XL1'01',AL1(RMKTNAME-RMKTELEM,20,L'RMKTNAME)  NAME               
*                                                                               
         DC    AL1(ROFFKTYQ),AL3(REOFFTBA-RENWRIOD) OFFICE                      
         DC    XL1'00',AL1(ROFFKOFF-ROFFKEY,L'ROFFKOFF,0)    CODE               
         DC    XL1'00',AL1(ROFFKREP-ROFFKEY,L'ROFFKREP+L'ROFFKOFF,0)            
         DC    XL1'01',AL1(ROFFNAME-ROFFELEM,10,L'ROFFNAME)  NAME               
*                                                                               
         DC    AL1(ROWNKTYQ),AL3(REOWNTBA-RENWRIOD) OWNER                       
         DC    XL1'00',AL1(ROWNKOWN-ROWNKEY,L'ROWNKOWN,0)    CODE               
         DC    XL1'00',AL1(ROWNKREP-ROWNKEY,L'ROWNKREP+L'ROWNKOWN,0)            
         DC    XL1'01',AL1(ROWNNAME-ROWNELEM,10,L'ROWNNAME)  NAME               
*                                                                               
         DC    AL1(RPTPKTYQ),AL3(REPTPTBA-RENWRIOD) POINT PERSON                
         DC    XL1'00',AL1(RPTPKREC-RPTPKEY,L'RPTPKREC,0)    CODE               
         DC    XL1'00',AL1(RPTPKREP-RPTPKEY,L'RPTPKREP+L'RPTPKREC,0)            
         DC    XL1'01',AL1(RPTPNAME-RPTPELEM,10,L'RPTPNAME)  NAME               
*                                                                               
         DC    AL1(RPRDKTYQ),AL3(REPRDTBA-RENWRIOD) PRODUCT                     
         DC    XL1'00',AL1(RPRDKPRD-RPRDKEY,L'RPRDKPRD,0)    CODE               
         DC    XL1'00',AL1(RPRDKADV-RPRDKEY,9,X'80')   ADV/PRD/REP              
         DC    XL1'01',AL1(RPRDNAME-RPRDELEM,10,L'RPRDNAME)  NAME               
*                                                                               
         DC    AL1(RREGKTYQ),AL3(REREGTBA-RENWRIOD) REGION                      
         DC    XL1'00',AL1(RREGKREG-RREGKEY,L'RREGKREG,0)    CODE               
         DC    XL1'00',AL1(RREGKREP-RREGKEY,L'RREGKREP+L'RREGKREG,0)            
         DC    XL1'01',AL1(RREGNAME-RREGELEM,10,L'RREGNAME)  NAME               
*                                                                               
         DC    AL1(RREPKTYQ),AL3(REREPTBA-RENWRIOD) REP                         
         DC    XL1'00',AL1(RREPKREP-RREPKEY,L'RREPKREP,0)    CODE               
         DC    XL1'00',AL1(RREPKREP-RREPKEY,L'RREPKREP,0)    CODE               
         DC    XL1'01',AL1(RREPNAME-RREPELEM,10,L'RREPNAME)  NAME               
*                                                                               
         DC    AL1(RSALKTYQ),AL3(RESALTBA-RENWRIOD) SALESPERSON                 
         DC    XL1'00',AL1(RSALKSAL-RSALKEY,L'RSALKSAL,0)    CODE               
         DC    XL1'00',AL1(RSALKREP-RSALKEY,L'RSALKREP+L'RSALKSAL,0)            
         DC    XL1'01',AL1(RSALNAME-RSALELEM,10,L'RSALNAME)  NAME               
*                                                                               
         DC    AL1(RSTAKTYQ),AL3(0)                STATION                      
         DC    XL1'00',AL1(RSTAKSTA-RSTAKEY,L'RSTAKSTA,0)    CODE               
         DC    XL1'00',AL1(RSTAKREP-RSTAKEY,L'RSTAKREP+L'RSTAKSTA,0)            
         DC    XL1'01',AL1(RSTAMKT-RSTAELEM,L'RSTAMKT,L'RSTAMKT) MARKET         
*                                                                               
         DC    AL1(RTEMKTYQ),AL3(RETEMTBA-RENWRIOD) DIVISION/TEAM               
         DC    XL1'00',AL1(RTEMKTEM-RTEMKEY,L'RTEMKTEM,0)    CODE               
         DC    XL1'00',AL1(RTEMKREP-RTEMKEY,L'RTEMKREP+L'RTEMKTEM,0)            
         DC    XL1'01',AL1(RTEMDVNM-RTEMELEM,10,L'RTEMDVNM+L'RTEMNAME)          
*                                                                               
         DC    AL1(RTERKTYQ),AL3(RETERTBA-RENWRIOD) TERRITORY                   
         DC    XL1'00',AL1(RTERKTER-RTERKEY,L'RTERKTER,0)    CODE               
         DC    XL1'00',AL1(RTERKREP-RTERKEY,L'RTERKREP+L'RTERKTER,0)            
         DC    XL1'01',AL1(RTERNAME-RTERELEM,10,L'RTERNAME)                     
*                                                                               
IDTABX DC     X'FF'               END OF TABLE                                  
*                                                                               
*        THIS TABLE USED IN CASES WHERE WE ARE LOOKIN FOR CODES ONLY            
*        THE CODE MAYBE IN THE CONTRACT KEY AND THUS WE DON'T                   
*        NEED THE ITS ID RECORD IN A TABLE                                      
*                                                                               
IDTAB1   DS    0D                                                               
*                                                                               
         DC    AL1(RADVKTYQ),AL3(READVTBA-RENWRIOD) ADVERTISER                  
         DC    XL1'00',AL1(RCONKADV-RCONKEY,L'RCONKADV,0)                       
         DC    XL4'00'                                                          
         DC    XL4'00'                                                          
*                                                                               
         DC    AL1(RAG2KTYQ),AL3(REAG2TBA-RENWRIOD) AGENCY                      
         DC    XL1'00',AL1(RCONKAGY-RCONKEY,L'RCONKAGY,0)                       
         DC    XL4'00'                                                          
         DC    XL4'00'                                                          
*                                                                               
         DC    AL1(RAG2KTYQ),AL3(REAG2TBA-RENWRIOD) AGENCY OFFICE               
         DC    XL1'00',AL1(RCONKAGY-RCONKEY,L'RCONKAGY+L'RCONKAOF,0)            
         DC    XL4'00'                                                          
         DC    XL4'00'                                                          
*                                                                               
IDTAB1X  DC   X'FF'               END OF TABLE                                  
*                                                                               
         TITLE 'RENWRTER - PRINT GENERIC CODE AND NAME KEYWORD - OID'           
***********************************************************************         
*                                                                     *         
*        ROUTINE TO HANDLE KEYWORDS BASED ON AN ID AND A              *         
*             FOLLOWING DESCRIPTION                                   *         
*                                                                     *         
*             DATA FOUND IN TABLES                                    *         
*                                                                     *         
*NTRY                                                                 *         
*        R2==>  DRIVER INPUT AREA                                     *         
*        R9==>  PRINTWRITER WORKAREA                                  *         
*        RA==>  DRIVER GLOBAL AREA                                    *         
*        RC==>  GENCON WORKAREA                                       *         
*                                                                     *         
*        GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = C'C' ID OR CODE ONLY                              *         
*                   C'B' ID AND NAME                                  *         
*                   C'N' NAME ONLY                                    *         
*                   C'S' NAME ONLY AND SORTING ON NAME                *         
*                                                                     *         
*NTRY    R2==>  CODE,NAME,CODE IF ALL NEEDED                          *         
*               FIRST CODE MISSING IF SORTING BY NAME                 *         
*               TO SAVE SPACE ONLY 1ST 10 BYTES OF NAME PASSED        *         
*                                                                     *         
*EXIT                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OID      NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   OIDCODE,RESPACES    INIT WORKAREAS                               
         MVC   OIDNAME,RESPACES                                                 
         MVC   CODEAREA,RESPACES                                                
         MVC   NAMEAREA,RESPACES                                                
*                                                                               
*        SEARCH TABLE TO FIND WHERE DATA TO BE FOUND                            
*                                                                               
         L     R4,=A(IDTAB)        TABLE OF IDS AND SOURCES                     
         USING IDENTD,R4           ESTABLISH A TABLE ENTRY                      
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,GLARGS+2       RELATIVE NUMBER OF ENTRY IN TABLE            
         AH    R0,=H'1'            MAKE ABSOLUTE NUMBER                         
*                                  USED FOR 2 SETS OF DATA IN SAME REC          
OIDTABLP DS    0H                                                               
*                                                                               
         CLI   0(R4),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    OIDX                                                             
*                                                                               
         CLC   GLARGS(1),IDRECID   MATCH DATA TYPES                             
         BNE   OIDTABCN                                                         
*                                                                               
         BCT   R0,*+8                                                           
         B     OIDTABFD            CORRECT TABLE ENTRY FOUND                    
*                                                                               
OIDTABCN DS    0H                                                               
*                                                                               
         LA    R4,IDENTL(R4)       BUMP TO NEXT ENTRY IN TABLE                  
         B     OIDTABLP                                                         
*                                                                               
OIDTABFD DS    0H                                                               
*                                                                               
*        TABLE FORMAT   RECORD ID OF WHERE DATA LOCATED,A(LOOKUP TABLE)         
*                       IELM PARAMETERS FOR CODE                                
*                       IELM PARAMETERS FOR LOOK UP                             
*                       IELM PARAMETERS FOR NAME                                
*                       ACTUAL LENGTH OF NAME                                   
*                                                                               
         LA    R1,0(R2)            POINT TO DRIVER INPUT                        
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDCDELN          CODE LENGTH                                  
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   OIDCODE(0),0(R1)    SAVE CODE                                    
*                                                                               
         LA    R1,1(RF,R1)         POINT TO NEXT AREA OF INPUT                  
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   OIDNAMEN                                                         
*                                                                               
         IC    RF,IDNAMLN             GET NAME INPUT LENGTH                     
         BCTR  RF,0                   DECREMENT FOR EXECUTE                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   OIDNAME(0),0(R1)       SAVE NAME                                 
*                                                                               
         LA    R1,1(RF,R1)            POINT TO LOOKUP DATA                      
*                                                                               
OIDNAMEN DS    0H                                                               
*                                                                               
         IC    RF,IDCLKLN             GET LOOK UP DATA LENGTH                   
         BCTR  RF,0                   DECREMENT FOR EXECUTE                     
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   OIDLKUP(0),0(R1)       SAVE LOOK UP DATA                         
*                                                                               
*        USING LOOK UP DATA TO FIND ENTRY IN LOOK UP TABLE                      
*                                                                               
         SR    R8,R8                                                            
         ICM   R8,7,IDLKUPTA       POINT TO LOOK UP TABLE                       
         BZ    OIDNTAB             SKIP IF TABLE ADDRESS NOT FOUND              
*                                                                               
*        USING CODE FIND ENTRY IN LOOKUP TABLE                                  
*        OIDLKUP HAS CODE                                                       
*        RF =   EXECUTE LENGTH OF CODE                                          
*                                                                               
         LA    R8,RENWRIOD(R8)     RE-LOCATE ADDRESS                            
*                                                                               
         ICM   R8,15,0(R8)         POINT TO TABLE                               
         BZ    OIDNTAB               NONE AVAILABLE                             
*                                                                               
         USING STDTTABD,R8         ESTABLISH TABLE PARMATERS                    
*                                                                               
         CLI   GLARGS,RAGK2TYQ     SKIP IF AGY TABLE                            
         BE    *+8                                                              
         CLI   GLARGS,RADVKTYQ     SKIP IF ADV TABLE                            
         BE    *+8                                                              
         CLI   GLARGS,RPRDKTYQ     SKIP IF PRD TABLE                            
         BE    *+8                                                              
         CLI   GLARGS,RREPKTYQ     SKIP IF REP TABLE                            
         BE    OIDBS                                                            
*                                                                               
         L     R5,STDTBXLE         LOAD START OF TABLE                          
         USING STDTENT,R5          ESTABLISH TABLE ENTRY                        
*                                                                               
         SR    R0,R0                                                            
         IC    R0,IDCLKDSP         DISP OF LOOK UP DATA IN KEY OR ELM           
*                                                                               
OIDNTLP  DS    0H                                                               
*                                                                               
         LA    R6,STDTKEY          ASSUME CODE IN KEY                           
*                                                                               
         CLI   IDCLKEID,0          IF ELEMENT ID GIVEN                          
         BE    OIDNTLP1                                                         
*                                                                               
         LA    R6,STDTELM             USE STORED ELEMENT                        
*                                                                               
         CLC   IDCLKEID,STDTELM       MUST MATCH WANTED ELEMENT                 
         BNE   OIDNAMEX                                                         
*                                                                               
OIDNTLP1 DS    0H                  RE ==> REQUIRED ELEMENT                      
*                                                                               
         AR    R6,R0               POINT TO CODE IN TABLE ENTRY                 
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R1),0(R6)       MATCH CODE TO TABLE ENTRY                    
         BE    OIDNTFD                                                          
*                                                                               
OIDNTCN  DS    0H                                                               
*                                                                               
         A     R5,STDTBXLE+4       BUMP TO NEXT TABLE ENTRY                     
         C     R5,STDTBXLE+8                                                    
         BNH   OIDNTLP                                                          
*                                                                               
OIDNTDN  DS    0H                                                               
*                                                                               
         B     OIDNTAB             NO TABLE ENTRY FOUND                         
*                                                                               
*        TABLE IS SEARCHED VIA BINSRCH                                          
*                                                                               
*        MUST BE ADV TAB                                                        
*                                                                               
OIDBS    DS    0H                                                               
*                                                                               
         CLI   GLARGS,RADVKTYQ     SKIP IF NOT ADV DATA                         
         BNE   OIDBSADN                                                         
*                                                                               
         USING ADVTTABD,R8         ESTABLISH ADVTAB                             
*                                                                               
         XC    ADVTKEY,ADVTKEY                                                  
         LA    R6,ADVTKEY          BUILD SEARCH KEY                             
         USING RADVKEY,R6                                                       
*                                                                               
         MVC   RADVKTYP(1),GLARGS  RECORD TYPE                                  
         MVC   RADVKADV(L'RADVKADV+L'RADVKREP),OIDLKUP  ADV & REP               
*                                                                               
         GOTO1 BINSRCH,ADVTBSRP,('BSPFIND',ADVTKEY)   FIND ENTRY                
*                                                                               
         CLI   BSPCNTL-BSPPRMS+ADVTBSRP,BSPNF DONE IF NOT FOUND                 
         BE    OIDNTAB                                                          
*                                                                               
         ICM   R5,15,BSPAREC-BSPPRMS+ADVTBSRP POINT TO ENTRY                    
         BZ    OIDNTAB             NOTHING FOUND                                
*                                                                               
         ST    R5,READVTA          A(CURRENT TABLE ENTRY)                       
*                                                                               
         B     OIDBSX                                                           
*                                                                               
OIDBSADN DS    0H                                                               
*                                                                               
         CLI   GLARGS,RPRDKTYQ     SKIP IF NOT PRD DATA                         
         BNE   OIDBSPRN                                                         
*                                                                               
         USING PRDTTABD,R8         ESTABLISH PRDTAB                             
*                                                                               
         XC    PRDTKEY,PRDTKEY                                                  
         LA    R6,PRDTKEY          BUILD SEARCH KEY                             
         USING RPRDKEY,R6                                                       
*                                                                               
         MVC   RPRDKTYP(1),GLARGS  RECORD TYPE                                  
         MVC   RPRDKADV(L'RPRDKADV+L'RPRDKPRD+L'RPRDKREP),OIDLKUP               
*                                                                               
         GOTO1 BINSRCH,PRDTBSRP,('BSPFIND',PRDTKEY)   FIND ENTRY                
*                                                                               
         CLI   BSPCNTL-BSPPRMS+PRDTBSRP,BSPNF DONE IF NOT FOUND                 
         BE    OIDNTAB                                                          
*                                                                               
         ICM   R5,15,BSPAREC-BSPPRMS+PRDTBSRP POINT TO ENTRY                    
         BZ    OIDNTAB             NOTHING FOUND                                
*                                                                               
         ST    R5,REPRDTA          A(CURRENT TABLE ENTRY)                       
*                                                                               
         B     OIDBSX                                                           
*                                                                               
OIDBSPRN DS    0H                                                               
*                                                                               
*        ASSUME AGYTAB DATA                                                     
*                                                                               
         CLI   GLARGS,RAGK2TYQ     SKIP IF NOT AGY DATA                         
         BNE   OIDBSAGN                                                         
*                                                                               
         USING AGYTTABD,R8         ESTABLISH AGYTAB                             
*                                                                               
         XC    AGYTKEY,AGYTKEY                                                  
         LA    R6,AGYTKEY          BUILD SEARCH KEY                             
         USING RAGY2KEY,R6                                                      
*                                                                               
         MVC   RAGK2TYP(1),GLARGS  RECORD TYPE                                  
         MVC   RAGK2AGY(8),OIDLKUP  AGY/AOF/REP                                 
*                                                                               
         GOTO1 BINSRCH,AGYTBSRP,('BSPFIND',AGYTKEY)   FIND ENTRY                
*                                                                               
         CLI   BSPCNTL-BSPPRMS+AGYTBSRP,BSPNF DONE IF NOT FOUND                 
         BE    OIDNTAB                                                          
*                                                                               
         ICM   R5,15,BSPAREC-BSPPRMS+AGYTBSRP POINT TO ENTRY                    
         BZ    OIDNTAB             NOTHING FOUND                                
*                                                                               
*******  ST    R5,REAGYTA          A(CURRENT TABLE ENTRY)                       
*                                                                               
         B     OIDBSX                                                           
*                                                                               
OIDBSAGN DS    0H                                                               
*                                                                               
*        TABLE IS SEARCHED VIA BINSRCH                                          
*                                                                               
*        MUST BE REP TAB                                                        
*                                                                               
         CLI   GLARGS,RREPKTYQ     SKIP IF NOT REP DATA                         
         BNE   OIDBSRPN                                                         
*                                                                               
         USING REPTTABD,R8         ESTABLISH REPTAB                             
*                                                                               
         XC    REPTKEY,REPTKEY                                                  
         LA    R6,REPTKEY          BUILD SEARCH KEY                             
         USING RREPKEY,R6                                                       
*                                                                               
         MVC   RREPKTYP(1),GLARGS  RECORD TYPE                                  
         MVC   RREPKREP(L'RREPKREP),OIDLKUP  REP                                
*                                                                               
         GOTO1 BINSRCH,REPTBSRP,('BSPFIND',REPTKEY)   FIND ENTRY                
*                                                                               
         CLI   BSPCNTL-BSPPRMS+REPTBSRP,BSPNF DONE IF NOT FOUND                 
         BE    OIDNTAB                                                          
*                                                                               
         ICM   R5,15,BSPAREC-BSPPRMS+REPTBSRP POINT TO ENTRY                    
         BZ    OIDNTAB             NOTHING FOUND                                
*                                                                               
         ST    R5,REREPTA          A(CURRENT TABLE ENTRY)                       
*                                                                               
         B     OIDBSX                                                           
*                                                                               
OIDBSRPN DS    0H                                                               
*                                                                               
OIDBSX   DS    0H                                                               
*                                                                               
         USING STDTTABD,R8         ESTABLISH TABLE PARMATERS                    
*                                                                               
OIDNTFD  DS    0H                                                               
*                                                                               
         CLI   GLARGS,RCTGKTYQ     IF FINDING CATEGORY                          
         BNE   OIDNTFD1                                                         
*                                                                               
         ICM   RF,7,IDLKUPTA          POINT TO LOOK UP TABLE                    
         LA    RF,RENWRIOD(RF)        RE-LOCATE ADDRESS                         
         ST    R5,4(RF)               SAVE A(CURRENT TABLE ENTRY)               
*                                                                               
OIDNTFD1 DS    0H                                                               
*                                                                               
         LA    R1,STDTKEY          ASSUME NAME IN KEY                           
*                                                                               
         CLI   IDNAMEID,0          IF ELEMENT ID GIVEN                          
         BE    OIDNTELX                                                         
*                                                                               
         LA    R1,STDTELM             USE STORED ELEMENT                        
*                                                                               
         CLC   IDNAMEID,STDTELM       MUST MATCH WANTED ELEMENT                 
         BNE   OIDNAMEX                                                         
*                                                                               
OIDNTELX DS    0H                                                               
*                                                                               
         SR    R0,R0                                                            
         IC    R0,IDNAMDSP         DISPLACEMENT TO NAME                         
         AR    R1,R0               POINT TO NAME                                
*                                                                               
OIDLKUPX DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,IDNAMLNO         NAME OUTPUT LENGTH                           
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   OIDNAME(0),0(R1)    PRINT NAME                                   
*                                                                               
OIDNAMEX DS    0H                                                               
*                                                                               
OIDNTAB  DS    0H                                                               
*                                                                               
*        RETURN DATA FOR PRINTING                                               
*                                                                               
         CLI   GLARGS+1,C'N'       SKIP IF NAME ONLY WANTED                     
         BE    *+8                                                              
         CLI   GLARGS+1,C'S'       SKIP IF NAME ONLY WANTED                     
         BE    OIDCODEX                                                         
*                                                                               
         MVC   CODEAREA,OIDCODE    RETURN CODE                                  
*                                                                               
         CLI   GLARGS,RAGK2TYQ     IF AGENCY ID                                 
         BNE   OIDCAGYX                                                         
*                                                                               
         CLC   OIDCODE+4(2),RESPACES AND AGENCY OFFICE CODE PRESENT             
         BNH   OIDCAGYX                                                         
*                                                                               
         MVC   OIDCODE,CODEAREA      MOVE CODE TO WORKAREA                      
*                                                                               
         MVC   CODEAREA,RESPACES     RE-INITIALIZE CODEAREA                     
*                                                                               
         MVC   CODEAREA(4),OIDCODE   AGENCY CODE                                
*                                                                               
         LA    RF,CODEAREA+3         FIND LAST SPACE                            
         LA    R0,4                                                             
*                                                                               
         CLI   0(RF),C' '                                                       
         BH    *+10                                                             
         BCTR  RF,0                                                             
         BCT   R0,*-10                                                          
*                                                                               
         LA    RF,1(RF)            POINT TO FOLLOWING SPACE                     
*                                                                               
         MVI   0(RF),C'-'                                                       
         MVC   1(2,RF),OIDCODE+4   AGENCY OFFICE CODE                           
*                                                                               
OIDCAGYX DS    0H                                                               
*                                                                               
OIDCODEX DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'C'       SKIP IF CODE ONLY WANTED                     
         BE    *+10                                                             
         MVC   NAMEAREA,OIDNAME                                                 
*                                                                               
         CLI   GLMODE,GLOUTPUT     SKIP IF NOT OUTPUT MODE                      
         BNE   OIDX                                                             
*                                                                               
         GOTO1 GENOUTA             GENERAL OUTPUT ROUTINE                       
*                                                                               
OIDX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
OIDCODE  DS    XL16                CODE SAVEAREA                                
OIDNAME  DS    XL64                NAME SAVEAREA                                
OIDLKUP  DS    XL16                CODE SAVEAREA                                
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - MARKET FROM STATION - IMKT'                  
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT MARKET FROM STATION RECORD                *         
*        STATION  HAS EITHER MARKET  CODE OR FREE FORM MARKET  NAME   *         
*        IF CODE MUST EVENTUALLY LOOK IT UP IN MARKET  TABLE          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
*        ELSE   CL04 - NULLS TO SHOW NO CODE EXISTS                   *         
*               CL20 - MARKET  NAME FROM RECORD                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IMKT     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   FLAVOR,C'R'         IF RRGON REPORT                              
         BNE   IMKTRRGN                                                         
*                                                                               
         LA    R5,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R5                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    IMKTX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    IMKTX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    IMKTX                                                            
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    IMKTX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    IMKTX                                                            
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLI   0(RE),RMKTKTYQ      MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-16                                                          
         B     IMKTX               NO DATA TYPE MATCH                           
*                                                                               
         MVC   IMKTCD,0(R1)        SAVE MARKET CODE                             
*                                                                               
         B     IMKTFND             DATA FOUND                                   
*                                                                               
IMKTRRGN DS    0H                                                               
*                                                                               
         L     R4,REAIO3                                                        
         USING RSTAREC,R4          ESTABLISH STATION RECORD                     
*                                                                               
*        FIND EXTRA DESCRIPTION ELEMENT                                         
*                                                                               
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IMKTCDN                NO MARKET CODE                            
         CLI   0(R6),X'08'         FIND EXTRA DESC. ELEMENT                     
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RSTAXXEL,R6         ESTABLISH EXTRA DESC. ELEMENT                
*                                                                               
         CLC   RSTAMKTC,RESPACES   SKIP IF NO MARKET CODE FOUND                 
         BNH   IMKTCDN                                                          
*                                                                               
         MVC   IMKTCD,RSTAMKTC     SAVE MARKET CODE                             
*                                                                               
IMKTFND  DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RSTAMKTC,R2),IMKTCD  RETURN MARKET CODE                      
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IMKTCDX                                                          
*                                                                               
         LA    R5,L'RSTAMKTC(R2)   POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       SKIP IF NOT SORTING BY NAME                  
         BNE   *+8                                                              
         LA    R5,20(R5)           BYPASS NAME AREA                             
*                                                                               
         SR    R0,R0                                                            
         IC    R0,GLARGS           SAVE CURRENT RECORD ID                       
         MVI   GLARGS,RMKTKTYQ     SET FOR MARKET RECORD                        
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         MVC   0(L'RSTAKREP,R5),REDMREP    SET REP CD                           
*                                                                               
         LA    R5,L'RSTAKREP(R5)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RSTAMKTC,R5),IMKTCD   SET MKT CODE                           
         LA    R5,L'RSTAMKTC(R5)   BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       SKIP IF NOT SORTING ON NAME                  
         BNE   IMKTNMX                                                          
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'RSTAMKTC(L'RMKTNAME,R2),NAMEAREA   ADD NAME TO OUTPUT          
*                                                                               
IMKTNMX  DS    0H                                                               
*                                                                               
         STC   R0,GLARGS           RESTORE CURRENT RECORD ID                    
*                                                                               
IMKTCDX  DS    0H                                                               
*                                                                               
         B     IMKTX                                                            
*                                                                               
IMKTCDN  DS    0H                                                               
*                                                                               
*        FIND FREEFORM NAME IN RECORD                                           
*                                                                               
         L     R4,REAIO3                                                        
         USING RSTAREC,R4          ESTABLISH STATION RECORD                     
*                                                                               
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IMKTNAMX                                                         
         CLI   0(R6),X'01'         FIND STATION ELEMENT                         
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RSTAELEM,R6         ESTABLISH STATION DESC. ELEMENT              
*                                                                               
         XC    0(L'RSTAMKTC,R2),0(R2)      CLEAR  MARKET CODE AREA              
         MVC   L'RSTAMKTC(L'RSTAMKT,R2),RSTAMKT  RETURN MARKET NAME             
*                                                                               
IMKTNAMX DS    0H                                                               
*                                                                               
IMKTX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IMKTCD   DS    XL(L'RSTAMKTC)      MARKET CODE                                  
IMKTKEY  DS    XL(L'KEY)           KEY SAVEAREA                                 
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - MARKET FROM STATION - OMKT'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT MARKET                                      *         
*        INPUT DRIVER IS EITHER DATA TO LOOK UP IN TABLE              *         
*        OR FREEFORM MARKET  NAME                                     *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
*        ELSE   CL04 - NULLS TO SHOW NO CODE EXISTS                   *         
*               CL20 - MARKET  NAME FROM RECORD                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OMKT     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         OC    0(L'RMKTKMKT,R2),0(R2) SKIP IF NO MARKET CODE PROVIDED           
         BZ    OMKTCDN                                                          
*                                                                               
         GOTO1 =A(OID)             PRINT USING OID ROUTINE                      
*                                                                               
OMKTCDX  DS    0H                                                               
         B     OMKTX                                                            
*                                                                               
OMKTCDN  DS    0H                                                               
*                                                                               
*        AT THIS POINT WE ONLY HAVE A 20 CHARACTER FREE FORM NAME               
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF MARKET CODE ONLY                     
         BE    OMKTX                                                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,MYOLEN         GET OUTPUT LENGTH                            
         BZ    *+12                   HAPPENS WITH TOTAL LINES                  
         CHI   RF,L'RSTAMKT        USE SMALLER                                  
         BNH   *+8                                                              
         LA    RF,L'RSTAMKT           AVOIDS PRINTING GARBAGE                   
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NAMEAREA(0),L'RMKTKMKT(R2) MOVE NAME TO OUTPUT AREA              
*                                                                               
         GOTO1 GENOUTA            PRINT                                         
*                                                                               
OMKTX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - MASTER REP - IMREP'                          
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT MASTER REP FROM REP RECORD                *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IMREP    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ICM   R3,15,REREPTA       POINT TO CURRENT REP TABLE ENTRY             
         BZ    IMREPX              SKIP IF NONE AVAILABLE                       
         USING REPTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R6,REPTELM                                                       
         USING RREPELEM,R6         ESTABLISH REP DESCRIPTION ELEM               
*                                                                               
         MVC   IMREPCD,REREP       DEFAULT TO SIGNED ON REP                     
*                                                                               
         OC    RREPMAST,RREPMAST   IF MASTER REP EXISTS                         
         BZ    *+10                                                             
         CLC   RREPMAST,=C'  '                                                  
         BE    *+10                                                             
         MVC   IMREPCD,RREPMAST       USE IT                                    
*                                                                               
         CLC   RREPMAST,=X'FFFF'   IF THIS IS A MASTER REP                      
         BNE   *+10                                                             
         MVC   IMREPCD,REREP          USE CURRENT REP CODE                      
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RREPKREP,R2),IMREPCD    RETURN REP CODE                      
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IMREPCDX                                                         
*                                                                               
         LA    R1,L'RREPKREP(R2)  POINT TO LOOK UP CODE AREA                    
*                                                                               
         CLI   GLARGS+1,C'S'       SKIP IF NOT SORTING BY NAME                  
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RREPKREP,R1),IMREPCD   SET REP CODE                          
         LA    R1,L'RREPKREP(R1)  BUMP TO NEXT AREA                             
*                                                                               
         CLI   GLARGS+1,C'S'       SKIP IF NOT SORTING BY NAME                  
         BNE   IMREPCDX                                                         
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'RREPKREP(10,R2),NAMEAREA ADD NAME TO OUTPUT                    
*                                                                               
IMREPCDX DS    0H                                                               
*                                                                               
         B     IMREPX                                                           
*                                                                               
IMREPX   DS    0H                                                               
         XIT1                                                                   
*                                                                               
IMREPCD  DS    XL(L'RREPKREP)      REP CODE SAVEAREA                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - NUMERIC OUTPUT - ONUM'                               
***********************************************************************         
*                                                                     *         
*        NUMERIC OUTPUT                                               *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+1(2)  - C'RT' - ROUND TOTAL TO WHOLE NUMBER           *         
*                                                                     *         
*        ELSE LET DRIVER DO THE PRINTING                              *         
*                                                                     *         
*EXIT                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ONUM     NMOD1 0,**#ONUM                                                        
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLC   =C'RT',GLARGS+10    SKIP IF NOT ROUNDING TOTALS                  
         BNE   ONUM10                                                           
*                                                                               
         TM    GLINDS,GLTOTLIN     IF DOING TOTALS                              
         BNO   ONUM10                                                           
*                                                                               
         SRP   0(4,R2),64-2,5      ROUND TO WHOLE NUMBER                        
         SRP   0(4,R2),2,0         ADD 2 DECIMALS BACK IN                       
*                                                                               
ONUM10   DS    0H                                                               
*                                                                               
         CLI   MYPOSO,C'H'         IF NOT HEADLINE OR MIDLINE                   
         BE    *+8                                                              
         CLI   MYPOSO,C'M'                                                      
         BE    ONUM20                                                           
*                                                                               
         CP    0(8,R2),=P'0'       IF THERE IS SOMETHING TO PRINT               
         BZ    *+8                                                              
         MVI   0(R3),X'41'            FORCE NON-SPACE IN CASE                   
*                                     NODETAIL FILTER IN PLACE                  
*                                                                               
         MVI   GLHOOK,GLEDIT          HAVE DRIVER EDIT RESULT                   
*                                                                               
         B     ONUMX                                                            
*                                                                               
ONUM20   DS    0H                                                               
*                                                                               
ONUMX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - OWNER FROM STATION - IOWN'                   
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT OWNER FROM STATION RECORD                 *         
*        STATION  HAS EITHER OWNER   CODE                             *         
*        IF CODE MUST EVENTUALLY LOOK IT UP IN OWNER   TABLE          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IOWN     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        HANDLE RGON REPORT                                                     
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   IOWNRGNN                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    IOWNX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    IOWNX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    IOWNX                                                            
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    IOWNX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    IOWNX                                                            
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-18                                                          
         B     IOWNX               NO DATA TYPE MATCH                           
*                                                                               
         MVC   IOWNSOWN,0(R1)      SAVE OWNER                                   
         OC    IOWNSOWN,RESPACES   MAKE UPPER CASE                              
*                                                                               
         B     IOWNOWNF            CONTRACT TYPE FOUND                          
*                                                                               
IOWNRGNN DS    0H                                                               
*                                                                               
         L     R4,REAIO3                                                        
         USING RSTAREC,R4          ESTABLISH STATION RECORD                     
*                                                                               
*        FIND STATION ELEMENT                                                   
*                                                                               
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IOWNX                  NO OWNER CODE                             
         CLI   0(R6),X'01'         FIND STATION ELEMENT                         
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RSTAELEM,R6         ESTABLISH STATION ELEMENT                    
*                                                                               
         MVC   IOWNSOWN,RSTAOWN    SAVE OWNER                                   
         OC    IOWNSOWN,RESPACES   MAKE UPPER CASE                              
*                                                                               
IOWNOWNF DS    0H                                                               
*                                                                               
         CLC   IOWNSOWN,RESPACES   SKIP IF NO OWNER CODE FOUND                  
         BNH   IOWNX                                                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'IOWNSOWN,R2),IOWNSOWN RETURN OWNER CODE                      
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IOWNCDX                                                          
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'IOWNSOWN(R2)   POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RSTAKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RSTAKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'IOWNSOWN,R1),IOWNSOWN   SET OWN CODE                         
         LA    R1,L'IOWNSOWN(R1)   BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   IOWNCDX                                                          
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'IOWNSOWN(10,R2),NAMEAREA   ADD NAME TO OUTPUT                  
*                                                                               
IOWNCDX  DS    0H                                                               
*                                                                               
         B     IOWNX                                                            
*                                                                               
IOWNX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IOWNSOWN DS    XL(L'RSTAOWN)       OWNER CODE SAVEAREA                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - OWNER FROM STATION - OOWN'                  
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT OWNER                                       *         
*        INPUT DRIVER IS EITHER DATA TO LOOK UP IN TABLE              *         
*        OR FREEFORM OWNER   NAME                                     *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
*        ELSE   CL04 - NULLS TO SHOW NO CODE EXISTS                   *         
*               CL20 - OWNER   NAME FROM RECORD                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OOWN     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         OC    0(L'ROWNKOWN,R2),0(R2) SKIP IF NO OWNER CODE PROVIDED            
         BZ    OOWNCDN                                                          
*                                                                               
         GOTO1 =A(OID)             PRINT USING OID ROUTINE                      
*                                                                               
OOWNCDX  DS    0H                                                               
         B     OOWNX                                                            
*                                                                               
OOWNCDN  DS    0H                                                               
*                                                                               
*        AT THIS POINT WE ONLY HAVE A 20 CHARACTER FREE FORM NAME               
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF OWNER CODE ONLY                      
         BE    OOWNX                                                            
*                                                                               
         SR    RF,RF                                                            
         IC    RF,MYOLEN           GET OUTPUT LENGTH                            
*                                                                               
         CLM   RF,1,=AL1(L'RSTAOWN) USE SMALLER                                 
         BNH   *+8                                                              
         LA    RF,L'RSTAOWN           AVOIDS PRINTING GARBAGE                   
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NAMEAREA(0),L'ROWNKOWN(R2) MOVE NAME TO OUTPUT AREA              
*                                                                               
         GOTO1 GENOUTA            PRINT                                         
*                                                                               
OOWNX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - PACING - INPUT - IPAC'                               
***********************************************************************         
*                                                                     *         
*        ROUTINE TO CALCULATE PACING DOLLARS                          *         
*              IN GENERAL THEY CALCULATED AS                          *         
*              CURRENT DOLLARS / PRIOR DOLLARS                        *         
*              TIMES WEEKS IN LAST YEAR'S MONTH / WKS IN THIS YR'S MON*         
*                                                                     *         
*NTRY    GLARGS   = RECORD ID                                         *         
*        GLARGS+1 = DOLLAR TYPE                                       *         
*                   'E' BILLED                                        *         
*                   'B' BOOKED                                        *         
*                   'I' INVOICED                                      *         
*                                                                     *         
* EXIT   R2==>  PL8(CUR WKS)                                          *         
*               PL8(PRI WKS)                                          *         
*               PL8(# OF ITEMS)                                       *         
*               PL8(CUR $'S)                                          *         
*               PL8(PRI $'S)                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IPAC     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        FIND TABLE ENTRY THAT DRIVES THIS KEYWORD                              
*                                                                               
         CLI   GLARGS+1,C'M'       SKIP IF PACING MONTH                         
         BE    IPACTBX                                                          
*                                                                               
         LA    R8,IPACTAB          POINT TO PARAMETER TABLE                     
*                                                                               
         CLI   0(R8),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    IPACX                                                            
         CLC   GLARGS+1(1),0(R8)   FIND KYW ENTRY IN TABLE                      
         BE    *+12                                                             
         LA    R8,IPACTABL(R8)     BUMP TO NEXT ENTRY                           
         B     *-22                                                             
*                                                                               
IPACTBX  DS    0H                                                               
*                                                                               
         ZAP   0(8,R2),=P'0'       INIT BUCKETS                                 
         ZAP   8(8,R2),=P'0'                                                    
         ZAP   16(8,R2),=P'0'                                                   
*                                                                               
         CLI   GLARGS+1,C'M'       FEWER BUCKETS FOR PACING MONTH               
         BE    *+16                                                             
         ZAP   24(8,R2),=P'0'                                                   
         ZAP   32(8,R2),=P'0'                                                   
*                                                                               
         L     R4,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,R4         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQCFAAD),0,0  FIND ASATDATE FILTER           
         BNZ   IPACAADX            NONE FOUND                                   
*                                                                               
         ICM   R5,15,DMCB+8        POINT TO FOUND ASATDATE FILTER               
         BZ    IPACAADX            NONE FOUND                                   
*                                                                               
         XC    IPACAFLT,IPACAFLT   INIT FILTER VALUE                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,FLTFVLEN-FLTCTL(R5) FILTER LENGTH                           
         BZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   IPACAFLT(0),FLTFVAL-FLTCTL(R5)      SAVE FILTER                  
*                                                                               
         SR    R0,R0                                                            
         IC    R0,REQAADFN         NUMBER OF ASATDATE FILTERS                   
         AH    R0,=H'1'            ALLOW FOR TOTAL REPORT                       
         L     R3,REAADTBA         POINT TO ASATDATES TABLE                     
*                                                                               
IPACAADL DS    0H                                                               
*                                                                               
         CLC   IPACAFLT,0(R3)      MATCH THIS COL FILTER                        
         BE    IPACAADF            FILTER FOUND                                 
*                                                                               
IPACAADC DS    0H                                                               
*                                                                               
         A     R4,=A(NWMTENTL)     BUMP TO NEXT TABLE                           
         LA    R3,6(R3)            BUMP TO NEXT ASATDATES                       
         BCT   R0,IPACAADL                                                      
*                                                                               
         DC    H'0'                SHOULD NOT BE HERE                           
*                                                                               
IPACAADF DS    0H                  CORRECT TABLE FOUND                          
*                                                                               
IPACAADX DS    0H                                                               
*                                                                               
         LA    R5,NWMTNWMT         FIRST MONTH ENTRY                            
*                                                                               
IPACLOOP DS    0H                                                               
*                                                                               
         OC    0(6,R5),0(R5)       DONE IF NO DATE PRESENT                      
         BZ    IPACDONE                                                         
*                                                                               
*        DETERMINE IF BUCKET TO BE INCLUDED IN REPORT                           
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD OPTION IN PLAY                        
         BNO   *+18                                                             
         CLC   REQYTDSB(2),CURDATE(R5)   BUCKET MUST BE FOR YTD PERIOD          
         BH    IPACCONT                                                         
         B     IPACYTD1                                                         
*                                                                               
         CLC   REYMSTRP(2),CURDATE(R5) BUCKET MUST BE FOR PERIOD                
         BH    IPACCONT              USING YM OF BROADCAST MONTH                
*                                                                               
IPACYTD1 DS    0H                                                               
*                                                                               
         CLC   REYMENDP(2),CURDATE(R5)                                          
         BL    IPACCONT                                                         
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    IPACYTD5                                                         
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD OPTION IN PLAY                        
         BNO   *+18                                                             
         CLC   REQYTDSB(2),CURDATE(R5)   BUCKET MUST BE FOR YTD PERIOD          
         BH    IPACCONT                                                         
         B     IPACYTD2                                                         
*                                                                               
         CLC   RECURSTB(2),CURDATE(R5) BUCKET MUST BE FOR CURR PERIOD           
         BH    IPACCONT              USING YM OF BROADCAST MONTH                
*                                                                               
IPACYTD2 DS    0H                                                               
*                                                                               
         CLC   RECURENB(2),CURDATE(R5)                                          
         BL    IPACCONT                                                         
*                                                                               
IPACYTD5 DS    0H                                                               
*                                                                               
         OC    GLARGS+9(2),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BNZ   *+10                                                             
         OC    GLARGS+12(2),GLARGS+12    SKIP IF NO DATES GIVEN                 
         BZ    IPAC10                                                           
*                                                                               
         CLC   GLARGS+9(2),CURDATE(R5)   BUCKET MUST BE FOR KYW PERIOD          
         BH    IPACCONT                                                         
         CLC   GLARGS+12(2),CURDATE(R5)                                         
         BL    IPACCONT                                                         
*                                                                               
IPAC10   DS    0H                                                               
*                                                                               
*        CALCULATE WEEKS FOR CURRENT AND PRIOR MONTHS                           
*                                                                               
         MVC   FULL(2),CURDATE(R5)  CURRENT YM                                  
         MVI   FULL+2,15           MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,FULL),(0,WORK)   YYMMDD                           
*                                                                               
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+8,GETDAY,ADDAY                       
         CLI   DMCB,X'FF'          BROADCAST MONTH                              
         BNE   *+6                                                              
         DC    H'0'                ERROR                                        
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,DMCB           NUMBER OF WEEKS IN MONTH                     
         CVD   RE,DUB                                                           
*                                                                               
         AP    0(8,R2),DUB         PASS TO DRIVER                               
*                                                                               
         MVC   FULL(2),PRIDATE(R5)  PRIOR YM                                    
         MVI   FULL+2,15           MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,FULL),(0,WORK)   YYMMDD                           
*                                                                               
         GOTO1 QGTBROAD,DMCB,(1,WORK),WORK+8,GETDAY,ADDAY                       
         CLI   DMCB,X'FF'          BROADCAST MONTH                              
         BNE   *+6                                                              
         DC    H'0'                ERROR                                        
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,DMCB           NUMBER OF WEEKS IN MONTH                     
         CVD   RE,DUB                                                           
*                                                                               
         AP    8(8,R2),DUB                                                      
*                                                                               
         AP    16(8,R2),=P'1'      SET MONTH COUNTER                            
*                                                                               
*        IF DIRECT RESPONSE OR PAID PROGRAMMING OPTION                          
*              CHECK CONTRACT IS CORRECT TYPE                                   
*              AND BUCKET ON OR AFTER CUTOFF DATE                               
*                                                                               
IPACDRP  DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBODRQ+REQBOPPQ   SKIP IF NEITHER OPTION ON           
         BZ    IPACDRPX                                                         
*                                                                               
         L     RF,REAIO1           POINT TO CONTRACT RECORD                     
         USING RCONREC,RF          ESTABLISH CONTRACT RECORD                    
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT A CONTRACT RECORD                
         BNE   IPACDRPX                                                         
*                                                                               
         L     RE,REREPTA          POINT TO REP TABLE ENTRY                     
*                                                                               
         TM    REQBLLOP,REQBODRQ   IF DIRECT RESPONSE OPTION                    
         BNO   *+14                                                             
         CLC   RCONTYPE,RREPPROF+8-RREPELEM+REPTELM-REPTENT(RE)                 
         BNE   IPACDRPX            SKIP IF NOT DR CONTRACT                      
*                                                                               
         TM    REQBLLOP,REQBOPPQ   IF PAID PROGRAMMING OPTION                   
         BNO   *+14                                                             
         CLC   RCONTYPE,RREPPROF+9-RREPELEM+REPTELM-REPTENT(RE)                 
         BNE   IPACDRPX            SKIP IF NOT PP CONTRACT                      
*                                                                               
*        CHECK BUCKET DATE AGAINST CUTOFF DATE                                  
*              CURRENT AND PRIOR KEYWORDS HAVE THEIR OWN CUTOFF DATE            
*                                                                               
         CLC   CURDATE(2,R5),NWMTCTCR    DROP IF AFTER CUTOFF DATE              
         BH    IPACCONT                                                         
*                                                                               
         CLC   PRIDATE(2,R5),NWMTCTPR    DROP IF AFTER CUTOFF DATE              
         BH    IPACCONT                                                         
*                                                                               
         DROP  RF                                                               
*                                                                               
IPACDRPX DS    0H                                                               
*                                                                               
*        CHECK ON BILLING OPTIONS                                               
*                                                                               
         TM    REQBLLOP,REQBOR1Q+REQBOR2Q+REQBOR3Q+REQBOR5Q                     
         BZ    IPACROPX            SKIP IF NONE WANTED                          
*                                                                               
*        DETERMINE DATE FOR BUCKET                                              
*                                                                               
         LA    RF,CURDATE(R5)      DEFAULT TO CURRENT BUCKET                    
*                                                                               
         CLI   GLARGS+1,C'M'       OKAY IF PACING MONTH KYWD                    
         BE    IPACRDTX                                                         
*                                                                               
         CLI   4(R8),C'2'          IF 2YR PRIOR BUCKET                          
         BNE   *+8                                                              
         LA    RF,PRI2DATE(R5)        USE 2YR PRIOR DATE                        
*                                                                               
         CLI   4(R8),C'P'          IF  PRIOR BUCKET                             
         BNE   *+8                                                              
         LA    RF,PRIDATE(R5)         USE PRIOR DATE                            
*                                                                               
         CLI   4(R8),C'N'          IF NEXT YEAR BUCKET                          
         BNE   *+8                                                              
         LA    RF,NEXTDATE(R5)        USE NEXT YEAR DATE                        
*                                                                               
IPACRDTX DS    0H                                                               
*                                                                               
*        R1 BILLING OPTION                                                      
*              ALL BILLING THROUGH LEAVE DATE                                   
*              ALL BILLING FROM JOIN DATE                                       
*                                                                               
IPACR1   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR1Q                                                
         BNO   IPACR1N             SKIP IF NOT R1 OPTION                        
*                                                                               
         CLC   0(2,RF),RESTEND     DROP IF BUCKET DATE AFTER LEAVE DT           
         BH    IPACCONT                                                         
*                                                                               
         CLC   NWMTAADT,RESTSTR    DROP IF ASATDATE BEFORE JOINED DATE          
         BL    IPACCONT                                                         
*                                                                               
         CLC   0(2,RF),RESTSTR     DROP IF BUCKET DATE BEFORE JOINED DT         
         BL    IPACCONT                                                         
*                                                                               
IPACR1X  DS    0H                                                               
         B     IPACROPX            KEEP BUCKET                                  
*                                                                               
IPACR1N  DS    0H                                                               
*                                                                               
*        R2 BILLING OPTION                                                      
*              ALL BILLING THROUGH LEAVE DATE BUT ONLY FOR COMPARABLE           
*                  MONTHS                                                       
*              ALL BILLING FROM JOIN DATE                                       
*                                                                               
IPACR2   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR2Q                                                
         BNO   IPACR2N             SKIP IF NOT R2 OPTION                        
*                                                                               
         CLC   RESTEND,NWMTAADT    OKAY IF LEFT AFTER ASATDATE                  
         BH    IPACR2LX                                                         
*                                                                               
         CLC   0(2,RF),RESTEND     DROP IF BUCKET DATE AFTER LEAVE DT           
         BH    IPACCONT                                                         
*                                                                               
         CLC   RESTEND(2),CURDATE(R5) DROP IF LEAVE DATE BEFORE CURRENT         
         BL    IPACCONT               KEEPS ONLY LIKE MONTHS                    
*                                                                               
IPACR2LX DS    0H                                                               
*                                                                               
         CLC   NWMTAADT,RESTSTR    DROP IF ASATDATE BEFORE JOINED DATE          
         BL    IPACCONT                                                         
*                                                                               
         CLC   RESTSTR,REQPSTRB    KEEP IF JOINED BEFORE REQUEST START          
         BL    IPACR2X                                                          
*                                                                               
         CLC   RESTSTR(2),CURDATE(R5) DROP IF JOINED AFTER CURRENT DATE         
         BH    IPACCONT               KEEPS ONLY LIKE MONTHS                    
*                                                                               
IPACR2X  DS    0H                                                               
         B     IPACROPX            KEEP BUCKET                                  
*                                                                               
IPACR2N  DS    0H                                                               
*                                                                               
*        R3 BILLING OPTION                                                      
*              LIKE MONTHS THROUGH LEAVE DATE                                   
*              NO BILLING FOR JOINED STATIONS                                   
*                                                                               
IPACR3   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR3Q                                                
         BNO   IPACR3N             SKIP IF NOT R3 OPTION                        
*                                                                               
         CLC   RESTEND,NWMTAADT    OKAY IF LEFT AFTER ASATDATE                  
         BH    IPACR3LX                                                         
*                                                                               
         CLC   RESTEND(2),CURDATE(R5) DROP IF LEAVE DATE BEFORE CURRENT         
         BL    IPACCONT               KEEPS ONLY LIKE MONTHS                    
*                                                                               
IPACR3LX DS    0H                                                               
*                                                                               
         CLC   NWMTAADT,RESTSTR    DROP IF JOINED AFTER ASATDATE                
         BL    IPACCONT                                                         
*                                                                               
         CLC   RESTSTR,REQPSTRB    DROP IF JOINED AFTER REQUEST START           
         BH    IPACCONT                                                         
*                                                                               
IPACR3X  DS    0H                                                               
         B     IPACROPX            KEEP BUCKET                                  
*                                                                               
IPACR3N  DS    0H                                                               
*                                                                               
*        R5 BILLING OPTION                                                      
*              CURRENT AND PRIOR DATES MUST BE REPPED BY SOME                   
*              SUBSIDARY. SKIP IF NON-CURRENT OR PRIOR BUCKET                   
*                                                                               
IPACR5   DS    0H                                                               
*                                                                               
         TM    REQBLLOP,REQBOR5Q                                                
         BNO   IPACR5N             SKIP IF NOT R5 OPTION                        
*                                                                               
         CLI   GLARGS+1,C'M'       DO TEST FOR PACING MONTH                     
         BE    *+8                                                              
         CLI   4(R8),C'C'          MUST BE CURRENT OR PRIOR BUCKET              
         BE    *+8                                                              
         CLI   4(R8),C'P'                                                       
         BNE   IPACX                                                            
*                                                                               
         L     RE,RESJLTA          POINT TO JOIN/LEAVE TABLE ENTRY              
*                                     FOR STATION                               
*                                                                               
         USING SJLTENT,RE          ESTABLISH ENTRY                              
*                                                                               
*        CURRENT DATE MUST BE COVERED                                           
*                                                                               
         LA    RF,SJLTDTES         POINT TO LIST OF JOIN/LEAVE DATES            
         USING SJLTDTES,RF         ESTABLISH DATES                              
*                                                                               
IPACJLCL DS    0H                                                               
*                                                                               
         OC    SJLTDTES(SJLTDTEL),SJLTDTES   DONE AT END OF LIST                
         BZ    IPACJLCD                                                         
*                                                                               
         CLC   CURDATE(2,R5),SJLTJOIN    AFTER JOIN DATE                        
         BL    IPACJLCC                                                         
*                                                                               
         CLC   CURDATE(2,R5),SJLTLEAV    BEFORE CORRESPONDING LEAVE DTE         
         BNH   IPACJLCF                                                         
*                                                                               
IPACJLCC DS    0H                                                               
*                                                                               
         LA    RF,SJLTDTEL(RF)     BUMP TO NEXT SET OF DATES                    
         B     IPACJLCL                                                         
*                                                                               
IPACJLCD DS    0H                  CURRENT DATE NOT COVERED                     
         B     IPACX                                                            
*                                                                               
         DROP  RF                                                               
*                                                                               
IPACJLCF DS    0H                  CURRENT COVERED BY JOIN/LEAVE DATES          
*                                                                               
*        PRIOR DATE MUST BE COVERED                                             
*                                                                               
         LA    RF,SJLTDTES         POINT TO LIST OF JOIN/LEAVE DATES            
         USING SJLTDTES,RF         ESTABLISH DATES                              
*                                                                               
IPACJLPL DS    0H                                                               
*                                                                               
         OC    SJLTDTES(SJLTDTEL),SJLTDTES   DONE AT END OF LIST                
         BZ    IPACJLPD                                                         
*                                                                               
         CLC   PRIDATE(2,R5),SJLTJOIN    AFTER JOIN DATE                        
         BL    IPACJLPC                                                         
*                                                                               
         CLC   PRIDATE(2,R5),SJLTLEAV    BEFORE CORRESPONDING LEAVE DTE         
         BNH   IPACJLPF                                                         
*                                                                               
IPACJLPC DS    0H                                                               
*                                                                               
         LA    RF,SJLTDTEL(RF)     BUMP TO NEXT SET OF DATES                    
         B     IPACJLPL                                                         
*                                                                               
IPACJLPD DS    0H                  PRIOR DATE NOT COVERED                       
         B     IPACX                                                            
*                                                                               
         DROP  RE,RF                                                            
*                                                                               
IPACJLPF DS    0H                  PRIOR COVERED BY JOIN/LEAVE DATES            
*                                                                               
IPACR5X  DS    0H                                                               
         B     IPACROPX            KEEP BUCKET                                  
*                                                                               
IPACR5N  DS    0H                                                               
*                                                                               
IPACROPX DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'M'       NO DOLLARS FOR PACING MONTH                  
         BE    IPACMON                                                          
*                                                                               
*        GET CURRENT DOLLARS                                                    
*                                                                               
         SR    RF,RF                                                            
         IC    RF,1(R8)            GET DISPLACEMENT INTO DOLLARS                
*                                                                               
         CLI   2(R8),0             IF FLAG BYTE PRESENT                         
         BE    IPAC20                                                           
*                                                                               
         MVC   HALF(1),FLAG6(R5)      COPY FLAG BYTE                            
*                                                                               
         CLI   GLARGS+5,C'T'       IF TRADE KEYWORD                             
         BNE   *+10                                                             
         MVC   HALF(1),FLAG7(R5)      USE FLAG7                                 
*                                                                               
         NC    HALF(1),2(R8)                                                    
         BZ    IPAC20                 FLAG NOT ON                               
*                                                                               
         IC    RF,3(R8)               ELSE USE SECOND BUCKET                    
*                                                                               
IPAC20   DS    0H                                                               
*                                                                               
         LA    R1,BUCKDISP(RF,R5)  POINT TO BUCKET                              
*                                                                               
         ICM   RF,15,0(R1)         RETURN DOLLARS                               
         CVD   RF,DUB                                                           
*                                                                               
         AP    24(8,R2),DUB        ADD TO DRIVER INPUT                          
*                                                                               
*        GET PRIOR DOLLARS                                                      
*                                                                               
         SR    RF,RF                                                            
         IC    RF,5(R8)            GET DISPLACEMENT INTO DOLLARS                
*                                                                               
         CLI   6(R8),0             IF FLAG BYTE PRESENT                         
         BE    IPAC40                                                           
*                                                                               
         MVC   HALF(1),FLAG6(R5)      COPY FLAG BYTE                            
*                                                                               
         CLI   GLARGS+5,C'T'       IF TRADE KEYWORD                             
         BNE   *+10                                                             
         MVC   HALF(1),FLAG7(R5)      USE FLAG7                                 
*                                                                               
         NC    HALF(1),6(R8)                                                    
         BZ    IPAC40                 FLAG NOT ON                               
*                                                                               
         IC    RF,7(R8)               ELSE USE SECOND BUCKET                    
*                                                                               
IPAC40   DS    0H                                                               
*                                                                               
         LA    R1,BUCKDISP(RF,R5)  POINT TO BUCKET                              
*                                                                               
         ICM   RF,15,0(R1)         RETURN DOLLARS                               
         CVD   RF,DUB                                                           
*                                                                               
         AP    32(8,R2),DUB        ADD TO DRIVER INPUT                          
*                                                                               
IPACMON  DS    0H                                                               
*                                                                               
IPACCONT DS    0H                                                               
*                                                                               
         LA    R5,NEXTBUCK(R5)     BUMP TO NEXT BUCKET                          
*                                                                               
         B     IPACLOOP                                                         
*                                                                               
IPACDONE DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'M'       IF PACING MONTH                              
         BNE   IPACDON1                                                         
         CLI   GLARGS+2,C'P'       BUT NOT PERIOD                               
         BE    IPACDON1                                                         
*                                                                               
         CP    16(8,R2),=P'1'      IF MORE THAN ONE MONTH IN PERIOD             
         BNH   *+22                                                             
         ZAP   0(8,R2),=P'0'          ERASE INPUT - IT IS MEANINGLESS           
         ZAP   8(8,R2),=P'0'                                                    
         ZAP   16(8,R2),=P'0'                                                   
*                                                                               
         B     IPACDON2                                                         
*                                                                               
IPACDON1 DS    0H                                                               
*                                                                               
         CP    16(8,R2),=P'1'      IF MORE THAN 1 MONTH IN PERIOD               
         BNH   *+10                                                             
         ZAP   16(8,R2),=P'1'         RESET TO ONE ITEM                         
*                                                                               
IPACDON2 DS    0H                                                               
*                                                                               
         B     IPACX                                                            
*                                                                               
IPACX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
IPACAFLT DS    XL6                 FOUND ASATDATE FILTER                        
*                                                                               
IPACTAB  DS    0D                                                               
         DC    C'E'                          BILLED    DOLLARS                  
         DC    X'000104C3'         CURBLG                                       
         DC    X'0C0410D7'         PRIBLG                                       
         DC    X'00'                                                            
*                                                                               
IPACTABL EQU   *-IPACTAB           LENGTH OF TABLE ENTRY                        
*                                                                               
         DC    C'B'                          BOOKED    DOLLARS                  
         DC    X'000000C3'         CURBKD                                       
         DC    X'180000D7'         PRIBKD                                       
         DC    X'00'                                                            
*                                                                               
         DC    C'I'                          INVOICED  DOLLARS                  
         DC    X'040000C3'         PRIINV                                       
         DC    X'1C0000D7'         CURINV                                       
         DC    X'00'                                                            
*                                                                               
         DC    X'FF'               END OF TABLE                                 
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - PACING DOLLARS - OPAC'                      
***********************************************************************         
*                                                                     *         
*        ROUTINE TO CALCULATE PACING DOLLARS                          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+1 -  DOLLAR TYPE                                      *         
*                   'E' ESTIMATED                                     *         
*                   'B' BOOKED                                        *         
*                   'I' INVOICED                                      *         
*                                                                     *         
*NTRY    R2==>  PL8(CUR WKS)                                          *         
*               PL8(PRI WKS)                                          *         
*               PL8(# OF ITEMS)                                       *         
*               PL8(CUR $'S)                                          *         
*               PL8(PRI $'S)                                          *         
*                                                                     *         
*EXIT    R3==>  PRINTED PACING PERCENT                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OPAC     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+1,C'M'       CHECK FOR PACING MONTH                       
         BE    OPACMON                                                          
*                                                                               
         CP    24(8,R2),=P'0'      SKIP IF EITHER FACTOR IS ZERO                
         BE    OPACX                                                            
         CP    32(8,R2),=P'0'                                                   
         BE    OPACX                                                            
*                                                                               
         CP    16(8,R2),=P'0'      SKIP IF NO ITEMS IN SUM                      
         BE    OPACX                                                            
*                                                                               
         ZAP   OPACWORK,0(8,R2)    CURRENT WEEKS                                
*                                                                               
         DP    OPACWORK,16(8,R2)   DIVIDE BY COUNTER                            
         CP    OPACRMDR,=P'0'      IF THERE IS A REMAINDER                      
         BE    *+10                   THEN UNEVEN WEEKS                         
         ZAP   OPACQUOT,=P'1'         DEFAULT TO 1 WEEK                         
*                                                                               
         ZAP   OPACCWKS,OPACQUOT   SAVE NUMBER OF WEEKS                         
*                                                                               
         ZAP   OPACWORK,8(8,R2)    PRIOR WEEKS                                  
*                                                                               
         DP    OPACWORK,16(8,R2)   DIVIDE BY COUNTER                            
         CP    OPACRMDR,=P'0'      IF THERE IS A REMAINDER                      
         BE    *+10                   THEN UNEVEN WEEKS                         
         ZAP   OPACQUOT,=P'1'         DEFAULT TO 1 WEEK                         
*                                                                               
         ZAP   OPACPWKS,OPACQUOT   SAVE NUMBER OF WEEKS                         
*                                                                               
         CP    OPACCWKS,=P'1'      IF EITHER # OF WKS IS 1                      
         BNE   *+10                                                             
         ZAP   OPACPWKS,=P'1'         MAKE THE OTHER 1 ALSO                     
*                                     HANDLES UNEVEN WEEKS SITUATION            
*                                                                               
         CP    OPACPWKS,=P'1'      IF EITHER # OF WKS IS 1                      
         BNE   *+10                                                             
         ZAP   OPACCWKS,=P'1'         MAKE THE OTHER 1 ALSO                     
*                                     HANDLES UNEVEN WEEKS SITUATION            
*                                                                               
         CP    OPACCWKS,=P'5'      IF DOING MORE THAN A MONTH                   
         BNH   *+16                                                             
         ZAP   OPACPWKS,=P'1'         DROP WEEKS FROM CALCULATIONS              
         ZAP   OPACCWKS,=P'1'                                                   
*                                                                               
         ZAP   OPACWORK,24(8,R2)   CURRENT DOLLARS                              
         MP    OPACWORK,OPACPWKS   * PRIOR   WEEKS                              
         ZAP   OPACCDLR,OPACWORK   REDUCE LEADING ZEROS                         
*                                                                               
         ZAP   OPACWORK,32(8,R2)   PRIOR   DOLLARS                              
         MP    OPACWORK,OPACCWKS   * CURRENT WEEKS                              
         ZAP   OPACPDLR,OPACWORK   REDUCE LEADING ZEROS                         
*                                                                               
         ZAP   OPACWORK,OPACCDLR   CURRENT DOLLARS                              
         MP    OPACWORK,=P'10000'  SCALING FOR 2 DECIMALS                       
         DP    OPACWORK,OPACPDLR   DIVIDE BY PRIOR DOLLARS                      
*                                                                               
         SRP   OPACQUOT,64-1,5     ROUND RESULT TO 1 DECIMAL                    
*                                                                               
         CP    OPACQUOT,=P'10000'  IF RESULT IS TOO LARGE                       
         BL    *+14                                                             
         MVC   0(4,R3),=C'HIGH'        RETURN 'HIGH'                            
         B     OPACX                                                            
*                                                                               
         CP    OPACQUOT,=P'-10000'  IF RESULT IS TOO LARGE                      
         BH    *+14                                                             
         MVC   0(4,R3),=C'HIGH'        RETURN 'HIGH'                            
         B     OPACX                                                            
*                                                                               
         ZAP   0(8,R2),OPACQUOT    RETURN TO DRIVER                             
*                                                                               
         MVI   GLHOOK,GLEDIT       HAVE DRIVER PRINT IT                         
*                                                                               
         B     OPACX                                                            
*                                                                               
OPACMON  DS    0H                                                               
*                                                                               
         ZAP   OPACWORK,8(8,R2)    PRIOR WEEKS                                  
         BZ    OPACMONX            NO WEEKS                                     
*                                                                               
         DP    OPACWORK,16(8,R2)   DIVIDE BY COUNTER                            
         CP    OPACRMDR,=P'0'      IF THERE IS A REMAINDER                      
         BNE   OPACMONX               THEN UNEVEN WEEKS                         
*                                                                               
         MVC   DUB(4),=X'40202021'     EDIT PATTERN                             
         ED    DUB(4),OPACQUOT+6     PRINT RESULT                               
*                                                                               
         CLI   GLARGS+2,C'P'       IF WEEKS FOR PERIOD WANTED                   
         BNE   *+18                                                             
         MVC   OPACOUT(3),DUB+1      PRIOR   WEEKS                              
         MVI   OPACOUT+3,C'/'                                                   
         B     *+14                                                             
*                                  ELSE                                         
         MVC   OPACOUT(1),DUB+3      PRIOR   WEEKS                              
         MVI   OPACOUT+1,C'/'                                                   
*                                                                               
         ZAP   OPACWORK,0(8,R2)    CURRENT WEEKS                                
         BZ    OPACMONX            NO WEEKS                                     
*                                                                               
         DP    OPACWORK,16(8,R2)   DIVIDE BY COUNTER                            
         CP    OPACRMDR,=P'0'      IF THERE IS A REMAINDER                      
         BNE   OPACMONX               THEN UNEVEN WEEKS                         
*                                                                               
         MVC   DUB,RESPACES        INIT OUTPUT AREA                             
*                                                                               
         MVC   DUB(4),=X'40202021'     EDIT PATTERN                             
         ED    DUB(4),OPACQUOT+6   PRINT RESULT                                 
*                                                                               
         LA    RF,DUB+1            LEFT JUSTIFY                                 
*                                                                               
         LA    R0,3                                                             
*                                                                               
         CLI   0(RF),C' '                                                       
         BH    *+14                                                             
         MVC   0(3,RF),1(RF)       LEFT JUSTIFY                                 
         BCT   R0,*-14                                                          
*                                                                               
         CLI   GLARGS+2,C'P'       IF WEEKS FOR PERIOD WANTED                   
         BNE   *+20                                                             
         MVC   OPACOUT+4(3),DUB+1       CURRENT WEEKS                           
         MVC   0(7,R3),OPACOUT        GIVE TO DRIVER                            
         B     *+16                                                             
*                                  ELSE                                         
         MVC   OPACOUT+2(1),DUB+1       CURRENT WEEKS                           
         MVC   0(3,R3),OPACOUT        ELSE WEEKS FOR A MONTH                    
*                                                                               
OPACMONX DS    0H                                                               
         B     OPACX                                                            
*                                                                               
OPACX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
OPACWORK DS    0PL16               PACKED WORKAREA                              
OPACQUOT DS    PL8                 QUOTIENT                                     
OPACRMDR DS    PL8                 REMAINDER                                    
*                                                                               
OPACCDLR DS    PL8                 CURRENT DOLLARS * PRIOR   WEEKS              
OPACPDLR DS    PL8                 PRIOR   DOLLARS * CURRENT WEEKS              
*                                                                               
OPACCWKS DS    PL8                 CURRENT WEEKS                                
OPACPWKS DS    PL8                 PRIOR   WEEKS                                
*                                                                               
OPACOUT  DS    CL8                 OUTPUT WORKAREA                              
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - PER CENT TO - OPC'                          
***********************************************************************         
*                                                                     *         
*        ROUTINE TO CALCULATE PER CENT TO FINAL OR BUDGET             *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+2 -  PER CENT TYPE                                    *         
*                   'B' BUDGET                                        *         
*                   'F' FINAL                                         *         
*                                                                     *         
*NTRY    R2==>  PL8(CUR $'S)                                          *         
*               PL8(FINAL OR BUDGET $'S)                              *         
*                                                                     *         
*                                                                     *         
* EXIT   R3==>  PER CENT                                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OPC      NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CP    0(8,R2),=P'0'       SKIP IF EITHER FACTOR IS ZERO                
         BE    OPCX                                                             
         CP    8(8,R2),=P'0'                                                    
         BE    OPCX                                                             
*                                                                               
         ZAP   OPCWORK,0(8,R2)    CURRENT DOLLARS                               
         MP    OPCWORK,=P'10000'  SCALING FOR 2 DECIMALS                        
         DP    OPCWORK,8(8,R2)    DIVIDE BY FINAL OR BUDGET DOLLARS             
*                                                                               
         SRP   OPCQUOT,64-1,5     ROUND RESULT TO 1 DECIMAL                     
*                                                                               
         CP    OPCQUOT,=P'10000'  IF RESULT IS TOO LARGE                        
         BL    *+14                                                             
         MVC   0(4,R3),=C'HIGH'        RETURN 'HIGH'                            
         B     OPCX                                                             
*                                                                               
         ZAP   0(8,R2),OPCQUOT    RETURN TO DRIVER                              
*                                                                               
         MVI   GLHOOK,GLEDIT       HAVE DRIVER PRINT IT                         
*                                                                               
OPCX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
OPCWORK  DS    0PL16               PACKED WORKAREA                              
OPCQUOT  DS    PL8                 QUOTIENT                                     
OPCRMDR  DS    PL8                 REMAINDER                                    
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - PERIOD FOR ROW - IPER'                       
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT CURRENT PERIOD FOR ROW                    *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+1 -  DATE TYPE M,Y,Q                                  *         
*                                                                     *         
*        R2==>  BINARY YM OF START AND END B'CAST MONTHS OF PERIOD    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IPER     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   0(2,R2),RECURSTB    RETURN START AND END B'CAST MONTHS           
         MVC   2(2,R2),RECURENB    RETURN START AND END B'CAST MONTHS           
*                                                                               
IPERX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - PERIOD FOR ROW - OPER'                      
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT PERIOD FOR ROW                              *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS+1 -  DATE TYPE M,Y,Q                                  *         
*                                                                     *         
*        R2==>  BINARY YM OF START AND END B'CAST MONTHS OF PERIOD    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OPER     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         OC    0(4,R2),0(R2)       SKIP IF NO DATES PASSED                      
         BZ    OPERX                                                            
*                                                                               
*        FIND DATE TYPE                                                         
*                                                                               
         CLI   GLARGS+1,C'M'       MONTH                                        
         BE    OPERMON                                                          
         CLI   GLARGS+1,C'Q'       QUARTER                                      
         BE    OPERQTR                                                          
         CLI   GLARGS+1,C'S'       SEMI-YEAR                                    
         BE    OPERSEM                                                          
         CLI   GLARGS+1,C'Y'       YEAR                                         
         BE    OPERYR                                                           
*                                                                               
OPERMON  DS    0H                  BROADCAST MONTH                              
*                                  PRINT MMM/YY                                 
*                                                                               
         MVC   DUB(2),0(R2)        Y/M BINARY                                   
         MVI   DUB+2,15            MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,DUB),(18,0(R3))  PRINT MONTH                      
*                                                                               
         B     OPERX                                                            
*                                                                               
OPERQTR  DS    0H                                                               
*                                                                               
*        CHECK END DATE FOR WHICH QUARTER                                       
*                                                                               
         LA    R1,1                QUARTER COUNTER                              
         CLI   3(R2),3             FIRST QUARTER ENDS IN MARCH                  
         BNH   OPERQTR1                                                         
*                                                                               
         LA    R1,1(R1)                                                         
         CLI   3(R2),6             SECOND QUARTER ENDS IN JUNE                  
         BNH   OPERQTR1                                                         
*                                                                               
         LA    R1,1(R1)                                                         
         CLI   3(R2),9             THIRD  QUARTER ENDS IN SEPTEMBER             
         BNH   OPERQTR1                                                         
*                                                                               
         LA    R1,1(R1)                                                         
         CLI   3(R2),12            FOURTH QUARTER ENDS IN DECEMBER              
         BNH   OPERQTR1                                                         
*                                                                               
         B     OPERX               UNKNOWN QUARTER                              
*                                                                               
OPERQTR1 DS    0H                                                               
*                                                                               
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'         FORCE SIGN                                   
         UNPK  0(1,R3),DUB                                                      
*                                                                               
         MVI   1(R3),C'Q'                                                       
*                                                                               
         MVC   DUB(2),2(R2)        Y/M BINARY                                   
         MVI   DUB+2,15            MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,DUB),(9,WORK)  PRINT MMM/YY                       
*                                                                               
         MVC   2(2,R3),WORK+4      PRINT YEAR                                   
*                                                                               
         B     OPERX                                                            
*                                                                               
OPERSEM  DS    0H                                                               
*                                                                               
         LA    R1,1                SEMI COUNTER                                 
         CLI   3(R2),6             FIRST SEMI ENDS IN JUNE                      
         BNH   OPERSEM1                                                         
*                                                                               
         LA    R1,1(R1)                                                         
         CLI   3(R2),12            SECOND SEMI ENDS IN DECEMBER                 
         BNH   OPERSEM1                                                         
*                                                                               
OPERSEM1 DS    0H                                                               
*                                                                               
         CVD   R1,DUB                                                           
         OI    DUB+7,X'0F'         FORCE SIGN                                   
         UNPK  0(1,R3),DUB                                                      
*                                                                               
         MVI   1(R3),C'S'                                                       
*                                                                               
         MVC   DUB(2),2(R2)        Y/M BINARY                                   
         MVI   DUB+2,15            MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,DUB),(9,WORK)  PRINT MMM/YY                       
*                                                                               
         MVC   2(2,R3),WORK+4      PRINT YEAR                                   
*                                                                               
         B     OPERX                                                            
*                                                                               
OPERYR   DS    0H                                                               
*                                                                               
         MVC   DUB(2),0(R2)        Y/M BINARY                                   
         MVI   DUB+2,15            MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,DUB),(23,WORK)  PRINT YYYY                        
*                                                                               
         MVC   0(4,R3),WORK        PRINT YEAR                                   
*                                                                               
         B     OPERX                                                            
*                                                                               
OPERX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - POINT PERSON FOR CONTRACT - IPTP'            
***********************************************************************         
*                                                                     *         
*        POINT PERSON IS ASSOCIATED WITH PRODUCT                      *         
*        FIRST FIND PRODUCT FOR CONTRACT                              *         
*        NEXT  FIND POINT PERSON FOR PRODUCT                          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IPTP     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IPTPPRDD               NO PRODUCT CODE                           
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         CLC   RCONPRD,RESPACES    SKIP IF NO PRODUCT CODE FOUND                
         BNH   IPTPX                                                            
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         ICM   R8,15,REPRDTBA      POINT TO PRODUCT TABLE                       
         BZ    IPTPPRDD            SKIP IF NO PRODUCT TABLE                     
*                                                                               
         USING PRDTTABD,R8         ESTABLISH PRODUCT TABLE                      
*                                                                               
         ICM   R0,15,PRDTBSRP+8    GET NUMBER OF RECORDS IN TABLE               
         BZ    IPTPPRDD            IGNORE IF TABLE EMPTY                        
*                                                                               
         L     R3,PRDTBSRP+4       POINT TO FIRST RECORD IN TABLE               
         USING PRDTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
IPTPPRDL DS    0H                  FIND PRODUCT ENTRY                           
*                                                                               
         CLC   REDMREP,RPRDKREP-RPRDKEY+PRDTKEY   MATCH REP                     
         BNE   IPTPPRDC                                                         
         CLC   READV,RPRDKADV-RPRDKEY+PRDTKEY   MATCH ADV                       
         BNE   IPTPPRDC                                                         
         CLC   RCONPRD,RPRDKPRD-RPRDKEY+PRDTKEY MATCH PRODUCT CODE              
         BE    IPTPPRDF                                                         
*                                                                               
IPTPPRDC DS    0H                                                               
*                                                                               
         A     R3,PRDTBSRP+12      BUMP TO NEXT ENTRY                           
         BCT   R0,IPTPPRDL         PRODUCT NOT FOUND                            
         B     IPTPPRDD                                                         
*                                                                               
IPTPPRDF DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         LA    R6,PRDTELM          ESTABLISH PRODUCT DESCRIPTION                
         USING RPRDELEM,R6                                                      
*                                                                               
*        NETWORK CONTRACT ELEMENT                                               
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IPTPPRDD               NO PRODUCT CODE                           
         CLI   0(R6),X'02'         FIND NETWORK CONTRACT ELEMENT                
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RPRDNELM,R6         ESTABLISH NETWORK CONTRACT ELEMENT           
*                                                                               
         CLC   RPRDNPNT,RESPACES   IF POINT PERSON EXISTS                       
         BNH   IPTPPRDD                                                         
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RPRDNPNT,R2),RPRDNPNT RETURN POINT PERSON CODE               
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IPTPCDX                                                          
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'RPTPKREC(R2)   POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP     SET REP CODE                        
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RPTPKREC,R1),RPRDNPNT    SET PTP CODE                        
         LA    R1,L'RPTPKREC(R1)   BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   IPTPCDX                                                          
*                                                                               
         LA    R3,WORK                POINT TO A WORKAREA                       
*                                                                               
         GOTO1 =A(OID)                LOOK UP NAME IN TABLE                     
*                                                                               
         MVC   L'RPTPKREC(10,R2),NAMEAREA    ADD NAME TO OUTPUT                 
*                                                                               
IPTPCDX  DS    0H                                                               
*                                                                               
         B     IPTPX                                                            
*                                                                               
IPTPPRDD DS    0H                  NO POINT PERSON FOR CONTRACT                 
*                                                                               
         B     IPTPX               SKIP                                         
*                                                                               
IPTPX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPND'                  
***********************************************************************         
*                                                                     *         
*        PENDING SCREEN                                               *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  X'0C' - CONTRACT RECORD SOURCE                   *         
*                                                                     *         
*        GLARGS+1 -  C'D'  - DEMOS                                    *         
*                    C'B'  - BOOK                                     *         
*                    C'P'  - DAYPART                                  *         
*                    C'C'  - CPP                                      *         
*                    C'S'  - SPOTLENGTHS                              *         
*                                                                     *         
*        GLARGS+5 -  C'F'  - FORECASTING DATA                         *         
*                    C'P'  - PENDING     DATA                         *         
*                    C'C'  - CONTRACT    DATA                         *         
*                                                                     *         
*EXIT                                                                 *         
*        R2       CLARGS+1 - C'D' - XL3 DEMO CODE                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IPND     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+5,C'C'       SKIP TEST IF CONTRACT DATA                   
         BE    *+12                                                             
         TM    REPERTYP,REPRCURQ   SKIP IF NOT CURRENT PERIOD CONTRACT          
         BNO   IPNDX                                                            
*                                                                               
         L     R4,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,R4         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         GOTO1 FNDFLTRA,DMCB,=AL2(RKQCFAAD),0,0  FIND ASATDATE FILTER           
         BNZ   IPNDAADX            NONE FOUND                                   
*                                                                               
         ICM   R5,15,DMCB+8        POINT TO FOUND ASATDATE FILTER               
         BZ    IPNDAADX            NONE FOUND                                   
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,FLTFVLEN-FLTCTL(R5) FILTER LENGTH                           
         BZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         SR    R0,R0                                                            
         IC    R0,REQAADFN         NUMBER OF ASATDATE FILTERS                   
         AH    R0,=H'1'            ALLOW FOR TOTAL REPORT                       
         L     R3,REAADTBA         POINT TO ASATDATES TABLE                     
*                                                                               
IPNDAADL DS    0H                                                               
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   FLTFVAL-FLTCTL(0,R5),0(R3)  MATCH THIS COL FILTER                
         BE    IPNDAADF            FILTER FOUND                                 
*                                                                               
IPNDAADC DS    0H                                                               
*                                                                               
         AHI   R4,NWMTENTL         BUMP TO NEXT TABLE                           
         LA    R3,6(R3)            BUMP TO NEXT ASATDATES                       
         BCT   R0,IPNDAADL                                                      
*                                                                               
         DC    H'0'                SHOULD NOT BE HERE                           
*                                                                               
IPNDAADF DS    0H                  CORRECT TABLE FOUND                          
*                                                                               
IPNDAADX DS    0H                                                               
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         BZ    IPNDX                                                            
*                                                                               
         CLI   GLARGS+5,C'F'       IF FORECASTING DATA                          
         BNE   IPNDSTT1                                                         
*                                                                               
         CLI   CSFRCAST(RF),C'Y'      CONTRACT MUST BE FORECAST CONT            
         BE    IPNDSTTX                                                         
         B     IPNDX               ELSE DROP                                    
*                                                                               
IPNDSTT1 DS    0H                                                               
*                                                                               
         CLI   GLARGS+5,C'P'       IF PENDING DATA WANTED                       
         BE    *+8                                                              
         CLI   GLARGS+5,C'Q'       IF PENDING DATA WANTED                       
         BNE   IPNDSTT2                                                         
*                                                                               
         CLI   CSPENDNG(RF),C'Y'      CONTRACT MUST BE PENDING                  
         BE    *+12                                                             
         CLI   CSPENDNG(RF),C'P'                                                
         BNE   IPNDX                                                            
*                                                                               
         CLI   CSFRCAST(RF),C'Y'      CONTRACT MUST NOT BE FORECASTING          
         BE    IPNDX                                                            
*                                                                               
         B     IPNDSTTX                                                         
*                                                                               
IPNDSTT2 DS    0H                                                               
*                                                                               
         CLI   GLARGS+5,C'C'       OK IF CONTRACT DATA WANTED                   
         BNE   IPNDX                                                            
*                                                                               
IPNDSTTX DS    0H                                                               
*                                                                               
         XC    IPNDSARA,IPNDSARA   INIT A(SAR ELEMENT)                          
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT A CONTRACT RECORD                
         BNE   IPNDX                                                            
*                                                                               
         CLI   GLARGS+1,C'$'       TEST FOR DOLLAR BUCKET                       
         BE    IPNDDOL                                                          
*                                                                               
*        FIND SAR ELEMENT                                                       
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'12'                                                     
         BRAS  RE,GETEL                                                         
         BNE   *+12                NO SAR ELEMENT FOUND                         
         ST    R6,IPNDSARA         SAVE SAR ELEMENT ADDRESS                     
         B     IPNDSARF            ELEMENT FOUND                                
*                                                                               
*                                  NO SAR ELEMENT FOUND                         
*                                                                               
         CLI   GLARGS+1,C'D'       DONE IF NOT PRINTING DEMOS                   
         BNE   IPNDX                                                            
*                                                                               
*        FIND BOP ELEMENT                                                       
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'10'                                                     
         BRAS  RE,GETEL                                                         
         BE    IPNDSARF            BOP ELEMENT FOUND                            
*                                                                               
*                                  NO BOP ELEMENT FOUND                         
         B     IPNDX               NO USEFUL ELEMENT FOUND                      
*                                                                               
IPNDSARF DS    0H                                                               
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPNDTYP'               
***********************************************************************         
*                                                                     *         
*        DETERMINE TYPE OF DATA WANTED                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPNDTYPE DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'D'       DEMOS                                        
         BE    IPNDDEM                                                          
*                                                                               
         CLI   GLARGS+1,C'B'       BOOK                                         
         BE    IPNDBOOK                                                         
*                                                                               
         CLI   GLARGS+1,C'P'       DAYPARTS                                     
         BE    IPNDDPT                                                          
*                                                                               
         CLI   GLARGS+1,C'L'       LENGTH                                       
         BE    IPNDLEN                                                          
*                                                                               
         CLI   GLARGS+1,C'C'       CPP                                          
         BE    IPNDDPT                                                          
*                                                                               
         B     IPNDX               UNKNOWN DATA TYPE                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPNDDEM'               
***********************************************************************         
*                                                                     *         
*        PRINT DEMOS                                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPNDDEM  DS    0H                                                               
*                                                                               
         L     R8,=A(DBLOCK)                                                    
         USING DBLOCK,R8           ESTABLISH DBLOCK                             
*                                                                               
         XC    DBLOCK,DBLOCK                                                    
*                                                                               
         MVC   DBFILE,=C'INV'      INVENTORY FILE                               
         MVC   DBCOMFCS,ACOMFACS                                                
*                                                                               
         LA    R3,RSARDEM-RSAREL(R6) ASSUME SAR ELEMENT                         
         LA    R0,8                  MAX 8 DEMOS                                
         MVI   DBSELMED,C'T'         MEDIA T                                    
*                                                                               
         CLI   0(R6),X'10'         IF BOP ELEMENT                               
         BNE   IPNDDBPX                                                         
*                                                                               
         LA    R3,RCONBPDM-RCONBPEL(R6)    SWITCH POINTER                       
*                                                                               
         CLI   0(R3),X'FF'            SKIP IF NOT VALIDATED BY DEMOVAL          
         BNE   IPNDDEMX                                                         
*                                                                               
         LA    R3,1(R3)               POINT TO DEMOS                            
         LA    R0,6                   MAX 6 DEMOS                               
         MVI   DBSELMED,C'R'          MEDIA R                                   
*                                                                               
IPNDDBPX DS    0H                                                               
*                                                                               
*        PRINT PRIMARY DEMO OR FIRST IN LIST BY DEFAULT                         
*                                                                               
         LR    R5,R3               DEFAULT TO FIRST DEMO                        
*                                                                               
         LR    RF,R5               POINT TO FIRST DEMO IN LIST                  
*                                                                               
IPNDDPDL DS    0H                                                               
*                                                                               
         OC    0(3,RF),0(RF)       DONE AT END OF DEMO LIST                     
         BE    IPNDDPDD                                                         
*                                                                               
         TM    0(RF),X'40'         IF PRIMARY POINTER                           
         BNO   IPNDDPDC                                                         
*                                                                               
         LR    R5,RF                  SET TO PRINT PRIMARY DEMO                 
         B     IPNDDPDD               DONE                                      
*                                                                               
IPNDDPDC DS    0H                                                               
*                                                                               
         LA    RF,3(RF)            BUMP TO NEXT DEMO                            
         BCT   R0,IPNDDPDL                                                      
*                                                                               
IPNDDPDD DS    0H                                                               
*                                                                               
         OC    0(3,R5),0(R5)       SKIP IF NO DEMO                              
         BZ    IPNDDEMX                                                         
*                                                                               
         CLI   1(R5),C'T'          FUDGE FOR DEMOCON                            
         BNE   *+8                                                              
         MVI   1(R5),C'I'                                                       
*                                                                               
*        1 DEMO AND OUTPUT TYPE 6                                               
*                                                                               
         GOTO1 DEMOCON,DMCB,(1,(R5)),(6,0(R2)),(0,DBLOCK)                       
*                                                                               
IPNDDEMX DS    0H                                                               
         B     IPNDX                                                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPNDBOOK'              
***********************************************************************         
*                                                                     *         
*        PRINT FIRST BOOK                                             *         
*              DATA CAN BE FOUND IN SAR ELEMENT OR                    *         
*              PROPOSAL ELEMENTS SO DATA COLLECTED IN SAVEARA         *         
*              BEFORE FORMATTING                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPNDBOOK DS    0H                                                               
*                                                                               
         XC    IPNDBKSV,IPNDBKSV   INIT SAVEAREAS - BOOKS                       
         XC    IPNDLBLS,IPNDLBLS   INIT SAVEAREAS - LABELS                      
*                                                                               
         USING RSARXEL,R6          ESTABLISH SAR EXTENDED ELEMENT               
*                                                                               
         CLI   RSARXLEN,RSARXLTH   IF OLD SAR ELEMENT                           
         BNE   *+12                                                             
         TM    RSARXFLG,X'04'      OR  PROPOSAL EXPANSION NOT USED              
         BO    IPNDBSRN                                                         
*                                      USE BOOKS IN SAR ELEMENT                 
*                                                                               
         CLC   RSARXBKS(2),=C'DR'  FOR DIRECT RESPONSE  - SKIP BOOKS            
         BE    *+10                                                             
         CLC   RSARXBKS(2),=C'PP'  FOR PAID PROGRAMMING - SKIP BOOKS            
         BE    IPNDBSR1                                                         
*                                                                               
         LA    R0,6                NUMBER OF BOOKS TO COPY                      
         LA    RE,RSARXBKS         POINT TO BOOKS IN SAR(X) ELEMENT             
         LA    RF,IPNDBKSV         POINT TO SAVEAREA                            
*                                                                               
         MVC   2(3,RF),0(RE)       MOVE BOOK                                    
         LA    RF,5(RF)            BUMP POINTER                                 
         LA    RE,3(RE)            BUMP POINTER                                 
         BCT   R0,*-14                                                          
*                                                                               
IPNDBSR1 DS    0H                                                               
*                                                                               
         B     IPNDBPRX                                                         
*                                                                               
IPNDBSRN DS    0H                                                               
*                                                                               
*        DATA FOUND IN  PROPOSAL EXPANSION ELEMENTS                             
*                                                                               
IPNDBPR  DS    0H                                                               
*                                                                               
*        BOOKS                                                                  
*                                                                               
         CLC   RSARXBKS(2),=C'DR'  FOR DIRECT RESPONSE - SKIP BOOKS             
         BE    *+10                                                             
         CLC   RSARXBKS(2),=C'PP'  FOR PAID PROGRAMMING - SKIP BOOKS            
         BE    IPNDBPR1                                                         
*                                                                               
*        FIND PROPOSAL BOOK ELEMENT                                             
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,RCPRBKEQ                                                  
         BRAS  RE,GETEL                                                         
         BNE   IPNDBPR1            NO BOOK PROPOSAL ELEMENT FOUND               
*                                                                               
         USING RCPRBKEL,R6         ESTABLISH BOOK PROPOSAL ELEMENT              
*                                                                               
*        CALCULATE NUMBER OF BOOKS                                              
*                                                                               
         SR    R0,R0               CLEAR HIGH ORDER PART OF NUMERATOR           
         ZIC   R1,RCPRBKLN         ELEMENT LENGTH                               
         AHI   R1,-RCPRBKOQ        MINUS LENGTH OF OVERHEAD PORTION             
*                                                                               
         LA    RE,L'RCPRBKBK       LENGTH OF BOOK FIELD                         
*                                                                               
         DR    R0,RE               QUOTIENT IN R1 IS NUMBER OF BOOKS            
         BZ    IPNDBPR1                                                         
*                                                                               
         LA    RE,RCPRBKBK         SAVE BOOKS                                   
         LA    RF,IPNDBKSV                                                      
*                                                                               
         MVC   0(L'RCPRBKBK,RF),0(RE)   MOVE BOOK OR BOOK LABEL                 
         LA    RF,L'RCPRBKBK(RF)   BUMP POINTERS                                
         LA    RE,L'RCPRBKBK(RE)                                                
         BCT   R1,*-14                                                          
*                                                                               
IPNDBPR1 DS    0H                                                               
*                                                                               
IPNDBPRX DS    0H                                                               
*                                                                               
*        READ BOOK OVERRIDE LABELS                                              
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,X'0B'        BOOK RENAMES ELEMENT CODE                    
         BRAS  RE,GETEL                                                         
         BNE   IPNDBLB2            NO BOOK PROPOSAL ELEMENT FOUND               
*                                                                               
         USING RCONSRNM,R6         ESTABLISH ELEMENT                            
*                                                                               
         ZIC   RE,1(R6)                                                         
         AHI   RE,-3               OVERHEAD AND 1 FOR EX                        
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   IPNDLBLS(0),2(R6)                                                
*                                                                               
IPNDBLB2 DS    0H                                                               
*                                                                               
         L     R6,IPNDSARA         RE-POINT TO SAR ELEMENT                      
*                                                                               
*************************                                                       
** PRINT   BOOKS FIELD **                                                       
*************************                                                       
*                                                                               
         CLI   GLARGS+1,C'B'       SKIP IF NOT PRINTING BOOKS                   
         BNE   IPNDBKX                                                          
*                                                                               
IPNDBK   CLC   RSARXBKS(2),=C'DR'                                               
         BNE   *+14                                                             
         MVC   0(2,R2),=C'DR'                                                   
         B     IPNDBKX                                                          
*                                                                               
         CLC   RSARXBKS(2),=C'PP'                                               
         BNE   *+14                                                             
         MVC   0(2,R2),=C'PP'                                                   
         B     IPNDBKX                                                          
*                                                                               
*        PRINT FIRST BOOK                                                       
*                                                                               
         LA    R3,IPNDBKSV         POINT TO BOOKS                               
         LA    R4,IPNDLBLS         POINT TO LABELS                              
*                                                                               
         CLI   0(R3),0                USER DEFINED BOOK?                        
         BNE   IPNDBK30               YES                                       
*                                                                               
         OC    0(L'IPNDBKSV,R3),0(R3)  ANY BOOK?                                
         BZ    IPNDBKDN               NO MORE BOOKS                             
*                                                                               
         CLI   1(R3),0             SPECIAL BOOK TYPE USED FOR THIS BOOK         
         BE    *+16                                                             
         XC    0(5,R4),0(R4)       YES - SAVE IN LABEL AREA                     
         MVC   0(1,R4),1(R3)                                                    
*                                                                               
         XC    IPNDWORK,IPNDWORK   INIT WORKAREA                                
         MVI   IPNDWORK,80         FAKE FIELD FOR SCREEN                        
*                                                                               
         LA    R1,IPNDELM                                                       
         XC    IPNDELM,IPNDELM     INIT WORKAREA                                
         MVC   0(2,R1),=X'0B07'    LABEL EL. + LENGTH                           
         MVC   2(5,R1),0(R4)       RENAME LABEL OR BOOK TYPE                    
*                                                                               
         LR    R0,R1                                                            
*                                                                               
         GOTO1 =V(UNBOOK),DMCB,(1,2(R3)),IPNDWORK,(C'L',(R0)),         X        
               (C'+',=CL6' ')                                                   
*                                                                               
         ZIC   RE,IPNDWORK                                                      
         LA    RE,IPNDWORK(RE)                                                  
*                                                                               
         TM    IPNDWORK+1,X'02'    EXT FIELD HDR?                               
         BNE   *+8                                                              
         SH    RE,=H'8'                                                         
*                                                                               
         CLI   0(RE),C' '          FIND LAST PRINTABLE CHARACTER                
         BH    *+8                                                              
         BCT   RE,*-8                                                           
*                                                                               
         CLI   0(RE),C')'                                                       
         BNE   IPNDBK26                                                         
*                                                                               
         BCTR  RE,0                                                             
*                                                                               
         CLI   0(RE),C' '                                                       
         BH    *+8                                                              
         BCT   RE,*-8                                                           
*                                                                               
         CLI   0(RE),C'('                                                       
         BNE   *+10                                                             
         BCTR  RE,0                                                             
         B     IPNDBK26                                                         
*                                                                               
         LA    RE,1(RE)                                                         
         MVI   0(RE),C')'                                                       
*                                                                               
IPNDBK26 LA    RF,IPNDWORK+8                                                    
         SR    RE,RF                                                            
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),IPNDWORK+8                                               
*                                                                               
         B     IPNDBKDN                                                         
*                                                                               
IPNDBK30 MVC   0(L'IPNDBKSV,R2),0(R3) SHOW THE USER-DEFINED LABEL               
*                                                                               
IPNDBKDN DS    0H                                                               
*                                                                               
IPNDBKX  DS    0H                                                               
*                                                                               
         B     IPNDX                                                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPNDDPT '              
***********************************************************************         
*                                                                     *         
*        PRINT FIRST DAYPART                                          *         
*              DATA CAN BE FOUND IN SAR ELEMENT OR                    *         
*              PROPOSAL ELEMENTS SO DATA COLLECTED IN SAVEARA         *         
*              BEFORE FORMATTING                                      *         
*                                                                     *         
*EXIT    XL1   DAYPART MENU INDICATOR                                 *         
*        XL30  6 5 BYTE FIELDS - DPT CODE/CPP OR JUST 3 BYTE CODE     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPNDDPT  DS    0H                                                               
*                                                                               
         USING RSARXEL,R6          ESTABLISH SAR EXTENDED ELEMENT               
*                                                                               
         CLI   RSARXLEN,RSARXLTH   IF OLD SAR ELEMENT                           
         BNE   *+12                                                             
         TM    RSARXFLG,X'04'      OR  PROPOSAL EXPANSION NOT USED              
         BO    IPNDDSRN                                                         
*                                      USE DAYPARTS IN SAR(X) ELEMENT           
*                                                                               
         LA    R0,6                   NUMBER OF DAYPARTS                        
         LA    RE,RSARXDPT            POINT TO DAYPARTS                         
         LA    RF,1(R2)               POINT TO OUTPUT AREA                      
*                                                                               
         MVC   0(1,RF),0(RE)          MOVE DAYPART                              
         MVC   3(2,RF),1(RE)          MOVE CPP                                  
         LA    RF,5(RF)               BUMP POINTER                              
         LA    RE,3(RE)               BUMP POINTER                              
         BCT   R0,*-20                                                          
*                                                                               
         B     IPNDDPTX                                                         
*                                                                               
IPNDDSRN DS    0H                                                               
*                                                                               
*        DATA FOUND IN  PROPOSAL EXPANSION ELEMENTS                             
*                                                                               
IPNDDPR  DS    0H                                                               
*                                                                               
*        FIND PROPOSAL DPT/CPP ELEMENT                                          
*                                                                               
         LA    R6,RCONREC                                                       
         MVI   ELCODE,RCPRDPEQ                                                  
         BRAS  RE,GETEL                                                         
         BNE   IPNDDPR2            NO DPT/CPP PROPOSAL ELEMENT FOUND            
*                                                                               
         USING RCPRDPEL,R6         ESTABLISH ELEMENT                            
*                                                                               
         SR    R0,R0               CALCULATE NUMBER OF DAYPARTS                 
         ZIC   R1,RCPRDPLN            ELEMENT LENGTH                            
         AHI   R1,-RCPRDPOX           SUBTRACT OLD OVERHEAD LENGTH              
*                                                                               
         LA    RE,L'RCPRDPDP       LENGTH OF DAYPART FIELD                      
         DR    R0,RE               QUOTIENT IN R1 IS NO. OF DAYPARTS            
         LTR   R1,R1                                                            
         BZ    IPNDDPR2            NO DAYPARTS                                  
*                                                                               
         LA    RE,RCPRDPDP-(RCPRDPOQ-RCPRDPOX)  ASSUME OLD ELEMENT              
*                                                                               
         LTR   R0,R0               IF NEW ELEMENT                               
         BZ    *+14                                                             
         LA    RE,RCPRDPDP            POINT TO DAYPARTS                         
         OC    0(1,R2),RCPRDPFL       COPY FLAGS                                
*                                                                               
         LA    RF,1(R2)            POINT TO OUTPUT AREA                         
*                                                                               
         MVC   0(L'RCPRDPDP,RF),0(RE)   MOVE DAYPART & CPP                      
         LA    RF,L'RCPRDPDP(RF)   BUMP POINTERS                                
         LA    RE,L'RCPRDPDP(RE)                                                
         BCT   R1,*-14                                                          
*                                                                               
         MVC   31(2,R2),REREP      PASS REP                                     
*                                                                               
IPNDDPR2 DS    0H                                                               
*                                                                               
IPNDDPTX DS    0H                                                               
*                                                                               
IPNDDPX  DS    0H                                                               
*                                                                               
         B     IPNDX                                                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPNDLEN '              
***********************************************************************         
*                                                                     *         
*        SPOT LENGTHS                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPNDLEN  DS    0H                                                               
*                                                                               
         USING RSARXEL,R6          ESTABLISH SAR EXTENDED ELEMENT               
*                                                                               
         MVC   0(L'RSARXRFR,R2),RSARXRFR   RETURN SPOT LENGTHS                  
*                                                                               
IPNDLENX DS    0H                                                               
*                                                                               
         B     IPNDX                                                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - IPNDDOL '              
***********************************************************************         
*                                                                     *         
*        VARIOUS DOLLAR BUCKETS ON PENDING SCREEN                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPNDDOL  DS    0H                                                               
*                                                                               
         L     R6,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,R6         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         ICM   R6,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         BZ    IPNDDOLX                                                         
*                                                                               
         SR    RF,RF                                                            
         IC    RF,GLARGS+2         GET BUCKET DISPLACEMENT                      
*                                                                               
         LA    R1,0(RF,R6)         POINT TO BUCKET                              
*                                                                               
         ICM   RF,15,0(R1)         RETURN PACKED BUCKET                         
         CVD   RF,DUB                                                           
         ZAP   0(8,R2),DUB                                                      
*                                                                               
         CLI   GLARGS+5,C'Q'       SKIP IF NOT PRO-RATED AMOUNT                 
         BNE   IPNDDOLX                                                         
*                                                                               
IPND$PR  DS    0H                  PRO RATED KEYWORDS                           
*                                                                               
*        PRO-RATED BUDGET OVER PERIOD OF COLUMN                                 
*                                                                               
*        IF FIRST TIME GET REQUEST DATES ESP FOR ALT CAL                        
*                                                                               
         OC    IPNDRSTR,IPNDRSTR   SKIP IF REUEST DATES KNOWN                   
         BNZ   IPND$10                                                          
*                                                                               
         MVC   IPNDRSTR,REQPSTR    DEFAULT TO REQUEST DATES                     
         MVC   IPNDREND,REQPEND                                                 
*                                                                               
         TM    REQCSTAT,REQCSACQ   DONE IF NOT USING ALT CALENDARS              
         BNO   IPND$10                                                          
*                                                                               
         GOTO1 DATVAL,DMCB,(2,REQPSTRM),IPNDWORK    MMM/YY FORMAT               
*                                                                               
         MVC   IPNDWORK+4(2),=C'15'  MIDDLE OF THE MONTH                        
*                                                                               
         GOTOR ALTCAL,DMCB,IPNDWORK,IPNDWORK+8                                  
*                                                                               
         MVC   IPNDRSTR,IPNDWORK+8   START OF REQUEST PERIOD                    
*                                                                               
         CLC   REQPSTRM,REQPENDM   IF REQUEST FOR ONE MONTH                     
         BNE   *+14                                                             
         MVC   IPNDREND,IPNDWORK+14  END OF REQUEST END MONTH                   
         B     IPND$10                                                          
*                                                                               
         GOTO1 DATVAL,DMCB,(2,REQPENDM),IPNDWORK    MMM/YY FORMAT               
*                                                                               
         MVC   IPNDWORK+4(2),=C'15'  MIDDLE OF THE MONTH                        
*                                                                               
         GOTOR ALTCAL,DMCB,IPNDWORK,IPNDWORK+8                                  
*                                                                               
         MVC   IPNDREND,IPNDWORK+14  END OF REQUEST END MONTH                   
*                                                                               
IPND$10  DS    0H                                                               
*                                                                               
*        CONTRACT START AND END DATES IN YYMMDD FORMAT                          
*                                                                               
         CLC   IPNDCON,RECON       IF NEW CONTRACT                              
         BE    IPND$P0A                                                         
*                                     INIT CONTRACT DATES & DAYS                
         GOTOR DATCON,DMCB,(3,RECONSTR),(0,IPNDCSTR)                            
         GOTOR DATCON,DMCB,(3,RECONEND),(0,IPNDCEND)                            
*                                                                               
         GOTOR PERVERT,DMCB,IPNDCSTR,IPNDCEND,0,0                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,8(R1)          NUMBER OF DAYS IN CONTRACT PERIOD            
         CVD   RF,IPNDCDYS         SAVE                                         
*                                                                               
IPND$P0A DS    0H                                                               
*                                                                               
         OC    GLARGS+9(2),GLARGS+9 IF NO PERIOD FOR COLUMN                     
         BNZ   IPND$PR0                                                         
*                                                                               
         MVC   IPNDSTR,IPNDRSTR       DEFAULT TO PERIOD START                   
         MVC   IPNDEND,IPNDREND       AND PERIOD END                            
         MVC   IPNDMSTR,IPNDRSTR                                                
         MVC   IPNDMEND,IPNDREND                                                
         B     IPND$PR2                                                         
*                                                                               
IPND$PR0 DS    0H                                                               
*                                                                               
         MVC   FULL(2),GLARGS+9    START MONTH OF COLUMN MONTH                  
         MVI   FULL+2,15           MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,FULL),(0,IPNDWORK)   YYMMDD                       
*                                                                               
         TM    REQCSTAT,REQCSACQ   SKIP IF USING ALTERNATE CALENDARS            
         BO    IPND$PRA                                                         
*                                                                               
         GOTO1 QGTBROAD,DMCB,(1,IPNDWORK),IPNDWORK+8,GETDAY,ADDAY               
         CLI   DMCB,X'FF'          BROADCAST MONTH                              
         BNE   *+6                                                              
         DC    H'0'                ERROR                                        
*                                                                               
         B     IPND$PRB                                                         
*                                                                               
IPND$PRA DS    0H                                                               
*                                                                               
         GOTOR ALTCAL,DMCB,IPNDWORK,IPNDWORK+8                                  
*                                                                               
IPND$PRB DS    0H                                                               
*                                                                               
         MVC   IPNDMSTR,IPNDWORK+8     START OF COL BRDCST MN                   
*                                                                               
         CLC   GLARGS+9(2),GLARGS+12 IF ONLY ONE MONTH                          
         BNE   *+14                                                             
         MVC   IPNDMEND,IPNDWORK+14     END OF COLUMN MONTH                     
         B     IPND$PR1                                                         
*                                                                               
         MVC   FULL(2),GLARGS+12   END MONTH OF COLUMN MONTH                    
         MVI   FULL+2,15           MIDDLE OF THE MONTH                          
*                                                                               
         GOTO1 DATCON,DMCB,(3,FULL),(0,IPNDWORK)   YYMMDD                       
*                                                                               
         TM    REQCSTAT,REQCSACQ   SKIP IF USING ALTERNATE CALENDARS            
         BO    IPND$PRC                                                         
*                                                                               
         GOTO1 QGTBROAD,DMCB,(1,IPNDWORK),IPNDWORK+8,GETDAY,ADDAY               
         CLI   DMCB,X'FF'          BROADCAST MONTH                              
         BNE   *+6                                                              
         DC    H'0'                ERROR                                        
*                                                                               
         B     IPND$PRD                                                         
*                                                                               
IPND$PRC DS    0H                                                               
*                                                                               
         GOTOR ALTCAL,DMCB,IPNDWORK,IPNDWORK+8                                  
*                                                                               
IPND$PRD DS    0H                                                               
*                                                                               
         MVC   IPNDMSTR,IPNDWORK+14  END OF COL BRDCST MN                       
*                                                                               
IPND$PR1 DS    0H                                                               
*                                                                               
         MVC   IPNDSTR,IPNDMSTR    DEFAULT TO MONTH START                       
         MVC   IPNDEND,IPNDMEND    DEFAULT TO MONTH END                         
*                                                                               
IPND$PR2 DS    0H                                                               
*                                                                               
         CLC   IPNDSTR,IPNDRSTR    LATEST OF START OR PERIOD START              
         BNL   *+10                                                             
         MVC   IPNDSTR,IPNDRSTR                                                 
*                                                                               
         CLC   IPNDSTR,IPNDCSTR    LATEST OF START OR CONTRACT START            
         BNL   *+10                                                             
         MVC   IPNDSTR,IPNDCSTR                                                 
*                                                                               
         CLC   IPNDEND,IPNDREND    EARLIEST OF END OR PERIOD END                
         BNH   *+10                                                             
         MVC   IPNDEND,IPNDREND                                                 
*                                                                               
         CLC   IPNDEND,IPNDCEND    EARLIEST OF END OR CONTRACT END              
         BNH   *+10                                                             
         MVC   IPNDEND,IPNDCEND                                                 
*                                                                               
         CLC   IPNDSTR,IPNDMEND    IF CONTRACT/PERIOD START AFTER               
         BH    IPND$PR5               MONTH END                                 
         CLC   IPNDEND,IPNDMSTR    OR CONTRACT/PERIOD END BEFORE                
         BNL   IPND$PR6               MONTH STRAT                               
*                                                                               
IPND$PR5 DS    0H                                                               
*                                                                               
         ZAP   0(8,R2),=P'0'          RETURN ZERO DOLLARS                       
         B     IPNDDOLX                                                         
*                                                                               
IPND$PR6 DS    0H                                                               
*                                                                               
         GOTOR PERVERT,DMCB,IPNDSTR,IPNDEND,0,0  MONTH DAYS                     
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,8(R1)          GET NUMBER OF DAYS FOR COLUMN                
         CVD   RF,IPNDMDYS         SAVE                                         
*                                                                               
         ZAP   IPNDPL16,0(8,R2)    TOTAL BUDGET                                 
         MP    IPNDPL16,IPNDMDYS   * DAYS IN MONTH                              
*                                                                               
         SRP   IPNDPL16,1,0        *10 FOR ROUNDING                             
*                                                                               
         DP    IPNDPL16,IPNDCDYS   BUDGET PER DAY                               
*                                                                               
         SRP   IPNDQUOT,64-1,5     ROUND TO PENNIES                             
*                                                                               
         ZAP   0(8,R2),IPNDQUOT    PRO-RATED BUDGET                             
*                                                                               
IPNDDOLX DS    0H                                                               
*                                                                               
         B     IPNDX                                                            
*                                                                               
         DROP  R6                                                               
*                                                                               
IPNDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
IPNDSARA DS    A                   A(SAR ELEMENT)                               
IPNDDPCT DS    F                   NUMBER OF DAYPARTS                           
*                                                                               
IPNDBKSV DS    6XL5                BOOKS SAVEAREA                               
IPNDLBLS DS    6XL5                LABELS SAVEAREA                              
*                                                                               
IPNDWORK DS    CL80                WORKAREA                                     
IPNDELM  DS    CL80                WORKAREA                                     
*                                                                               
         DS    0D                  ALIGNMENT                                    
IPNDCON  DS    PL4                 CONTRACT NUMBER SAVEAREA                     
*                                                                               
IPNDPL16 DS    0PL16               PACKED WORK AREA                             
IPNDQUOT DS    PL8                 QUOTIENT                                     
IPNDRMDR DS    PL8                 REMAINDER                                    
*                                                                               
IPNDCDYS DS    PL8                 DAYS IN CONTRACT PERIOD                      
IPNDMDYS DS    PL8                 DAYS IN MONTH                                
*                                                                               
IPNDRSTR DS    CL6                 REQUEST  START                               
IPNDREND DS    CL6                 REQUEST  END                                 
IPNDCSTR DS    CL6                 CONTRACT START                               
IPNDCEND DS    CL6                 CONTRACT END                                 
IPNDMSTR DS    CL6                 MONTH    START                               
IPNDMEND DS    CL6                 MONTH    END                                 
IPNDSTR  DS    CL6                          START                               
IPNDEND  DS    CL6                          END                                 
*                                                                               
         DROP                                                                   
*                                                                               
***********************************************************************         
*                                                                     *         
*        FIND START AND DATES OF CALENDAR MONTH CAONTAINING GIVEN DATE*         
*                                                                     *         
*NTRY    P1    A(INPUT DATE)      YYMMDD                              *         
*        P2    A(OUTPUT)                                              *         
*                                                                     *         
*EXIT    P2    A(ALTERNATE CALENDAR MONTH START AND END DTES FOR INPUT*         
*                                                                     *         
***********************************************************************         
ALTCAL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         LR    R5,R1               SAVE PARAMETER LIAT POINTER                  
*                                                                               
         OC    ALTGTBRD,ALTGTBRD   IF FIRST TIME                                
         BNZ   ALT1STX                                                          
*                                                                               
*        BUILD FACILITIES LIST                                                  
*                                                                               
         MVC   ALTGTBRD,QGTBROAD   A(GETBROAD)                                  
         MVC   ALTGTDAY,GETDAY     A(GETDAY)                                    
         MVC   ALTADDAY,ADDAY      A(ADDAY)                                     
         MVC   ALTDTCON,DATCON     A(DATCON)                                    
         MVC   ALTDMGR,DATAMGR     A(DATAMGR)                                   
*                                                                               
ALT1STX  DS    0H                                                               
*                                                                               
         XC    ALTWORK,ALTWORK     INIT OUTPUT AREA                             
*                                                                               
*        FIND CALENDAR MONTH FOR INPUT DATE                                     
*                                                                               
         L     R2,0(R5)            POINT TO INPUT DATE                          
*                                                                               
         XC    ALTDMCB+12(4),ALTDMCB INIT 4TH PARM                              
         MVC   ALTDMCB+12+2(2),REREP SET REP CODE                               
*                                                                               
         GOTO1 ALTBCMON,ALTDMCB,0(R2),ALTWORK,ALTFACS,,RESTA,0                  
         CLI   0(R1),X'FF'         DIE ON ERRORS                                
         BNE   *+6                                                              
         DC    H'0'                                                             
*                                                                               
*        CONVERT MONTH DATES TO CHARACTER                                       
*                                                                               
         L     R2,4(R5)            POINT TO OUTPUT AREA                         
*                                                                               
         GOTO1 DATCON,DMCB,(X'13',ALTWORK),(0,0(02))                            
*                                  OUTPUT IS YYMMDD-YYMMDD                      
         MVC   6(6,R2),7(R2)       GET RID OF DASH                              
*                                                                               
         MVC   KEY,RECONKEY        RESTORE CURRENT KEY                          
         GOTO1 HIGH                RESTORE FILE POINTERS                        
*                                                                               
ALTCALX  DS    0H                                                               
*                                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
ALTBCMON DC    V(ALTBCMON)                                                      
*                                                                               
*        FACILITIES LIST FOR REGENABM                                           
*                                                                               
ALTFACS  DS    0D                                                               
ALTGTBRD DS    A                   A(GETBROAD)                                  
ALTGTDAY DS    A                   A(GETDAY)                                    
ALTADDAY DS    A                   A(ADDAY)                                     
ALTDTCON DS    A                   A(DATCON)                                    
ALTDMGR  DS    A                   A(DATAMGR)                                   
*                                                                               
ALTWORK  DS    XL32                WORKAREA                                     
ALTDMCB  DS    6F                  DMCB                                         
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - OPND'                  
***********************************************************************         
*                                                                     *         
*        PENDING SCREEN                                               *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  X'0C' - CONTRACT RECORD SOURCE                   *         
*                                                                     *         
*        GLARGS+1 -  C'P'  - DAYPARTS                                 *         
*         GLARGS+2 -   C'C'  - DAYPART - 1 CHARACTER                  *         
*                      C'D'  - DAYPART - 3 CHARACTERS                 *         
*                      C'N'  - DAYPART - 15 CHARACTERS FROM DPT RECORD*         
*                    C'C'  - DPT/CPP                                  *         
*                    C'S'  - SPOT LENGTH                              *         
*                                                                     *         
*EXIT    MULTIPLE OCCURRENCES PRINT ON SEQUENTIAL LINES               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OPND     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+1,C'P'       DAYPARTS                                     
         BE    OPNDDPT                                                          
*                                                                               
         CLI   GLARGS+1,C'C'       CPP                                          
         BE    OPNDDPT                                                          
*                                                                               
         CLI   GLARGS+1,C'L'       SPOT LENGTHS                                 
         BE    OPNDLEN                                                          
*                                                                               
         B     OPNDX               UNKNOWN DATA TYPE                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - OPNDDPT '              
***********************************************************************         
*                                                                     *         
*        PRINT DAYPARTS                                               *         
*                                                                     *         
*NTRY    XL1   FLAG BYTE - X'80' INDICATES DAYPART RECORD USED        *         
*       6XL5   XL1 - DAYPART CODE                                     *         
*              XL4 - CPP                                              *         
*                                                                     *         
*EXIT    MULTIPLE OCCURENCES PRINT ON SEQUENTIAL LINES                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
OPNDDPT  DS    0H                                                               
*                                                                               
         LA    R5,1(R2)            POINT TO START OF DPT/CPP DATA               
         LA    R8,6                MAX NUMBER OF DAYPARTS                       
*                                                                               
OPNDLOOP DS    0H                                                               
*                                                                               
         OC    0(5,R5),0(R5)       DONE IF NO DATA AVAILABLE                    
         BZ    OPNDDONE                                                         
*                                                                               
         CLI   GLARGS+2,C'C'       IF 1 BYTE CODE WANTED                        
         BNE   *+14                                                             
         MVC   1(1,R3),0(R5)          MOVE OUT CODE                             
         B     OPNDCONT               SKIP TO END OF DAYPART                    
*                                                                               
         TM    0(R2),RCPRDPMQ      IF DAYPART RECORD NOT BEING USED             
         BO    OPNDREC                                                          
*                                     USE HARD CODED TABLE                      
         LA    R4,DPTABLE             POINT TO HARDCODED TABLE                  
*                                                                               
*        MATCH INCOMING DPT CODE TO TABLE                                       
*                                                                               
         CLI   0(R4),X'FF'            SKIP IF END OF TABLE REACHED              
         BE    OPNDCONT                                                         
         CLC   0(1,R5),3(R4)          TABLE IS 3 CH CODE, 1 CH CODE             
         BE    *+12                                                             
         LA    R4,4(R4)               BUMP TO NEXT TABLE ENTRY                  
         B     *-22                                                             
*                                                                               
         MVC   0(3,R3),0(R4)          PRINT SHORT NAME                          
         B     OPNDDPTX                                                         
*                                                                               
OPNDREC  DS    0H                  ELSE READ DAYPART RECORD                     
*                                                                               
         XC    KEY,KEY             ESTABLISH KEY AS RRDPREC KEY                 
         LA    R4,KEY                                                           
         USING RRDPREC,R4                                                       
*                                                                               
         MVI   RRDPKTYP,RRDPKIDQ   SET RECORD TYPE                              
         MVC   RRDPKREP,31(R2)     REP CODE                                     
         MVC   RRDPKDPT,0(R5)      DAYPART CODE                                 
*                                                                               
*        SEARCH DAYPART TABLE TO SEE IF RECORD AREADY READ                      
*                                                                               
         L     R4,RDPBXLE          LOAD BXLE REGISTERS FOR TAB SEARCH           
         LM    RE,RF,RDPBXLE+4                                                  
*                                                                               
         CR    R4,RF               SKIP SEARCH IF TABLE EMPTY                   
         BH    OPNDDPDN                                                         
*                                                                               
         CLC   RRDPKEY,KEY         FIND DPT IN TABLE                            
         BE    OPNDDPFD                                                         
         BXLE  R4,RE,*-10          NEXT ENTRY                                   
*                                                                               
OPNDDPDN DS    0H                  ENTRY NOT FOUND                              
*                                                                               
         LA    R4,KEY              RESET KEY POINTER                            
*                                                                               
         CLC   RRDPKREP,REREP      IF REP CHANGES                               
         BE    *+8                                                              
         BRAS  RE,NEWREP              SET UP FOR NEW REP                        
*                                                                               
         GOTO1 HIGH                READ FOR KEY                                 
*                                                                               
         CLC   RRDPKEY,KEYSAVE     SKIP IF NOT FOUND                            
         BNE   OPNDCONT                                                         
*                                                                               
         MVC   AIO,REAIO1          READ INTO I/OAREA1                           
*                                                                               
         GOTO1 GETREC              GET RECORD                                   
*                                                                               
         L     R1,AIO              POINT TO FOUND RECORD                        
*                                                                               
         L     R4,RDPBXLE+8        POINT TO NEXT SLOT IN TABLE                  
         LA    R4,1(R4)                                                         
*                                                                               
         C     R4,RDPTMAXA         MAKE SURE THERE IS ROOM IN TAB               
         BNH   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RF,RDPBXLE+4        TABLE ENTRY LENGTH                           
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   RRDPREC(0),0(R1)    ADD RECORD TO TABLE                          
*                                                                               
         LA    R1,0(RF,R4)         NEW TABLE END                                
         ST    R1,RDPBXLE+8        SET NEW TABLE END                            
*                                                                               
OPNDDPFD DS    0H                                                               
*                                                                               
         LA    R6,RRDPELEM         ESTABLISH DESCRIPTION ELEMENT                
         USING RRDPELEM,R6                                                      
*                                                                               
         CLI   GLARGS+2,C'D'       IF SHORT NAME WANTED                         
         BNE   *+14                                                             
         MVC   0(3,R3),RRDPSNAM       PRINT IT                                  
         B     OPNDDPTX                                                         
*                                                                               
         CLI   GLARGS+2,C'N'       IF FULL NAME WANTED                          
         BNE   *+14                                                             
         MVC   0(L'RRDPLNAM,R3),RRDPLNAM    PRINT IT                            
         B     OPNDDPTX                                                         
*                                                                               
OPNDDPTX DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'C'       SKIP IF NOT CPP FIELD                        
         BNE   OPNDCPPX                                                         
*                                                                               
         MVI   3(R3),C'/'          CPP PRINTED WITH 3CH CODE                    
*                                                                               
         EDIT  (B4,1(R5)),(8,4(R3)),2,ALIGN=LEFT  PRINT CPP                     
*                                                                               
OPNDCPPX DS    0H                                                               
*                                                                               
OPNDCONT DS    0H                                                               
*                                                                               
         LA    R3,198(R3)          BUMP OUTPUT POINTER                          
         LA    R5,5(R5)            BUMP INPUT POINTER                           
         BCT   R8,OPNDLOOP                                                      
*                                                                               
OPNDDONE DS    0H                                                               
*                                                                               
OPNDDPX  DS    0H                                                               
*                                                                               
         B     OPNDX                                                            
*                                                                               
         TITLE 'RENWRTER - INPUT - PENDING SCREEN DATA - OPNDLEN '              
***********************************************************************         
*                                                                     *         
*        PRINT SPOT LENGTHS                                           *         
*                                                                     *         
*NTRY   6XL2   XL1 - SPARE                                            *         
*              XL1 - SPOT LENGTH IN BITS 1-7                          *         
*                    X'80' ON INDICATES MINUTES                       *         
*                                                                     *         
*EXIT    MULTIPLE OCCURENCES PRINT ON SEQUENTIAL LINES                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
OPNDLEN  DS    0H                                                               
*                                                                               
         LA    R5,0(R2)            POINT TO FIRST SPOT LENGTH                   
         LA    R8,6                MAX 6                                        
*                                                                               
OPNDLENL DS    0H                                                               
*                                                                               
         OC    0(2,R5),0(R5)       DONE IF NO SPOTLENGTH                        
         BZ    OPNDLEND                                                         
*                                                                               
         MVC   HALF,0(R5)          COPY SPOT LENGTH                             
         NI    HALF+1,X'FF'-X'80'  KILL MINUTES INDICATOR                       
*                                                                               
         EDIT  (B2,HALF),(4,0(R3)),0,ALIGN=LEFT  SECONDS                        
*                                                                               
         TM    1(R5),X'80'         IF MINUTES                                   
         BNO   *+12                                                             
         LR    R1,R3                  POINT TO START OF OUTPUT                  
         AR    R1,R0                  POINT TO END   OF OUTPUT                  
         MVI   0(R1),C'M'             FLAG OUTPUT                               
*                                                                               
OPNDLENC DS    0H                                                               
*                                                                               
         LA    R3,198(R3)          NEXT OUTPUT AREA                             
         LA    R5,2(R5)            NEXT SPOTLENGTH                              
         BCT   R8,OPNDLENL                                                      
*                                                                               
OPNDLEND DS    0H                                                               
*                                                                               
OPNDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
DPTABLE  DS    0CL4                                                             
         DC    CL4'MNGM'            MORNING                                     
         DC    CL4'DAYD'            DAYTIME                                     
         DC    CL4'ELYE'            EARLY FRINGE                                
         DC    CL4'ENWR'            EARLY NEWS                                  
         DC    CL4'ACCA'            PRIME ACCESS                                
         DC    CL4'LNWT'            LATE NEWS                                   
         DC    CL4'LTEL'            LATE FRINGE                                 
         DC    CL4'WKDW'            WEEKEND                                     
         DC    CL4'KIDK'            KIDS                                        
         DC    CL4'FRGF'            FRINGE                                      
         DC    CL4'NWSN'            NEWS                                        
         DC    CL4'PRIP'            PRIME                                       
         DC    CL4'MOVV'            MOVIES                                      
         DC    CL4'SPES'            SPECIALS                                    
         DC    CL4'SPOJ'            SPORTS                                      
         DC    CL4'SPSO'            SOAPS                                       
         DC    CL4'COMU'            COMPETITIVE                                 
         DC    CL4'LOCX'            LOCAL                                       
         DC    X'FF'                                                            
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
*        RESEARCH DAYPART RECORD TABLE                                          
*                                                                               
RDPBXLE  DS    0A                  BXLE REGISTERS FOR TABLE                     
         DC    A(RDPSTRT)          TABLE START                                  
         DC    AL4(34+RRDPELML)    ENTRY LENGTH                                 
         DC    A(RDPSTRT-1)        TABLE END                                    
RDPTMAXA DC    A(RDPEND)           MAXIMUM FOR TABLE                            
*                                                                               
RDPSTRT  DS    0A                                                               
         DS    100XL(34+RRDPELML)  100 ENTRIS IN TABLE                          
RDPEND   EQU   *-1                 END OF TABLE                                 
*                                                                               
         TITLE 'RENWRTER - INPUT - PRODUCT FROM CONTRACT - IPTP'                
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT PRODUCT FROM CONTRACT                     *         
*        CONTRACT HAS EITHER PRODUCT CODE OR FREE FORM PRODUCT NAME   *         
*        IF CODE MUST EVENTUALLY LOOK IT UP IN PRODUCT TABLE          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
*        ELSE   CL03 - NULLS TO SHOW NO CODE EXISTS                   *         
*               CL20 - PRODUCT NAME FROM RECORD                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IPRD     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IPRDCDN                NO PRODUCT CODE                           
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         CLC   RCONPRD,RESPACES    SKIP IF NO PRODUCT CODE FOUND                
         BNH   IPRDCDN                                                          
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RCONPRD,R2),RCONPRD   RETURN PRODUCT CODE                    
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IPRDCDX                                                          
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'RPRDKPRD(R2)   POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKADV,R1),RCONKADV   SET ADV CODE                         
         LA    R1,L'RCONKADV(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RCONPRD,R1),RCONPRD     SET PRD CODE                         
         LA    R1,L'RCONPRD(R1)    BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   IPRDCDX                                                          
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'RCONPRD(10,R2),NAMEAREA    ADD NAME TO OUTPUT                  
*                                                                               
IPRDCDX  DS    0H                                                               
*                                                                               
         B     IPRDX                                                            
*                                                                               
IPRDCDN  DS    0H                                                               
*                                                                               
*        FIND FREEFORM NAME IN RECORD                                           
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    IPRDNAMX                                                         
         CLI   0(R6),X'05'         FIND CONTRACT EXPANSION ELEMENT              
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONEXEL,R6         ESTABLISH CONTRACT EXTENSION ELEMENT         
*                                                                               
         MVC   0(L'RCONPRD,R2),=4X'FF'     INDICATE NO PRODUCT CODE             
         MVC   L'RCONPRD(L'RCONEXPR,R2),RCONEXPR   RETURN PRODUCT NAME          
*                                                                               
IPRDNAMX DS    0H                                                               
*                                                                               
IPRDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - PERIOD FROM CONTRACT - OPRD'                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT PRODUCT                                     *         
*        INPUT DRIVER IS EITHER DATA TO LOOK UP IN TABLE              *         
*        OR FREEFORM PRODUCT NAME                                     *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  IF CODE EXISTS THEN SAME AS THAT FOR OID              *         
*                                                                     *         
*        ELSE   CL03 - NULLS TO SHOW NO CODE EXISTS                   *         
*               CL20 - PRODUCT NAME FROM RECORD                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OPRD     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLC   0(L'RCONPRD,R2),=4X'FF' SKIP IF NO PROD CODE PROVIDED            
         BE    OPRDCDN                                                          
*                                                                               
         GOTO1 =A(OID)             PRINT USING OID ROUTINE                      
*                                                                               
OPRDCDX  DS    0H                                                               
         B     OPRDX                                                            
*                                                                               
OPRDCDN  DS    0H                                                               
*                                                                               
*        AT THIS POINT WE ONLY HAVE A 20 CHARACTER FREE FORM NAME               
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF PRODUCT CODE ONLY                    
         BE    OPRDX                                                            
*                                                                               
         SR    RF,RF                                                            
         IC    RF,MYOLEN           GET OUTPUT LENGTH                            
*                                                                               
         CLM   RF,1,=AL1(L'RCONEXPR) USE SMALLER                                
         BNH   *+8                                                              
         LA    RF,L'RCONEXPR          AVOIDS PRINTING GARBAGE                   
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   NAMEAREA(0),L'RCONPRD(R2) MOVE NAME TO OUTPUT AREA               
*                                                                               
         GOTO1 GENOUTA            PRINT                                         
*                                                                               
OPRDX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT - IPWC'          
***********************************************************************         
*                                                                     *         
*        ROUTINE TO RETRIEVE DATA FROM PAPERWORK COUNTING RECORD      *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        GLARGS+1 -  C'A' - CONTRACTS WITH  ACTIVITY COUNT            *         
*                    C'T' - CONTRACTS TOTAL ACTIVITY COUNT            *         
*         GLARGS+2 -  X'02' - BUYS            RELATED                 *         
*                     X'03' - CONTRACT HEADER RELATED                 *         
*                     X'04' - AVAIL           RELATED                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IPWC     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7                                                      
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO2           POINT TO CURRENT PAPERWORK RECORD            
         USING RPWCREC,R4          ESTABLISH RECORD                             
*                                                                               
         CLI   RPWCKTYP,RPWCKTYQ   SKIP IF NOT A PAPERWORK RECORD               
         BNE   IPWCX                                                            
*                                                                               
         CLI   GLARGS+1,C'A'       CONTRACT WITH ACTIVITY COUNT                 
         BE    IPWACT                                                           
*                                                                               
         CLI   GLARGS+1,C'T'       TOTAL ACTIVITY COUNT                         
         BE    IPWACT                                                           
*                                                                               
         B     IPWCX               UNKNOWN FIELD                                
*                                                                               
         TITLE 'RENWRTER - CONTRACT RECORD DATA SOURCE - INPUT -IPWACT'         
***********************************************************************         
*                                                                     *         
*        COUNT CONTRACTS WITH ACTIVITY IN ACTIVITY PERIOD             *         
*              CONTRACT OR SALES PERIOD                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IPWACT   DS    0H                                                               
*                                                                               
         ZAP   0(8,R2),=P'0'       INIT OUTPUT                                  
*                                                                               
*        RECORD MUST COVER REQUESTED ACTIVITY PERIOD                            
*                                                                               
         MVC   IPWASTRC(2*L'IPWASTRC),REQAASTR   DEFAULT TO ACT DATES           
*                                                                               
         SR    R5,R5               # OF WEEKS TO SEARCH FOR ACTIVITY            
         IC    R5,REQAAWKS         DEFAULT TO ALL WKS IN ACTVTY PERIOD          
*                                                                               
         OC    GLARGS+9(6),GLARGS+9      IF KEYWORD DATES GIVEN                 
         BZ    IPWAARGN                                                         
*                                                                               
         GOTO1 DATCON,DMCB,(3,GLARGS+09),IPWASTRC   USE THEM                    
         GOTO1 DATCON,DMCB,(3,GLARGS+12),IPWAENDC   USE THEM                    
*                                                                               
         GOTO1 PERVERT,DMCB,IPWASTRC,IPWAENDC  # OF WKS IN PERIOD               
*                                                                               
         ICM   R5,3,DMCB+12        NUMBER OF FULL WKS IN PERIOD                 
*                                                                               
         CLI   DMCB+11,0           IF THERE IS A REMAINDER                      
         BE    *+8                                                              
         LA    R5,1(R5)               BUMP BY ONE WEEK                          
*                                                                               
IPWAARGN DS    0H                                                               
*                                                                               
IPWADTX  DS    0H                                                               
*                                                                               
         CLC   IPWAENDC,RPWCCWOD   SKIP IF ACTIVITY END DATE BEFORE             
         BL    IPWACTX               CONTRACT ADDED WEEK                        
*                                                                               
         SR    R3,R3               # OF WEEKS TO BYPASS IN ELEMENT              
*                                                                               
         CLC   RPWCCWOD,IPWASTRC   PWC WK OF DATE TO ACTIVITY START             
         BE    IPWACT26              WK CTRS OKAY IF DATES ARE THE SAME         
         BH    IPWACT24              AFTER ACTIVTY START                        
*                                    BEFORE PERIOD START - BYPASS               
*                                                                               
* FIND # WKS BETWEEN ELEM START AND PERIOD START                                
*                                                                               
         GOTO1 PERVERT,DMCB,RPWCCWOD,IPWASTRC                                   
*                                                                               
         IC    R3,DMCB+13          GET WKS TO BYPASS IN ELEMENT                 
         B     IPWACT26                                                         
*                                                                               
* FIND # WKS BETWEEN PERIOD START AND ELEM START                                
*                                                                               
IPWACT24 GOTO1 PERVERT,DMCB,IPWASTRC,RPWCCWOD                                   
*                                                                               
         SR    RF,RF                                                            
         IC    RF,DMCB+13          # OF WKS IN PERIOD BEFORE ELM STARTS         
         SR    R5,RF               CUT DOWN ON NUMBER OF WKS TO SEARCH          
         BNP   IPWACTX             DONE IF NONE LEFT TO SEARCH                  
*                                                                               
IPWACT26 DS    0H                                                               
*                                                                               
*        FIND CORRECT ACTIVITY ELEMENT                                          
*        TYPE FOUND AT GLARGS+2                                                 
*                                                                               
         LA    R6,RPWCEL01         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
IPWACT1L DS    0H                                                               
*                                                                               
         USING RPWCEL02,R6         ESTABLISH GENERIC COUNT ELEMENT              
*                                                                               
         CLI   RPWCEL02,0          DONE AT END OF RECORD                        
         BE    IPWACT1D                                                         
*                                                                               
         CLI   RPWCEL02,X'02'      MUST BE A COUNTING ELEMENT                   
         BL    IPWACT1C                                                         
         CLI   RPWCEL02,X'03'                                                   
         BH    IPWACT1D                                                         
*                                                                               
         CLI   GLARGS+2,0          CHECK ALL ELMS IF TYPE NOT GIVEN             
         BE    *+14                                                             
         CLC   RPWCEL02,GLARGS+2   FIND DESIRED COUNTING ELEMENT                
         BNE   IPWACT1C                                                         
*                                                                               
         LA    RE,RPWC2CNT(R3)     BYPASS WKS NOT IN ACTIVITY PERIOD            
*                                                                               
         LR    R0,R5               NUMBER OF WEEKS TO SEARCH                    
         IC    RF,RPWC2LEN         ELEMENT LENGTH                               
         LA    R1,RPWCEL02(RF)     START OF NEXT ELEM                           
*                                                                               
IPWACTLP DS    0H                                                               
*                                                                               
         CR    RE,R1               DONE IF AT END OF ELEM                       
         BNL   IPWACTDN                                                         
*                                                                               
         CLI   0(RE),0             SKIP IF NO ACTIVITY                          
         BE    IPWACTCN                                                         
*                                                                               
         CLI   GLARGS+1,C'A'       DONE IF ACTIVITY ONLY WANTED                 
         BE    IPWACTFD                                                         
*                                                                               
         SR    RF,RF               RETURN NUMBER OF ACTIONS IN PERIOD           
         IC    RF,0(RE)            GET NUMBER OF ACTION IN PERIOD               
*                                                                               
         CLI   RESTA+4,C'C'        IF THIS A COMBINED STATION                   
         BNE   *+8                                                              
         SLL   RF,1                   COUNT AS DOUBLE                           
*                                                                               
         CVD   RF,DUB                                                           
         AP    0(8,R2),DUB         ACCUMULATE                                   
*                                                                               
IPWACTCN DS    0H                                                               
*                                                                               
         LA    RE,1(,RE)                                                        
         BCT   R0,IPWACTLP                                                      
*                                                                               
IPWACTDN DS    0H                                                               
*                                                                               
IPWACT1C DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,RPWC2LEN                                                      
         LA    R6,RPWCEL02(RF)     BUMP TO NEXT ELEMENT                         
         B     IPWACT1L                                                         
*                                                                               
IPWACT1D DS    0H                                                               
*                                                                               
         B     IPWACTX             NO ACTIVITY                                  
*                                                                               
IPWACTFD DS    0H                  ACTIVITY FOUND - SET COUNTER                 
*                                                                               
         ZAP   0(8,R2),=P'1'       COUNT AS ONE                                 
*                                                                               
         CLI   RESTA+4,C'C'        THIS A COMBINED STATION                      
         BNE   *+10                                                             
         ZAP   0(8,R2),=P'2'       COUNT AS TWO                                 
*                                                                               
IPWACTX  B     IPWCX                                                            
*                                                                               
IPWCX    DS    0H                                                               
         XIT1                                                                   
*                                  KEY SAVEAREAS                                
IPWCTKYS DS    16XL(1+L'RCONKEY)   FLD NUMBER,CONTRACT KEY                      
*                                                                               
IPWASTRC DS    CL6                 START ACTIVITY DATE - YYMMDD                 
IPWAENDC DS    CL6                 END   ACTIVITY DATE - YYMMDD                 
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - REGION - IREG'                               
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT REGION FROM OFFICE RECORD                 *         
*          OFFICE CODE IS FOUND IN CONTRACT RECORD                    *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IREG     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ICM   R4,15,REOFFTA       POINT TO CURRENT ENTRY IN OFFICE TAB         
         BZ    IREGX                                                            
*                                                                               
         USING OFFTTAB,R4          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R6,OFFTELM          POINT TO OFFICE ELEMENT                      
         USING ROFFELEM,R6         ESTABLISH OFFICE DESCRIPTION ELEMENT         
*                                                                               
*        EXTRACT REGION CODE FROM OFFICE ELEMENT                                
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'ROFFREG,R2),ROFFREG RETURN REGION CODE                       
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    IREGCCDX                                                         
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'ROFFREG(R2)    POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         LA    R5,OFFTKEY          POINT TO OFFICE RECORD KEY                   
*                                                                               
         MVC   0(L'ROFFKREP,R1),REDMREP  SET REP CODE                           
         LA    R1,L'ROFFKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'ROFFREG,R1),ROFFREG     SET REGION CODE                      
         LA    R1,L'ROFFREG(R1)    BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   IREGCCDX                                                         
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         IC    R0,GLARGS           SAVE CURRENT RECORD TYPE                     
         MVI   GLARGS,RREGKTYQ     SET FOR REGION RECORD                        
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
         STC   R0,GLARGS           RESTORE CURRENT RECORD TYPE                  
*                                                                               
         MVC   L'ROFFREG(10,R2),NAMEAREA    ADD NAME TO OUTPUT                  
         MVC   NAMEAREA,RESPACES   CLEAR NAME AREA                              
*                                                                               
IREGCCDX DS    0H                                                               
*                                                                               
         B     IREGCONX                                                         
*                                                                               
IREGCCDN DS    0H                                                               
*                                                                               
IREGCONX DS    0H                                                               
*                                                                               
         B     IREGX                                                            
*                                                                               
IREGCONN DS    0H                                                               
*                                                                               
IREGX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - RGON - INPUT - IRRG'                                 
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT RGON DATA FROM RRGWRI CONTROL BLOCK       *         
*                                                                     *         
*NTRY    GLARGS   = RGON ID                                           *         
*        GLARGS+1 = DISPLACEMENT INTO RRGWRI BUCKETS                  *         
*        GLARGS+2 = LENGTH OF BUCKET                                  *         
*                                                                     *         
*        R2==>  DRIVER INPUT                                          *         
*                                                                     *         
*        RGON PACING                                                  *         
*                                                                     *         
*        GLARGS+1 - 'P' PACING                                        *         
*                                                                     *         
* EXIT   R2==>  PL8(CUR WKS)                                          *         
*               PL8(PRI WKS)                                          *         
*               PL8(# OF ITEMS)                                       *         
*               PL8(CUR $'S)                                          *         
*               PL8(PRI $'S)                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
IRRG     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    IRRGX                                                            
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD OPTION IN PLAY                        
         BNO   *+18                                                             
         CLC   REQYTDSB(2),RRGWYRMO      BUCKET MUST BE FOR YTD PERIOD          
         BH    IRRGX                                                            
         B     IRRGYTD1                                                         
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO ELSE BUCKET MUST BE FOR PERIOD              
         BH    IRRGX                 USING YM OF BROADCAST MONTH                
*                                                                               
IRRGYTD1 DS    0H                                                               
*                                                                               
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    IRRGX                                                            
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    IRRGYTD5                                                         
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD OPTION IN PLAY                        
         BNO   *+18                                                             
         CLC   REQYTDSB(2),RRGWYRMO   BUCKET MUST BE FOR YTD PERIOD             
         BH    IRRGX                                                            
         B     IRRGYTD2                                                         
*                                                                               
         CLC   RECURSTB(2),RRGWYRMO ELSE BUCKET MUST BE FOR CURR PERIOD         
         BH    IRRGX                 USING YM OF BROADCAST MONTH                
*                                                                               
IRRGYTD2 DS    0H                                                               
*                                                                               
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    IRRGX                                                            
*                                                                               
IRRGYTD5 DS    0H                                                               
*                                                                               
         OC    GLARGS+9(6),GLARGS+9      SKIP IF NO DATES GIVEN                 
         BZ    IRRG10                                                           
*                                                                               
         CLC   GLARGS+9(2),RRGWYRMO    BUCKET MUST BE FOR KYW PERIOD            
         BH    IRRGX                                                            
         CLC   GLARGS+12(2),RRGWYRMO                                            
         BL    IRRGX                                                            
*                                                                               
IRRG10   DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'P'       LOOK FOR PACING                              
         BE    IRRGPAC                                                          
*                                                                               
         CLI   GLARGS+1,C'%'       LOOK FOR PER CENT                            
         BE    IRRGPC                                                           
*                                                                               
         CLI   GLARGS+1,C'M'       LOOK FOR PACING MONTH                        
         BE    IRRGPMN                                                          
*                                                                               
         SR    RE,RE                                                            
         IC    RE,GLARGS+1         GET DISPLACEMENT INTO DOLLARS                
*                                                                               
         LA    R1,RRGWPRBL(RE)     POINT TO BUCKET                              
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,GLARGS+2       BUCKET LENGTH                                
         BZ    *+6                                                              
         BCTR  RF,0                                                             
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R2),0(R1)       RETURN VALUE TO DRIVER                       
*                                                                               
         TM    GLARGS+8,X'80'      IF YTD KEYWORD                               
         BNO   IRRG50                                                           
*                                                                               
         TM    RECNTRL,RECDLSTQ    AND IF DATE LIST PROCESSING                  
         BNO   IRRG50                                                           
*                                                                               
         CLC   IRRGKEY,RRGWDAT1    IF KEY DATA CHANGED                          
         BNE   *+14                                                             
         MVC   IRRGKEY,RRGWDAT1       SAVE CURRENT KEY                          
         MVI   IRRGTAB,0              INIT FIRST ENTRY IN TABLE                 
*                                                                               
         LA    RF,IRRGTAB          FIND KEYWORD ACCUMULATION AREA               
         USING IRRGTAB,RF          ESTABLISH TABLE ENTRY                        
*                                                                               
IRRGTBLP DS    0H                                                               
*                                                                               
         CLI   IRRTKYW#,0          IF END OF TABLE                              
         BE    IRRGTBDN               USE THIS ENTRY                            
*                                                                               
         CLC   IRRTKYW#,GLARGS+6   MATCH ON KEYWORD NUMBER                      
         BE    IRRGTBFD                                                         
*                                                                               
IRRGTBCN DS    0H                                                               
*                                                                               
         LA    RF,IRRTABLQ(RF)     BUMP TO NEXT TABLE ENTRY                     
         B     IRRGTBLP                                                         
*                                                                               
IRRGTBDN DS    0H                  NEW ENTRY FOR TABLE                          
*                                                                               
         MVC   IRRTKYW#,GLARGS+6   SAVE KEYWORD NUMBER                          
         XC    IRRTDAT,IRRTDAT     INIT DATA                                    
         MVI   IRRTKYW#+IRRTABLQ,0 INIT NEXT TABLE ENTRY                        
*                                                                               
IRRGTBFD DS    0H                  ACCUMULATE DATA                              
*                                                                               
         ICM   RE,15,IRRTDAT       GET DATA SO FAR                              
         ICM   R1,15,0(R2)         GET DATA FOR THIS TIME                       
         AR    RE,R1               ACCUMULATE                                   
         STCM  RE,15,0(R2)         RETURN ACCUMULATIONS TO DRIVER               
         STCM  RE,15,IRRTDAT       SAVE ACCUMULATIONS                           
*                                                                               
         DROP  RF                                                               
*                                                                               
IRRG50   DS    0H                                                               
         B     IRRGX                                                            
*                                                                               
*        SAVE DATA FOR PACING                                                   
*                                                                               
IRRGPAC  DS    0H                                                               
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,RRGWCRWK       NUMBER OF CURRENT WEEKS                      
         CVD   RE,DUB              CVD                                          
         ZAP   0(8,R2),DUB         PASS TO DRIVER                               
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,RRGWPRWK       NUMBER OF PRIOR WEEKS                        
         CVD   RE,DUB              CVD                                          
         ZAP   8(8,R2),DUB         PASS TO DRIVER                               
*                                                                               
         ZAP   16(8,R2),=P'1'      ITEM COUNTER                                 
*                                                                               
         ICM   RF,15,RRGWCRBL      CURRENT BILLING                              
         CVD   RF,DUB              CVD                                          
         ZAP   24(8,R2),DUB        PASS TO DRIVER                               
*                                                                               
         ICM   RF,15,RRGWPRBL      PRIOR BILLING                                
         CVD   RF,DUB              CVD                                          
         ZAP   32(8,R2),DUB        PASS TO DRIVER                               
*                                                                               
IRRGPACX DS    0H                                                               
*                                                                               
         B     IRRGX                                                            
*                                                                               
IRRGPC   DS    0H                                                               
*                                                                               
         ICM   RF,15,RRGWCRBL      CURRENT BILLING                              
*                                                                               
         CVD   RF,DUB                                                           
         ZAP   0(8,R2),DUB         RETURN TO DRIVER                             
*                                                                               
         ICM   RF,15,RRGWPFIN      DEFAULT TO PRIOR FINAL                       
*                                                                               
         CLI   GLARGS+2,C'B'       IF PER CENT TO BUDGET                        
         BNE   *+8                                                              
         ICM   RF,15,RRGWCBUD         GET CURRENT BUDGET                        
*                                                                               
         CVD   RF,DUB                                                           
         ZAP   8(8,R2),DUB         RETURN TO DRIVER                             
*                                                                               
IRRGPCX  DS    0H                                                               
*                                                                               
         B     IRRGX                                                            
*                                                                               
*        SAVE DATA FOR PACING MONTH                                             
*                                                                               
IRRGPMN  DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,RRGWPRWK       NUMBER OF PRIOR WEEKS                        
         CVD   RF,DUB              CVD                                          
         ZAP   0(8,R2),DUB         PASS TO DRIVER                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,RRGWCRWK       NUMBER OF CURRENT WEEKS                      
         CVD   RF,DUB              CVD                                          
         ZAP   8(8,R2),DUB         PASS TO DRIVER                               
*                                                                               
         ZAP   16(8,R2),=P'1'      COUNTER                                      
*                                                                               
IRRGPMNX DS    0H                                                               
*                                                                               
         B     IRRGX                                                            
*                                                                               
IRRGX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
IRRGKEY  DS    XL(8*L'RRGWDAT1)    YTD DATA KEY                                 
*                                                                               
IRRGTAB  DS    0D                                                               
IRRTKYW# DS    XL1                 KEYWORD NUMBER                               
IRRTDAT  DS    XL4                 DATA ACCUMULATOR FOR KEYWORD                 
IRRTABLQ EQU   *-IRRGTAB           LENGTH OF TABLE ENTRY                        
         DS    63XL(IRRTABLQ)      REST OF TABLE                                
*                                                                               
         TITLE 'RENWRTER - OUTPUT - PACING - ORRG'                              
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT SPECIAL RGON KEYWORDS                       *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  C'R' - RGON DATA                                 *         
*                     C'M' - PACING MONTH                             *         
*                                                                     *         
*        R2==>  PL8   WEEKS IN CURRENT MONTH                          *         
*               PL8   WEEKS IN PRIOR YEAR MONTH                       *         
*               PL8   COUNTER                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ORRG     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ZAP   ORRGWORK,0(8,R2)    PRIOR WEEKS                                  
         BZ    ORRGMONX            NO PRIOR WEEKS                               
*                                                                               
         DP    ORRGWORK,16(8,R2)   DIVIDE BY COUNTER                            
         CP    ORRGRMDR,=P'0'      NON-ZERO REMAINDER MEANS                     
         BNZ   ORRGMONX               UNEVEN WEEKS                              
*                                                                               
         MVC   DUB(2),=X'4021'     EDIT PATTERN                                 
         ED    DUB(2),ORRGQUOT+7   PRINT RESULT                                 
         MVC   ORRGOUT(1),DUB+1    PRIOR   WEEKS                                
*                                                                               
         MVI   ORRGOUT+1,C'/'                                                   
*                                                                               
         ZAP   ORRGWORK,8(8,R2)    CURRENT WEEKS                                
         BZ    ORRGMONX                                                         
*                                                                               
         DP    ORRGWORK,16(8,R2)   DIVIDE BY COUNTER                            
         CP    ORRGRMDR,=P'0'      NON-ZERO REMAINDER MEANS                     
         BNZ   ORRGMONX               UNEVEN WEEKS                              
*                                                                               
         MVC   DUB(2),=X'4021'     EDIT PATTERN                                 
         ED    DUB(2),ORRGQUOT+7   PRINT RESULT                                 
         MVC   ORRGOUT+2(1),DUB+1  PRIOR   WEEKS                                
*                                                                               
         MVC   0(3,R3),ORRGOUT                                                  
*                                                                               
ORRGMONX DS    0H                                                               
*                                                                               
         B     ORRGX                                                            
*                                                                               
ORRGX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
ORRGOUT  DS    CL8                 WORK OUTPUT AREA                             
ORRGWORK DS    0PL16               PACKED WORKAREA                              
ORRGQUOT DS    PL8                 QUOTIENT                                     
ORRGRMDR DS    PL8                 REMAINDER                                    
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - SALESPERSON - ISAL'                          
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT SALESPERSON FROM A DETAIL RECORD          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ISAL     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         BNE   ISALCONN                                                         
*                                                                               
*        EXTRACT SALESPERSON'S CODE FROM CONTRACT                               
*                                                                               
ISALCON  DS    0H                                                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ISALCCDN               NO CODE                                   
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         CLC   RCONSAL,RESPACES    SKIP IF NO SALESPERSON CODE FOUND            
         BNH   ISALCCDN                                                         
*                                                                               
         MVC   ISALCODE,RCONSAL    SAVE SALESPERSON'S CODE                      
*                                                                               
         B     ISALCCDX                                                         
*                                                                               
ISALCONN DS    0H                                                               
*                                                                               
*        SALESPERSON BUDGET RECORDS                                             
*                                                                               
         CLI   RCONKTYP,X'15'      IF SALESPERSON BUDGET KEY                    
         BNE   ISALSBDN                                                         
*                                                                               
         L     R6,REANWMON            POINT TO BUDGET DOLLARS TABLE             
         USING BDMNTABD,R6            ESTABLISH MONTH TABLE AREA                
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**'  SKIP IF NOT BUDGET TABLE            
         BNE   ISALCCDN                                                         
*                                                                               
         MVC   ISALCODE,BDMTSAL                RETURN TEAM CODE                 
*                                                                               
ISALSBDX DS    0H                                                               
*                                                                               
         B     ISALCCDX                                                         
*                                                                               
ISALSBDN DS    0H                                                               
*                                                                               
         B     ISALX               UNKNOWN RECORD TYPE                          
*                                                                               
ISALCCDX DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'RCONSAL,R2),ISALCODE  RETURN SALESPERSON CODE                
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    ISALCCD9                                                         
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'RCONSAL(R2)    POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'RCONSAL,R1),ISALCODE    SET SAL CODE                         
         LA    R1,L'RCONSAL(R1)    BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   ISALCCD9                                                         
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'RCONSAL(10,R2),NAMEAREA    ADD NAME TO OUTPUT                  
*                                                                               
ISALCCD9 DS    0H                                                               
*                                                                               
         B     ISALX                                                            
*                                                                               
ISALCCDN DS    0H                                                               
*                                                                               
         B     ISALX                                                            
*                                                                               
ISALX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ISALCODE DS    XL(L'RESAL)         SALESPERSON CODE                             
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - STATION RECORD - ISTA'                       
***********************************************************************         
*                                                                     *         
*        ROUTINE TO COLLECT DATA FROM STATION RECORD                  *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARS    -  AL1(RSTAKTYQ) - STATION RCORD ID                 *         
*        GLARGS+1 -  DATA TYPE                                        *         
*                    C'B' - CALL LETTERS AND MARKET NAME              *         
*                    C'C' - CALL LETTERS ONLY                         *         
*                    C'N' - MARKET NAME - STATION ORDER               *         
*                    C'S' - MARKET NAME ORDER                         *         
*                                                                     *         
*        R2==>  CL05 - STATION CALL LETTERS                           *         
*               CL20 - STATION MARKET NAME                            *         
*               CL02 - REP                                            *         
*               CL05 - STATION CALL LETTERS - FOR MARKET NAME SORT    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ISTA     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO3           POINT TO STATION RECORD                      
         USING RSTAREC,R4          ESTABLISH STATION RECORD                     
*                                                                               
         CLI   RSTAKTYP,RSTAKTYQ   SKIP IF NOT A STATION RECORD                 
         BNE   ISTAX                                                            
*                                                                               
         CLI   GLARGS+1,C'H'       STATION CHANNEL                              
         BE    ISTACH                                                           
*                                                                               
         CLI   GLARGS+1,C'T'       STATION TYPE                                 
         BE    ISTATYP                                                          
*                                                                               
         CLI   GLARGS+1,C'C'       SKIP IF CODE ONLY WANTED                     
         BE    ISTAMKTN                                                         
*                                                                               
         CLI   GLARGS,X'81'        CHECK FOR SPECIAL RGON TYPES                 
         BL    ISTAIDX                                                          
         CLI   GLARGS,X'84'                                                     
         BH    ISTAIDX                                                          
*                                                                               
*        USE IELM TO GET DATA                                                   
*                                                                               
         ICM   R0,1,GLARGS         SAVE CURRENT DATATYPE                        
         MVI   GLARGS,X'02'        SET TO STATION DATATYPE                      
         GOTO1 =A(IELM)                                                         
         STC   R0,GLARGS           RESTORE DATATYPE                             
*                                                                               
         B     ISTAX                                                            
*                                                                               
ISTAIDX  DS    0H                                                               
*                                                                               
         ST    R2,ISTAINA          SAVE A(INPUT AREA)                           
         LA    R2,ISTAWORK         USE WORKAREA FOR MARKET                      
*                                                                               
         XC    ISTAWORK,ISTAWORK   INIT WORKAREA                                
*                                                                               
         MVC   ISTAGLSV,GLARGS     SAVE ARGUMENTS                               
         MVI   GLARGS,RMKTKTYQ     SET FOR MARKET RECORD                        
         MVI   GLARGS+1,C'S'       GET MARKET NAME                              
         GOTO1 =A(IMKT)            FIND MARKET NAME                             
         MVC   GLARGS(16),ISTAGLSV RESTORE ARGUMENTS                            
*                                                                               
         MVC   ISTANAME,4(R2)      SAVE MARKET NAME                             
*                                                                               
         L     R2,ISTAINA          RESTORE INPUT POINTER                        
*                                                                               
ISTAMKTN DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'S'       SKIP IF MARKET NAME ORDER                    
         BE    *+10                                                             
         MVC   0(L'RSTAKSTA,R2),RSTAKSTA     STATION CALL LETTERS               
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CALL LETTERS ALONE                   
         BE    ISTAX                                                            
*                                                                               
         MVC   5(L'RSTAMKT,R2),ISTANAME     STATION MARKET                      
*                                                                               
         MVC   25(L'RSTAKREP,R2),RSTAKREP    REP                                
         MVC   27(L'RSTAKSTA,R2),RSTAKSTA    STATION CALL LETTERS               
*                                                                               
         B     ISTAX                                                            
*                                                                               
ISTACH   DS    0H                  STATION CHANNEL                              
*                                  PACKED NUMBER IF PRESENT                     
*                                                                               
         LA    R6,RSTAELEM         FIND STATION ELEMENT                         
         USING RSTAELEM,R6         ESTABLISH STATION ELEMENT                    
*                                                                               
         SR    RF,RF                                                            
*                                                                               
         CLI   RSTACODE,0          DONE AT END OF RECORD                        
         BE    ISTACHX                                                          
         CLI   RSTACODE,X'01'      LOOKING FOR STATION ELEMENT                  
         BE    *+16                                                             
         IC    RF,RSTAELLN         BUMP TO NEXT ELEMENT                         
         LA    R6,RSTAELEM(RF)                                                  
         B     *-24                                                             
*                                                                               
         OC    RSTACHAN,RSTACHAN   IF CHANNEL NOT PRESENT                       
         BNZ   *+14                                                             
         MVC   0(2,R2),=CL2' '        DEFAULT TO SPACES                         
         B     ISTACHX                                                          
*                                                                               
         ZAP   DUB,RSTACHAN        COPY CHANNEL NUMBER - PACKED                 
         OI    DUB+7,X'0F'         FORCE SIGN                                   
         UNPK  0(2,R2),DUB         RETURN CHANNEL NUMBER                        
*                                                                               
ISTACHX  DS    0H                                                               
*                                                                               
         B     ISTAX                                                            
*                                                                               
ISTATYP  DS    0H                                                               
*                                                                               
         MVC   0(1,R2),RESTTP      DEFAULT TO FIRST TYPE                        
*                                                                               
ISTAX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ISTANAME DS    CL20                MARKET NAME                                  
*                                                                               
         LTORG                                                                  
*                                                                               
ISTAGLSV DS    XL16                GLARGS SAVEAREA                              
*                                                                               
ISTAINA  DS    A                   A(INPUT AREA) SAVEAREA                       
ISTAWORK DS    CL256               WORKAREA                                     
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - STATION RECORD - OSTA'                      
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT   DATA FROM STATION RECORD                  *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARS    -  AL1(RSTAKTYQ) - STATION RCORD ID                 *         
*        GLARGS+1 -  DATA TYPE                                        *         
*                    C'B' - CALL LETTERS AND MARKET NAME              *         
*                    C'C' - CALL LETTERS ONLY                         *         
*                    C'N' - MARKET NAME ONLY                          *         
*                                                                     *         
*        R2==>  CL05 - STATION CALL LETTERS                           *         
*               CL20 - STATION MARKET NAME                            *         
*               CL02 - REP                                            *         
*               CL05 - STATION CALL LETTERS                           *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OSTA     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   GLARGS+1,C'T'       STATION TYPE                                 
         BE    OSTASTP                                                          
*                                                                               
         XC    OSTASTAC,OSTASTAC   INIT CALL LETTERES SAVEAREA                  
*                                                                               
         CLI   GLARGS+1,C'N'       SKIP IF NAME ONLY TO PRINT                   
         BE    OSTASTAX                                                         
*                                                                               
         LA    R1,0(R2)            ASSUME CALL LETTERS AT BEGINNING             
*                                                                               
         CLC   0(5,R1),=CL5' '     IF THEY ARE NOT THERE                        
         BH    *+18                                                             
         LA    R1,27(R2)              ASSUME THEY ARE AT THE END                
         CLC   0(5,R1),=CL5' '        SKIP IF THEY AREN'T THERE                 
         BNH   OSTASTAX                                                         
*                                                                               
         MVC   OSTASTAC,0(R1)      SAVE CALL LETTERS                            
*                                                                               
         MVC   CODEAREA(4),0(R1)   CALL LETTERS                                 
*                                                                               
         LA    RE,CODEAREA+3       FIND LAST CHARACTER IN CALL LETTERS          
         LA    R0,4                MAX NUMBER OF CALL LETTERS                   
*                                                                               
         CLI   0(RE),C' '                                                       
         BH    *+14                                                             
         BCTR  RE,0                BACK UP A POSITION                           
         BCT   R0,*-10                                                          
         B     OSTASTAX            NO CALL LETTERS                              
*                                                                               
         LA    RF,OSTABAND         POINT TO BROADCAST BAND TABLE                
*                                                                               
         CLI   0(RF),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    OSTASTAX                                                         
         CLC   4(1,R1),0(RF)       MATCH BAND TO TABLE ENTRY                    
         BE    *+12                                                             
         LA    RF,4(RF)            BUMP TO NEXT TABLE ENTRY                     
         B     *-22                                                             
*                                                                               
         MVC   1(3,RE),1(RF)       PRINT BROADCAST BAND                         
*                                                                               
OSTASTAX DS    0H                                                               
*                                                                               
*        PRINT MARKET NAME                                                      
*                                                                               
         CLI   GLARGS+1,C'C'       SKIP IF CALL LETTERS ALONE                   
         BE    OSTAMKTX                                                         
*                                                                               
         MVC   NAMEAREA(20),5(R2)  MARKET NAME                                  
*                                                                               
OSTAMKTX DS    0H                                                               
*                                                                               
         TM    STACKSW,STCKSTFQ    IF FLOWCHARTING BY STATION                   
         BNO   OSTAFLWX                                                         
*                                                                               
*        NEED TO READ IN STATION RECORD                                         
*                                                                               
         XC    KEY,KEY                                                          
         LA    R4,KEY                                                           
         USING RSTAKEY,R4          ESTABLISH STATION KEY                        
*                                                                               
         MVI   RSTAKTYP,RSTAKTYQ   IDENTIFY STATION RECORD                      
         MVC   RSTAKREP,25(R2)     SET REP                                      
         MVC   RSTAKSTA,OSTASTAC   SET CALL LETTERS                             
*                                                                               
         CLI   RSTAKSTA+4,C'T'     TV USES BLANK BAND                           
         BE    *+8                                                              
         CLI   RSTAKSTA+4,C'0'     SATELLITES ARE TV                            
         BL    *+8                                                              
         MVI   RSTAKSTA+4,C' '                                                  
*                                                                               
         L     RF,REAIO3           POINT TO IOAREA                              
*                                                                               
         CLC   RSTAKEY,0(RF)       DONE IF CORRECT RECORD IN CORE               
         BE    OSTAFLWX                                                         
*                                                                               
         CLC   RSTAKREP,REREP      IF REP CHANGES                               
         BE    *+8                                                              
         BRAS  RE,NEWREP              SET UP FOR NEW REP                        
*                                                                               
         XC    0(L'RSTAKEY,RF),0(RF) INIT IOAREA                                
*                                                                               
         MVC   AIO,REAIO3          SET IOAREA                                   
         GOTO1 HIGH                READ KEY                                     
*                                                                               
         CLC   RSTAKEY,KEYSAVE     SKIP IF KEY NOT FOUND                        
         BNE   OSTAFLWX                                                         
*                                                                               
         GOTO1 GETREC              READ IN RECORD                               
*                                                                               
OSTAFLWX DS    0H                                                               
*                                                                               
         GOTO1 GENOUTA                                                          
*                                                                               
         B     OSTAX                                                            
*                                                                               
*        STATION TYPE                                                           
*                                                                               
OSTASTP  DS    0H                                                               
*                                                                               
         LA    R1,CODEAREA         BUILD TYPE IN CODEAREA                       
*                                                                               
         TM    0(R2),RESTTPCQ      COMPARABLE                                   
         BNO   *+12                                                             
         MVI   0(R1),C'C'          PRINT                                        
         B     OSTATYPX            CAN NOT HAVE MULTIPLE TYPES                  
*                                                                               
         TM    0(R2),RESTTPNQ      NEW                                          
         BNO   *+12                                                             
         MVI   0(R1),C'N'          PRINT                                        
         LA    R1,1(R1)                                                         
*                                                                               
         TM    0(R2),RESTTPJQ      JOINED                                       
         BNO   *+12                                                             
         MVI   0(R1),C'J'          PRINT                                        
         LA    R1,1(R1)                                                         
*                                                                               
         TM    0(R2),RESTTPOQ      OLD                                          
         BNO   *+12                                                             
         MVI   0(R1),C'O'          PRINT                                        
         LA    R1,1(R1)                                                         
*                                                                               
         TM    0(R2),RESTTPLQ      LEFT                                         
         BNO   *+12                                                             
         MVI   0(R1),C'L'          PRINT                                        
         LA    R1,1(R1)                                                         
*                                                                               
OSTATYPX DS    0H                                                               
*                                                                               
         GOTO1 GENOUTA                                                          
*                                                                               
OSTAX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
OSTABAND DS    0D                  TABLE FOR PRINTING BRADCAST BANDS            
*                                  FORMAT CL1'BAND',CL3'PRINTVALUE'             
         DC    C' ',C'   '         TV                                           
         DC    C'T',C'   '         TV                                           
         DC    C'A',C'-AM'         AM                                           
         DC    C'F',C'-FM'         FM                                           
         DC    C'C',C'-CM'         CM                                           
         DC    C'L',C'-LF'         LOW FREQUENCY                                
         DC    C'1',C'-1 '         SATELLITE STATION                            
         DC    C'2',C'-2 '         SATELLITE STATION                            
         DC    X'FF'               EOT                                          
*                                                                               
         LTORG                                                                  
*                                                                               
OSTASTAC DS    CL5                 CURRENT STATION CALL LETTERS                 
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - STATION RECORD - HSTA'                      
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT COMPETATIVE STATION IN COLUMN HEADLINE      *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARS    -  AL1(RSTAKTYQ) - STATION RECORD ID                *         
*        GLARGS+11-  RELATIVE NUMBER OF COMPETATIVE STATION           *         
*                                                                     *         
*        R3==>  HEADLINE PRINT AREA                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
HSTA     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         TM    REQCFOPT,REQCFDPQ   IF DROP OPTION BEING USED                    
         BNO   *+8                                                              
         MVI   SORTSW,C'P'            MAKE SURE THIS LINE PRINTS                
*                                                                               
         ICM   R5,15,GLADTENT      ESTABLISH DRIVE TABLE ENTRY                  
         USING DRHDD,R5            AS HEADLINE ELEMENT                          
******                                                                          
******   ICM   R3,15,DRHDAPOS      PRINT POSITION                               
******   BZ    HSTAX                                                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DRHDWDTH       GET COLUMN WIDTH                             
         BZ    HSTAX               NO LENGTH                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),RESPACES    CLEAR OLD DATA                               
*                                                                               
         CLI   DRHDARGS+11,0       DONE IF NO RELATIVE STATION NUMBER           
         BE    HSTAX                                                            
*                                                                               
         L     R4,REAIO3           POINT TO STATION RECORD                      
         USING RSTAKEY,R4          ESTABLISH STATION RECORD                     
*                                                                               
         CLI   RSTAKTYP,RSTAKTYQ   DONE IF NOT A STATION RECORD                 
         BNE   HSTAX                                                            
*                                                                               
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT                       
         USING RSTAMKEL,R6         ESTABLISH OTHER STATIONS ELEMENT             
*                                                                               
         SR    R0,R0               INIT ELEMENT COUNTER                         
         SR    RF,RF                                                            
*                                                                               
HSTALOOP DS    0H                                                               
*                                                                               
         CLI   RSTAMKCO,0          DONE AT END OF RECORD                        
         BE    HSTADONE                                                         
*                                                                               
         CLI   RSTAMKCO,X'02'      WANT ONLY OTHER STATIONS ELEMENT             
         BNE   HSTACONT                                                         
*                                                                               
         AH    R0,=H'1'            BUMP STATION COUNTER                         
*                                                                               
         CLM   R0,1,GLARGS+11      CHECK IF CORRECT STATION REACHED             
         BE    HSTAFND                                                          
*                                                                               
HSTACONT DS    0H                                                               
*                                                                               
         IC    RF,RSTAMKLN         ELEMENT LENGTH                               
         LA    R6,RSTAMKEL(RF)     POINT TO NEXT ELEMENT                        
         B     HSTALOOP                                                         
*                                                                               
HSTADONE DS    0H                                                               
*                                                                               
         B     HSTAX                                                            
*                                                                               
HSTAFND  DS    0H                                                               
*                                                                               
         MVC   0(4,R3),RSTAMKST    CALL LETTERS                                 
*                                                                               
         LA    RE,3(R3)            FIND LAST CHARACTER IN CALL LETTERS          
         LA    R0,4                MAX NUMBER OF CALL LETTERS                   
*                                                                               
         CLI   0(RE),C' '                                                       
         BH    *+14                                                             
         BCTR  RE,0                BACK UP A POSITION                           
         BCT   R0,*-10                                                          
         B     HSTASTAX            NO CALL LETTERS                              
*                                                                               
         L     RF,=A(OSTABAND)     POINT TO BROADCAST BAND TABLE                
*                                                                               
         CLI   0(RF),X'FF'         SKIP IF END OF TABLE REACHED                 
         BE    HSTASTAX                                                         
         CLC   RSTAMKST+4(1),0(RF)       MATCH BAND TO TABLE ENTRY              
         BE    *+12                                                             
         LA    RF,4(RF)            BUMP TO NEXT TABLE ENTRY                     
         B     *-22                                                             
*                                                                               
         MVC   1(3,RE),1(RF)       PRINT BROADCAST BAND                         
*                                                                               
HSTASTAX DS    0H                                                               
*                                                                               
*                                                                               
HSTAX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - OUTPUT - STATION RECORD - OSTA'                      
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT   DATA FROM STATION RECORD                  *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARS    -  AL1(RSTAKTYQ) - STATION RCORD ID                 *         
*                                                                     *         
*        R2==>  CL13 - STATION FAX NUMBER -SEE RSTAFAX IN REGENSTA    *         
*                      FOR FORMAT                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OSTAFAX  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLI   0(R2),X'00'         FIRST BYTE EMPTY?                            
         BNE   OSTAFAX9            NO  - JUST PUT OUT WHAT'S THERE              
*                                                                               
         CLI   1(R2),X'00'         ANYTHING IN SECOND BYTE?                     
         BE    OSTAFAX9            NO  - JUST PUT OUT WHAT'S THERE              
*                                                                               
         ZIC   R6,1(R2)            INTERNATIONAL CODE                           
*                                                                               
         EDIT  (R6),(3,0(R3)),FILL=0                                            
*                                                                               
         UNPK  WORK(16),3(8,R2)                                                 
*                                                                               
         ZIC   RF,2(R2)            LENGTH OF SIGNIFICANT DIGITS                 
*                                                                               
         LA    RE,16               MAXIMUM LENGTH OF FIELD                      
         SR    RE,RF               GET SIGNIFICANT OFFSET                       
         LA    RF,WORK             A(UNPACKED NUMBER)                           
         AR    RF,RE               ADD OFFSET                                   
         ZIC   RE,2(R2)            GET LENGTH OF FAX# FIELD AGAIN               
         BCTR  RE,0                DECREMENT FOR EX                             
         EX    RE,*+8              MOVE BY LENGTH                               
         B     *+10                                                             
         MVC   3(0,R3),0(RF)                                                    
*                                                                               
         B     OSTAFAXX                                                         
*                                                                               
OSTAFAX9 EQU   *                                                                
*                                                                               
         MVC   0(L'RSTAOFAX,R3),0(R2)    FAX NUMBER                             
*                                                                               
OSTAFAXX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - STACKING - INPUT - ISTACK'                           
***********************************************************************         
*                                                                     *         
*        ROUTINE TO MONITOR INITIALIZATION OF STACKING FIELDS         *         
*                                                                     *         
*        GLARGS+1    C'M' - MERGING                                   *         
*                                                                     *         
*NTRY   R2 ==> XL2 - USED AS COUNTER TO SORT DATA                     *         
*                    ASSUMED TO BE LAST ROW SO CAN BE THOUGHT OF      *         
*                    AS A REPORT LINE NUMBER.                         *         
*                    RE-INITIALIZED ON CHANGE IN CON FOR A START      *         
*                                                                     *         
*EXIT   R2 ==> XL2 - REPORT LINE NUMBER                               *         
*                                                                     *         
***********************************************************************         
         EJECT                                                                  
         DS    0D                                                               
ISTACK   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO            ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         CLI   RCONKTYP,X'0C'      SKIP IF NOT A CON RECORD IN CORE             
         BNE   ISTKCONN                                                         
*                                                                               
         LA    RF,KEYSAVE          POINT TO CURRENT DIRECTORY KEY               
*                                                                               
         CLC   0(RCONKSTA-RCONKEY,RF),ISTKKEY    INIT ON STA CHANGE             
         BNE   ISTKINI                                                          
*                                                                               
         CLI   GLARGS+1,C'M'       SKIP IF NOT MERGING                          
         BNE   ISTKINIX                                                         
*                                                                               
         CLC   ISTKKEY,0(RF)       ELSE ON CHANGE IN RECORD                     
         BNE   ISTKINI                                                          
*                                                                               
         B     ISTKINIX            ELSE SKIP                                    
*                                                                               
ISTKCONN DS    0H                                                               
*                                                                               
         B     ISTACKX             SKIP                                         
*                                                                               
ISTKINI  DS    0H                                                               
*                                                                               
         USING RCONKEY,R4          ASSUME CONTRACT RECORD                       
*                                                                               
         XC    ISTKSAV(ISTKSAVL),ISTKSAV   CLEAR WORKAREAS                      
*                                                                               
         MVC   ISTKKEY,KEYSAVE     SAVE RECORD KEY                              
*                                                                               
         L     R1,AFLTTAB          POINT TO COLUMN FILTER AREA                  
         USING FLTTABD,R1          ESTABLISH FILTER TABLE                       
         LA    R0,FTBENTNM         MAX NUMBER OF COLUMNS                        
*                                                                               
         XC    FTBLINNM,FTBLINNM   INIT LINE NUMBER                             
         LA    R1,FLTAREAL(R1)     BUMP TO NEXT AREA                            
         BCT   R0,*-10                                                          
*                                                                               
         L     R4,RESVBBFA         ESTABLISH STACK VALUES BUFFER                
         USING STKVLBFD,R4                                                      
*                                                                               
         LA    RF,SVBFSTRT         INDICATE BUFFER IS EMPTY                     
         BCTR  RF,0                                                             
         ST    RF,SVBFENDA                                                      
*                                                                               
ISTKINIX DS    0H                                                               
*                                                                               
         MVI   STACKSW,STACKYQ+STCKINIQ  INDICATE STACKING BEING DONE           
*                                                                               
         CLI   GLARGS+1,C'M'       IF ACTUALLY MERGING                          
         BNE   *+8                                                              
         MVI   STACKSW,STCKMRGQ+STCKINIQ   SET INDICATOR                        
*                                                                               
         STCM  R2,15,STACKA        SAVE STACK KEYWORD ADDRESS                   
*                                                                               
ISTACKX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
ISTKSAV  DS    0D                  STACK ROUTINE SAVEAREA                       
ISTKKEY  DC    XL(L'RCONKEY)'00'   KEY SAVEAREA                                 
ISTKSAVL EQU   *-ISTKSAV           SAVE AREA LENGTH                             
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - STACKING - WRAP-UP - XSTACK'                         
***********************************************************************         
*                                                                     *         
*        ROUTINE TO SELECT LINE NUMBER TO BE USED FOR STACK           *         
*                                                                     *         
*NTRY   STACKA - ADDRESS OF LINE NUMBER IN SORT RECORD                *         
*       CURRENT KEYWORD HAS SIGNIFICANT DATA IN IT                    *         
*       R2   ==> CURRENT VALUE OF KEYWORD                             *         
*                                                                     *         
*EXIT   SET LINE NUMBER TO THAT OF CURRENT COLUMN                     *         
*                                                                     *         
***********************************************************************         
         EJECT                                                                  
         DS    0D                                                               
XSTACK   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R1,GLADTENT         ESTABLISH INPUT DRIVETABLE ENTRY             
         USING DRIND,R1                                                         
*                                                                               
         CLI   DRINTYPE,C'P'       IF NUMERIC FIELD                             
         BE    *+8                                                              
         CLI   DRINTYPE,C'M'                                                    
         BE    *+8                                                              
         CLI   DRINTYPE,C'B'                                                    
         BNE   XSTACK1                                                          
*                                                                               
         L     R8,FLTFLTRA         POINT TO THIS LINE'S FILTER AREA             
         USING FLTTABD,R8          ESTABLISH FILTER TABLE ENTRY                 
*                                                                               
         MVC   FTBLINNM,=X'0001'      FORCE TO BE LINE 1                        
*                                                                               
         B     XSTMAJX                                                          
*                                                                               
XSTACK1  DS    0H                                                               
*                                                                               
*****    TM    STACKSW,STCKMRGQ    DONE IF NOT MERGING DATA                     
*****    BNO   XSTACKX                                                          
*                                                                               
*        CONTINUE IF THERE IS SIGNIFICANT DATA                                  
*                                                                               
         L     R1,GLADTENT         ESTABLISH DRIVE TABLE ENTRY                  
         USING DRIND,R1            AS AN INPUT RECORD                           
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,DRINREP        GET REPETITION FACTOR                        
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DRINFLEN       GET FIELD LENGTH                             
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         LR    RE,R2               COPY INPUT POINTER                           
*                                                                               
         EX    RF,*+20                                                          
         BNZ   XSTMRGFD                                                         
         LA    RE,1(RF,RE)                                                      
         BCT   R0,*-12                GET ALL REPETITIONS                       
         B     XSTACKX                NO SIGNIFICANT DATA                       
         OC    0(0,RE),0(RE)       ELSE COMPARE TO NULLS                        
*                                                                               
XSTMRGFD DS    0H                                                               
*                                                                               
         L     R8,FLTFLTRA         POINT TO THIS LINE'S FILTER AREA             
         USING FLTTABD,R8          ESTABLISH FILTER TABLE ENTRY                 
*                                                                               
         TM    GLARGS+5,X'02'      SKIP IF MAJOR FIELD                          
         BO    XSTMAJ                                                           
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,FTBLINNM       BUMP LINE NUMBER FOR KEYWORD                 
         LA    RF,1(RF)                                                         
         STCM  RF,3,FTBLINNM                                                    
*                                                                               
         B     XSTMAJX                                                          
*                                                                               
*        SEARCH STACK VALUE BUFFER FOR MATCHING KEYWORD AND VALUE               
*            IF FOUND USE ITS LINE NUMBER                                       
*            ELSE CREATE NEW ENTRY IN TABLE WITH BUMPED LINE NUMBER             
*                                                                               
XSTMAJ   DS    0H                                                               
*                                                                               
         L     R6,RESVBBFA         ESTABLISH STACK VALUE BUFFER                 
         USING STKVLBFD,R6                                                      
*                                                                               
         SR    RF,RF                                                            
*                                                                               
         XC    XSTLINNM,XSTLINNM   INIT MAX LINE NUMBER SO FAR                  
*                                                                               
         LM    R3,R5,SVBFSTA       LOAD BXLE REGS FOR BUFFER                    
*                                                                               
         CR    R3,R5               SKIP IF BUFFER EMPTY                         
         BNL   XSTBUFDN                                                         
*                                                                               
XSTBUFLP DS    0H                                                               
*                                                                               
         USING SVTTABD,R3          ESTABLISH BUFFER ENTRY                       
*                                                                               
         CLC   SVTKYWD#,GLARGS+6   MATCH KEYWORD NUMBER                         
         BNE   XSTBUFCN                                                         
*                                                                               
         CLC   XSTLINNM,SVTLINNM   UPDATE MAX LINE NUMBER                       
         BNL   *+10                                                             
         MVC   XSTLINNM,SVTLINNM                                                
*                                                                               
         SR    RF,RF                                                            
         IC    RF,SVTLEN           GET VALUE LENGTH                             
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   SVTVALUE(0),0(R2)   MATCH VALUE                                  
         BE    XSTBUFFD            MATCH FOUND                                  
*                                                                               
XSTBUFCN DS    0H                                                               
*                                                                               
         IC    R4,SVTLEN           GET VALUE LENGTH                             
         LA    R4,SVTVALUE-SVTENTRY(R4)   TABLE ENTRY LENGTH                    
         BXLE  R3,R4,XSTBUFLP                                                   
*                                                                               
XSTBUFDN DS    0H                  NO MATCH CREATE NEW ENTRY                    
*                                                                               
         MVC   SVTKYWD#,GLARGS+6   SAVE KEYWORD NUMBER                          
*                                                                               
         ICM   RF,1,DRINLEN        INPUT LENGTH                                 
         STC   RF,SVTLEN           SAVE LENGTH                                  
         BZ    *+6                                                              
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   SVTVALUE(0),0(R2)   SAVE INPUT VALUE                             
*                                                                               
         LA    R5,SVTVALUE(RF)     NEW END OF TABLE                             
         ST    R5,SVBFENDA                                                      
*                                                                               
         ICM   RF,3,XSTLINNM       BUMP MAX LINE NUMBER FOR KEYWORD             
         LA    RF,1(RF)                                                         
         STCM  RF,3,SVTLINNM                                                    
*                                                                               
XSTBUFFD DS    0H                                                               
*                                                                               
         MVC   FTBLINNM,SVTLINNM   SET LINE NUMBER                              
*                                                                               
XSTMAJX  DS    0H                                                               
*                                                                               
         ICM   RF,15,STACKA        POINT TO STACK KEYWORD                       
*                                                                               
         CLC   0(L'FTBLINNM,RF),FTBLINNM   UPDATE LINE NUMBER                   
         BNL   *+10                                                             
         MVC   0(L'FTBLINNM,RF),FTBLINNM      IF NEW ONE HIGHER                 
*                                                                               
XSTACKX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
XSTLINNM DS    XL2                 MAX LINE NUMBER USED SO FAR FOR KYWD         
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - TELEPHONE NUMBERS - OTEL'                    
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PRINT TELEPHONE NUMBERS                           *         
*                                                                     *         
*NTRY                                                                 *         
*        R2       -  AAANNNNNNN                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
OTEL     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         CLC   0(10,R2),RESPACES   SKIP IF NO TELEPPHONE NUMBER                 
         BNH   OTELX                                                            
*                                                                               
         MVC   0(3,R3),0(R2)       AREA CODE                                    
         MVI   3(R3),C'-'                                                       
         MVC   4(3,R3),3(R2)       EXCHANGE                                     
         MVI   7(R3),C'-'                                                       
         MVC   8(4,R3),6(R2)       NUMBER                                       
*                                                                               
OTELX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - DIV/TEAM - ITEM'                             
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT DIV/TEAM    FROM A DETAIL RECORD          *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ITEM     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        HANDLE RGON REPORT                                                     
*                                                                               
         XC    ITEMSTEM,ITEMSTEM   INIT TEAM SAVEAREA                           
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         BNE   ITEMRGNN                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         OC    RRGWYRMO,RRGWYRMO   DONE IF NO DATE PRESENT                      
         BZ    ITEMX                                                            
*                                                                               
         CLC   REYMSTRP(2),RRGWYRMO BUCKET MUST BE FOR PERIOD                   
         BH    ITEMX                 USING YM OF BROADCAST MONTH                
         CLC   REYMENDP(2),RRGWYRMO                                             
         BL    ITEMX                                                            
*                                                                               
         OC    RECURSTB,RECURSTB   SKIP IF NO CURRENT PERIOD                    
         BZ    *+24                                                             
         CLC   RECURSTB(2),RRGWYRMO    BUCKET MUST BE FOR CURR PERIOD           
         BH    ITEMX                 USING YM OF BROADCAST MONTH                
         CLC   RECURENB(2),RRGWYRMO                                             
         BL    ITEMX                                                            
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         BE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BCT   R0,*-18                                                          
         B     ITEMX               NO DATA TYPE MATCH                           
*                                                                               
         MVC   ITEMSTEM,0(R1)      SAVE TEAM                                    
*                                                                               
         B     ITEMTEMF            TEAM CODE FOUND                              
*                                                                               
ITEMRGNN DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         BNE   ITEMCONN                                                         
*                                                                               
*        EXTRACT DIV/TEAM'S CODE FROM CONTRACT                                  
*                                                                               
ITEMCON  DS    0H                                                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         BE    ITEMCCDN               NO CODE                                   
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         BE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         B     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         MVC   ITEMSTEM,RCONTEM    SAVE TEAM CODE                               
*                                                                               
         B     ITEMTEMF                                                         
*                                                                               
ITEMCONN DS    0H                                                               
*                                                                               
         CLI   RCONKTYP,ROBDKTYQ   IF OFFICE BUDGET KEY                         
         BNE   ITEMOBDN                                                         
*                                                                               
         L     R6,REANWMON            POINT TO BUDGET DOLLARS TABLE             
         USING BDMNTABD,R6            ESTABLISH MONTH TABLE AREA                
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**'  SKIP IF NOT BUDGET TABLE            
         BNE   ITEMCCDN            NO CODE                                      
*                                                                               
         MVC   ITEMSTEM,BDMTTEM         RETURN TEAM CODE                        
*                                                                               
         B     ITEMTEMF                                                         
*                                                                               
ITEMOBDN DS    0H                                                               
*                                                                               
         B     ITEMX                                                            
*                                                                               
ITEMTEMF DS    0H                                                               
*                                                                               
         CLC   ITEMSTEM,RESPACES   SKIP IF NO DIV/TEAM CODE FOUND               
         BNH   ITEMCCDN                                                         
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    ITEMCSX                                                          
*                                                                               
         MVC   0(L'ITEMSTEM,R2),ITEMSTEM RETURN DIV/TEAM CODE                   
*                                                                               
         CLI   GLARGS+2,C'D'          IF DIVISION ONLY                          
         BNE   *+8                                                              
         MVI   1(R2),C' '                KILL TEAM CODE                         
*                                                                               
ITEMCSX  DS    0H                                                               
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    ITEMCCDX                                                         
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'ITEMSTEM(R2)   POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING ON NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'ITEMSTEM,R1),ITEMSTEM   SET TEM CODE                         
         CLI   GLARGS+2,C'D'          IF DIVISION ONLY                          
         BNE   *+8                                                              
         MVI   1(R1),C' '                KILL TEAM CODE                         
         LA    R1,L'ITEMSTEM(R1)   BUMP TO NEXT AREA                            
*                                                                               
*        IF SORTING ON NAME USE DIVISION AND TEAM NAMES IN ENTIRETY             
*        OUTPUT IS PRINTED AS IS - DOESN'T GOTO OID                             
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   ITEMCCDX                                                         
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   0(10,R2),NAMEAREA   DIVISION NAME                                
*                                                                               
         CLI   GLARGS+2,C'D'       SKIP IF DIVISION ONLY                        
         BE    *+10                                                             
         MVC   10(10,R2),NAMEAREA+10   TEAM NAME                                
*                                                                               
ITEMCCDX DS    0H                                                               
*                                                                               
         B     ITEMCONX                                                         
*                                                                               
ITEMCCDN DS    0H                                                               
*                                                                               
ITEMCONX DS    0H                                                               
*                                                                               
         B     ITEMX                                                            
*                                                                               
ITEMX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ITEMSTEM DS    XL(L'RCONTEM)       TEAM CODE SAVEAREA                           
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - TERRITORY - ITER'                            
***********************************************************************         
*                                                                     *         
*        ROUTINE TO EXTRACT TERRITORY FROM AGENCY RECORD              *         
*                                                                     *         
*NTRY                                                                 *         
*        GLARGS   -  SAME AS THOSE FOR IID                            *         
*                                                                     *         
*        R2==>  SAME AS THAT FOR OID                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
ITER     NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         XC    ITERSTER,ITERSTER   INIT SAVEAREA                                
*                                                                               
         ICM   R8,15,REAG2TBA      ESTABLISH AGENCY TABLE                       
         BZ    ITERX               NONE AVAILABLE                               
         USING AGYTTABD,R8         ESTABLISH AGY TABLE                          
*                                                                               
         ICM   R3,15,REAG2TA       POINT TO CURRENT AG2TAB ENTRY                
         BZ    ITERX               NONE AVAILABLE                               
         USING AGYTENT,R3          ESTABLISH AGYTAB ENTRY                       
*                                                                               
*        EXTRACT TERRITORY CODE FROM AGYTABLE                                   
*                                                                               
         MVC   ITERSTER,RAGY2TER-RAGY2FXE+AGYTFAX   TERR CODE                   
*                                                                               
         CLC   ITERSTER,RESPACES   IF NO TERRITORY CODE                         
         BH    ITEROFCX                                                         
*                                                                               
         CLC   RAGK2AOF-RAGY2KEY+AGYTKEY,RESPACES   AND FOR AN OFFICE           
         BNH   ITEROFCX                                                         
*                                                                               
         MVC   AGYTKEY-AGYTTABD(L'AGYTKEY,R2),AGYTKEY COPY OFFICE KEY           
*                                                                               
         DROP  R3                                                               
*                                                                               
         MVC   RAGK2AOF-RAGY2KEY+AGYTKEY,RESPACES   KILL OFFICE IN KEY          
*                                                                               
         GOTO1 BINSRCH,AGYTBSRP,('BSPFIND',AGYTKEY)   FIND MASTER ENTRY         
*                                                                               
         CLI   BSPCNTL-BSPPRMS+AGYTBSRP,BSPNF DONE IF NOT FOUND                 
         BE    ITERX                                                            
*                                                                               
         ICM   R3,15,BSPAREC-BSPPRMS+AGYTBSRP POINT TO ENTRY                    
         BZ    ITEROFCX            NOTHING FOUND                                
*                                                                               
         USING AGYTENT,R3          ESTABLISH TABLE ENTRY                        
*                                                                               
         MVC   ITERSTER,RAGY2TER-RAGY2FXE+AGYTFAX   TERR CODE                   
*                                                                               
ITEROFCX DS    0H                                                               
*                                                                               
         CLC   ITERSTER,RESPACES   SKIP IF NO TERRITORY CODE FOUND              
         BNH   ITERX                                                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF NOT SORTING BY NAME                       
         BE    *+10                                                             
         MVC   0(L'ITERSTER,R2),ITERSTER RETURN TERRITORY CODE                  
*                                                                               
         CLI   GLARGS+1,C'C'       DONE IF CODE ONLY NEEDED                     
         BE    ITERX                                                            
*                                                                               
         GOTO1 =A(SETREP)          FIND LOOK UP REP                             
*                                                                               
         LA    R1,L'ITERSTER(R2)   POINT TO LOOK UP CODE AREA                   
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   *+8                                                              
         LA    R1,10(R1)              BYPASS NAME AREA                          
*                                                                               
         MVC   0(L'RCONKREP,R1),REDMREP   SET REP CODE                          
         LA    R1,L'RCONKREP(R1)   BUMP TO NEXT AREA                            
*                                                                               
         MVC   0(L'ITERSTER,R1),ITERSTER   SET TER CODE                         
         LA    R1,L'ITERSTER(R1)   BUMP TO NEXT AREA                            
*                                                                               
         CLI   GLARGS+1,C'S'       IF SORTING BY NAME                           
         BNE   ITERNAMX                                                         
*                                                                               
         LA    R3,WORK             POINT TO A WORKAREA                          
*                                                                               
         GOTO1 =A(OID)             LOOK UP NAME IN TABLE                        
*                                                                               
         MVC   L'ITERSTER(10,R2),NAMEAREA   ADD NAME TO OUTPUT                  
*                                                                               
ITERNAMX DS    0H                                                               
*                                                                               
ITERX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
ITERSTER DS    XL(L'RTERKTER)      TERRIRTORY CODE SAVEAREA                     
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - INPUT - GRAND TOTAL - NOREPORT'                      
***********************************************************************         
*                                                                     *         
*        ROUTINE TO PUT OUT GRAND TOTAL LABEL                         *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
NOREPORT NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   LABLAREA,RESPACES   INIT LABEL AREA                              
         MVC   LABLAREA(6),=C'REPORT'                             L03           
*                                                                               
         GOTO1 GENOUTA             HANDLE TOTALS                                
*                                                                               
NOREPORX DS    0H                                                               
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - BUILD LABEL AREA - BLDLBL'                           
***********************************************************************         
*                                                                     *         
*        ROUTINE TO BUILD HEADER LABEL FROM HEADLINES                 *         
*                                                                     *         
*NTRY                                                                           
*                                                                     *         
*EXIT    LABLAREA HAS LABEL BUILT FROM COLUMN HEADINGS                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
BLDLBL   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
*        BUILD LABEL AREA FOR TOTALS AND HEADLINES                              
*                                                                               
         MVC   LABLAREA,BLSPACES   INIT OUTPUT AREAS                            
*                                                                               
*****    TM    GLINDS,GLTOTLIN     SKIP IF NOT DOING TOTALS                     
*****    BO    *+12                                                             
*****    CLI   MYPOSO,C'H'              OR HEADLINE                             
*****    BNE   BLDLBLX                                                          
*                                                                               
         L     R4,GLADTENT         DRIVE TABLE ENTRY                            
*                                                                               
         CLI   0(R4),X'30'         IF NOT AN OUTPUT ELEMENT                     
         BE    BLDLBL1                                                          
*                                                                               
*                                     WE HAVE TOTAL ELEMENT AND NEED TO         
*                                     FIND CORRESPONDING OUTPUT ELEMENT         
*                                     IT WILL BE BEFORE TOTAL ELEMENT           
*                                                                               
         L     R4,GLADTAB          POINT TO START OF DRIVE TABLE                
*                                                                               
         SR    R1,R1               INIT ELEMENT OUTPUT ELEMENT POINTER          
         SR    RF,RF                                                            
*                                                                               
BLDLBL1L DS    0H                                                               
*                                                                               
         CLI   0(R4),X'30'         LOOK FOR OUTPUT TABLE ENTRY                  
         BNE   *+6                                                              
         LR    R1,R4               SAVE ELEMENT ADDRESS                         
*                                                                               
BLDLBL1C DS    0H                                                               
*                                                                               
         IC    RF,1(R4)            LENGTH OF ENTRY                              
         LA    R4,0(RF,R4)         BUMP TO NEXT ENTRY                           
*                                                                               
         CLM   R4,15,GLADTENT      STOP WHEN CURRENT ENTRY REACHED              
         BL    BLDLBL1L                                                         
*                                                                               
         LTR   R4,R1               USE THIS FLD'S OUTPUT ELM                    
         BZ    BLDLBLX             EXIT IF NOT FOUND                            
*                                                                               
BLDLBL1  DS    0H                                                               
*                                                                               
         LA    R0,L'LABLAREA       LABEL AREA LENGTH                            
         LA    R1,LABLAREA         POINT TO LABEL AREA                          
         SR    RF,RF                                                            
*                                                                               
BLBLLP   DS    0H                                                               
*                                                                               
         USING DRHDD,R4            ESTABLISH AS HEAD ELEMENT                    
         IC    RF,DRHDELEN         RECORD ELEMENT LENGTH                        
         LA    R4,0(RF,R4)         BUMP TO NEXT DRIVER RECORD                   
*                                                                               
         CLI   DRHDEL,X'40'        LOOKING FOR HEAD ELEMENTS                    
         BNE   BLBLDN              END OF HEADS FOUND                           
*                                                                               
         IC    RF,DRHDELEN         RECORD ELEMENT LENGTH                        
         SH    RF,=Y(DRHDLIT-DRHDD)   HEAD LITERAL LENGTH                       
         BNP   BLBLCN              SKIP IF NO LITERAL AVAILABLE                 
*                                                                               
         LA    R2,DRHDLIT          POINT TO LITERAL                             
*                                                                               
         CLI   0(R2),C' '          ELIMINATE LEADING BLANKS                     
         BH    *+16                                                             
         LA    R2,1(R2)            BUMP TO NEXT CHARACTER                       
         BCT   RF,*-12                                                          
         B     BLBLCN              ALL BLANKS                                   
*                                                                               
*        R2==> START OF PARED DOWN HEAD, RF = LENGTH                            
*                                                                               
         SR    R0,RF               DECREMENT ROOM LEFT COUNTER                  
         BM    BLBLDN              STOP IF NO ROOM AVAILABLE                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),0(R2)       ADD HEAD LITERAL TO LABEL                    
*                                                                               
         LTR   R0,R0               STOP IF AT END OF LABEL AREA                 
         BNP   BLBLDN                                                           
*                                                                               
         LA    R1,1(RF,R1)         BUMP TO END OF LABEL                         
*                                                                               
         MVI   0(R1),C' '          SEPARATE PARTS WITH A SPACE                  
         LA    R1,1(R1)            BUMP TO NEXT AVAILABLE SPACE                 
*                                                                               
BLBLCN   DS    0H                                                               
*                                                                               
         B     BLBLLP                                                           
*                                                                               
BLBLDN   DS    0H                                                               
*                                                                               
BLDLBLX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
BLSPACES DC    CL32' '                                                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - COLFLTR'                            
***********************************************************************         
*                                                                     *         
*        COLUMN FILTER ROUTINES                                       *         
*                                                                     *         
*        COLFLTR   APPLY COLUMN FILTERS TO DATA                       *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
*        FILTERS ARE IN SAVEAREA BASED AT FLTTAB                      *         
*           EACH KEYWORD HAS 256 BYTES                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
COLFLTR  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         XC    RECFTRS(RECFTRSL),RECFTRS   INIT COLUMN FILTERS                  
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,GLARGS+6       GET KEYWORD NUMBER                           
         JZ    CFLKEEP             NONE GIVEN - KEEP RECORD                     
*                                                                               
         XC    CFLSWS(CFLSWSL),CFLSWS INIT SWITCHS                              
*                                                                               
         LA    RE,FLTAREAL         LENGTH OF FILTER SAVEAREA                    
         BCTR  RF,0                DECREMENMT FOR INDEXING                      
         MR    RE,RE               CALCULATE INDEX AMOUNT                       
*                                                                               
         L     R3,AFLTTAB          POINT TO FILTER SAVEAREAS                    
         LA    R3,0(RF,R3)         POINT TO THIS KEYWORD'S AREA                 
*                                                                               
         USING FLTAREA,R3          ESTABLISH FILTER SAVEAREA                    
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,FLTFNO         GET NUMBER OF FILTERS                        
         JZ    CFLKEEP             NONE GIVEN - KEEP RECORD                     
*                                                                               
         LA    R3,FLTCTL           POINT TO FIRST FILTER                        
*                                                                               
         USING FLTCTL,R3           ESTABLISH FILTER                             
*                                                                               
CFLLOOP  DS    0H                                                               
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLTYPE'                            
***********************************************************************         
*                                                                     *         
*        DETERMINE FILTER TYPE                                        *         
*                                                                     *         
*        NORMALLY FILTER INTERNAL CODE IS AT FLTFVAL AND              *         
*            FLTFTIC IS ALWAYS RKQWRCFL OR RKQWRCFM                   *         
*        IF THE FILTER CAN TAKE A VALUE LIKE ADV= THEN                *         
*            FLTFTIC HAS INTERNAL CODE FOR THE FILTER AND             *         
*            FLTFVAL HAS THE VALUE LIKE AN ADVERTISER CODE            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLTYPE  DS    0H                                                               
*                                                                               
*        FIRST CHECK IF IT IS A DATE FILTER                                     
*                                                                               
*        DATE FILTER IDS STORED IN TABLE CFTAB                                  
*                                                                               
         LA    R1,CFLTABN          NUMBER OF ENTRIES IN TABLE                   
         LA    R5,CFLTAB           POINT TO DATE TABLE                          
         USING CFTABD,R5           ESTABLISH TABLE ENTRY                        
*                                                                               
         CLC   CFTFLTID,FLTFTIC    MATCH ON FILTER ICODE                        
         JE    CFLDTE                                                           
         LA    R5,CFTABL(R5)       BUMP TO NEXT TABLE ENTRY                     
         BRCT  R1,*-14                                                          
*                                  NOT A DATE FILTER                            
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,3,FLTFTIC        GET FILTER TYPE                              
*                                                                               
         CHI   RF,RKQWRCFL         IF FILTER                                    
         JE    *+8                                                              
         CHI   RF,RKQWRCFM         OR FORMAT                                    
         BNE   *+8                                                              
         ICM   RF,3,FLTFVAL           USE FILTER VALUE FOR TESTING              
*                                                                               
*        DETERMINE FILTER                                                       
*                                                                               
         CHI   RF,RKQCFADV         ADVERTISER FILTER                            
         JE    CFLADV                                                           
*                                                                               
         CHI   RF,RKQCFAGY         AGENCY FILTER                                
         JE    CFLAGY                                                           
*                                                                               
         CHI   RF,RKQCFBST         BUDGET TYPE - STATION                        
         JE    CFLBST                                                           
*                                                                               
         CHI   RF,RKQCFCCD         CONTRACT CREATION DATE                       
         JE    CFLCCD                                                           
*                                                                               
         CHI   RF,RKQCFDAR         DARE FILTER                                  
         JE    CFLDARE                                                          
*                                                                               
         CHI   RF,RKQCFDNX         DARE WITHOUT EPORT/XML FILTER                
         JE    CFLDNOX                                                          
*                                                                               
         CHI   RF,RKQCFCTP         CONTRACT TYPE FILTER                         
         JE    CFLCTP                                                           
*                                                                               
         CHI   RF,RKQCFCF          CONFIRMED   DOLLARS FILTER                   
         JE    CFLCF                                                            
*                                                                               
         CHI   RF,RKQCFUC          UNCONFIRMED DOLLARS FILTER                   
         JE    CFLUC                                                            
*                                                                               
         CHI   RF,RKQCFMKT         MARKET  FILTER                               
         JE    CFLMKT                                                           
*                                                                               
         CHI   RF,RKQCFOFF         OFFICE FILTER                                
         JE    CFLOFF                                                           
*                                                                               
         CHI   RF,RKQCFOWN         OWNER  FILTER                                
         JE    CFLOWN                                                           
*                                                                               
         CHI   RF,RKQCFREG         REGION FILTER                                
         JE    CFLREG                                                           
*                                                                               
         CHI   RF,RKQCFPTP         POINT PERSON FILTER                          
         JE    CFLPTP                                                           
*                                                                               
         CHI   RF,RKQCFSAL         SALESPERSON FILTER                           
         JE    CFLSAL                                                           
*                                                                               
         CHI   RF,RKQCFSTA         STATION FILTER                               
         JE    CFLSTA                                                           
*                                                                               
         CHI   RF,RKQCFREP         REP FILTER                                   
         JE    CFLREP                                                           
*                                                                               
         CHI   RF,RKQCFGRP         GROUP FILTER                                 
         JE    CFLGRP                                                           
*                                                                               
         CHI   RF,RKQCFAFF         AFFILIATION FILTER                           
         JE    CFLAFF                                                           
*                                                                               
         CHI   RF,RKQCFDEM         TARGET DEMO FILTER                           
         JE    CFLDEM                                                           
*                                                                               
         CHI   RF,RKQCFTEM         DIVISION/TEAM FILTER                         
         JE    CFLTEM                                                           
*                                                                               
         CHI   RF,RKQCFFR          FORECAST ORDERS ONLY                         
         JE    CFLFR                                                            
*                                                                               
         CHI   RF,RKQCFXFR         EXCLUDE FORECAST ORDERS                      
         JE    CFLXFR                                                           
*                                                                               
*MNRCU                                                                          
         CHI   RF,RKQCRCU          SCRIPT UPLOAD CONTRACTS ONLY                 
         JE    CFLRCU                                                           
*                                                                               
         CHI   RF,RKQCXRCU         EXCLUDE SCRIPT UPLOAD CONTRACTS              
         JE    CFLXRCU                                                          
*MNRCU                                                                          
*MNRCU                                                                          
         CHI   RF,RKQCRCM          SCRIPT MANUAL CONTRACTS ONLY                 
         JE    CFLRCM                                                           
*                                                                               
         CHI   RF,RKQCXRCM         EXCLUDE SCRIPT MANUAL CONTRACTS              
         JE    CFLXRCM                                                          
*MNRCU                                                                          
         CHI   RF,RKQCFBKB         BACK BILLING OPTIONS                         
         JE    CFLBKB                                                           
*                                                                               
         J     CFLCONT             KEEP - NO KNOWN FILTER                       
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLDTE'                             
***********************************************************************         
*                                                                     *         
*        DATE FILTERS                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLDTE   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           POINT TO RECORD IN CORE                      
*                                                                               
         CLC   CFTRECID,RCONKTYP-RCONKEY(R4) IGNORE IF WRONG RECORD ID          
         JNE   CFLCONT                                                          
*                                                                               
*        DATES ARE AT FLTVAL - START AND END DATES, 3 BYTES BINARY              
*                                                                               
CFLDTES  DS    0H                                                               
*                                                                               
*        FIND APPROPRIATE ELEMENT IN RECORD                                     
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
*                                                                               
         CLI   CFTELMID,0          IF NO ELEMENT ID GIVEN                       
         JE    CFLDTFD                THE DATA IS IN THE KEY                    
*                                                                               
         SR    RF,RF                                                            
         LA    R6,33(R6)           POINT TO FIRST ELEMENT                       
*                                                                               
         CLI   0(R6),0             DROP IF END OF RECORD REACHED                
         JE    CFLDROP                                                          
         CLC   CFTELMID,0(R6)      MATCH ON ELEMENT ID                          
         JE    CFLDTFD                                                          
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         BUMP TO NEXT ELEMENT                         
         J     *-26                                                             
*                                                                               
*        CORRECT ELEMENT FOUND                                                  
*                                                                               
CFLDTFD  DS    0H                                                               
*                                                                               
         SR    R1,R1                                                            
         IC    R1,CFTDISP          POINT TO DATE                                
         LA    R1,0(R1,R6)                                                      
*                                                                               
*        MATCH DATE TO PERIOD IN FILTER                                         
*                                                                               
         TM    FLTCTL,FLTEQQ       SKIP IF NOT TO LIE IN RANGE                  
         JNO   CFLDTEQN                                                         
*                                                                               
         CLC   0(3,R1),FLTFVAL     MUST BE ON OR AFTER START DATE               
         JL    CFLDROP                                                          
*                                                                               
         CLI   FLTFVLEN,6          IF NO END DATE                               
         JL    *+14                                                             
         OC    FLTFVAL+3(3),FLTFVAL+3                                           
         JNZ   CFLDTEQ5                                                         
*                                                                               
         CLC   0(3,R1),FLTFVAL        MUST MATCH START DATE                     
         JNE   CFLDROP                                                          
         J     CFLDTESX                                                         
*                                                                               
CFLDTEQ5 DS    0H                                                               
*                                                                               
         CLC   0(3,R1),FLTFVAL+3   ELSE MUST BE ON OR BEFORE END DATE           
         JH    CFLDROP                                                          
         J     CFLDTESX                                                         
*                                                                               
CFLDTEQN DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTLTQ       SKIP IF NOT TO LIE BEFORE RANGE              
         JNO   CFLDTLTN                                                         
*                                                                               
         CLC   0(3,R1),FLTFVAL     MUST BE BEFORE START DATE                    
         JNL   CFLDROP                                                          
*                                                                               
         J     CFLDTESX                                                         
*                                                                               
CFLDTLTN DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTGTQ       SKIP IF NOT AFTER RANGE                      
         JNO   CFLDTGTN                                                         
*                                                                               
         CLI   FLTFVLEN,6          IF NO END DATE                               
         JL    *+14                                                             
         OC    FLTFVAL+3(3),FLTFVAL+3                                           
         JNZ   CFLDTGT5                                                         
*                                                                               
         CLC   0(3,R1),FLTFVAL        MUST BE AFTER START DATE                  
         JNH   CFLDROP                                                          
         J     CFLDTESX                                                         
*                                                                               
CFLDTGT5 DS    0H                                                               
*                                                                               
         CLC   0(3,R1),FLTFVAL+3   ELSE MUST BE AFTER END DATE                  
         JNH   CFLDROP                                                          
         J     CFLDTESX                                                         
*                                                                               
CFLDTGTN DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTNOTQ      IF TO LIE OUTSIDE  RANGE                     
         JNO   CFLDTNEN                                                         
*                                                                               
         CLC   0(3,R1),FLTFVAL        MUST BE BEFORE START DATE                 
         JL    CFLDTESX                                                         
*                                                                               
         CLI   FLTFVLEN,6          IF NO END DATE                               
         JL    *+14                                                             
         OC    FLTFVAL+3(3),FLTFVAL+3                                           
         JNZ   CFLDTNE5                                                         
*                                                                               
         CLC   0(3,R1),FLTFVAL        MUST BE AFTER START DATE                  
         JNH   CFLDROP                                                          
         J     CFLDTESX                                                         
*                                                                               
CFLDTNE5 DS    0H                                                               
*                                                                               
         CLC   0(3,R1),FLTFVAL+3      ELSE AFTER END DATE                       
         JNH   CFLDROP                                                          
         J     CFLDTESX                                                         
*                                                                               
CFLDTNEN DS    0H                                                               
*                                                                               
CFLDTESX DS    0H                                                               
*                                                                               
         J     CFLCONT                                                          
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLDARE'                            
***********************************************************************         
*                                                                     *         
*        DARE ONLY CONTRACTS / EXCLUDE DARE CONTRACTS                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLDARE  DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         SR    RF,RF                                                            
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT                       
         USING RCONDREL,R6         ESTABLISH AS DARE ORDER ELEMENT              
*                                                                               
         CLI   RCONDRCD,0          DONE AT END OF RECORD                        
         JE    CFLDARNF                                                         
         CLI   RCONDRCD,X'1D'      FIND DARE ORDER ELEMENT                      
         JE    *+16                                                             
         IC    RF,RCONDRLN         GET ELEMENT LENGTH                           
         LA    R6,RCONDREL(RF)     BUMP TO NEXT ELEMENT                         
         J     *-24                                                             
*                                                                               
*                                  DARE ELEMENT FOUND                           
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF DARE CONTRACTS ONLY                       
         JE    CFLDAREX               KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
CFLDARNF DS    0H                  NOT DARE CONTRACT                            
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF DARE CONTRACTS ONLY                       
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLDAREX DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLDNOX'                            
***********************************************************************         
*                                                                     *         
*        DARE ONLY CONTRACTS / EXCLUDE DARE CONTRACTS                 *         
*        EXCLUDES XML/EPORT ORDERS                                    *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLDNOX  DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         SR    RF,RF                                                            
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT                       
         USING RCONDREL,R6         ESTABLISH AS DARE ORDER ELEMENT              
*                                                                               
         CLI   RCONDRCD,0          DONE AT END OF RECORD                        
         JE    CFLDNXNF                                                         
         CLI   RCONDRCD,X'1D'      FIND DARE ORDER ELEMENT                      
         JE    *+16                                                             
         IC    RF,RCONDRLN         GET ELEMENT LENGTH                           
         LA    R6,RCONDREL(RF)     BUMP TO NEXT ELEMENT                         
         J     *-24                                                             
*                                                                               
*                                  DARE ELEMENT FOUND                           
*                                                                               
CFLDNX10 DS    0H                                                               
         CLI   FLTCTL,FLTEQQ       IF DARE CONTRACTS ONLY                       
         JNE   CFLDROP             DROP IF NOT A DARE CONTRACT                  
         TM    RCONDRF2,X'01'      IF DARE BUT XML                              
         JO    CFLDROP             ALSO DROP                                    
         J     CFLDNXEX                                                         
*                                                                               
CFLDNXNF DS    0H                  NOT DARE CONTRACT                            
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF DARE CONTRACTS ONLY                       
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLDNXEX DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLCTP'                             
***********************************************************************         
*                                                                     *         
*        CONTRACT TYPE FILTERING                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLCTP   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   IF CONTRACT RECORD                           
         JNE   CFLCTPCN                                                         
*                                                                               
         CLC   RCONTYPE,FLTFVAL       CHECK FOR CORRECT CONTRACT TYPE           
         JE    CFLCTPFD                  YES                                    
         J     CFLCTPNF                  NO                                     
*                                                                               
CFLCTPCN DS    0H                                                               
*                                                                               
         L     R4,REANWMON         POINT TO BUDGET DOLLARS TABLE                
         USING BDMNTABD,R4         ESTABLISH MONTH TABLE AREA                   
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**'  SKIP IF NOT BUDGET TABLE            
         BNE   CFLCTPBN                                                         
*                                                                               
         CLC   BDMTCTP,FLTFVAL     IF MATCH ON CONTRACT TYPE                    
         JE    CFLCTPFD                                                         
         J     CFLCTPNF            ELSE NOT FOUND                               
*                                                                               
CFLCTPBN DS    0H                                                               
*                                                                               
         J     CFLCTPNF            UNRECOGNIZED SITUATION                       
*                                                                               
*        CONTRACT TYPE MATCH                                                    
*                                                                               
CFLCTPFD DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF CONTRACT TYPE ONLY                        
         JE    CFLCTPX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        CONTRACT TYPE NOT MATCHED                                              
*                                                                               
CFLCTPNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF CONTRACT TYPE ONLY                        
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLCTPX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLCF'                              
***********************************************************************         
*                                                                     *         
*        CONFIRMED DOLLARS                                            *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLCF    DS    0H                                                               
*                                                                               
         L     RF,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,RF         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         JZ    CFLCFX                                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IF CONFIRMED DOLLARS                         
         JNO   CFLCF10                                                          
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF CONFIRMED ONLY                            
         JE    CFLCFX                 KEEP                                      
*                                                                               
         J     CFLDROP             ELSE KEEP FOR REPORT                         
*                                                                               
CFLCF10  DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF CONFIRMED ONLY                            
         JE    CFLDROP                DROP FROM REPORT                          
*                                                                               
         J     CFLCFX                 KEEP                                      
*                                                                               
CFLCFX   DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLUC'                              
***********************************************************************         
*                                                                     *         
*        UNCONFIRMED DOLLARS                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLUC    DS    0H                                                               
*                                                                               
         L     RF,REANWMON         POINT TO CONTRACT DOLLARS TABLE              
         USING NWMNTABD,RF         ESTABLISH NEW MONTH TABLE AREA               
*                                                                               
         ICM   RF,15,NWMTCSPA      POINT TO CONTRACT DATA                       
         JZ    CFLUCX                                                           
*                                                                               
         DROP  RF                                                               
*                                                                               
         TM    CSFRMISC(RF),X'20'  IF UNCONFIRMED DOLLARS                       
         JO    CFLUC10                                                          
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF UNCONFIRMED ONLY                          
         JE    CFLUCX                 KEEP                                      
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
CFLUC10  DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF UNCONFIRMED ONLY                          
         JE    CFLDROP                DROP FROM REPORT                          
*                                                                               
*                                     KEEP                                      
*                                                                               
CFLUCX   DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLADV'                             
***********************************************************************         
*                                                                     *         
*        ADVERTISER                                                   *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLADV   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         CLC   RCONKADV,FLTFVAL    CHECK FOR CORRECT ADVERTISER                 
         JNE   CFLADVNF                                                         
*                                                                               
*        ADVERTISER MATCH                                                       
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF ADVERTISER ONLY                           
         JE    CFLADVX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        ADVERTISER NOT MATCHED                                                 
*                                                                               
CFLADVNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF ADVERTISER ONLY                           
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLADVX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLAGY'                             
***********************************************************************         
*                                                                     *         
*        AGENCY                                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLAGY   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         SR    RF,RF               LENGTH OF FILTER DETERMINES                  
         ICM   RF,1,FLTFVLEN         IF OFFICE INCLUDED                         
         JZ    CFLAGYX               NO CODE                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         BASR  RE,0                                                             
         EX    RF,8(RE)                                                         
         J     *+10                                                             
         CLC   RCONKAGY(0),FLTFVAL    CHECK FOR CORRECT AGENCY                  
         JNE   CFLAGYNF                                                         
*                                                                               
*        AGENCY MATCH                                                           
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF AGENCY ONLY                               
         JE    CFLAGYX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        AGENCY NOT MATCHED                                                     
*                                                                               
CFLAGYNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF AGENCY ONLY                               
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLAGYX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLBST'                             
***********************************************************************         
*                                                                     *         
*        STATION BUDGET TYPE                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLBST   DS    0H                                                               
*                                                                               
         L     R4,REANWMON         POINT TO BUDGET DOLLARS TABLE                
         USING BDMNTABD,R4         ESTABLISH MONTH TABLE AREA                   
*                                                                               
         CLC   BDMTLBL,=CL12'*BUDMONTAB**'  SKIP IF NOT BUDGET TABLE            
         BNE   CFLBSTX                                                          
*                                                                               
         MVC   HALF(1),BDMTSBTP    COPY BUDGET TYPE INDICATORS                  
         XC    HALF(1),FLTFVAL     TEST IF WANTED BUDGET                        
         BNZ   CFLBSTNF            NO                                           
*                                                                               
*        BUDGET TYPE MATCH MATCH                                                
*                                                                               
CFLBSTFD DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLBSTX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        AGENCY NOT MATCHED                                                     
*                                                                               
CFLBSTNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLBSTX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLAGY'                             
***********************************************************************         
*                                                                     *         
*        CONTRACT CREATION DATE                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLCCD   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT A CONTRACT RECORD INCORE         
         JNE   CFLCCDX                                                          
*                                                                               
*        CONTRACT CREATION MUST LIE BETWEEN FILTER DATES                        
*                                                                               
         CLC   RCONHDRD,FLTFVAL    MUST BE AFTER START DATE                     
         JL    CFLDROP                                                          
*                                                                               
         OC    FLTFVAL+3(3),FLTFVAL+3 OKAY IF NO END DATE                       
         JZ    CFLCCDX                                                          
*                                                                               
         CLC   RCONHDRD,FLTFVAL+3  MUST BE BEFORE END DATE                      
         JNL   CFLDROP                                                          
*                                                                               
CFLCCDX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLMKT'                             
***********************************************************************         
*                                                                     *         
*        MARKET                                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLMKT   DS    0H                                                               
*                                                                               
         L     R4,REAIO3           ESTABLISH STATION RECORD                     
         USING RSTAREC,R4                                                       
*                                                                               
         SR    RF,RF                                                            
         LA    R6,RSTAELEM         POINT TO FIRST ELEMENT                       
         USING RSTAXXEL,R6         ESTABLISH AS EXTRA DESC ELEMENT              
*                                                                               
         CLI   RSTAXXEL,0          DONE AT END OF RECORD                        
         JE    CFLMKTNF                                                         
         CLI   RSTAXXEL,X'08'      FIND EXTRA DESC ELEMENT                      
         JE    *+16                                                             
         IC    RF,RSTAXXEL+1       GET ELEMENT LENGTH                           
         LA    R6,RSTAXXEL(RF)     BUMP TO NEXT ELEMENT                         
         J     *-24                                                             
*                                                                               
         CLC   RSTAMKTC,FLTFVAL    CHECK FOR CORRECT MARKET                     
         JNE   CFLMKTNF                                                         
*                                                                               
*        MARKET MATCH                                                           
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MARKET ONLY                               
         JE    CFLMKTX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        MARKET NOT MATCHED                                                     
*                                                                               
CFLMKTNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MARKET ONLY                               
         JE    CFLDROP                DROP                                      
*                                                                               
         J     CFLMKTX             ELSE KEEP FOR REPORT                         
*                                                                               
CFLMKTX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLOFF'                             
***********************************************************************         
*                                                                     *         
*        OFFICE                                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLOFF   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   IF CONTRACT RECORD                           
         BNE   CFLOFFCN                                                         
*                                                                               
         CLC   RCONKOFF,FLTFVAL       CHECK FOR CORRECT OFFICE                  
         JNE   CFLOFFNF                  NO                                     
         J     CFLOFFFD                  YES                                    
*                                                                               
CFLOFFCN DS    0H                                                               
*                                                                               
         CLI   RCONKTYP,RBUDKTYQ   IF STATION BUDGET RECORD                     
         JNE   CFLOFFBN                                                         
*                                                                               
         USING RBUDREC,R4             ESTABLISH STATION BUDGET RECORD           
*                                                                               
         CLC   RBUDKTEM,FLTFVAL       CHECK IF DESIRED OFFICE                   
         JNE   CFLOFFNF                  NO                                     
         J     CFLOFFFD                  YES                                    
*                                                                               
CFLOFFBN DS    0H                                                               
         J     CFLOFFNF            UNKNOWN RECORD TYPE                          
*                                                                               
*        OFFICE MATCH                                                           
*                                                                               
CFLOFFFD DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF OFFICE ONLY                               
         JE    CFLOFFX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        OFFICE NOT MATCHED                                                     
*                                                                               
CFLOFFNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF OFFICE ONLY                               
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLOFFX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLOWN'                             
***********************************************************************         
*                                                                     *         
*        OWNER                                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLOWN   DS    0H                                                               
*                                                                               
         L     R4,REAIO3           ESTABLISH STATION RECORD                     
         USING RSTAREC,R4                                                       
*                                                                               
         CLC   RSTAOWN,FLTFVAL     CHECK FOR CORRECT OWNER                      
         JNE   CFLOWNNF                                                         
*                                                                               
*        OWNER MATCH                                                            
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF OWNER ONLY                                
         JE    CFLOWNX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        OWNER NOT MATCHED                                                      
*                                                                               
CFLOWNNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF OWNER ONLY                                
         JE    CFLDROP                DROP                                      
*                                                                               
         J     CFLOWNX             ELSE KEEP FOR REPORT                         
*                                                                               
CFLOWNX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLREG'                             
***********************************************************************         
*                                                                     *         
*        REGION                                                       *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLREG   DS    0H                                                               
*                                                                               
         ICM   R4,15,REOFFTA       POINT TO CURRENT ENTRY IN OFFICE TAB         
         JZ    CFLREGX                                                          
*                                                                               
         USING OFFTTAB,R4          ESTABLISH TABLE ENTRY                        
*                                                                               
         LA    R6,OFFTELM          POINT TO OFFICE ELEMENT                      
         USING ROFFELEM,R6         ESTABLISH OFFICE DESCRIPTION ELEMENT         
*                                                                               
         CLC   ROFFREG,FLTFVAL     CHECK FOR CORRECT REGION                     
         JNE   CFLREGNF                                                         
*                                                                               
*        REGION MATCH                                                           
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF REGION ONLY                               
         JE    CFLREGX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        REGION NOT MATCHED                                                     
*                                                                               
CFLREGNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF REGION ONLY                               
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLREGX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLPTP'                             
***********************************************************************         
*                                                                     *         
*        POINT PERSON                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLPTP   DS    0H                                                               
*                                                                               
         CLC   REPRD,RESPACES      DROP IF NO PRODUCT                           
         JNH   CFLPTPNF                                                         
*                                                                               
         ICM   R4,15,REPRDTA       POINT TO ENTRY IN PRODUCT TABLE              
         JZ    CFLPTPNF            DROP IF NOT AVAILABLE                        
*                                                                               
         USING PRDTENT,R4          ESTABLISH PRODUCT TABLE ENTRY                
*                                                                               
         SR    RF,RF                                                            
         LA    R6,PRDTELM          ESTABLISH PRODUCT DESCRIPTION                
*                                                                               
*        FIND NETWORK CONTRACT ELEMENT                                          
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         JE    CFLPTPNF               DROP IF NO ELEMENT                        
         CLI   0(R6),X'02'         FIND NETWORK CONTRACT ELEMENT                
         JE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         J     *-24                                                             
*                                                                               
         USING RPRDNELM,R6         ESTABLISH NETWORK CONTRACT ELEMENT           
*                                                                               
         CLC   RPRDNPNT,RESPACES   DROP IF NO POINT PERSON                      
         JNH   CFLPTPNF                                                         
*                                                                               
         CLC   RPRDNPNT,FLTFVAL     CHECK FOR CORRECT POINT PERSON              
         JNE   CFLPTPNF                                                         
*                                                                               
*        POINT PERSON MATCH                                                     
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF POINT PERSON ONLY                         
         JE    CFLPTPX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        POINT PERSON NOT MATCHED                                               
*                                                                               
CFLPTPNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF POINT PERSON ONLY                         
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLPTPX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLSAL'                             
***********************************************************************         
*                                                                     *         
*        SALESPERSON FILTERING                                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLSAL   DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLSALX                                                          
*                                                                               
*        EXTRACT SALESPERSON'S CODE FROM CONTRACT                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         CLC   RCONSAL,FLTFVAL     CHECK FOR CORRECT SALESPERSON                
         JNE   CFLSALNF                                                         
*                                                                               
*        SALESPERSON MATCH                                                      
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF SALESPERSON ONLY                          
         JE    CFLSALX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        SALESPERSON NOT MATCHED                                                
*                                                                               
CFLSALNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF SALESPERSON ONLY                          
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLSALX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         DROP  R6                                                               
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLDEM'                             
***********************************************************************         
*                                                                     *         
*        TARGET DEMO                                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLDEM   DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLDEMX                                                          
*                                                                               
*        EXTRACT TARGET DEMO FROM CONTRACT                                      
*                                                                               
*        FIND SAR OR BOP ELEMENT                                                
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             NOT FOUND AT END OF RECORD                   
         JE    CFLDEMNF                                                         
         CLI   0(R6),X'10'         WANT SAR OR BOP ELEMENT                      
         JE    *+8                                                              
         CLI   0(R6),X'12'                                                      
         JE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)                                                      
         J     *-32                                                             
*                                                                               
         LA    RF,RSARDEM-RSAREL(R6) ASSUME SAR ELEMENT                         
         LA    RE,8                  MAX 8 DEMOS                                
*                                                                               
         CLI   0(R6),X'10'         IF BOP ELEMENT                               
         JNE   CFLDEMPX                                                         
*                                                                               
         LA    RF,RCONBPDM-RCONBPEL(R6)    SWITCH POINTER                       
*                                                                               
         CLI   0(RF),X'FF'            NOT FOUND IF NOT VALIDATED                
         JNE   CFLDEMNF               BY DEMOVAL                                
*                                                                               
         LA    RF,1(RF)               POINT TO DEMOS                            
         LA    RE,6                   MAX 6 DEMOS                               
*                                                                               
CFLDEMPX DS    0H                                                               
*                                                                               
*        PRINT PRIMARY DEMO OR FIRST IN LIST BY DEFAULT                         
*                                                                               
         LR    R5,RF               DEFAULT TO FIRST DEMO                        
*                                                                               
         LR    RF,R5               POINT TO FIRST DEMO IN LIST                  
*                                                                               
CFLDEMDL DS    0H                                                               
*                                                                               
         OC    0(3,RF),0(RF)       DONE AT END OF DEMO LIST                     
         JE    CFLDEMDD                                                         
*                                                                               
         TM    0(RF),X'40'         IF PRIMARY POINTER                           
         JNO   CFLDEMDC                                                         
*                                                                               
         LR    R5,RF                  SET TO PRINT PRIMARY DEMO                 
         J     CFLDEMDD               DONE                                      
*                                                                               
CFLDEMDC DS    0H                                                               
*                                                                               
         LA    RF,3(RF)            BUMP TO NEXT DEMO                            
         BRCT  RE,CFLDEMDL                                                      
*                                                                               
CFLDEMDD DS    0H                                                               
*                                                                               
         OC    0(3,R5),0(R5)       SKIP IF NO DEMO                              
         JZ    CFLDEMNF                                                         
*                                                                               
         MVC   FULL(3),0(R5)       COPY DEMO                                    
         NI    FULL,X'FF'-X'40'    KILL PRIMARY DEMO INDICATOR                  
*                                                                               
         CLC   FULL(3),FLTFVAL     CHECK IF DESIRED DEMO                        
         JNE   CFLDEMNF                                                         
*                                                                               
*        MATCH                                                                  
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLDEMX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        NOT MATCHED                                                            
*                                                                               
CFLDEMNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLDEMX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLSTA'                             
***********************************************************************         
*                                                                     *         
*        STATION                                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLSTA   DS    0H                                                               
*                                                                               
         L     R4,REAIO3           ESTABLISH STATION RECORD                     
         USING RSTAREC,R4                                                       
*                                                                               
         CLC   RSTAKSTA,FLTFVAL    CHECK FOR CORRECT STATION                    
         JNE   CFLSTANF                                                         
*                                                                               
*        STATION MATCH                                                          
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF STATION ONLY                              
         JE    CFLSTAX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        STATION NOT MATCHED                                                    
*                                                                               
CFLSTANF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF STATION ONLY                              
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLSTAX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLGRP'                             
***********************************************************************         
*                                                                     *         
*        GROUP/SUBGROUP                                               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLGRP   DS    0H                                                               
*                                                                               
         CLC   REGRP(1),FLTFVAL    CHECK FOR CORRECT GROUP                      
         JNE   CFLGRPNF                                                         
*                                                                               
         CLI   FLTFVAL+1,C' '      CHECK FOR SUB-GROUP FILTER                   
         JNH   *+14                                                             
         CLC   REGRP(2),FLTFVAL    CHECK FOR CORRECT GROUP/SUBGROUP             
         JNE   CFLGRPNF                                                         
*                                                                               
*        MATCH                                                                  
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCHED ONLY                              
         JE    CFLGRPX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        NOT MATCHED                                                            
*                                                                               
CFLGRPNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCHED ONLY                              
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLGRPX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLAFF'                             
***********************************************************************         
*                                                                     *         
*        AFFILIATION                                                  *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLAFF   DS    0H                                                               
*                                                                               
         L     R4,REAIO3           ESTABLISH STATION RECORD                     
         USING RSTAREC,R4                                                       
*                                                                               
         CLC   RSTAAFFL,FLTFVAL    CHECK FOR CORRECT AFFILIATION                
         JNE   CFLAFFNF                                                         
*                                                                               
*        MATCH                                                                  
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF AFF ONLY                                  
         JE    CFLAFFX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        NOT MATCHED                                                            
*                                                                               
CFLAFFNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF AFF ONLY                                  
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLAFFX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLREP'                             
***********************************************************************         
*                                                                     *         
*        REP                                                          *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLREP   DS    0H                                                               
*                                                                               
         CLC   REREP,FLTFVAL       CHECK FOR CORRECT REP                        
         JNE   CFLREPNF                                                         
*                                                                               
*        REP MATCH                                                              
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF REP ONLY                                  
         JE    CFLREPX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        REP NOT MATCHED                                                        
*                                                                               
CFLREPNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF REP ONLY                                  
         JE    CFLDROP                DROP                                      
*                                                                               
*        J     CFLREPX             ELSE KEEP FOR REPORT                         
*                                                                               
CFLREPX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLREM'                             
***********************************************************************         
*                                                                     *         
*        DIVISION/TEAM                                                *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLTEM   DS    0H                                                               
*                                                                               
         XC    CFLTEMSV,CFLTEMSV   INIT TEAM SAVEAREA                           
*                                                                               
         CLI   FLAVOR,C'R'         SKIP IF NOT RGON REPORT                      
         JNE   CFLTEMRN                                                         
*                                                                               
         LA    R4,RERRGWRC         POINT TO RRGWRI CONTROL BLOCK                
         USING RRGWRI,R4                                                        
*                                                                               
         LA    R0,8                MAX 8 DATATYPES                              
         LA    R1,RRGWDAT1         FIRST RETURNED DATA                          
         LA    RE,RRGWDT1          START OF DATATYPES                           
*                                                                               
         CLC   GLARGS(1),0(RE)     MATCH DATATYPE                               
         JE    *+20                                                             
         LA    RE,L'RRGWDT1+L'RRGWDA1(RE) NEXT DATATYPE                         
         LA    R1,L'RRGWDAT1(R1)   NEXT RETURNED DATA                           
         BRCT  R0,*-18                                                          
         J     CFLTEMNF            NO DATA TYPE MATCH                           
*                                                                               
         MVC   CFLTEMSV,0(R1)      SAVE TEAM                                    
*                                                                               
         J     CFLTEMFD            TEAM CODE FOUND                              
*                                                                               
CFLTEMRN DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLTEMNF                                                         
*                                                                               
*        EXTRACT DIV/TEAM'S CODE FROM CONTRACT                                  
*                                                                               
CFLTEMC  DS    0H                                                               
*                                                                               
*        FIND CONTRACT DESCRIPTION ELEMENT                                      
*                                                                               
         LA    R6,RCONELEM         POINT TO FIRST ELEMENT IN RECORD             
         SR    RF,RF                                                            
*                                                                               
         CLI   0(R6),0             CHECK FOR END OF RECORD                      
         JE    ITEMCCDN               NO CODE                                   
         CLI   0(R6),X'01'         FIND CONTRACT DESC. ELEMENT                  
         JE    *+16                                                             
         IC    RF,1(R6)                                                         
         LA    R6,0(RF,R6)         NEXT ELEMENT                                 
         J     *-24                                                             
*                                                                               
         USING RCONELEM,R6         ESTABLISH CONTRACT DESC. ELEMENT             
*                                                                               
         MVC   CFLTEMSV,RCONTEM    SAVE TEAM CODE                               
*                                                                               
CFLTEMFD DS    0H                                                               
*                                                                               
         CLC   CFLTEMSV,RESPACES   SKIP IF NO DIV/TEAM CODE FOUND               
         JNH   CFLTEMNF                                                         
*                                                                               
         CLC   CFLTEMSV(1),FLTFVAL    CHECK FOR CORRECT DIV                     
         JNE   CFLTEMNF                                                         
*                                                                               
         CLI   FLTFVAL+1,C' '       SKIP IF NO TEAM FILTER                      
         JNH   *+14                                                             
         CLC   CFLTEMSV(2),FLTFVAL    CHECK FOR CORRECT DIV/TEAM                
         JNE   CFLTEMNF                                                         
*                                                                               
*        MATCH                                                                  
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLTEMX                KEEP FOR REPORT                           
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
*        NOT MATCHED                                                            
*                                                                               
CFLTEMNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLDROP                DROP                                      
*                                                                               
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLTEMX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
CFLTEMSV DS    XL(L'RCONTEM)       TEAM CODE SAVEAREA                           
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLXFR'                             
***********************************************************************         
*                                                                     *         
*        FORECAST ORDERS ONLY                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLFR    DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLFRX                                                           
*                                                                               
*        FIND SAR ELEMENT                                                       
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
         SR    RF,RF                                                            
*                                                                               
         MVI   ELCODE,X'12'        SAR ELEMENT ID                               
         BRAS  RE,GETEL                                                         
         JNE   CFLFRNF             ELEMENT NOT FOUND                            
*                                                                               
         USING RSARXEL,R6          ESTABLISH AS EXTENDED SAR ELEMENT            
*                                                                               
         CLI   RSARXLEN,RSARXLTH   NOT FOUND IF NOT NEW LENGTH                  
         BL    CFLFRNF                                                          
*                                                                               
         TM    RSARXFLG,X'10'      CHECK FOR FORECAST ORDER                     
         BNO   CFLFRNF                                                          
*                                                                               
*        MATCH                                                                  
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLFRX                 KEEP CONTRACT                             
*                                                                               
         J     CFLDROP             ELSE DROP CONTRACT                           
*                                                                               
*        NOT MATCHED                                                            
*                                                                               
CFLFRNF DS     0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLDROP                DROP RECORD                               
*                                                                               
         J     CFLFRX              ELSE KEEP                                    
*                                                                               
CFLFRX   DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLXFR'                             
***********************************************************************         
*                                                                     *         
*        EXCLUDE FORECAST ORDERS                                      *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLXFR   DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLXFRX                                                          
*                                                                               
*        FIND SAR ELEMENT                                                       
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
         SR    RF,RF                                                            
*                                                                               
         MVI   ELCODE,X'12'        SAR ELEMENT ID                               
         BRAS  RE,GETEL                                                         
         JNE   CFLXFRNF            ELEMENT NOT FOUND                            
*                                                                               
         USING RSARXEL,R6          ESTABLISH AS EXTENDED SAR ELEMENT            
*                                                                               
         CLI   RSARXLEN,RSARXLTH   NOT FOUND IF NOT NEW LENGTH                  
         BL    CFLXFRNF                                                         
*                                                                               
         TM    RSARXFLG,X'10'      CHECK FOR FORECAST ORDER                     
         BNO   CFLXFRNF                                                         
*                                                                               
*        MATCH                                                                  
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLDROP                DROP CONTRACT                             
*                                                                               
         J     CFLXFRX             ELSE KEEP CONTRACT                           
*                                                                               
*        NOT MATCHED                                                            
*                                                                               
CFLXFRNF DS    0H                                                               
*                                                                               
         CLI   FLTCTL,FLTEQQ       IF MATCH ONLY                                
         JE    CFLXFRX                KEEP RECORD                               
*                                                                               
         J     CFLDROP             ELSE DROP                                    
*                                                                               
CFLXFRX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
*MNRCU                                                                          
         TITLE 'RENWRTER - COLUMN FILTERS - CFLRCU'                             
***********************************************************************         
*                                                                     *         
*        SCRIPT UPLOAD CONTRACTS ONLY                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLRCU   DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLRCX                                                           
*                                                                               
*        FIND SCRIPT CONTRACT UPLOAD ELEMENT                                    
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
         SR    RF,RF                                                            
*                                                                               
         MVI   ELCODE,X'3C'        SAR ELEMENT ID                               
         BRAS  RE,GETEL                                                         
         JNE   CFLDROP             ELEMENT NOT FOUND                            
*                                                                               
CFLRCX   DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLXRCU'                            
***********************************************************************         
*                                                                     *         
*        EXCLUDE SCRIPT UPLOAD CONTRACTS                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLXRCU  DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLXRCX                                                          
*                                                                               
*        FIND SCRIPT CONTRACT UPLOAD ELEMENT                                    
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
         SR    RF,RF                                                            
*                                                                               
         MVI   ELCODE,X'3C'        SAR ELEMENT ID                               
         BRAS  RE,GETEL                                                         
         JE    CFLDROP                                                          
*                                                                               
CFLXRCX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
*MNRCU                                                                          
*MNRCU                                                                          
         TITLE 'RENWRTER - COLUMN FILTERS - CFLRCM'                             
***********************************************************************         
*                                                                     *         
*        SCRIPT MANUAL CONTRACTS ONLY                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLRCM   DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLRMX                                                           
*                                                                               
*        FIND SCRIPT CONTRACT UPLOAD ELEMENT                                    
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
         SR    RF,RF                                                            
*                                                                               
         MVI   ELCODE,X'3C'        SAR ELEMENT ID                               
         BRAS  RE,GETEL                                                         
         JNE   CFLDROP             ELEMENT NOT FOUND                            
*                                                                               
         USING RCONCUEL,R6                                                      
         OC    RCONCUMD,RCONCUMD                                                
         BZ    CFLDROP                                                          
         DROP  R6                                                               
*                                                                               
CFLRMX   DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLXRCM'                            
***********************************************************************         
*                                                                     *         
*        EXCLUDE SCRIPT MANUAL CONTRACTS                              *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLXRCM  DS    0H                                                               
*                                                                               
         L     R4,REAIO1                                                        
         USING RCONREC,R4          ESTABLISH CONTRACT RECORD                    
*                                                                               
         CLI   RCONKTYP,RCONKTYQ   SKIP IF NOT CONTRACT RECORD                  
         JNE   CFLXRMX                                                          
*                                                                               
*        FIND SCRIPT CONTRACT UPLOAD ELEMENT                                    
*                                                                               
         LR    R6,R4               POINT TO START OF RECORD                     
         SR    RF,RF                                                            
*                                                                               
         MVI   ELCODE,X'3C'        SAR ELEMENT ID                               
         BRAS  RE,GETEL                                                         
         JNE   CFLCONT                                                          
*                                                                               
         USING RCONCUEL,R6                                                      
         OC    RCONCUMD,RCONCUMD                                                
         BNZ   CFLDROP                                                          
         DROP  R6                                                               
*                                                                               
CFLXRMX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
*MNRCU                                                                          
         TITLE 'RENWRTER - COLUMN FILTERS - CFLBKB'                             
***********************************************************************         
*                                                                     *         
*        BACK BILLING OPTIONS                                         *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLBKB   DS    0H                                                               
*                                                                               
         L     R4,REAIO1           ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         CLC   =C'ACC-BB',RCONBUYR IF BACK BILLING CONTRACT                     
         BNE   CFLBKBNF                                                         
*                                                                               
         CLI   FLTFVAL+1,C'X'      DROP IF EXCLUDING BACK BILLING               
         BE    CFLDROP                                                          
*                                                                               
         B     CFLBKBX             ELSE KEEP                                    
*                                                                               
CFLBKBNF DS    0H                                                               
*                                                                               
         CLI   FLTFVAL+1,C'O'      DROP IF BACK BILLING ONLY                    
         BE    CFLDROP                                                          
*                                  ELSE KEEP FOR REPORT                         
*                                                                               
CFLBKBX  DS    0H                                                               
         J     CFLCONT             KEEP RECORD                                  
*                                                                               
         TITLE 'RENWRTER - COLUMN FILTERS - CFLCONT'                            
***********************************************************************         
*                                                                     *         
*        CONTINUATION OF COLUMN FILTER APPLICATION LOOP               *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLCONT  DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         IC    RF,FLTFVLEN         GET LENGTH OF FILTER                         
         LA    R3,FLTFVAL(RF)      BUMP TO NEXT FILTER                          
         BRCT  R0,CFLLOOP                                                       
*                                                                               
         OC    CFLSWS(CFLSWSL),CFLSWS SKIP IF NO SWITCHS SET                    
         JZ    CFLKEEP                                                          
*                                                                               
*        DROP IF ANY SWITCH SET TO DROP                                         
*                                                                               
         LA    R0,CFLSWSL          NUMBER OF SWITCHES                           
         LA    RF,CFLSWS           START OF SWITCHES                            
*                                                                               
         CLI   0(RF),C'D'          LOOK FOR A DROP INDICATOR                    
         JE    CFLDROP                                                          
         LA    RF,1(RF)                                                         
         BRCT  R0,*-12                                                          
*                                                                               
CFLKEEP  DS    0H                                                               
*                                                                               
         CR    RB,RB               INDICATE RECORD TO BE KEPT                   
         J     COLFLTRX                                                         
*                                                                               
CFLDROP  DS    0H                                                               
*                                                                               
         LTR   RB,RB               DROP RECORD                                  
         J     COLFLTRX                                                         
*                                                                               
COLFLTRX DS    0H                                                               
         XIT1                                                                   
*                                                                               
CFLSWS   DS    0X                  SWITCHES FOR VARIOUS DATA TYPES              
CFLTSSSW DC    X'00'               TEARSHEET STATUS SWITCH                      
CFLTSRSW DC    X'00'               TEARSHEET REPRO  SWITCH                      
CFLSWSL  EQU   *-CFLSWS            SWITCH AREA LENGTH                           
*                                                                               
         TITLE 'PRWRICFL - DATE FILTER TABLE - CFLTAB'                          
***********************************************************************         
*                                                                     *         
*                                                                     *         
* DATE FILTER TABLE                                                   *         
*       +0-1   AL2(COLUMN FILTER INTERNAL CODE)                       *         
*       +2     RECORD  ID / WHICH RECORD       IS TO BE CHECKED       *         
*       +3     ELEMENT ID / WHICH ELEMENT DATE IS TO BE FOUND IN      *         
*                AL1(0) - MEANS DATA IS IN KEY OF RECORD              *         
*       +4     DISPLACEMENT OF DATE IN ELEMENT                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFLTAB   DS    0D                       DATE FILTER TABLE                       
*                                       PAID DATE                               
         DC    AL2(0),AL1(0,0,0)                                                
*                                       PAID DATE                               
CFLTABL  EQU   *-CFLTAB            LENGTH OF TABLE ENTRY                        
*                                       PAID DATE                               
CFLTABX  DS    0X                                                               
*                                       PAID DATE                               
CFLTABN  EQU   (*-CFLTAB)/CFLTABL    NUMBER OF TABLE ENTRIES                    
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - FIND COLUMN FILTER - FNDFLTR'                        
***********************************************************************         
*                                                                     *         
*        FIND A SPECIFIC COLUMN FILTER                                *         
*                                                                     *         
*        FILTERS ARE IN SAVEAREA BASED AT FLTTAB                      *         
*           EACH KEYWORD HAS 256 BYTES                                *         
*                                                                     *         
*NTRY    PARM 0   ==>  AL2(FILTER TYPE )                              *         
*        PARM 1+0 ==>  AL1(FILTER VALUE LENGTH) (0 DEFAULTS TO 2)     *         
*        PARM 1   ==>  FILTER VALUE (A(0) BYPASSES VALUE CHECK)       *         
*        GLARGS+6 =    KEYWORD NUMBER                                 *         
*                                                                     *         
*EXIT    CC  NE   FILTER NOT FOUND                                    *         
*        PARM 3   = A(FILTER ENTRY)                                   *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
FNDFLTR  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         ST    R1,FFLPARMA         SAVE PARAMETER AREA ADDRESS                  
*                                                                               
         ICM   R2,15,0(R1)         POINT TO DESIRED FILTER TYPE  ID             
         BZ    FFLOKAY             SKIP IF NONE GIVEN                           
*                                                                               
         ICM   R3,15,4(R1)         POINT TO DESIRED FILTER VALUE ID             
*                                                                               
         MVC   FFLTLEN,4(R1)       SAVE FILTER VALUE LENGTH                     
*                                                                               
         CLI   FFLTLEN,0           IF NOT GIVEN                                 
         BNE   *+8                                                              
         MVI   FFLTLEN,2              DEFAULT TO 2                              
*                                                                               
         XC    8(4,R1),8(R1)       CLEAR RETURN ADDRESS                         
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,GLARGS+6       GET KEYWORD NUMBER                           
         BZ    FFLOKAY             NONE GIVEN - NO FILTER                       
*                                                                               
         LA    RE,FLTAREAL         LENGTH OF FILTER SAVEAREA                    
         BCTR  RF,0                DECREMENMT FOR INDEXING                      
         MR    RE,RE               CALCULATE INDEX AMOUNT                       
*                                                                               
         L     R7,AFLTTAB          POINT TO FILTER SAVEAREAS                    
         LA    R7,0(RF,R7)         POINT TO THIS KEYWORD'S AREA                 
*                                                                               
         USING FLTAREA,R7          ESTABLISH FILTER SAVEAREA                    
*                                                                               
*        DETERMINE FILTER TYPE AND APPLY                                        
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,FLTFNO         GET NUMBER OF FILTERS                        
         BZ    FFLOKAY             NONE GIVEN - FILTER NOT FOUND                
*                                                                               
         LA    R6,FLTCTL           POINT TO FIRST FILTER                        
         SR    RE,RE                                                            
*                                                                               
         SR    RF,RF                                                            
         MVI   BYTE,0              INIT ACTIVITY INDICATOR                      
*                                                                               
FFLLOOP  DS    0H                                                               
*                                                                               
         USING FLTCTL,R6           ESTABLISH FILTER                             
*                                                                               
*        MATCH TO GIVEN FILTER                                                  
*                                                                               
         CLC   FLTFTIC,0(R2)       MATCH FILTER TYPE                            
         BNE   FFLCONT                                                          
*                                                                               
         MVI   BYTE,1              INDICATE FILTERING BEING DONE                
*                                                                               
         LTR   R3,R3               IF NO SPECIFIC ONE ASKED FOR                 
         BZ    FFLFND                 ACCEPT THIS ONE                           
*                                                                               
         CLC   FFLTLEN,FLTFVLEN    LENGTH MUST BE GE FILTER'S LENGTH            
         BL    FFLCONT                                                          
*                                                                               
         IC    RF,FLTFVLEN         USE FILTER'S LENGTH                          
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         TM    FLTCTL,FLTNOTQ      SKIP IF FILTERING ON ABSENCE                 
         BO    FFLNOT                                                           
*                                                                               
         TM    FLTCTL,FLTEQQ       IF EQ                                        
         BNO   FFLEQX                                                           
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),FLTFVAL        MATCH FILTER VALUE                        
         BE    FFLFND                                                           
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLEQX   DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTLTQ       IF LT                                        
         BNO   FFLLTX                                                           
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),FLTFVAL        COMPARE FILTER VALUE                      
         BL    FFLFND                                                           
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLLTX   DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTGTQ       IF GT                                        
         BNO   FFLGTX                                                           
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),FLTFVAL        COMPARE FILTER VALUE                      
         BH    FFLFND                                                           
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLGTX   DS    0H                                                               
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLNOT   DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTEQQ       IF NEQ                                       
         BNO   FFLNEQX                                                          
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),FLTFVAL        MATCH FILTER VALUE                        
         BNE   FFLFND                                                           
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLNEQX  DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTLTQ       IF NOT LT                                    
         BNO   FFLNLTX                                                          
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),FLTFVAL        COMPARE FILTER VALUE                      
         BNL   FFLFND                                                           
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLNLTX  DS    0H                                                               
*                                                                               
         TM    FLTCTL,FLTGTQ       IF NOT GT                                    
         BNO   FFLNGTX                                                          
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),FLTFVAL        COMPARE FILTER VALUE                      
         BNH   FFLFND                                                           
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLNGTX  DS    0H                                                               
*                                                                               
         B     FFLCONT                                                          
*                                                                               
FFLCONT  DS    0H                                                               
*                                                                               
         IC    RE,FLTFVLEN         GET LENGTH OF FILTER                         
         LA    R6,FLTFVAL(RE)      BUMP TO NEXT FILTER                          
         BCT   R0,FFLLOOP                                                       
*                                                                               
FFLNOTF  DS    0H                                                               
*                                                                               
         CLI   BYTE,0              OKAY IF NOT FILTERING                        
         BE    FFLOKAY                                                          
*                                                                               
         LTR   RB,RB               SET NEQ CC                                   
         B     FNDFLTRX            FILTER NOT FOUND                             
*                                                                               
FFLFND   DS    0H                                                               
*                                                                               
         L     R1,FFLPARMA         POINT TO PARAMETER LIST                      
         ST    R6,8(R1)            RETURN FILTER ELEMENT ADDRESS                
*                                                                               
FFLOKAY  DS    0H                                                               
*                                                                               
         CR    RB,RB               INDICATE RECORD TO BE KEPT                   
         B     FNDFLTRX                                                         
*                                                                               
FNDFLTRX DS    0H                                                               
         XIT1                                                                   
*                                                                               
FFLPARMA DS    A                   PARAMETER LIST ADDRESS                       
FFLTLEN  DS    X                   INPUT FILTER VALUE LENGTH                    
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - MAINTAIN COUNT BUCKETS - COUNT'                      
***********************************************************************         
*                                                                     *         
*        MAINTAIN COUNT BUCKETS                                       *         
*              ONE BUCKET PER POSSIBLE LEVEL                          *         
*              EACH BUCKET IS UPDATED WHEN OUTPUT CHANGES             *         
*                                                                     *         
*NTRY    R3 ==>  OUTPUT                                               *         
*                                                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
COUNT    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         TM    GLINDS,GLINTOTL+GLTOTLIN   SKIP IF A TOTAL LINE                  
         BNZ   CTTOT                                                            
******                                                                          
******   ZIC   R1,GLRECNO          PICK UP PRESENT RECORD NUMBER                
******   BCTR  R1,0                                                             
******   SLL   R1,2                                                             
******   LA    R1,GLAINTD(R1)      GET TO DETAILS FOR THIS REPORT               
*========              ========*                                                
******   L     R1,0(R1)                                                         
******   USING GLINTD,R1                                                        
*========              ========*                                                
******   LH    R4,GLPDISP          NOW PICK UP PRINT DISPLACEMENT               
******   A     R4,GLAINTP1         AND GET ACTUAL PRINT ADDRESS                 
******   LA    R4,1(R4)                                                         
******                                                                          
******   DROP  R1                                                               
*                                                                               
         ICM   R5,15,GLADTENT      ESTABLISH DRIVE TABLE ENTRY                  
         USING DROD,R5             AS OUTPUT RECORD                             
*                                                                               
         OC    CTLBLSV,CTLBLSV     IF LABEL NOT FOUND YET                       
         BNZ   CTLBLX                                                           
*                                                                               
         MVC   CTWORK,LABLAREA        SAVE CURRENT LABEL                        
         MVC   LABLAREA,CTSPCES       INIT LABEL AREA                           
*                                                                               
         GOTO1 BLDLBLA                BUILD ONE                                 
*                                                                               
         MVC   CTLBLSV,LABLAREA       AND SAVE IT                               
*                                                                               
         MVC   LABLAREA,CTWORK        RESTORE CURRENT LABEL                     
*                                                                               
         LA    RF,L'CTLBLSV        MAX LABEL LENGTH                             
         LA    RE,CTLBLSV+L'CTLBLSV-1  END OF LABEL                             
*                                                                               
         CLI   0(RE),C' '          FIND END OF LABEL                            
         BH    *+10                                                             
         BCTR  RE,0                BACK UP A BYTE                               
         BCT   RF,*-10             DECREMENT LENGTH COUNTER                     
*                                                                               
         STH   RF,CTLBLL           SAVE LABEL LENGTH                            
*                                                                               
CTLBLX   DS    0H                                                               
*                                                                               
*        CHECK IF PRIOR SORT KEY HAS CHANGED                                    
*                                                                               
         L     RF,GLAIFLD          THIS INPUT FIELD                             
         L     R1,GLATHREC         START OF INPUT RECORD                        
*                                                                               
         SR    RF,R1               LENGTH OF PRIOR SORT KEY                     
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R1),CTHEADSV    CONTINUE IF UNCHANGED                        
         BE    CTHEADX                                                          
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CTHEADSV(0),0(R1)   SAVE NEW SORT KEY                            
*                                                                               
         XC    CTOUTSV,CTOUTSV     FORCE NEW OUTPUT SITUATION                   
*                                                                               
CTHEADX  DS    0H                                                               
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DROLEN         GET OUTPUT DATA LENGTH                       
         BZ    COUNTX              NO OUTPUT                                    
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                COMPARE ALL OF LINE UP TO THIS FIELD         
         CLC   CTOUTSV(0),0(R3)    COMPARE TO LAST OUTPUT                       
         BE    COUNTX              DONE IF NO CHANGE                            
*                                                                               
*        INCREMENT ALL BUCKETS                                                  
*                                                                               
CTBUMP   DS    0H                                                               
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   CTOUTSV(0),0(R3)    SAVE NEW OUTPUT VALUE                        
*                                                                               
         LA    RF,16               MAX 16 TOTALLING LEVELS                      
         LA    RE,CTBKTS           START OF BUCKETS                             
*                                                                               
         AP    0(L'CTBKTS,RE),=P'1'       INCREMENT COUNTERS                    
         LA    RE,L'CTBKTS(RE)     NEXT BUCKET                                  
         BCT   RF,*-10                                                          
*                                                                               
         B     COUNTX                                                           
*                                                                               
         TITLE 'RENWRTER - COUNT HANDLING FOR TOTAL LINES'                      
***********************************************************************         
*                                                                     *         
*        FIND LEVEL FOR TOTAL LINE                                    *         
*        PRINT COUNT IN APPROPRIATE BUCKET                            *         
*        CLEAR BUCKET                                                           
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CTTOT    DS    0H                                                               
*                                                                               
*        FORMAT PRINTOUT FOR COUNT VALUE                                        
*                                                                               
         SR    RE,RE                                                            
         ICM   RE,1,GLLEVEL        GET CONTROL BREAK LEVEL                      
         MH    RE,=Y(L'CTBKTS)     CALCULATE INDEX                              
         LA    RE,CTBKTS(RE)       POINT TO BUCKET                              
*                                                                               
         MVC   CTWORK(L'CTEDIT),CTEDIT  SET EDIT PATTERN                        
*                                                                               
         LA    R1,CTWORK+L'CTEDIT-1  PRINT 1 ZERO AT LEAST                      
*                                                                               
         EDMK  CTWORK(L'CTEDIT),0(RE)    PRINT COUNT                            
*                                                                               
         ZAP   0(L'CTBKTS,RE),=P'0'   CLEAR BUCKET                              
         XC    CTOUTSV,CTOUTSV     RESET OUTPUT SAVEAREA                        
*                                                                               
         LA    RF,CTWORK+L'CTEDIT                                               
         SR    RF,R1               LENGTH OF PRINTOUT                           
*                                                                               
         STH   RF,CTDTLL           SAVE PRINTOUT LENGTH                         
         ST    R1,CTDTLA           SAVE PRINTOUT ADDRESS                        
*                                                                               
*        FORMAT TITLE FOR COUNT                                                 
*        DEPENDING ON SPACE AVAILABLE CHOICES ARE                               
*              COUNT FOR (COLUMN TITLE)                                         
*              CT FOR (COLUMN TITLE)                                            
*              CT                                                               
*              NO TITLE                                                         
*                                                                               
         LA    R1,BLOCK            BUILD OUTPUT IN BLOCK                        
         MVC   BLOCK(128),CTSPCES  INIT BLOCK AREA                              
         MVC   BLOCK+128(128),CTSPCES  INIT BLOCK AREA                          
*                                                                               
         LH    RE,CTLBLL           GET LABEL LENGTH                             
         AH    RE,CTDTLL           ADD ON DETAIL LENGTH                         
*                                                                               
         LA    RF,L'CTTTL+1(RE)    ADD ON LEAD IN LENGTH                        
         CLM   RF,1,ROWWIDTH       IF ROOM FOR LONG TEXT                        
         BH    *+18                                                             
         MVC   0(L'CTTTL,R1),CTTTL    USE IT                                    
         LA    R1,L'CTTTL(R1)         BUMP OUTPUT POINTER                       
         B     CTTOTTLX                                                         
*                                                                               
         LA    RF,L'CTTTL2+1(RE)   ADD ON LEAD IN #2 LENGTH                     
         CLM   RF,1,ROWWIDTH       IF ROOM FOR SHORT TEXT                       
         BH    *+18                                                             
         MVC   0(L'CTTTL2,R1),CTTTL2  USE IT                                    
         LA    R1,L'CTTTL2(R1)        BUMP OUTPUT POINTER                       
         B     CTTOTTLX                                                         
*                                                                               
         SH    RE,CTLBLL           DROP COLUMN TITLE FROM TITLE                 
         LA    RF,L'CTTTL3(RE)     ADD ON LEAD IN #3 LENGTH                     
         CLM   RF,1,ROWWIDTH       IF ROOM FOR SHORT TEXT                       
         BH    *+18                                                             
         MVC   0(L'CTTTL3,R1),CTTTL3  USE IT                                    
         LA    R1,L'CTTTL3(R1)        BUMP OUTPUT POINTER                       
         B     CTTOTTLX                                                         
*                                                                               
         B     CTOTLB1X            NO ROOM SKIP COLUMN TITLE                    
*                                                                               
CTTOTTLX DS    0H                                                               
*                                                                               
*        ADD IN COLUMN LABEL                                                    
*                                                                               
         ICM   RF,3,CTLBLL         GET LABEL LENGTH                             
         BZ    CTOTLBLX            NO LABEL AVAILABLE                           
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R1),CTLBLSV     ADD IN LABEL                                 
*                                                                               
         LA    R1,2(RF,R1)         BUMP OUTPUT POINTER                          
*                                                                               
CTOTLBLX DS    0H                                                               
*                                                                               
         MVC   0(2,R1),=C'IS'                                                   
         LA    R1,2(R1)            BUMP OUTPUT POINTER                          
*                                                                               
CTOTLB1X DS    0H                                                               
*                                                                               
         ICM   RF,3,CTDTLL         GET DETAIL LENGTH                            
         BZ    CTOTDTLX            NO DETAIL AVAILABLE                          
*                                                                               
         L     RE,CTDTLA           POINT TO DETAIL DATA                         
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         EX    RF,*+8                                                           
         B     *+10                                                             
         MVC   1(0,R1),0(RE)       PRINT COUNT                                  
*                                                                               
         LA    R4,2(RF,R1)         NEXT OUTPUT POSITION                         
         LA    R1,BLOCK                                                         
         SR    R4,R1               OUTPUT LENGTH                                
*                                                                               
*        CHOP RESULT                                                            
*                                                                               
         LA    R1,6                MAX 6 LINES FOR CHOPPING                     
         ST    R1,DMCB+8                                                        
         MVI   DMCB+8,198                                                       
*                                                                               
         GOTO1 CHOPPER,DMCB,((R4),BLOCK),(ROWWIDTH,0(R3))                       
*                                                                               
CTOTDTLX DS    0H                                                               
*                                                                               
         B     COUNTX                                                           
*                                                                               
COUNTX   DS    0H                                                               
         XIT1                                                                   
*                                                                               
CTSPCES  DC    CL64' '             SPACES                                       
CTTTL    DC    C'COUNT FOR '                                                    
CTTTL2   DC    C'CT FOR '                                                       
CTTTL3   DC    C'CT '                                                           
CTEDIT   DC    X'4020202020202120'                                              
CTLBLL   DS    H                   LABEL LENGTH                                 
CTDTLL   DS    H                   COUNT LENGTH                                 
CTDTLA   DS    A                   A(COUNT)                                     
CTLBLSV  DC    XL(L'LABLAREA)'00'  LABEL SAVEAREA                               
CTWORK   DS    CL32                WORKAREA                                     
CTOUTSV  DC    XL256'00'           LAST OUT SAVEAREA                            
CTHEADSV DC    XL256'00'           PRIOR SORT KEY SAVEAREA                      
*                                                                               
CTBKTS   DC    16PL4'0'            BUCKETS FOR COUNT                            
*                                  ONE FOR EACH OF 16 LEVELS                    
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - FILTER DATES FOR FLOWCHART COLUMN - DOFLW'           
***********************************************************************         
*                                                                     *         
*        FLOWCHART EDITING                                            *         
*                                                                     *         
*        DATE MUST FALL WITHIN RANGE FOR COLUMN                       *         
*           START AND DATES FOR COLUMN AT GLARGS+9-14                 *         
*                                                                     *         
*NTRY                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
DOFLW    NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         L     R4,REAIO            ESTABLISH CONTRACT RECORD                    
         USING RCONREC,R4                                                       
*                                                                               
         MVI   FLOWDATA,0          INIT SIGNIFICANT DATA FOUND SWITCH           
*                                                                               
         CLI   GLARGS+7,C'$'       IGNORE IF NOT A FLOWCHART FIELD              
         BNE   DOFLWX                                                           
*                                                                               
         SR    RF,RF               INIT DATE POINTER                            
*                                                                               
         MVI   FLOWDATA,C'Y'       INDICATE SIGNIFICANT DATA FOUND              
*                                                                               
         B     DOFLWX                                                           
*                                                                               
DFLDROP  DS    0H                                                               
*                                                                               
*        NEED TO CLEAR OUT DATA                                                 
*              CHARACTER TO SPACES                                              
*              PACKED TO ZERO                                                   
*              REST TO NULLS                                                    
*                                                                               
         L     R1,GLADTENT         ESTABLISH DRIVE TABLE ENTRY                  
         USING DRIND,R1            AS AN INPUT RECORD                           
*                                                                               
         SR    R0,R0                                                            
         ICM   R0,1,DRINREP        GET REPETITION FACTOR                        
*                                                                               
         SR    RF,RF                                                            
         ICM   RF,1,DRINFLEN       GET FIELD LENGTH                             
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
*                                                                               
         CLI   DRINTYPE,C'C'       IF CHARACTER FIELD                           
         BNE   DFLCLRCN                                                         
*                                                                               
         EX    RF,*+16                                                          
         LA    R2,1(RF,R2)                                                      
         BCT   R0,*-8                 GET ALL REPETITIONS                       
         B     DFLCLRX                                                          
         MVC   0(0,R2),DFLSPCES       CLEAR TO SPACES                           
*                                                                               
DFLCLRCN DS    0H                                                               
*                                                                               
         CLI   DRINTYPE,C'P'       IF PACKED FIELD                              
         BE    *+8                                                              
         CLI   DRINTYPE,C'M'       OR MSKED  FIELD                              
         BNE   DFLCLRPN                                                         
*                                                                               
         SLL   RF,4                   LENGTH TO LEFT NYBBLE                     
*                                                                               
         EX    RF,*+16                                                          
         LA    R2,1(RF,R2)                                                      
         BCT   R0,*-8                 GET ALL REPETITIONS                       
         B     DFLCLRX                                                          
         ZAP   0(0,R2),=P'0'          CLEAR TO ZERO                             
*                                                                               
DFLCLRPN DS    0H                                                               
*                                                                               
         EX    RF,*+16                                                          
         LA    R2,1(RF,R2)                                                      
         BCT   R0,*-8                 GET ALL REPETITIONS                       
         B     DFLCLRX                                                          
         XC    0(0,R2),0(R2)       ELSE CLEAR TO NULLS                          
*                                                                               
DFLCLRX  DS   0H                                                                
*                                                                               
DOFLWX   DS    0H                                                               
         XIT1                                                                   
*                                                                               
DFLSPCES DC    CL64' '             SPACES                                       
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - GENERAL OUTPUT ROUTINE - CNVBRD'                     
***********************************************************************         
*                                                                     *         
*                         CONVERT DATE RANGE TO BROADCAST RANGE       *         
*                                                                     *         
*NTRY                                                                 *         
*        P0     A(INPUT DATES) - YMD - MAYBE YM                       *         
*        P1     A(OUTPUT)      - YMD DATES                            *         
*                                                                     *         
*EXIT                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
CNVBRD   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         MVC   CVBPARMS,0(R1)      SAVE PARAMETER BLOCK                         
*                                                                               
         L     RF,CVBP0            POINT TO INCOMING YMD DATES                  
         MVC   CVBIN,0(RF)         COPY INPUT                                   
*                                                                               
         LA    RF,CVBIN            POINT TO INCOMING DATES                      
*                                                                               
         CLI   2(RF),0             IF NO DAYS SET TO 15TH OF MONTH              
         BNE   *+8                                                              
         MVI   2(RF),15                                                         
*                                                                               
         CLI   5(RF),0                                                          
         BNE   *+8                                                              
         MVI   5(RF),15                                                         
*                                                                               
         GOTO1 DATCON,CVBPRMS,(X'13',CVBIN),(0,CVBWORK) MAKE YYMMDD             
*                                  OUTPUT IS YYMMD-YYMMDD                       
*                                                                               
*        START DATE BROADCAST MONTH                                             
*                                                                               
         GOTO1 REGETBRD,CVBPRMS,(X'01',CVBWORK),CVBWORK+18,GETDAY,     X        
               ADDAY                                                            
*                                                                               
         MVC   CVBOUT(6),CVBWORK+18   SAVE BROADCAST START DATE                 
*                                                                               
*        END   DATE BROADCAST MONTH                                             
*                                                                               
         GOTO1 REGETBRD,CVBPRMS,(X'01',CVBWORK+7),CVBWORK+18,GETDAY,   X        
               ADDAY                                                            
*                                                                               
         MVC   CVBOUT+6(6),CVBWORK+24   SAVE BROADCAST END DATE                 
*                                                                               
         GOTO1 DATCON,CVBPRMS,(0,CVBOUT),(3,CVBWORK)     MAKE YMD               
         GOTO1 DATCON,CVBPRMS,(0,CVBOUT+6),(3,CVBWORK+3) MAKE YMD               
*                                                                               
         L     R1,CVBP1            POINT TO RETURN AREA                         
         MVC   0(6,R1),CVBWORK     RETURN BROADCAST DATES                       
*                                                                               
CNVBRDX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
CVBPARMS DS    0D                  PARAMETER BLOCK SAVE                         
CVBP0    DS    A                   A(INPUT DATES)                               
CVBP1    DS    A                   A(OUTPUT DATES)                              
CVBWORK  DS    CL32                WORKAREA                                     
CVBIN    DS    XL6                 INPUT  - START/END - YMD                     
CVBOUT   DS    CL12                OUTPUT - START/END - YYMMDD                  
CVBPRMS  DS    6F                  WORK PARAMETER LIST                          
*                                                                               
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - GENERAL OUTPUT ROUTINE - GENOUT'                     
***********************************************************************         
*                                                                     *         
*                         SHARED OUTPUT ROUTINE                       *         
*                                                                     *         
*NTRY                                                                 *         
*        LABLAREA HAS PREFIX                                          *         
*        CODEAREA HAS CODE                                            *         
*        NAMEAREA HAS NAME                                            *         
*                                                                     *         
*EXIT                                                                 *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
         DS    0D                                                               
GENOUTR  NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         USING RENWRIOD,R7         ESTABLISH RENWRIO WORKAREA                   
         USING SUBSYSD,R9          ESTABLISH RENWRTER WORKAREA                  
         USING GLOBALD,RA          ESTABLISH DRIVER WORKAREA                    
         USING GEND,RC                                                          
*                                                                               
         TM    GLINDS,GLINTOTL     TOTALS ARE DEALT WITH BELOW                  
         BO    GTOTOUT                                                          
*                                                                               
         CLI   MYLTYP,C'H'         FOR HEADLINES, MOVE OUT THE LOT              
         BNE   GNHEADN                                                          
*                                                                               
         TM    GLDOWNLD,GLDLACTV+GLDLHEAD  SKIP TITLE IF DOWNLOAD               
         BO    GNHEADN                                                          
*                                                                               
         CLI   MYCOL,99            IF ON THE RIGHT HAND SIDE                    
         BL    GNHEAD10                                                         
*                                                                               
         GOTO1 SQUASHER,DMCB,OUTAREA,L'OUTAREA   SQUASH                         
*                                                                               
         MVC   0(33,R3),OUTAREA       PRINT SOME OF OOUTPUT                     
*                                                                               
         B     GENOUTX                DONE                                      
*                                                                               
GNHEAD10 DS    0H                  LEFT HEADLINE                                
*                                                                               
         MVC   0(L'OUTAREA,R3),OUTAREA    PRINT AS IS                           
*                                                                               
         B     GENOUTX                                                          
*                                                                               
GNHEADN  DS    0H                                                               
*                                                                               
*        NON-HEADLINE                                                           
*                                                                               
         OC    CODENNAM,GNSPACES   MAKE OUTPUT UPPERCASE                        
*                                                                               
         CLI   MYLTYP,C'M'         FOR MIDLINES                                 
         BNE   GNMIDN                                                           
*                                                                               
         GOTO1 SQUASHER,DMCB,CODENNAM,L'CODENNAM   SQUASH                       
*                                                                               
         MVC   0(L'CODENNAM,R3),CODENNAM   AND THEN PRINT                       
*                                                                               
         B     GENOUTX                                                          
*                                                                               
GNMIDN   DS    0H                                                               
*                                                                               
*        ROW OR COLUMN                                                          
*                                                                               
         CLI   MYOLEN,1            IF ONE BYTE OUTPUT                           
         BNE   *+14                                                             
         MVC   0(1,R3),CODEAREA       MOVE ON OUT                               
         B     GENOUTX                                                          
*                                                                               
         SR    R4,R4               INIT CODE LENGTH                             
*                                                                               
         CLC   CODEAREA,GNSPACES   SKIP IF NO CODE PRESENT                      
         BNH   GNCODEX                                                          
*                                                                               
         LA    R4,L'CODEAREA       CODEAREA LENGTH                              
         LA    R1,CODEAREA+L'CODEAREA-1   LAST BYTE OF CODEAREA                 
*                                                                               
         CLI   0(R1),C' '          FIND LAST OF CODE                            
         BH    *+10                                                             
         BCTR  R1,0                                                             
         BCT   R4,*-10                                                          
*                                                                               
         BCTR  R4,0                (R4=L'CODE-1)                                
         EX    R4,*+8                                                           
         B     *+10                                                             
         MVC   0(0,R3),CODEAREA    MOVE OUT THE CODE                            
*                                                                               
         LA    R4,2(R4)            LENGTH TAKEN BY CODE                         
         LA    R3,0(R4,R3)         NEXT PRINT POSITION                          
*                                                                               
GNCODEX  DS    0H                                                               
*                                                                               
*        PRINT NAMEAREA                                                         
*                                                                               
         LA    R1,NAMEAREA         SET UP TO CHOP THE NAME                      
         ST    R1,DMCB             A(INPUT)                                     
         MVI   DMCB,L'NAMEAREA     L'INPUT                                      
         ST    R3,DMCB+4           A(OUTPUT)                                    
*                                                                               
         SR    R1,R1                                                            
         IC    R1,MYOLEN           OUTPUT LENGTH                                
*                                                                               
         SR    R1,R4               LENGTH AVAILABLE FOR PRINTING                
         BNP   GENOUTX             NONE LEFT                                    
*                                                                               
         STC   R1,DMCB+4                                                        
*                                                                               
         LA    R1,4                MAX N'LINES                                  
*                                                                               
***      TM    REQPOPT,REQPOCUT                                                 
***      BNO   *+8                                                              
***      LA    R1,1                ONLY 1 LINE IF CUTTING OUTPUT                
*                                                                               
         TM    GLDOWNLD,X'80'                                                   
         BNO   *+8                                                              
         LA    R1,1                ONLY 1 FOR DOWNLOADING                       
*                                                                               
         ST    R1,DMCB+8                                                        
*                                                                               
         MVI   DMCB+8,198          PRINT LINES ARE 198 APART                    
*                                                                               
         GOTO1 CHOPPER,DMCB        CHOP OUTPUT                                  
*                                                                               
         B     GENOUTX                                                          
*                                                                               
*--------------->    SHARED TOTAL ROUTINE <--------------------                 
*                                                                               
*              AT THIS STAGE...    LABLAREA HAS PREFIX                          
*                                  CODEAREA HAS CODE                            
*                                  NAMEAREA HAS NAME                            
*              INPUT               ROWWIDTH HAS ROWWIDTH                        
*                                                                               
GTOTOUT  DS    0H                                                               
*                                                                               
         ZIC   R1,GLRECNO          PICK UP PRESENT RECORD NUMBER                
         BCTR  R1,0                                                             
         SLL   R1,2                                                             
         LA    R1,GLAINTD(R1)      GET TO DETAILS FOR THIS REPORT               
*                                                                               
         L     R1,0(R1)            ESTABLISH DETAILS                            
         USING GLINTD,R1                                                        
*                                                                               
         LH    R4,GLPDISP          NOW PICK UP PRINT DISPLACEMENT               
         A     R4,GLAINTP1         AND GET ACTUAL PRINT ADDRESS                 
         LA    R4,1(R4)            BYPASS VERTICAL BOX LINE                     
*                                                                               
         DROP  R1                                                               
*                                                                               
         SR    R1,R1                                                            
         IC    R1,ROWWIDTH         TOTAL ROW WIDTH                              
*                                                                               
         CH    R1,=H'2'            ROW MUST BE AT LEAST 2 WIDE                  
         BNH   GENOUTX                                                          
*                                                                               
         BCTR  R1,0                EXCLUDE BOX LINE                             
         BCTR  R1,0                DECREMENT FOR EXECUTE                        
*                                                                               
         EX    R1,GTOTCP1                                                       
         EX    R1,GTOTCP2                                                       
         EX    R1,GTOTCP3                                                       
*                                                                               
*        PRINT CORRECT TOTAL LABEL                                              
*                                                                               
         CLI   ROWWIDTH,3          SKIP IF ROW NOT 3 WIDE                       
         BL    GTOTOUTX                                                         
*                                                                               
         MVC   0(3,R3),=C'ALL'                                                  
*                                                                               
         CLI   ROWWIDTH,5                                                       
         BL    GTOTOUTX                                                         
*                                                                               
         MVC   0(5,R3),=C'*ALL*'                                                
*                                                                               
         CLI   ROWWIDTH,8                                                       
         BL    GTOTOUTX                                                         
*                                                                               
         MVC   0(8,R3),=C'*TOTALS*'                                             
*                                                                               
         CLI   ROWWIDTH,16                                                      
         BL    GTOTOUTX                                                         
*                                                                               
         MVC   0(8,R3),GNSPACES                                                 
*                                                                               
         LR    R3,R4               START OF PRINT AREA                          
*                                                                               
         MVC   BLOCK(80),GNSPACES  SQUASH TOTAL TITLE                           
         MVC   BLOCK(10),=C'TOTALS FOR'                                         
         MVC   BLOCK+12(59),OUTAREA                                             
*                                                                               
         GOTO1 SQUASHER,DMCB,BLOCK,80                                           
*                                                                               
         ZIC   R4,ROWWIDTH         IF WIDTH OF ALL ROWS IS OVER 20              
         BCTR  R4,0                                                             
*                                                                               
         L     R1,GLATHID                                                       
         USING GLINTD,R1              SEE IF A TOTAL LINE                       
*                                                                               
         TM    GLINDS2,GLEXTBOX        XBOX REQSTED                             
         BO    *+6                                                              
         BCTR  R4,0                                                             
*                                                                               
         CLC   GLLEVEL,GLDETLEV    IF NOT JUST PRINT                            
         BE    GTOTOOO                                                          
         B     GTOTOOO                                                          
*                                                                               
******   LA    RF,LEVELCON         PRINT ONLY ON THIS LEVEL BREAK               
*                                                                               
GTOTLLLV CLI   0(RF),0                                                          
         BE    GTOTOOO                                                          
*                                                                               
         CLC   GLLEVEL,0(RF)                                                    
         BE    GTOTOOP                                                          
*                                                                               
         LA    RF,1(RF)                                                         
         B     GTOTLLLV                                                         
*                                                                               
GTOTOOP  SH    R4,=H'5'                                                         
*                                                                               
         CLI   ROWWIDTH,25                                                      
         BL    GTOTOUT2                                                         
         DROP  R1                                                               
*                                                                               
GTOTOOO  CLI   ROWWIDTH,20                                                      
         BL    GTOTOUT2                                                         
*                                                                               
         LA    R3,4(R3)                                                         
         SH    R4,=H'4'            INDENT TOTALS BY 4                           
*                                                                               
GTOTOUT2 BCTR  R4,0                                                             
*                                                                               
         LA    R1,4                                                             
         ST    R1,DMCB+8                                                        
         MVI   DMCB+8,198                                                       
*                                                                               
         GOTO1 CHOPPER,DMCB,(80,BLOCK),((R4),0(R3))                             
*                                                                               
GTOTOUTX MVC   OUTAREA,GNSPACES                                                 
*                                                                               
*        PRINT COUNT IF NEEDED                                                  
*                                                                               
GTOTCT   DS    0H                                                               
*                                                                               
         TM    REQCFOPT,REQCFCTQ   SKIP IF NO FIELD BEING COUNTED               
         BNO   GTOTCTX                                                          
*                                                                               
*        FIND A SPARE LINE FOR PRINTING                                         
*                                                                               
         LR    RF,R4               COPY OUTPUT AREA WIDTH                       
*                                                                               
         BCTR  RF,0                DECREMENT FOR EXECUTE                        
         LA    R0,20               CHECK MAX 20 LINES                           
*                                                                               
         EX    RF,*+8                                                           
         B     *+10                                                             
         CLC   0(0,R3),GNSPACES    LOOK FOR EMPTY LINE                          
         BNH   *+16                                                             
         LA    R3,198(R3)          BUMP TO NEXT LINE                            
         BCT   R0,*-22                                                          
         B     GTOTCTX             NO ROOM LEFT                                 
*                                                                               
         GOTO1 =A(COUNT)           PRINT COUNT                                  
*                                                                               
GTOTCTX  DS    0H                                                               
*                                                                               
         L     R1,GLATHID                                         L09           
         USING GLINTD,R1           SEE IF A TOTAL LINE            L09           
*                                                                               
         CLC   GLLEVEL,GLDETLEV    IF NOT JUST PRINT              L09           
         BE    GENOUTX                                            L09           
         B     GENOUTX                                            L09           
*                                                                               
*******  LA    RF,LEVELCON         PRINT ONLY ON THIS LEVEL BREAK L09           
*                                                                               
TOTAAAA  CLI   0(RF),0                                            L09           
         BE    GENOUTX                                            L09           
*                                                                               
         CLC   GLLEVEL,0(RF)                                      L09           
         BE    TOTPPP                                             L09           
*                                                                               
         LA    RF,1(RF)                                           L09           
         B     TOTAAAA                                            L09           
*                                                                               
TOTPPP   DS    0H                                                 L09           
*                                                                               
         B     GENOUTX                                            L09           
*                                                                               
GTOTCP1  MVC   000(0,R4),GNSPACES                                               
GTOTCP2  MVC   198(0,R4),GNSPACES                                               
GTOTCP3  MVC   396(0,R4),GNSPACES                                               
*                                                                               
LINEDES  DC    CL32' '                                                          
*                                                                               
GENOUTX  DS    0H                                                               
         XIT1                                                                   
*                                                                               
GNSPACES DC    CL198' '                                                         
         LTORG                                                                  
*                                                                               
         DROP                                                                   
*                                                                               
         TITLE 'RENWRTER - DATE FILTER TABLE DSECT - CFTABD'                    
***********************************************************************         
*                                                                     *         
*                                                                     *         
* DATE FILTER TABLE DSECT                                             *         
*       +0-1   AL2(COLUMN FILTER INTERNAL CODE)                       *         
*       +2     RECORD  ID / WHICH RECORD       IS TO BE CHECKED       *         
*       +3     ELEMENT ID / WHICH ELEMENT DATE IS TO BE FOUND IN      *         
*                AL1(0) - MEANS DATA IS IN KEY OF RECORD              *         
*       +4     DISPLACEMENT OF DATE IN ELEMENT                        *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
CFTABD   DSECT                     DATE FILTER TABLE                            
CFTFLTID DS    AL2                 DATE FILTER ID                               
CFTRECID DS    AL1                 RECORD ID                                    
CFTELMID DS    AL1                 ELEMENT ID                                   
*                                    AL1(0) DATE LIES IN KEY                    
CFTDISP  DS    AL1                 DISPLACEMENT OF DATA IN ELEMENT              
*                                                                               
CFTABL   EQU   *-CFTABD            LENGTH OF TABLE ENTRY                        
*                                                                               
         TITLE 'RENWRTER - IDENTD'                                              
***********************************************************************         
*                                                                     *         
*        DSECT FOR ENTRY IN IDTAB                                     *         
*                                                                     *         
***********************************************************************         
         SPACE 2                                                                
IDENTD   DSECT                                                                  
IDRECID  DS    XL1                 RECORD  ID FOR DATA                          
IDLKUPTA DS    AL3                 A(LOOKUP TABLE)                              
*                                                                               
*        CODE                                                                   
*                                                                               
IDCDEPRM DS    0XL3                CODE PARAMETERS FOR IELM                     
IDCDEEID DS    XL1                 ELEMENT ID FOR CODE                          
IDCDEDSP DS    XL1                 DISPLACEMENT OF CODE IN ELEMENT              
IDCDELN  DS    XL1                 CODE LENGTH                                  
         DS    XL1                 SPARE                                        
*                                                                               
*        DATA FOR FINDING ENTRY IN TABLE                                        
*                                                                               
IDCLKPRM DS    0XL3                CODE PARAMETERS FOR IELM                     
IDCLKEID DS    XL1                 ELEMENT ID FOR CODE                          
IDCLKDSP DS    XL1                 DISPLACEMENT OF CODE IN ELEMENT              
IDCLKLN  DS    XL1                 CODE LENGTH                                  
IDCLKCTL DS    XL1                 CONTROL BYTE                                 
IDCLKCRQ EQU   X'80'               REP IS AFTER CODE                            
*                                                                               
*        NAME                                                                   
*                                                                               
IDNAMPRM DS    0XL3                NAME PARAMETERS FOR IELM                     
IDNAMEID DS    XL1                 ELEMENT ID FOR NAME                          
IDNAMDSP DS    XL1                 DISPLACEMENT OF NAME IN ELEMENT              
IDNAMLN  DS    XL1                 NAME LENGTH FOR INPUT                        
*                                                                               
IDNAMLNO DS    XL1                 NAME LENGTH FOR OUTPUT                       
*                                                                               
IDENTL   EQU   *-IDENTD            LENGTH OF ENTRY IN TABLE                     
*                                                                               
         TITLE   'RENWRTER DSECTS / STORAGE'                                    
*                                                                               
* DRGLOBAL                                                                      
         PRINT OFF                                                              
       ++INCLUDE DRGLOBAL                                                       
         PRINT ON                                                               
* DRIVETABLE                                                                    
         PRINT OFF                                                              
       ++INCLUDE DRIVETABLE                                                     
         PRINT ON                                                               
* DRINTRECD2                                                                    
         PRINT OFF                                                              
       ++INCLUDE DRINTRECD2                                                     
         PRINT ON                                                               
* DDSPLWORKD                                                                    
         PRINT OFF                                                              
       ++INCLUDE DDSPLWORKD                                                     
         PRINT ON                                                               
* REGENALL1                                                                     
         PRINT OFF                                                              
       ++INCLUDE REGENALL1                                                      
         PRINT ON                                                               
* REGENDCT                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENDCT                                                       
         PRINT ON                                                               
* REGENSPEC                                                                     
         PRINT OFF                                                              
       ++INCLUDE REGENSPEC                                                      
         PRINT ON                                                               
* REGENCMT                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENCMT                                                       
         PRINT ON                                                               
* REGENRDP                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENRDP                                                       
         PRINT ON                                                               
* REGENOCM                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENOCM                                                       
         PRINT ON                                                               
* REGENDSP                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENDSP                                                       
         PRINT ON                                                               
* REGENCOM                                                                      
RCOMRECD DSECT                                                                  
         PRINT OFF                                                              
       ++INCLUDE REGENCOM                                                       
         PRINT ON                                                               
* REGENPWC                                                                      
         PRINT OFF                                                              
       ++INCLUDE REGENPWC                                                       
         PRINT ON                                                               
* REREPRGEQC                                                                    
         PRINT OFF                                                              
       ++INCLUDE REREPRGEQC                                                     
         PRINT ON                                                               
* RENWRWORKD                                                                    
         PRINT OFF                                                              
       ++INCLUDE RENWRWORKD                                                     
         PRINT ON                                                               
* RENWREQUS                                                                     
         PRINT OFF                                                              
       ++INCLUDE RENWREQUS                                                      
         PRINT ON                                                               
* PRVALTABD                                                                     
         PRINT OFF                                                              
       ++INCLUDE PRVALTABD                                                      
         PRINT ON                                                               
* RENWRDLSTD                                                                    
         PRINT OFF                                                              
       ++INCLUDE RENWRDLSTD                                                     
         PRINT ON                                                               
* RENWRDSCTS                                                                    
         PRINT OFF                                                              
       ++INCLUDE RENWRDSCTS                                                     
         PRINT ON                                                               
* FAFACTS                                                                       
         PRINT OFF                                                              
       ++INCLUDE FAFACTS                                                        
         PRINT ON                                                               
* INTEREP                                                                       
         PRINT OFF                                                              
       ++INCLUDE INTEREP                                                        
         PRINT ON                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'045RENWRTER  01/10/17'                                      
         END                                                                    

*          DATA SET DEDEM02    AT LEVEL 225 AS OF 11/17/20                      
*PHASE T21B02E,*                                                                
*INCLUDE NETUNBK                                                                
*INCLUDE GETKSRC                                                                
T21B02   TITLE 'DEDEM02 - $DEM T/P && PAV DEMO LOOK-UPS/UPGRADES'               
***********************************************************************         
*============================= UPDATE LOG ============================*         
*   DATE   LVL USER   DESCRIPTION                                               
* -------- --- ----   ------------------------------------------------*         
* APR22/09 001 SKUI - SUPPORT NEW INVENTORY KEY                                 
*          193        SUPPORT COUNTY COVERAGE FILE                              
*          185        HAD TO ADD CODE TO FIX MAYA NUMBERS                       
*                     BECAUSE 5A-6A SUPPORT BROKE THE DBDQTAB CODE              
*                     FIX BREAK AND RESUME BUF IN DEMOHEADER RECORD             
*          182        stupid Loop bug in GTINDSUM                               
*          182        ALSO FIX WHH DEMOS WITH PRECISION PROBLEM                 
*          182        FUDGE BOOKTYPE P UPGRADES TO ALLOW IT TO PASS             
*                     FIX PROGRAM NAME                                          
*                     IMS NOT AVAILABLE WITH PROJECTIONS                        
*                                                                               
* MAR29/01 163 BPOO - BBM PASS CPP=Y...                                         
* JAN24/01 158 BPOO - support passing 2 decimals(double rounding issue)         
* JAN05/01 158 BPOO - SUPPORT RADAR FILE                                        
* NOV02/00 157 BPOO - SUPPORT USERID ACCESS                                     
* OCT29/00 156 BPOO - DEM81 SEPERATE PHASE FOR TABLES                           
* SEP22/00 155 BPOO - FALINK STUFF LINK IN DEDEMWRKB                            
*                     X'80' IS NOT AVN ITS M-SU!!!!                             
* SEP18/00 154 BPOO - DEMLINE....ALSO CHECK TO SEE IF 1ST WEEK AIRED            
*                     IS DIFFERENT                            ``                
* Jul19/00 153 GLEE - Support for "AVn" day codes for PAV                       
*                                                                               
* Jul13/00 152 GLEE - Move BDB# routine to SUBR05                               
*                                                                               
* Jul13/00 151 GLEE - Need QH adjustment factor scheme in DDT# routine*         
*                                                                     *         
* Jun20/00 150 GLEE - Change versioning scheme to support PC vrsn stmp*         
*                                                                     *         
* Jun20/00 149 GLEE - Handle booktype "D" for PAV upgrades                      
*                                                                               
* May24/00 148 GLEE - Format BBM CANTV non-bktyp "W" books as monthly           
*                                                                               
* May05/00 147 GLEE - Use DEMAND's trace rtn to help calc D/T indices           
*                                                                               
* Apr17/00 146 GLEE - DBD3 link applicable to NSI/TP/USTV only                  
*                                                                               
* Mar08/00 144 GLEE - Use new TSAR I/O area for TSAR routines                   
*                                                                               
* Feb24/00 143 GLEE - Provide DBD3 link to DEMAND                               
*                                                                               
* Feb04/00 142 GLEE - Clean up some commented code                              
*              GLEE - Support day/qh table in DBLOCK Extend area                
*              GLEE - Support TV NSI 2a-6a data                                 
*                                                                               
* Jan26/00 141 GLEE - For some reason, SPGETDEMF forces DBFACTOR to 1           
*                      before calling our hook, which screws up our             
*                      weekly household calculations for M-F requests.          
*                                                                               
* Dec14/99 140 GLEE - Fix bug in TBK# routine for BBM Canada                    
*              GLEE - Suppress the "T" station suffix for BBM Canada            
*              GLEE - Set internal day for network in GDY# routine              
*                                                                               
* Dec07/99 139 GLEE - Move SBT# routine to SUBR05                               
*                                                                               
* Nov10/99 138 GLEE - Fix bug introduced in LVL=134                             
*              GLEE - Add QH check in PDTI# routine                             
*                                                                               
* Oct27/99 137 GLEE - Support for VPH option                                    
*                                                                               
* Oct27/99 136 GLEE - Move DEMLOOK routine to SUBR05                            
*                                                                               
* Oct27/99 135 GLEE - Set up SUBR05 sub-routine pool                            
*                                                                               
* Oct27/99 134 GLEE - Fix bug in DDT# rtn--need to reset entire key             
*                                                                               
* Sep13/99 133 GLEE - Set CC upon exiting phase                                 
*                                                                               
* Aug17/99 130 GLEE - Show 1/2 hr of PAV data if no end time specified          
*                                                                               
* Aug06/99 129 GLEE - Set length of SVI data in GDM# routine                    
*              GLEE - Fix bug in demo modifier loop in DEM32 download           
*                                                                               
* Jul19/99 128 GLEE - Further refinements to handle BBM weekly data             
*                                                                               
* Jul12/99 127 GLEE - Support for new BBM weekly data.  Similar to CSI,         
*                      BBM data can be displayed monthly or weekly              
*                                                                               
* Jun04/99 126 GLEE - Set DBERROR to zero b4 calling PDTI# in DDTB# rtn         
*                                                                               
* May27/99 125 GLEE - Add DEM32 download table for ARB TV                       
*                                                                               
* May26/99 124 GLEE - Remove Canadian Meter Mkt profile for BBM                 
*                                                                               
* May17/99 123 GLEE - Add DLDTAB entry for BBM/Canadien                         
*                                                                               
* May07/99 122 GLEE - Increase D/T sub-index from 1 to 2 bytes                  
*                                                                               
* Apr22/99 121 GLEE - Pass day/time link to SPDEMUP                             
*                                                                               
* Apr22/99 120 GLEE - Provide capability to set links up for SPDEMUPD           
*                                                                               
* Mar08/99 118 GLEE - Fix bug in demo processing w/ weekly HH demos             
*                                                                               
* Feb17/99 117 GLEE - Fix bug in posting PAV data to buffer                     
*                                                                               
* Feb11/99 116 GLEE - Clear area for upgrade element                            
*                                                                               
* Jan21/99 115 GLEE - Support Weekly HHs for TP                                 
*                                                                               
* Jan21/99 114 GLEE - Moved DEMHEAD routine to SUBR04                           
*                                                                               
* Jan21/99 113 GLEE - Fix bug in calculating weekly HH demos                    
*                                                                               
* Jan18/99 112 GLEE - Implement version (extract) dates for DEM32               
*                                                                               
* Jan04/99 111 GLEE - Moved UPDATE LOG to bottom of source code                 
*              GLEE - Add TP/CSI to DEM32 download data table                   
***********************************************************************         
         EJECT                                                                  
DEM02    CSECT                                                                  
         PRINT NOGEN                                                            
*&&DO                                                                           
         NMOD1 IUNWRKL,**DEM2**,RA,CLEAR=YES,RR=RE                              
*&&                                                                             
         NMOD1 LOCWORKL,**DEM2**,RA,CLEAR=YES,RR=RE                             
         USING DEMWRKD,R9          R9=A(GLOBAL W/S)                             
         USING DEMTWAD,R8          R8=A(TWA)                                    
         L     R7,AAPWORK                                                       
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
         ST    RC,AIUNWRK                                                       
         AHI   RC,IUNWRKL                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         STM   RA,RB,MYBASES                                                    
         ST    RE,RELO02                                                        
                                                                                
         ST    RD,DM02W_RD                                                      
*                                                                               
         DS    0H                  SET UP ADCONS                                
***      LH    R1,=Y(DISPTAB-DEM02)                                             
         L     R1,=A(DISPTAB-DEM02)                                             
         LA    R1,DEM02(R1)                                                     
         LA    R0,DISPTABQ                                                      
DEM02_10 SR    RE,RE                                                            
         ICM   RE,3,0(R1)                                                       
         LA    RE,DEM02(RE)        RE=A(TABLE)                                  
         SR    RF,RF                                                            
         ICM   RF,3,2(R1)                                                       
         LA    RF,DEMTMPD(RF)      RF-->PLACE TO STORE A(TABLE)                 
         ST    RE,0(RF)                                                         
         LA    R1,L'DISPTAB(R1)                                                 
         BCT   R0,DEM02_10                                                      
*                                                                               
         CLI   DBSRC,C'F'          IF FUSION AND OPTDEC IS NOT SET              
         BNE   *+8                 MAKE DEC=2 THE DEFAULT                       
         CLI   OPTDEC,0                                                         
         BNE   *+8                                                              
         MVI   OPTDEC,C'2'                                                      
*                                  HANDLE CONTROLLER MODE SETTINGS              
         CLI   APMODE,FORMHEAD     FORMAT HEADLINES & INITIALISE                
         BE    DEMHEAD                                                          
         CLI   APMODE,PROCESS      READ & POST RECORDS TO BUFFER                
         BE    DEMPROC                                                          
         CLI   APMODE,FORMLINE     FORMAT & PRINT A BUFFER RECORD               
         BE    DEMLINE                                                          
         CLI   APMODE,PROCREC      CONTINUATION RECORD                          
         BE    DEMLINE                                                          
         CLI   APMODE,STERTASK     STEREO SESSION TASKS                         
         BE    DEMSTTSK                                                         
         CLI   APMODE,APMBREAK     MAINFRAME TRANSACTION BREAK TASKS            
         BE    DEMBREAK                                                         
         CLI   APMODE,APMRESUM     MAINFRAME TRANSACTION RESUME TASKS           
         BE    DEMRESUM                                                         
*                                                                               
EXITH    DS    0H                  EXIT W/ CC HIGH                              
         LA    R0,1                                                             
         J     EXITCR                                                           
                                                                                
EXITL    DS    0H                  EXIT W/ CC LOW                               
         LHI   R0,-1                                                            
         J     EXITCR                                                           
                                                                                
EXITE    DS    0H                  EXIT W/ CC EQUAL                             
         SR    R0,R0                                                            
         J     EXITCR                                                           
                                                                                
EXITCR   DS    0H                                                               
         AR    R0,R9                                                            
         CR    R0,R9               SET CC                                       
         J     EXIT                 AND EXIT                                    
                                                                                
YES      SR    R9,R9                                                            
NO       LTR   R9,R9                                                            
EXIT     XMOD1 1                                                                
                                                                                
*                                                                               
XITMODH  DS    0H                  EXIT W/ CC HIGH                              
         LA    R0,1                                                             
         J     XITMODCR                                                         
                                                                                
XITMODL  DS    0H                  EXIT W/ CC LOW                               
         LHI   R0,-1                                                            
         J     XITMODCR                                                         
                                                                                
XITMODE  DS    0H                  EXIT W/ CC EQUAL                             
         SR    R0,R0                                                            
         J     XITMODCR                                                         
                                                                                
XITMODCR DS    0H                                                               
         AR    R0,R9                                                            
         CR    R0,R9               SET CC                                       
         J     XITMOD               AND EXIT                                    
                                                                                
XITMOD   DS    0H                  EXITS TO DEM02 CALLER                        
         L     RD,DM02W_RD                                                      
         XMOD1                                                                  
         EJECT                                                                  
* FORMAT HEADLINES & INITIALIZE FOR DEMO LOOK-UPS                               
*                                                                               
DEMHEAD  DS    0H                                                               
         MVI   GOSUBN,DMHD#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
DEMHEADX B     EXIT                                                             
         EJECT                                                                  
* READ DEMO FILES & POST TO BINSRCH BUFFER                                      
* SEQUENCE IS DAY/TIME WITHIN BOOK WITHIN STATION                               
*                                                                               
DEMPROC  LA    R4,DBSTABK-STABKL                                                
         USING STABKD,R4                                                        
         MVI   DEC2PROJ,C'Y'          YES ALLOW 2 DECIMAL UPGRADES              
**       MVI   DEC2PROJ,C'N'                                                    
         XC    SVMAYA,SVMAYA                                                    
         XC    SVCOMNUM,SVCOMNUM                                                
         MVI   THISSTA,0                                                        
         MVC   SVINDEX,=X'FFFFFFFF'                                             
         MVI   DMLRLFLG,C'N'                                                    
*&&DO                                                                           
         CLI   DBMED,C'C'                                                       
         BNE   DP003                                                            
         L     RF,ADEMFIL                                                       
         CLC   =C'WTP',8(RF)                                                    
         BE    DP003                                                            
         MVI   DBBEST,C'M'                                                      
         MVI   DBUSEBBM,C'Y'                                                    
DP003    DS    0H                                                               
*&&                                                                             
         DS    0H                                                               
         MVI   PUFLLOO2,0          INITIALIZE "LAST LEFT OFF" FLAGS             
                                                                                
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         TM    AS2RSMF,AS2RFAPP    IF APPLIC RESUME,                            
         BZ    DP006X                                                           
         MVI   PUFLLOO2,C'N'        NEED TO RE-ESTABLISH MAP CODES              
DP006X   EQU   *                                                                
         DROP  RF                                                               
                                                                                
*                                                                               
         XC    WORK,WORK           SET UP 1W PROFILE KEY                        
         MVC   WORK+0(4),=C'S01W'                                               
         MVC   WORK+4(2),AGYALPH                                                
         MVI   WORK+6,C'T'                                                      
         MVC   WORK+7(3),OPTCLI                                                 
         GOTO1 VGETPROF,DMCB,WORK,PROF1W,VDATAMGR                               
         MVC   PRECPROF,PROF1W+5   GET PRECISION FROM (SPOT) 1W PROFILE         
         MVC   CANMMBK,PROF1W+8    GET CANADIAN MTR MKT POSTING PROFILE         
                                                                                
         DS    0H                  GET REP PROFILE IF SYSTEM IS REP             
         L     RF,ASYSNTRY                                                      
         CLI   (SYSOVSYS-SYSTABD)(RF),8                                         
         BNE   DP012X                                                           
         MVC   DUB(4),=C'RRMP'                                                  
         MVI   GOSUBN,GPRF#                                                     
         GOTO1 AGOSUB                                                           
******   MVI   PRECPROF,C'R'        RESET PRECISION                             
******   TM    PROFRRMP+RMPIMPSB,RMPIMPSA                                       
*****    BZ    *+8                                                              
******          FORCE TO IMPRESSIONS BASED                                      
         MVI   PRECPROF,C'I'         ACCORDING TO THE REP RMP PROFILE           
DP012X   EQU   *                                                                
                                                                                
         CLI   OPTDMA,0            WAS PRECISION SPECIFIED?                     
         BE    *+10                                                             
*&&DO                                                                           
         MVC   PROF1W+5(1),OPTDMA   YES, PASS IT TO THE PROFILE                 
*&&                                                                             
         MVC   PRECPROF,OPTDMA      YES, PASS IT TO THE PROFILE                 
         MVI   PRECPROF,C'I'         FORCE IMPRESSION BASED                     
*                                                                               
         DS    0H                  SET CANADIAN MTR MKT BK (WK/MTH)             
         NI    MYFLAG1,XFF-MYF1SEWK ASSUME DON'T NEED START/END WEEKS           
         CLI   DBMED,C'C'           CANADIAN MEDIA                              
         BNE   DP016X                                                           
         CLC   DBFIL,=C'TP '        TIME PERIOD                                 
         BNE   DP016X                                                           
         CLI   DBSRC,C'N'           NIELSEN                                     
         BE    DP016CSI                                                         
         CLI   DBSRC,C'A'            OR BBM                                     
         BE    DP016BBM                                                         
         B     DP016X                                                           
                                                                                
DP016CSI DS    0H                   CANADIAN NSI (CSI)                          
         OI    MYFLAG1,MYF1SEWK     FLAG TO GET START/END WEEKS                 
         B     DP016M                                                           
                                                                                
DP016BBM DS    0H                   CANADIAN BBM                                
* Should check for bktype "W", but we don't even know what bks we have          
         OI    MYFLAG1,MYF1SEWK      FLAG TO GET START/END WEEKS                
         B     DP016M                                                           
DP016M   EQU   *                                                                
                                                                                
         MVI   CANMMBK,C'N'         ASSUME BOOK IS A WEEK                       
         TM    MISCFLG1,MF1BKVWK    WAS IT VALIDATED AS A WEEK?                 
         BNZ   *+8                                                              
         MVI   CANMMBK,C'M'          NOPE, A MONTH BOOK WAS ENTERRED            
DP016X   EQU   *                                                                
*                                                                               
         DS    0H                  SET TAPE/BOOK BASED DEMO CALC                
*  FORCE METHODLOGY TO IMPRESSIONS BASED                                        
                                                                                
         MVI   TAPEOPT,C'Y'         (PATCHABLE TAPE BASED OPTION)               
*                                                                               
*******  MVI   TAPEOPT,C'N'         BOOK BASED                                  
                                                                                
         CLI   DBMED,C'N'                                                       
**       BE    *+20                                                             
         BE    DP020                                                            
         CLI   DBSRC,C'N'           TAPE BASED FOR NIELSEN                      
         BNE   DP029                                                            
         CLI   DBMED,C'O'            OVERNIGHTS                                 
         BE    *+8                                                              
         CLI   DBMED,C'T'            USTV ONLY                                  
         BNE   DP029                                                            
DP020    DS    0H                                                               
*******  CLI   PRECPROF,C'I'        IMP BASED <==> TAPE BASED                   
*******  BNE   DP029                FORCE TO IMPRESSION BASED                   
         MVI   TAPEOPT,C'Y'         TAPE BASED                                  
DP029    EQU   *                                                                
*                                                                               
*   2 DECIMAL DOUBLE ROUNDING CODE                                              
         DS    0H          MODIFIERS TO CALC AS WHOLE NUMBERS                   
         NI    WHOLEFLG,XFF-(WHOLERTG+WHOLESHR+WHOLEPUT)                        
*^^NEED TO CHECK OPTION HERE                                                    
         OI    WHOLEFLG,WHOLERTG                                                
         OI    WHOLEFLG,WHOLESHR                                                
         OI    WHOLEFLG,WHOLEPUT                                                
*                                                                               
*                                  NEXT STATION                                 
DEMPROC2 ZIC   R1,THISSTA                                                       
         LA    R1,1(R1)                                                         
         STC   R1,THISSTA                                                       
         LA    R4,STABKL(R4)                                                    
*                                                                               
         CLI   PUFLLOO2,C'N'       PICKED UP FROM LAST LEFT OFF?                
         BNE   DEMPROC2D            (EITHER YES OR N/A)_                        
         L     RF,AAPSAV2           NO, NOT YET                                 
         CLC   THISSTA,(AS2THSST-APSAV2D)(RF)                                   
         BNE   DEMPROC2                                                         
DEMPROC2D EQU  *                                                                
*                                                                               
         CLC   THISSTA,NSTAS       TEST ALL STATIONS PROCESSED                  
         BH    DMPROC10                                                         
         MVI   THISBK,0                                                         
         LA    R3,STABKS-L'STABKS                                               
                                                                                
         LA    R0,L'ALFMKTS        ALPHA MKT INPUT (IN CASE THERE IS)           
         ZIC   R1,THISSTA                                                       
         BCTR  R1,0                                                             
         MR    R0,R0                                                            
         LA    R1,ALFMKTS(R1)                                                   
         MVC   ALPHAMKT,0(R1)                                                   
                                                                                
         TM    DEMFLAG1,DF1STERO                                                
         BZ    DEMPROC2G                                                        
         ZIC   RF,THISSTA                                                       
         LH    RE,DSPRCTST                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
         CLM   RF,1,SVTHSSTN                                                    
         BE    *+12                                                             
         MVI   STBKDATA,C'N'                                                    
         STC   RF,SVTHSSTN                                                      
DEMPROC2G EQU  *                                                                
*                                  NEXT BOOK FOR STATION                        
DEMPROC4 ZIC   R1,THISBK                                                        
         LA    R1,1(R1)                                                         
         STC   R1,THISBK                                                        
         LA    R3,L'STABKS(R3)                                                  
*                                                                               
         CLI   PUFLLOO2,C'N'       PICKED UP FROM LAST LEFT OFF?                
         BNE   DEMPROC4D            (EITHER YES OR N/A)_                        
         L     RF,AAPSAV2           NO, NOT YET                                 
         CLC   THISBK,(AS2THSBK-APSAV2D)(RF)                                    
         BNE   DEMPROC4                                                         
DEMPROC4D EQU  *                                                                
*                                                                               
         CLC   THISBK,NBKS         TEST ALL BOOKS PROCESSED                     
         BH    DEMPROC2                                                         
         CLC   0(L'INVBOOK,R3),INVBOOK                                          
         BE    DEMPROC4                                                         
         MVI   THISDAY,0                                                        
         LA    R2,DAYS-L'DAYS                                                   
                                                                                
         NI    MYFLAG1,XFF-MYF1LNBK  IF PROCESSING A LATEST BOOK RQST,          
         CLI   0(R3),XFF                                                        
         BNE   *+8                                                              
         OI    MYFLAG1,MYF1LNBK       FLAG IT AS SUCH                           
                                                                                
         TM    DEMFLAG1,DF1STERO                                                
         BZ    DEMPROC4G                                                        
         ZIC   RF,THISBK                                                        
         LH    RE,DSPRCTBK                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
         CLM   RF,1,SVTHSBK                                                     
         BE    *+12                                                             
         MVI   STBKDATA,C'N'                                                    
         STC   RF,SVTHSBK                                                       
DEMPROC4G EQU  *                                                                
                                                                                
*                                  NEXT DAY/TIME FOR STATION/BOOK               
DEMPROC6 ZIC   R1,THISDAY                                                       
         LA    R1,1(R1)                                                         
         STC   R1,THISDAY                                                       
         LA    R2,L'DAYS(R2)                                                    
*                                                                               
         CLI   PUFLLOO2,C'N'       PICKED UP FROM LAST LEFT OFF?                
         BNE   DEMPROC6D            (EITHER YES OR N/A)_                        
         L     RF,AAPSAV2           NO, NOT YET                                 
         CLC   THISDAY,(AS2THSDY-APSAV2D)(RF)                                   
         BNE   DEMPROC6                                                         
         MVI   PUFLLOO2,C'Y'       WE'VE PICKED UP FROM LAST LEFT OFF           
         NI    (AS2RSMF-APSAV2D)(RF),XFF-AS2RFAPP                               
DEMPROC6D EQU  *                                                                
*                                                                               
         CLC   THISDAY,NDAYS       TEST ALL DAY/TIMES PROCESSED                 
         BH    DEMPROC4                                                         
                                                                                
*                                                                               
         DS    0H                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32  IF DEM32 SESSION,                    
         BNO   DMPRC07G                                                         
         GOTO1 AIOCHECK                     CHECK I/O COUNT FOR TRNSCTN         
         BH    DMPRC07G                                                         
         MVI   FERN,120                    "RQST TOO BIG" ERROR MSG             
         MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
DMPRC07G EQU   *                                                                
                                                                                
         DS    0H                  LATEST  N  BOOKS STUFF                       
         ZAP   THISLBK,=P'0'                                                    
         XC    PVACTBK,PVACTBK                                                  
         XC    LNBKLIST(L'LNBKLIST*4),LNBKLIST                                  
         MVI   PREVDAYR,0                                                       
                                                                                
         DS    0H                  OTHERS                                       
         XC    THISSWKN(2),THISSWKN  START/END WEEKS OF MONTH                   
         XC    CUMSHR(CUMSHRL),CUMSHR                                           
         XC    CUMFCTR,CUMFCTR                                                  
         XC    CUMWHH(CUMWHHL),CUMWHH                                           
         MVC   CUMPNAM1,SPACES                                                  
         MVC   CUMPNAM2,SPACES                                                  
         MVI   CUMWKS,0                                                         
*                                                                               
                                                                                
         LA    RF,DEMLOOK          A(DEMLOOK INTERFACE)                         
         OC    OPTIMS(OPTIMSL),OPTIMS                                           
***      BNZ   DEMPROC8                                                         
*                                                                               
*  CHECK TO MAKE SURE NO UPGRADES FOR IMS                                       
         BZ    DEMPRC7H                                                         
*                                                                               
         CLI   OPTUPFIL,0                                                       
         BZ    DEMPROC8                                                         
         MVI   FERN,44            IMS NOT AVAILABLE WITH UPGRADES               
         MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
*                                                                               
DEMPRC7H CLC   0(L'ESTBOOK,R3),ESTBOOK                                          
         BE    DEMPROC8                                                         
         CLC   0(L'MBKBOOK,R3),MBKBOOK                                          
         BNE   *+8                                                              
DEMPROC8 LA    RF,DEMUPGD          A(DEMUP INTERFACE)                           
**       BALR  RE,RF               GO TO INTERFACE ROUTINE                      
         BASR  RE,RF               GO TO INTERFACE ROUTINE                      
* post more demo list '10' type records for each x'80' demo                     
* values record just processed if dma=i (2 decimal reason)                      
*&&DO                                                                           
                                                                                
         CLI   OPTDMA,C'I'                                                      
         BNE   DMPROC09                                                         
*                                                                               
         MVI   RECTYPE,TDRRTDML                                                 
*                                   the demo just processed to 2 dec            
         BAS   RE,DEMPOST                                                       
         XC    THISDEC,THISDEC                                                  
         MVI   GOSUBN,DDT#         POST DUMMY RECORDS (IF NEEDED)               
         TM    DEMFLAG1,DF1STERO+DF1DEM32   IF DEM32 SESSION,                   
         BNO   DMPROC09                                                         
         MVI   GOSUBN,DDTB#                  POST THESE DUMMY RECORDS           
                                                                                
         GOTO1 AGOSUB                                                           
*&&                                                                             
DMPROC09 DS    0H                                                               
         MVI   GOSUBN,SETSTAB#             SET STABK ENTRY                      
         GOTO1 AGOSUB                                                           
*&&DO                                                                           
*                                                                               
* NEW CODE- IF CANADA, AND LATEST PROCESSED THEN WE MUST                        
* RESET STABK TABLE'S BOOK ENTRY - DEM00 DOESNT LOCK IN THE LATEST              
* BOOK VALUE ANYMORE AND IS PASSING NULLS. WE MUST SET THE BOOK IN              
* THE STABK TABLE TO LAST BOOK READ BY SPDEMLK                                  
* THIS WAY WE CAN FORMAT THE BOOKS CORRECTLY LATER IN THE DEMLINE               
* MODE                                                                          
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   DMPROC9X                                                         
         LA    RF,L'STABKS                                                      
         CLC   THISDAY,NDAYS       ONLY DO IT ONCE PER STATION/BOOK             
         BNE   DMPROC9X            COMBO SO DO IT THE LAST DAYTIME              
         ZIC   RE,THISBK           SINCE ITS THE SAME STA/BK                    
         MR    RE,RE                                                            
DMPROC9C LA    RF,STABKS-L'STABKS(RF)                                           
         OC    0(2,RF),0(RF)       LATEST?                                      
         BNZ   DMPROC9X                                                         
         MVC   0(2,RF),SVACTBK     THIS IS LATEST SINCE BOOK=0000               
         MVC   3(1,RF),SVBKTYPE                                                 
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)       IF WE ASK FOR C'WTP' , BBM                   
         BNE   *+8                 AND LATEST SET BOOKTYPE TO C'W'              
         CLI   DBSRC,C'A'          BECAUSE WEEKLIES ARE LOADED AS               
         BNE   *+8                 BOOKTYPE C'W'                                
         MVI   3(RF),C'W'                                                       
*&&                                                                             
DMPROC9X DS    0C                                                               
         B     DEMPROC6                                                         
*                                                                               
DMPROC10 DS    0H                  ALL STTN/BOOK/DAY&TIME PROCESSED             
*                                                                               
* This code special for STEREO session only.  We'll make a TSAR DEMO            
*  RECORD out of the demo expressions and make it the first record              
*  of the TSAR buffer.  This way, we'll know what the numerical demo            
*  values represent when we get them back in for APMODE=FORMLINE.               
                                                                                
         TM    DEMFLAG1,DF1STERO   IF NOT A STEREO SESSION,                     
         BZ    EXIT                 DON'T EXECUTE LOGIC BELOW                   
*                                                                               
*   FOR COUNTY COVERAGE                                                         
*   RESET MAYA # BACK TO 1 FOR COUNTY COVERAGE SINCE WE FUDGED                  
*   THE FILE READ TO BE SIMILAR TO TYPCIAL TIMER PERIOD EVEN                    
*   THOUGH COUNTY COVERAGE IS A DAYPARTS FILE WE DONT GET THE                   
*   QHR INDEXES SO WE JUST STARTED AT 1 AND INCREMENTED                         
*                                                                               
*                                                                               
         CLC   DBFIL,=C'CTP'                                                    
         BNE   *+10                                                             
         MVC   THISDTSI,=X'0001'                                                
*                                                                               
         MVI   RECTYPE,TDRRTDML                                                 
         MVI   THISSTA,0                                                        
         MVI   THISBK,0                                                         
         MVI   THISDAY,0                                                        
         MVI   THISDAYR,XFF                                                     
         MVI   THISKDAY,XFF                                                     
         MVI   THISSQH,XFF                                                      
         MVI   THISEQH,XFF                                                      
         MVI   THISTYPE,0                                                       
         MVI   THISPROG,C' '                                                    
         MVC   THISPROG+1(L'THISPROG-1),THISPROG                                
*        CLI   OPTDMA,C'I'    2 DECMIAL CODE ABOVE ALREADY POSTED               
*        BE    DMPROC13       THESE DUMMY RECORDS                               
         BAS   RE,DEMPOST                                                       
         XC    THISDEC,THISDEC                                                  
*                                                                               
DMPROC13 DS    0H                                                               
                                                                                
*&&DO                                                                           
         CLI   ACTN,DEMOQHR        ONLY ACTION=DISPLAY MAY                      
         BNE   DMPRC15X             NEED DUMMY RECORDS                          
*&&                                                                             
         MVI   GOSUBN,DDT#         POST DUMMY RECORDS (IF NEEDED)               
         TM    DEMFLAG1,DF1STERO+DF1DEM32   IF DEM32 SESSION,                   
         BNO   DMPRC15M                                                         
         CLI   ACTN,DEMOQHR                  ACTION=DISPLAY,                    
         BNE   DMPRC15X                                                         
         CLC   DBFIL,=C'CTP'                 FILE=TIME PERIOD,                  
         BE    *+10                                                             
         CLC   DBFIL,=C'TP '                 FILE=TIME PERIOD,                  
         BNE   DMPRC15X                                                         
         CLI   SVTHSSTN,1                    AND ONLY FOR 1ST STATION           
         BH    DMPRC15X                                                         
         CLI   SVTHSBK,1                     AND 1ST BOOK OF REQUEST            
         BH    DMPRC15X                                                         
         MVI   GOSUBN,DDTB#                  POST THESE DUMMY RECORDS           
DMPRC15M EQU   *                                                                
                                                                                
         GOTO1 AGOSUB                                                           
DMPRC15X EQU   *                                                                
         B     DMPRCXE                                                          
                                                                                
*                                                                               
DEMPROCX DS    0H                                                               
         B     EXIT                                                             
                                                                                
DMPRCXE  DS    0H                                                               
         B     EXITE                                                            
         EJECT                                                                  
* INTERFACE TO DEMUP FOR UPGRADES                                               
*                                                                               
DEMUPGD  NTR1                                                                   
         CLC   DBFIL,=C'PAV'                                                    
         BE    DEMUP100                                                         
* TP PROJECTIONS MOVED TO SUBROUTINE POOL                                       
         MVI   GOSUBN,DMUPTP#                                                   
         GOTO1 AGOSUB                                                           
         J     EXIT                                                             
                                                                                
*&&DO                                                                           
         LA    R6,SPDEMUP1         INITIALIZE UPGRADE BLOCK                     
         USING SPDEMUPD,R6         R6=A(UPGRADE BLOCK)                          
         XC    SPDEMUPD(SPDEMUP2),SPDEMUPD                                      
         MVC   SPUPAREC,AIOAREA1                                                
         MVC   SPUPAFAC,AFAC                                                    
         MVC   SPUPAGY,AGYALPH                                                  
         MVC   SPUPMED,DBMED                                                    
         MVC   SPUPSTA,STASTA                                                   
                                                                                
         MVI   SPUPSYS,0                                                        
         L     RF,ASYSNTRY                 FOR REP SET SPUPSYS                  
         CLI   (SYSOVSYS-SYSTABD)(RF),8                                         
         BNE   *+8                                                              
         MVI   SPUPSYS,C'R'                                                     
*                                                                               
         CLI   DBSRC,C'F'                                                       
         BE    DEMUP1                                                           
         CLI   DBSRC,C'N'           SYSCODE ALLOWED FOR                         
         BNE   DEMUP2              NSI CABLE, WIRED AND FUSION                  
         CLI   OPTUPBT,C'W'                                                     
         BE    *+8                                                              
         CLI   OPTUPBT,C'4'        ZERO CELL WIRED                              
         BE    *+8                                                              
         CLI   OPTUPBT,C'3'        CABLE ZERO CELL                              
         BE    *+8                                                              
         CLI   OPTUPBT,C'C'                                                     
         BNE   DEMUP2                                                           
***  MOVE SYSCODE FOR THIS STATION INTO AN AREA FOR SPDEMUP                     
DEMUP1   LA    R0,L'SYSCODES                                                    
         ZIC   R1,THISSTA                                                       
         BCTR  R1,0                                                             
         MR    R0,R0                                                            
         LA    R1,SYSCODES(R1)    R1 POINTS TO CURR SYSCODE FOR STATION         
         MVC   SPUPSYSC,0(R1)                                                   
DEMUP2   DS    0H                                                               
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   DEMUP3                                                           
         L     RF,ADEMFIL                                                       
         CLC   =C'LPM',8(RF)                                                    
         BE    DEMUP3                                                           
         CLC   =C'WTP',8(RF)                                                    
         BE    DEMUP3                                                           
*        MVI   DBBEST,C'M'                                                      
*        MVI   DBUSEBBM,C'Y'                                                    
         OI    SPUPOPT2,SPO2CMON+SPO2UBBM                                       
DEMUP3   DS    0H                                                               
*                                                                               
         CLC   0(3,R2),=C'ROT'     IF MULITPLE DAY/TIMES INPUTTED,              
         BE    *+20                 SET UP MULTI-D/T LINK                       
         MVC   SPUPDAY,0(R2)                                                    
         MVC   SPUPTIM,1(R2)                                                    
         B     DEMUP06X                                                         
                                                                                
         DS    0H                  MULTIPLE DAY/TIMES INPUTTED                  
         MVC   DUB+0(4),=C'DYTM'                                                
         LA    RE,DBXTROTN                                                      
         ST    RE,DUB+4                                                         
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTLD,RE                                                        
                                                                                
         ZICM  RF,3(R2),(3)                                                     
         LA    RF,LDTROTN(RF)       1(RF)-->LIST OF DAYS/TIMES                  
         MVC   DBXTLID,=C'DYTM'                                                 
         ZIC   R1,0(RF)                                                         
         AHI   R1,-2                                                            
         EXMVC R1,DBXTLIST,1(RF)                                                
         LA    R1,DBXTLIST+1(R1)                                                
         MVI   0(R1),0                                                          
         DROP  RE                                                               
         OI    SPUPOPTS,SPOPEXT                                                 
DEMUP06X EQU   *                                                                
*                                                                               
         DS    0H                  NEED LONGER DAYS/QHS TABLE                   
         CLI   DBMED,C'T'           FOR MEDIA=USTV                              
         BNE   DEMUPDQX                                                         
         CLI   DBSRC,C'N'           FOR SOURCE=NSI                              
         BNE   DEMUPDQX                                                         
                                                                                
         MVC   DUB+0(4),=C'DBD3'                                                
         LA    RE,DBXTDQT                                                       
         ST    RE,DUB+4                                                         
         XC    0(DBXTDQTL,RE),0(RE)                                             
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         OI    SPUPOPTS,SPOPEXT                                                 
DEMUPDQX EQU   *                                                                
*                                                                               
         MVC   SPUPSPL,STASPILL                                                 
         MVC   SPUPFIL,OPTUPFIL                                                 
         MVC   SPUPBTYP,OPTUPBT                                                 
**** FUDGE IN THE BOOKTYPE FOR NOW FOR BBM WEEKLY                               
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BNE   DEMUP24                                                          
         CLI   DBSRC,C'A'                                                       
         BNE   DEMUP24                                                          
         MVI   SPUPBTYP,C'W'                                                    
         MVI   SPUPBEST,C'N'                                                    
DEMUP24  CLI   SPUPFIL,0                                                        
         BNE   *+8                                                              
         MVI   SPUPFIL,C'T'                                                     
         MVC   SPUPSRC,DBSRC                                                    
         MVC   SPUPTPTT,DBTPTTS                                                 
         MVC   SPUPFBK,OPTUPBK                                                  
         MVC   SPLPMPMK,OPTLPMMK   SET LPM PUT MARKET                           
                                                                                
         MVC   SPUP2YRP,OPT2YRP                                                 
         MVC   SPUP2YRR,OPT2YRR                                                 
         MVC   SPUPUDAY,OPTUPDT                                                 
         MVC   SPUPUTIM,OPTUPDT+1                                               
         MVC   SPUPTYPE(L'OPTUPGD),OPTUPGD                                      
         MVC   SPUPCLI,OPTCLI                                                   
         CLI   PROF1W+3,C'Y'                                                    
         BNE   *+8                                                              
         OI    SPUPOPTS,SPOANGFR                                                
         OC    OPTIMS,OPTIMS       IN MKT SHARE REQST?                          
         BZ    DEMUP30                                                          
         XC    DBXTIMS(DBXTIMSL),DBXTIMS                                        
         LA    RE,DBXTIMS          PASS EXTENSION W/AFFL LIST SET               
         ST    RE,DUB+4                                                         
         MVC   DUB+0(4),=C'IMS '                                                
         L     RF,AOPTNTRY                                                      
         USING OPTTABD,RF                                                       
         CLI   OPTIMSF,C'S'                                                     
         BNE   *+10                                                             
         MVC   DUB+0(4),=C'ISS '                                                
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING SPIMSD,RE                                                        
         MVC   SPIMSID,=C'IMS '                                                 
                                                                                
         CLI   OPTIMSF,C'S'                                                     
         BNE   *+10                                                             
         MVC   SPIMSID,=C'ISS '                                                 
         DROP  RF                                                               
*                                                                               
*                                                                               
         MVC   SPIMSAFF(OPTIMSL),OPTIMS                                         
         OI    SPUPOPTS,SPOPEXT     INDICATE EXTEND IN USE                      
         DROP  RE                                                               
* CODE TO SET UP MBKS LINKS FOR WEEKLY                                          
*                                                                               
                                                                                
DEMUP30  OC    OPTMBK(OPTMBKL),OPTMBK                                           
         BZ    DEMUP62                                                          
         CLI   DBMED,C'T'          MONTHLY                                      
         BE    DEMUP31                                                          
         CLI   DBMED,C'W'          WEEKLY                                       
         BE    DEMUP31                                                          
         CLI   DBMED,C'C'          CANADIAN                                     
         BNE   DEMUP62                                                          
*****DEMUP31  OC    OPTMBK+2(OPTMBKL-2),OPTMBK+2                                
DEMUP31  OC    OPTMBK(OPTMBKL),OPTMBK                                           
         BNZ   DEMUP32                                                          
         MVC   SPUPFBK,OPTMBK                                                   
         B     DEMUP62                                                          
DEMUP32  XC    DBXTMBK(DBXTMBKL),DBXTMBK                                        
         LA    RE,DBXTMBK          PASS EXTENSION W/AFFL LIST SET               
         ST    RE,DUB+4                                                         
         MVC   DUB+0(4),=C'MBKS'                                                
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R5,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXMBD,R5                                                        
         MVC   DBXMBID,=C'MBKS'                                                 
         LA    R5,DBXMBKS                                                       
         ST    R5,FULL2             SAVE A(BEGINNING OF LIST)                   
                                                                                
*  NOW DECODE THE BOOKS INTO THE LINK                                           
         LA    R4,OPTMBK                                                        
         MVI   BYTE,0                                                           
         XC    DUB2,DUB2                                                        
         XC    WBZBFLAG,WBZBFLAG                                                
DEMUP34  CLC   =C'WBZ',SPUPSTA    CHECK BOOKS FOR WBZ                           
         BNE   DEMUP34C                                                         
         MVC   HALF,0(R4)                                                       
         TM    1(R4),X'80'        START OF RANGE?                               
         BZ    *+8                                                              
         XI    HALF+1,X'80'                                                     
         CLC   =X'6625',HALF      OCT01/02                                      
         BNH   DEMUP34A                                                         
         CLI   WBZBFLAG,0         FIRST TIME CHECKING WBZ                       
         BNE   *+8                                                              
         MVI   WBZBFLAG,WBZBFORE                                                
         CLI   WBZBFLAG,WBZAFTER  WBZ BOOK BEFORE 10/01/02                      
         BE    DEMUP34B           MAKE SURE ALL BOOKS ASKED                     
         BNE   DEMUP34C           IS BEFORE 10/01/02                            
                                                                                
DEMUP34A CLI   WBZBFLAG,0         FIRST TIME CHECKING WBZ                       
         BNE   *+8                                                              
         MVI   WBZBFLAG,WBZAFTER                                                
         CLI   WBZBFLAG,WBZBFORE  WBZ BOOK AFTER 10/01/02                       
         BE    DEMUP34B           MAKE SURE ALL BOOKS ASKED                     
         MVI   WBZBFLAG,WBZAFTER  IS AFTER  10/01/02                            
         B     DEMUP34C                                                         
DEMUP34B MVI   FERN,159           MUST BE LATER THAN OCT0102                    
         B     DEMUP48                                                          
DEMUP34C TM    1(R4),X'80'        START OF RANGE?                               
         BO    DEMUP36                                                          
DEMUP35  L     RE,FULL2           FIRST BOOK GOES TO SPUPFBK                    
         CR    RE,R5                                                            
         BNE   *+10                                                             
         MVC   SPUPFBK,0(R4)                                                    
                                                                                
         MVC   0(2,R5),0(R4)                                                    
         AHI   R5,2                NEXT OUTPUT AREA                             
         AHI   R4,2                NEXT CHUNK OF OPTMBK LIST                    
                                                                                
         B     DEMUP54                                                          
DEMUP36  MVC   DUB2(2),2(R4)      SAVE END BOOK RANGE                           
         XI    DUB2+1,X'40'       TURN OFF END RANGE FLAG IN DUB2               
         TM    3(R4),X'40'         NEXT BOOK MUST BE END RANGE                  
         BO    *+6                                                              
         DC    H'0'                                                             
                                                                                
         CLC   =C'WBZ',SPUPSTA                                                  
         BNE   DEMUP36B                                                         
         CLC   =X'6625',DUB2      CHECK END BOOK RANGE WBZ                      
         BNH   DEMUP36A           CONSISTENCY WITH START                        
         CLI   WBZBFLAG,WBZAFTER  BOOK RANGE                                    
         BE    DEMUP34B                                                         
         B     DEMUP36B                                                         
DEMUP36A CLI   WBZBFLAG,WBZBFORE                                                
         BE    DEMUP34B                                                         
                                                                                
DEMUP36B MVC   0(2,R5),0(R4)      MOVE IN BEGINING OF RANGE                     
         XI    1(R5),X'80'        TURN OFF START RANGE FLAG                     
         ZIC   R1,0(R5)           R1=YEAR#                                      
         ZIC   R0,1(R5)           R0=WEEK#                                      
                                                                                
         L     RE,FULL2           FIRST BOOK GOES TO SPUPFBK                    
         CR    RE,R5                                                            
         BNE   *+10                                                             
         MVC   SPUPFBK,0(R5)                                                    
         AHI   R5,2                                                             
DEMUP38  AHI   R0,1                                                             
         CHI   R0,52              IF HIGHER THAN WEEK 52                        
         BNH   DEMUP40                                                          
*  NEXT YEAR RECALCULATE YEAR AND WEEK#                                         
         SHI   R0,52              NEW WEEK NUMBER                               
         AHI   R1,1               NEW YEAR                                      
                                                                                
DEMUP40  XC    DUB,DUB                                                          
         STC   R1,DUB                                                           
         STC   R0,DUB+1                                                         
         CLC   DUB(2),DUB2        COMPARE NEXT BOOK TO END BOOK                 
         BH    DEMUP50                                                          
DEMUP41  MVC   0(2,R5),DUB        MOVE IN NEXT BOOK INTO LIST                   
         AHI   R5,2                                                             
         L     RF,FULL2                                                         
         AHI   RF,53*2            ONLY 53 BOOKS ALLOWED                         
         CR    R5,RF                                                            
         BL    *+16                                                             
         MVI   FERN,148                                                         
DEMUP48  MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
         B     DEMUP38            CREATE NEXT BOOK                              
DEMUP50  AHI   R4,4               PROCESS NEXT CHUNK OF OPTMBK LIST             
DEMUP54  L     RF,FULL2                                                         
         AHI   RF,53*2            ONLY 53 BOOKS ALLOWED                         
         CR    R5,RF                                                            
         BL    *+16                                                             
         MVI   FERN,148                                                         
         MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
         CLI   0(R4),0            END OF OPTMBK LIST?                           
         BNE   DEMUP34                                                          
         DROP  R5                                                               
                                                                                
                                                                                
DEMUP62  DS    0H                                                               
* SET USERID                                                                    
         LA    RE,DBXUID           PASS EXTENSION W/AFFL LIST SET               
         ST    RE,DUB+4                                                         
         MVC   DUB+0(4),=C'UID '                                                
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R5,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXUIID,R5                                                       
         MVC   DBXUIID,=C'UID '                                                 
         MVC   DBXUUID,USERID                                                   
*                                                                               
*****    CLI   PRECPROF,C'I'       'I' PRECISION REQUESTED?                     
*****    BNE   *+8                  YES, PASS                                   
*****  FORCE TO BE IMPRESSIONS BASED                                            
         OI    SPUPOPTS,SPOPDMAI     THROUGH PRECISION FOR UPGRADES             
                                                                                
         CLI   PROF1W+7,C'Y'       normalize huts/puts requested                
         BNE   *+8                  YES, PASS                                   
         OI    SPUPOPTS,SPOPNORM     THROUGH FOR UPGRADES                       
                                                                                
         CLI   PROF1W+8,C'M'       FOR CSI/BBM WEEKLY                           
         BNE   SETOP2X              CALC MONTH                                  
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BE    *+8                                                              
         OI    SPUPOPT2,SPO2CMON                                                
         CLI   PROF1W+9,C'Y'                                                    
         BNE   *+8                                                              
         OI    SPUPOPT2,SPO2UBBM                                                
SETOP2X  DS    0C                                                               
                                                                                
         L     RF,ASYSNTRY                                                      
         CLI   (SYSOVSYS-SYSTABD)(RF),8  IF REP SYSTEM,                         
         BNE   *+8                                                              
         OI    SPUPOPTS,SPOPNORM          ALWAYS NORMALIZE HUT/PUT              
                                                                                
         CLI   OPTSPRT,0                                                        
         BE    DEMUPGD2                                                         
         OI    SPUPOPTS,SPOSPRTY                                                
         CLI   OPTSPRT,C'Y'                                                     
         BE    DEMUPGD2                                                         
         NI    SPUPOPTS,X'FF'-SPOSPRTY                                          
         OI    SPUPOPTS,SPOSPRTN                                                
         CLI   OPTSPRT,C'N'                                                     
         BE    DEMUPGD2                                                         
         DC    H'0'                                                             
DEMUPGD2 DS    0H                                                               
                                                                                
         CLC   0(L'MBKBOOK,R3),MBKBOOK                                          
         BNE   DMUPG4X                                                          
         L     RE,ADEMFIL                                                       
         CLC   =C'TP',8(RE)                                                     
         BE    DEMUPGD3                                                         
         CLC   =C'WTP',8(RE)                                                    
         BE    DEMUPGD3                                                         
         CLC   =C'LPM',8(RE)                                                    
         BE    DEMUPGD3                                                         
         MVC   SPUPFBK,OPTMBK                                                   
         MVC   SPUPFBKL,OPTMBK+L'SPUPFBK                                        
DEMUPGD3 MVC   SPUPBTYP,OPTMBKBT                                                
         MVI   SPUPFIL,C'T'                                                     
         MVC   SPUPTYPE(8),=XL8'0400006400000000'                               
         L     RE,ADEMFIL                                                       
         CLC   =C'TP',8(RE)                                                     
         BE    *+10                                                             
         CLC   =C'LPM',8(RE)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RE)                                                    
         BNE   DMUPG4X                                                          
         MVC   SPUPTYPE(8),=XL8'0F00006400000000'  WEEKLY SEND TYPE F           
         CLI   DBSRC,C'A'                                                       
         BNE   DMUPG4X                                                          
         MVI   SPUPBTYP,C'W'                                                    
         MVI   SPUPBEST,C'N'                                                    
DMUPG4X  EQU   *                                                                
         OC    OPTUPGD,OPTUPGD     IN MKT SHARE W/OUT UPG EXPRESS?              
         BNZ   DMUPG6X             DEFAULT TO INDEX 100 CALL                    
                                                                                
         OC    OPTIMS,OPTIMS                                                    
         BZ    DMUPG6X                                                          
****     MVC   SPUPTYPE(8),=XL8'0400006400000000'                               
         MVC   SPUPTYPE(8),=XL8'0A00006400000000'                               
         MVC   SPUPFBK,0(R3)                                                    
         MVC   SPUPBTYP,3(R3)                                                   
                                                                                
DMUPG6X  EQU   *                                                                
         MVI   THISDEC,C'N'           DONT SUPPORT 2 DEC FOR UPGRADES           
*&&DO                                                                           
         CLI   OPTDEC,C'0'            THIS ALLOWS DEC= CARD FOR                 
         BL    *+8                    UPGRADES - TAKE OUT COMMENTED             
         MVI   THISDEC,C'Y'           WHEN READY                                
*&&                                                                             
*&&DO                                                                           
* 2 DECIMAL CODE                                                                
* BPOO TEST 11/16/2000                                                          
*        DS    0H                  SET UP PRECISION IN DBLOCK EXTNSN            
*                                                                               
         OC    OPTUPBK,OPTUPBK     NO UPGRADE 2 DECIMALS RIGHT NOW TOO          
         BNZ   DEMUP80                                                          
         CLI   OPTDMA,C'I'                                                      
         BNE   DEMUP80                                                          
*                                                                               
         CLI   OPTDEC,C'2'             IF OPTION OF MAINFRAME INVOKED           
         BE    DEMUP65                                                          
*                                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32    ONLY DEM32 HAS 2 DEC               
         BNO   DEMUP80                                                          
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    DEMUP80                                                          
*&&                                                                             
*****                                                                           
*********************************************************************           
* PUT BACK FOLLOWING CODE WHEN READY TO DO DEC=2 FOR UPGRADES****               
**********************************************************************          
DEMUP65  DS    0H                                                               
*&&DO                                                                           
*  IF DEC= CARD GIVEN SET UP THE PRECISION STUFF                                
         CLI   OPTDEC,C'0'                                                      
         BL    DEMUP80                                                          
*                                                                               
         XC    DUB,DUB                                                          
         LA    R0,WORK2                                                         
         ST    R0,DUB+4                                                         
         MVC   DUB+0(4),=C'SPOT'                                                
         MVI   SDBXF,C'S'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         ICM   R1,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTTID,R1                                                       
*                                                                               
**** FOR NOW JUST FOR ZEN'S PRECISION SUPPORT FUDGE THE DISPLACEMENT            
**** UNTIL DBEXTRAD DSECT IS LIVE                                               
****     LA    RE,DBXTRC2T                GIVE ZEN HIS DECMIAL                  
****     SHI   RE,1                        SUPPORT                              
****     MVC   0(1,RE),OPTDEC                                                   
         MVC   DBXTSCTL,OPTDEC                                                  
*                                                                               
         MVC   DBXTID(4),=C'SPOT'                                               
         MVI   DBXTTRP,X'01'               1 DEC RTG/PUT                        
         MVI   DBXTTSP,X'01'               1 DEC SHARS                          
         MVI   DBXTTIP,X'02'               IMP'S TO 100'S                       
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
         TM    TMPWHOLE,WHOLERTG           ROUND RATINGS TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTRC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLESHR           ROUND SHARES  TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTSC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLEPUT           ROUND PUTS    TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTPC2T,C'Y'                YEP                                 
         DROP  R1                                                               
*&&                                                                             
*                                                                               
***********************************************************************         
* NEW CODE TO TEST DEC=2  100404                                      *         
         CLI   DEC2PROJ,C'Y'                                                    
         BNE   DEMUP80                                                          
         CLI   OPTDEC,C'2'             IF OPTION OF MAINFRAME INVOKED *         
         BNE   DEMUP80                                                *         
         OI    SPUPOPTS,SPOP2DEC                                      *         
         OI    SPUPOPT2,SPOP2IPR   2 DEC IMPRESSIONS                            
         MVI   THISDEC,C'Y'           WHEN READY                      *         
***********************************************************************         
* END OF  2 DECIMAL CODE                                                        
DEMUP80  DS    0H                                                               
*                                                                               
*                                  CALL DEMUP TO CALCULATE DEMOS                
         MVC   SPUPUID,USERID                                                   
         GOTO1 VSPDEMUP,DMCB,SPDEMUPD,DEMODEMS,THISDEMS                         
         CLI   0(R1),0             TEST FOR ERRORS                              
         BNE   EXIT                                                             
         MVC   THISAFFL(3),=C'N/A'                                              
         MVC   THISMNUM(3),=C'N/A'                                              
*                                  SET POSTING KEY VALUES & PROG NAME           
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
         MVC   THISPROG,SPUPPRG                                                 
         MVI   THISDAYR,XFF        FORCE HIGHEST DAY # W/IN ROTATION            
         MVC   THISKDAY,THISDAY                                                 
         XI    THISKDAY,X'FF'      SORT TO DAY/TIME END                         
         MVI   THISSQH,X'FF'                                                    
         MVI   THISEQH,X'FF'                                                    
**       BAL   RE,DEMPOST          GO AND POST DEMO VALUES                      
         BAS   RE,DEMPOST          GO AND POST DEMO VALUES                      
         B     EXIT                                                             
         DROP  R6                                                               
         EJECT                                                                  
*&&                                                                             
** UPGRADE ON PAV FILE **                                                       
*                                                                               
DEMUP100 DS    0H                                                               
         L     R0,AIOAREA2                                                      
         LR    R5,R0                                                            
         LH    R1,LIOAREA2                                                      
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE               CLEAR BUFFER FOR ACCUMULATING RECDS          
         MVI   0(R5),RINVKTYQ                                                   
*                                                                               
         XC    CUMSHR(CUMSHRL),CUMSHR                                           
         XC    CUMFCTR,CUMFCTR                                                  
                                                                                
*                                                                               
         DS    0H                                                               
         LA    R6,DBLOCK1                                                       
         ST    R6,ADBLOCK                                                       
         USING DBLOCKD,R6                                                       
*                                                                               
         MVI   GOSUBN,BDB#                                                      
         GOTO1 AGOSUB                                                           
*&&DO                                                                           
         MVI   ZCELLBTY,0                                                       
         MVI   GOSUBN,CHKLIVE#                                                  
         GOTO1 AGOSUB                                                           
*&&                                                                             
         MVI   GOSUBN,CHKNHUT#                                                  
         GOTO1 AGOSUB                                                           
*                                                                               
         NI    MYFLAG1,XFF-MYF1RDOK                                             
         GOTO1 ASETUSID                                                         
DEMUP110 GOTO1 VDEMAND,DMCB,DBLOCK,DMLKPHK,0                                    
*&&DO                                                                           
* REREAD OLD HUT BOOK IF NEW HUT NOT FOUND                                      
         TM    MYFLAG1,MYF1RDOK                                                 
         BNZ   DEMUP120                                                         
         CLI   NHUTFLAG,C'Y'                                                    
         BNE   DEMUP120                                                         
         MVI   NHUTFLAG,C'N'                                                    
         MVC   DBBTYPE,ZSVBKTYP                                                 
         B     DEMUP110                                                         
*&&                                                                             
* CHECK IF WE PROCESSED NEW HUT BOOKTYPE                                        
* CHECK IF WE ARE ASKED FOR ZERO CELL DATA                                      
* IF SO IT WILL SET THE BOOKTYPE TO NON ZEROCELL LOOKUP                         
*&&DO                                                                           
         TM    MYFLAG1,MYF1RDOK                                                 
         BNZ   DEMUP120                                                         
         CLI   ZCELLBTY,0                                                       
         BNE   DEMUP120                                                         
*                                                                               
         MVI   GOSUBN,NONZERO#                                                  
         GOTO1 AGOSUB                                                           
         CLI   ZCELLBTY,X'FF'     IF ORIGINAL BOOKTYPE WAS                      
         BNE   DEMUP110           ZERO CELL - REREAD FOR NON ZEROCELL           
*                                 X'FF'- MEANT NOT A ZEROCELL LOOKUP            
*&&                                                                             
* RESTORE FROM SAVED BOOKTYPE AT CHKLIVEZ                                       
DEMUP120 DS    0C                                                               
         MVC   DBBTYPE,ZSVBKTYP                                                 
*                                                                               
         TM    MYFLAG1,MYF1RDOK                                                 
         BZ    DEMUP199                                                         
                                                                                
*                                                                               
** PROCESS CUMULATIVE RECORD **                                                 
*                                                                               
         DS    0H                  UNWEIGH RECORD                               
         ST    R6,MTHCFACS                                                      
         MVC   MTHFCTR,CUMFCTR                                                  
         MVC   MTHIFIL,=C'INV'                                                  
         MVC   MTHOFIL,=C'INV'                                                  
         MVC   MTHOSRC,=C'NSI'                                                  
                                                                                
         L     RF,AFAC                                                          
         L     RF,(CDEMOMTH-COMFACSD)(RF)                                       
         GOTO1 (RF),DMCB,=C'DIVIDE',AIOAREA2,AIOAREA2,MATHFAC                   
         DROP  R6                                                               
                                                                                
*                                                                               
** APPLY UPGRADE TO CUMULATIVE RECORD **                                        
*                                                                               
         DS    0H                                                               
         L     R5,AIOAREA2         INVENTORY-IZE CUMULATIVE RECORD              
         USING REINVRCD,R5                                                      
                                                                                
*                                                                               
         DS    0H                                                               
         MVC   RINVKSTA,STASTA        INVENTORY KEY FIELD: STATION              
                                                                                
*                                                                               
         DS    0H                                                               
GKS      USING GKSPARMD,GKSPARM                                                 
         MVC   GKS.GKSPRSVC,DBSRC                                               
         MVI   GKS.GKSPQLFY,C' '                                                
         MVC   GKS.GKSPBTYP,OPTUPBT                                             
         CLI   GKS.GKSPBTYP,X'81'     TRANASLATE THE LOWERCASE                  
         BL    *+16                   BOOKTYPES TO UPPERCASE                    
         CLI   GKS.GKSPBTYP,X'B9'                                               
         BH    *+8                                                              
         OI    GKS.GKSPBTYP,X'40'                                               
*^^FUDGE                                                                        
* Jun20/00 (GLEE) - Because we can not fit a booktype of "D" into the           
*                    KeySource field, we should follow the advice we            
*                    give to our REP clients--use an "S" qualifier and          
*                    don't give it a booktype                                   
***      CLI   OPTUPBT,C'D'                                                     
***      BNE   GKSFUDGEX                                                        
         CLI   OPTUPBT,C'D'                                                     
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,C'P'                      ALSO CANT FIT BKTYPE P         
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,C'1'                                                     
         BL    *+12                              CANT FIT ANY MORE              
         CLI   OPTUPBT,C'4'                      BOOKTYPES FUDGE                
         BNH   GKSFUD10                                                         
                                                                                
* also check lowercase                                                          
         CLI   OPTUPBT,C'd'                                                     
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,C'p'                      ALSO CANT FIT BKTYPE P         
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,BOOKTYPE_L3                                              
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,BOOKTYPE_C3                                              
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,BOOKTYPE_W3                                              
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,BOOKTYPE_LS                                              
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,BOOKTYPE_HS                                              
         BE    GKSFUD10                                                         
         CLI   OPTUPBT,BOOKTYPE_WS                                              
         BE    GKSFUD10                                                         
         B     GKSFUDGEX                                                        
GKSFUD10 MVI   GKS.GKSPQLFY,C'S'                                                
         MVI   GKS.GKSPBTYP,0                                                   
GKSFUDGEX EQU  *                                                                
*^^EOFUDGE                                                                      
                                                                                
         GOTO1 =V(GETKSRC),DMCB,(C'Q',GKSPARM),GKSPARM,AFAC,RR=RELO02           
         CLI   DMCB+4,0                                                         
         BE    *+6                                                              
         DC    H'0'                                                             
                                                                                
         MVC   RINVKRSR,GKS.GKSPRSVC  INVENTORY KEY FIELD: RTG SOURCE           
         MVC   RINVKQLF,GKS.GKSPBKBT  INVENTORY KEY FIELD: QUALIFER             
         MVC   RINVKBTP,GKS.GKSPBTYP  INVENTORY KEY FIELD: BOOKTYPE             
         DROP  GKS                                                              
                                                                                
*                                                                               
         DS    0H                                                               
         XC    WORK2,WORK2                                                      
RIZ      USING RINVZEL,WORK2                                                    
         MVI   RIZ.RINVZCOD,X'CE'                                               
         MVI   RIZ.RINVZLEN,10                                                  
*                                                                               
         DS    0H                                                               
         LA    R0,5                                                             
         LR    R6,R2                                                            
         CLC   0(3,R2),=C'ROT'                                                  
         BNE   DEMUP145                                                         
                                                                                
         ZICM  RE,3(R2),(3)                                                     
         LA    RE,LDTROTN(RE)                                                   
         ZIC   R1,0(RE)                                                         
         BCTR  R1,0                                                             
         LR    R0,R1                                                            
         LA    R6,1(RE)                                                         
*                                                                               
DEMUP145 DS    0H                  R6-->DAYS/TIMES                              
         MVC   RIZ.RINVZDAY,0(R6)                                               
         MVC   RIZ.RINVZTIM,1(R6)                                               
         LA    RE,DBLOCK1                                                       
         USING DBLOCKD,RE                                                       
         MVC   RIZ.RINVZBK+1(2),DBSELBK                                         
         DROP  RE                                                               
                                                                                
         GOTO1 VHELLO,DMCB,(C'P',=C'REPFIL'),RINVREC,RIZ.RINVZEL,0              
         CLI   DMCB+12,0                                                        
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         DS    0H                                                               
         LA    R6,5(R6)                                                         
         SH    R0,=H'5'                                                         
         BP    DEMUP145                                                         
         BZ    *+6                                                              
         DC    H'0'                                                             
         DROP  RIZ                                                              
                                                                                
*                                                                               
         DS    0H                                                               
         MVC   DIVISOR,CUMFCTR                                                  
         MVI   GOSUBN,DIVSHR#      UNWEIGHT THE SHARES INTO  HOMSHR             
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         DS    0H                                                               
         XC    WORK,WORK                                                        
         LA    RF,WORK             BUILD UPGRADE ELEMENT IN  WORK               
         USING RAVLNEL,RF                                                       
         MVI   RAVLNCOD,X'05'                                                   
         MVI   RAVLNLEN,14                                                      
         MVC   RAVLNBT,OPTUPBT                                                  
         MVC   RAVLNTYP(L'OPTUPGD),OPTUPGD                                      
         DROP  RF                                                               
*                                                                               
         LA    R0,RINVPEL-RINVREC                                               
         A     R0,AIOAREA2         R0-->1ST ELEMENT OF RECORD                   
         MVI   FROMTYPE,C'I'                                                    
         MVC   BYTE,PRECPROF                                                    
         MVC   DUB+0(4),=C'RID='                                                
         MVC   DUB+4(2),AGYALPH                                                 
         GOTO1 VREDEMUP,DMCB,(FROMTYPE,(R0)),(BYTE,WORK),AFAC,DUB,     +        
               HOMSHR                                                           
                                                                                
*                                                                               
** POST DATA FROM UPGRADED DEMOS **                                             
*                                                                               
* 2 DECIMAL CODE                                                                
*^^TEST                                                                         
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
*^^EOTEST                                                                       
*                                                                               
* END OF DECIMAL CODE                                                           
         DS    0H                                                               
         L     R5,AIOAREA2                                                      
         LA    R0,DEMODEMS                                                      
         ST    R0,ADEMLIST                                                      
         MVI   GOSUBN,XDV#         EXTRACT DEMO VALUES                          
         GOTO1 AGOSUB                                                           
         DROP  R5                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   *+8                                                              
         MVI   RECTYPE,TDRRTDMV                                                 
         MVC   THISPROG,CUMPNAM1                                                
         CLC   CUMPNAM1,CUMPNAM2                                                
         BE    *+14                                                             
         MVI   THISPROG+(L'THISPROG/2),C'/'                                     
         MVC   THISPROG+((L'THISPROG/2)+1)((L'THISPROG/2)-1),CUMPNAM2           
         MVC   THISWKS,CUMWKS                                                   
         MVC   THISPURE,=X'FFFF'                                                
         MVI   THISLBK,X'9C'       FORCE HIGHEST (PACKED) LATEST BK #           
         MVI   THISDAYR,XFF        FORCE HIGHEST DAY # W/IN ROTATION            
         MVC   THISKDAY,THISDAY                                                 
         XI    THISKDAY,XFF                                                     
         MVI   THISSQH,XFF                                                      
         MVI   THISEQH,XFF                                                      
         BAS   RE,DEMPOST                                                       
DEMUP199 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         B     EXIT                                                             
         EJECT                                                                  
* INTERFACE TO SPDEMLK FOR SVI PROCESSING                                       
*                                                                               
DEMLOOK  NTR1                                                                   
         MVI   GOSUBN,DMLK#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         B     EXIT                                                             
         DROP  R4                                                               
         EJECT                                                                  
         DS    0H                  DEMAND HOOK FOR PAV FILE LOOK-UP             
* At entry,                                                                     
*   R2-->requested day/time entry,                                              
*   R3-->requested book entry,                                                  
*   R4-->requested station entry.                                               
                                                                                
DMLKPHK  NTR1                                                                   
         MVI   GOSUBN,PVHK#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
DMLKPHKX DS    0H                                                               
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* BUILD BINSRCH RECORD & CALL ROOT POST ROUTINE                                 
*                                                                               
DEMPOST  NTR1                                                                   
         MVI   GOSUBN,DPST#        CALL ADDRESSABLE ROUTINE                     
         GOTO1 AGOSUB                                                           
         B     EXIT                                                             
         EJECT                                                                  
*                                                                               
* FORMAT PRINT LINES                                                            
*                                                                               
         USING STABKD,R4                                                        
DEMLINE  L     R5,BINAREC                                                       
         USING BINRECD,R5          R5=A(RECORD)                                 
*                                                                               
         CLI   DBMED,C'C'          BBM MONTHLY AVERAGED BOOKS                   
         BNE   DEMLINE1            REQUIRE PERIOD ACTION                        
         CLI   DBSRC,C'A'                                                       
         BNE   DEMLINE1                                                         
         TM    MYFLAG2,MYF1SEWK                                                 
         BZ    DEMLINE1                                                         
         L     RF,ADEMFIL                                                       
         CLC   =C'TP',8(RF)                                                     
         BNE   DEMLINE1                                                         
         CLI   ACTN,DEMOQHR                                                     
         BNE   DEMLINE1                                                         
         MVI   FERN,43                                                          
         MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
DEMLINE1 DS    0H                                                               
*                                                                               
                                                                                
         TM    DEMFLAG1,DF1STERO   IS THIS A STEREO SESSION?                    
         BO    DEMLIN20             YES, DO STEREO LOGIC                        
                                                                                
*                                                                               
         DS    0H                  DISPLAY DISCLAIMER IF EXPLODING WKS          
         CLI   NLINE,0                   ONLY ON 1ST LINE OF DISPLAY            
         BH    DLDSCLMX                                                         
         TM    MISCFLG1,MF1WKACR         ONLY FOR DISPLAYING WKS ACROSS         
         BZ    DLDSCLMX                                                         
         LA    RF,LINE1                                                         
         MVC   WKDSCLMD(WKDSCLML,RF),WKDSCLMR  MOVE DISCLAIMER MSG, AND         
         MVI   APMODE,SAMEREC                   WANT SAME RECORD BACK           
         B     EXIT                                                             
DLDSCLMX EQU   *                                                                
*                                                                               
         CLI   BINBK,X'FF'         TEST FOR E-O-F RECORD                        
         BE    EXIT                                                             
*                                  TEST FOR CHANGE OF BOOK                      
         CLC   BINBK,THISBK                                                     
         BNE   *+14                                                             
         CLC   BINLBK,THISLBK                                                   
         BE    DLNLBK                                                           
         MVC   THISBK,BINBK        SET THIS BOOK EQ PREVIOUS                    
         MVC   THISLBK,BINLBK                                                   
         XC    THISPROG(L'THISPROG*MAXSTAS),THISPROG                            
         XC    THISBOOK(L'THISBOOK*MAXSTAS),THISBOOK                            
         XC    THISDAY(THISKEYX-THISDAY),THISDAY                                
*                                  FORMAT ACTUAL BOOK LINE                      
         LA    R4,DBSTABK          R4=A(STATION/BOOK TABLE)                     
         LA    R3,DATADISP         R3=DISP. TO DATA VALUES                      
         ZIC   R0,NSTAS            R0=N'STATIONS                                
DEMLINE2 ZIC   RE,THISBK           INDEX INTO STATION LINE FOR BOOK             
         LA    RF,L'STABKS                                                      
         MR    RE,RE                                                            
         LA    RF,STABKS-L'STABKS(RF)                                           
         MVC   DUB(2),0(RF)        SAVE BOOK VALUE IN DUB                       
***      CLC   =X'6A',DUB                                                       
***      BNE   *+6                                                              
***      DC    H'0'                                                             
*^^GYL   MVI   DUB+2,1                                                          
         MVC   DUB+2(1),2(RF)      SAVE WEEK NUMBER                             
         MVC   DUB+3(1),3(RF)      SAVE BOOK TYPE                               
         LA    RF,LINE1            BOOKS GO TO LINE 1                           
         CLI   NSTAS,1             TEST ONE STATION LOOK-UP                     
         BE    *+8                                                              
         AH    RF,0(R3)            RF=A(EDITTED BOOK VALUE)                     
         CLC   DUB(2),INVBOOK      TEST FOR SPECIAL BOOK VALUES                 
         BNE   *+14                                                             
         MVC   0(6,RF),=C'INV/BK'                                               
         B     DEMLINE3                                                         
         CLC   DUB(2),ESTBOOK                                                   
         BNE   *+14                                                             
         MVC   0(6,RF),=C'EST/BK'                                               
         B     DEMLINE3                                                         
         CLC   DUB(2),MBKBOOK                                                   
         BNE   *+14                                                             
         MVC   0(6,RF),=C'MULTBK'                                               
         B     DEMLINE3                                                         
         CLI   DUB,XFF                                                          
         BNE   DEMLIN2A                                                         
         ZIC   R3,BINSTA                                                        
         B     DLNLBK20                                                         
                                                                                
DLNLBK   DS    0H                  CHECK FOR LATEST N BOOKS                     
         ZIC   RE,BINSTA                                                        
         LR    R3,RE                HOLD STATION NUMBER IN R3                   
         BCTR  RE,0                                                             
         LA    RF,STABKL                                                        
         MR    RE,RE                                                            
         LA    R4,DBSTABK(RF)      R4-->STATION/BOOKS ENTRY                     
         ZIC   R0,THISBK                                                        
         LA    R1,L'STABKS                                                      
         MR    R0,R0                                                            
         LA    R1,STABKS-L'STABKS(R1)                                           
         MVC   DUB(4),0(R1)                                                     
                                                                                
         CLI   DUB,XFF             ASKED FOR LATEST N BOOKS?                    
         BNE   DEMLINE4                                                         
                                                                                
DLNLBK20 DS    0H                  FORMAT LATEST NTH BOOK INTO HEADING          
         LR    RE,R3                                                            
         BCTR  RE,0                                                             
         LA    RF,L'THISBOOK                                                    
         MR    RE,RE                                                            
         LA    RF,THISBOOK(RF)                                                  
         CLC   0(L'THISBOOK,RF),BINBOOK                                         
         BE    DEMLINE4                                                         
                                                                                
         MVC   0(L'THISBOOK,RF),BINBOOK                                         
         MVC   DUB(2),BINBOOK                                                   
         BCTR  R3,0                                                             
         SLL   R3,1                                                             
         LA    R3,DATADISP(R3)                                                  
         LA    R0,1                                                             
         LA    RF,LINE1                                                         
         CLI   NSTAS,1                                                          
         BE    *+8                                                              
         AH    RF,0(R3)                                                         
                                                                                
DLNLBK2A DS    0H                  FORMAT LATEST NTH BOOK INTO HEADING          
         CLI   DUB,XFF                                                          
         BNE   DLNLBKX                                                          
         MVC   0(3,RF),=C'LAT'       ELSE, INDICATE LATEST N                    
         MVC   4(1,RF),DUB+1                                                    
         B     DEMLINE3                                                         
DLNLBKX  EQU   *                                                                
*                                  SHOW THE BOOK IN MMM/YY FORMAT               
DEMLIN2A DS    0H                                                               
         ST    RF,FULL             SAVE OUTPUT POINTER                          
         CLI   DBMED,C'N'                                                       
         BNE   *+20                                                             
         CLI   DBSRC,C'K'          NETWORK/NTI WEEKLY?                          
         BE    DEMLIN2M                                                         
         CLI   DBSRC,C'C'          NETWORK/NTI CABLE WEEKLY?                    
         BE    DEMLIN2M                                                         
         CLI   DBMED,C'W'          WEEKLY TIME PERIOD                           
         BE    DEMLIN2J                                                         
         CLI   DBMED,C'O'          OVERNIGHT ALSO SHOW AS WEEKLY BOOK           
         BE    DEMLIN2J                                                         
                                                                                
         MVI   STARTDAY,0                                                       
         NI    MYFLAG1,XFF-MYF1SEWK ASSUME DON'T NEED START/END WEEKS           
         CLI   DBMED,C'C'          CHECK FOR CANADIEN                           
         BNE   DEMLIN2I                                                         
*                                                                               
         CLI   DBSRC,C'A'           CHECK FOR BBM                               
         BE    DMLNCANBBM            PROCESS DIFFERENTLY FOR BBM                
         CLI   DBSRC,C'N'           NIELSEN                                     
         BNE   DEMLIN2I                                                         
         CLC   DBFIL,=C'TP '        TIME PERIOD                                 
         BNE   DEMLIN2I                                                         
         OI    MYFLAG1,MYF1SEWK     FLAG TO GET START/END WEEKS                 
         MVC   THISSWKN(2),BINBOOK REMEMBER START/END WEEKS OF MONTH            
* CHECK FOR LATEST AND IF DUB>X'6001'.                                          
* WE WILL HAVE TO FORMAT THE WEEKLY BOOK OF THE LAST WEEK TO MONTH              
*                                                                               
                                                                                
*        TM    MISCFLG1,MF1BKVWK   VALIDATED AS WEEK?                           
*        BZ    DEMLIN2I                                                         
         NI    MYFLAG1,XFF-MYF1SEWK   (WE DON'T NEED START/END WEEKS)           
         CLC   DUB(2),=X'6001'      ON OR AFTER JAN/96                          
         BL    DEMLIN2I                                                         
         L     RE,ADEMFIL                                                       
         CLC   =C'TP',8(RE)                                                     
         BNE   DEMLIN2AB                                                        
                                                                                
         MVI   GOSUBN,FCANLAT#     ONLY DO THIS IF WE ASK FOR FILE              
         GOTO1 AGOSUB              TP (MONTHLY)                                 
         B     DEMLIN2R                                                         
                                                                                
DEMLIN2AB DS   0X                                                               
         TM    MISCFLG1,MF1BKVWK   VALIDATED AS WEEK?                           
         BZ    DEMLIN2I                                                         
         MVI   STARTDAY,1          OVERRIDE START DAY TO MONDAY                 
         B     DEMLIN2L                                                         
                                                                                
DMLNCANBBM DS  0H                  CANADIAN BBM                                 
         CLC   DBFIL,=C'TP '        TIME PERIOD                                 
         BNE   DEMLIN2I                                                         
         CLI   DUB+3,C'W'           BOOK TYPE = "W"                             
         BNE   DEMLIN2I                                                         
                                                                                
         OI    MYFLAG1,MYF1SEWK     FLAG TO GET START/END WEEKS                 
         MVC   THISSWKN(2),BINBOOK  REMEMBER START/END WEEKS OF MONTH           
*                                                                               
         L     RE,ADEMFIL                                                       
         CLC   =C'TP',8(RE)                                                     
         BNE   DEMLIN2D                                                         
         MVI   GOSUBN,FCANLAT#     ONLY DO THIS IF WE ASK FOR FILE              
         GOTO1 AGOSUB              TP (MONTHLY)                                 
*        CLC   =X'6A',DUB                                                       
*        BNE   *+6                                                              
*        DC    H'0'                                                             
         B     DEMLIN2R                                                         
*                                                                               
DEMLIN2D TM    MISCFLG1,MF1BKVWK    VALIDATED AS WEEK?                          
         BZ    DEMLIN2I                                                         
         MVI   STARTDAY,1           OVERRIDE START DAY TO MONDAY                
         NI    MYFLAG1,XFF-MYF1SEWK   (WE DON'T NEED START/END WEEKS)           
         B     DEMLIN2L                                                         
DEMLIN2I EQU   *                                                                
                                                                                
         B     DEMLIN2N                                                         
                                                                                
DEMLIN2J DS    0H                  WEEK#/YEAR FORMAT                            
         ST    R0,FULL2                                                         
         MVC   BYTE,DUB+3          SAVE OFF BOOKTYPE                            
         EDIT  (1,DUB+1),(3,0(RF)),FILL=0,TRAIL=C'/',DUB=DUB2                   
         EDIT  (1,DUB),(2,3(RF)),FILL=0                                         
         L     R0,FULL2                                                         
         MVC   DUB+3(1),BYTE       RESTORE BOOKTYPE                             
         B     DEMLIN2R                                                         
*                                                                               
DEMLIN2L DS    0H                  MMMDD/YY FORMAT                              
         CLI   DBMED,C'O'                                                       
         BNE   *+8                                                              
         MVI   STARTDAY,1                                                       
         GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     X        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         B     DEMLINMM                                                         
*                                                                               
DEMLIN2M DS    0H                  MMMDD/YY FORMAT                              
         MVC   DMCB+4(4),=X'D9000A1D'                                           
         LA    R1,DMCB                                                          
         GOTO1 VCALLOV,(R1),0                                                   
         ICM   RE,15,0(R1)                                                      
         XC    DMCB,DMCB                                                        
         ST    RE,DMCB+16          PASS A(GETBROAD) TO NETUNBK                  
         L     RF,=V(NETUNBK)                                                   
         A     RF,RELO02                                                        
         GOTO1 (RF),DMCB,(C'W',DUB),DUB2,VGETDAY,VADDAY                         
*                                                                               
DEMLINMM ST    R0,FULL2                                                         
         L     R0,FULL             R0-->OUTPUT AREA                             
         GOTO1 VDATCON,DMCB,(X'80',DUB2),(5,(R0))                               
         L     R0,FULL2                                                         
         L     RF,FULL             BUMP OUTPUT POINTER SO                       
         LA    RF,3(RF)                                                         
         ST    RF,FULL              BOOKTYPE WON'T OVERWRITE DATE               
         B     DEMLIN2R                                                         
*                                                                               
DEMLIN2N DS    0H                  NORMAL BOOK FORMAT                           
         GOTO1 VDATCON,DMCB,(3,DUB),(6,0(RF))                                   
*                                                                               
**       CLC   =X'6A',DUB                                                       
**       BNE   *+6                                                              
**       DC    H'0'                                                             
         L     RF,FULL                                                          
         MVC   3(2,RF),4(RF)        DISPLAY AS  MMMYY                           
         MVI   5(RF),C' '                                                       
         AHI   RF,-1                                                            
         ST    RF,FULL                                                          
*                                                                               
* HAVE TO PUT BACK WHEN MORE SPACE IS ALLOCATED                                 
                                                                                
DEMLIN2R DS    0H                                                               
*                                                                               
         CLI   DBMED,C'U'          COUNTY COVERAGE COVERT BOOKTYPE              
         BNE   DEMLIN2RN           TO STATE CODE                                
         CLI   DUB+3,0             MUST HAVE STATECODE                          
         BNE   *+6                 OR ELSE SOMETHING IS                         
         DC    H'0'                REALLY AMISS                                 
         MVI   GOSUBN,GSTATE#                                                   
         GOTO1 AGOSUB                                                           
         LHI   R1,6                                                             
         L     RF,FULL             RESTORE OUTPUT POINTER                       
         MVI   6(RF),C'('          TACK ON (BOOK TYPE)                          
         MVC   7(2,RF),HALF                                                     
         MVI   9(RF),C')'                                                       
         AHI   R1,4                ADJUST FOR L(BOOKTYPE)                       
         B     DEMLIN2RR                                                        
*                                                                               
DEMLIN2RN EQU  *                                                                
*                                                                               
         LHI   R1,6                                                             
         L     RF,FULL             RESTORE OUTPUT POINTER                       
         CLI   DUB+3,0             TEST FOR ANY BOOK TYPE                       
         BE    DEMLIN2RR           NO                                           
         MVI   6(RF),C'('          TACK ON (BOOK TYPE)                          
*******  MVC   7(1,RF),DUB+3                                                    
* DISPLAY 2 CHARACTER BOOKTYPE                                                  
         XC    DMCB2,DMCB2                                                      
         MVI   DMCB2,12                                                         
         MVC   DMCB2+1(1),DUB+3                                                 
***      MVI   GOSUBN,TRNSBT#      TRANSLATE BOOK                               
***      GOTO1 AGOSUB                                                           
         GOTO1 ATRANSBT                                                         
         L     RF,FULL             RESTORE OUTPUT POINTER                       
         LHI   R1,6                                                             
         MVC   7(2,RF),=C'??'                                                   
         CLI   DMCB2+4,X'FF'                                                    
         BE    *+10                                                             
         MVC   7(2,RF),DMCB2+4                                                  
*                                                                               
         CLI   DMCB2+5,0           1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    DEMLIN2RP                                                        
         CLI   DMCB2+5,X'40'       1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    DEMLIN2RP                                                        
*                                                                               
         MVI   9(RF),C')'          2 CHARACTER BOOKTYPE                         
         AHI   R1,4                ADJUST FOR L(BOOKTYPE)                       
         B     DEMLIN2RR                                                        
*&&DO                                                                           
         CLI   DBMED,C'T'                                                       
         BNE   DEMLIN2RP                                                        
         CLI   7(RF),X'81'                                                      
         BL    *+16                                                             
         CLI   7(RF),X'B9'                                                      
         BH    *+8                                                              
         OI    7(RF),X'40'       CAPITAL LETTERS                                
*&&                                                                             
DEMLIN2RP EQU  *                                                                
         MVI   8(RF),C')'          1 CHAR BOOKTYPE                              
         AHI   R1,3                ADJUST FOR L(BOOKTYPE)                       
DEMLIN2RR EQU  *                                                                
         AR    RF,R1                                                            
         ST    RF,FULL             FULL = A(NEXT OUTPUT AREA)                   
*                                                                               
DEMLIN2W DS    0H                  DISPLAY ACTUAL DATES OF WEEKS                
         L     RF,ADEMFIL                                                       
         CLI   DBMED,C'C'                                                       
         BNE   DEMLIN2X                                                         
*                                                                               
         CLC   =C'TP',8(RF)         IF MONTHLY BOOK - SHOW THE WEEKS            
***      BE    DEMLIN2Y            IF THE MONTHLY BOOK WAS FROM WEEKLY          
         BNE   DEMLIN2X                                                         
         TM    MYFLAG2,MYF1SEWK                                                 
         BZ    DEMLIN2WG                                                        
         B     DEMLIN2Y                                                         
*                                                                               
DEMLIN2X TM    MYFLAG1,MYF1SEWK    ONLY IF FLAGGED TO GET START/END WKS         
         BZ    DEMLIN2WG                                                        
DEMLIN2Y DS    0H                                                               
*new  statement below                                                           
**       MVC   THISSWKN(2),BINBOOK  REMEMBER START/END WEEKS OF MONTH           
         LHI   RF,X'6001'          FOR CSI, BOOK HAS TO BE >= JAN/96            
         CLI   DBSRC,C'N'                                                       
         BE    DEMLIN2WC                                                        
         LHI   RF,X'6301'          FOR BBM, BOOK HAS TO BE >= JAN/99            
         CLI   DBSRC,C'A'                                                       
         BE    DEMLIN2WC                                                        
         DC    H'0'                                                             
DEMLIN2WC EQU  *                                                                
         CLM   RF,3,DUB            SKIP IF CUT-OFF DATE  > BOOK                 
         BH    DEMLIN2WG                                                        
         MVC   WORK(9),SPACES       GET DATES OF START/END WEEKS                
         MVC   HALF+0(1),DUB        HALF+0(1) = YEAR                            
         MVC   HALF+1(1),THISSWKN   HALF+1(1) = START WEEK#                     
         GOTO1 VNSIWEEK,DMCB,(C'D',HALF),(1,VGETDAY),VADDAY,VDATCON             
         ZICM  RE,DMCB+1,(7)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   WORK+0(4),2(RE)                                                  
         MVI   WORK+4,C'-'                                                      
         MVC   HALF+1(1),THISEWKN   HALF+1(1) = END   WEEK#                     
         GOTO1 (RF),(R1),(C'D',HALF)                                            
         ZICM  RE,DMCB+1,(7)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(RE)                                                    
         GOTO1 VADDAY,(R1),DUB2,DUB2,6                                          
         MVC   WORK+5(4),DUB2+2                                                 
         L     RF,FULL                                                          
         MVI   0(RF),C':'                                                       
         MVC   1(9,RF),WORK                                                     
         AHI   RF,10                                                            
         ST    RF,FULL                                                          
*                                                                               
DEMLIN2WG EQU  *                                                                
                                                                                
*                                                                               
DEMLINE3 LA    R4,STABKL(R4)       BUMP TO NEXT STATION                         
         LA    R3,2(R3)                                                         
         BCT   R0,DEMLINE2         DO FOR NUMBER OF STATIONS                    
                                                                                
         DS    0H                  WEEK-NUMBER CAPTION                          
         MVC   WORK(4),SPACES                                                   
         CLI   NSTAS,1              IF ONLY ONE STATION,                        
         BNE   *+10                                                             
         MVC   WORK(4),LINE1+9       INIT TO WHAT'S THERE ALREADY               
         CLI   DBMED,C'W'           CAN'T BE WEEKLY TIME PERIOD                 
         BE    DEMLIN3B                                                         
         TM    MISCFLG1,MF1WKACR    CAN'T BE DISPLAYING WEEKS ACROSS            
         BO    DEMLIN3B                                                         
         CLI   DUB+2,0              SEE IF ANY WEEK INDICATOR                   
         BE    DEMLIN3B                                                         
         MVC   WORK(2),=C'WK'                                                   
         MVC   WORK+3(1),DUB+2                                                  
         OI    WORK+3,X'F0'                                                     
                                                                                
DEMLIN3B DS    0H                                                               
         MVC   LINE1+9(4),WORK                                                  
         CLI   NSTAS,1             TEST IF ONE STATION ONLY                     
         BE    DEMLINE4                                                         
         MVI   LINE1,C'*'          NO - INDICATE NEW BOOK LINE                  
         MVC   LINE1+1(12),LINE1                                                
         CLC   WORK(4),SPACES                                                   
         BE    *+10                                                             
         MVC   LINE1+5(4),WORK                                                  
*                                  TEST FOR CHANGE OF DAY/TIME                  
*EMLINE4 CLC   THISDAY(THISTYPE-THISDAY),BINDAY                                 
*        BE    DEMLINE6                                                         
DEMLINE4 DS    0H                                                               
**       CLC   THISDAY(THISTYPE-THISDAY),BINDAY                                 
**       BE    DEMLINE6                                                         
*                                                                               
         CLC   THISDAY(THISTYPE-THISDAY),BINDAY                                 
         BNE   DEMLIN4B                                                         
         CLC   THIS1WK,BIN1WK      IF SAME DAY/TIME BUT DIFFERENT               
         BNE   DEMLIN4B            1ST WEEK AIRED                               
         B     DEMLINE6                                                         
*                                                                               
DEMLIN4B MVC   THISDAY(THISKEYX-THISDAY),BINDAY                                 
         CLI   BINTYPE,BINTDEM     TEST DEMO LINE                               
         BNE   DEMLINE7                                                         
         MVC   TMPKSE,BINKDAY      GET KDAY, STRT & END QH FOR GETDAY           
*&&DO                                                                           
         BAL   RE,GETDAY                                                        
*&&                                                                             
         ZIC   R0,BINQHAF           GET QH ADJ FCTR FROM RECD,                  
         SHI   R0,(100+100)          CONVERT FROM 100-BASED,                    
         LCR   R0,R0                 AND COMPLEMENT ADJ FCTR                    
         STC   R0,THISQHAF           TO GET REAL QHs POST-SORT                  
         MVI   GOSUBN,ADJQH#                                                    
         GOTO1 AGOSUB                                                           
         MVC   THISNDYS,BINNDAYS                                                
         MVI   GOSUBN,GDY#                                                      
         GOTO1 AGOSUB                                                           
         LA    RF,LINE3            DAY/TIME GOES ON LINE 3,                     
         CLC   DBFIL,=C'PAV'                                                    
         BNE   *+8                                                              
         LA    RF,LINE2             EXCEPT IF PAV, IT GOES ON LINE 2            
         LA    RE,DAYTIME          OUTPUT IS USUALLY FOUND HERE,                
         CLC   DAYTIME(3),=C'ROT'                                               
         BNE   *+8                                                              
         LA    RE,WORK2             BUT FOR ROTATIONS, IT'S HERE                
         MVC   0(L'DAYTIME,RF),0(RE)                                            
*^^GYL   MVC   LINE3(L'DAYTIME),DAYTIME                                         
         B     DEMLINE8                                                         
*                                  TEST FOR CHANGE OF LINE TYPE                 
DEMLINE6 CLC   THISTYPE,BINTYPE                                                 
         BE    DEMLINE8                                                         
         MVC   THISTYPE,BINTYPE                                                 
*                                  OUTPUT SHARE/HPT LINE NAME                   
DEMLINE7 CLI   THISTYPE,BINTSHR                                                 
         BNE   *+10                                                             
         MVC   LINE3+3(5),=C'SHARE'                                             
         CLI   THISTYPE,BINTHPT                                                 
         BNE   *+10                                                             
         MVC   LINE3+3(5),=C'H/P/T'                                             
*                                  GET STATION DATA DISPLACEMENT                
DEMLINE8 DS    0H                                                               
         MVC   THIS1WK,BIN1WK                                                   
         MVC   THISNOR,BINNOR                                                   
         MVC   THISPURE,BINPURE                                                 
         MVC   THISWKS,BINWKS                                                   
         MVC   THISASQC,BINASQC                                                 
         MVC   THISAEQC,BINAEQC                                                 
         MVC   THISSTA,BINSTA                                                   
         ZIC   R1,BINSTA                                                        
         BCTR  R1,0                                                             
         LR    RF,R1                                                            
         SLL   R1,1                                                             
         LA    R1,DATADISP(R1)                                                  
         MVC   FULL(2),0(R1)       SAVE DATA DISPLACEMENT                       
*                                  TEST CHANGE OF PROGRAM NAME                  
         CLI   OPTPROG,C'N'        TEST IF PROGRAM NOT REQUIRED                 
         BE    DEMLINE9                                                         
         LA    RE,L'THISPROG                                                    
         MR    RE,RE                                                            
         LA    RF,THISPROG(RF)     RF=A(PROGRAM NAME FOR THIS STATION)          
         CLC   DBFIL,=C'PAV'       IF PAV FILE,                                 
         BE    *+14                 ALWAYS DISPLAY PROGRAM NAME                 
         CLC   BINPROG,0(RF)                                                    
         BE    DEMLINE9                                                         
         MVC   0(L'THISPROG,RF),BINPROG                                         
         LA    RF,LINE2            PROGRAM NAMES GO TO LINE 2                   
         LH    R0,FULL             R0 = DISPLACEMENT ACROSS SCREEN              
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BO    DEMLIN8C             DISPLACE PROG NAME TO COLUMN                
         CLI   NSTAS,1             TEST ONE STATION LOOK-UP                     
         BH    DEMLIN8C             IF MORE, DISPLACE PROG NAME                 
         CLC   DBFIL,=C'PAV'       IF PAV FILE,                                 
         BE    DEMLIN8C             DISPLACE PROG NAME TOO                      
         SR    R0,R0               OTHERWISE, DON'T DISPLACE PROG NAME          
DEMLIN8C AR    RF,R0                                                            
         MVC   WORK(15),BINPROG                                                 
                                                                                
         TM    BINFLAG1,BF11HHR                                                 
         BZ    DEMLIN8E                                                         
         CLC   BINASQC,BINSQH                                                   
         BNL   DEMLIN8E                                                         
         MVI   WORK,C'+'                                                        
         MVC   WORK+1(14),BINPROG                                               
                                                                                
DEMLIN8E DS    0H                  FORMAT RIGHT-END OF PROG NAME                
         LA    R1,WORK+14                                                       
         TM    BINFLAG1,BF1XHHR                                                 
         BZ    DEMLIN8G                                                         
         CLC   BINAEQC,BINEQH                                                   
         BL    DEMLIN8G                                                         
**       BE    DEMLIN8G                                                         
         BCTR  R1,0                                                             
         MVI   0(R1),C' '                                                       
         MVI   1(R1),C'+'           PROGRAM CONTINUATION                        
                                                                                
DEMLIN8G DS    0H                                                               
         CLC   DBFIL,=C'PAV'                                                    
         BNE   DEMLIN8X                                                         
         TM    MISCFLG1,MF1WKACR                                                
         BO    DEMLIN8X                                                         
         CLI   THISNOR,0                                                        
         BE    DEMLIN8H                                                         
         BCTR  R1,0                                                             
         MVI   0(R1),C' '                                                       
         MVI   1(R1),C'N'          NOR PROGRAM INDICATION                       
                                                                                
DEMLIN8H DS    0H                                                               
         MVC   TMPWKS,THISWKS                                                   
         ST    RF,SAVERF                                                        
         MVI   GOSUBN,GWK#                                                      
         GOTO1 AGOSUB                                                           
         L     RF,SAVERF                                                        
         SH    R1,=H'4'                                                         
         MVI   0(R1),C' '                                                       
         MVC   1(4,R1),ACTVWKS     ACTIVE WEEKS INDICATOR                       
*                                                                               
*                                                                               
                                                                                
DEMLIN8X DS    0H                                                               
*&&DO                                                                           
         MVC   0(15,RF),BINPROG                                                 
*&&                                                                             
         MVC   0(15,RF),WORK                                                    
*                                                                               
*                                                                               
*                                                                               
*                                  EDIT DEMO VALUES                             
DEMLINE9 DS    0H                                                               
*                                                                               
         LA    R2,LINE3            DEMO VALUES GO TO LINE 3                     
         AH    R2,FULL                                                          
         LA    R3,DEMS             R3=A(DEMO EXPRESSIONS)                       
         LA    R4,BINDEMS          R4=A(DEMO VALUES)                            
         ZIC   R0,NDEMS            R0=N'DEMOS                                   
*                                                                               
DEMLINEA DS    0H                                                               
*&&DO                                                                           
         BAL   RE,GETDEM           EDIT DEMO VALUE                              
*&&                                                                             
         MVC   SVBINDEC,BINDEC                                                  
         MVI   GOSUBN,GDM#         EDIT DEMO VALUE                              
         GOTO1 AGOSUB                                                           
         LA    R2,DEMWIDTH(R2)     BUMP TO NEXT DEMO                            
         LA    R3,L'DEMS(R3)                                                    
         LA    R4,L'BINDEMS(R4)                                                 
         BCT   R0,DEMLINEA         DO FOR NUMBER OF DEMOS                       
*                                                                               
*                                                                               
*                                  TEST IF NEXT RECORD IS WANTED NOW            
         A     R5,BINLREC          GO FORWARD ONE RECORD                        
         CLC   BINKEY(BINSTA-BINKEY),THISKEY                                    
         BNE   *+8                                                              
         MVI   APMODE,NEXTREC      TELL ROOT I WANT ANOTHER RECORD              
         B     EXIT                                                             
         DROP  R4                                                               
         EJECT                                                                  
DEMLIN20 DS    0H                  STEREO SESSION - USE SPECIAL FORMAT          
         LA    R1,TSARBLCK                                                      
         USING TSARD,R1                                                         
         SR    R5,R5                                                            
         ICM   R5,7,TSAREC+1                                                    
         DROP  R1                                                               
                                                                                
         LA    R5,2(R5)            R5-->TSAR DEMO RECORD                        
         USING TSDEMRCD,R5                                                      
         L     R2,ASTIOBUF         R2-->STEREO'S I/O BUFFER                     
         L     RE,ASTDMEXP                                                      
         MVC   STNDEMS,0(RE)                                                    
*                                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BO    DMLN200                                                          
*                                                                               
         DS    0H                  GO TO LOGIC CORRESPONDING TO RCD TYP         
         CLI   TDRRCTYP,TDRRTDMV    DEMO VALUES                                 
         BE    DEMLIN26                                                         
         CLI   TDRRCTYP,TDRRTDTL    DAY/TIME LIST                               
         BE    DEMLIN21                                                         
         CLI   TDRRCTYP,TDRRTDML    DEMO LIST                                   
         BE    DEMLIN22                                                         
         DC    H'0'                                                             
*                                                                               
** OUTPUT DAY/TIME LIST **                                                      
*                                                                               
DEMLIN21 DS    0H                  RECORD CONTAINS DAY/TIME LIST                
         MVI   GOSUBN,ODT#                                                      
         GOTO1 AGOSUB                                                           
         B     DEMLINX                                                          
*                                                                               
** OUTPUT DEMO MODIFIERS **                                                     
*                                                                               
DEMLIN22 DS    0H                  RECORD CONTAINS DEMO LIST                    
         L     RE,ASTDMEXP                                                      
         LA    RE,1(RE)            RE-->DESTINATION                             
         ZIC   RF,STNDEMS                                                       
         MH    RF,=Y(L'DEMS)                                                    
         LA    RF,1(RF)            RF = LENGTH TO MOVE (INCL DELIMITER)         
         LA    R0,TDRDEMS          R0-->SOURCE                                  
         LR    R1,RF                                                            
         MVCL  RE,R0               MOVE DEMO EXPRSNS INTO SAVE AREA             
*                                                                               
         TM    STFLAG1,SF1MDFRL    DEMO MODIFIERS RELEASED YET?                 
         BO    DEMLINX              YEP, EXIT NOW                               
         OI    STFLAG1,SF1MDFRL     ELSE, RELEASE THEM ONCE ONLY                
                                                                                
         DS    0H                  GET DEMO NAMES                               
         LA    R4,DBLOCK1          BUILD DBLOCK FOR DEMOCON                     
         USING DBLOCKD,R4                                                       
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,DBFIL                                                     
         MVC   DBCOMFCS,AFAC                                                    
         MVC   DBSELMED,DBMED                                                   
         MVC   DBSELSRC,DBSRC                                                   
         MVC   DBSELAGY,AGYALPH                                                 
         L     R0,AIOAREA                                                       
         L     R3,ASTDMEXP                                                      
         LA    R3,1(R3)                                                         
                                                                                
         DS    0H                                                               
         CLC   DBFIL,=C'PAV'                                                    
         BNE   DEMLN22N                                                         
         LR    R1,R3                                                            
DEMLN22H CLI   0(R1),XFF                                                        
         BE    DEMLN22N                                                         
         CLI   1(R1),C'T'                                                       
         BNE   *+8                                                              
         MVI   1(R1),C'I'                                                       
         LA    R1,L'DEMS(R1)                                                    
         B     DEMLN22H                                                         
DEMLN22N EQU   *                                                                
*&&DO                                                                           
         GOTO1 VDEMOCON,DMCB,(STNDEMS,(R3)),(7,(R0)),(C'S',DBLOCKD),0           
*&&                                                                             
         MVI   BYTE,C'S'            ASSUME SPOTPAK VALIDATION                   
         CLC   DBFIL,=C'PAV'        (TYPE OF VALIDATION BASED ON FILE)          
         BNE   *+8                                                              
         MVI   BYTE,0                REMOVE SPOTPAK VALIDATION                  
         GOTO1 VDEMOCON,DMCB,(STNDEMS,(R3)),(7,(R0)),(BYTE,DBLOCKD),0           
         DROP  R4                                                               
                                                                                
         DS    0H                  MOVE NAMES TO STEREO I/O BUFFER              
         ZIC   R0,STNDEMS                                                       
         MVI   0(R2),ORTDEMOD                                                   
         LA    R2,1(R2)                                                         
         L     R4,AIOAREA          R4-->DEMO NAMES                              
DEMLN22A MVC   0(12,R2),0(R4)                                                   
         LA    R2,12(R2)                                                        
         BCT   R0,DEMLN22C                                                      
         B     DEMLN22F                                                         
DEMLN22C BAS   RE,INSSEP                                                        
         LA    R4,12(R4)                                                        
         B     DEMLN22A                                                         
DEMLN22F EQU   *                                                                
                                                                                
         CLC   DBFIL,=C'PAV'       IF PAV FILE,                                 
         BNE   *+8                                                              
         MVI   APMODE,SAMEREC       GET SAME REC TO RSTORE FUDGED DMLST         
         B     DEMLIN90                                                         
*                                                                               
** OUTPUT DEMOGRAPHIC VALUES **                                                 
*                                                                               
DEMLIN26 DS    0H                                                               
         MVI   0(R2),ORTDTAIL      ASSUME DETAIL LINE                           
         CLI   TDRSQH,X'FF'        TEST IF SUMMARY LINE                         
         BNE   *+8                                                              
         MVI   0(R2),ORTSMMRY       IF SO, INDICATE IT                          
         LA    R2,1(R2)                                                         
                                                                                
         LA    R3,STPRVOVL                                                      
         USING SPVOVALD,R3                                                      
*                                                                               
*** STATION ***                                                                 
*                                                                               
         DS    0H                  STATION                                      
         MVC   WORK(L'SPOVSTA),SPACES                                           
         MVC   WORK(5),STAS        BUILD STATION OUTPUT IN WORK                 
                                                                                
         DS    0H                  CHECK FOR ANY SPILL MARKET                   
         OC    STAS+5(2),STAS+5     VIA NUMERIC MKT CODE                        
         BNZ   DEMLN27A                                                         
         OC    ALFMKTS,ALFMKTS                                                  
         BZ    DEMLIN28                                                         
         CLC   ALFMKTS,SPACES       VIA ALPHA MKTS                              
         BNE   DEMLN27B                                                         
         B     DEMLIN28                                                         
                                                                                
DEMLN27A DS    0H                                                               
         ZICM  R1,STAS+5,(3)                                                    
         EDIT  (R1),(3,WORK+6),ALIGN=LEFT,WRK=WORK+L'SPOVSTA                    
         B     DEMLN27X                                                         
DEMLN27B DS    0H                                                               
         MVC   WORK+6(3),ALFMKTS                                                
         B     DEMLN27X                                                         
DEMLN27X DS    0H                                                               
         MVI   WORK+5,C'/'                                                      
                                                                                
DEMLIN28 DS    0H                                                               
         CLC   SPOVSTA,WORK        IS THIS STATION SAME AS BEFORE?              
         BE    DEMLIN30                                                         
                                                                                
         MVC   SPOVSTA,WORK         NO, REMEMBER STATION FOR NEXT               
         LA    RE,WORK                                                          
         LA    RF,WORK+L'SPOVSTA-1                                              
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
                                                                                
         SR    RF,RE                                                            
         BNM   *+6                                                              
         SR    RF,RF                                                            
         EXMVC RF,0(R2),0(RE)                                                   
         LA    R2,1(R2,RF)         BUMP PAST STATION FIELD                      
*                                                                               
*** BOOK ***                                                                    
*                                                                               
DEMLIN30 DS    0H                                                               
         BAS   RE,INSSEP           INSERT FIELD SEPARATOR                       
                                                                                
         LA    RF,DBSTABK                                                       
         USING STABKD,RF                                                        
         MVC   DUB(L'STABKS),STABKS   HOLD ONTO BOOK/WEEK#/BOOKTYPE             
         DROP  RF                                                               
                                                                                
         LA    R4,WORK             USE WORK TO HOLD FORMATTED BOOK              
         MVC   WORK,SPACES                                                      
*                                                                               
         DS    0H                  FORMAT BOOK                                  
         CLC   DUB(2),INVBOOK       CHECK VALIDITY OF BOOK                      
         BE    DEMLN31A                                                         
         CLC   DUB(2),ESTBOOK       CHECK IF ESTIMATE BOOK                      
         BE    DEMLN31B                                                         
         CLC   DUB(2),MBKBOOK       CHECK IF MULTBOOK BOOK                      
         BE    DEMLN31B                                                         
         B     DEMLN32A                                                         
                                                                                
DEMLN31A DS    0H                  INVALID BOOK                                 
         MVC   DUB(L'BKS),BKS       STILL NEED TO OUTPUT ACT BK INPTTED         
         B     DEMLN32A                                                         
                                                                                
DEMLN31B DS    0H                  ESTIMATE BOOK                                
                                                                                
         DS    0H                  GET ACTUAL DATA OF NTH BOOK INPUT            
         L     R1,ASTINCHK                                                      
         USING STICKEYD,R1                                                      
DMLN31BA CLI   STICKKNU,IKNBOO      LOCATE ENTRIES FOR BOOK INPUT               
         BH    DMLN31BE                                                         
         BL    DMLN31BB                                                         
         CLC   STICKNTH,TDRBK       FIND NTH INPUT OF BOOK                      
         BH    DMLN31BE                                                         
         BE    DMLN31BC                                                         
DMLN31BB ZIC   R0,STICLEN                                                       
         AR    R1,R0                                                            
         B     DMLN31BA                                                         
DMLN31BC LA    RE,STICDATA         EXTRACT DATA                                 
DMLN31BD CLI   0(RE),STSPSOPI       UNTIL START-NEST INDICATOR REACHED          
         BE    DMLN31BF             AND EXIT                                    
         MVC   0(1,R4),0(RE)                                                    
         LA    R4,1(R4)                                                         
         LA    RE,1(RE)                                                         
         B     DMLN31BD                                                         
DMLN31BE LA    R4,1(R4)            ELSE, BUMP 1 FOR DUMMY DATA INPUT            
DMLN31BF EQU   *                                                                
         B     DEMLIN36                                                         
         DROP  R1                                                               
*                                                                               
DEMLN32A DS    0H                                                               
         CLI   DBMED,C'W'                                                       
         BE    DEMLN32J                                                         
                                                                                
         MVI   STARTDAY,0          USE DEFAULT START DAY IN NSIWEEK             
                                                                                
DEMLN32B DS    0H                                                               
         CLI   DBMED,C'C'          CHECK FOR CANADIEN                           
         BNE   DEMLN32C                                                         
         CLI   DBSRC,C'N'           NIELSEN                                     
         BNE   DEMLN32C                                                         
         CLC   DBFIL,=C'TP '        TIME PERIOD                                 
         BNE   DEMLN32C                                                         
         CLC   DUB(2),=X'6001'      ON OR AFTER JAN/96                          
         BL    DEMLN32C                                                         
         MVI   STARTDAY,1          OVERRIDE START DAY TO MONDAY                 
         B     DEMLN32J                                                         
DEMLN32C EQU   *                                                                
*                                                                               
         DS    0H                                                               
         CLI   DBMED,C'C'          CHECK FOR CANADIEN                           
         BNE   DEMLN32D                                                         
         CLI   DBSRC,C'A'           NIELSEN                                     
         BNE   DEMLN32D                                                         
         CLC   DBFIL,=C'TP '        TIME PERIOD                                 
         BNE   DEMLN32D                                                         
         CLI   DUB+3,C'W'           WEEKLY BOOK                                 
         BNE   DEMLN32D                                                         
         CLC   DUB(2),=X'6301'      ON OR AFTER JAN/99                          
         BL    DEMLN32D                                                         
         MVI   STARTDAY,1          OVERRIDE START DAY TO MONDAY                 
         B     DEMLN32J                                                         
DEMLN32D EQU   *                                                                
                                                                                
         B     DEMLN32M                                                         
                                                                                
DEMLN32J DS    0H                  FORMAT WEEKLY BOOK                           
         CLI   DBMED,C'O'                                                       
         BNE   *+8                                                              
         MVI   STARTDAY,1                                                       
         GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     +        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         GOTO1 VDATCON,DMCB,(X'80',DUB2),(5,(R4))                               
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         B     DEMLIN34                                                         
                                                                                
DEMLN32M DS    0H                  FORMAT MONTHLY BOOK                          
         CLC   BKS(L'LATBOOK),LATBOOK  CHECK IF LATEST BOOK REQUESTED           
         BE    DEMLN32P                                                         
         CLI   DUB,XFF              CHECK IF LATEST N BOOKS REQUESTED           
         BE    DEMLN32P                                                         
         B     DEMLN32T                                                         
                                                                                
DEMLN32P DS    0H                                                               
         MVC   0(6,R4),=C'LATEST'    YES, FORMAT AS LATEST N BOOKS              
         LA    R4,6(R4)                                                         
                                                                                
         CLC   BKS(L'LATBOOK),LATBOOK                                           
         BNE   *+22                                                             
         MVC   0(3,R4),SPACES        A SPACE BEFORE AND AFTER                   
         MVI   1(R4),C'-'             THIS DASH                                 
         LA    R4,3(R4)                                                         
         B     DEMLN32R                                                         
                                                                                
         CLI   DUB,XFF                                                          
         BNE   *+18                                                             
         MVC   1(1,R4),DUB+1                                                    
         LA    R4,2(R4)                                                         
         B     DEMLN32R                                                         
                                                                                
         DC    H'0'                                                             
                                                                                
DEMLN32R DS    0H                                                               
         CLC   BKS(L'LATBOOK),LATBOOK                                           
         BE    DEMLN32T                                                         
         B     DEMLIN34                                                         
                                                                                
DEMLN32T DS    0H                                                               
         GOTO1 VDATCON,DMCB,(X'83',DUB),(6,(R4))                                
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         B     DEMLIN34                                                         
*                                                                               
DEMLIN34 DS    0H                  DO BOOK TYPE                                 
         CLI   DUB+3,0              ANY BOOK TYPE?                              
         BE    DEMLN34B              NOPE                                       
         MVI   0(R4),C'('                                                       
*****    MVC   1(1,R4),DUB+3                                                    
* DISPLAY 2 CHARACTER BOOKTYPE                                                  
         XC    DMCB2,DMCB2                                                      
         MVI   DMCB2,12                                                         
         MVC   DMCB2+1(1),DUB+3                                                 
         GOTO1 ATRANSBT                                                         
         MVC   1(2,R4),=C'??'                                                   
         CLI   DMCB2+4,X'FF'                                                    
         BE    *+10                                                             
         MVC   1(2,R4),DMCB2+4                                                  
*                                                                               
         CLI   DMCB2+5,0           1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    DEMLN34A                                                         
         CLI   DMCB2+5,X'40'       1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    DEMLN34A                                                         
*                                                                               
         MVI   3(R4),C')'          2 CHARACTER BOOKTYPE                         
         AHI   R1,4                ADJUST FOR L(BOOKTYPE)                       
         B     DEMLN34B                                                         
*&&DO                                                                           
         CLI   DBMED,C'T'                                                       
         BNE   DEMLN34A                                                         
         CLI   1(R4),X'81'                                                      
         BL    *+16                                                             
         CLI   1(R4),X'B9'                                                      
         BH    *+8                                                              
         OI    1(R4),X'40'       CAPITAL LETTERS                                
*&&                                                                             
DEMLN34A DS    0H                  DO WEEK NUMBER                               
*                                                                               
*                                                                               
         MVI   2(R4),C')'                                                       
         LA    R4,3(R4)                                                         
                                                                                
DEMLN34B DS    0H                  DO WEEK NUMBER                               
         CLI   DUB+2,0              ANY WEEK NUMBER                             
         BE    DEMLIN36              NOPE                                       
         MVC   2(4,R4),=C'WEEK'                                                 
         MVC   6+1(1,R4),DUB+2                                                  
         OI    6+1(R4),X'F0'                                                    
         LA    R4,8(R4)                                                         
*                                                                               
DEMLIN36 DS    0H                                                               
         LA    R0,WORK+1                                                        
         SR    R4,R0               R4 = L(FORMATTED BOOK) - 1                   
         CLC   SPOVBOOK,WORK                                                    
         BE    DEMLIN40                                                         
         MVC   SPOVBOOK,WORK                                                    
         EXMVC R4,0(R2),WORK                                                    
         LA    R2,1(R2,R4)                                                      
*                                                                               
*** DAY/TIME ***                                                                
*                                                                               
DEMLIN40 DS    0H                                                               
         BAS   RE,INSSEP           INSERT FIELD SEPARATOR                       
                                                                                
         CLC   DBFIL,=C'PAV'       DUMMY TIME FOR PAV ONLY                      
         BNE   DEMLIN42                                                         
         TM    TDRFLAG1,TF1DUMDV   IS THIS A DUMMY DEMO VALUE RECORD?           
         BZ    *+14                 NO                                          
         MVC   SPOVDYQH,TDRKDAY     YES, SAVE DUMMY DAY/TIME,                   
         B     DEMLIN44              AND ALWAYS DISPLAY DUMMY TIME              
                                                                                
DEMLIN42 DS    0H                                                               
         CLC   SPOVDYQH,TDRKDAY                                                 
         BE    DEMLIN50                                                         
                                                                                
         MVC   SPOVDYQH,TDRKDAY                                                 
         MVC   TMPKSE,TDRKDAY      GET KDAY, STRT & END QH FOR GETDAY           
*&&DO                                                                           
         BAS   RE,GETDAY                                                        
*&&                                                                             
         ZIC   R0,TDRQHAF           GET QH ADJ FCTR FROM RECD,                  
         SHI   R0,(100+100)          CONVERT FROM 100-BASED,                    
         LCR   R0,R0                 AND COMPLEMENT ADJ FCTR                    
         STC   R0,THISQHAF           TO GET REAL QHs POST-SORT                  
         MVI   GOSUBN,ADJQH#                                                    
         GOTO1 AGOSUB                                                           
         MVC   THISNDYS,TDRNDAYS                                                
         MVI   GOSUBN,GDY#                                                      
         GOTO1 AGOSUB                                                           
         LA    RE,DAYTIME          DAYTIME HAS OUTPUT FROM GETDAY               
         CLC   DAYTIME(3),=C'ROT'  IS IT A ROTATION?                            
         BE    DMLN42R              YES, GO RETURN ORIGINAL STEREO INPT         
         LA    RF,L'DAYTIME-1(RE)                                               
         CLI   0(RF),C' '          DISCOUNT TRAILING BLANKS                     
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         B     DEMLIN46                                                         
                                                                                
DMLN42R  DS    0H                  SET TO RETURN ORIGINAL STEREO INPUT          
         L     R1,ASTINCHK                                                      
         USING STICKEYD,R1                                                      
DMLN42RB CLI   STICKKNU,IKNDAY      LOOK FOR DAY/TIME ENTRY                     
         BH    DEMLIN44                                                         
         BL    DMLN42RD                                                         
         CLC   STICKNTH,TDRDAY      LOOK FOR CORRESPONDING DAY/TIME             
         BH    DEMLIN44                                                         
         BE    DMLN42RF              FOUND IT!                                  
DMLN42RD ZIC   R0,STICLEN                                                       
         AR    R1,R0                                                            
         B     DMLN42RB                                                         
DMLN42RF LA    RE,STICDATA                                                      
         ZIC   RF,STICLEN                                                       
         AR    RF,RE                                                            
         LA    R0,STICFIXL+1                                                    
         SR    RF,R0                                                            
         B     DEMLIN46                                                         
         DROP  R1                                                               
                                                                                
DEMLIN44 DS    0H                  FORCE DISPLAY DUMMY DY/TIME (1 BLNK)         
         LA    RE,DAYTIME                                                       
         MVI   0(RE),C' '                                                       
         LR    RF,RE                                                            
         B     DEMLIN46                                                         
                                                                                
DEMLIN46 DS    0H                  MOVE DAY/TIME TO OUTPUT AREA                 
         SR    RF,RE                                                            
         EXMVC RF,0(R2),0(RE)                                                   
         LA    R2,1(R2,RF)                                                      
*                                                                               
*** ACTIVE WEEKS ***                                                            
*                                                                               
DEMLIN50 DS    0H                                                               
         CLC   DBFIL,=C'PAV'       PASS ACTIVE WEEKS IF PAV FILE                
**       BE    DEMLIN51                                                         
**       B     DEMLIN60                                                         
         BNE   DEMLIN60                                                         
                                                                                
DEMLIN51 DS    0H                                                               
         BAS   RE,INSSEP           INSERT FIELD SEPARATOR                       
                                                                                
         CLC   SPOVWKS,TDRWKS                                                   
         BE    DEMLIN60                                                         
                                                                                
         MVC   SPOVWKS,TDRWKS                                                   
         LA    RE,B'00001000'      TRANSLATE BITS (STARTING W/ X'08')           
         LA    RF,C'1'              INTO EBCDIC DIGITS                          
DEMLIN52 EX    RE,*+8              JUST PASS THOSE WEEK NOS. OF                 
         B     *+8                  THOSE WEEKS THAT WERE ACTIVE                
         TM    TDRWKS,0             (eg. X'0B' ==> C'134' )                     
         BZ    *+12                                                             
         STC   RF,0(R2)                                                         
         LA    R2,1(R2)                                                         
         LA    RF,1(RF)                                                         
         SRL   RE,1                                                             
         OR    RE,RE                                                            
         BNZ   DEMLIN52                                                         
                                                                                
*                                                                               
*** PROGRAM NAME ***                                                            
*                                                                               
DEMLIN60 DS    0H                                                               
         BAS   RE,INSSEP           INSERT FIELD SEPARATOR                       
*                                                                               
         DS    0H                  FORMAT PROG NAME IN WORK AREA FIRST          
         MVC   WORK(16),SPACES                                                  
         TM    TDRFLAG1,TF1DUMDV    IS THIS A DUMMY DEMO VALUE RECORD?          
         BO    DEMLIN65              YES, DISPLAY DUMMY PROGRAM NAME            
         MVC   WORK(16),TDRPROG                                                 
                                                                                
         TM    TDRFLAG1,TF11HHR    IF ENTRY IS 1ST HALF-HOUR OF PROG,           
         BZ    DEMLIN62                                                         
         CLC   TDRASQC,TDRSQH       SEE IF STARTED BEFORE DSPLY TIME            
         BNL   DEMLIN62                                                         
         MVI   WORK,C'+'             YES, SHOW THAT PRG STARTED EARLIER         
         MVC   WORK+1(15),TDRPROG                                               
                                                                                
DEMLIN62 DS    0H                                                               
         TM    TDRFLAG1,TF1XHHR    IF ENTRY IS LAST HALF-HOUR OF PROG,          
         BZ    DEMLIN65                                                         
         CLC   TDRAEQC,TDREQH       SEE IF ENDED AFTER DSPLY TIME               
         BL    DEMLIN65                                                         
         MVI   WORK+15,C'+'          YES, SHOW THAT PRG ENDED LATER             
*                                                                               
DEMLIN65 DS    0H                  WORK(16) CONTAINS FORMATTED PRG NAME         
         CLC   SPOVPROG,WORK                                                    
         BE    DEMLIN70                                                         
                                                                                
         MVC   SPOVPROG,WORK                                                    
         LA    RE,WORK             RE-->1ST  BYTE OF PROG NAME                  
         LR    RF,RE               ASSUME DUMMY PROGRAM NAME                    
         TM    TDRFLAG1,TF1DUMDV    IS THIS A DUMMY DEMO VALUE RECORD?          
         BO    DEMLIN67              YES, DISPLAY DUMMY PROGRAM NAME            
         LA    RF,15(RE)           RF-->LAST BYTE OF PROG NAME                  
         CLI   0(RF),C' '          DISCOUNT TRAILING BLANKS                     
         BH    *+8                                                              
         BCT   RF,*-8                                                           
                                                                                
DEMLIN67 DS    0H                  MOVE PROGRAM NAME TO OUTPUT AREA             
         SR    RF,RE                                                            
         BNM   *+6                 THIS IS JUST TO PROTECT OURSELVES,           
         SR    RF,RF                SHOULDN'T HAPPEN, BUT C'EST LA VIE          
         EXMVC RF,0(R2),0(RE)                                                   
         LA    R2,1(R2,RF)                                                      
         DROP  R3                                                               
*                                                                               
*** DEMOS ***                                                                   
*                                                                               
DEMLIN70 DS    0H                                                               
         SR    R1,R1                                                            
         ICM   R1,1,STNDEMS        R1=# OF DEMOS (ACTUALLY) REQUESTED           
         BZ    DEMLIN90                                                         
*                                                                               
         TM    TDRFLAG1,TF1DUMDV   IS THIS A DUMMY DEMO VALUE RECORD?           
         BO    DEMLIN77             YES, DISPLAY DUMMY DEMOS                    
*                                                                               
         L     R3,ASTDMEXP                                                      
         LA    R3,1(R3)            R3-->DEMO EXPRESSIONS                        
         LA    R4,TDRDEMS          R4-->DEMO VALUES                             
                                                                                
DEMLIN74 DS    0H                                                               
         BAS   RE,INSSEP           INSERT FIELD SEPARATOR                       
                                                                                
         OC    0(L'TDRDEMS,R4),0(R4)    IF DEMO VALUE IS ZERO,                  
         BNZ   DEMLN74A                                                         
         CLC   BKS(2),INVBOOK            AND IT'S AN INVALID BOOK,              
         BNE   DEMLN74A                                                         
         MVI   0(R2),C' '                JUST OUTPUT A BLANK                    
         LA    R2,1(R2)                                                         
         B     DEMLN74B                                                         
                                                                                
DEMLN74A DS    0H                                                               
*&&DO                                                                           
         BAS   RE,GETDEM           EDIT DEMO VALUE                              
*&&                                                                             
         MVI   GOSUBN,GDM#         EDIT DEMO VALUE                              
         GOTO1 AGOSUB                                                           
         A     R2,FULL              FULL=L(FORMATTED DEMO VALUE)                
                                                                                
DEMLN74B DS    0H                                                               
         LA    R3,L'DEMS(R3)                                                    
         LA    R4,L'TDRDEMS(R4)                                                 
         BCT   R1,DEMLIN74         DO FOR NUMBER OF DEMOS                       
         B     DEMLIN90                                                         
*                                                                               
DEMLIN77 DS    0H                  FORMAT DUMMY DEMO VALUES                     
         BAS   RE,INSSEP                                                        
         MVI   0(R2),C' '                                                       
         LA    R2,1(R2)                                                         
         BCT   R1,DEMLIN77                                                      
         B     DEMLIN90                                                         
*                                                                               
** END OF OUTPUT RECORD **                                                      
*                                                                               
DEMLIN90 DS    0H                                                               
         MVI   0(R2),STSPIKEY      MOVE IN "END OF KEY" SEPARATOR               
         LA    R2,1(R2)                                                         
                                                                                
DEMLIN92 DS    0H                  CALCULATE L(OUTPUT) RECORD                   
         S     R2,ASTIOBUF                                                      
         STH   R2,IODATALN                                                      
         B     DEMLINX                                                          
         EJECT                                                                  
DMLN200  DS    0H                  STEREO DEM32 SESSION                         
**       CLI   FERN,155                    "PARSE OUT REQUEST MSG"              
**       BNE   *+12                                                             
**       MVI   APMODE,FORCEEND                                                  
**       J     XITMODL                                                          
         MVI   GOSUBN,D32DL#                                                    
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
DEMLINX  DS    0H                                                               
         B     EXIT                                                             
         DROP  R5                                                               
                                                                                
                                                                                
* Little routine to insert field separator into output buffer.                  
*  R2-->next output location in the output buffer.                              
                                                                                
INSSEP   DS    0H                                                               
         MVI   0(R2),STSPIFLD                                                   
         LA    R2,1(R2)                                                         
         BR    RE                                                               
         EJECT                                                                  
* MISCELLANEOUS TASKS FOR STEREO SESSION                                        
*                                                                               
DEMSTTSK DS    0H                                                               
         CLI   STMODE,STMMIDQ                                                   
         BE    DMSTSK20                                                         
         CLI   STMODE,STMOUTQ                                                   
         BE    DMSTSK50                                                         
         B     DMSTSKX                                                          
*                                                                               
DMSTSK20 DS    0H                                                               
         LH    R2,DSPRCTDT         WANT DAY/TIME ENTRY                          
         LA    R2,REQCTLTB(R2)                                                  
         USING RCTDSECT,R2                                                      
         CLI   RCTFROM,1           IF WE ARE GOING TO FORMAT THE FIRST          
         BNE   DMSTSK25X                                                        
         CLI   STBKDATA,C'Y'        DAY/TIME AGAIN, AND NO DATA FOR             
         BE    DMSTSK25X                                                        
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BO    DMSTSK25X                                                        
         MVI   GOSUBN,PDDR#         STN/BK COMBO, POST DUMMY DATA RECD          
         GOTO1 AGOSUB                                                           
DMSTSK25X EQU  *                                                                
         DROP  R2                                                               
                                                                                
*                                                                               
         LH    R2,DSPRCTDM         WANT DEMOS ENTRY                             
         LA    R2,REQCTLTB(R2)                                                  
         USING RCTDSECT,R2                                                      
                                                                                
         CLI   RCTFROM,1           IF WE ARE GOING TO FORMAT THE FIRST          
         BNE   DMSTSK30             DEMO AGAIN, RELEASE TSAR DEMO RECDS         
         OI    OUPTFLG1,OF1RELSE+OF1ITSR     AND RE-INIT TSAR                   
*                                                                               
DMSTSK30 DS    0H                                                               
         TM    OUPTFLG1,OF1RELSE+OF1RCTX                                        
         BNO   DMSTSK35                                                         
         CLC   DBFIL,=C'PAV'                                                    
         BNE   DMSTSK32                                                         
         MVI   GOSUBN,PDT#         POST DAY/TIME LIST                           
         GOTO1 AGOSUB                                                           
                                                                                
DMSTSK32 DS    0H                                                               
*                                                                               
DMSTSK35 DS    0H                                                               
         B     DMSTSKX                                                          
         DROP  R2                                                               
                                                                                
                                                                                
DMSTSK50 DS    0H                  STMODE = STMOUTQ                             
         TM    OUPTFLG1,OF1RELSE                                                
         BO    DMSTSK60                                                         
         B     DMSTSKX                                                          
*                                                                               
DMSTSK60 DS    0H                                                               
         LA    R1,TSARBLCK                                                      
         USING TSARD,R1                                                         
         TM    TSERRS,TSEEOF                                                    
         BO    DMSTSK70                                                         
         B     DMSTSKX                                                          
         DROP  R1                                                               
*                                                                               
DMSTSK70 DS    0H                  ALL TSAR DEMO RECDS JUST RELEASED            
         L     RE,ASTDMEXP         CLEAR DEMO EXPRESSIONS BUFFER                
         LH    RF,=Y(STDMEXPX-STDEMEXP)  RF = L(DESTINATION)                    
         SR    R0,R0                                                            
         SR    R1,R1                                                            
         MVCL  RE,R0                     RE-->DESTINATION                       
*&&DO                                                                           
*                                                                               
         DS    0H                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   DMSTSK75X                                                        
         CLI   RESUMAPP,C'Y'       IF RESUMING FROM APPLIC BREAK,               
         BNE   *+12                                                             
         MVI   RESUMAPP,0           RESET FLAG AND                              
         B     DMSTSK75X            DON'T ASK FOR MF TRNSCTN BREAK              
         TM    OUPTFLG1,OF1RCTX    IF ALL COMBO OF INPUT EXHAUSTED,             
         BNZ   DMSTSK75X            DON'T ASK FOR MF TRNSCTN BREAK              
                                                                                
         LH    R2,DSPRCTDT         WANT DAY/TIMES ENTRY                         
         LA    R2,REQCTLTB(R2)                                                  
         USING RCTDSECT,R2                                                      
         CLI   RCTFROM,1           IF FORMATTING 1ST BOOK AGAIN,                
         BH    *+8                                                              
         OI    BRKFLAG1,BF1APPLC    BREAK MAINFRAME TRANSACTION                 
         DROP  R2                                                               
DMSTSK75X EQU  *                                                                
*&&                                                                             
                                                                                
         B     DMSTSKX                                                          
                                                                                
                                                                                
DMSTSKX  DS    0H                                                               
         B     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (APMODE=APMB+        
               REAK)'                                                           
***********************************************************************         
*============ TASKS TO DO FOR MAINFRAME TRANSACTION BREAK ============*         
                                                                                
DEMBREAK DS    0H                                                               
         MVI   GOSUBN,DMB#                                                      
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
** EXIT BREAK TASKS **                                                          
*                                                                               
DMBREAKX DS    0H                                                               
         J     EXIT                                                             
***********************************************************************         
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (APMODE=APMR+        
               ESUM)'                                                           
***********************************************************************         
*============ TASKS TO DO FOR MAINFRAME TRANSACTION RESUME ===========*         
                                                                                
DEMRESUM DS    0H                                                               
         PRINT OFF                                                              
*&&DO                                                                           
         TM    RSMFLAG1,RF1APPLC   RESUMING FOR APPLIC BREAK?                   
         BO    DMRSMA               YEP                                         
         TM    RSMFLAG1,RF1FALNK   RESUMING FOR FALINK BREAK?                   
         BO    DMRSMF               YEP                                         
         B     DMRSMX                                                           
                                                                                
                                                                                
*                                                                               
** RESUME NEEDED FOR APPLICATION BREAK **                                       
*                                                                               
DMRSMA   DS    0H                                                               
         L     R6,AAPSAV2                                                       
         USING APSAV2D,R6                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         OI    AS2RSMF,AS2RFAPP                                                 
*                                                                               
         DS    0H                                                               
         CLI   AS2STMOD,STMOUTQ                                                 
         BE    DMRSMAO                                                          
         B     DMRSMAX                                                          
                                                                                
*                                                                               
*** STMODE=STMOUTQ WHEN BREAK CALLED BY APPLIC ***                              
*                                                                               
DMRSMAO  DS    0H                                                               
         MVI   RESUMAPP,C'Y'                                                    
         B     DMRSMAX                                                          
                                                                                
         DROP  R6                                                               
                                                                                
*                                                                               
DMRSMAX  DS    0H                                                               
         B     DMRSMX                                                           
                                                                                
                                                                                
*                                                                               
** RESUME CALLED BY FALINK **                                                   
*                                                                               
DMRSMF   DS    0H                                                               
         L     R6,AAPSAV2                                                       
         USING APSAV2D,R6                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         CLI   AS2STMOD,STMOUTQ                                                 
         BE    DMRSMFO                                                          
         B     DMRSMFX                                                          
                                                                                
*                                                                               
*** STMODE=STMOUTQ WHEN BREAK CALLED BY FALINK ***                              
*                                                                               
DMRSMFO  DS    0H                                                               
         OI    AS2RSMF,AS2RFFLK                                                 
         DROP  R6                                                               
                                                                                
*                                                                               
DMRSMFX  DS    0H                                                               
         B     DMRSMX                                                           
                                                                                
                                                                                
*                                                                               
** EXIT RESUME TASKS **                                                         
*                                                                               
DMRSMX   DS    0H                                                               
         J     EXIT                                                             
*&&                                                                             
         PRINT ON                                                               
         MVI   GOSUBN,DMR#                                                      
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
** EXIT RESUME TASKS **                                                         
*                                                                               
DMRESUMX DS    0H                                                               
         J     EXIT                                                             
***********************************************************************         
         EJECT                                                                  
***********************************************************************         
*===================== SUBROUTINE POOL INTERFACE =====================*         
                                                                                
         DS    0H                                                               
GOSUB    NTR1  BASE=MYBASE1,LABEL=N                                             
         L     RA,MYBASE2                                                       
                                                                                
         L     RE,4(RD)            PUT EYECATCHER IN MYSELF                     
         MVC   0(3,RE),=C'+GO'                                                  
         MVC   3(1,RE),GOSUBN                                                   
         SR    RE,RE                AND CLEAR  RE  JUST TO BE SAFE              
                                                                                
         MVC   ASUBRTN,ASUBR01                                                  
         CLI   GOSUBN,R01#                                                      
         BL    GOSUBGO                                                          
         MVC   ASUBRTN,ASUBR02                                                  
         CLI   GOSUBN,R02#                                                      
         BL    GOSUBGO                                                          
         MVC   ASUBRTN,ASUBR03                                                  
         CLI   GOSUBN,R03#                                                      
         BL    GOSUBGO                                                          
         MVC   ASUBRTN,ASUBR04                                                  
         CLI   GOSUBN,R04#                                                      
         BL    GOSUBGO                                                          
         MVC   ASUBRTN,ASUBR05                                                  
         CLI   GOSUBN,R05#                                                      
         BL    GOSUBGO                                                          
         MVC   ASUBRTN,ASUBR06                                                  
         CLI   GOSUBN,R06#                                                      
         BL    GOSUBGO                                                          
         MVC   ASUBRTN,ASUBR07                                                  
         CLI   GOSUBN,R07#                                                      
         BL    GOSUBGO                                                          
         DC    H'0'                                                             
*                                                                               
GOSUBGO  DS    0H                                                               
         ST    RC,ALOCWRK                                                       
         SR    R1,R1                                                            
         IC    R1,GOSUBN                                                        
         GOTO1 ASUBRTN,(R1)                                                     
*                                                                               
         DS    0H                                                               
         XIT1                                                                   
***********************************************************************         
         EJECT                                                                  
* LITERALS ETC.                                                                 
*                                                                               
         LTORG                                                                  
         SPACE 1                                                                
PROG     DC    C'PROGRAM'                                                       
                                                                                
WKDSCLMR DC    C'If pgm runs 2+ weeks, multi-week avg is repeated in ac+        
               tive weeks'                                                      
WKDSCLML EQU   *-WKDSCLMR                                                       
WKDSCLMD EQU   (L'DEMLN1-WKDSCLML)/2                                            
         DS    0CL(L'DEMLN1-WKDSCLML+1)                                         
*&&DO                                                                           
         SPACE 1                                                                
OFORMAT  DC    C'IUNUIUN',X'530B00'                                             
*&&                                                                             
                                                                                
IUNWRKL  EQU   IUNRECL+500                                                      
*                                                                               
R00#     EQU   1                                                                
         DROP  R7,R8,R9,RA,RB,RC                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01)'            
***********************************************************************         
*======================== SUBROUTINE POOL ONE ========================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR01Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR01Q                                                    
SUBR01   NMOD1 0,1B0201**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R00#)                                                      
*&&DO                                                                           
         BCTR  R1,0                                                             
*&&                                                                             
         SLL   R1,2                                                             
         B     R01_00(R1)                                                       
                                                                                
DTL#     EQU   (R01_01-*)/4+R00#   BUILD  DAY/TIME LIST                         
PDT#     EQU   (R01_02-*)/4+R00#   POST   DAY/TIME LIST                         
ODT#     EQU   (R01_03-*)/4+R00#   OUTPUT DAY/TIME LIST TO STEREO               
GDY#     EQU   (R01_04-*)/4+R00#   TRANSLATE DAY & TIME                         
CMD#     EQU   (R01_05-*)/4+R00#   CALC MAX # DTNTRYs                           
DDT#     EQU   (R01_06-*)/4+R00#   DO DUMMY TSAR DEMO RECDS                     
GWK#     EQU   (R01_07-*)/4+R00#   GET WEEKS                                    
MTQ#     EQU   (R01_08-*)/4+R00#   MILITARY TO QUARTER HOUR                     
S1M#     EQU   (R01_09-*)/4+R00#   SUBTRACT ONE MINUTE                          
GIS#     EQU   (R01_10-*)/4+R00#   GET INDIVIDUAL (BOOK) SUMMARY LINE           
***#     EQU   (R01_11-*)/4+R00#   (SPARE)                                      
GPRF#    EQU   (R01_12-*)/4+R00#   GET PROFILE                                  
PIUN#    EQU   (R01_13-*)/4+R00#   PROCESS IUN                                  
DIV#     EQU   (R01_14-*)/4+R00#   DIVIDE LOGIC                                 
                                                                                
R01_00   DS    0H                                                               
R01_01   B     DAYTMLST            BUILD  DAY/TIME LIST                         
R01_02   B     POSTDT              POST   DAY/TIME LIST                         
R01_03   B     OUTDT               OUTPUT DAY/TIME LIST TO STEREO               
R01_04   B     GET_DAY             TRANSLATE DAY & TIME                         
R01_05   B     CMXNDT              CALC MAX # DTNTRYs                           
R01_06   B     DODUMTDR            DO DUMMY TSAR DEMO RECDS                     
R01_07   B     GETWKS              GET WEEKS                                    
R01_08   B     MILTOQHR            MILITARY TO QUARTER HOUR                     
R01_09   B     SUB1MIN             SUBTRACT ONE MINUTE                          
R01_10   B     GTINDSUM            GET INDIVIDUAL (BOOK) SUMMARY LINE           
R01_11   J     EXIT                (SPARE)                                      
R01_12   B     GETPROFL            GET PROFILE                                  
R01_13   B     PROCIUN             PROCESS IUN                                  
R01_14   B     DIVIDE              DIVIDE LOGIC                                 
R01#     EQU   (*-R01_00)/4+R00#                                                
         DC    H'0'                                                             
                                                                                
YES_01   SR    R9,R9                                                            
NO_01    LTR   R9,R9                                                            
XIT_01   XIT1                                                                   
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--DTL+        
               #)'                                                              
*------------------------ BUILD DAY/TIME LIST ------------------------*         
                                                                                
* Routine to add day/time combo to list for PAV requests.                       
                                                                                
DAYTMLST DS    0H                                                               
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
         DROP  RF                                                               
         LA    R2,2(R2)                                                         
         USING TSDEMRCD,R2                                                      
                                                                                
         LA    R5,WORK             USE WORK TO BUILD DAY/TIME COMBO             
         USING DTNTRYD,R5                                                       
         XC    DTNTRYD(DTNTRYQ),DTNTRYD                                         
                                                                                
         DS    0H                  CALC NTH DAY/TIME INPUT FROM STEREO          
         LH    RF,DSPRCTDT                                                      
         LA    RF,REQCTLTB(RF)                                                  
         USING RCTDSECT,RF                                                      
         ZIC   R1,RCTFROM                                                       
         DROP  RF                                                               
         ZIC   R0,TDRDAY                                                        
         AR    R1,R0                                                            
         BCTR  R1,0                                                             
                                                                                
         DS    0H                  BUILD DAY/TIME ENTRY                         
         STC   R1,DTNTHINP          nth INPUT FROM STEREO                       
         MVC   DTKDAY,TDRKDAY       KEY DAY                                     
         MVC   DTSQH,TDRSQH         START QUARTER-HOUR                          
         MVC   DTEQH,TDREQH         END   QUARTER HOUR                          
         DROP  R2                                                               
*                                                                               
         DS    0H                  PUT ENTRY INTO LIST VIA BINSRCH              
         L     R6,ASTBUFFR                                                      
         MVI   GOSUBN,CMD#         CALC MAX # OF DTNTRYs INTO MAXNDT            
         GOTO1 AGOSUB                                                           
         XC    DMCB(6*4),DMCB                                                   
         ST    R5,DMCB             P1      = ADDR OF RECORD                     
         MVI   DMCB,X'01'          P1+0(1) = INSRT RECD IF NOT FOUND            
         LA    RE,4(R6)                                                         
         ST    RE,DMCB+4           P2      = ADDR OF TABLE (LIST)               
         LH    RE,0(R6)                                                         
         ST    RE,DMCB+8           P3      = # OF RECDS SO FAR                  
         MVI   DMCB+15,DTNTRYQ     P4      = L(RECORD)                          
         MVI   DMCB+16,0           P5+0(1) = DISPL OF KEY INTO RECD             
         MVI   DMCB+19,DTNTRYQ     P5+1(3) = L(KEY)                             
         LH    RE,MAXNDT                                                        
         ST    RE,DMCB+20          P6      = MAX # OF RECDS                     
         DROP  R5                                                               
                                                                                
         GOTO1 VBINSRCH,DMCB                                                    
         OC    DMCB(4),DMCB                                                     
         BNZ   *+6                                                              
         DC    H'0'                                                             
*                                                                               
         L     RE,DMCB+8                                                        
         STH   RE,0(R6)            UPDATE THE # OF RECDS SO FAR                 
*                                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--PDT+        
               #)'                                                              
*------------------------- POST DAY/TIME LIST ------------------------*         
                                                                                
* Routine to post day/time list to TSAR buffer for PAV requests.                
                                                                                
POSTDT   DS    0H                                                               
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
         DROP  RF                                                               
*                                                                               
         DS    0H                  BUILD TSAR DEMO RECORD                       
         LA    R3,2(R2)                                                         
         USING TSDEMRCD,R3                                                      
         XC    TDRKEY(TDRKEYL),TDRKEY                                           
         MVI   TDRRCTYP,TDRRTDTL                                                
         XC    TDREBCDT,TDREBCDT                                                
                                                                                
         L     RE,ASTBUFFR         RE = A(SOURCE)--DAY/TIME LIST                
         LH    RF,0(RE)            RF = TOTAL # OF DAY/TIME COMBOS              
         STCM  RF,3,TDRNUMDT                                                    
         MH    RF,=Y(DTNTRYQ)         * DTNTRYQ                                 
         LA    RF,4(RF)               + 4 = TOTAL LENGTH OF SOURCE              
         LH    R1,LTSIOREC         R1=L(TSAR I/O AREA)                          
         SH    R1,=Y(TDRFIXL2+2)                                                
         CR    RF,R1               R1=MAX AMT WE HAVE TO STORE LIST             
         BNH   *+6                                                              
         DC    H'0'                DESTINATION CAN'T FIT ENTIRE LIST            
         LA    R0,TDRDYTMS         R0 = A(DESTINATION)                          
         LR    R1,RF               R1 = L(DESTINATION)                          
         MVCL  R0,RE               MOVE LIST INTO TSAR DEMO RECORD              
         DROP  R3                                                               
                                                                                
         DS    0H                  CALC L(TSAR DEMO RECORD)                     
         SR    R0,R2               R0-->END, R2-->START                         
         STH   R0,0(R2)                                                         
                                                                                
         GOTO1 APOST                                                            
*                                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--ODT+        
               #)'                                                              
*------------------------ OUTPUT DAY/TIME LIST -----------------------*         
                                                                                
* Routine to translate & pass day/time list to STEREO for PAV requests.         
                                                                                
OUTDT    DS    0H                                                               
         L     R2,ASTIOBUF         R2-->OUTPUT BUFFER                           
                                                                                
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  R3,TSAREC+1,(7)     R3-->TSAR I/O AREA                           
         DROP  RF                                                               
         LA    R4,2(R3)            R4-->TSAR DEMO RECORD                        
         USING TSDEMRCD,R4                                                      
                                                                                
         CLI   TDREBCDT,0          SEE IF ANY UNFINISHED BUSINESS               
         BE    ODT30                NOPE                                        
                                                                                
         DS    0H                   YES, COULDN'T FIT ALL IN PREVIOUSLY         
         ZIC   R1,TDREBCDT                                                      
         BCTR  R1,0                                                             
         EXMVC R1,0(R2),TDREBCDT+1   MOVE THEM INTO OUTPUT BUFFER NOW           
         XC    TDREBCDT,TDREBCDT                                                
         LA    R2,1(R2,R1)                                                      
*                                                                               
ODT30    DS    0H                  OUTPUT NEXT DAY/TIME COMBO                   
         LA    R5,TDRDYTMS+4       R5-->LIST OF DAY/TIME COMBOS                 
         USING DTNTRYD,R5                                                       
                                                                                
         SR    R1,R1                                                            
         ICM   R1,3,TDRNUMDT       NEED TO PASS COUNT TO STEREO?                
         BZ    ODT40                NOPE, NOT ANY MORE                          
         MVI   0(R2),ORTDYTIM       YES, INDICATE OUTPUT (RECORD) TYPE          
         LA    R2,1(R2)                                                         
         EDIT  (R1),(3,(R2)),ALIGN=LEFT                                         
         AR    R2,R0                R2-->NEXT OUTPUT LOCATION                   
         XC    TDRNUMDT,TDRNUMDT   DON'T PASS COUNT NEXT TIME AROUND            
                                                                                
*                                                                               
ODT40    DS    0H                                                               
         OC    TDRDYTMS(2),TDRDYTMS  ANY MORE DAY/TIME COMBOS?                  
         BNZ   ODT50                  YES, KEEP PROCESSING                      
                                                                                
         DS    0H                     NO, NEED TO INSERT "END OF KEY"           
         LH    R1,LSTIOBUF                                                      
         A     R1,ASTIOBUF                                                      
         SR    R1,R2               R1 = AMT LEFT IN I/O BUFFER                  
         BP    ODT42                                                            
         BZ    ODT44                                                            
         DC    H'0'                                                             
                                                                                
ODT42    DS    0H                  ROOM LEFT IN I/O BUFFER                      
         MVI   0(R2),STSPIKEY      MOVE IN "END OF KEY" SEPARATOR               
         LA    R2,1(R2)                                                         
         B     ODT100               AND WE'RE DONE!                             
                                                                                
ODT44    DS    0H                  NO ROOM LEFT IN I/O BUFFER                   
         GOTO1 APOST                WRITE RECORD BACK TO TSAR                   
         MVI   APMODE,SAMEREC       WANT THIS RECORD NEXT TIME AROUND           
         B     ODT100               GO RELEASE STUFF IN I/O BUFFER              
                                                                                
*                                                                               
ODT50    DS    0H                  INSERT SEPARATOR BEFORE NEXT ENTRY           
         LH    R1,LSTIOBUF                                                      
         A     R1,ASTIOBUF                                                      
         SR    R1,R2               ANY ROOM LEFT TO INSERT SEPARATOR?           
         BP    ODT52                YEP                                         
         BZ    ODT54                NOPE                                        
         DC    H'0'                                                             
                                                                                
ODT52    DS    0H                  INSERT SEPARATOR                             
         MVI   0(R2),STSPIFLD                                                   
         LA    R2,1(R2)                                                         
         B     ODT60                AND MOVE ON                                 
                                                                                
ODT54    DS    0H                  NO ROOM LEFT FOR SEPARATOR                   
         B     ODT80                GO SHIFT REMNING DAY/TIMES OVER             
                                                                                
*                                                                               
ODT60    DS    0H                                                               
         MVC   TMPKSE,DTKDAY       GET KEY DAY, START & END QHRS                
         MVI   THISNDYS,0                                                       
         MVI   GOSUBN,GDY#          AND TRANSLATE THEM TO DAY & TIME            
         GOTO1 AGOSUB                                                           
         ZICM  R1,TDRDYTMS,(3)                                                  
         BCTR  R1,0                                                             
         STCM  R1,3,TDRDYTMS       ONE LESS DAY/TIME TO PROCESS                 
         LA    R5,DTNTRYQ(R5)      BUMP TO NEXT DAY/TIME COMBO                  
                                                                                
         DS    0H                  PUT EBCDIC DAY/TIME IN OUTPUT BUFFER         
         LH    R1,LSTIOBUF                                                      
         A     R1,ASTIOBUF                                                      
         SR    R1,R2               R1 = AMT LEFT IN I/O BUFFER                  
         LA    RE,DAYTIME                                                       
         LA    RF,L'DAYTIME-1(RE)                                               
         CR    RE,RF                                                            
         BNH   *+6                                                              
         DC    H'0'                                                             
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-16                                                          
         SR    RF,RE                                                            
         LA    RF,1(RF)            RF = L(EBCDIC DAY/TIME OUTPUT)               
                                                                                
         CR    RF,R1               CAN DAY/TIME OUTPUT FIT IN I/O BUFF?         
         BH    *+6                  NO, FIT AS MUCH AS POSSIBLE                 
         LR    R1,RF                YES, MOVE ENTIRE OUTPUT TO I/O BUFF         
                                                                                
         LR    R0,R2               SET DESTINATION                              
         MVCL  R0,RE                AND MOVE OUTPUT TO I/O BUFFER               
         LR    R2,R0               SET NEXT OUTPUT LOCATION                     
         LTR   RF,RF               MOVED ENTIRE DAY/TIME OUTPUT?                
         BZ    ODT40                YES, GO BACK & PROCESS NXT DAY/TIME         
                                                                                
         DS    0H                   NO, CAN'T FIT THE DAMN THING                
         STC   RF,TDREBCDT         REMEMBER HOW MUCH WAS LEFT OVER              
         BCTR  RF,0                                                             
         EXMVC RF,TDREBCDT+1,0(RE)  AND REMEMBER WHAT WAS LEFT OVER             
                                                                                
ODT80    DS    0H                  SHFT REMNING PORTION OF DT LIST OVER         
         LA    R0,TDRDYTMS+4        A(DESTINATION)                              
         ZICM  R1,TDRDYTMS,(3)                                                  
         MH    R1,=Y(DTNTRYQ)       L(DESTINATION)                              
         LA    RE,DTNTRYD           A(SOURCE)                                   
         LR    RF,R1                L(SOURCE)                                   
         MVCL  R0,RE                                                            
         GOTO1 APOST               WRITE RECORD BACK TO BUFFER                  
         MVI   APMODE,SAMEREC      WE WANT SAME RECD BACK                       
         B     ODT100                                                           
         DROP  R4,R5                                                            
*                                                                               
ODT100   DS    0H                  CALCULATE L(OUTPUT RECORD)                   
         S     R2,ASTIOBUF                                                      
         STH   R2,IODATALN                                                      
         B     ODTX                 AND EXIT                                    
*                                                                               
ODTX     DS    0H                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--GDY+        
               #)'                                                              
*--------------------------- GET DAY & TIME --------------------------*         
                                                                                
         PRINT OFF                                                              
* Links to the GETDAY routine in the main NMOD to translate the day             
*  and time in TMPKSE.                                                          
         PRINT ON                                                               
* At entry,                                                                     
*  TMPKSE = day, start and end quarter hours.                                   
*  THISNDYS = number of days                                                    
* At exit,                                                                      
*  DAYTIME = EBCDIC day and times.                                              
*  WORK2   = secondary output area.                                             
*  TEMPIDAY = internal day                                                      
*  TEMPSTIM = start time in military                                            
*  TEMPETIM = end   time in military                                            
                                                                                
GET_DAY  DS    0H                                                               
                                                                                
         DS    0H                                                               
         L     R1,AKDAYTAB                                                      
         CLI   DBMED,C'U'                                                       
         BNE   *+8                                                              
         L     R1,AKDAYTA2                                                      
*                                                                               
         MVC   DAYTIME,SPACES                                                   
         MVI   WORK2,C' '                                                       
         MVC   WORK2+1(L'WORK2-1),WORK2                                         
         MVI   TEMPIDAY,0                                                       
         XC    TEMPSTIM,TEMPSTIM                                                
         XC    TEMPETIM,TEMPETIM                                                
                                                                                
         LA    R2,WORK2                                                         
         NI    MYFLAG1,XFF-MYF1DTRO  ASSUME NOT A ROTATION                      
         MVI   FNDX,1                USE  FNDX  AS A COUNTER                    
         CLI   TMPSQH,X'FF'        TEST FOR COMPOSITE DAY/TIME                  
         BE    GETDAY8                                                          
*                                  CONVERT KEY DAY VALUES                       
GETDAY2  CLI   0(R1),X'FF'         TEST E-O-T                                   
         BE    GETDAY8                                                          
         CLI   0(R1),0             TEST IF AN ALL FILE VALUE                    
         BE    *+14                                                             
         CLC   0(1,R1),DBFIL       NO - MATCH ON FILE NAME                      
         BNE   GETDAY4                                                          
         CLI   1(R1),X'FF'         TEST FOR FUNNIES                             
         BE    GETDAY6                                                          
         CLC   1(1,R1),TMPKDAY     MATCH ON KEY DAY VALUE                       
         BE    GETDAY6                                                          
GETDAY4  LA    R1,L'KDAYTAB(R1)                                                 
         B     GETDAY2                                                          
GETDAY6  MVC   0(3,R2),2(R1)       SET OUTPUT VALUE FROM TABLE                  
         MVC   TEMPIDAY,5(R1)                                                   
*                                                                               
         DS    0H                  "AVn" FOR USTV PAV                           
         CLI   DBFIL,C'P'           TEST FOR PAV FILE                           
         BNE   GDY6PAVX                                                         
         CLI   DBMED,C'T'           TEST FOR USTV                               
         BNE   GDY6PAVX                                                         
         CLI   TMPKDAY,X'80'       TEST ON PROPER                               
         BE    *+12                                                             
         CLI   TMPKDAY,X'90'                                                    
         BNE   GDY6PAVX                                                         
         CLI   THISNDYS,7                                                       
         BNL   GDY6PAVX                                                         
*  LETS MAKE SURE THIS IS REVISION 2                                            
         CLI   THISNDYS,0           THIS MUST MEAN REVISION ONE                 
         BE    GDY6PAVX                                                         
*                                                                               
         MVC   0(2,R2),=C'AV'                                                   
         MVC   2(1,R2),THISNDYS                                                 
         OI    2(R2),X'F0'                                                      
         MVI   TEMPIDAY,X'90'                                                   
         OC    TEMPIDAY,THISNDYS                                                
GDY6PAVX EQU   *                                                                
*                                  CONVERT QHRS TO MILITARY TIME                
         CLI   DBMED,C'N'          NETWORK?                                     
         BNE   *+8                                                              
         CLI   TMPKDAY,0           FOR NETWORK, X'00'=M-F                       
         BNE   *+14                                                             
         MVC   0(3,R2),=C'M-F'     SET CORRECT DAY                              
         MVI   TEMPIDAY,X'7C'                                                   
         ZIC   R1,TMPSQH                                                        
**       BAL   RE,QHRTOMIL                                                      
         BAS   RE,QHRTOMIL                                                      
         STH   R1,DUB                                                           
         STCM  R1,3,TEMPSTIM                                                    
         ZIC   R1,TMPEQH                                                        
**       BAL   RE,QHRTOMIL                                                      
         BAS   RE,QHRTOMIL                                                      
         STH   R1,DUB+2                                                         
         STCM  R1,3,TEMPETIM                                                    
         B     GETDAY16                                                         
*                                  CONVERT INPUT DAY VALUES                     
GETDAY8  MVC   DUB(1),TMPKDAY                                                   
         XI    DUB,X'FF'           INVERT DAY VALUE                             
         ZIC   R1,DUB              GET DAY/TIME TABLE ENTRY                     
         LA    R0,L'DAYS                                                        
         MR    R0,R0                                                            
         LA    R1,DAYS-L'DAYS(R1)                                               
                                                                                
         MVC   WORK(L'DAYS),0(R1)                                               
         CLC   0(3,R1),=C'ROT'                                                  
         BNE   GETDAY8R                                                         
         OI    MYFLAG1,MYF1DTRO      IT IS A ROTATION                           
         ZICM  RF,3(R1),(3)                                                     
         LA    RF,LDTROTN(RF)                                                   
         ZIC   R0,FNDX               PICK UP COUNTER                            
         CLM   R0,1,0(RF)                                                       
         BNL   GTDAY30R                                                         
         AR    RF,R0                                                            
         MVC   WORK(L'DAYS),0(RF)                                               
GETDAY8R EQU   *                                                                
                                                                                
         IC    RF,WORK             RF=DAY EXPRESSION                            
         L     R1,AIDAYTAB                                                      
         MVC   DUB(1),WORK                                                      
         MVI   DUB+1,0                                                          
         MVC   TEMPIDAY,WORK+0                                                  
         MVC   TEMPSTIM,WORK+1                                                  
         MVC   TEMPETIM,WORK+3                                                  
*                                                                               
GETDAY10 CLI   0(R1),X'FF'         TEST E-O-T                                   
         BE    GETDAY14                                                         
         CLI   0(R2),C' '          TEST START DAY SET                           
         BE    *+10                                                             
         OC    DUB+1(1),0(R1)      YES - SET THIS DAY ON                        
         EX    RF,*+8                                                           
         B     *+8                                                              
         TM    0(R1),0             TEST IF DAY BIT ON                           
         BZ    GETDAY12                                                         
         MVC   3(3,R2),1(R1)       SET START & END DAY                          
         CLC   0(3,R2),SPACES                                                   
         BNE   *+10                                                             
         MVC   0(3,R2),3(R2)                                                    
         OC    DUB+1(1),0(R1)                                                   
         XC    DUB(1),0(R1)        TURN OFF THIS DAY IN MASK                    
         CLI   DUB,0               TEST ALL DAYS PROCESSED                      
         BE    GETDAY14            YES - GO FORMAT OUTPUT                       
GETDAY12 LA    R1,L'IDAYTAB(R1)                                                 
         B     GETDAY10                                                         
GETDAY14 CLC   DUB+1(1),WORK       TEST REGULAR ROTATOR (M-W,M-F ETC.)          
         BE    *+8                                                              
         MVI   3(R2),C'+'          NO - INDICATE IRREGULAR                      
         CLC   0(3,R2),3(R2)       TEST START EQ END DAY                        
         BE    *+14                                                             
         MVI   1(R2),C'-'          NO - SHOW FIRST CHAR OF EACH DAY             
         MVC   2(1,R2),3(R2)                                                    
         MVC   3(3,R2),SPACES                                                   
         MVC   DUB(4),WORK+1       SET TIME VALUES                              
*                                  EDIT TIME VALUES                             
GETDAY16 CLI   OPTTIME,C'M'                                                     
         BNE   GETDAY18                                                         
*                                  MILITARY TIME FORMAT                         
         MVI   3(R2),C'/'                                                       
         L     R0,DUB                                                           
         SRDL  R0,16               R0=START TIME                                
         SRL   R1,16               R1=END TIME                                  
         CVD   R0,DUB              EDIT START TIME                              
         OI    DUB+7,X'0F'                                                      
         UNPK  4(4,R2),DUB                                                      
         CR    R0,R1               TEST START TIME EQ END TIME                  
         B     GETDAY30                                                         
         MVI   8(R2),C'-'                                                       
         CVD   R1,DUB              EDIT END TIME                                
         OI    DUB+7,X'0F'                                                      
         UNPK  9(4,R2),DUB                                                      
         B     GETDAY30                                                         
*                                  STANDARD TIME FORMAT                         
GETDAY18 DS    0H                                                               
         CLC   0(2,R2),=C'AV'      TEST FOR "AVn"                               
         BE    *+12                                                             
         CLI   1(R2),C'-'          TEST M-F TYPE                                
         BNE   *+10                                                             
         MVC   1(1,R2),2(R2)                                                    
         MVI   2(R2),C'/'                                                       
         CLC   DUB(2),DUB+2        TEST START TIME EQ END TIME                  
         BNE   *+10                                                             
         XC    DUB+2(2),DUB+2                                                   
         GOTO1 VUNTIME,DMCB,DUB,3(R2)                                           
                                                                                
*                                                                               
GETDAY30 DS    0H                                                               
         TM    MYFLAG1,MYF1DTRO    IS THIS A ROTATION?                          
         BZ    GTDAY30R                                                         
         ZIC   R1,FNDX              YES, TAKE COUNTER                           
         LA    R1,L'DAYS(R1)         AND BUMP IT TO GET NEXT COMPONENT          
         STC   R1,FNDX                                                          
                                                                                
         CLI   0(R2),C' '           BUMP OUTPUT POINTER TO NEXT                 
         BNH   *+12                                                             
         LA    R2,1(R2)                                                         
         B     *-12                                                             
         MVI   0(R2),C'+'            AVAILABLE SLOT IN OUTPUT AREA              
         LA    R2,1(R2)                                                         
                                                                                
         B     GETDAY8                                                          
GTDAY30R EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  DONE FORMATTING DAYS/TIMES                   
         MVC   DAYTIME,WORK2                                                    
         TM    MYFLAG1,MYF1DTRO     IS IT A ROTATION?                           
         BZ    *+10                                                             
         MVC   DAYTIME(3),=C'ROT'    YES, FLAG IT                               
                                                                                
*                                                                               
GDYX     DS    0H                                                               
         B     XIT_01                                                           
         EJECT                                                                  
* ROUTINE TO CONVERT QUARTER HOUR (IN R1) TO MILITARY TIME                      
*                                                                               
QHRTOMIL SR    R0,R0                                                            
         D     R0,=F'4'                                                         
         LA    R1,5(R1)            BASE = 5AM IF RADIO,                         
         CLI   DBMED,C'R'                                                       
         BE    *+8                                                              
         LA    R1,1(R1)             ELSE, BASE = 6AM                            
*&&DO                                                                           
         CH    R1,=H'24'           TEST AFTER MIDNIGHT                          
         BNH   *+8                                                              
         SH    R1,=H'24'           YES - GO BACK ONE DAY                        
*&&                                                                             
         MH    R1,=H'100'                                                       
         MH    R0,=H'15'                                                        
         AR    R1,R0               R1 CONTAINS MILITARY TIME                    
         CH    R1,=H'2400'         TEST AFTER MIDNIGHT                          
         BNH   *+8                                                              
         SH    R1,=H'2400'          YES, GO BACK ONE DAY                        
         BR    RE                                                               
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--CMD+        
               #)'                                                              
*------------------------- CALC MAX # DTNTRYs ------------------------*         
                                                                                
* Calculates the max number of day/time combos that can fit into                
*  STBUFFER.  It is used in BINSRCH and other places.                           
* At exit, MAXNDT = the max number of day/time entries possible                 
                                                                                
CMXNDT   DS    0H                                                               
         SR    RE,RE                                                            
         LH    RF,LSTBUFFR                                                      
         SH    RF,=H'4'            LEAVE 4 BYTES FOR "HEADER" INFO              
         LA    R0,DTNTRYQ                                                       
         DR    RE,R0                                                            
         STH   RF,MAXNDT                                                        
*                                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--DDT+        
               #)'                                                              
*---------------------- DO DUMMY TSAR DEMO RECDS ---------------------*         
                                                                                
* Goes through all combinations of this time's STATION/BOOK/DAY/TIME            
*  input and creates dummy TSAR DEMO RECORDs those combinations not in          
*  the sort buffer yet.                                                         
                                                                                
DODUMTDR DS    0H                                                               
         LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,DBFIL                                                     
         MVC   DBAREC,AIOAREA                                                   
         MVI   DBFUNCT,DBGETDEM                                                 
         MVC   DBCOMFCS,AFAC                                                    
         MVC   DBSELSRC,DBSRC                                                   
         MVC   DBSELMED,DBMED                                                   
         MVC   DBSELAGY,AGYALPH                                                 
                                                                                
*                                                                               
         DS    0H                  NEED LONGER DAYS/QHS TABLE                   
         CLI   DBMED,C'T'           FOR MEDIA=USTV                              
         BNE   DDTDQX                                                           
         CLI   DBSRC,C'N'           FOR SOURCE=NSI                              
         BNE   DDTDQX                                                           
         CLC   DBFIL,=C'TP '        FOR TP FILE                                 
         BNE   DDTDQX                                                           
                                                                                
DDTQ08   MVC   DUB+0(4),=C'DBD3'                                                
         LA    RE,DBXTDQT                                                       
         ST    RE,DUB+4                                                         
         XC    0(DBXTDQTL,RE),0(RE)                                             
         MVI   SDBXF,C'D'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
DDTDQX   EQU   *                                                                
                                                                                
         MVI   THISSTA,0                                                        
*                                                                               
DDT12    DS    0H                                                               
         ZIC   R1,THISSTA                                                       
         LA    R1,1(R1)                                                         
         STC   R1,THISSTA                                                       
         CLC   THISSTA,NSTAS                                                    
         BH    DDT70                                                            
         MVC   DBSELSTA,STAS       SET STATION FOR DEMAND CALL                  
         MVI   THISBK,0                                                         
                                                                                
DDT14    DS    0H                                                               
         ZIC   R1,THISBK                                                        
         LA    R1,1(R1)                                                         
         STC   R1,THISBK                                                        
         CLC   THISBK,NBKS                                                      
         BH    DDT12                                                            
         MVC   DBSELBK,BKS         SET BOOK                                     
         MVC   DBBTYPE,BKS+2        AND BOOK TYPE FOR DEMAND CALL               
         MVI   THISDAY,0                                                        
         LA    R2,DAYS-L'DAYS                                                   
                                                                                
DDT16    DS    0H                                                               
         ZIC   R1,THISDAY                                                       
         LA    R1,1(R1)                                                         
         STC   R1,THISDAY                                                       
         LA    R2,L'DAYS(R2)                                                    
         CLC   THISDAY,NDAYS                                                    
         BH    DDT14                                                            
                                                                                
         MVI   THISDAYR,1          ASSUME NO ROTATION                           
         NI    MYFLAG1,XFF-MYF1DTRO                                             
*                                                                               
DDT16M   DS    0H                  CHECK FOR ROTATIONS                          
         MVC   DUB(L'DAYS),0(R2)    ASSUME IT'S NOT A ROTATION                  
         CLC   0(3,R2),=C'ROT'                                                  
         BNE   DDT16R                                                           
         OI    MYFLAG1,MYF1DTRO     IT IS A ROTATION                            
         ZICM  RF,3(R2),(3)                                                     
         LA    RF,LDTROTN(RF)       RF = A(COMPONENTS OF ROTATION) - 1          
         ZIC   R1,THISDAYR          PICK UP COMPONENT COUNTER                   
         BCTR  R1,0                                                             
         MH    R1,=Y(L'DAYS)        GET DISPLACEMENT TO COMPONENT               
         LA    R1,1(R1)                                                         
         AR    RF,R1                RF-->COMPONENT TO PROCESS NOW               
         MVC   DUB(L'DAYS),0(RF)                                                
DDT16R   EQU   *                                                                
                                                                                
         CLC   DBFIL,=C'PAV'                                                    
         BE    DDT100                                                           
*                                                                               
         CLI   ACTN,DEMOPER        FOR ACTION=PERIOD,                           
         BE    DDT59                NO DETAIL RECORDS NEEDED                    
*                                                                               
         DS    0H                  RESET DBLOCK FOR ANOTHER DEMAND CALL         
         MVC   DBSELDAY,DUB+0       SET DAY                                     
         MVC   DBSELTIM,DUB+1        AND TIMES FOR DEMAND CALL                  
         MVI   DBERROR,0                                                        
         MVI   DBDQPTR,0                                                        
         XC    DBLASTS,DBLASTS                                                  
         XC    DBDQTAB,DBDQTAB                                                  
         XC    DBACTUAL,DBACTUAL                                                
                                                                                
         DS    0H                  HAVE STATION/BOOK/DAY/TIME COMBO             
         GOTO1 ASETUSID                                                         
         GOTO1 VDEMAND,DMCB,DBLOCKD,0,0,0,0,0                                   
                                                                                
         DS    0H                                                               
         LA    R0,DBLOCKD                                                       
         ST    R0,ADBLOCK                                                       
         MVI   GOSUBN,GADQT#                                                    
         GOTO1 AGOSUB                                                           
         L     R4,ADBDQD                                                        
*                                                                               
         DS    0H                  QUARTER HOUR ADJUSTMENT FACTOR               
         MVI   THISQHAF,100             ASSUME IT'S ZERO (100-BASED)            
         CLC   =AL2(DBDQUXTD),DBDQTAB+0 USING XTND FOR D/Q ENTRIES?             
         BNE   DDTQAFX                   NOPE, LEAVE ADJ FACTOR ALONE           
         L     RF,ADBDQD                 YES, QH ADJ FCTR IS B4 D/QHs           
         SHI   RF,(DBDQXFXL-(DBDQADJF-DBDQXTND))  RF-->ADJ FACTOR               
         ZICM  R1,0(RF),(3)                       R1 = ADJ FACTOR,              
         AHI   R1,100                              MAKE IT 100-BASED            
         STC   R1,THISQHAF                         AND SAVE IT                  
DDTQAFX  EQU   *                                                                
         DROP  R6                                                               
                                                                                
         USING DBDQD,R4                                                         
*                                                                               
         OC    DBDQD(DBDQLEN),DBDQD     ANY DBDQD ENTRY?                        
         BZ    DDT70                     NO, DON'T POST STUFF                   
*                                                                               
DDT20    DS    0H                  SET LOOPING PARAMETERS                       
         CLI   0(R4),XFF           IF NO MORE DBDQD ENTRIES,                    
         BE    DDT54                GO POST SUMMARY RECORD                      
         MVC   THISKDAY,DBDQKDAY                                                
         MVC   RQSTSQHR,DBDQSQH                                                 
         MVC   THISSQH,DBDQSQH                                                  
         MVC   THISEQH,DBDQSQH                                                  
         MVC   RQSTEQHR,DBDQEQH                                                 
         DROP  R4                                                               
                                                                                
         B     DDT30                                                            
*                                                                               
DDT30    DS    0H                  BUILD TSAR DEMO RECD KEY                     
         XC    TSARKEY,TSARKEY                                                  
         LA    R3,TSARKEY                                                       
         USING TSDEMRCD,R3                                                      
         MVI   TDRRCTYP,TDRRTDMV                                                
                                                                                
         ZICM  RF,THISSTA,(1)                                                   
         BZ    DDT32                                                            
         LH    RE,DSPRCTST                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DDT32    STC   RF,TDRSTA                                                        
                                                                                
         ZICM  RF,THISBK,(1)                                                    
         BZ    DDT34                                                            
         LH    RE,DSPRCTBK                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DDT34    STC   RF,TDRBK                                                         
                                                                                
         ZICM  RF,THISDAY,(1)                                                   
         BZ    DDT36                                                            
         LH    RE,DSPRCTDT                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DDT36    STC   RF,TDRDAY                                                        
*                                                                               
                                                                                
DDT40    DS    0H                  R3 MUST BE POINTING TO TSARKEY               
         MVC   TDRDAYR,THISDAYR                                                 
         MVC   TDRKDAY,THISKDAY                                                 
                                                                                
DDT42    DS    0H                  R3 MUST BE POINTING TO TSARKEY               
         MVC   TMPSQH(2),THISSQH                                                
         MVI   GOSUBN,ADJQH#                                                    
         GOTO1 AGOSUB                                                           
         MVC   TDRSQH(2),TMPSQH                                                 
         DROP  R3                                                               
                                                                                
         GOTO1 AGETTDR             GO GET TSAR DEMO RECORD                      
         BE    DDT50               RECORD ALREADY EXISTS                        
*                                                                               
         DS    0H                  RECORD JUST ADDED TO TSAR BUFFER             
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  RE,TSAREC+1,(7)                                                  
         DROP  RF                                                               
                                                                                
         DS    0H                  FILL IT UP W/ DUMMY DATA                     
         LA    R3,2(RE)                                                         
         USING TSDEMRCD,R3                                                      
         MVC   TDRPROG,SPACES                                                   
         MVC   TDRQHAF,THISQHAF                                                 
         OI    TDRFLAG1,TF1DUMDV                                                
         XC    TDRDEMS,TDRDEMS                                                  
         DROP  R3                                                               
         LA    R0,TDRFIXL+L'TDRDEMS+2                                           
         STCM  R0,3,0(RE)                                                       
                                                                                
         GOTO1 APOST               POST DUMMY RECD W/ DUMMY VALUES              
*                                                                               
DDT50    DS    0H                  BUMP TO NEXT QUARTER-HOUR                    
         CLI   THISSQH,XFF          POSTED DUMMY SUMMARY RECORD?                
         BE    DDT16                 YEP, GET NEXT DAY TIME                     
         ZIC   R1,THISSQH                                                       
         CLM   R1,1,RQSTEQHR        REACHED END QUARTER-HOUR YET?               
         BNL   DDT52                 YEP, GO BUMP TO NEXT DBDQD ENTRY           
         LA    R1,1(R1)              NOPE, POST RECD FOR NEXT QHR               
         STC   R1,THISSQH                                                       
         STC   R1,THISEQH                                                       
         LA    R3,TSARKEY           POINT R3 BACK TO TSARKEY                    
         B     DDT42                 AND SET NEW KEY VALUES                     
                                                                                
DDT52    DS    0H                  BUMP TO NEXT DBDQD ENTRY                     
         LA    R4,DBDQLEN(R4)                                                   
         B     DDT20                                                            
                                                                                
DDT54    DS    0H                  SET FOR POSTING SUMMARY RECORD               
         TM    MYFLAG1,MYF1DTRO     CHECK FIRST IF IT'S A ROTATION              
         BZ    DDT59                                                            
         ZICM  RF,3(R2),(3)         IT IS A ROTATION                            
         LA    RF,LDTROTN(RF)       RF-->L(STORAGE SPACE FOR COMPNENTS)         
         ZIC   R1,THISDAYR          PICK UP COMPONENT COUNTER                   
         LA    RE,1(R1)              INCREMENT AND REMEMBER IT                  
         MH    R1,=Y(L'DAYS)        GET DISPLACEMENT TO NEXT COMPONENT          
         LA    R1,1(R1)              ADJUST FOR HEADER BYTE                     
         CLM   R1,1,0(RF)           DONE W/ ALL COMPONENTS?                     
         BNL   *+12                  YEP, KEEP PLUNGING AHEAD                   
         STC   RE,THISDAYR           NO, UPDATE COMPONENT COUNTER               
         B     DDT16M                 AND GO BACK & PROCESS NEXT ONE            
DDT59    EQU   *                                                                
*                                                                               
                                                                                
         DS    0H                  SET VALUES TO POST SUMMARY RECORD            
         MVI   THISDAYR,XFF                                                     
         MVC   THISKDAY,THISDAY                                                 
         XI    THISKDAY,XFF                                                     
         MVI   THISSQH,XFF                                                      
         MVI   THISEQH,XFF                                                      
*^^BUGFIX                                                                       
*&&DO                                                                           
         LA    R3,TSARKEY           POINT R3 BACK TO TSARKEY                    
         B     DDT40                 AND SET NEW KEY VALUES                     
*&&                                                                             
         B     DDT30                GO SET KEY VALUES AND POST RECD             
*^^EOBUGFIX                                                                     
*                                                                               
DDT70    DS    0H                                                               
         B     DDTX                                                             
                                                                                
                                                                                
DDT100   DS    0H                  PAV FILE                                     
         TM    DEMFLAG1,DF1STERO+DF1DEM32   IF IT'S A DEM32 SESSION,            
         BO    DDTX                          DON'T PASS DUMMY DATA              
                                                                                
*                                                                               
         DS    0H                                                               
         XC    TSARKEY,TSARKEY                                                  
         LA    R3,TSARKEY                                                       
         USING TSDEMRCD,R3                                                      
         MVI   TDRRCTYP,TDRRTDMV                                                
                                                                                
         ZICM  RF,THISSTA,(1)                                                   
         BZ    DDT112                                                           
         LH    RE,DSPRCTST                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DDT112   STC   RF,TDRSTA                                                        
                                                                                
         ZICM  RF,THISBK,(1)                                                    
         BZ    DDT114                                                           
         LH    RE,DSPRCTBK                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DDT114   STC   RF,TDRBK                                                         
         DROP  R3                                                               
*                                                                               
         DS    0H                  MAKE A COPY OF TSAR BLOCK AND USE IT         
         MVC   WORK(TSARDL),TSARBLCK                                            
         LA    R4,WORK                                                          
         USING TSARD,R4                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
                                                                                
         LA    R3,2(R2)                                                         
         USING TSDEMRCD,R3                                                      
         MVC   TDRKEY(TDRKEYL),TSARKEY  PUT KEY IN I/O AREA                     
         MVI   TSACTN,TSARDH            READ HIGH FOR RECORD                    
         XC    TSRNUM,TSRNUM                                                    
         GOTO1 VTSAR,(R4)                                                       
         CLI   TSERRS,0                                                         
         BE    DDT150                                                           
         TM    TSERRS,TSEEOF                                                    
         BO    DDT120                                                           
         CLC   TDRKEY(TKYBKL),TSARKEY                                           
         BE    DDT150                                                           
                                                                                
                                                                                
DDT120   DS    0H                  NOTHING FOR STATION/BOOK COMBO               
         B     DDTX                                                             
         DROP  R3                                                               
         DROP  R4                                                               
                                                                                
*                                                                               
DDT150   DS    0H                                                               
         MVI   STBKDATA,C'Y'       THERE IS DATA FOR STTN/BOOK COMBO            
         B     DDTX                                                             
*                                                                               
DDTX     DS    0H                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--GWK+        
               #)'                                                              
*---------------------GET ACTIVE WEEKS INDICATORS --------------------*         
                                                                                
* Translates the week bits in TMPWKS into printable format in ACTVWKS.          
                                                                                
GETWKS   DS    0H                                                               
         MVI   ACTVWKS,C'.'                                                     
         MVC   ACTVWKS+1(L'ACTVWKS-1),ACTVWKS                                   
         CLI   DBMED,C'N'                                                       
         BNE   *+22                                                             
         TM    TMPWKS,X'0F'                                                     
         BNZ   *+14                                                             
         MVC   ACTVWKS,=C' N/A'                                                 
         B     GETWKSX                                                          
*                                                                               
         TM    TMPWKS,X'08'                                                     
         BZ    *+8                                                              
         MVI   ACTVWKS+0,C'1'                                                   
         TM    TMPWKS,X'04'                                                     
         BZ    *+8                                                              
         MVI   ACTVWKS+1,C'2'                                                   
         TM    TMPWKS,X'02'                                                     
         BZ    *+8                                                              
         MVI   ACTVWKS+2,C'3'                                                   
         TM    TMPWKS,X'01'                                                     
         BZ    *+8                                                              
         MVI   ACTVWKS+3,C'4'                                                   
*                                                                               
         DS    0H                                                               
GETWKSX  B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--MTQ+        
               #)'                                                              
*--------------------- MILITARY TO QUARTER HOURS ---------------------*         
                                                                                
* ROUTINE TO CONVERT MILITARY TIME TO QUARTER HOUR                              
* At entry,                                                                     
*   TEMPMTIM = input military time,                                             
* At exit,                                                                      
*   TEMPQHR  = output quarter hour.                                             
                                                                                
MILTOQHR DS    0H                                                               
         SR    R0,R0               R0 WILL CONTAIN QUARTER HOUR                 
         ZICM  RE,TEMPMTIM,(3)                                                  
         CH    RE,=H'600'                                                       
         BNL   *+8                                                              
         AH    RE,=H'2400'                                                      
         SH    RE,=H'600'                                                       
         BZ    MTQ20                                                            
         SRDA  RE,32                                                            
         D     RE,=F'100'                                                       
         SLA   RF,2                MULTIPLY BY 4                                
         AR    R0,RF                                                            
         SRDA  RE,32                                                            
         D     RE,=F'15'                                                        
         AR    R0,RF                                                            
MTQ20    STC   R0,TEMPQHR                                                       
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--S1M+        
               #)'                                                              
*------------------------ SUBTRACT ONE MINUTE ------------------------*         
                                                                                
* ROUTINE TO SUBTRACT 1 MINUTE FROM A GIVEN TIME                                
* At entry,                                                                     
*   TEMPMTIM = input military time,                                             
* At exit,                                                                      
*   TEMPMTIM = output military time.                                            
                                                                                
SUB1MIN  DS    0H                                                               
         LA    RF,59               59TH MINUTE                                  
         SR    R0,R0                                                            
         SR    R1,R1                                                            
         ICM   R1,3,TEMPMTIM                                                    
         BNZ   *+8                                                              
         LA    R1,2400             FORCE MIDNIGHT TO 2400 HOUR                  
         BCTR  R1,0                SUBTRACTING THE 1 MINUTE                     
         D     R0,=F'100'                                                       
         CR    R0,RF               IF REMAINDER > 59, USE 59 MINUTES,           
         BH    *+6                                                              
         LR    RF,R0                ELSE, USE THE REMAINDER                     
         SR    R0,R0                                                            
         M     R0,=F'100'          GET TIME BACK TO MILITARY                    
         AR    R1,RF                                                            
         STCM  R1,3,TEMPMTIM                                                    
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--GIS+        
               #)'                                                              
*----------------- GET INDIVIDUAL (BOOK) SUMMARY LINE ----------------*         
                                                                                
* Routine to get the summary line for individual books in a latest  n           
*  books request and post it to the buffer.  It calls SPDEMLK with              
*  the specific book that is currently being processed.                         
* At entry,                                                                     
*   DBLOCK1  = the main SPDEMLKD block                                          
*   MYNLBK   = number of latest books in packed decimal                         
*   R2      -->current day/time in process                                      
                                                                                
GTINDSUM DS    0H                                                               
         LA    R5,LNBKLIST                                                      
         ZAP   THISLBK,=P'1'                                                    
*                                                                               
         LA    R6,SPDMLK2          SET UP A SECOND SPDEMLKD BLOCK               
         USING SPDEMLKD,R6                                                      
         MVC   SPDEMLK(SPDEMLKL),DBLOCK1                                        
         XC    SPLKHOOK,SPLKHOOK    NO NEED FOR HOOKS HERE                      
                                                                                
*                                                                               
GIS010   DS    0H                                                               
         MVC   SPLKDBK,0(R5)        GET SPECIFIC BOOK                           
*                                                                               
         DS    0H                   SET DAYS & TIMES                            
         CLC   0(3,R2),=C'ROT'                                                  
         BE    *+20                                                             
         MVC   SPLKDAY,0(R2)         DIRECTLY INTO SPDEMLK BLOCK                
         MVC   SPLKTIM,1(R2)                                                    
         B     GIS015X                                                          
                                                                                
         DS    0H                    SET UP DAY/TIME LINK IN SPDEMLK            
         XC    DUB,DUB                                                          
         LA    R0,MYDBXTRA                                                      
         ST    R0,DUB+4                                                         
         MVI   SDBXF,C'S'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   RF,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTLD,RF                                                        
         MVC   DBXTLID,=C'DYTM'                                                 
         ZICM  RE,3(R2),(3)                                                     
         LA    RE,LDTROTN(RE)                                                   
         ZIC   R1,0(RE)                                                         
         SH    R1,=H'2'                                                         
         EXMVC R1,DBXTLIST,1(RE)                                                
         LA    R1,DBXTLIST+1(R1)                                                
         MVI   0(R1),0                                                          
         DROP  RF                                                               
GIS015X  EQU  *                                                                 
*                                                                               
         XC    SPLKPRG,SPLKPRG                                                  
         XC    SPLKDBLK,SPLKDBLK                                                
                                                                                
         MVC   SPLKUID,USERID                                                   
         GOTO1 VSPDEMLK,MYDMCB,(X'FF',SPDEMLKD)                                 
         CLI   0(R1),0                                                          
         BE    *+8                                                              
         BNE   GIS099                                                           
                                                                                
         DS    0H                  DROP SVI OR DEMO VALUES FROM LOOKUP          
         LA    RF,THISDEMS          DROPPING SVI                                
         CLI   OPTDTYP,C'S'                                                     
         BNE   *+8                                                              
         LA    RF,THISDEMS+4        DROPPING DEMO VALUES                        
         ZIC   R0,DEMONDEM                                                      
         LA    R1,THISDEMS                                                      
         MVC   0(4,R1),0(RF)                                                    
         LA    R1,4(R1)                                                         
         LA    RF,8(RF)                                                         
         BCT   R0,*-14                                                          
                                                                                
*                                                                               
         DS    0H                  POST TO BUFFER                               
         XC    POSTLINE,POSTLINE    PUTTING STUFF ON POSTLINE DIRECTLY          
         LA    R1,POSTLINE                                                      
         USING BINRECD,R1                                                       
         MVC   BINKEY(BINKEYL),THISKEY                                          
         MVC   BINKDAY,THISDAY                                                  
         XI    BINKDAY,XFF                                                      
         MVI   BINSQH,XFF                                                       
         MVI   BINEQH,XFF                                                       
         MVI   BINTYPE,0                                                        
                                                                                
         MVC   BINPROG,SPLKPRG                                                  
         MVC   BINBOOK,0(R5)                                                    
         LA    RE,BINDEMS                                                       
         LA    RF,THISDEMS                                                      
         ZIC   R0,NDEMS                                                         
         MVC   0(3,RE),1(RF)                                                    
         LA    RE,3(RE)                                                         
         LA    RF,4(RF)                                                         
         BCT   R0,*-14                                                          
                                                                                
         GOTO1 APOST                                                            
         DROP  R1,R6                                                            
GIS099   EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  BUMP TO NEXT LATEST BOOK IN LIST             
         SP    MYNLBK,=P'1'                                                     
***      BZ    GISX                                                             
         BNP   GISX                                                             
         LA    R5,L'LNBKLIST(R5)                                                
         AP    THISLBK,=P'1'                                                    
         B     GIS010                                                           
                                                                                
*                                                                               
GISX     DS    0H                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--GPR+        
               F#)'                                                             
*---------------------------- GET PROFILE ----------------------------*         
                                                                                
* At entry,                                                                     
*   DUB(4) = profile id                                                         
                                                                                
GETPROFL DS    0H                                                               
*                                                                               
         DS    0H                  FIND ENTRY FOR PROFILE                       
         L     RE,APROFTAB                                                      
         USING PROFTAB,RE                                                       
GPRF010  CLI   0(RE),EOT                                                        
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   PRFTBID,DUB                                                      
         BE    *+12                                                             
         LA    RE,PRFTBQ(RE)                                                    
         B     GPRF010                                                          
                                                                                
         ZICM  RF,PRFTBASV,(3)                                                  
         LA    RF,DEMWRKD(RF)       RF-->AREA TO HOLD PROFILE                   
         ST    RF,APROFILE                                                      
         ZIC   R1,PRFTBLSV                                                      
         STC   R1,LPROFILE          R1 = L(AREA TO HOLD PROFILE)                
                                                                                
         BCTR  R1,0                                                             
         EX    R1,*+8                                                           
         B     *+10                                                             
         XC    0(0,RF),0(RF)        CLEAR AREA USED TO HOLD PROFILE             
                                                                                
         ZICM  RF,PRFTBRTN,(3)                                                  
         LA    RF,GETPROFL(RF)                                                  
         BR    RF                   GO TO APPROPRIATE GET-PROFILE RTN           
         DC    H'0'                                                             
         DROP  RE                                                               
                                                                                
*                                                                               
** REP RMP PROFILE **                                                           
*                                                                               
GPRFRRMP00 DS  0H                                                               
         XC    WORK,WORK            BUILD KEY OF REP RECD IN WORK               
         LA    R6,WORK                                                          
         USING RREPREC,R6                                                       
         MVI   RREPKTYP,X01                                                     
         MVC   RREPKREP,AGYALPH                                                 
         DROP  R6                                                               
*                                                                               
         XC    DMCB(24),DMCB                                                    
         GOTO1 VDATAMGR,DMCB,=C'DMREAD',=C'REPDIR',WORK,WORK                    
         CLI   DMCB+08,X'10'                                                    
         BNE   *+6                                                              
         DC    H'0'                                                             
                                                                                
         GOTO1 (RF),(R1),=C'GETREC',=C'REPFILE',WORK+28,AIOAREA,       +        
               MYDMWORK                                                         
         CLI   DMCB+08,0                                                        
         BE    *+6                                                              
         DC    H'0'                                                             
                                                                                
*                                                                               
         DS    0H                  LOOK FOR PROFILE IN RECORD                   
         L     R3,AIOAREA           R3-->REP RECORD                             
         MVI   MYELCODE,X'04'                                                   
         LA    R0,RREPELEM-RREPREC                                              
         STH   R0,MYDATDSP                                                      
         BAS   RE,GETEL                                                         
         BNE   GPRFRRMPX                                                        
*                                                                               
         ZIC   R0,(RREPPGM#-RREPPGMP)(R3)  R0 = # OF PROGRAM PROFILES           
         LA    R6,(RREPPGM1-RREPPGMP)(R3)  R6-->PROGRAM PROFILES LIST           
                                                                                
GPRFRRMP40 DS  0H                                                               
         CLI   0(R6),RREPQRMP       LOOK FOR RMP PROGRAM PROFILE                
         BE    *+16                                                             
         LA    R6,RREPPGML(R6)                                                  
         BCT   R0,GPRFRRMP40                                                    
         B     GPRFRRMPX                                                        
*                                                                               
         L     RF,APROFILE                                                      
         ZIC   R1,LPROFILE                                                      
         BCTR  R1,0                                                             
         EXMVC R1,0(RF),2(R6)       MOVE PROFILE INTO STORAGE AREA              
                                                                                
*                                                                               
GPRFRRMPX EQU  *                                                                
         B     GETPRFLX                                                         
                                                                                
*                                                                               
GETPRFLX DS    0H                                                               
         B     XIT_01                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--PIU+        
               N#)'                                                             
*------------------------- PROCESS IUN STUFF -------------------------*         
                                                                                
* At entry,                                                                     
*   R6-->DBLOCK,                                                                
*   IUNOLD values are set,                                                      
*   AVUTS-->VUT values to use in computing home shares,                         
*   DEMODEMS = list of requested demos.                                         
* At exit,                                                                      
*   THISDEMS = output demo values.                                              
*   IUNWRK contains demo values in IUN format                                   
                                                                                
PROCIUN  DS    0H                                                               
         USING DBLOCKD,R6                                                       
                                                                                
*                                                                               
* SAVE DBLOCK *                                                                 
*                                                                               
         LA    R0,SVDBLOCK          DESTINATION                                 
         LA    R1,DBLOCK1X-DBLOCK1                                              
         LA    RE,DBLOCK            SOURCE                                      
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
                                                                                
*                                                                               
* SET UP IUN AREAS *                                                            
*                                                                               
         L     R4,AIUNWRK                                                       
         LR    R0,R4                                                            
         LA    R1,IUNWRKL                                                       
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE               CLEAR IUN WORK AREA                          
*                                                                               
         MVI   0(R4),RINVKTYQ                                                   
         LA    R4,500(R4)                                                       
         USING IUNRECD,R4                                                       
                                                                                
*                                                                               
* EXPLODE DEMO RECORD INTO IUN BUCKETS *                                        
*                                                                               
         DS    0H                                                               
         GOTO1 VRGETIUN,MYDMCB,(10,DBLOCK),IUNRECD                              
                                                                                
*                                                                               
* COPY OLD TO NEW TO COMPLETE IUN RECORD *                                      
*                                                                               
         LA    R0,IUNNEW                                                        
         LA    R1,IUNNEWX-IUNNEW                                                
         LA    RE,IUNOLD                                                        
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
                                                                                
*                                                                               
* GET HOME SHARES *                                                             
*                                                                               
         GOTO1 VDEMOUT,DMCB,(C'L',ASHRLIST),DBLOCKD,ISHOMES,0                   
                                                                                
*                                                                               
* BUILD IUN RECORD *                                                            
*                                                                               
         DS    0H                  SET DBLOCK VALUES                            
         L     RE,AIUNWRK                                                       
         ST    RE,DBAREC            SET A(RECORD)                               
         LA    RE,(RINVPEL-RINVREC)(RE)                                         
         MVI   0(RE),0                                                          
         ST    RE,DBAQUART          SET A(QH ELEM)                              
         LA    R0,IUNRECL/4                                                     
         STH   R0,DBNUMVLS          SET NUMBER OF VALUES                        
                                                                                
                                                                                
         L     RF,DBCOMFCS                                                      
         L     RF,(CDEMAINT-COMFACSD)(RF)                                       
         MVC   WORK(10),OFORMAT                                                 
         CLI   TAPEOPT,C'Y'        SWITCH FORMULAE FOR TAPE BASED OPT           
         BNE   *+10                                                             
         MVC   WORK+7(2),=X'5A0B'                                               
         GOTO1 (RF),MYDMCB,=C'REP',DBLOCK,IUNRECD,WORK                          
                                                                                
*                                                                               
* RESTORE DBLOCK *                                                              
*                                                                               
         LA    R0,DBLOCK            DESTINATION                                 
         LA    R1,DBLOCK1X-DBLOCK1                                              
         LA    RE,SVDBLOCK          SOURCE                                      
         LR    RF,R1                                                            
         MVCL  R0,RE                                                            
*                                                                               
         DS    0H                                                               
         B     XIT_01                                                           
         DROP  R4,R6                                                            
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--DIV+        
               #)'                                                              
*------------------------ GENERIC DIVIDE LOGIC -----------------------*         
                                                                                
* At entry, DIVIDEND, DIVISOR are set.                                          
* At exit, QUOTIENT and REMAINDR are set.                                       
                                                                                
DIVIDE   DS    0H                                                               
         XC    QUOTIENT,QUOTIENT                                                
         XC    REMAINDR,REMAINDR                                                
                                                                                
         ICM   RF,15,DIVISOR       IF DIVISOR IS ZERO,                          
         JZ    EXIT                 CALLER GETS ZERO BACK                       
         OC    DIVIDEND,DIVIDEND   IF DIVIDEND IS ZERO                          
         JZ    EXIT                 CALLER GETS ZERO BACK ALSO                  
                                                                                
         DS    0H                  CALCULATE QUOTIENT                           
         LM    R0,R1,DIVIDEND                                                   
         SLDA  R0,1                DOUBLE DIVIDEND                              
         DR    R0,RF                                                            
         LTR   R1,R1                                                            
         BM    *+8                                                              
         AH    R1,=H'1'                                                         
         SRA   R1,1                                                             
         ST    R1,QUOTIENT                                                      
                                                                                
         DS    0H                  CALCULATE REMAINDER                          
         AH    R0,=H'1'                                                         
         SRA   R0,1                                                             
         ST    R0,REMAINDR                                                      
                                                                                
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--MIS+        
               C STUFF)'                                                        
*--------------------- SUBR01 MISCELLANEOUS STUFF --------------------*         
                                                                                
         GETEL R3,MYDATDSP,MYELCODE                                             
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR01--LTO+        
               R && CONSTANTS)'                                                 
*------------------------- LTORG & CONSTANTS -------------------------*         
         LTORG                                                                  
         SPACE 1                                                                
OFORMAT  DC    C'INVUIUN',X'530B00'                                             
                                                                                
SUBR01L  EQU   *-SUBR01                                                         
         DS    0CL(4096-SUBR01L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
***********************************************************************         
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02)'            
***********************************************************************         
*======================== SUBROUTINE POOL TWO ========================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR02Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR02Q                                                    
SUBR02   NMOD1 0,1B0202**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R01#)         SUBTRACT FOR SUB-RTN #1                      
*&&DO                                                                           
         BCTR  R1,0                                                             
*&&                                                                             
         SLL   R1,2                                                             
         B     R02_00(R1)                                                       
                                                                                
***T#    EQU   (R02_01-*)/4+R01#   (SPARE)                                      
SDBX#    EQU   (R02_02-*)/4+R01#   SET UP A LINK IN DBEXTEND AREA               
*PDDR#    EQU   (R02_03-*)/4+R01#   POST DUMMY DATA RECORD                      
*GADLD#   EQU   (R02_04-*)/4+R01#   GET A(DOWNLOAD DATA TABLES)                 
OKDL#    EQU   (R02_05-*)/4+R01#   OKAY TO DOWNLOAD DATA?                       
D32DL#   EQU   (R02_06-*)/4+R01#   DEMLINE PROCESSING FOR DEM32                 
D32TP#   EQU   (R02_07-*)/4+R01#   DOWNLOAD TP DATA                             
*D32PV#   EQU   (R02_08-*)/4+R01#   DOWNLOAD PAV DATA                           
                                                                                
R02_00   DS    0H                                                               
R02_01   J     EXIT                (SPARE)                                      
R02_02   B     STDBXLNK            SET UP A LINK IN DBEXTEND AREA               
*R02_03   B     PDUMDREC            POST DUMMY DATA RECORD                      
*R02_04   B     GADLDTAB            GET A(DOWNLOAD DATA TABLES)                 
R02_05   B     OKDOWNLD            OKAY TO DOWNLOAD DATA?                       
R02_06   B     D32DEMLN            DEMLINE PROCESSING FOR DEM32                 
R02_07   B     D32DLTP             DOWNLOAD TP DATA                             
*R02_08   B     D32DLPAV            DOWNLOAD PAV DATA                           
R02#     EQU   (*-R02_00)/4+R01#                                                
         DC    H'0'                                                             
                                                                                
YES_02   SR    R9,R9                                                            
NO_02    LTR   R9,R9                                                            
XIT_02   XIT1                                                                   
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--SDB+        
               X#)'                                                             
*------------------------- SET DBEXTEND AREA -------------------------*         
                                                                                
* Sets up a link in the DBEXTEND area.                                          
* At entry,                                                                     
*   DUB(4)   = link identification if want to match to an existing link         
*            = x'00000000' if link must be added,                               
*   DUB+4(4) = A(link),                                                         
*   R6       = A(Parameter block) according to SDBXF:                           
*            = A(SPDEMLK block) when SDBXF=C'S'                                 
*            = A(DBLOCK)        when SDBXF=C'D'                                 
*            = A(SPDEMUP block) when SDBXF=C'U'                                 
* At exit,                                                                      
*   FULL     = address of link, zeroes if no link set up.                       
                                                                                
STDBXLNK DS    0H                                                               
         XC    FULL,FULL                                                        
*                                                                               
         CLI   SDBXF,C'S'                                                       
         BE    SDBX010                                                          
         CLI   SDBXF,C'D'                                                       
         BE    SDBX015                                                          
         CLI   SDBXF,C'U'                                                       
         BE    SDBX080                                                          
         DC    H'0'                                                             
                                                                                
*                                                                               
SDBX010  DS    0H                  GET R2 TO START OF EXTENSION AREA            
         DS    0H                  GET R2 TO START OF EXTENSION AREA            
         USING SPDEMLKD,R6                                                      
         L     RF,SPLKAREC                                                      
         ICM   R0,15,8(RF)                                                      
         CLC   0(8,RF),=C'DBEXTEND'                                             
         BE    SDBX022                                                          
                                                                                
         MVC   0(8,RF),=C'DBEXTEND'                                             
         L     R2,DUB+4            USE A(CALLER'S LINK) IF DBEXTEND=0           
         STCM  R2,15,8(RF)                                                      
         MVC   0(4,R2),DUB+0        PUT IN USER'S LINK IDENTIFICATION           
         B     SDBX040              AND MAKE IT THE LAST LINK                   
         DROP  R6                                                               
*                                                                               
SDBX015  DS    0H                  R6-->DBLOCK                                  
         USING DBLOCKD,R6                                                       
         ICM   R0,15,DBEXTEND                                                   
         BNZ   SDBX022                                                          
                                                                                
         L     R2,DUB+4            USE A(CALLER'S LINK) IF DBEXTEND=0           
         STCM  R2,15,DBEXTEND                                                   
         MVC   0(4,R2),DUB          PUT IN USER'S LINK IDENTIFICATION           
         B     SDBX040              AND MAKE IT THE LAST LINK                   
         DROP  R6                                                               
                                                                                
*                                                                               
SDBX020  DS    0H                  BUMP TO APPROPRIATE LINK                     
         ICM   R0,15,4(R2)          GET ADDRESS OF NEXT LINK                    
         BZ    SDBX030               IF ZERO, ADD CALLER'S LINK                 
                                                                                
SDBX022  DS    0H                                                               
         LR    R2,R0                "BUMPED" TO NEXT LINK                       
         OC    DUB(4),DUB           IF LOOKING FOR MATCH,                       
         BZ    SDBX020                                                          
         CLC   DUB(4),0(R2)          AND LINKS' IDS MATCH,                      
         BNE   SDBX020                                                          
         B     SDBX050               PASS BACK ADDR OF CURRENT LINK             
                                                                                
*                                                                               
SDBX030  DS    0H                  ADD CALLER'S LINK TO END                     
         MVC   4(4,R2),DUB+4        SET THE NEXT ADDR INTO LAST LINK            
         ICM   R2,15,4(R2)          BUMP TO THE NEW LAST LINK                   
         MVC   0(4,R2),DUB          PUT IN USER'S LINK IDENTIFICATION           
         B     SDBX040                                                          
                                                                                
*                                                                               
SDBX040  DS    0H                  R2-->LAST LINK                               
         XC    4(4,R2),4(R2)        ZERO OUT THE NEXT ADDRESS                   
         B     SDBX050               NOPE                                       
                                                                                
*                                                                               
SDBX050  DS    0H                                                               
         ST    R2,FULL             RETURN ADDRESS OF MATCHED/ADDED LINK         
         B     SDBXX                                                            
                                                                                
*                                                                               
SDBX080  DS    0H                  R6-->SPDEMUPD                                
         USING SPDEMUPD,R6                                                      
         ICM   R0,15,SPUPEXTN                                                   
         BNZ   SDBX022                                                          
                                                                                
         L     R2,DUB+4            USE A(CALLER'S LINK) IF SPUPEXTN=0           
         STCM  R2,15,SPUPEXTN                                                   
         MVC   0(4,R2),DUB          PUT IN USER'S LINK IDENTIFICATION           
         B     SDBX040              AND MAKE IT THE LAST LINK                   
         DROP  R6                                                               
                                                                                
*                                                                               
SDBXX    DS    0H                                                               
         B     XIT_02                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--PDD+        
               R#)'                                                             
*&&DO                                                                           
*----------------------- POST DUMMY DATA RECORD ----------------------*         
                                                                                
* Posts dummy records to be used as "space-fillers" when data is                
*  passed back to STEREO.                                                       
                                                                                
PDUMDREC DS    0H                                                               
         CLC   DBFIL,=C'PAV'                                                    
         BE    PDDRPAV                                                          
         B     PDDRX                                                            
                                                                                
*                                                                               
** PAV FILE **                                                                  
*                                                                               
PDDRPAV  DS    0H                                                               
         LA    R4,TSARBLCK                                                      
         USING TSARD,R4                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
         LA    R3,2(R2)                                                         
         USING TSDEMRCD,R3                                                      
         XC    0(TDRFIXL,R3),0(R3)                                              
         MVI   TDRRCTYP,TDRRTDMV    RECORD TYPE = DEMO VALUE                    
         MVC   TDRSTA,SVTHSSTN      STATION                                     
         MVC   TDRBK,SVTHSBK         & BOOK COMBO                               
         MVI   TDRKDAY,X01          DUMMY KEY DAY                               
         MVI   TDRWKS,X'0F'         MIGHT AS WELL PUT ALL WEEKS                 
         OI    TDRFLAG1,TF1DUMDV    DUMMY DEMO VALUE                            
         DROP  R3                                                               
         LA    R0,TDRFIXL+2                                                     
         STCM  R0,3,0(R2)                                                       
         DROP  R4                                                               
*                                                                               
         DS    0H                                                               
         GOTO1 APOST                POST DUMMY DATA RECORD                      
         B     PDDRX                                                            
                                                                                
*                                                                               
PDDRX    DS    0H                                                               
         B     XIT_02                                                           
*&&                                                                             
*&&DO                                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--GAD+        
               LD#)'                                                            
*-------------------- GET A(DOWNLOAD DATA TABLES) --------------------*         
                                                                                
* Gets address of corresponding download data entry                             
* At entry,                                                                     
*   TMPRCTYP = TSAR demo record type                                            
* At exit,                                                                      
*   ADLDNTRY = A(download data table entry)                                     
                                                                                
GADLDTAB DS    0H                                                               
         ICM   R2,15,ADLDTABS      R2-->DOWNLOAD DATA TABLES                    
         BZ    GADLDX                                                           
         USING DLDTABD,R2                                                       
                                                                                
*                                                                               
GADLD012 DS    0H                                                               
         CLI   DLDTLEN,0                                                        
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   DLDTFIL,DBFIL                                                    
         BNE   GADLD018                                                         
         CLC   DLDTSRC,DBSRC                                                    
         BNE   GADLD018                                                         
         CLC   DLDTMED,DBMED                                                    
         BNE   GADLD018                                                         
         CLC   DLDTRTYP,TMPRCTYP                                                
         BNE   GADLD018                                                         
         CLC   DLDTVRSN,D32PCVER                                                
         BH    GADLD018                                                         
         B     GADLD019                                                         
*                                                                               
GADLD018 DS    0H                  BUMP TO NEXT DOWNLOAD DATA ENTRY             
         ZIC   R0,DLDTLEN                                                       
         AR    R2,R0                                                            
         B     GADLD012                                                         
GADLD019 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         B     GADLDX                                                           
                                                                                
*                                                                               
GADLDX   DS    0H                                                               
         ST    R2,ADLDNTRY                                                      
         J     EXIT                                                             
         DROP  R2                                                               
*&&                                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--OKD+        
               L#)'                                                             
*------------------------- OKAY TO DOWNLOAD? -------------------------*         
                                                                                
* See if data can be downloaded to PC                                           
* At entry,                                                                     
*   TMPRCTYP = TSAR demo record type                                            
*   FALEMPC  = element map code                                                 
*   FALDMPC  = data    map code                                                 
* At exit,                                                                      
*   CC set to eql if data can be downloaded                                     
*   CC set to neq if otherwise                                                  
                                                                                
OKDOWNLD DS    0H                                                               
         CLI   PUFLLOO,C'N'        OKAY FROM LAST LEFT OFF?                     
         BNE   OKDL010X             EITHER "YES" OR "N/A"                       
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         CLC   AS2EMPC,FALEMPC      MATCH ON ELEM MAP CODE AT BREAK             
         BNE   OKDLXN                                                           
         CLC   AS2DMPC,FALDMPC      MATCH ON DATA MAP CODE AT BREAK             
         BNE   OKDLXN                                                           
         DROP  RF                                                               
         MVI   PUFLLOO,C'Y'        NOW WE'RE OKAY FROM LAST LEFT OFF            
         B     OKDLXN               BUT DON'T DOWNLOAD THIS DATA TWICE          
OKDL010X EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         MVI   GOSUBN,GADLD#                                                    
         GOTO1 AGOSUB                                                           
         ICM   R2,15,ADLDNTRY                                                   
         BNZ   *+6                                                              
         DC    H'0'                                                             
                                                                                
*                                                                               
         DS    0H                  R2-->DOWNLOAD DATA TABLE ENTRY               
         LA    R3,DLDTFIXL(R2)                                                  
         SR    R0,R0                                                            
*                                                                               
OKDL022  DS    0H                  BUMP TO SECTION FOR ELEMENT MAP CODE         
         CLI   0(R3),0                                                          
         BE    OKDLXN                                                           
         CLC   FALEMPC,1(R3)                                                    
         BE    *+14                                                             
         IC    R0,0(R3)                                                         
         AR    R3,R0                                                            
         B     OKDL022                                                          
*                                                                               
         LA    R4,3(R3)                                                         
OKDL025  DS    0H                                                               
         OC    0(L'FALDMPC,R4),0(R4)                                            
         BZ    OKDLXN                                                           
         CLC   0(L'FALDMPC,R4),FALDMPC                                          
         BE    *+12                                                             
         LA    R4,2(R4)                                                         
         B     OKDL025                                                          
                                                                                
*                                                                               
         DS    0H                                                               
         B     OKDLXY                                                           
                                                                                
*                                                                               
OKDLXN   DS    0H                                                               
         J     NO                                                               
OKDLXY   DS    0H                                                               
         J     YES                                                              
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--D32+        
               DL#)'                                                            
*-------------------- DEMLINE PROCESSING FOR DEM32 -------------------*         
                                                                                
* At entry,                                                                     
*   R5-->TSAR demo record                                                       
                                                                                
D32DEMLN DS    0H                                                               
         USING TSDEMRCD,R5                                                      
                                                                                
*                                                                               
         DS    0H                                                               
         MVI   PUFLLOO,0           INITIALIZE "LAST LEFT OFF" FLAGS             
         MVI   PUFLLOO3,0                                                       
                                                                                
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         TM    AS2RSMF,AS2RFFLK    IF FALINK RESUME,                            
         BZ    D32DL019                                                         
***      CLI   FERN,155                    "PARSE OUT REQUEST MSG"              
***      JE    XITMODL                                                          
         MVI   PUFLLOO,C'N'         NEED TO RE-ESTABLISH MAP CODES              
         CLI   AS2DEMON,0           IF BREAK OCCURRED ADDING DEMO,              
         BE    *+8                                                              
         MVI   PUFLLOO3,C'N'         NEED TO RE-ESTABLISH NTH DEMO              
D32DL019 EQU   *                                                                
         DROP  RF                                                               
                                                                                
         DS    0H                  GO TO LOGIC CORRESPONDING TO RCD TYP         
         MVC   TMPRCTYP,TDRRCTYP                                                
         CLI   TDRRCTYP,TDRRTDMV                                                
         BE    D32DL100                                                         
         CLI   TDRRCTYP,TDRRTDML    DEMO LIST                                   
         BE    D32DL200                                                         
         CLI   TDRRCTYP,TDRRTDTI    DAY/TIME INDICES                            
         BE    D32DL300                                                         
         B     D32DLX                                                           
         EJECT                                                                  
D32DL100 DS    0H                  RECORD CONTAINS PROGRAM & DEMO INFO          
         MVI   GOSUBN,D32TP#                                                    
         CLC   DBFIL,=C'CTP'                                                    
         BE    D32DL115X                                                        
         CLC   DBFIL,=C'TP '                                                    
         BE    D32DL115X                                                        
         CLC   DBFIL,=C'RTP'                                                    
         BE    D32DL115X                                                        
         CLC   DBFIL,=C'RDP'                                                    
         BE    D32DL115X                                                        
         MVI   GOSUBN,D32PV#                                                    
         CLC   DBFIL,=C'PAV'                                                    
         BE    D32DL115X                                                        
         DC    H'0'                                                             
D32DL115X EQU  *                                                                
         GOTO1 AGOSUB                                                           
         B     D32DLX                                                           
         EJECT                                                                  
D32DL200 DS    0H                  RECORD CONTAINS DEMO LIST                    
         L     RE,ASTDMEXP                                                      
         LA    RE,1(RE)            RE-->DESTINATION                             
         ZIC   RF,STNDEMS                                                       
         MH    RF,=Y(L'DEMS)                                                    
         LA    RF,1(RF)            RF = LENGTH TO MOVE (INCL DELIMITER)         
         LA    R0,TDRDEMS          R0-->SOURCE                                  
         LR    R1,RF                                                            
         MVCL  RE,R0               MOVE DEMO EXPRSNS INTO SAVE AREA             
                                                                                
*                                                                               
         DS    0H                                                               
* IMPRESSIONS BASED WAS FORCED                                                  
*&&DO                                                                           
         CLI   OPTDMA,C'I'                                                      
         BE    D32DL205                                                         
         TM    STFLAG1,SF1MDFRL    DEMO MODIFIERS RELEASED YET?                 
         BO    D32DL299             YEP, EXIT NOW                               
*&&                                                                             
D32DL205 DS    0H                                                               
         OI    STFLAG1,SF1MDFRL     ELSE, RELEASE THEM ONCE ONLY                
*                                                                               
         MVC   FALEMPC,=Y(FMHDMLS)                                              
         MVC   FALDMPC,=Y(FMDDMLSFDNM)                                          
*** NEW CODE TO FIX BUG                                                         
*** WE NEED TO REESTABLISH THE DEMOS MAPCODES BECAUSE OF 2 DECIMAL              
*** PASSES MULTIPLE DEMOS RECORDS                                               
         CLI   PUFLLOO,C'N'                                                     
         BNE   D32DL210                                                         
         BAS   RE,RESTELEM                                                      
D32DL210 DS    0H                                                               
         BAS   RE,D32DLOKD         OKAY TO RELEASE DEMO MODIFR                  
         BNE   D32DL299             NO, EXIT NOW                                
                                                                                
*                                                                               
         DS    0H                  GET DEMO NAMES                               
         LA    R4,DBLOCK1          BUILD DBLOCK FOR DEMOCON                     
         USING DBLOCKD,R4                                                       
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,DBFIL                                                     
         MVC   DBCOMFCS,AFAC                                                    
         MVC   DBSELMED,DBMED                                                   
         MVC   DBSELSRC,DBSRC                                                   
         MVC   DBSELAGY,AGYALPH                                                 
         L     R0,AIOAREA                                                       
         L     R3,ASTDMEXP                                                      
         LA    R3,1(R3)                                                         
                                                                                
         DS    0H                                                               
         CLC   DBFIL,=C'PAV'                                                    
         BNE   D32DL229                                                         
         LR    R1,R3                                                            
D32DL227 CLI   0(R1),XFF                                                        
         BE    D32DL229                                                         
         CLI   1(R1),C'T'                                                       
         BNE   *+8                                                              
         MVI   1(R1),C'I'                                                       
         LA    R1,L'DEMS(R1)                                                    
         B     D32DL227                                                         
D32DL229 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVI   BYTE,C'S'            ASSUME SPOTPAK VALIDATION                   
         CLC   DBFIL,=C'PAV'        (TYPE OF VALIDATION BASED ON FILE)          
         BNE   *+8                                                              
         MVI   BYTE,0                REMOVE SPOTPAK VALIDATION                  
         CLC   DBFIL,=C'CTP'                                                    
         BNE   *+10                                                             
         MVC   DBFILE(3),=C'CUN'                                                
         GOTO1 VDEMOCON,DMCB,(STNDEMS,(R3)),(6,(R0)),(BYTE,DBLOCKD),0           
         DROP  R4                                                               
                                                                                
                                                                                
         DS    0H                                                               
         MVC   FALEMPC,=Y(FMHDMLS)                                              
                                                                                
         CLI   PUFLLOO,C'N'        IS "P/U FROM LAST LEFT OFF" NOT OK?          
         BNE   D32DL232K                                                        
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         CLC   AS2EMPC,FALEMPC      TRY TO RESUME FROM LAST OFF?                
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
         B     D32DL232M                                                        
D32DL232K EQU  *                                                                
                                                                                
         SR    R1,R1                                                            
         CLI   DMLRLFLG,C'Y'                                                    
         BE    D32DLX                                                           
         GOTO1 ADM32SET            DO SETELEM FOR FALINK FIRST                  
D32DL232M EQU  *                                                                
                                                                                
*                                                                               
         DS    0H                  DOWNLOAD DEMO NAMES                          
         ZIC   R0,STNDEMS                                                       
         STH   R0,MYCNTR                                                        
         L     R6,AIOAREA          R4-->DEMO NAMES                              
*                                                                               
D32DL242 DS    0H                                                               
         MVC   FALDMPC,=Y(FMDDMLSFDNM)                                          
         LR    R0,R6               R0-->FORMATTED DEMO NAME                     
         LA    R1,6                                                             
         BAS   RE,D32DLAD                                                       
         MVI   DMLRLFLG,C'Y'                                                    
*                                                                               
         DS    0H                  DEMO PRECISION                               
         LA    R2,WORK              R2-->OUTPUT AREA FOR DEMO VALUE             
                                                                                
         ZIC   RF,STNDEMS                                                       
         SH    RF,MYCNTR                                                        
         LR    RE,RF                                                            
         MH    RF,=H'3'                                                         
         L     R3,ASTDMEXP                                                      
         LA    R3,1(RF,R3)          R3-->CURRENT DEMO EXPRESSION                
                                                                                
         SLL   RE,2                                                             
         LA    R4,TDRDEMS(RE)       R4-->DEMO VALUES                            
         MVC   SVTDRDEC,TDRDEC                                                  
                                                                                
         MVI   GOSUBN,GDM#          GET DEMO PRECISION                          
         GOTO1 AGOSUB                                                           
         MVC   FALDMPC,=Y(FMDDMLSPREC)                                          
         LA    R1,1                                                             
         MVC   BYTE,DEMOPRE                                                     
*                                                                               
         CLI   OPTDEC,C'2'                                                      
         JNE   D32DL243                                                         
         CLI   0(R6),C'P'          PUT?                                         
         JE    *+12                                                             
         CLI   0(R6),C'S'          SHARE?                                       
         JNE   D32DL243                                                         
         MVI   BYTE,1                                                           
*                                                                               
D32DL243 LA    R0,BYTE                                                          
         BAS   RE,D32DLAD                                                       
*                                                                               
         DS    0H                  CPP APPLICABILITY FLAG                       
         MVC   FALDMPC,=Y(FMDDMLSCPP)                                           
         BAS   RE,D32DLOKD          OKAY TO RELEASE CPP FLAG?                   
         BNE   D32DL248X             NOPE                                       
                                                                                
         ZIC   RF,STNDEMS                                                       
         SH    RF,MYCNTR                                                        
         MH    RF,=H'3'                                                         
         L     R3,ASTDMEXP                                                      
         LA    R3,1(RF,R3)          R3-->CURRENT DEMO EXPRESSION                
                                                                                
         MVI   WORK2,C'Y'           ASSUME CPP APPLIES                          
         CLI   1(R3),C'R'            IF MODIFIER IS RATINGS                     
         BE    D32DL248G                                                        
         CLI   1(R3),C'I'            IF MODIFIER IS TSA IMPRESSIONS             
         BE    D32DL248G                                                        
*****    CLI   1(R3),C'A'            IF MODIFIER IS DMA IMPRESSIONS             
         CLI   1(R3),C'D'    CHANGED TO MARKET IMPRESSIONS                      
         BE    D32DL248G                                                        
         CLI   DBSRC,C'A'                                                       
         BNE   *+12                                                             
         CLI   1(R3),C'E'                                                       
         BE    D32DL248G                                                        
*****                                                                           
         MVI   WORK2,C'N'           CPP DOES NOT APPLY                          
D32DL248G EQU  *                                                                
                                                                                
         LA    R0,WORK2                                                         
         LA    R1,1                                                             
         BAS   RE,D32DLAD                                                       
D32DL248X EQU  *                                                                
*                                                                               
         DS    0H                  CPP LABEL                                    
         MVC   FALDMPC,=Y(FMDDMLSCPLB)                                          
         BAS   RE,D32DLOKD          OKAY TO RELEASE CPP LABEL?                  
         BNE   D32DL249X             NOPE                                       
                                                                                
         ZIC   RF,STNDEMS                                                       
         SH    RF,MYCNTR                                                        
         MH    RF,=H'3'                                                         
         L     R3,ASTDMEXP                                                      
         LA    R3,1(RF,R3)          R3-->CURRENT DEMO EXPRESSION                
                                                                                
         MVC   WORK2(3),=C'CPP'     ASSUME CPP APPLIES                          
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    *+10                                                             
         MVC   WORK2(5),=C'CPP/M'     ASSUME CPP APPLIES                        
         CLI   1(R3),C'R'            IF MODIFIER IS RATINGS                     
         BE    D32DL249G                                                        
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BNL   *+10                                                             
         MVC   WORK2(4),=C'CPM'     ASSUME CPM APPLIES                          
         CLI   1(R3),C'I'            IF MODIFIER IS TSA IMPRESSIONS             
         BE    D32DL249G                                                        
******   CLI   1(R3),C'A'            IF MODIFIER IS DMA IMPRESSIONS             
         CLI   1(R3),C'D'            CHANGED TO MARKET IMPRESSIONS              
         BE    D32DL249G                                                        
         CLI   DBSRC,C'A'                                                       
         BNE   *+12                                                             
         CLI   1(R3),C'E'            EXTENDED (BBM)                             
         BE    D32DL249G                                                        
         B     D32DL249X            CPP LABEL DOES NOT APPLY                    
D32DL249G EQU  *                                                                
                                                                                
         LA    R0,WORK2                                                         
         LA    R1,3                                                             
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    *+8                                                              
         LA    R1,5                                                             
         BAS   RE,D32DLAD                                                       
D32DL249X EQU  *                                                                
*                                                                               
         LA    R6,6(R6)                                                         
                                                                                
         LH    R1,MYCNTR                                                        
         AHI   R1,-1                                                            
         STH   R1,MYCNTR                                                        
         BP    D32DL242                                                         
                                                                                
*                                                                               
         DS    0H                                                               
         CLC   DBFIL,=C'PAV'       IF PAV FILE,                                 
         BNE   *+8                                                              
         MVI   APMODE,SAMEREC       GET SAME REC TO RSTORE FUDGED DMLST         
         B     D32DL299                                                         
D32DL299 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         B     D32DLX                                                           
         EJECT                                                                  
D32DL300 DS    0H                  RECORD CONTAINS DAY/TIME INDICES             
         MVC   FALEMPC,=Y(FMHDTIX)                                              
                                                                                
         CLI   PUFLLOO,C'N'        IS "P/U FROM LAST LEFT OFF" NOT OK?          
         BNE   D32DL332K                                                        
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         CLC   AS2EMPC,FALEMPC      TRY TO RESUME FROM LAST OFF?                
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
         B     D32DL332M                                                        
D32DL332K EQU  *                                                                
                                                                                
         SR    R1,R1                                                            
         GOTO1 ADM32SET             DO SETELEM FOR FALINK FIRST                 
D32DL332M EQU  *                                                                
                                                                                
*                                                                               
         DS    0H                   DAY/TIME NUMBER                             
         MVC   FALDMPC,=Y(FMDDTIXDTN)                                           
         BAS   RE,D32DLOKD                                                      
         BNE   D32DL329                                                         
*                                                                               
         ZICM  RF,TDRDAY,(1)                                                    
         BZ    D32DL329                                                         
         STC   RF,BYTE                                                          
*                                                                               
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32DLAD                                                       
D32DL329 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                   COMPONENT POSITION W/IN ROTATION            
         MVC   FALDMPC,=Y(FMDDTIXCMPN)                                          
         BAS   RE,D32DLOKD                                                      
         BNE   D32DL339                                                         
*                                                                               
         ZICM  RF,TDRDAYR,(1)                                                   
         BZ    D32DL339                                                         
         STC   RF,BYTE                                                          
*                                                                               
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32DLAD                                                       
D32DL339 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                   MAX D/T SUB-INDEX (MAYA NUMBER)             
         MVC   FALDMPC,=Y(FMDDTIXMXSI)                                          
         BAS   RE,D32DLOKD                                                      
         BNE   D32DL349                                                         
*                                                                               
*&&DO                                                                           
         MVC   BYTE,TDRMXSBI                                                    
*&&                                                                             
         MVC   HALF,TDRMXSBI                                                    
**       ZICM  RE,HALF,(3)                                                      
**       AHI   RE,4                                                             
**       LA    RE,1000                                                          
**       STCM  RE,3,HALF                                                        
*                                                                               
*&&DO                                                                           
         LA    R0,BYTE                                                          
*&&                                                                             
         LA    R0,HALF                                                          
         SR    R1,R1                                                            
         BAS   RE,D32DLAD                                                       
D32DL349 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         B     D32DLX                                                           
                                                                                
                                                                                
*                                                                               
D32DLX   DS    0H                                                               
         DS    0H                  ENSURE WE'VE P/UP FROM LAST LEFT OFF         
         L     R6,AAPSAV2                                                       
         USING APSAV2D,R6                                                       
         TM    AS2RSMF,AS2RFFLK                                                 
         BZ    D32DLPUX                                                         
         CLI   PUFLLOO,C'N'                                                     
         BNE   *+6                                                              
         DC    H'0'                                                             
* ERROR TELL THEM TO PARSE OUT THE DATA                                         
* SOMEHOW THE VOLUME OF DATA CAUSED FALINK ENCORE                               
***      BNE   *+16                                                             
***      MVI   FERN,155                    "PARSE OUT REQUEST MSG"              
***      MVI   APMODE,FORCEEND                                                  
***      J     XITMODL                                                          
*                                                                               
         NI    AS2RSMF,XFF-AS2RFFLK                                             
         DROP  R6                                                               
D32DLPUX EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         J     EXIT                                                             
         DROP  R5                                                               
                                                                                
                                                                                
D32DLOKD NTR1                                                                   
         MVI   GOSUBN,OKDL#                                                     
         GOTO1 AGOSUB                                                           
         J     EXIT                                                             
                                                                                
                                                                                
* Little helper routine to add data to FALINK buffer                            
* At entry,                                                                     
*   FALDMPC = map code of data to be added                                      
*   R0      = A(data to be added)                                               
                                                                                
D32DLAD  NTR1                                                                   
         ST    R0,ADLDATA          SET A(DATA TO DOWNLOAD)                      
         ST    R1,LDLDATA          SET L(DATA TO DOWNLOAD)                      
         MVI   ADMODE,ADMADD                                                    
         GOTO1 ADM32ADD                                                         
         JL    XITMODL                                                          
                                                                                
         TM    BRKFLAG1,BF1FALNK  DID FALINK CALL FOR A BREAK?                  
         BZ    D32DLADG            NOPE                                         
         J     XITMOD              EXIT DEM03 NOW                               
D32DLADG EQU   *                                                                
*                                                                               
         J     EXIT                                                             
                                                                                
*  ROUTINE TO RESET SAVED DATA MAPCODE                                          
                                                                                
RESTELEM NTR1                                                                   
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         MVC   FALDMPC,AS2DMPC                                                  
         DROP  RF                                                               
         J     EXIT                                                             
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--D32+        
               TP#)'                                                            
*--------------------- DEM32 DOWLOAD TIME PERIOD ---------------------*         
                                                                                
* At entry,                                                                     
*   R5-->TSAR demo record containing TP demo information                        
                                                                                
D32DLTP  DS    0H                                                               
         USING TSDEMRCD,R5                                                      
                                                                                
                                                                                
         DS    0H                  DO SETELEM FOR FALINK FIRST                  
         MVC   FALEMPC,=Y(FMHTPDP)                                              
                                                                                
         CLI   PUFLLOO,C'N'        IS "P/U FROM LAST LEFT OFF" NOT OK?          
         BNE   D32TP012K                                                        
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         CLC   AS2EMPC,FALEMPC      TRY TO RESUME FROM LAST OFF?                
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
         B     D32TP012M                                                        
D32TP012K EQU  *                                                                
                                                                                
         SR    R1,R1                                                            
         GOTO1 ADM32SET                                                         
D32TP012M EQU  *                                                                
                                                                                
                                                                                
         DS    0H                  "RECORD" TYPE                                
         MVC   FALDMPC,=Y(FMDTPDPRTYP)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP029                                                         
*                                                                               
         LA    R0,=AL1(FMDTPDPRTYP_DE)   ASSUME DETAIL LINE                     
         CLC   DBFIL,=C'CTP'                                                    
         BE    *+8                                                              
         CLI   TDRSQH,XFF                TEST IF SUMMARY LINE                   
         BNE   *+8                                                              
         LA    R0,=AL1(FMDTPDPRTYP_RO)    IF SO, INDICATE IT                    
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                ADD DATA TO DOWNLOAD                   
D32TP029 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  STATION NUMBER                               
         MVC   FALDMPC,=Y(FMDTPDPSTNN)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP034                                                         
*                                                                               
         ZICM  RF,TDRSTA,(1)              GET STATION NUMBER                    
         BZ    D32TP034                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP034 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  BOOK NUMBER                                  
         MVC   FALDMPC,=Y(FMDTPDPBKN)                                           
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP039                                                         
*                                                                               
         ZICM  RF,TDRBK,(1)                GET BOOK NUMBER                      
         BZ    D32TP039                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP039 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DAY/TIME NUMBER                              
         MVC   FALDMPC,=Y(FMDTPDPDTN)                                           
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP043                                                         
*                                                                               
         ZICM  RF,TDRDAY,(1)               GET DAY/TIME NUMBER                  
         BZ    D32TP043                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP043 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  COMPONENT POSITION W/IN ROTATION             
         MVC   FALDMPC,=Y(FMDTPDPCMPN)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP046                                                         
*                                                                               
         SR    RF,RF                                                            
         CLI   TDRDAYR,XFF                                                      
         BE    *+8                                                              
         IC    RF,TDRDAYR                                                       
         STC   RF,BYTE                                                          
         MVI   COMFLAG,C'N'                                                     
         CLC   BYTE,SVCOMNUM                                                    
         BNE   *+8                                                              
         MVI   COMFLAG,C'Y'                                                     
         MVC   SVCOMNUM,BYTE        SAVE COMPONENT NUMBER                       
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP046 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  D/T SUB-INDEX (MAYA NUMBER)                  
         MVC   FALDMPC,=Y(FMDTPDPDTSI)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP049X                                                        
                                                                                
         SR    R1,R1                                                            
*                                                                               
         CLI   TDRSQH,XFF           TEST IF SUMMARY LINE                        
         BE    D32TP049G             IF SO, SET D/T SUB-INDEX = 0               
*&&DO                                                                           
         IC    R1,TDRDTSBI                                                      
*&&                                                                             
         ICM   R1,3,TDRDTSBI                                                    
         CLI   COMFLAG,C'Y'                                                     
         BNE   D32TP049G                                                        
         CLC   SVMAYA,TDRDTSBI                                                  
         BL    D32TP049G                                                        
         ICM   RE,3,SVMAYA                                                      
         AHI   RE,1                                                             
         LR    R1,RE                                                            
         STCM  R1,3,SVMAYA                                                      
         B     D32TP049H                                                        
D32TP049G EQU  *                                                                
         MVC   SVMAYA,TDRDTSBI      SAVE MOST RECENT MAYA NUMBER                
D32TP049H EQU  *                                                                
                                                                                
                                                                                
*&&DO                                                                           
         STC   R1,BYTE                                                          
         LA    R0,BYTE                                                          
*&&                                                                             
         STCM  R1,3,HALF                                                        
         LA    R0,HALF                                                          
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP049X EQU  *                                                                
                                                                                
                                                                                
         DS    0H                  STATION                                      
         MVC   FALDMPC,=Y(FMDTPDPSTTN)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP059                                                         
*                                                                               
         MVC   MYSTAS,STAS                                                      
         MVC   ALPHAMKT,ALFMKTS                                                 
         MVI   GOSUBN,TSTA#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32TPAD                                                       
D32TP059 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  BOOK                                         
         MVC   FALDMPC,=Y(FMDTPDPBOOK)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP069                                                         
*                                                                               
         LA    RF,DBSTABK                                                       
         USING STABKD,RF                                                        
         MVC   DUB(L'STABKS),STABKS    GET BOOK/WEEK#/BOOKTYPE                  
         DROP  RF                                                               
                                                                                
         MVI   GOSUBN,TBK#             TRANSLATE BOOK                           
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32TPAD                                                       
D32TP069 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DAY/START TIME/END TIME                      
         MVC   TMPKSE,TDRKDAY                                                   
         ZIC   R0,TDRQHAF           GET QH ADJ FCTR FROM RECD,                  
         SHI   R0,(100+100)          CONVERT FROM 100-BASED,                    
         LCR   R0,R0                 AND COMPLEMENT ADJ FCTR                    
         STC   R0,THISQHAF           TO GET REAL QHs POST-SORT                  
         MVI   GOSUBN,ADJQH#                                                    
         GOTO1 AGOSUB                                                           
         MVI   THISNDYS,0                                                       
         MVI   GOSUBN,GDY#          GET DAY AND TIMES                           
         GOTO1 AGOSUB                                                           
* COUNTY COVERAGE - WE NEED OT PASS DOWN TEXT DAY TO THEM                       
* TO SUPPORT OUR FUNNY DAYS                                                     
*                                                                               
         CLI   DBMED,C'U'                                                       
         BNE   D32TP071                                                         
         MVC   FALDMPC,=Y(FMDTPDPTDAY)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP073                                                         
         CLI   TEMPIDAY,X'7D'                                                   
         BNE   *+14                                                             
         MVC   WORK(4),=C'M-SU'                                                 
         LHI   R1,4                                                             
                                                                                
         CLI   TEMPIDAY,X'7E'                                                   
         BNE   D32TP071                                                         
         MVC   WORK(5),=C'SU-SA'                                                
         LHI   R1,5                                                             
                                                                                
                                                                                
         LA    R0,WORK                                                          
         BAS   RE,D32TPAD                                                       
         B     D32TP073                                                         
***********                                                                     
D32TP071 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDTPDPIDAY)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP073                                                         
                                                                                
         LA    R0,TEMPIDAY                                                      
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP073 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDTPDPSTIM)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP076                                                         
                                                                                
         LA    R0,TEMPSTIM                                                      
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP076 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDTPDPETIM)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP079                                                         
                                                                                
         LA    R0,TEMPETIM                                                      
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32TP079 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  PROGRAM NAME                                 
         MVC   FALDMPC,=Y(FMDTPDPPNAM)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP089                                                         
*                                                                               
         MVC   WORK,SPACES                                                      
         MVC   WORK(16),TDRPROG                                                 
         OC    WORK(16),=16X'40'    PAD THE PROGRAM NAME W SPACES               
         LA    RE,WORK              CAUSE FALINK EXPECT ONLY CHARS              
         LA    RF,15(RE)            FOR PROG NAME                               
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         SR    RF,RE                                                            
         LA    RF,1(RF)                                                         
         STH   RF,HALF                                                          
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32TPAD                                                       
D32TP089 EQU   *                                                                
* SEND DOWN AFFILIATION AND MARKET NAME                                         
         MVC   FALDMPC,=Y(FMDTPDPAFFL)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP080                                                         
         MVC   WORK(16),TDRAFFL                                                 
         LA    R0,WORK                                                          
**       LH    R1,HALF                                                          
         LA    R1,3                                                             
         BAS   RE,D32TPAD                                                       
D32TP080 EQU   *                                                                
****                                                                            
         MVI   GOSUBN,IDB#                                                      
         GOTO1 AGOSUB                                                           
         LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
         MVI   DBFUNCT,DBGETMK     GET MARKET INFORMATION                       
         MVC   DBSELRMK,THISMNUM                                                
         XC    THISMKNM,THISMKNM                                                
         CLC   =C'N/A',THISMNUM                                                 
         BNE   *+14                                                             
         MVC   THISMKNM(3),=C'N/A'                                              
         B     D32TP081                                                         
         GOTO1 ASETUSID                                                         
         GOTO1 VDEMAND,DMCB,DBLOCKD,DEMHOOK5,0,0                                
         DROP  R6                                                               
****                                                                            
D32TP081 EQU   *                                                                
         MVC   FALDMPC,=Y(FMDTPDPMNAM)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP082                                                         
         MVC   WORK(L'THISMKNM),THISMKNM                                        
         LA    R0,WORK                                                          
**       LH    R1,HALF                LEN OF FIELD                              
         LA    R1,L'THISMKNM                                                    
         BAS   RE,D32TPAD                                                       
D32TP082 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  PROGRAM TYPE                                 
         MVC   FALDMPC,=Y(FMDTPDPPTYP)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TPPTYPX                                                       
*                                                                               
         MVC   WORK(L'TDRPTYP),TDRPTYP                                          
         CLC   TDRPTYP,SPACES                                                   
         BNE   *+14                                                             
         MVI   WORK,C'*'                                                        
         MVC   WORK+1(L'TDRPTYP-1),WORK                                         
*                                                                               
         LA    R0,WORK                                                          
         LA    R1,L'TDRPTYP                                                     
         BAS   RE,D32TPAD                                                       
D32TPPTYPX EQU *                                                                
                                                                                
                                                                                
         DS    0H                  DEMO VALUES                                  
         MVI   PRECFLAG,C'Y'       SET DEMO PREC FLAG TO YES                    
         MVI   DEMOPRE,0           SET DEFAULT PREC TO ZERO PLACES              
         MVC   FALDMPC,=Y(FMDTPDPDMVL)                                          
         BAS   RE,D32TPOKD                                                      
         BNE   D32TP099                                                         
*                                                                               
         SR    R6,R6                                                            
         ICM   R6,1,STNDEMS         R6 = # OF DEMOS (ACTUALLY) RQUESTED         
         BZ    D32TP099                                                         
                                                                                
         LA    R2,WORK              R2-->OUTPUT AREA FOR DEMO VALUE             
         L     R3,ASTDMEXP                                                      
         LA    R3,1(R3)             R3-->DEMO EXPRESSIONS                       
         LA    R4,TDRDEMS           R4-->DEMO VALUES                            
*                                                                               
D32TP083 DS    0H                                                               
         CLI   PUFLLOO3,C'N'        RE-ESTABLISHED NTH DEMO YET?                
         BNE   D32TP083G             EITHER YES OR N/A                          
         L     RF,AAPSAV2                                                       
         CLM   R6,1,(AS2DEMON-APSAV2D)(RF)                                      
         BNE   D32TP095                                                         
         MVI   PUFLLOO3,C'Y'        RE-ESTABLISHED NTH DEMO,                    
         B     D32TP095              BUT DON'T ADD TO FALINK AGAIN              
D32TP083G EQU  *                                                                
*                                                                               
         MVC   WORK,SPACES          INITIALIZE OUTPUT AREA                      
         OC    0(L'TDRDEMS,R4),0(R4)   IF DEMO VALUE IS ZERO,                   
         BNZ   D32TP085                                                         
         CLC   BKS(2),INVBOOK           AND IT'S AN INVALID BOOK,               
         BNE   D32TP085                                                         
         LA    R1,1                     JUST PASS BACK DUMMY HEADER             
         B     D32TP088                                                         
                                                                                
D32TP085 DS    0H                                                               
         MVI   GOSUBN,GDM#          FORMAT DEMO VALUE                           
         GOTO1 AGOSUB                                                           
*                                                                               
D32TP088 DS    0H                   R1 = L(FORMATTED DEMO VALUE)                
*                                                                               
D32TP090 DS    0H                                                               
         LA    RF,DBSTABK           CHECK TO SEE IF VALID BOOK                  
         USING STABKD,RF                                                        
         MVC   DUB(L'STABKS),STABKS                                             
         DROP  RF                                                               
         MVC   FALDMPC,=Y(FMDTPDPDMVL)                                          
         CLC   DUB(2),INVBOOK                                                   
         BNE   *+10                                                             
         MVC   FALDMPC,=Y(FMDTPDPDUMV)                                          
         L     R1,FULL              PICK UP L(FORMATTED DEMO VALUE)             
         LA    R0,WORK              POINT IT TO DEMO VALUE FROM GETDEM          
         BAS   RE,D32TPAD                                                       
*                                                                               
D32TP095 LA    R3,L'DEMS(R3)                                                    
         LA    R4,L'TDRDEMS(R4)                                                 
         BCT   R6,D32TP083                                                      
D32TP099 EQU   *                                                                
                                                                                
                                                                                
*                                                                               
D32TPX   DS    0H                                                               
         J     EXIT                                                             
         DROP  R5                                                               
                                                                                
DEMHOOK5 DS    0H                                                               
HK5      NTR1                                                                   
         USING DBLOCKD,R6                                                       
*                                                                               
         CLI   DBRECTYP,DBRECMK    MAKE SURE WE HAVE CORRECT RECD TYPE          
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
         DS    0H                  EXTRACT MARKET INFORMATION                   
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'MNA',DBLOCKD,WORK,0,0,0                        
         MVC   THISMKNM,WORK+2      MARKET NAME                                 
*                                                                               
DMHK5X   DS    0H                  RETURN TO DEMAND                             
         J     EXIT                                                             
         DROP  R6                                                               
                                                                                
                                                                                
* Little helper routine to see if data can be downloaded                        
* At entry,                                                                     
*   FALDMPC = map code of data to check                                         
                                                                                
D32TPOKD NTR1                                                                   
         MVI   GOSUBN,OKDL#                                                     
         GOTO1 AGOSUB                                                           
         J     EXIT                                                             
                                                                                
                                                                                
* Little helper routine to add data to FALINK buffer                            
* At entry,                                                                     
*   FALDMPC = map code of data to be added                                      
*   R0      = A(data to be added)                                               
                                                                                
D32TPAD  NTR1                                                                   
         ST    R0,ADLDATA          SET A(DATA TO DOWNLOAD)                      
         ST    R1,LDLDATA          SET L(DATA TO DOWNLOAD)                      
         MVI   ADMODE,ADMADD                                                    
         GOTO1 ADM32ADD                                                         
         JL    XITMODL                                                          
                                                                                
         TM    BRKFLAG1,BF1FALNK  DID FALINK CALL FOR A BREAK?                  
         BZ    D32TPADG            NOPE                                         
         L     RF,AAPSAV2          YES, NEED TO SAVE LOCAL VARIABLES            
         USING APSAV2D,RF                                                       
         CLC   FALDMPC,=Y(FMDTPDPDMVL)  IF ADDING DEMO DATA,                    
         BNE   *+8                                                              
         STCM  R6,1,AS2DEMON             SAVE NTH DEMO TO ADDDATA CALL          
         DROP  RF                                                               
         J     XITMOD              EXIT DEM03 NOW                               
D32TPADG EQU   *                                                                
*                                                                               
         J     EXIT                                                             
*&&DO                                                                           
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--D32+        
               PV#)'                                                            
*--------------------- DEM32 DOWLOAD PROGRAM AVG ---------------------*         
                                                                                
* At entry,                                                                     
*   R5-->TSAR demo record containing TP demo information                        
                                                                                
D32DLPAV DS    0H                                                               
         USING TSDEMRCD,R5                                                      
                                                                                
         LA    RF,DBSTABK             CHECK TO SEE IF VALID BOOK                
         USING STABKD,RF              IF NO VALID DONT DWNLOAD                  
         MVC   DUB(L'STABKS),STABKS   ANY DATA                                  
         DROP  RF                                                               
         CLC   DUB(2),INVBOOK                                                   
         BE    D32PVX                                                           
                                                                                
         DS    0H                  DO SETELEM FOR FALINK FIRST                  
         MVC   FALEMPC,=Y(FMHPVDP)                                              
                                                                                
         CLI   PUFLLOO,C'N'        IS "P/U FROM LAST LEFT OFF" NOT OK?          
         BNE   D32PV012K                                                        
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         CLC   AS2EMPC,FALEMPC      TRY TO RESUME FROM LAST OFF?                
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
         B     D32PV012M                                                        
D32PV012K EQU  *                                                                
                                                                                
         SR    R1,R1                                                            
         GOTO1 ADM32SET                                                         
D32PV012M EQU  *                                                                
                                                                                
                                                                                
         DS    0H                  "RECORD" TYPE                                
         MVC   FALDMPC,=Y(FMDPVDPRTYP)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV029                                                         
*                                                                               
         LA    R0,=AL1(FMDPVDPRTYP_DE)   ASSUME DETAIL LINE                     
         CLI   TDRK2SQH,XFF              TEST IF SUMMARY LINE                   
         BNE   *+8                                                              
         LA    R0,=AL1(FMDPVDPRTYP_RO)    IF SO, INDICATE IT                    
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                ADD DATA TO DOWNLOAD                   
D32PV029 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  STATION NUMBER                               
         MVC   FALDMPC,=Y(FMDPVDPSTNN)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV034                                                         
*                                                                               
         ZICM  RF,TDRSTA,(1)               GET STATION NUMBER                   
         BZ    D32PV034                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV034 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  BOOK NUMBER                                  
         MVC   FALDMPC,=Y(FMDPVDPBKN)                                           
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV039                                                         
*                                                                               
         ZICM  RF,TDRBK,(1)                GET BOOK NUMBER                      
         BZ    D32PV039                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV039 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DAY/TIME NUMBER                              
         MVC   FALDMPC,=Y(FMDPVDPDTN)                                           
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV043                                                         
*                                                                               
         ZICM  RF,TDRDAY,(1)               GET DAY/TIME NUMBER                  
         BZ    D32PV043                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV043 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  COMPONENT POSITION W/IN ROTATION             
         MVC   FALDMPC,=Y(FMDPVDPCMPN)                                          
         BAS   RE,D32PVOKD                                                      
**       BAS   RE,D32TPOKD                                                      
         BNE   D32PV046                                                         
*                                                                               
         SR    RF,RF                                                            
         CLI   TDRDAYR,XFF                                                      
         BE    *+8                                                              
         IC    RF,TDRDAYR                                                       
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32TPAD                                                       
D32PV046 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  STATION                                      
         MVC   FALDMPC,=Y(FMDPVDPSTTN)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV059                                                         
*                                                                               
         MVC   MYSTAS,STAS                                                      
         MVC   ALPHAMKT,ALFMKTS                                                 
         MVI   GOSUBN,TSTA#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV059 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  BOOK                                         
         MVC   FALDMPC,=Y(FMDPVDPBOOK)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV069                                                         
*                                                                               
         LA    RF,DBSTABK                                                       
         USING STABKD,RF                                                        
         MVC   DUB(L'STABKS),STABKS    GET BOOK/WEEK#/BOOKTYPE                  
         DROP  RF                                                               
                                                                                
         MVI   GOSUBN,TBK#             TRANSLATE BOOK                           
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV069 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DAY/START TIME/END TIME                      
         MVC   TMPKSE,TDRK2KDY                                                  
         MVC   THISNDYS,TDRNDAYS                                                
         MVI   GOSUBN,GDY#          GET DAY AND TIMES                           
         GOTO1 AGOSUB                                                           
*                                                                               
         DS    0H                                                               
         TM    TEMPIDAY,X'90'      LOOK FOR SPECIAL INTERNAL DAY CODE           
         BNO   D32PV072X                                                        
         MVC   FALDMPC,=Y(FMDPVDPTDAY)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV072X                                                        
         MVC   WORK+0(2),=C'AV'                                                 
         MVC   WORK+2(1),TEMPIDAY                                               
         OI    WORK+2,X'F0'                                                     
                                                                                
         LA    R0,WORK                                                          
         LHI   R1,3                                                             
         BAS   RE,D32PVAD                                                       
         B     D32PV073                                                         
D32PV072X EQU  *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDPVDPIDAY)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV073                                                         
                                                                                
         LA    R0,TEMPIDAY                                                      
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV073 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDPVDPSTIM)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV076                                                         
                                                                                
         LA    R0,TEMPSTIM                                                      
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV076 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDPVDPETIM)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV079                                                         
                                                                                
         LA    R0,TEMPETIM                                                      
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV079 EQU   *                                                                
         DS    0H                  TOTAL PROGRAM DUARATION                      
         MVC   FALDMPC,=Y(FMDPVDPGDUR)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV080                                                         
*                                                                               
         MVC   WORK(L'TDRPDUR),TDRPDUR                                          
         LA    R0,WORK                                                          
         LA    R1,L'TDRPDUR                                                     
         BAS   RE,D32PVAD                                                       
D32PV080 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  ACTIVE WEEKS                                 
         CLI   DBMED,C'O'                                                       
         BE    D32PV084                                                         
         MVC   FALDMPC,=Y(FMDPVDPWKS)                                           
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV084                                                         
*                                                                               
         MVC   TMPWKS,TDRWKS                                                    
         MVI   GOSUBN,TWK#                                                      
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV084 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  PROGRAM NAME                                 
         MVC   FALDMPC,=Y(FMDPVDPPNAM)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV089                                                         
*                                                                               
         MVC   WORK,SPACES                                                      
         MVC   WORK(16),TDRPROG                                                 
         LA    RE,WORK                                                          
         LA    RF,15(RE)                                                        
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         SR    RF,RE                                                            
         LA    RF,1(RF)                                                         
         STH   RF,HALF                                                          
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV089 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DEMO VALUES                                  
         MVC   FALDMPC,=Y(FMDPVDPDMVL)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV099                                                         
*                                                                               
         SR    R6,R6                                                            
         ICM   R6,1,STNDEMS         R6 = # OF DEMOS (ACTUALLY) RQUESTED         
         BZ    D32PV099                                                         
                                                                                
         LA    R2,WORK              R2-->OUTPUT AREA FOR DEMO VALUE             
         L     R3,ASTDMEXP                                                      
         LA    R3,1(R3)             R3-->DEMO EXPRESSIONS                       
         LA    R4,TDRDEMS           R4-->DEMO VALUES                            
         MVI   PRECFLAG,C'Y'       SET DEMO PREC FLAG TO YES                    
         MVI   DEMOPRE,0           SET DEFAULT PREC TO ZERO PLACES              
*                                                                               
D32PV083 DS    0H                                                               
         CLI   PUFLLOO3,C'N'        RE-ESTABLISHED NTH DEMO YET?                
         BNE   D32PV083G             EITHER YES OR N/A                          
         L     RF,AAPSAV2                                                       
         CLM   R6,1,(AS2DEMON-APSAV2D)(RF)                                      
         BNE   D32PV095                                                         
         MVI   PUFLLOO3,C'Y'        RE-ESTABLISHED NTH DEMO,                    
         B     D32PV095              BUT DON'T ADD TO FALINK AGAIN              
D32PV083G EQU  *                                                                
*                                                                               
         MVC   WORK,SPACES          INITIALIZE OUTPUT AREA                      
                                                                                
         OC    0(L'TDRDEMS,R4),0(R4)   IF DEMO VALUE IS ZERO,                   
         BNZ   D32PV085                                                         
         CLC   BKS(2),INVBOOK           AND IT'S AN INVALID BOOK,               
         BNE   D32PV085                                                         
         LA    R1,1                     JUST PASS BACK A BLANK                  
         B     D32PV088                                                         
                                                                                
D32PV085 DS    0H                                                               
         MVI   GOSUBN,GDM#         FORMAT DEMO VALUE                            
         GOTO1 AGOSUB                                                           
         B     D32PV088                                                         
*                                                                               
D32PV088 DS    0H                   R1 = L(FORMATTED DEMO VALUE)                
*                                                                               
D32PV090 MVC   FALDMPC,=Y(FMDPVDPDMVL)                                          
         L     R1,FULL              PICK UP L(FORMATTED DEMO VALUE)             
         LA    R0,WORK                                                          
         BAS   RE,D32PVAD                                                       
*                                                                               
D32PV095 LA    R3,L'DEMS(R3)                                                    
         LA    R4,L'TDRDEMS(R4)                                                 
         BCT   R6,D32PV083                                                      
D32PV099 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  PURE NUMBER                                  
         MVC   FALDMPC,=Y(FMDPVDPPURE)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV104                                                         
*                                                                               
         CLC   TDRPURE,=X'FFFF'                                                 
         BE    D32PV104                                                         
                                                                                
         MVC   TMPPURE,TDRPURE                                                  
         MVI   GOSUBN,TPUR#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
*                                                                               
D32PV104 EQU   *                                                                
                                                                                
                                                                                
*                                                                               
D32PVX   DS    0H                                                               
         J     EXIT                                                             
         DROP  R5                                                               
                                                                                
* Little helper routine to see if data can be downloaded                        
* At entry,                                                                     
*   FALDMPC = map code of data to check                                         
                                                                                
D32PVOKD NTR1                                                                   
         MVI   GOSUBN,OKDL#                                                     
         GOTO1 AGOSUB                                                           
         J     EXIT                                                             
                                                                                
                                                                                
* Little helper routine to add data to FALINK buffer                            
* At entry,                                                                     
*   FALDMPC = map code of data to be added                                      
*   R0      = A(data to be added)                                               
                                                                                
D32PVAD  NTR1                                                                   
         ST    R0,ADLDATA          SET A(DATA TO DOWNLOAD)                      
         ST    R1,LDLDATA          SET L(DATA TO DOWNLOAD)                      
         MVI   ADMODE,ADMADD                                                    
         GOTO1 ADM32ADD                                                         
         JL    XITMODL                                                          
                                                                                
         TM    BRKFLAG1,BF1FALNK  DID FALINK CALL FOR A BREAK?                  
         BZ    D32PVADG            NOPE                                         
         L     RF,AAPSAV2          YES, NEED TO SAVE LOCAL VARIABLES            
         USING APSAV2D,RF                                                       
         CLC   FALDMPC,=Y(FMDPVDPDMVL)  IF ADDING DEMO DATA,                    
         BNE   *+8                                                              
         STCM  R6,1,AS2DEMON             SAVE NTH DEMO TO ADDDATA CALL          
         DROP  RF                                                               
         J     XITMOD              EXIT DEM03 NOW                               
D32PVADG EQU   *                                                                
*                                                                               
         J     EXIT                                                             
*&&                                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--MIS+        
               C STUFF)'                                                        
*--------------------- SUBR02 MISCELLANEOUS STUFF --------------------*         
                                                                                
         GETEL2 R3,MYDATDSP,MYELCODE                                            
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--LTO+        
               R && CONSTANTS)'                                                 
*------------------------- LTORG & CONSTANTS -------------------------*         
         LTORG                                                                  
                                                                                
                                                                                
SUBR02L  EQU   *-SUBR02                                                         
         DS    0CL(4096-SUBR02L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
***********************************************************************         
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03)'            
***********************************************************************         
*======================= SUBROUTINE POOL THREE =======================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR03Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR03Q                                                    
SUBR03   NMOD1 0,1B0203**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R02#)         SUBTRACT FOR SUB-RTN #2                      
         SLL   R1,2                                                             
         B     R03_00(R1)                                                       
                                                                                
*TBK#     EQU   (R03_01-R03_00)/4+R02#   TRANSLATE BOOK                         
TWK#     EQU   (R03_02-R03_00)/4+R02#   TRANSLATE WEEKS                         
TPUR#    EQU   (R03_03-R03_00)/4+R02#   TRANSLATE PURE NUMBER                   
***GDM#     EQU   (R03_04-R03_00)/4+R02#   GET DEMOS                            
CDBK#    EQU   (R03_05-R03_00)/4+R02#   CLEAR DBLOCK                            
XDV#     EQU   (R03_06-R03_00)/4+R02#   EXTRACT DEMO VALUES                     
PVHK#    EQU   (R03_07-R03_00)/4+R02#   PAV DEMAND HOOK                         
DIVSHR#  EQU   (R03_08-R03_00)/4+R02#   DIVIDE SHARES                           
*&&DO                                                                           
BDB#     EQU   (R03_09-R03_00)/4+R02#   BUILD DBLOCK                            
*&&                                                                             
*&&DO                                                                           
SBT#     EQU   (R03_10-R03_00)/4+R02#   SUBTRACT TIMES                          
*&&                                                                             
                                                                                
R03_00   DS    0H                                                               
*R03_01   B     TRSLTBK             TRANSLATE BOOK                              
R03_02   B     TRSLTWKS            TRANSLATE WEEKS                              
R03_03   B     TRSLTPUR            TRANSLATE PURE NUMBER                        
****R03_04   B     GETDEM              GET DEMOS                                
R03_05   B     CLRDBLK             CLEAR DBLOCK                                 
R03_06   B     XTRCTDMV            EXTRACT DEMO VALUES                          
R03_07   B     PAVHOOK             PAV DEMAND HOOK                              
R03_08   B     DIVSHR              DIVIDE SHARES                                
*&&DO                                                                           
R03_09   B     BLDBLOCK            BUILD DBLOCK                                 
*&&                                                                             
*&&DO                                                                           
R03_10   B     SBTRCTIM            SUBTRACT TIMES                               
*&&                                                                             
R03#     EQU   (*-R03_00)/4+R02#                                                
         DC    H'0'                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--TBK+        
               #)'                                                              
*&&DO                                                                           
*--------------------------- TRANSLATE BOOK --------------------------*         
                                                                                
* Translates book into a printable format                                       
* At entry,                                                                     
*   DUB+0(4) = book/week#/booktype                                              
* At exit,                                                                      
*   WORK     = formatted book                                                   
*   HALF     = length of formatted book                                         
                                                                                
TRSLTBK  DS    0H                                                               
         MVC   WORK,SPACES                                                      
         LA    R4,WORK                                                          
                                                                                
*                                                                               
         DS    0H                  FORMAT BOOK                                  
         CLC   DUB(2),INVBOOK       CHECK VALIDITY OF BOOK                      
         BE    TBK020                                                           
         CLC   DUB(2),ESTBOOK       CHECK IF ESTIMATE BOOK                      
         BE    TBK030                                                           
         CLC   DUB(2),MBKBOOK       CHECK IF MULTBOOK BOOK                      
         BE    TBK030                                                           
         B     TBK050                                                           
                                                                                
TBK020   DS    0H                  INVALID BOOK                                 
         MVC   DUB(L'BKS),BKS       STILL NEED TO OUTPUT ACT BK INPTTED         
         B     TBK050                                                           
                                                                                
*                                                                               
TBK030   DS    0H                  ESTIMATE BOOK                                
         TM    DEMFLAG1,DF1STERO                                                
         BZ    TBK039                                                           
*                                                                               
         DS    0H                   GET ACTUAL DATA OF NTH BOOK INPUT           
         LA    R1,TSARBLCK                                                      
         SR    R5,R5                                                            
         ICM   R5,7,((TSAREC+1)-TSARD)(R1)                                      
         LA    R5,2(R5)                                                         
         USING TSDEMRCD,R5                                                      
                                                                                
         L     R1,ASTINCHK                                                      
         USING STICKEYD,R1                                                      
TBK032   CLI   STICKKNU,IKNBOO       LOCATE ENTRIES FOR BOOK INPUT              
         BH    TBK037                                                           
         BL    TBK034                                                           
         CLC   STICKNTH,TDRBK        FIND NTH INPUT OF BOOK                     
         BH    TBK037                                                           
         BE    TBK035                                                           
TBK034   ZIC   R0,STICLEN                                                       
         AR    R1,R0                                                            
         B     TBK032                                                           
TBK035   LA    RE,STICDATA         EXTRACT DATA                                 
TBK036   CLI   0(RE),STSPSOPI       UNTIL START-NEST INDICATOR REACHED          
         BE    TBK038               AND EXIT                                    
         MVC   0(1,R4),0(RE)                                                    
         LA    R4,1(R4)                                                         
         LA    RE,1(RE)                                                         
         B     TBK036                                                           
TBK037   LA    R4,1(R4)            ELSE, BUMP 1 FOR DUMMY DATA INPUT            
TBK038   EQU   *                                                                
         B     TBKX                                                             
         DROP  R1,R5                                                            
TBK039   EQU   *                                                                
                                                                                
*                                                                               
TBK050   DS    0H                                                               
         CLI   DBMED,C'W'                                                       
         BE    TBK060                                                           
         CLI   DBMED,C'O'                                                       
         BE    TBK060                                                           
*                                                                               
         DS    0H                                                               
         MVI   STARTDAY,0          USE DEFAULT START DAY IN NSIWEEK             
         CLI   DBMED,C'C'           CHECK FOR CANADIEN                          
         BNE   TBK053X                                                          
         CLI   DBSRC,C'N'            NIELSEN                                    
         BNE   TBK053X                                                          
         CLC   DBFIL,=C'TP '         TIME PERIOD                                
         BNE   TBK053X                                                          
         CLC   DUB(2),=X'6001'       ON OR AFTER JAN/96                         
         BL    TBK053X                                                          
                                                                                
* NEW CODE WTP ASSUME WEEKLYTP ASSUME MONTHLY                                   
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RE)                                                    
         BNE   TBK054X                                                          
*                                                                               
         CLC   DUB(2),=X'6001'       ON OR AFTER JAN/96                         
         BL    TBK053X                                                          
*                                                                               
         MVI   STARTDAY,1           OVERRIDE START DAY TO MONDAY                
         B     TBK060                                                           
TBK053X  EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVI   STARTDAY,0          USE DEFAULT START DAY IN NSIWEEK             
         CLI   DBMED,C'C'           CHECK FOR CANADIEN                          
         BNE   TBK054X                                                          
         CLI   DBSRC,C'A'            BBM                                        
         BNE   TBK054X                                                          
         CLI   DUB+3,C'W'            BOOKTYPE "W"                               
         BNE   TBK054X                                                          
         CLC   DBFIL,=C'TP '         TIME PERIOD                                
         BNE   TBK054X                                                          
         CLC   DUB(2),=X'6301'       ON OR AFTER JAN/99                         
         BL    TBK054X                                                          
* NEW CODE WTP ASSUME WEEKLYTP ASSUME MONTHLY                                   
         L     RE,ADEMFIL                                                       
         CLC   =C'LPM',8(RE)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RE)                                                    
         BNE   TBK054X                                                          
*                                                                               
         MVI   STARTDAY,1           OVERRIDE START DAY TO MONDAY                
         B     TBK060                                                           
TBK054X  EQU   *                                                                
                                                                                
         B     TBK080              GO FORMAT AS MONTHLY BOOK                    
                                                                                
*                                                                               
TBK060   DS    0H                  FORMAT WEEKLY BOOK                           
         CLI   DBMED,C'O'                                                       
         BNE   *+8                                                              
         MVI   STARTDAY,1                                                       
         GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     +        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         GOTO1 VDATCON,DMCB,(X'80',DUB2),(5,(R4))                               
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         B     TBK100                                                           
                                                                                
*                                                                               
TBK080   DS    0H                  FORMAT MONTHLY BOOK                          
         CLC   BKS(L'LATBOOK),LATBOOK  CHECK IF LATEST BOOK REQUESTED           
         BE    TBK085                                                           
         CLI   DUB,XFF              CHECK IF LATEST N BOOKS REQUESTED           
         BE    TBK085                                                           
         B     TBK093                                                           
*                                                                               
TBK085   DS    0H                                                               
         MVC   0(6,R4),=C'LATEST'    YES, FORMAT AS LATEST N BOOKS              
         LA    R4,6(R4)                                                         
                                                                                
         CLC   BKS(L'LATBOOK),LATBOOK                                           
         BNE   *+22                                                             
         MVC   0(3,R4),SPACES        A SPACE BEFORE AND AFTER                   
         MVI   1(R4),C'-'             THIS DASH                                 
         LA    R4,3(R4)                                                         
         B     TBK088                                                           
                                                                                
         CLI   DUB,XFF               LATEST N                                   
         BNE   *+18                                                             
         MVC   1(1,R4),DUB+1                                                    
         LA    R4,2(R4)                                                         
         B     TBK088                                                           
                                                                                
         DC    H'0'                                                             
                                                                                
TBK088   DS    0H                                                               
         CLC   BKS(L'LATBOOK),LATBOOK                                           
         BE    TBK093                                                           
         B     TBK100                                                           
*                                                                               
TBK093   DS    0H                                                               
*  IF CANAAIAN MONTHLY FILE REQUEST - HAVE TO CHECK IF THE INTERNAL             
*  BOOK IS WEEKLY AND FORMAT CORRECTLY.  TRANSLATE THE CORRECT WEEKLY           
*  WEEK TO A MONTHLY BOOK DISPLAY                                               
***************************                                                     
*  CSI LATEST BOOK TP FILE CODE                                                 
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   TBK098                                                           
         CLI   DBSRC,C'A'           CANADIAN WTP FILE REQUESTED                 
         BE    TBK096                                                           
         CLC   DUB(2),=X'6001'                                                  
         BL    TBK098                                                           
         B     TBK097                                                           
TBK096   CLI   DUB+3,C'W'                                                       
         BNE   TBK098                                                           
         MVI   DUB+3,0                                                          
TBK097   GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     X        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         JNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         GOTO1 VDATCON,DMCB,(0,DUB2),(6,(R4))                                   
**       L     R0,FULL2                                                         
**       L     RF,FULL             BUMP OUTPUT POINTER SO                       
**       LA    RF,3(RF)                                                         
**       ST    RF,FULL              BOOKTYPE WON'T OVERWRITE DATE               
**       B     TBK100                                                           
         CLI   3(R4),C'/'          IF OUTPUT IS MMM/YY,                         
         BNE   *+12                                                             
         MVC   3(2,R4),4(R4)        THEN REMOVE THE '/'                         
         BCTR  R4,0                                                             
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         MVI   0(R4),C' '           AND BLANK OUT "GARBAGE"                     
         B     TBK100                                                           
*                                                                               
**************************                                                      
TBK098   DS    0H                                                               
         GOTO1 VDATCON,DMCB,(X'83',DUB),(6,(R4))                                
         CLI   3(R4),C'/'          IF OUTPUT IS MMM/YY,                         
         BNE   *+12                                                             
         MVC   3(2,R4),4(R4)        THEN REMOVE THE '/'                         
         BCTR  R4,0                                                             
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         MVI   0(R4),C' '           AND BLANK OUT "GARBAGE"                     
         B     TBK100                                                           
                                                                                
*                                                                               
TBK100   DS    0H                  DO BOOK TYPE                                 
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   TBK101                                                           
         CLI   DBSRC,C'A'                                                       
         BNE   TBK101               DONT PRINT OUT THE BOOKTYPE W               
         L     RF,ADEMFIL           FOR WTP  (BBM)                              
         CLC   =C'LPM',8(RF)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RF)                                                    
         BNE   TBK101                                                           
         CLI   DUB+3,C'W'                                                       
         BE    TBK109                                                           
TBK101   DS    0H                                                               
*                                                                               
*                                                                               
         CLI   DBMED,C'U'          COUNTY COVERAGE COVERT BOOKTYPE              
         BNE   TBK105              TO STATE CODE                                
         CLI   DUB+3,0             MUST HAVE STATECODE                          
         BNE   *+6                 OR ELSE SOMETHING IS                         
         DC    H'0'                REALLY AMISS                                 
         MVI   GOSUBN,GSTATE#                                                   
         GOTO1 AGOSUB                                                           
         CLI   DUB+3,0              ANY BOOK TYPE?                              
         BNE   *+6                  MUST HAVE STATECODE OR                      
         DC    H'0'                 ELSE SOMETHING IS AMISS                     
         MVI   0(R4),C'('                                                       
         MVC   1(2,R4),HALF                                                     
         MVI   3(R4),C')'                                                       
         LA    R4,4(R4)                                                         
         B     TBK109                                                           
TBK105   EQU   *                                                                
*                                                                               
         CLI   DUB+3,0              ANY BOOK TYPE?                              
         BE    TBK109                NOPE                                       
         MVI   0(R4),C'('                                                       
****     MVC   1(1,R4),DUB+3                                                    
* DISPLAY 2 CHARACTER BOOKTYPE                                                  
         XC    DMCB2,DMCB2                                                      
         MVI   DMCB2,12                                                         
         MVC   DMCB2+1(1),DUB+3                                                 
         GOTO1 ATRANSBT                                                         
         MVC   1(2,R4),=C'??'                                                   
         CLI   DMCB2+4,X'FF'                                                    
         BE    *+10                                                             
         MVC   1(2,R4),DMCB2+4                                                  
*                                                                               
         CLI   DMCB2+5,0           1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    TBK106                                                           
         CLI   DMCB2+5,X'40'       1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    TBK106                                                           
*                                                                               
         MVI   3(R4),C')'          2 CHARACTER BOOKTYPE                         
         AHI   R4,4                ADJUST FOR L(BOOKTYPE)                       
         B     TBK109                                                           
*&&DO                                                                           
         CLI   DBMED,C'T'                                                       
         BNE   TBK106                                                           
         CLI   1(R4),X'81'                                                      
         BL    *+16                                                             
         CLI   1(R4),X'B9'                                                      
         BH    *+8                                                              
         OI    1(R4),X'40'       CAPITAL LETTERS                                
*&&                                                                             
TBK106   MVI   2(R4),C')'                                                       
         LA    R4,3(R4)                                                         
TBK109   EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  DO WEEK NUMBER                               
         CLI   DUB+2,0              ANY WEEK NUMBER                             
         BE    TBK119                NOPE                                       
         MVC   2(4,R4),=C'WEEK'                                                 
         MVC   6+1(1,R4),DUB+2                                                  
         OI    6+1(R4),X'F0'                                                    
         LA    R4,8(R4)                                                         
TBK119   EQU   *                                                                
                                                                                
*                                                                               
TBKX     DS    0H                                                               
         LA    R0,WORK                                                          
         SR    R4,R0                                                            
         STH   R4,HALF             SET LENGTH INTO HALF                         
*                                                                               
         J     EXIT                                                             
*&&                                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--TWK+        
               #)'                                                              
*-------------------------- TRANSLATE WEEKS --------------------------*         
                                                                                
* Translates active week bits into printable format                             
* At entry,                                                                     
*   TMPWKS   = active week bits                                                 
* At exit,                                                                      
*   WORK     = formatted active weeks                                           
*   HALF     = length of formatted active weeks                                 
                                                                                
TRSLTWKS DS    0H                                                               
         MVC   WORK,SPACES                                                      
         LA    R4,WORK                                                          
                                                                                
*                                                                               
         DS    0H                  FORMAT BOOK                                  
         LA    RE,B'00001000'      TRANSLATE BITS (STARTING W/ X'08')           
         LA    RF,C'1'              INTO EBCDIC DIGITS                          
TWK012   EX    RE,*+8              JUST PASS THOSE WEEK NOS. OF                 
         B     *+8                  THOSE WEEKS THAT WERE ACTIVE                
         TM    TMPWKS,0             (eg. X'0B' ==> C'134' )                     
         BZ    *+12                                                             
         STC   RF,0(R4)                                                         
         LA    R4,1(R4)                                                         
         LA    RF,1(RF)                                                         
         SRL   RE,1                                                             
         OR    RE,RE                                                            
         BNZ   TWK012                                                           
*                                                                               
         TM    TMPWKS,X80          IF DIFFERING ACTIVE WEEKS,                   
         BZ    *+12                                                             
         MVI   0(R4),C'*'           INDICATE IT SO WITH AN "*"                  
         LA    R4,1(R4)                                                         
                                                                                
*                                                                               
TWKX     DS    0H                                                               
         LA    R0,WORK                                                          
         SR    R4,R0                                                            
         STH   R4,HALF             SET LENGTH INTO HALF                         
*                                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--TPU+        
               R#)'                                                             
*----------------------- TRANSLATE PURE NUMBER -----------------------*         
                                                                                
* At entry,                                                                     
*   TMPPURE = pure number to translate.                                         
* At exit,                                                                      
*   WORK    = printable pure number.                                            
*   HALF    = L(printable pure number).                                         
                                                                                
TRSLTPUR DS    0H                                                               
         LA    R5,DBLOCK1                                                       
         USING DBLOCKD,R5                                                       
         LR    R0,R5                 CLEAR DBLOCK                               
         LA    R1,DBLOCK1X-DBLOCK1                                              
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         MVC   DBFILE,=C'PAV'        SET UP DBLOCK : FILE (PAV<==>PURE)         
         L     RF,AIOAREA1                                                      
         ST    RF,DBAREC             SET UP DBLOCK : A(RECORD)                  
         USING PRKEY,RF                                                         
         XC    PRKEY(24),PRKEY                                                  
         LA    R0,PRFRSTEL                                                      
         ST    R0,DBAQUART           SET UP DBLOCK : A(1ST ELEMENT)             
         MVC   PRKMINOR,TMPPURE      SET PURE NUMBER IN PAV RECORD              
         DROP  RF                                                               
*                                                                               
         MVC   WORK2,SPACES                                                     
         GOTO1 VDEFINE,DMCB,=C'PURE',DBLOCKD,WORK2                              
         MVC   WORK(4),WORK2+3                                                  
         DROP  R5                                                               
*                                                                               
         LA    R4,WORK+3                                                        
         CLI   0(R4),C' '          POINT R4 TO LAST NON-SPACE                   
         BH    *+8                                                              
         BCT   R4,*-8                                                           
*                                                                               
         B     TPURX                                                            
                                                                                
*                                                                               
TPURX    DS    0H                                                               
         LA    R0,WORK                                                          
         SR    R4,R0                                                            
         LA    R4,1(R4)                                                         
         STH   R4,HALF             SET LENGTH INTO HALF                         
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--GDM+        
               #)'                                                              
*------------------------- CLEAR DBLOCK AREA -------------------------*         
                                                                                
* Clears DBLOCK area addressed by ADBLOCK.                                      
                                                                                
CLRDBLK  DS    0H                                                               
         L     R0,ADBLOCK                                                       
         LA    R1,DBLOCK1X-DBLOCK1                                              
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--XDV+        
               #)'                                                              
*------------------------ EXTRACT DEMO VALUES ------------------------*         
                                                                                
* Extracts demo values from an inventory track record.                          
* Indicates if there are any demo overrides.                                    
* At entry,                                                                     
*   ADEMLIST = list of demos to get,                                            
*   R5       = A(record to extract demos from)                                  
*   DBLOCK1  = the DBLOCK in effect                                             
* At exit,                                                                      
*   THISDEMS = extracted demo values.                                           
* NOTE:  SVDBLOCK area will get creamed here.                                   
                                                                                
XTRCTDMV DS    0H                                                               
         XC    THISDEMS,THISDEMS   CLEAR OUTPUT AREA FOR DEMO VALUES            
*                                                                               
         DS    0H                  CLEAR DBLOCK                                 
         LA    R0,SVDBLOCK                                                      
         ST    R0,ADBLOCK                                                       
         MVI   GOSUBN,CDBK#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         DS    0H                  SET UP DBLOCK                                
         LA    R6,SVDBLOCK                                                      
         USING DBLOCKD,R6                                                       
*                                                                               
         LA    R0,(RINVPEL-RINVREC)(R5)                                         
         LTR   R1,R5                                                            
         BNZ   XDV012X                                                          
MYDBK1   USING DBLOCKD,DBLOCK1                                                  
         L     R0,MYDBK1.DBAQUART                                               
         L     R1,MYDBK1.DBAREC                                                 
         DROP  MYDBK1                                                           
XDV012X  EQU   *                                                                
*                                                                               
*&&DO                                                                           
         ST    R5,DBAREC                 A(RECORD)                              
         LA    R0,(RINVPEL-RINVREC)(R5)  A(1ST ELEMENT)                         
         CLI   0(R5),RINVKTYQ                                                   
         BE    *+8                                                              
         LA    R0,(DRFRSTEL-DRKEY)(R5)                                          
*&&                                                                             
         ST    R1,DBAREC                 A(RECORD)                              
         ST    R0,DBAQUART               A(QH OR 1ST ELEMENT)                   
         MVC   DBCOMFCS,AFAC             A(COMFACS)                             
*                                                                               
*  2 DECIMAL CODE                                                               
         DS    0H                  SET UP PRECISION IN DBLOCK EXTNSN            
* 100404  ALLOW IMS AND UPGRADES TO BE DEC=2 IF NOT PAV                         
*                                                                               
*        OC    OPTUPBK,OPTUPBK     NO UPGRADE 2 DECIMALS                        
*        BZ    *+14                FOR PAV                                      
*        CLC   DBFIL,=C'PAV'                                                    
*        BE    XDV031                                                           
*                                                                               
*                                                                               
* nov04/  allow 2 decimal upgrades test                                         
         CLI   DEC2PROJ,C'Y'                                                    
         BE    XDV13                                                            
         OC    OPTUPBK,OPTUPBK     NO UPGRADE 2 DECIMALS RIGHT NOW TOO          
         BNZ   XDV031                                                           
         OC    OPTIMS,OPTIMS       NO UPGRADE 2 DECIMALS RIGHT NOW TOO          
         BNZ   XDV031                                                           
XDV13    DS    0H                                                               
*                                                                               
*******  CLI   OPTDMA,C'I'         IMPRESSION BASED WAS FORCED                  
*******  BNE   XDV031                                                           
***      CLI   OPTDEC,C'2'                                                      
***      BE    XDV015                                                           
         CLI   DBMED,C'W'         WEEKLY ALSO HAS DEC=2, DEC=0 OPTION           
         BE    *+8                                                              
         CLI   DBMED,C'O'         OBERNIGHTS HAS DEC=2, DEC=0 OPTION            
         BE    *+8                                                              
         CLI   DBMED,C'T'         USTV NSI HAS DEC=2 OR DEC=0 SET               
         BNE   XDV031                                                           
         CLI   DBSRC,C'F'         FUSION HAS DEC=2, DEC=0 OPTION                
         BE    *+8                                                              
         CLI   DBSRC,C'N'                                                       
         BNE   XDV031                                                           
         CLI   OPTDEC,C'0'                                                      
         BNL   XDV015                                                           
XDV014   TM    DEMFLAG1,DF1STERO+DF1DEM32    ONLY DEM32 SET UP 2 DEC            
         BNO   XDV031                                                           
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    XDV031                                                           
XDV015   DS    0H                                                               
         MVI   THISDEC,C'Y'     SET FLAG TO 2 DECIMAL = Y                       
*                                                                               
         XC    WORK2,WORK2                                                      
         LA    R1,WORK2                                                         
         ST    R1,DUB+4                                                         
         MVC   DUB+0(4),=C'SPOT'                                                
         MVI   SDBXF,C'D'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R1,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTTID,R1                                                       
**** FOR NOW JUST FOR ZEN'S PRECISION SUPPORT DFUDGE THE DISPLACEMENT           
**** UNTIL DBEXTRAD DSECT IS LIVE                                               
**       LA    RE,DBXTRC2T                GIVE ZEN HIS DECMIAL                  
**       SHI   RE,1                        SUPPORT                              
**       MVC   0(1,RE),OPTDEC                                                   
         MVC   DBXTSCTL,OPTDEC                                                  
*                                                                               
         MVC   DBXTID(4),=C'SPOT'                                               
         MVI   DBXTTRP,X'01'               1 DEC RTG/PUT                        
         MVI   DBXTTSP,X'01'               1 DEC SHARS                          
         MVI   DBXTTIP,X'02'               IMP'S TO 100'S                       
         TM    TMPWHOLE,WHOLERTG           ROUND RATINGS TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTRC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLESHR           ROUND SHARES  TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTSC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLEPUT           ROUND PUTS    TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTPC2T,C'Y'                YEP                                 
         DROP  R1                                                               
*                                                                               
XDV031   DS    0H                                                               
         GOTO1 VDEMOUT,MYDMCB,(C'L',ADEMLIST),DBLOCKD,THISDEMS                  
*                                                                               
* 2 DECIMAL CODE                                                                
*                                                                               
                                                                                
         DS    0H                                                               
         L     RE,ADEMLIST                                                      
         LA    RF,THISDEMS                                                      
*                                                                               
XDV032   DS    0H                                                               
         CLI   0(RE),XFF                                                        
         BE    XDV039                                                           
         LHI   R1,WHOLERTG                                                      
         CLI   1(RE),C'R'                                                       
         BE    *+12                                                             
         LHI   R1,WHOLESHR                                                      
         CLI   1(RE),C'S'                                                       
         BE    *+12                                                             
         LHI   R1,WHOLEPUT                                                      
         CLI   1(RE),C'P'                                                       
         BE    *+8                                                              
         B     XDV037                                                           
                                                                                
         EX    R1,*+8                                                           
         B     *+8                                                              
         TM    TMPWHOLE,0           DISPLAY AS WHOLE NUMBER?                    
         BZ    XDV037                NOPE                                       
                                                                                
         DS    0H                                                               
XDV037   DS    0H                   BUMP TO NEXT DEMO IN LIST                   
         AHI   RE,3                                                             
         AHI   RF,4                                                             
         B     XDV032                                                           
*                                                                               
XDV039   EQU   *                                                                
*                                                                               
* END OF 2 DECIMAL CODE                                                         
*                                                                               
         DROP  R6                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--PVH+        
               K#)'                                                             
*-------------------------- PAV DEMAND HOOK --------------------------*         
                                                                                
PAVHOOK  DS    0H                                                               
         LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
*                                                                               
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'PROG+',DBLOCK,WORK                             
         MVC   THISPROG,WORK        SET THIS PROGRAM'S NAME                     
         MVC   WORK,SPACES                                                      
* NEED TO ADD THIS TO CRRECTL SET THE DBACTEQC FOR THE PROGRAM                  
* DURATION ELSE ONLY PASSED BACK THE END TIME AS REQUESTED                      
* WE NEDED THIS SINCE I AM NO LONGER ASKING FOR ALL DAY REQUEST TO              
* DEMAND                                                                        
         GOTO1 VDEFINE,MYDMCB,=C'TIME',DBLOCK,WORK                              
         ZIC   RE,DBACTSQC                                                      
         ZIC   RF,WORK+6                                                        
         SHI   RF,1              CALCULATE END TIME OF PROGRAM                  
         AR    RE,RF                                                            
         STC   RE,DBACTEQC                                                      
*                                                                               
** TEST PROCESS RECORD OR NOT **                                                
*                                                                               
         CLI   ACTN,DEMOAVL        TEST AVAILS                                  
         BE    PVHKX                                                            
*                                                                               
         DS    0H                                                               
         CLC   0(3,R2),=C'ROT'     IF PROCESSING A ROTATION,                    
         BNE   PVHK012X                                                         
         ZICM  RF,3(R2),(3)         RE-ADJUST R2 TO POINT TO                    
         LA    RF,LDTROTN+1(RF)      ACTUAL DAYTIME/PURE#                       
         MVC   DUB(4),=C'DYTM'      SET DBLOCK EXTENSION LINK ID                
         CLC   0(3,RF),=C'PUR'                                                  
         BNE   *+10                                                             
         MVC   DUB(4),=C'PURE'                                                  
         ICM   RE,15,DBEXTEND                                                   
PVHK012G BNZ   *+6                                                              
         DC    H'0'                                                             
         CLC   0(4,RE),DUB                                                      
         BE    *+12                                                             
         ICM   RE,15,4(RE)                                                      
         B     PVHK012G                                                         
         ZICM  R1,8(RE),(1)         R1 = INDEX                                  
         CLC   0(4,RE),=C'DYTM'                                                 
         BE    *+6                                                              
         BCTR  R1,0                                                             
         MH    R1,=H'5'                                                         
         LA    R2,0(R1,RF)                                                      
PVHK012X EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  TEST FOR CORRECT WEEK                        
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'WEEK',DBLOCK,WORK                              
         SR    R1,R1                                                            
         ICM   R1,1,2(R3)          R1 = WEEK REQUESTED                          
         BZ    *+22                 OK IF NONE REQUESTED                        
         LA    R1,WORK(R1)         R1-->ACTIVE WEEK                             
         NI    0(R1),X'0F'          (REMOVE ZONE)                               
         CLC   0(1,R1),2(R3)       MATCH WEEK TO CHECK FOR ACTIVE-NESS          
         BNE   PVHKX                EXIT HOOK IF WEEK WASN'T ACTIVE             
         DS    0H                  WEEK IN RECORD IS CORRECT                    
*                                                                               
         DS    0H                  TEST FOR CORRECT TIMES                       
         CLC   0(3,R2),=C'PUR'                                                  
         BNE   PVHK015T                                                         
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'TIME',DBLOCK,WORK                              
         MVC   RQSTSQHR(2),WORK+0                                               
         MVC   DBACTSQC,WORK+0      (ACT QHS FOR PURE NOT SET BY DEGET)         
         ZIC   R1,WORK+1                                                        
         BCTR  R1,0                                                             
         STC   R1,DBACTEQC                                                      
         B     PVHK015X                                                         
PVHK015T DS    0H                                                               
         MVC   TEMPMTIM,1(R2)       FIRST CONVERT REQUEST TIMES                 
         MVI   GOSUBN,MTQ#                                                      
         GOTO1 AGOSUB                                                           
         MVC   RQSTSQHR,TEMPQHR                                                 
         MVC   TEMPMTIM,3(R2)        TO QUARTER HOURS                           
         MVI   GOSUBN,S1M#                                                      
         GOTO1 (RF)                                                             
         MVI   GOSUBN,MTQ#                                                      
         GOTO1 (RF)                                                             
         MVC   RQSTEQHR,TEMPQHR                                                 
         OC    3(2,R2),3(R2)       ANY END TIME REQUESTED?                      
         BNZ   *+18                 YES, DON'T FUDGE END QH                     
         SR    RF,RF                NOPE,                                       
         IC    RF,RQSTSQHR                                                      
         AHI   RF,1                                                             
         STC   RF,RQSTEQHR           SHOW ONLY TWO QHs WORTH OF DATA            
PVHK015X EQU   *                                                                
* COMMENT THIS OUT- I DONT WANT ANY FILTERING IN DEM02                          
*&&DO                                                                           
*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                
* FILTER OUT PROGRAMS!                                                          
* CODE TO PROCESS 5A-545 A PROGRAMS                                             
*                                                                               
         CLI   RQSTSQHR,92          IF REQUEST START TIME = 5A-545A             
         BL    PVHK018              AND                                         
* TEMP COMMENT THIS 5/6/2015                                                    
***      CLI   RQSTEQHR,92          IF REQUEST END TIME  6A OR LATER            
****     BNL   PVHK018                                                          
*                                                                               
* REQUEST START TIME 5A -545A                                                   
         CLI   RQSTEQHR,92          IF REQUEST END TIME  6A OR LATER            
         BNL   PVHK016                                                          
         B     PVHK017                                                          
* NEED SCENARIOS IF REQUEST 5A-6A                                               
PVHK016  DS    0C                                                               
         CLI   DBACTSQC,92          IF PROGRAM STARTED 5A -545A                 
         BL    PVHKX                THEN ITS GOOD                               
         B     PVHK020                                                          
* NEED SCENARIOS IF REQ 5A-PASS 6A (CROSSING INTERNAL DEMO DAY 6A)              
PVHK017  DS    0C                                                               
         CLI   DBACTSQC,92          IF PROGRAM STARTED 5A -545A                 
         BNL   PVHK020              THEN ITS GOOD                               
*                                                                               
         ZIC   RE,RQSTEQHR          PROG'S START  VS.  REQUEST'S END            
         ZIC   RF,DBACTSQC                                                      
         CR    RF,RE                PROG'S START  VS.  REQUEST'S END            
         BH    PVHKX                                                            
         B     PVHK020                                                          
                                                                                
*                                   PROGRAM IS GOOD 5A-545A 92-95               
                                                                                
         MVC   WORK,SPACES                                                      
*                                                                               
* REQUESTED REGULAR PROGRAMS THAT START 6A AND AFTER                            
PVHK018  CLC   DBACTEQC,RQSTSQHR    PROG'S END  VS.  REQUEST'S START            
         BNH   PVHKX                                                            
         CLC   DBACTSQC,RQSTSQHR    PROG'S START VS REQUEST'S START             
         BL    PVHKX                                                            
**       CLC   DBACTSQC,RQSTEQHR    PROG'S START  VS.  REQUEST'S END            
**       BH    PVHKX                                                            
* DONTN SHOW POSRT 6AM PROGRAMS                                                 
* CODE TO MAKE SURE PROGRRAM START TIME IS NOT > REQUESTED END TIME             
PVHK018B CLI   DBACTSQC,92         MAKE SURE PROGRAM DOESNT CROSS 445A          
         BNL   PVHKX               TRUE NIELSEN BROADCAST END OF DAY            
*                                                                               
         CLC   =C'ENTERTAINE',THISPROG                                          
**       BNE   *+6                                                              
**       DC    H'0'                                                             
*                                                                               
         CLC   RQSTSQHR,RQSTEQHR    IF REQ START TIME >REQ END TIME             
         BNH   PVHK018D             MEANS WE ARE CROSSING 6A THEN               
*        CLI   DBACTSQC,92         MAKE SURE PROGRAM DOESNT CROSS 445A          
*        BNL   PVHKX               TRUE NIELSEN BROADCAST END OF DAY            
         B     PVHK020                                                          
PVHK018D CLC   DBACTSQC,RQSTEQHR    IF PROG START < REQUEST END -GOOD           
         BNH   PVHK020              ELSE                                        
         B     PVHKX                                                            
*                                                                               
PVHK018H DS    0H                  WE WANT TIMES TO OVERLAP                     
                                                                                
*                                                                               
*%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%                
*&&                                                                             
* ONLY DISPLAY PROGRAM THAT STARTED AFTER THE REQ START TIME                    
*                                                                               
         CLC   RQSTSQHR,RQSTEQHR    ARE WE CROSSING 6AM INTERNAL DAY            
         BNH   PVHK018E             IN OUR REQUEST TIME?                        
         CLI   DBACTSQC,0           ANYTHING 6AM IS GOOD                        
         BNL   PVHK020                                                          
*                                                                               
PVHK018E ZIC   RE,RQSTSQHR                                                      
         CLC   DBACTSQC,RQSTSQHR    PROG'S START VS REQUEST'S START             
         BL    PVHKX                                                            
PVHK020  DS    0H                  TEST FOR CORRECT PROGRAM TYPE                
*^^GLEE - 09/01/98 - DEDEFINE can not resolve 'PTYPE' for PAV file yet          
*&&DO                                                                           
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'PTYPE',DBLOCK,WORK                             
         CLI   OPTSPRT,C'Y'        IF USER WANT SPORTS                          
         BNE   *+12                                                             
         CLI   WORK,C'S'            BUT PROGTYPE ISN'T,                         
         BNE   PVHKX                IT'S NO GOOD                                
         CLI   OPTSPRT,C'N'        IF USER DON'T WANT SPORTS                    
         BNE   *+12                                                             
         CLI   WORK,C'S'            BUT PROGTYPE IS,                            
         BE    PVHKX                IT'S NO GOOD                                
         DS    0H                  RECORD CAN BE PROCESSED                      
*&&                                                                             
         EJECT                                                                  
*                                                                               
** EXTRACT DATA FOR PAV FILE **                                                 
*                                                                               
         OI    MYFLAG1,MYF1RDOK    DEMAND READ OK--GOT SOME DEMO RECDS          
                                                                                
         MVI   THISDAYR,1          ENTRY # W/IN ROTATION                        
         MVC   THISPTYP,SPACES                                                  
         MVI   THISQHAF,100        SET QH ADJ FCTR TO ZERO (100-BASED)          
                                                                                
*                                                                               
         CLI   DBSELMED,C'N'       LET IT GO THRU FOR NETWORK                   
         BE    *+8                                                              
         CLI   DBACTSRC,C'N'       TAPEOPT - NSI ONLY                           
         BE    *+12                                                             
         MVI   TAPEOPT,C'N'         OTHERWISE RESET                             
         MVI   DBTAPEP,0                                                        
*                                                                               
         MVI   THISFLG1,0          CLEAR FLAG BYTE                              
*                                                                               
         MVC   THISASQC,DBACTSQC   GET ACTUAL START                             
         MVC   THISAEQC,DBACTEQC    AND END QH'S                                
*                                                                               
         L     RF,DBAQUART                                                      
         MVI   THISNOR,0           ASSUME NOT NORMAL PROGRAM                    
         CLI   DBSELMED,C'N'       NETWORK?                                     
         BNE   DMLKPH03                                                         
         USING PHELEM,RF                                                        
         TM    PHDTYPE,X'01'       REG PROGRAM?                                 
         BNO   *+8                                                              
         MVI   THISNOR,1           SET TO NORMAL                                
         B     DMLKPH05            DEFAULT IS TO KEEP NORMAL FOR NETWK          
*                                                                               
         USING PHELEM,RF                                                        
DMLKPH03 CLI   PHDTYPE,1           0=NORMAL, 1=FULL CYCLE                       
         BE    *+8                                                              
         MVI   THISNOR,1            IT'S A NORMAL PROGRAM                       
         CLI   DBMED,C'O'           OVERNIGHTS PAV IS ALL FULL CYCLE            
         BE    DMLKPH05                                                         
         CLI   OPTNOR,C'N'         IF ASKED TO INCLUDE NORMAL PROGRAMS,         
         BE    *+12                 LET IT PASS                                 
         CLI   THISNOR,1           ELSE, SUPPRESS THEM BY DEFAULT               
         BE    PVHKX                                                            
                                                                                
DMLKPH05 XC    THISPNUM,THISPNUM   ASSUME NO PROGRAM NUMBER                     
         CLI   PHREVID,X'FF'                                                    
         BNE   *+18                                                             
         CLI   PHREV,1                                                          
         BNE   *+10                                                             
         MVC   THISPNUM,PHPNUM3    PROGRAM NUMBER                               
         DROP  RF                                                               
*                                                                               
         DS    0H                  SET PROGRAM NAMES                            
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'PROG+',DBLOCK,WORK                             
         MVC   THISPROG,WORK        SET THIS PROGRAM'S NAME                     
         MVC   CUMPNAM2,WORK                                                    
         CLC   CUMPNAM1,SPACES                                                  
         BNE   *+10                                                             
         MVC   CUMPNAM1,WORK                                                    
                                                                                
         DS    0H                  GET PURE NUMBER                              
         XC    WORK,WORK                                                        
         GOTO1 (RF),MYDMCB,=C'PURE',DBLOCK,WORK                                 
         MVC   THISPURE,WORK        SET THIS PROGRAM'S PURE NUMBER              
                                                                                
         DS    0H                  GET TOTAL DURATION                           
         MVI   WORK,0                                                           
****     GOTO1 (RF),MYDMCB,=C'TOTDUR',DBLOCK,WORK                               
         GOTO1 (RF),MYDMCB,=C'TOT2DUR',DBLOCK,WORK                              
         MVC   THISNQH,WORK         SET THIS PROGRAM'S DURATION                 
                                                                                
         DS    0H                  GET NUMBER OF DAYS                           
         MVI   WORK,0                                                           
         GOTO1 (RF),MYDMCB,=C'NDAYS',DBLOCK,WORK                                
         MVC   THISNDYS,WORK        SET THIS PROGRAM'S # OF DAYS                
                                                                                
         DS    0H                  GET NUMBER OF WEEKS                          
         MVI   WORK,0                                                           
         GOTO1 (RF),MYDMCB,=C'WEEK',DBLOCK,WORK                                 
         ZICM  RE,WORK,(1)                                                      
         BNZ   PVHK007                                                          
         CLI   DBSELMED,C'O'       ZERO=5 WEEKS FOR PAV OVERNIGHTS              
         BE    *+8                                                              
         CLI   DBSELMED,C'N'       ZERO=5 WEEKS FOR NETWORK                     
         BE    *+6                                                              
         DC    H'0'                NON-NETWORK -> 0 WKS IS INVALID              
         LA    RE,X'10'            SET A 5TH WK BIT                             
*                                                                               
PVHK007  STC   RE,THISWKS                                                       
         LR    RF,RE                                                            
         A     RF,A1STWKTB                                                      
         MVC   THIS1WK,0(RF)        SET THIS PROGRAM'S 1ST WEEK                 
         A     RE,ANUMWKTB                                                      
         MVC   THISNWK,0(RE)        SET THIS PROGRAM'S # OF WEEKS               
                                                                                
         CLI   CUMWKS,0            IF WE HAVE SOME CUMLTV WKS ALREADY,          
         BE    PVHK007G                                                         
         CLC   CUMWKS,THISWKS       AND IT'S NEQ TO CURR ACTV WEEKS,            
         BE    PVHK007G                                                         
         OI    CUMWKS,X80           SET FLAG IN CUMLTV ACTV WEEKS               
PVHK007G EQU   *                                                                
         OC    CUMWKS,THISWKS                                                   
*                                                                               
*                                                                               
         DS    0H                  LOOK UP VUTS (TO DERIVE SHARES)              
         GOTO1 VDEMOUT,MYDMCB,(C'L',AVUTLIST),DBLOCK,QHVUTS                     
         OC    QHVUTS(4),QHVUTS    IF NO VUTS,                                  
         BNZ   DMLKPH10                                                         
         GOTO1 VDEMOUT,MYDMCB,(C'L',APUTLIST),DBLOCK,QHVUTS                     
*                                                                               
DMLKPH10 DS    0H                  CALL REGETIUN FOR DEMO VALUES                
*                                                                               
*        WEEKLY HOUSEHOLD?                                                      
         LA    RE,DEMODEMS                                                      
         ST    RE,ADEMLIST          SET A(DEMO LIST)                            
         TM    MISCFLG1,MF1WHHD     ANY WEEKLY HH DEMOS?                        
         BZ    DMLKPH15              NOPE                                       
         XC    WHHDEMS(WHHDEML),WHHDEMS                                         
*                                                                               
* 2 DECIMAL CODE                                                                
*^^TEST                                                                         
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
*^^EOTEST                                                                       
* END OF 2 DECIMAL CODE                                                         
*                                                                               
         SR    R5,R5                                                            
         MVI   GOSUBN,XDV#                                                      
         GOTO1 AGOSUB               EXTRACT VALUES INTO THISDEMS                
*                                                                               
         MVC   HALF,DBFACTOR        MAD VALUES INTO CUMWHH                      
         LA    RF,DEMODEMS                                                      
         SR    R1,R1                                                            
DMLKPH12M DS   0H                                                               
         CLI   0(RF),XFF                                                        
         BE    DMLKPH15                                                         
         CLI   2(RF),DNWHH1         IS IT A WEEKLY                              
         BL    DMLKPH12P                                                        
         CLI   2(RF),DNWHH4          HOUSEHOLD DEMO?                            
         BH    DMLKPH12P                                                        
         L     R0,THISDEMS(R1)                                                  
                                                                                
****     TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
****     BO    DMLKPH12N                                                        
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BZ    DMLKPHWH               MAINFRAME                                 
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    DMLKPH12N                                                        
DMLKPHWH DS    0H                                                               
******   CLI   OPTDEC,C'2'                                                      
******   BNE   DMLKPH12O                                                        
         CLI   OPTDEC,C'2'    CHECK IF DEC=2 CARD SET                           
         BE    DMLKPH12N      IF SO MULTIPLY BY 10                              
         CLI   OPTDEC,C'0'    CHECK IF DEC=2 CARD SET                           
         BNE   DMLKPH12O      IF SO MULTIPLY BY 10                              
**** THIS PART OPTDEC MUST BE = 0                                               
******** SRL   R0,1           DIVIDE BY 10                                      
******** B     DMLKPH12O                                                        
**       MH    R0,HALF                                                          
         LR    R5,R1                 SAVE R1 WE HAVE TO USE IT FOR NOW          
         LR    R1,R0                                                            
         SR    R0,R0                                                            
         MH    R0,=F'10'                                                        
         AHI   R1,5                                                             
         SR    R0,R0                                                            
         D     R0,=F'10'           R1 HAS WEEKLY VALUE                          
         LR    R0,R1                                                            
         LR    R1,R5                 RESTORE R1                                 
         B     DMLKPH12O                                                        
DMLKPH12N DS   0H                                                               
*******  CLI   OPTDMA,C'I'           IMPRESSION BASED WAS FORCED                
*******  BNE   DMLKPH12O                                                        
         MH    R0,=H'10'                                                        
DMLKPH12O DS   0H                                                               
*                                                                               
*                                                                               
*                                                                               
         ST    R0,WHHDEMS(R1)        STORE WEEKLY HOUSEHOLD DEMO HERE           
*                                                                               
         MH    R0,HALF                                                          
         A     R0,CUMWHH(R1)                                                    
         ST    R0,CUMWHH(R1)                                                    
DMLKPH12P DS   0H                                                               
         LA    R1,4(R1)                                                         
         LA    RF,3(RF)                                                         
         B     DMLKPH12M                                                        
DMLKPH12X EQU  *                                                                
         B     DMLKPH18                                                         
                                                                                
*                                                                               
DMLKPH15 LA    R0,QHVUTS                                                        
         ST    R0,AVUTS             SET A(VUTS TO USE)                          
         MVI   GOSUBN,PIUN#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         DS    0H                                                               
         LA    R3,CUMSHR                                                        
         BAS   RE,GETSHR           ACCUMULATE SHARES IN CUMSHR                  
*                                                                               
         DS    0H                  GO EXTRACT DEMO VALUES                       
*                                                                               
* 2 DECIMAL CODE                                                                
*^^TEST                                                                         
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
*^^EOTEST                                                                       
* END OF 2 DECIMAL CODE                                                         
******************************************************                          
* CALL DEMOMATH FOR OVERNIGHTS TO GET DETAIL LINES BY ITS AVG                   
* THIS TAKES CARE OF THE DETAIL LINES..                                         
*******************************************************                         
         CLI   DBMED,C'O'                                                       
         BNE   NOADJUST                                                         
         ST    R6,MTHCFACS          INITIALIZE MATH BLOCK: A(DBLOCK)            
         ZICM  R0,DBDIVSOR,(3)                                                  
         ST    R0,MTHFCTR           MATH FACTOR                                 
         MVC   MTHIFIL,=C'INV'                                                  
         MVC   MTHOFIL,=C'INV'                                                  
         MVC   MTHOSRC,=C'NSI'                                                  
                                                                                
         L     RF,DBCOMFCS                                                      
         L     RF,(CDEMOMTH-COMFACSD)(RF)                                       
         GOTO1 (RF),MYDMCB,=C'DIV',AIUNWRK,AIUNWRK,MATHFAC                      
NOADJUST DS    0H                                                               
*                                                                               
*                                                                               
         LA    R0,DEMODEMS                                                      
         ST    R0,ADEMLIST          SET A(DEMO LIST)                            
         L     R5,AIUNWRK           R5-->RECORD CONTAINING DEMO VALUES          
                                                                                
         MVI   GOSUBN,XDV#                                                      
         GOTO1 AGOSUB                                                           
                                                                                
         DS    0H                  SEED WEEKLY HH DEMOS                         
         TM    MISCFLG1,MF1WHHD     ANY WEEKLY HH DEMOS?                        
         BZ    DMLKPH15M             NOPE                                       
         LA    R0,WHHDEMS                                                       
         ST    R0,AFRDMVL           SET A("FROM" DEMO VALUES)                   
         LA    R0,THISDEMS                                                      
         ST    R0,ATODMVL           SET A("TO" DEMO VALUES)                     
         MVI   GOSUBN,SWHH#                                                     
         GOTO1 AGOSUB                                                           
DMLKPH15M EQU  *                                                                
*                                                                               
         DS    0H                  MAD IUNWRK RECD TO CUMULATIVE AREA           
         ST    R6,MTHCFACS          INITIALIZE MATH BLOCK: A(DBLOCK)            
         ZICM  R0,DBFACTOR,(3)                                                  
*                                                                               
         ST    R0,MTHFCTR           MATH FACTOR                                 
* ======== FOR OVERNIGHTS - USE DBDIVSOR AS WEIGHT ===========                  
         CLI   DBMED,C'O'                                                       
         BNE   DMLKPH17                                                         
         ZICM  R0,DBDIVSOR,(3)                                                  
         ST    R0,MTHFCTR                                                       
DMLKPH17 DS    0H                                                               
*                                                                               
         A     R0,CUMFCTR                                                       
         ST    R0,CUMFCTR           UPDATE CUMULATIVE FACTOR AS WELL            
         MVC   MTHIFIL,=C'INV'                                                  
         MVC   MTHOFIL,=C'INV'                                                  
         MVC   MTHOSRC,=C'NSI'                                                  
                                                                                
         L     RF,DBCOMFCS                                                      
         L     RF,(CDEMOMTH-COMFACSD)(RF)                                       
         GOTO1 (RF),MYDMCB,=C'MAD',AIUNWRK,AIOAREA2,MATHFAC                     
                                                                                
*                                                                               
DMLKPH18 DS    0H                  POST INTO SORT BUFFER                        
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
                                                                                
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'DAY',DBLOCK,WORK                               
         ZIC   R1,WORK+1                                                        
         SLL   R1,4                (UNDO WHAT DEFINE DID)                       
         STC   R1,THISKDAY                                                      
                                                                                
*                                                                               
         DS    0H                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BO    DMLKPH26                                                         
*                                                                               
         ZIC   R1,DBACTSQC                                                      
         CLM   R1,1,RQSTSQHR                                                    
         BNL   *+8                                                              
         IC    R1,RQSTSQHR         R1=START QHR TO PUT IN BINSRCH KEY           
                                                                                
         ZIC   R0,DBACTEQC         TAKE THE LOWER QHR NUMBER BETWEEN            
         CLM   R0,1,RQSTEQHR       PROGRAM ACTUAL END QHR OR REQUEST            
         BNH   *+8                 END QHR                                      
         IC    R0,RQSTEQHR         R0 = LAST QHR (END CONDITION)                
                                                                                
         OI    THISFLG1,BF11HHR    1ST ENTRY IS 1ST HALF HOUR DSPLYED           
*                                                                               
* 5-545AM CODE TO PROCESS PROGRAMS CROSSING THE START OF DAY 6AM                
*                                                                               
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'TIME',DBLOCK,WORK                              
                                                                                
         ZIC   R1,DBACTSQC                                                      
* CHECK IF CROSSING INTO 6AM BOUNDARY FROM 3A START TIME                        
* IF WE ARE STARTING AT 3AM AND CROSSING THE 6AM BOUNDARY - 5AM START           
* FOR TESTING PURPOSE NOV14 IS THE START OF 3A BOOK                             
*                                                                               
         CLI   DBMED,C'O'         OVERNIGHTS                                    
         BNE   DMLKPH19           NOV2015 WEEK OF LATER                         
         CLC   DBACTBK,=X'7331'  IS NSI 3A START OF DAY                         
         BL    DMLKPH21                                                         
         B     DMLKPH20                                                         
*                                                                               
DMLKPH19 DS    0H                                                               
****     CLC   DBACTBK,=X'720B'   NOV14 OR LATER IS NSI 3A START OF DAY         
         CLC   DBACTBK,=X'730C'   DEC15 OR LATER IS NSI 3A START OF DAY         
         BL    DMLKPH21                                                         
DMLKPH20 CHI   R1,84               CONVERT R0 TO END TIME AND AT 96 TO          
         BL    DMLKPH22            IT IF IT CROSSED 6AM START OF DAY            
         CHI   R0,92               TO GET A ABSOLUTE END QHR FOR                
         BNL   DMLKPH22            COMPARISON PURPOSE                           
         B     DMLKP21B                                                         
* CHECK IF CROSSING INTO 6AM BOUNDARY FROM 5A START TIME                        
* IF WE ARE STARTING AT 5AM AND CROSSING THE 6AM BOUNDARY - 5AM START           
DMLKPH21 CHI   R1,92               CONVERT R0 TO END TIME AND AT 96 TO          
         BL    DMLKPH22            IT IF IT CROSSED 6AM START OF DAY            
DMLKP21A CHI   R0,92               TO GET A ABSOLUTE END QHR FOR                
         BNL   DMLKPH22            COMPARISON PURPOSE                           
DMLKP21B AHI   R0,96               R0= ABSOLUTE END QHR ADJUST PAST 6A          
         ZIC   RE,DBACTEQC         WHICH IS LOWER? ACT EQH OR REQ END           
         CR    R0,RE               TAKE THE LOWER QH                            
         BNH   *+8                                                              
         IC    R0,DBACTEQC                                                      
****    NEW 05/22/15                                                            
         AHI  R0,1                                                              
*******************************************************************             
                                                                                
DMLKPH22 DS    0H                  POST ON HALF-HOUR SEGMENTS                   
         LA    R5,1(R1)            R5=POTENTIAL END QH OF ENTRY                 
         STC   R1,THISSQH                                                       
*                                                                               
         AHI   R5,1                ADD 1 TO SHOW CORRECT END TIME               
         STC   R5,THISEQH                                                       
* NEWLY COMMENTED OUT CODE 04/23/15                                             
         AHI   R5,1                ADD 1 TO SHOW CORRECT END TIME               
* r0- readjust  r0 = total duration                                             
*&&DO                                                                           
* NEW CODE TO CHECK IF PROGRAM CROSSES 6A                                       
         CHI   R5,92                                                            
         BL    *+16                                                             
         CHI   R0,92                                                            
         BNL   *+8                                                              
         AHI   R0,96                                                            
*                                                                               
*                                                                               
*                                                                               
         CR    R5,R0               IF IT SURPASSES END,                         
         BNH   *+6                                                              
         BCTR  R5,0                 BACK UP ONE QH                              
         AHI   R5,1                ADD 1 TO SHOW CORRECT END TIME               
*                                                                               
         STC   R1,THISSQH                                                       
*                                                                               
         STC   R5,THISEQH                                                       
         CLC   =C'EYEWIT MORN 5A',THISPROG                                      
         BNE   DONTDIE                                                          
         CLI   THISSQH,X'00'                                                    
**       BNE   *+6                                                              
**       DC    H'0'                                                             
*                                                                               
* NEWEST CODE TO READJUST THE SQH AND EQH                                       
         ZIC   RE,THISSQH                                                       
         CLI   THISSQH,96                                                       
         BL    *+12                                                             
         SHI   RE,96                                                            
         STC   RE,THISSQH                                                       
         ZIC   RE,THISEQH                                                       
         CLI   THISEQH,96                                                       
         BL    *+12                                                             
         SHI   RE,96                                                            
         STC   RE,THISEQH                                                       
**       CLI   THISSQH,X'5C'                                                    
**       BNE   *+6                                                              
**       DC    H'0'                                                             
*        CLC   =C'EYEWIT MORN 5A',THISPROG                                      
*        BNE   DONTDIE                                                          
*        CLI   THISSQH,X'00'                                                    
*        BNE   *+6                                                              
*        DC    H'0'                                                             
DONTDIE  DS    0H                                                               
*&&                                                                             
*                                                                               
         CR    R5,R0               IF LAST ENTRY FOR PROGRAM,                   
         BNH   *+8                                                              
         OI    THISFLG1,BF1XHHR     FLAG IT'S LAST 1/2-HOUR                     
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
*                                                                               
         CR    R5,R0               KEEP POSTING UNTIL END PASSED                
         BH    DMLKPH30                                                         
         LA    R1,2(R1)                                                         
         NI    THISFLG1,X'FF'-BF11HHR                                           
         B     DMLKPH22                                                         
                                                                                
*                                                                               
DMLKPH26 DS    0H                  POST ENTIRE PROGRAM                          
         CLI   ACTN,DEMOPER        IF ACTION=PERIOD,                            
         BE    PVHK028X             DON'T POST "DETAIL" DATA                    
*                                                                               
         DS    0H                                                               
         ICM   RE,15,DBEXTEND                                                   
PVHK107G DS    0H                                                               
         BZ    PVHK109                                                          
         CLC   0(4,RE),=C'DYTM'                                                 
         BNE   *+12                                                             
         LA    R1,(DBXTLIDX-DBXTLID)(RE)                                        
         B     PVHK107X                                                         
                                                                                
         CLC   0(4,RE),=C'PURE'                                                 
         BNE   *+12                                                             
         LA    R1,(DBXPUIDX-DBXPUD)(RE)                                         
         B     PVHK107X                                                         
                                                                                
         ICM   RE,15,4(RE)                                                      
         B     PVHK107G                                                         
PVHK107X EQU   *                                                                
*                                                                               
         ZIC   RF,0(R1)                                                         
         CLC   0(4,RE),=C'DYTM'                                                 
         BNE   *+8                                                              
         LA    RF,1(RF)                                                         
         STC   RF,THISDAYR          SET COMPONENT # W/IN ROTATION               
PVHK109  EQU   *                                                                
                                                                                
*                                                                               
         MVC   THISSQH,DBACTSQC                                                 
         ZIC   R1,DBACTEQC                                                      
         LA    R1,1(R1)             ADD 1 TO SHOW CORRECT END TIME              
         STC   R1,THISEQH                                                       
*                                                                               
* IF PROGRAM STARTS BEFORE 6AM AND CROSSES OVER 6AM-(DURATION 4 QHRS OR         
* MORE THAN JUST ADD THE DURATION TO START TO GET THE END TIME RIGHT            
         CLI   THISSQH,92                                                       
         BL    PVHK110                                                          
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'TIME',DBLOCK,WORK                              
         MVC   PGDUR,WORK+6                                                     
         CLI   WORK+6,4            DURATION                                     
         BL    PVHK110                                                          
         ZIC   R0,WORK+6                                                        
         ZIC   R1,THISSQH                                                       
         AR    R1,R0                                                            
         SHI   R1,96                                                            
         STC   R1,THISEQH                                                       
*                                                                               
PVHK110  EQU   *                                                                
*                                                                               
*                                                                               
         MVC   THISASQC,THISPURE+0  KEEP SORT ORDER SAME AS THE ONE ON          
         MVC   THISAEQC,THISPURE+1   FILE W/O BREAKING "DEM16"                  
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
PVHK028X EQU   *                                                                
*                                                                               
         B     DMLKPH30                                                         
*                                                                               
DMLKPH30 DS    0H                                                               
         DROP  R6                                                               
                                                                                
*                                                                               
PVHKX    DS    0H                                                               
         J     EXIT                                                             
         EJECT                                                                  
         EJECT                                                                  
* Routine to get shares and update shares accumulators.                         
* At entry,                                                                     
*   R3-->output area                                                            
*   R6-->DBLOCK.                                                                
*   MTHFCTR+2 = half-word aligned factor to use in weighting                    
                                                                                
         DS    0H                                                               
GETSHR   NTR1                                                                   
         USING DBLOCKD,R6                                                       
         MVC   HALF,DBACTBK        SAVE ACTUAL BOOK                             
         XC    HOMSHR(HOMSHRL),HOMSHR                                           
                                                                                
         OC    DBAQUART,DBAQUART   IF NO DBAQUART,                              
         BZ    GETSHR05X            THERE BE NO SHARES                          
         GOTO1 VDEMOUT,MYDMCB,(C'P',DEMOSHR),DBLOCKD,HOMSHR                     
GETSHR05X EQU  *                                                                
                                                                                
         MVC   DBACTBK,HALF        RESTORE ACTUAL BOOK VALUE                    
         DROP  R6                                                               
                                                                                
*                                                                               
         DS    0H                  ACCUMULATE THE SHARES                        
         LA    R0,3                 R0 = COUNTER                                
         SR    R1,R1                R1 = INDEX INTO VALUES                      
                                                                                
GETSHR10 DS    0H                                                               
         L     RE,HOMSHR(R1)                                                    
         MH    RE,MTHFCTR+2                                                     
         LR    RF,RE                                                            
         A     RE,0(R1,R3)                                                      
         ST    RE,0(R1,R3)         UPDATE SHARES                                
         LA    R1,4(R1)                                                         
         BCT   R0,GETSHR10                                                      
*                                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--DIV+        
               SHR#)'                                                           
*--------------------------- DIVIDE SHARES ---------------------------*         
                                                                                
* Routine to divide accumulated shares by accumulated weighting factor.         
* At entry,                                                                     
*   CUMSHR  = A(accumulated shares),                                            
*   DIVISOR = accumulated factor.                                               
* At entry,                                                                     
*   HOMSHR  will contain the homes shares unweighted                            
                                                                                
         DS    0H                                                               
DIVSHR   NTR1                                                                   
         LA    R0,3                R0 = COUNTER                                 
         LA    R2,CUMSHR           R2-->ACCUMULATED SHARES                      
         LA    R3,HOMSHR           R3-->UNWEIGHTED HOME SHARES                  
         MVI   GOSUBN,DIV#         DIVIDE ROUTINE                               
                                                                                
DIVSHR10 DS    0H                                                               
         SR    RE,RE                                                            
         L     RF,0(R2)                                                         
         STM   RE,RF,DIVIDEND      SET TOTAL WEIGHTED SHARE IN DIVIDEND         
         GOTO1 AGOSUB                                                           
         MVC   0(4,R3),QUOTIENT    QUOTIENT HAS UNWEIGHTED SHARE                
                                                                                
         LA    R2,4(R2)                                                         
         LA    R3,4(R3)                                                         
         BCT   R0,DIVSHR10                                                      
*                                                                               
         J     EXIT                                                             
         PRINT OFF                                                              
         PRINT ON                                                               
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--MIS+        
               C STUFF)'                                                        
*--------------------- SUBR03 MISCELLANEOUS STUFF --------------------*         
                                                                                
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR03--LTO+        
               R && CONSTANTS)'                                                 
*------------------------- LTORG & CONSTANTS -------------------------*         
         LTORG                                                                  
                                                                                
                                                                                
DEMOSHR  DS    0XL3                                                             
         DC    X'81',C'S',AL1(1)                                                
         DC    X'81',C'S',AL1(2)                                                
         DC    X'81',C'S',AL1(3)                                                
         DC    X'FF'                                                            
                                                                                
                                                                                
SUBR03L  EQU   *-SUBR03                                                         
         DS    0CL(4096-SUBR03L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
***********************************************************************         
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04)'            
***********************************************************************         
*======================== SUBROUTINE POOL FOUR =======================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR04Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR04Q                                                    
SUBR04   NMOD1 0,1B0204**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R03#)         SUBTRACT FOR SUB-RTN #3                      
         SLL   R1,2                                                             
         B     R04_00(R1)                                                       
                                                                                
TSTA#    EQU   (R04_01-R04_00)/4+R03#   TRANSLATE STATION                       
TNMKT#   EQU   (R04_02-R04_00)/4+R03#   TRANSLATE NUMERIC TO ALPHA MKT          
PDTI#    EQU   (R04_03-R04_00)/4+R03#   POST DAY/TIME INDICES                   
DDTB#    EQU   (R04_04-R04_00)/4+R03#   DO DUMMY TSAR RECDS--PART (B)           
PVLK#    EQU   (R04_05-R04_00)/4+R03#   PAV FILE LOOK-UP                        
DMB#     EQU   (R04_06-R04_00)/4+R03#   APMODE=APMBREAK                         
DMR#     EQU   (R04_07-R04_00)/4+R03#   APMODE=APMRESUM                         
DPST#    EQU   (R04_08-R04_00)/4+R03#   CALLS POST ROUTINE                      
DMHD#    EQU   (R04_09-R04_00)/4+R03#   APMODE=FORMHEAD                         
SWHH#    EQU   (R04_10-R04_00)/4+R03#   SEED WEEKLY HH DEMOS                    
                                                                                
R04_00   DS    0H                                                               
R04_01   B     TRSLTSTA            TRANSLATE STATION                            
R04_02   B     TRSLTNMK            TRANSLATE SPILL MARKET TO ALPHA MKT          
R04_03   B     PSTDTIDX            POST DAY/TIME INDICES                        
R04_04   B     DODUMTDRB           DO DUMMY TSAR RECDS--PART (B)                
R04_05   B     PAVLOOK             PAV FILE LOOK-UP                             
R04_06   B     DMB000              APMODE=APMBREAK                              
R04_07   B     DMR000              APMODE=APMRESUM                              
R04_08   B     DEMPST              POST INFO TO BUFFER                          
R04_09   B     DMHD000             APMODE=FORMHEAD                              
R04_10   B     SEEDWHHD            SEED WEEKLY HH DEMOS                         
R04#     EQU   (*-R04_00)/4+R03#                                                
         DC    H'0'                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--TST+        
               A#)'                                                             
*------------------------- TRANSLATE STATION -------------------------*         
                                                                                
* Translates station into a printable format                                    
* At entry,                                                                     
*   MYSTAS   = book/week#/booktype                                              
*   ALPHAMKT = alpha market code                                                
* At exit,                                                                      
*   WORK     = formatted book                                                   
*   HALF     = length of formatted book                                         
                                                                                
TRSLTSTA DS    0H                                                               
         DS    0H                    CHECK FOR ANY SPILL MARKET                 
         MVI   FLDH+5,0               (ASSUME THERE IS NONE)                    
         OC    MYSTAS+5(2),MYSTAS+5     VIA NUMERIC MKT CODE                    
         BNZ   TSTA007A                                                         
         OC    ALPHAMKT,ALPHAMKT                                                
         BZ    TSTA007X                                                         
         CLC   ALFMKTS,SPACES           VIA ALPHA MKTS                          
         BE    TSTA007X                                                         
         B     TSTA007B                                                         
                                                                                
TSTA007A DS    0H                  NUMERIC CODE SPILL MARKET                    
         MVC   DUB(2),MYSTAS+5                                                  
         MVI   GOSUBN,TNMKT#                                                    
         GOTO1 AGOSUB                                                           
         LH    R1,HALF                                                          
         STC   R1,FLDH+5                                                        
         BCTR  R1,0                                                             
         EXMVC R1,FLD,WORK                                                      
         B     TSTA007X                                                         
TSTA007B DS    0H                  ALPHA CODE SPILL MARKET                      
         MVC   FLD(L'ALPHAMKT),ALPHAMKT                                         
         LA    R1,L'ALPHAMKT                                                    
         LA    RF,FLD+L'ALPHAMKT                                                
         BCTR  RF,0                                                             
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   R1,*-10                                                          
         STC   R1,FLDH+5                                                        
         B     TSTA007X                                                         
TSTA007X EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         MVC   WORK(L'SPOVSTA),SPACES  BUILD STATON OUTPUT IN  WORK             
         LA    R4,WORK                                                          
                                                                                
*                                                                               
         DS    0H                                                               
         MVC   0(4,R4),MYSTAS                                                   
         LA    R4,4(R4)                                                         
*  take out any trailing spaces and adjust length                               
         LR    RF,R4                                                            
         LA    R0,4                                                             
TSTA010  SHI   RF,1                GO BACKWARDS TO FIND LAST CHARACTER          
         CLI   0(RF),X'40'                                                      
         BNE   TSTA015                                                          
         BCT   R0,TSTA010                                                       
*                                                                               
TSTA015  DS    0H                                                               
         LA    R4,1(RF)            READJUST TO ONE PAST LAST CHAR               
*                                                                               
         CLI   DBMED,C'T'                                                       
         BE    TSTA023G                                                         
         CLI   DBMED,C'W'                                                       
         BE    TSTA023G                                                         
         CLI   DBMED,C'O'                                                       
         BE    TSTA023G                                                         
         CLI   DBMED,C'C'                                                       
         BE    TSTA023G                                                         
         B     TSTA023M                                                         
TSTA023G DS    0H                                                               
         CLI   MYSTAS+4,C'T'                                                    
         BNE   TSTA023M                                                         
         B     TSTA023X                                                         
TSTA023M DS    0H                                                               
         MVC   0(1,R4),MYSTAS+4                                                 
         LA    R4,1(R4)                                                         
TSTA023X EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                    CHECK FOR ANY SPILL MARKET                 
         ZICM  R1,FLDH+5,(1)                                                    
         BZ    TSTA027X                                                         
         MVI   0(R4),C'/'                                                       
         BCTR  R1,0                                                             
         EXMVC R1,1(R4),FLD                                                     
         LA    R4,1+1(R1,R4)                                                    
********************   MOVE IN SYCODE TO THE END                                
         CLI   DBSRC,C'N'        NSI                                            
         BE    *+8                                                              
         CLI   DBSRC,C'F'        FUSION                                         
         BNE   TSTA027X                                                         
         OC    SYSCODES,SYSCODES                                                
         BZ    TSTA027X                                                         
         LA    R1,SYSCODES                                                      
         MVI   0(R4),C'-'                                                       
         AHI   R4,1                                                             
****     MVC   0(2,R4),0(R1)                                                    
         EDIT  (B2,SYSCODES),(5,0(R4)),WRK=WORK2,ALIGN=LEFT                     
***      AHI   R4,2                                                             
         AHI   R4,5                                                             
********************                                                            
TSTA027X EQU   *                                                                
                                                                                
*                                                                               
TSTAX    DS    0H                                                               
         LA    R0,WORK                                                          
         SR    R4,R0                                                            
         STH   R4,HALF             SET LENGTH INTO HALF                         
*                                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--TNM+        
               KT#)'                                                            
*---------------------- TRANSLATE NUMERIC MARKET ---------------------*         
                                                                                
* Translates numeric market into an alpha market.  If no alpha market           
*  found, routine passes back the numeric market in printable format.           
* At entry,                                                                     
*   DUB(2)   = numeric market                                                   
* At exit,                                                                      
*   WORK     = alpha or nuermice market code                                    
*   HALF     = length of alpha or numeric market code                           
                                                                                
TRSLTNMK DS    0H                                                               
         MVC   WORK,SPACES                                                      
         XC    HALF,HALF                                                        
                                                                                
*                                                                               
         DS    0H                  ASSUME NO ALPHA MKT                          
         ZICM  R1,DUB,(3)                                                       
         LR    RE,R1                                                            
*        EDIT  (R1),(3,WORK),ALIGN=LEFT,WRK=WORK2                               
         EDIT  (R1),(4,WORK),ALIGN=LEFT,WRK=WORK2                               
         STH   R0,HALF                                                          
         STCM  RE,3,DUB            RESTORE DUB...EDIT MACRO DESTROYS IT         
                                                                                
*                                                                               
         DS    0H                                                               
         LA    R5,DBLOCK1                                                       
         USING DBLOCKD,R5          R5=A(DBLOCK)                                 
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,DBFIL                                                     
         MVC   DBAREC,AIOAREA2                                                  
         MVI   DBFUNCT,DBCNVN2A                                                 
         MVC   DBCOMFCS,AFAC                                                    
         MVC   DBBTYPE,BKS+3                                                    
         MVC   DBSELSRC,DBSRC                                                   
         MVC   DBSELBK,BKS                                                      
         MVC   DBSELMED,DBMED                                                   
         MVC   DBSELAGY,AGYALPH                                                 
         MVC   DBSELRMK,DUB                                                     
                                                                                
         GOTO1 ASETUSID                                                         
         GOTO1 VDEMAND,DMCB,DBLOCKD,0,0                                         
         CLI   DBERROR,0                                                        
         BNE   TNMKTX                                                           
*                                                                               
         OC    DBSELALF,DBSELALF                                                
         BZ    TNMKTX                                                           
         OC    DBSELALF,SPACES                                                  
         BE    TNMKTX                                                           
*                                                                               
         LA    R1,DBSELALF+L'DBSELALF-1                                         
         CLI   0(R1),C' '                                                       
         BH    *+10                                                             
         BCTR  R1,0                                                             
         B     *-10                                                             
         LA    R0,DBSELALF                                                      
         SR    R1,R0                                                            
         EXMVC R1,WORK,DBSELALF                                                 
         LA    R1,1(R1)                                                         
         STH   R1,HALF                                                          
         DROP  R5                                                               
                                                                                
*                                                                               
TNMKTX   DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--PDT+        
               I#)'                                                             
*----------------------- POST DAY/TIME INDICES -----------------------*         
                                                                                
* The whole motivation for this routine is to avoid passing down the            
*  so-called "space-fillers" down to DEM32.  For each detail record             
*  passed to DEM32, its day/time position on the report is determined           
*  by 1) the kth rotation of the request, 2) the mth component within           
*  the rotation, and 3) the nth detail of the component.                        
* What this routine does is to post the max # of details for each               
*  component in the current rotation being processed.                           
* At entry,                                                                     
*   THISDAY  = the kth rotation currently being processed                       
*   THISDAYR = the mth component within rotation                                
*   ADBLOCK  = A(DBLOCK)                                                        
                                                                                
PSTDTIDX DS    0H                                                               
         L     R5,ADBLOCK                                                       
         USING DBLOCKD,R5                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         CLI   DBERROR,0           CHECK FOR ANY ERRORS                         
         BE    *+12                                                             
         CLI   DBERROR,EOF         END-OF-FILE IS ACCEPTABLE                    
         BNE   PDTIX                                                            
                                                                                
*                                                                               
         DS    0H                                                               
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
         DROP  RF                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         LA    R3,2(R2)                                                         
         USING TSDEMRCD,R3                                                      
         MVI   TMPRCTYP,TDRRTDTI                                                
                                                                                
         MVI   GOSUBN,BTSK#        GO BUILD TSAR KEY                            
         GOTO1 AGOSUB                                                           
         MVC   TDRKEY(TDRKEYL),TSARKEY                                          
                                                                                
         MVI   GOSUBN,GADQT#                                                    
         GOTO1 AGOSUB                                                           
         L     RF,ADBDQD                                                        
         OC    0(DBDQLEN,RF),0(RF)   CHECK IF DEMAND RETURNED QHs               
         BNZ   PDTI011X               IF YES, LOOP & COUNT # QHs                
         LHI   RE,7*96                MAX # QHs FOR MEDIA=NETWORK               
         B     PDTI012X                                                         
PDTI011X EQU   *                                                                
                                                                                
         SR    RE,RE                                                            
         L     RF,ADBDQD                                                        
PDTI012  DS    0H                                                               
         CLI   0(RF),XFF                                                        
         BE    PDTI012X                                                         
         ZIC   R0,DBDQSQH-DBDQD(RF)                                             
         ZIC   R1,DBDQEQH-DBDQD(RF)                                             
         SR    R1,R0                                                            
         BNM   *+6                                                              
         DC    H'0'                                                             
         LA    RE,1(RE,R1)                                                      
         LA    RF,DBDQLEN(RF)                                                   
         B     PDTI012                                                          
PDTI012X EQU   *                                                                
         LA    RE,700                         FUDGE SO 5A-6A WORKS              
*****    LA    RE,4000    HIGH # FOR COUNTY COVERAGE                            
         STCM  RE,3,TDRMXSBI                                                    
         DROP  R3                                                               
                                                                                
         LA    R0,TDRFIXL3+2                                                    
         STCM  R0,3,0(R2)                                                       
         GOTO1 APOST                                                            
         DROP  R5                                                               
                                                                                
*                                                                               
PDTIX    DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--DDT+        
               B#)'                                                             
*----------------- DO DUMMY TSAR DEMO RECDS-PART (B) -----------------*         
                                                                                
* Goes through all combinations of this time's DAY/TIME input and               
*  creates dummy DAY/TIME INDICES records for those combinations not in         
*  the sort buffer yet.                                                         
                                                                                
DODUMTDRB DS   0H                                                               
         CLI   ACTN,DEMOPER        FOR ACTION=PERIOD,                           
         BE    DDTBX                NO DUMMY RECORDS NEEDED                     
                                                                                
*                                                                               
         DS    0H                                                               
         LA    R6,DBLOCK1          INITIALIZE DBLOCK                            
         USING DBLOCKD,R6                                                       
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBFILE,DBFIL                                                     
         MVC   DBAREC,AIOAREA                                                   
         MVI   DBFUNCT,DBGETDEM                                                 
         MVC   DBCOMFCS,AFAC                                                    
         MVC   DBSELSRC,DBSRC                                                   
         MVC   DBSELMED,DBMED                                                   
         MVC   DBSELAGY,AGYALPH                                                 
         MVC   DBSELSTA,STAS                                                    
         MVC   DBSELBK,BKS                                                      
         MVC   DBBTYPE,BKS+3                                                    
                                                                                
*                                                                               
         DS    0H                  NEED LONGER DAYS/QHS TABLE                   
         CLI   DBMED,C'T'           FOR MEDIA=USTV                              
*&&DO                                                                           
         BNE   DDTDQX                                                           
*&&                                                                             
         BNE   DDTBDQX                                                          
         CLI   DBSRC,C'N'           FOR SOURCE=NSI                              
*&&DO                                                                           
         BNE   DDTDQX                                                           
*&&                                                                             
         BNE   DDTBDQX                                                          
         CLC   DBFIL,=C'TP '        FOR TP FILE                                 
*&&DO                                                                           
         BNE   DDTDQX                                                           
*&&                                                                             
         BNE   DDTBDQX                                                          
                                                                                
         MVC   DUB+0(4),=C'DBD3'                                                
         LA    RE,DBXTDQT                                                       
         ST    RE,DUB+4                                                         
         XC    0(DBXTDQTL,RE),0(RE)                                             
         MVI   SDBXF,C'D'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
*&&DO                                                                           
DDTDQX   EQU   *                                                                
*&&                                                                             
DDTBDQX  EQU   *                                                                
                                                                                
         MVI   THISDAY,0                                                        
         LA    R2,DAYS-L'DAYS                                                   
                                                                                
*                                                                               
DDTB12   DS    0H                                                               
         ZIC   R1,THISDAY                                                       
         LA    R1,1(R1)                                                         
         STC   R1,THISDAY                                                       
         LA    R2,L'DAYS(R2)                                                    
         CLC   THISDAY,NDAYS                                                    
         BH    DDTB70                                                           
                                                                                
         MVI   THISDAYR,1          ASSUME NO ROTATION                           
         NI    MYFLAG1,XFF-MYF1DTRO                                             
*                                                                               
         DS    0H                  CHECK FOR ROTATIONS                          
         MVC   DUB(L'DAYS),0(R2)    ASSUME IT'S NOT A ROTATION                  
         CLC   0(3,R2),=C'ROT'                                                  
         BNE   DDTB16R                                                          
         OI    MYFLAG1,MYF1DTRO     IT IS A ROTATION                            
                                                                                
DDTB16M  DS    0H                   R2-->CURRENT DAY/TIME ENTRY                 
         ZICM  RF,3(R2),(3)                                                     
         LA    RF,LDTROTN(RF)        RF = A(COMPONENTS OF ROTATION) - 1         
         ZIC   R1,THISDAYR           PICK UP COMPONENT COUNTER                  
         BCTR  R1,0                                                             
         MH    R1,=Y(L'DAYS)         GET DISPLACEMENT TO COMPONENT              
         LA    R1,1(R1)                                                         
         AR    RF,R1                 RF-->COMPONENT TO PROCESS NOW              
         MVC   DUB(L'DAYS),0(RF)                                                
DDTB16R  EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  SEE IF DAY/TIME INDEX RECORD POSTED          
         XC    TSARKEY,TSARKEY      BUILD TSAR DEMO RECD KEY                    
         LA    R3,TSARKEY                                                       
         USING TSDEMRCD,R3                                                      
         MVI   TDRRCTYP,TDRRTDTI                                                
*                                                                               
         ZICM  RF,THISDAY,(1)                                                   
         BZ    DDTB36                                                           
         LH    RE,DSPRCTDT                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DDTB36   STC   RF,TDRDAY            DAY/TIME NUMBER                             
*                                                                               
         DS    0H                                                               
         MVC   TDRDAYR,THISDAYR     COMPONENT NUMBER                            
         DROP  R3                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         GOTO1 AGETTDR              GO GET TSAR DEMO RECORD                     
         BE    DDTB049              RECORD ALREADY EXISTS                       
*                                                                               
         DS    0H                   RECORD JUST ADDED TO TSAR BUFFER            
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  RE,TSAREC+1,(7)                                                  
         DROP  RF                                                               
*                                                                               
         DS    0H                  RESET DBLOCK FOR ANOTHER DEMAND CALL         
         MVC   DBSELDAY,DUB+0       SET DAY                                     
         MVC   DBSELTIM,DUB+1        AND TIMES FOR DEMAND CALL                  
         MVI   DBERROR,0                                                        
         MVI   DBDQPTR,0                                                        
         XC    DBLASTS,DBLASTS                                                  
         XC    DBDQTAB,DBDQTAB                                                  
         XC    DBACTUAL,DBACTUAL                                                
         LA    RF,DBXTDQT+8                    CLEAR DBD3 AREA                  
         XC    0(DBXTDQTL-8,RF),0(RF)           BEFORE DEMAND CALL              
                                                                                
         DS    0H                   HAVE DAY/TIME COMBO                         
*&&DO                                                                           
         GOTO1 VDEMAND,DMCB,DBLOCKD,0,0,0,0,0                                   
*&&                                                                             
         NI    MYFLAG1,XFF-MYF1TRUE                                             
         GOTO1 ASETUSID                                                         
         GOTO1 VDEMAND,DMCB,DBLOCKD,0,C'*IO*',DDTBTRC,0,0                       
         CLI   DBERROR,EOF           NEED TO HAVE THIS ERROR CODE,              
         BNE   DDTB049                ELSE, SKIP POSTING D/T INDICES            
         TM    MYFLAG1,MYF1TRUE      IF D/T INDCES POSTED IN TRACE RTN,         
         BO    DDTB049                DON'T POST THEM AGAIN                     
*                                                                               
         DS    0H                                                               
         LA    R0,DBLOCKD                                                       
         ST    R0,ADBLOCK                                                       
         MVI   DBERROR,0                                                        
         MVI   GOSUBN,PDTI#                                                     
         GOTO1 AGOSUB                                                           
DDTB049  EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         TM    MYFLAG1,MYF1DTRO     CHECK FIRST IF IT'S A ROTATION              
         BZ    DDTB59                                                           
         ZICM  RF,3(R2),(3)         IT IS A ROTATION                            
         LA    RF,LDTROTN(RF)       RF-->L(STORAGE SPACE FOR COMPNENTS)         
         ZIC   R1,THISDAYR          PICK UP COMPONENT COUNTER                   
         LA    RE,1(R1)              INCREMENT AND REMEMBER IT                  
         MH    R1,=Y(L'DAYS)        GET DISPLACEMENT TO NEXT COMPONENT          
         LA    R1,1(R1)              ADJUST FOR HEADER BYTE                     
         CLM   R1,1,0(RF)           DONE W/ ALL COMPONENTS?                     
         BNL   *+12                  YEP, KEEP PLUNGING AHEAD                   
         STC   RE,THISDAYR           NO, UPDATE COMPONENT COUNTER               
         B     DDTB16M                AND GO BACK & PROCESS NEXT ONE            
DDTB59   EQU   *                                                                
         B     DDTB12               GO BACK AND DO NEXT DAY/TIME                
                                                                                
*                                                                               
DDTB70   DS    0H                                                               
         B     DDTBX                                                            
                                                                                
*                                                                               
DDTBX    DS    0H                                                               
         J     EXIT                                                             
         EJECT                                                                  
* DEMAND trace routine.  Its purpose is to provide an "inner road"              
*  within a DEMAND call to pull the QHs for day/time indices.  There            
*  are times when DEMAND clears out the QHs before exiting.                     
* At entry,                                                                     
*  R6-->DBLOCK                                                                  
                                                                                
DDTBTRC  NTR1                                                                   
         USING DBLOCKD,R6                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         ST    R6,ADBLOCK                                                       
         MVI   GOSUBN,GADQT#                                                    
         GOTO1 AGOSUB                                                           
         L     RF,ADBDQD                                                        
         OC    0(DBDQLEN,RF),0(RF)   IS THERE ANY QHs?                          
         BZ    DDTBTRCX               NOPE, NOTHING TO GET                      
*                                                                               
         TM    MYFLAG1,MYF1TRUE      DID WE GET QHs YET?                        
         BNZ   DDTBTRCX               YEP                                       
*                                                                               
         DS    0H                                                               
         ST    R6,ADBLOCK                                                       
         MVI   GOSUBN,PDTI#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         OI    MYFLAG1,MYF1TRUE      WE GOT QHs!!                               
                                                                                
*                                                                               
DDTBTRCX DS    0H                                                               
         J     YES                                                              
         DROP  R6                                                               
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--PVL+        
               K#)'                                                             
*----------------------------- PAV LOOKUP ----------------------------*         
                                                                                
PAVLOOK  DS    0H                                                               
         LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
*                                                                               
         DS    0H                 CLEAR DBLOCK                                  
         LR    R0,R6               R0-->DESTINATION                             
         LA    R1,DBLOCK1X-DBLOCK1 R1 = L(DESTINATION)                          
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
                                                                                
         L     R0,AIOAREA2         R0-->DESTINATION                             
         LR    R5,R0                                                            
         LH    R1,LIOAREA2         R1 = L(DESTINATION)                          
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE               CLEAR BUFFER FOR ACCUMULATING RECDS          
         MVI   0(R5),RINVKTYQ       AND MAKE IT AN INVENTORY RECD               
                                                                                
*                                                                               
         DS    0H                 BUILD DBLOCK                                  
         ST    R6,ADBLOCK                                                       
         MVI   GOSUBN,BDB#                                                      
         GOTO1 AGOSUB                                                           
*                                                                               
         CLI   DBSELMED,C'N'                                                    
         BNE   *+8                                                              
         CLI   DBSELSRC,C'C'                                                    
         BNE   *+8                                                              
         MVI   DBFUNCT,DBGETDEM                                                 
*                                                                               
         NI    MYFLAG1,XFF-MYF1RDOK                                             
         GOTO1 ASETUSID                                                         
         CLI   DBMED,C'U'            COUNTY COVERAGE                            
         BE    PVLK050                                                          
         GOTO1 VDEMAND,DMCB,DBLOCK,PAVLKHK,0                                    
         B     PVLK060                                                          
PVLK050  DS    0H                                                               
         OC    DBSELMK,DBSELMK                                                  
         BNZ   PVLK054                                                          
         MVI   FERN,164              COUNTY NUMBER REQUIRED                     
         MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
PVLK054  GOTO1 VDEMAND,DMCB,DBLOCK,CUNLKHK,0                                    
****     B     PVLK143X                                                         
         B     PVLK149                                                          
                                                                                
PVLK060  TM    MYFLAG1,MYF1RDOK                                                 
         BZ    PVLK149                                                          
                                                                                
*                                                                               
** PROCESS CUMULATIVE RECORD **                                                 
*                                                                               
         DS    0H                  UNWEIGH RECORD                               
         TM    MISCFLG1,MF1WHHD                                                 
         BZ    PVLK110                                                          
*                                                                               
         LA    R5,CUMWHH                                                        
         ZICM  R0,DBDIVSOR,(3)                                                  
         JZ    EXIT                                                             
         ST    R0,DIVISOR                                                       
PVLK105  LA    R0,CUMWHHX                                                       
         CR    R5,R0                                                            
         BNL   PVLK130                                                          
         SR    RE,RE                                                            
         L     RF,0(R5)                 CUMULATED DEMO VALUE                    
         STM   RE,RF,DIVIDEND                                                   
         MVI   GOSUBN,DIV#                                                      
         GOTO1 AGOSUB                                                           
         MVC   0(4,R5),QUOTIENT                                                 
         LA    R5,4(R5)                                                         
         LA    R1,4(R1)                                                         
         B     PVLK105                                                          
                                                                                
*                                                                               
PVLK110  DS    0H                                                               
         ST    R6,MTHCFACS                                                      
         MVC   MTHFCTR,CUMFCTR                                                  
*                                                                               
         MVC   MTHIFIL,=C'INV'                                                  
         MVC   MTHOFIL,=C'INV'                                                  
         MVC   MTHOSRC,=C'NSI'                                                  
                                                                                
         L     RF,AFAC                                                          
         L     RF,(CDEMOMTH-COMFACSD)(RF)                                       
         GOTO1 (RF),DMCB,=C'DIVIDE',AIOAREA2,AIOAREA2,MATHFAC                   
         DROP  R6                                                               
                                                                                
*                                                                               
         DS    0H                  EXTRACT DEMO VALUES                          
*                                                                               
* 2 DECIMAL CODE                                                                
*^^TEST                                                                         
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
*^^EOTEST                                                                       
* END OF 2 DECIMAL CODE                                                         
*                                                                               
         L     R5,AIOAREA2                                                      
         LA    R0,DEMODEMS                                                      
         ST    R0,ADEMLIST                                                      
         MVI   GOSUBN,XDV#                                                      
         GOTO1 AGOSUB                                                           
*                                                                               
         DS    0H                  SEED WKLY HH DEMOS INTO "MAIN" DEMOS         
         LA    R0,CUMWHH                                                        
         ST    R0,AFRDMVL           SET A("FROM" DEMO VALUES)                   
         LA    R0,THISDEMS                                                      
         ST    R0,ATODMVL           SET A("TO" DEMO VALUES)                     
         MVI   GOSUBN,SWHH#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
PVLK130  DS    0H                                                               
         CLI   ACTN,DEMOPER        IF ACTION=PERIOD,                            
         BE    PVLK143X             POST SUMMARY LINE                           
         CLC   0(3,R2),=C'ROT'     IF THIS IS A ROTATION,                       
         BE    PVLK143X             POST SUMMARY LINE                           
         B     PVLK149                                                          
PVLK143X EQU   *                                                                
                                                                                
         MVI   RECTYPE,TDRRTDMV                                                 
         MVC   THISPROG,CUMPNAM1                                                
         CLC   CUMPNAM1,CUMPNAM2                                                
         BE    *+14                                                             
         MVI   THISPROG+(L'THISPROG/2),C'/'                                     
         MVC   THISPROG+((L'THISPROG/2)+1)((L'THISPROG/2)-1),CUMPNAM2           
         MVC   THISWKS,CUMWKS                                                   
         MVC   THISPURE,=X'FFFF'                                                
         MVI   THISLBK,X'9C'       FORCE HIGHEST (PACKED) LATEST BK #           
         MVI   THISDAYR,XFF        FORCE HIGHEST DAY # W/IN ROTATION            
         MVC   THISKDAY,THISDAY                                                 
         XI    THISKDAY,XFF                                                     
         MVI   THISSQH,XFF                                                      
         MVI   THISEQH,XFF                                                      
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
PVLK149  EQU   *                                                                
                                                                                
*                                                                               
PVLKX    DS    0H                                                               
         J     EXIT                                                             
         EJECT                                                                  
*-------------------------- PAV DEMAND HOOK --------------------------*         
                                                                                
* At entry,                                                                     
*   R2-->requested day/time entry,                                              
*   R3-->requested book entry,                                                  
*   R4-->requested station entry.                                               
                                                                                
PAVLKHK  NTR1                                                                   
         MVI   GOSUBN,PVHK#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         DS    0H                                                               
         J     EXIT                                                             
*-------------------------- CUN DEMAND HOOK --------------------------*         
                                                                                
* At entry,                                                                     
*   R2-->requested day/time entry,                                              
*   R3-->requested book entry,                                                  
*   R4-->requested station entry.                                               
                                                                                
CUNLKHK  NTR1                                                                   
         MVI   GOSUBN,CUNHK#                                                    
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--DMB+        
               #)'                                                              
*------------------ ACTUAL CODE FOR APMODE=APMBREAK ------------------*         
                                                                                
DMB000   DS    0H                                                               
         DS    0H                  SEE WHO CALLED FOR A BREAK                   
         TM    BRKFLAG1,BF1FALNK    FALINK?                                     
         BO    DMBRKF                YEP                                        
         TM    BRKFLAG1,BF1APPLC    APPLICATION?                                
         BO    DMBRKA                YEP                                        
         B     DMBRKX                                                           
                                                                                
                                                                                
*                                                                               
** BREAK CALLED BY FALINK **                                                    
*                                                                               
DMBRKF   DS    0H                                                               
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         MVC   AS2EMPC,FALEMPC                                                  
         MVC   AS2DMPC,FALDMPC                                                  
         MVC   AS2STMOD,STMODE                                                  
         MVI   AS2DEMON,0          THIS WILL GET SET LATER, IF NEEDED           
         DROP  RF                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         BE    DMBRKXE                                                          
                                                                                
                                                                                
*                                                                               
** BREAK CALLED BY APPLICATION **                                               
*                                                                               
DMBRKA   DS    0H                                                               
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         MVC   AS2THSST,THISSTA                                                 
         MVC   AS2THSBK,THISBK                                                  
         MVC   AS2THSDY,THISDAY                                                 
         DROP  RF                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         B     DMBRKXE                                                          
                                                                                
*                                                                               
DMBRKX   DS    0H                                                               
         J     EXIT                                                             
*                                                                               
DMBRKXL  DS    0H                                                               
         J     EXITL                                                            
*                                                                               
DMBRKXE  DS    0H                                                               
         J     EXITE                                                            
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--DMR+        
               #)'                                                              
*------------------ ACTUAL CODE FOR APMODE=APMRESUM ------------------*         
                                                                                
DMR000   DS    0H                                                               
         TM    RSMFLAG1,RF1APPLC   RESUMING FOR APPLIC BREAK?                   
         BO    DMRSMA               YEP                                         
         TM    RSMFLAG1,RF1FALNK   RESUMING FOR FALINK BREAK?                   
         BO    DMRSMF               YEP                                         
         B     DMRSMX                                                           
                                                                                
                                                                                
*                                                                               
** RESUME NEEDED FOR APPLICATION BREAK **                                       
*                                                                               
DMRSMA   DS    0H                                                               
         L     R6,AAPSAV2                                                       
         USING APSAV2D,R6                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         OI    AS2RSMF,AS2RFAPP                                                 
*                                                                               
         DS    0H                                                               
         CLI   AS2STMOD,STMOUTQ                                                 
         BE    DMRSMAO                                                          
         B     DMRSMAX                                                          
                                                                                
*                                                                               
*** STMODE=STMOUTQ WHEN BREAK CALLED BY APPLIC ***                              
*                                                                               
DMRSMAO  DS    0H                                                               
         MVI   RESUMAPP,C'Y'                                                    
         B     DMRSMAX                                                          
                                                                                
         DROP  R6                                                               
                                                                                
*                                                                               
DMRSMAX  DS    0H                                                               
         B     DMRSMX                                                           
                                                                                
                                                                                
*                                                                               
** RESUME CALLED BY FALINK **                                                   
*                                                                               
DMRSMF   DS    0H                                                               
         L     R6,AAPSAV2                                                       
         USING APSAV2D,R6                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         CLI   AS2STMOD,STMOUTQ                                                 
         BE    DMRSMFO                                                          
         B     DMRSMFX                                                          
                                                                                
*                                                                               
*** STMODE=STMOUTQ WHEN BREAK CALLED BY FALINK ***                              
*                                                                               
DMRSMFO  DS    0H                                                               
         OI    AS2RSMF,AS2RFFLK                                                 
         DROP  R6                                                               
                                                                                
*                                                                               
DMRSMFX  DS    0H                                                               
         B     DMRSMX                                                           
                                                                                
                                                                                
*                                                                               
** EXIT RESUME TASKS **                                                         
*                                                                               
DMRSMX   DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--DPS+        
               T#)'                                                             
*----------- BUILD BINSRCH RECORD & CALL ROOT POST ROUTINE -----------*         
                                                                                
DEMPST   DS    0H                                                               
         TM    DEMFLAG1,DF1STERO   IS THIS A STEREO SESSION?                    
         BO    DMPOST50             YES, POST DIFFERENTLY                       
                                                                                
         LA    R1,POSTLINE                                                      
         USING BINRECD,R1                                                       
*                                  BUILD BINSRCH KEY                            
         MVC   BINKEY(BINKEYL),THISKEY                                          
         MVC   TMPSQH(2),BINSQH     GET START & END QHS                         
         MVI   GOSUBN,ADJQH#         AND ADJUST THEM                            
         GOTO1 AGOSUB                                                           
         MVC   BINSQH(2),TMPSQH                                                 
*                                                                               
         DS    0H                                                               
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BZ    *+14                                                             
         MVC   BINSTA,BINBK         SWAP THE ORDER OF STATIONS                  
         MVI   BINBK,1              AND BOOKS                                   
*                                  BUILD RECORD DATA                            
         MVC   BINPROG,THISPROG                                                 
         MVC   BINBOOK,THISBOOK                                                 
         MVC   BINPNUM,THISPNUM                                                 
         MVC   BINPURE,THISPURE                                                 
         MVC   BINWKS,THISWKS                                                   
         MVC   BINNWK,THISNWK                                                   
         MVC   BINNQH,THISNQH                                                   
         MVC   BINNDAYS,THISNDYS                                                
         MVC   BINQHAF,THISQHAF                                                 
         MVC   BINFLAG1,THISFLG1                                                
         MVC   BINDEC,THISDEC                                                   
         MVC   BINSRC,THISSRC                                                   
*                                  IN THE HOOK                                  
         SR    R2,R2               R2=LINE TYPE                                 
         LA    R3,1                R3=LINE COUNTER                              
         CLI   ACTN,DEMOAVL                                                     
         BNE   *+8                                                              
         LA    R3,3                THREE RECORDS FOR AVAIL FORMAT               
         LA    R4,THISDEMS         R4=A(DEMO VALUES)                            
DEMPOST2 STC   R2,BINTYPE                                                       
         LA    RE,BINDEMS                                                       
         ZIC   R0,NDEMS                                                         
DEMPOST4 MVC   0(3,RE),1(R4)                                                    
         LA    RE,3(RE)                                                         
         LA    R4,4(R4)                                                         
         BCT   R0,DEMPOST4                                                      
         GOTO1 APOST               GO ADD RECORD TO BINSRCH BUFFER              
         LA    R2,1(R2)                                                         
         BCT   R3,DEMPOST2                                                      
         J     EXITE                                                            
         DROP  R1                                                               
         EJECT                                                                  
*                                                                               
** THIS CODE FOR STEREO POSTING **                                              
*                                                                               
DMPOST50 DS    0H                                                               
         CLI   RECTYPE,TDRRTDMV    IF POSTING DEMO VALUES, CHECK                
         BNE   *+20                                                             
         TM    MYFLAG1,MYF1LNBK     IF THIS IS A LATEST N BK RQST,              
         BZ    *+12                                                             
         CLI   THISLBK,X'9C'         ONLY POST THE SUMMARY ONE                  
         JNE   EXITE                                                            
                                                                                
         XC    TSARKEY,TSARKEY                                                  
         LA    R1,TSARKEY                                                       
         USING TSDEMRCD,R1                                                      
         MVC   TDRRCTYP,RECTYPE                                                 
                                                                                
         ZICM  RF,THISSTA,(1)                                                   
         BZ    DMPST51C                                                         
         LH    RE,DSPRCTST                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DMPST51C STC   RF,TDRSTA                                                        
                                                                                
         ZICM  RF,THISBK,(1)                                                    
         BZ    DMPST52C                                                         
         LH    RE,DSPRCTBK                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DMPST52C STC   RF,TDRBK                                                         
                                                                                
         ZICM  RF,THISDAY,(1)                                                   
         BZ    DMPST53C                                                         
         LH    RE,DSPRCTDT                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
DMPST53C STC   RF,TDRDAY                                                        
                                                                                
         MVC   TMPSQH(2),THISSQH    GET START & END QHS                         
         MVI   GOSUBN,ADJQH#         AND ADJUST THEM                            
         GOTO1 AGOSUB                                                           
                                                                                
         MVC   TDRDAYR,THISDAYR                                                 
         CLC   DBFIL,=C'PAV'                                                    
         BNE   DMPST55G                                                         
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   DMPST55G                                                         
         MVC   TDRK2PUR,THISPURE                                                
         MVC   TDRK2NOR,THISNOR                                                 
         MVC   TDRK2KDY,THISKDAY                                                
         MVC   TDRK2SQH,TMPSQH                                                  
         MVC   TDRK2EQH,TMPEQH                                                  
         MVC   TDRK21WK,THIS1WK                                                 
**       MVC   TDRK2SPR,0                                                       
         MVI   TDRK2SPR,0                                                       
         B     DMPST55X                                                         
DMPST55G DS    0H                                                               
         MVC   TDRKDAY,THISKDAY                                                 
         MVC   TDRSQH,TMPSQH                                                    
         MVC   TDREQH,TMPEQH                                                    
         MVC   TDRTYPE,THISTYPE                                                 
         MVC   TDR1WK,THIS1WK                                                   
         MVC   TDRNOR,THISNOR                                                   
         MVC   TDRASQC,THISASQC                                                 
         MVC   TDRAEQC,THISAEQC                                                 
         B     DMPST55X                                                         
DMPST55X EQU   *                                                                
         DROP  R1                                                               
         GOTO1 AGETTDR             GO GET TSAR DEMO RECORD                      
         BE    DMPOST60                                                         
                                                                                
         DS    0H                  RECORD JUST ADDED TO TSAR BUFFER             
         LA    RF,TSARBLCK                                                      
         USING TSARD,RF                                                         
         ZICM  R1,TSAREC+1,(7)                                                  
         DROP  RF                                                               
         LA    R1,2(R1)                                                         
         USING TSDEMRCD,R1                                                      
         CLI   TDRRCTYP,TDRRTDML   IS THIS RECD TO CONTAIN DEMOS?               
         BE    DMPOST60             YES                                         
         DROP  R1                                                               
                                                                                
         CLC   DBFIL,=C'PAV'        NO, AND IF PAV FILE                         
         BNE   DMPOST60                                                         
         TM    DEMFLAG1,DF1STERO+DF1DEM32   AND NOT A DEM32 SESSION,            
         BO    DMPOST60                                                         
         MVI   GOSUBN,DTL#           PROCSS A DAY/TIME LST (FOR STEREO)         
         GOTO1 AGOSUB                                                           
*                                                                               
DMPOST60 DS    0H                                                               
         LH    R2,DSPRCTDM         WANT THE DEMOS ENTRY                         
         LA    R2,REQCTLTB(R2)                                                  
         USING RCTDSECT,R2                                                      
                                                                                
         L     RE,ASTDMEXP                                                      
         ZIC   RF,0(RE)            RF = TOTAL # OF DEMOS TO PROCESS             
         ZIC   R0,NDEMS                                                         
         SR    RF,R0                                                            
         STC   RF,DEMOFROM                                                      
         ZIC   RF,RCTUPTO                                                       
         STC   RF,DEMOUPTO                                                      
         DROP  R2                                                               
*                                                                               
DMPOST70 DS    0H                                                               
         LA    R4,TSARBLCK                                                      
         USING TSARD,R4                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
         LA    R3,2(R2)                                                         
         USING TSDEMRCD,R3                                                      
                                                                                
         DS    0H                                                               
         MVC   TDRFLAG1,THISFLG1   TRANSFER FLAG INTO RECORD                    
         MVC   TDRWKS,THISWKS      MOVE ACTIVE WEEKS INTO RECORD                
         MVC   TDRDTSBI,THISDTSI   MOVE DAY/TIME SUB-INDEX  INTO RECORD         
         MVC   TDRNDAYS,THISNDYS   MOVE NUMBER OF DAYS INTO RECORD              
         MVC   TDRQHAF,THISQHAF    MOVE QH ADJUSTMENT FACTOR INTO RECD          
         MVC   TDRDEC,THISDEC      POST THE FLAG IF 2 DEC IS SET                
* NEW MOVE IN AFFILIATION AND MKTNAME INFO                                      
***      MVC   TDRAFFL(3),=C'N/A'                                               
         MVC   TDRAFFL,THISAFFL                                                 
*&&DO                                                                           
         MVC   TDRINDX,SVINDEX     MOVE THE INDEX IN                            
         CLI   OPTDMA,C'I'        DMA=R INDEX DOESNT CHANGE                     
         BNE   DMPST70B                                                         
         L     RE,SVINDEX                                                       
         AHI   RE,-1                                                            
         ST    RE,SVINDEX                                                       
*&&                                                                             
                                                                                
DMPST70B DS    0H                  MOVE PROGRAM NAME INTO RECORD,               
         MVC   TDRPROG,SPACES                                                   
         LA    R0,L'TDRPROG                                                     
         LA    RE,TDRPROG                                                       
         LA    RF,THISPROG                                                      
DMPOST71 CLI   0(RF),STSPIFLD       REMOVING ALL FIELD SEPARATORS               
         BE    *+14                                                             
         MVC   0(1,RE),0(RF)                                                    
         LA    RE,1(RE)                                                         
         LA    RF,1(RF)                                                         
         BCT   R0,DMPOST71                                                      
                                                                                
         MVC   TDRPDUR,THISNQH                                                  
         MVC   TDRPTYP,THISPTYP                                                 
         MVC   TDRPURE,THISPURE                                                 
                                                                                
         DS    0H                  APPEND DATA ONTO RECORD                      
         ZIC   RE,DEMOFROM                                                      
         MH    RE,=Y(L'TDRDEMS)                                                 
         LA    RE,TDRDEMS(RE)      RE-->NXT PLACE TO PUT DEMOS                  
                                                                                
         LA    RF,THISDEMS         ASSUME POSTING FOR DEMO VALUES               
         CLI   RECTYPE,TDRRTDML                                                 
         BNE   *+8                                                              
         LA    RF,DEMS              POSTING DEMO EXPRESSIONS                    
                                                                                
         ZIC   R0,NDEMS            R0=# OF DATA VALUES TO APPEND                
DMPOST74 CLI   RECTYPE,TDRRTDML    IF POSTING DEMO VALUES,                      
         BE    *+8                                                              
         LA    RF,1(RF)             BUMP SOURCE BY ONE BYTE                     
         MVC   0(L'TDRDEMS,RE),0(RF)                                            
         LA    RE,L'TDRDEMS(RE)    RE-->NEW END OF TSAR DEMO RECORD             
         LA    RF,3(RF)            RF-->NEXT SOURCE                             
         BCT   R0,DMPOST74                                                      
                                                                                
         CLI   RECTYPE,TDRRTDML    AND IF POSTING DEMO EXPRESSIONS,             
         BNE   *+12                                                             
         MVI   0(RE),XFF            MOVE IN END-OF-LIST DELIMITER               
         LA    RE,1(RE)                                                         
                                                                                
         SR    RE,R2               RE=NEW L(TSAR DEMO RECORD)                   
         STH   RE,0(R2)                                                         
         GOTO1 APOST                                                            
         DROP  R3,R4                                                            
                                                                                
         J     EXITE                                                            
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--DMH+        
               D#)'                                                             
*-------------------------- APMODE=FORMHEAD --------------------------*         
                                                                                
DMHD000  DS    0H                                                               
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BO    DMHD010              GO TO STEREO LOGIC                          
                                                                                
         LA    R1,STAWIDTH                                                      
         SR    R0,R0                                                            
         ZIC   RE,NSTAS                                                         
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BZ    *+8                                                              
         LA    RE,4                 FORCE # OF STATIONS TO BE 4                 
         DR    R0,RE                                                            
         STH   R1,CHUNKLEN         CHUNKLEN=L'STATION CHUNK                     
         IC    R1,NDEMS                                                         
         LA    RE,DEMWIDTH                                                      
         MR    R0,RE                                                            
         BCTR  R1,0                                                             
         STH   R1,HEADLEN          HEADLEN=L'STATION HEADING                    
         BCTR  R1,0                                                             
         BCTR  R1,0                                                             
         STH   R1,EXECLEN          EXECLEN=L'STATION HEADING-2                  
         LH    R1,HEADLEN                                                       
         LA    R0,L'STASTA                                                      
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BZ    *+8                                                              
         LA    R0,L'STASTA+2        ALLOW FOR DISPLAYING WEEK #                 
         SR    R1,R0                                                            
         SRL   R1,1                                                             
         STH   R1,STADISP          STADISP=DISP. TO STATION IN HEADING          
*                                                                               
         LA    R2,DEMHD1+15        R2=A(START OF STATION HEADINGS)              
         LA    R4,DBSTABK                                                       
         USING STABKD,R4           R4=A(STATION/BOOK TABLE)                     
         ZIC   R3,NSTAS            R3=N'STATION/BOOK TABLE ENTRIES              
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BZ    *+8                                                              
         LA    R3,4                 FORCE # OF STATIONS TO BE 4                 
         LA    R5,DATADISP         R5=A(DISPLACEMENT TABLE)                     
*                                                                               
DMHD002  LR    R0,R2               CALCULATE DATA DISPLACEMENT                  
         LA    R1,DEMHD1                                                        
         SR    R0,R1                                                            
         STH   R0,0(R5)            SET DATA DISPLACEMENT                        
         MVI   0(R2),C'-'                                                       
         LH    R1,EXECLEN                                                       
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   1(0,R2),0(R2)       FILL HEADLINE WITH DASHES                    
         LR    R1,R2                                                            
         AH    R1,STADISP          CENTRALIZE STATION IN HEADING                
         MVC   0(L'STASTA,R1),STASTA                                            
         CLI   DBMED,C'N'          BYPASS FOR NETWORK                           
         BE    *+16                                                             
         CLI   4(R1),C'T'          TEST PARENT STATION                          
         BNE   *+8                                                              
         MVI   4(R1),C'-'          YES DON'T SHOW THE 'T'                       
         CLI   3(R1),C' '          TEST 3 BYTE STATION NAME                     
         BNE   *+8                                                              
         MVI   3(R1),C'-'                                                       
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BZ    *+18                                                             
         LA    R0,5                                                             
         SR    R0,R3                                                            
         STC   R0,6(R1)                                                         
         OI    6(R1),X'F0'          PUT WEEK NUMBER IN AS WELL                  
*                                  MOVE DEMO NAMES UNDER HEADING                
         LA    RE,L'DEMHD1H+L'DEMHD1(R2)                                        
         LA    RF,L'DEMHD1H+L'DEMHD1(RE)                                        
         LA    R1,DEMOUT75                                                      
         ZIC   R0,NDEMS                                                         
DMHD004  MVC   0(7,RE),0(R1)                                                    
         MVC   1(5,RF),7(R1)                                                    
         LA    RE,DEMWIDTH(RE)                                                  
         LA    RF,DEMWIDTH(RF)                                                  
         LA    R1,L'DEMOUT75(R1)                                                
         BCT   R0,DMHD004                                                       
*                                  BUMP TO NEXT STATION                         
         AH    R2,CHUNKLEN         ADD CHUNK LENGTH                             
         TM    MISCFLG1,MF1WKACR   IF DISPLAYING WEEKS ACROSS SCREEN,           
         BO    *+8                  DON'T BUMP STATION POINTER                  
         LA    R4,STABKL(R4)                                                    
         LA    R5,2(R5)                                                         
         BCT   R3,DMHD002          DO FOR N'STATIONS                            
         MVC   DEMHD1(3),DEMSRC                                                 
         MVC   DEMHD2(L'HEADDAY1),HEADDAY1                                      
         MVC   DEMHD3(L'HEADDAY2),HEADDAY2                                      
         DROP  R4                                                               
*                                                                               
         LA    RE,BINKEYL                                                       
         ST    RE,BINLKEY          SET L'BINSRCH TABLE KEY                      
         ZIC   R1,NDEMS                                                         
         LA    R0,L'BINDEMS                                                     
         MR    R0,R0               R1=L'DEMO ACCUMULATORS                       
         LA    R1,BINFXDTL(R1,RE)                                               
         ST    R1,BINLREC          SET TOTAL BINSRCH RECORD LENGTH              
*                                  SET ACTUAL DEMOS TO LOOK-UP                  
         MVC   DEMONDEM,NDEMS                                                   
         ZIC   R1,DEMONDEM                                                      
         LA    R0,L'DEMS                                                        
         MR    R0,R0                                                            
         EX    R1,*+8                                                           
         B     *+10                                                             
         MVC   DEMODEMS(0),DEMS                                                 
         CLI   OPTUPFIL,0          TEST FOR UPGRADE REQUIRED                    
         BNE   *+12                FORCE EXTENDED LOOKUP FOR SHARES             
         CLI   ACTN,DEMOAVL        AVAIL FORMAT ALWAYS REQUIRES                 
         BNE   DMHDX               EXTENDED DEMO LIST                           
*                                  BUILD EXTENDED AVAIL LOOK-UP LIST            
         ZIC   R0,DEMONDEM                                                      
         LR    RE,R0                                                            
         MH    RE,=H'3'                                                         
         STC   RE,DEMONDEM                                                      
         LA    RE,DEMODEMS(R1)                                                  
         LA    RF,0(R1,RE)                                                      
         LA    R1,DEMS                                                          
DMHD006  MVC   0(3,RE),0(R1)                                                    
         MVC   0(3,RF),0(R1)                                                    
         MVI   1(RE),C'S'          SHARE MODIFIER                               
         MVI   1(RF),C'P'          PUT MODIFIER                                 
         CLI   1(R1),C'R'          TEST RATINGS DEMO                            
         BE    *+12                                                             
         MVI   1(RE),C'X'          TSA SHARE MODIFIER                           
         MVI   1(RF),C'Q'          TSA TOTAL MODIFIER                           
         LA    R1,3(R1)                                                         
         LA    RE,3(RE)                                                         
         LA    RF,3(RF)                                                         
         BCT   R0,DMHD006                                                       
         MVI   0(RF),X'FF'                                                      
         B     DMHDX                                                            
                                                                                
*                                                                               
DMHD010  DS    0H                  THIS PART FOR STEREO SESSION ONLY            
         LA    R2,TSARBLCK                                                      
         USING TSARD,R2                                                         
         CLI   TSKEYL,0            SEE IF WE NEED TO SET LENGTHS AGAIN          
         BNE   DMHD020              NOPE, THEY WERE SET BEFORE                  
                                                                                
         MVI   TSKEYL,TDRKEYL      SET L(TSAR DEMO RECD KEY)                    
         MVC   TSRECL,LTSIOREC     SET MAX RECORD LENGTH                        
         DROP  R2                                                               
*                                                                               
DMHD020  DS    0H                  SET UP DEMO LIST                             
         L     RE,ASTDMEXP                                                      
         ZIC   RF,0(RE)            UPDATE STEREO'S COUNT OF # OF DEMOS          
         ZIC   R1,NDEMS                                                         
         AR    RF,R1                                                            
         STC   RF,0(RE)                                                         
         STC   R1,DEMONDEM                                                      
                                                                                
         SR    R0,R0                                                            
         LA    RF,L'DEMS                                                        
         MR    R0,RF                                                            
         EXMVC R1,DEMODEMS,DEMS    INCLUDES LIST TERMINATOR                     
                                                                                
         B     DMHDX                                                            
                                                                                
*                                                                               
DMHDX    DS    0H                                                               
         J     EXITE                                                            
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--SWH+        
               H#)'                                                             
*------------------------ SEED WEEKLY HH DEMOS -----------------------*         
                                                                                
* At entry,                                                                     
*   AFRDMVL = A("from" list of demo values)                                     
*   ATODMVL = A("to" list of demo values)                                       
*   ADEMLIST = A(list of demos)                                                 
                                                                                
SEEDWHHD DS    0H                                                               
         L     R1,ADEMLIST                                                      
         L     R2,AFRDMVL                                                       
         L     R3,ATODMVL                                                       
*                                                                               
SWHH012  DS    0H                                                               
         CLI   0(R1),XFF                                                        
         BE    SWHH019                                                          
         CLI   2(R1),DNWHH1                                                     
         BL    SWHH015                                                          
         CLI   2(R1),DNWHH4                                                     
         BH    SWHH015                                                          
         MVC   0(4,R3),0(R2)                                                    
SWHH015  DS    0H                                                               
         AHI   R1,3                                                             
         AHI   R2,4                                                             
         AHI   R3,4                                                             
         B     SWHH012                                                          
SWHH019  EQU   *                                                                
                                                                                
         DS    0H                                                               
         B     SWHHX                                                            
                                                                                
*                                                                               
SWHHX    DS    0H                                                               
         J     EXITE                                                            
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--MIS+        
               C STUFF)'                                                        
*--------------------- SUBR04 MISCELLANEOUS STUFF --------------------*         
                                                                                
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR04--LTO+        
               R && CONSTANTS)'                                                 
*------------------------- LTORG & CONSTANTS -------------------------*         
         LTORG                                                                  
                                                                                
                                                                                
HEADDAY1 DC    C'DAY/TIME'                                                      
HEADDAY2 DC    C'--------'                                                      
                                                                                
                                                                                
SUBR04L  EQU   *-SUBR04                                                         
         DS    0CL(4096-SUBR04L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
***********************************************************************         
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05)'            
***********************************************************************         
*======================== SUBROUTINE POOL FIVE =======================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR05Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR05Q                                                    
SUBR05   NMOD1 0,1B0205**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R04#)         SUBTRACT FOR SUB-RTN #4                      
         SLL   R1,2                                                             
         B     R05_00(R1)                                                       
                                                                                
DMLK#    EQU   (R05_01-R05_00)/4+R04#   DEMLOOK                                 
BTSK#    EQU   (R05_02-R05_00)/4+R04#   BUILD KEY FOR TSAR RECORD               
SBT#     EQU   (R05_03-R05_00)/4+R04#   SUBTRACT TIMES                          
GADQT#   EQU   (R05_04-R05_00)/4+R04#   GET A(DBDQD TABLE)                      
ADJQH#   EQU   (R05_05-R05_00)/4+R04#   ADJUST QH FOR SORTING                   
BDB#     EQU   (R05_06-R05_00)/4+R04#   BUILD DBLOCK                            
**CUNHK#   EQU   (R05_07-R05_00)/4+R04#                                         
**GSTATE#  EQU   (R05_08-R05_00)/4+R04#                                         
                                                                                
R05_00   DS    0H                                                               
R05_01   B     DEMLK                                                            
R05_02   B     BLDTSKEY                                                         
R05_03   B     SBTRCTIM            SUBTRACT TIMES                               
R05_04   B     GETADQTB            GET A(DBDQD TABLE)                           
R05_05   B     ADJQH               ADJUST QH FOR SORTING                        
R05_06   B     BLDBLOCK            BUILD DBLOCK                                 
**R05_07   B     CUNHOOK             BUILD DBLOCK                               
**R05_08   B     GETSTATE            GET STATE CODE                             
R05#     EQU   (*-R05_00)/4+R04#                                                
         DC    H'0'                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--DML+        
               K)'                                                              
*-------------------------- DEMLOOK ROUTINE --------------------------*         
                                                                                
* At entry,                                                                     
*   R4-->STABK entry                                                            
                                                                                
DEMLK    DS    0H                                                               
         USING STABKD,R4                                                        
                                                                                
*                                                                               
         DS    0H                                                               
         CLC   DBFIL,=C'PAV'       IF PAV FILE SELECTED,                        
         BE    DEMLK100             IT GETS PROCESSED DIFFERENTLY               
         CLC   DBFIL,=C'CTP'       IF COUNTY COVERAGE                           
         BE    DEMLK100             IT GETS PROCESSED DIFFERENTLY               
*                                                                               
         LA    R6,DBLOCK1          DEMLOOK BLOCK                                
         USING SPDEMLKD,R6         R6=A(DEMLOOK BLOCK)                          
         XC    SPDEMLK(SPDEMLKL),SPDEMLK                                        
         MVC   SPLKAREC,AIOAREA1                                                
         MVC   SPLKAFAC,AFAC                                                    
         LA    R0,DEMODEMS                                                      
         ST    R0,SPLKALST                                                      
         LA    R0,THISDEMS                                                      
         ST    R0,SPLKAVAL                                                      
         LA    R0,DEMLKHK                                                       
         ST    R0,SPLKHOOK                                                      
*                                                                               
         CLI   DBMED,C'N'          NETWORK FILE?                                
         BNE   DEMLK5                                                           
         CLI   DBSRC,C'D'          NO TP DATA AVAIL FOR NAD                     
         BE    DEMLKX                JUST EXIT W/NO DATA                        
*                                                                               
DEMLK5   DS    0H                                                               
*                                                                               
         MVC   MYPROF1W,PROF1W         THIS IS TO INCORPORATE THE               
         MVC   MYPROF1W+5(1),PRECPROF   PRECISION PROFILE IF $DEM IS            
         LA    R0,MYPROF1W              USED VIA THE REP SYSTEM                 
         ST    R0,SPLKA1W                                                       
         MVC   MYPROF1W+8(1),CANMMBK    CAN MTR MKT POSTING PROFILE             
                                                                                
*&&DO                                                                           
* May26/99-GLEE - As per Zen, the clients decided they didn't want to           
*                  use the Canadian Metered Market profile.  However,           
*                  since suppressing it changes the behavior of NSI             
*                  look-ups, the profile is suppressed for BBM only.            
         CLI   DBMED,C'C'              IF CANADIAN MEDIA,                       
         BNE   DEMLK05G                                                         
         CLI   DBSRC,C'A'               AND BBM SOURCE,                         
         BNE   DEMLK05G                                                         
         MVI   MYPROF1W+8,0             REMOVE CAN MTR MKT PROFILE              
**       CLI   DBSRC,C'A'               AND BBM SOURCE,                         
**       BE    DEMLK05G                                                         
**       MVI   MYPROF1W+8,0             REMOVE CAN MTR MKT PROFILE              
*&&                                                                             
DEMLK05G EQU   *                                                                
*                                                                               
         MVC   SPLKFIL,DBFIL                                                    
         MVC   SPLKMED,DBMED                                                    
         CLI   DBMED,C'N'          IF NETWORK                                   
         BNE   *+8                                                              
         MVI   SPLKBEST,C'L'       EXACT DAY MATCH LK UP/NOT BIT MASK           
         CLI   DBMED,C'R'          IF RADIO,                                    
         BNE   *+8                                                              
         MVI   SPLKBEST,C'P'        SUPPORT OVERNIGHT DAYPART POSTING           
                                                                                
         CLI   DBMED,C'C'          IF CANADIAN,                                 
         BNE   DMLK06CX                                                         
         MVC   SPLKBEST,CANMMBK     SET CANADIAN MTR MKT LOOKUP PRFL            
         TM    MISCFLG1,MF1BKVWK    WAS BOOK VALIDATED AS A WEEK?               
         BNZ   DMLK06CX              YES                                        
         CLI   3(R3),C'W'           BOOK IS A MNTH--READ FROM BBM WKLY?         
         BE    DMLK06CX              YES, THEN WE'RE OKAY                       
         MVI   SPLKBEST,0            OTHERWISE, SET LOOKUP TO DEFAULT           
DMLK06CX EQU   *                                                                
*                                                                               
* CANADIAN CODE TO SET MONTHLY FLAG                                             
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   DEMLK06D                                                         
         L     RF,ADEMFIL                                                       
         CLC   =C'LPM',8(RF)                                                    
         BE    DEMLK06D                                                         
         CLC   =C'WTP',8(RF)                                                    
         BNE   *+12                                                             
         MVI   SPLKBEST,C'W'                                                    
         B     DEMLK06D                                                         
**       BE    DEMLK06D                                                         
**       MVI   DBBEST,C'M'                                                      
         MVI   SPLKBEST,C'M'                                                    
****     MVI   DBUSEBBM,C'Y'                                                    
DEMLK06D DS    0H                                                               
*                                                                               
         MVC   SPLKSRC,DBSRC                                                    
         MVC   SPLKTPTT,DBTPTTS                                                 
         MVC   SPLKAGY,AGYALPH                                                  
         MVC   SPLKDBK,0(R3)                                                    
         MVC   SPLKWKN,2(R3)       WEEK NUMBER                                  
         MVC   SPLKBTYP,3(R3)      BOOK TYPE                                    
*                                                                               
* IF BBM WTP AND LATEST - MAKE SURE WE GET WEEKLIES - BOOKTYPE =C'W'            
*                                                                               
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BNE   DEMLK06X                                                         
         OC    SPLKDBK,SPLKDBK                                                  
         BNZ   DEMLK06X                                                         
         CLI   SPLKSRC,C'A'                                                     
         BNE   *+8                                                              
         CLI   SPLKMED,C'C'                                                     
         BNE   *+8                                                              
         MVI   SPLKBTYP,C'W'                                                    
DEMLK06X DS    0X                                                               
*                                                                               
         CLI   DBMED,C'N'          FOR NETWK FORCE TO NUMERIC                   
**       BNE   *+18                                                             
**       CLC   3(R3),C'Z'                                                       
         BNE   *+16                                                             
         CLI   3(R3),C'Z'                                                       
         BNH   *+8                                                              
         NI    SPLKBTYP,X'0F'      SET 'F0' - 'F9' TO NUMERIC 1-9               
         MVC   SPLKSTA,STASTA                                                   
         MVC   SPLKSPL,STASPILL                                                 
*                                                                               
         CLC   0(3,R2),=C'ROT'                                                  
         BE    *+20                                                             
         MVC   SPLKDAY,0(R2)                                                    
         MVC   SPLKTIM,1(R2)                                                    
         B     DEMLK05DT                                                        
                                                                                
         DS    0H                  BUILD DAY/TIME LINK                          
         XC    DUB,DUB                                                          
         LA    R0,MYDBXTRA                                                      
         ST    R0,DUB+4                                                         
         MVI   SDBXF,C'S'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   RF,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTLD,RF                                                        
         MVC   DBXTLID,=C'DYTM'                                                 
         MVI   DBXTLIDX,0                                                       
         ZICM  RE,3(R2),(3)                                                     
         LA    RE,LDTROTN(RE)                                                   
         ZIC   R1,0(RE)                                                         
         SH    R1,=H'2'                                                         
         EXMVC R1,DBXTLIST,1(RE)                                                
         LA    R1,DBXTLIST+1(R1)                                                
         MVI   0(R1),0                                                          
         DROP  RF                                                               
DEMLK05DT EQU  *                                                                
*                                                                               
***  MOVE SYSCODE FOR THIS STATION INTO AN AREA FOR SPDEMLK EXTENSION           
         LA    R0,L'SYSCODES                                                    
         ZIC   R1,THISSTA                                                       
         BCTR  R1,0                                                             
         MR    R0,R0                                                            
         LA    R1,SYSCODES(R1)    R1 POINTS TO CURR SYSCODE FOR STATION         
         XC    SYSCEXT,SYSCEXT                                                  
         LA    RE,SYSCEXT                                                       
         USING SPLKXTD,RE                                                       
         XC    SPLKXTND,SPLKXTND   DEFAULT NO EXTENSION                         
         XC    SPXTSYSC,SPXTSYSC                                                
         OC    0(L'SYSCODES,R1),0(R1)                                           
**       BZ    *+14                                                             
         BZ    *+10                                                             
         MVC   SPXTSYSC,0(R1)                                                   
         OI    SPXTFLAG,SPXTRAPP  SET CALLING RESEARCH APPL FLAG                
         ST    RE,SPLKXTND                                                      
*                                                                               
         CLI   DEC2PROJ,C'Y'                                                    
         BNE   DEMLK07                                                          
         CLI   OPTDEC,C'2'             IF OPTION OF MAINFRAME INVOKED *         
         BNE   DEMLK07                                                *         
         OI    SPXTFLG2,SPXTOP2I   2 DEC IMPRESSIONS                            
         DROP  RE                                                               
                                                                                
                                                                                
*************************************************                               
DEMLK07  MVC   SPLKCLI,OPTCLI                                                   
         MVC   SPLKSVI,OPTSVIS                                                  
         CLI   SPLKSVI,0           TEST FOR SVI FACTOR                          
         BNE   *+8                 YES                                          
         MVI   SPLKSVI,X'FF'       NO-SUPPRESS SVI LOOKUP                       
         MVC   SPLKSPRT,OPTSPRT                                                 
         CLI   DBMED,C'C'          ALWAYS SET ALPHA FOR CANANDA                 
         BE    *+14                                                             
         OC    STASPILL,STASPILL   IF NO NUMERIC SPILL MARKET,                  
         BNZ   DEMLK10                                                          
         OC    ALPHAMKT,ALPHAMKT    AND THERE WAS ALPHA MKT INPUT,              
         BZ    DEMLK10                                                          
         MVC   SPLKALF,ALPHAMKT     USE IT                                      
         CLI   DBMED,C'C'                                                       
         BNE   *+10                                                             
         XC    SPLKSPL,SPLKSPL                                                  
                                                                                
DEMLK10  DS    0H                                                               
*                                                                               
         DS    0H                  HANDLE VPH OPTION                            
         OC    OPTVPHBK,OPTVPHBK                                                
         BZ    DMLKVPHX                                                         
         CLI   DBMED,C'W'                                                       
         BNE   DMLKVPHX                                                         
                                                                                
         MVC   DUB(2),0(R3)         TRANSLATE WW/YY INTO DATE                   
****     GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(0,VGETDAY),VADDAY,VDATCON              
         MVI   STARTDAY,0                                                       
         CLI   DBMED,C'O'                                                       
         BNE   *+8                                                              
         MVI   STARTDAY,1                                                       
         GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     +        
               VDATCON                                                          
         ZICM  R1,DMCB+01,(7)                                                   
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)        DATE IN DUB2...CONVRT TO CMPRSS FMT         
         GOTO1 VADDAY,DMCB,DUB2,DUB2,6   MAKE SURE WE GET PROPER YEAR           
         GOTO1 VDATCON,DMCB,(X'80',DUB2),(2,FULL2)                              
         MVC   SPLKAFST(2),FULL2                                                
         MVC   SPLKDBK,OPTVPHBK                                                 
         MVI   SPLKMED,C'T'                                                     
         OI    SPLKOPT,SPLKOWTP                                                 
DMLKVPHX EQU   *                                                                
*                                                                               
* 2 DECIMAL CODE                                                                
*                                                                               
*                                                                               
*ALLOW DISPLAY OF NORMAL BOOKS FOR DEC=2 IF UPGRADES REQUESTED 100404           
         DS    0H                  SET UP PRECISION IN DBLOCK EXTNSN            
**       OC    OPTUPBK,OPTUPBK                                                  
**       BZ    *+14                                                             
**       CLC   DBFIL,=C'PAV'       IF PAV FILE SELECTED,                        
**       BE    DEMLK17                                                          
* nov04 allow 2 decimal upgrades                                                
         CLI   DEC2PROJ,C'Y'                                                    
         BE    *+14                                                             
         OC    OPTUPBK,OPTUPBK                                                  
         BNZ   DEMLK17                                                          
******** CLI   OPTDMA,C'I'         IMPRESSION BASED WAS FORCED                  
******** BNE   DEMLK17                                                          
*****    CLI   OPTDEC,C'2'   TAKE OUT - WE SUPPORT NOT ONLY DEC=2 NOW           
*****    BE    DEMLK15                                                          
******   CLI   OPTDEC,C'1'   IF 1 DECIMAL REQUEST DONT NEED TO SET              
******   BE    DEMLK17       LINK TO EXPAND                                     
         CLI   DBSRC,C'A'                                                       
         BNE   *+12                                                             
         CLI   DBMED,C'C'                                                       
         BE    DEMLK13                                                          
         CLI   DBSRC,C'F'                                                       
         BE    *+8                                                              
         CLI   DBSRC,C'N'    ONLY NIELSEN USTV  AND FUSION                      
         BNE   DEMLK17       HAS DEC=2, DEC=0 CARD                              
****     CLI   DBMED,C'W'    WTP NSI DO IT TOO                                  
****     BE    *+8                                                              
******   L     RE,ADEMFIL                                                       
******   CLC   =C'LPM',8(RE)                                                    
******   BE    *+8                                                              
         CLI   DBMED,C'W'     APR/05 - ALLOW 2 DEC FOR WEEKLY METERED           
         BE    *+8                                                              
*                                                                               
         CLI   DBMED,C'O'     OVERNIGHTS TP                                     
         BE    *+8                                                              
         CLI   DBMED,C'T'                                                       
         BNE   DEMLK17                                                          
DEMLK13  CLI   OPTDEC,C'0'                                                      
         BNL   DEMLK15                                                          
DEMLK14  TM    DEMFLAG1,DF1STERO+DF1DEM32    ONLY DEM32 SET UP 2 DEC            
         BNO   DEMLK17                                                          
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    DEMLK17                                                          
DEMLK15  DS    0H                                                               
         MVI   THISDEC,C'Y'   SET FLAG FOR 2 DEC = Y                            
*                                                                               
         XC    DUB,DUB                                                          
         LA    R0,WORK2                                                         
         ST    R0,DUB+4                                                         
         MVC   DUB+0(4),=C'SPOT'                                                
         MVI   SDBXF,C'S'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R1,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTTID,R1                                                       
****                                                                            
**** FOR NOW JUST FOR ZEN'S PRECISION SUPPORT DFUDGE THE DISPLACEMENT           
**** UNTIL DBEXTRAD DSECT IS LIVE                                               
**       LA    RE,DBXTRC2T                GIVE ZEN HIS DECMIAL                  
**       SHI   RE,1                        SUPPORT                              
**       MVC   0(1,RE),OPTDEC                                                   
         MVC   DBXTSCTL,OPTDEC                                                  
****                                                                            
         MVC   DBXTID(4),=C'SPOT'                                               
         MVI   DBXTTRP,X'01'               1 DEC RTG/PUT                        
         MVI   DBXTTSP,X'01'               1 DEC SHARS                          
         MVI   DBXTTIP,X'02'               IMP'S TO 100'S                       
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
         TM    TMPWHOLE,WHOLERTG           ROUND RATINGS TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTRC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLESHR           ROUND SHARES  TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTSC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLEPUT           ROUND PUTS    TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTPC2T,C'Y'                YEP                                 
         DROP  R1                                                               
* EOT  11/16/2000                                                               
*                                                                               
DEMLK17  DS    0H                                                               
*                                                                               
* END OF 2 DECIMAL CODE                                                         
*                                                                               
*                                  CALL SPDEMLK TO GET DEMOS                    
         MVC   SPLKUID,USERID                                                   
*                                                                               
*                                                                               
         MVI   MYFLAG2,0                                                        
         XC    SVACTBK,SVACTBK                                                  
*                                                                               
*                                                                               
         GOTO1 VSPDEMLK,DMCB,(X'FF',SPDEMLKD)                                   
         CLI   0(R1),0             TEST FOR ERRORS                              
         BNE   DEMLKX                                                           
*                                  SET POSTING VALUES FOR PERIOD TOTS           
         MVC   THISSRC,SVACTSRC                                                 
*                                                                               
         MVC   THISPROG,SPLKPRG                                                 
         MVC   THISPTYP,SPACES     SET PROGRAM TYPE TO BLANK FOR SUMMRY         
         TM    MYFLAG1,MYF1LNBK    IF PROCESSING LATEST N BOOKS,                
         BZ    *+10                                                             
         MVC   THISBOOK,0(R3)       GET ACTUAL BOOK VALUE                       
         LA    RF,DROPSVIS         REMOVE SVIS FROM THISDEMS                    
         CLI   OPTDTYP,C'S'        TEST TO DISPLAY SVIS                         
         BNE   *+8                                                              
         LA    RF,DROPDEMS         YES-REMOVE THE DEMOS                         
**       BALR  RE,RF                                                            
         BASR  RE,RF                                                            
                                                                                
*                                                                               
         DS    0H                  UN-WEIGH WEEKLY HH DEMOS                     
         L     R5,SPLKALST                                                      
         TM    MISCFLG1,MF1WHHD    ANY WEEKLY HH DEMOS?                         
         BZ    DEMLK18X             NOPE, SKIP THIS PART                        
*&&DO                                                                           
         L     RF,SPLKDBLK                                                      
         ZICM  R0,(DBDIVSOR-DBLOCKD)(RF),(3)                                    
*&&                                                                             
         MVI   GOSUBN,ADJWCUM#                                                  
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         ICM   R0,15,CUMFCTR                                                    
         BZ    DEMLK18X                                                         
         ST    R0,DIVISOR                                                       
         SR    R6,R6                                                            
         MVI   GOSUBN,DIV#                                                      
         L     RF,AGOSUB                                                        
DEMLK18G DS    0H                                                               
         CLI   0(R5),XFF                                                        
         BE    DEMLK18X                                                         
         CLI   2(R5),DNWHH1        WEEKLY HH DEMO?                              
         BL    DEMLK18M             NOPE                                        
         CLI   2(R5),DNWHH4                                                     
         BH    DEMLK18M             NOPE                                        
         SR    R0,R0                                                            
         L     R1,CUMWHH(R6)                                                    
         STM   R0,R1,DIVIDEND                                                   
         GOTO1 (RF)                                                             
         L     R0,QUOTIENT                                                      
         ST    R0,THISDEMS(R6)                                                  
DEMLK18M DS    0H                                                               
         LA    R5,3(R5)                                                         
         LA    R6,4(R6)                                                         
         B     DEMLK18G                                                         
DEMLK18X EQU   *                                                                
                                                                                
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
         TM    MYFLAG1,MYF1SEWK    IF FLAGGED TO GET START/END WEEKS,           
         BZ    *+10                                                             
         MVC   THISBOOK,THISSWKN    REMEMBER START/END WEEKS OF MONTH           
         TM    MYFLAG1,MYF1LNBK    IF PROCESSING LATEST N BOOKS,                
         BZ    *+14                                                             
         MVC   MYNLBK,THISLBK       REMEMBER # OF LATEST BOOKS                  
         MVI   THISLBK,X'9C'        FORCE HIGHEST (PACKED) LATEST BK #          
         MVI   THISDAYR,XFF        FORCE HIGHEST DAY # W/IN ROTATION            
         MVC   THISKDAY,THISDAY                                                 
         XI    THISKDAY,X'FF'                                                   
         MVI   THISSQH,X'FF'                                                    
         MVI   THISEQH,X'FF'                                                    
* DEMTEST2 BPOO        THIS IS IT-----SUMMARY POSTING!!!!!!!!                   
*        MVC   THISDEMS,=F'100'                                                 
*                                                                               
*                                                                               
         MVI   GOSUBN,DPST#        GO AND POST DEMO VALUES                      
         GOTO1 AGOSUB                                                           
                                                                                
*                                                                               
         DS    0H                  INDIVIDUAL SUMMARY LINES                     
         TM    MYFLAG1,MYF1LNBK     APPLICABLE FOR LATEST N BOOKS               
         BZ    DEMLK29                                                          
         CLI   ACTN,DEMOPER         NOT FOR ACTN=PERIOD                         
         BE    DEMLK29                                                          
         CLI   ACTN,DEMOAVL         NOT FOR ACTN=AVAIL                          
         BE    DEMLK29                                                          
         MVI   GOSUBN,GIS#                                                      
         GOTO1 AGOSUB                                                           
DEMLK29  EQU   *                                                                
*                                                                               
         B     DEMLKX                                                           
         DROP  R6                                                               
                                                                                
*                                                                               
** PAV FILE **                                                                  
*                                                                               
DEMLK100 DS    0H                                                               
         MVI   GOSUBN,PVLK#                                                     
         GOTO1 AGOSUB                                                           
         J     DEMLKX                                                           
                                                                                
         DROP  R4                                                               
                                                                                
*                                                                               
** EXITS **                                                                     
*                                                                               
DEMLKX   DS    0H                                                               
         J     EXITE                                                            
         EJECT                                                                  
* Routine to process values returned from SPDEMLK                               
*  Be careful NOT to clobber DMCB, since SPDEMLK's caller depends on it         
*                                                                               
DEMLKHK  NTR1                                                                   
         MVC   SAVEDMCB(24),DMCB   SAVE SPDEMLK'S CALLER'S DMCB                 
*                                                                               
         LA    R6,DBLOCK1                                                       
         USING SPDEMLKD,R6                                                      
*                                                                               
*                                                                               
         TM    MYFLAG1,MYF1SEWK    FLAGGED TO GET START/END WEEKS?              
         BZ    DLKHKCNTX            NOPE                                        
*                                                                               
         L     R5,SPLKDBLK                                                      
         USING DBLOCKD,R5                                                       
*                                                                               
*                                                                               
*   NEW CODE TO CHECK IF DBACTBK HAS CHANGED                                    
         XC    THISSRC,THISSRC                                                  
         L     RF,SPLKAREC                                                      
         MVC   SVBKTYPE,DRBTYP-DRKEY(RF)                                        
         MVC   SVACTSRC,2(RF)                                                   
*                                                                               
         OC    SVACTBK,SVACTBK                                                  
         BZ    DEMLKHK0                                                         
         CLC   DBACTBK,SVACTBK                                                  
         BE    DEMLKHK0                                                         
         OI    MYFLAG2,MYF1SEWK     SET A FLAG THAT WE HAVE MORE                
DEMLKHK0 MVC   SVACTBK,DBACTBK      THAN ONE BOOK IN DBACTBK                    
*                                   THEREFORE MUST BE WEEKLY AVG                
*                                                                               
         MVC   THISEWKN,DBACTBK+1   UPDATE END WEEK#                            
         OC    THISSWKN,THISSWKN                                                
         BNZ   *+10                                                             
         MVC   THISSWKN,DBACTBK+1   UPDATE START WEEK# ALSO                     
DLKHKCNTX EQU  *                                                                
         L     R5,SPLKDBLK                                                      
         USING DBLOCKD,R5                                                       
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'AFFL',SPLKDBLK,WORK                            
         MVC   THISAFFL,WORK                                                    
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'MAR',SPLKDBLK,WORK                             
         MVC   THISMNUM,WORK                                                    
         DROP  R5                                                               
*                                                                               
         CLI   ACTN,DEMOPER        TEST PERIOD TOTALS ONLY                      
         BNE   DMLHK009G                                                        
                                                                                
         DS    0H                   IF ACTN=PER, CHECK WEEKLY HH DEMOS          
         TM    MISCFLG1,MF1WHHD      IF WEEKLY HH DEMOS INPUTTED,               
         BZ    DLKHK099               USE THIS BOOK TO MAD DEMO VALS            
DMLHK009G EQU  *                                                                
         CLI   ACTN,DEMOAVL        TEST AVAIL                                   
         BE    DLKHK099                                                         
                                                                                
         GOTO1 VDEFINE,MYDMCB,=C'PTYPE',SPLKDBLK,WORK                           
         CLI   OPTSPRT,C'Y'        IF USER WANT SPORTS                          
         BNE   *+12                                                             
         CLI   WORK,C'S'            BUT PROGTYPE ISN'T,                         
         BNE   DEMLKHKX             IT'S NO GOOD                                
         CLI   OPTSPRT,C'N'        IF USER DON'T WANT SPORTS                    
         BNE   *+12                                                             
         CLI   WORK,C'S'            BUT PROGTYPE IS,                            
         BE    DEMLKHKX             IT'S NO GOOD                                
         DS    0H                  RECORD CAN BE PROCESSED                      
         MVC   THISPTYP,WORK       REMEMBER THE PROGRAM TYPE                    
                                                                                
*                                                                               
         MVI   THISDAYR,1          ENTRY # W/IN ROTATION                        
*                                                                               
         MVI   THIS1WK,0           THESE KEY FIELDS,                            
         MVI   THISNOR,0                                                        
         MVI   THISASQC,0                                                       
         MVI   THISAEQC,0           ARE FOR PAV FILE ONLY                       
         XC    THISPURE,THISPURE   PURE NUMBER NOT APPLICABLE                   
         MVI   THISNWK,0           NEITHER ARE # OF WEEKS,                      
         MVI   THISWKS,0            ACTIVE WEEKS,                               
**       MVI   THISNQH,0            AND TOTAL DURATIONS                         
         XC    THISNQH,THISNQH      AND TOTAL DURATIONS                         
         MVI   THISNDYS,0           AND NUMBER OF DAYS PROGRAM RAN              
                                                                                
*                                  SET PROG NAME & DEMO VALUES                  
         MVC   THISPROG,SPLKPRG                                                 
         LA    RF,DROPSVIS         DROP SVIS FROM THISDEMS                      
         CLI   OPTDTYP,C'S'        TEST TO DISPLAY SVI INDICES                  
         BNE   *+8                                                              
         LA    RF,DROPDEMS         YES-DROP THE DEMOS INSTEAD                   
**       BALR  RE,RF                                                            
         BASR  RE,RF                                                            
*                                                                               
         DS    0H                  CHECK FOR WEEKLY HH'S                        
         TM    MISCFLG1,MF1WHHD                                                 
         BZ    DMLKHKWHHX                                                       
         GOTO1 VDEMOUT,MYDMCB,(C'L',SPLKALST),SPLKDBLK,WHHDEMS                  
                                                                                
         DS    0H                   MAD WEEKLY HH DEMOS TOGETHER                
         L     RF,SPLKDBLK                                                      
         MVC   HALF,(DBFACTOR-DBLOCKD)(RF)                                      
         L     RF,SPLKALST                                                      
         SR    R1,R1                                                            
DMLKHKWHHG DS  0H                                                               
         CLI   0(RF),XFF                                                        
         BE    DMLKHKWHHM                                                       
         CLI   2(RF),DNWHH1         WEEKLY HOUSEHOLD DEMO?                      
         BL    DMLKHKWHHK            NOPE                                       
         CLI   2(RF),DNWHH4                                                     
         BH    DMLKHKWHHK            NOPE                                       
         L     R0,WHHDEMS(R1)                                                   
         MH    R0,HALF                                                          
*****************************                                                   
* CHECK VERSION NUMBER                                                          
****     TM    DEMFLAG1,DF1STERO+DF1DEM32  OLDER DEM32                          
****     BO    DMLKHKWHHH                                                       
         TM    DEMFLAG1,DF1STERO+DF1DEM32  MAINFRAME                            
         BZ    DMWHHNEW                                                         
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    DMLKHKWHHH                                                       
                                                                                
DMWHHNEW CLI   OPTDEC,C'2'                                                      
         BE    DMLKHKWHHH                                                       
         CLI   OPTDEC,C'0'                                                      
         BNE   DMLKHKWHHI                                                       
** STORE THE WEEKLIES AS  2 DECIMALS IN CUMWHH BUFFER                           
         LR    R5,R1                 SAVE R1 WE HAVE TO USE IT FOR NOW          
         LR    R1,R0                                                            
         SR    R0,R0                                                            
         MH    R0,=F'10'                                                        
         LR    R0,R1                                                            
         LR    R1,R5                 RESTORE R1                                 
**                                                                              
                                                                                
         A     R0,CUMWHH(R1)         UPDATE CUMMULATED WEEKLIES                 
         ST    R0,CUMWHH(R1)                                                    
                                                                                
****     SRL   R0,1                                                             
         L     R0,WHHDEMS(R1)        ADJUST INDIVIDUAL LINES                    
         MH    R0,HALF                                                          
         LR    R5,R1                 SAVE R1 WE HAVE TO USE IT FOR NOW          
         LR    R1,R0                                                            
         SR    R0,R0                                                            
         MH    R0,=F'10'                                                        
         AHI   R1,5                                                             
         SR    R0,R0                                                            
         D     R0,=F'10'           R1 HAS WEEKLY VALUE                          
         LR    R0,R1                                                            
         LR    R1,R5                 RESTORE R1                                 
         ST    R0,WHHDEMS(R1)                                                   
         B     DMLKHKWHHK                                                       
DMLKHKWHHH DS  0H                                                               
         MH    R0,=H'10'             ADJUST WEEKLYS BY 10                       
         ST    R0,WHHDEMS(R1)                                                   
******************************                                                  
*                                                                               
DMLKHKWHHI DS  0H                                                               
         A     R0,CUMWHH(R1)                                                    
         ST    R0,CUMWHH(R1)                                                    
DMLKHKWHHK DS  0H                                                               
         LA    R1,4(R1)                                                         
         LA    RF,3(RF)                                                         
         B     DMLKHKWHHG                                                       
DMLKHKWHHM EQU *                                                                
*                                                                               
         LH    R0,HALF             THIS IS NEEDED BECAUSE DBFACTOR              
         A     R0,CUMFCTR           GOT FORCED TO EQUAL 1                       
         ST    R0,CUMFCTR                                                       
*                                                                               
******   MVI   GOSUBN,DPST#                                                     
         CLI   ACTN,DEMOPER        IF ACTN=PERIOD,                              
         BE    DLKHK099             DONE WITH TASKS FOR WEEKLY HH DEMOS         
DMLKHKWHHX EQU *                                                                
*                                                                               
         L     R5,SPLKDBLK         R5=A(SPDEMLK DBLOCK)                         
         USING DBLOCKD,R5                                                       
*                                  UNWEIGHT WEIGHTED DEMOS                      
DEMLKHK1 CLC   DBFACTOR,=H'1'      TEST FOR WEIGHTED RECORD                     
         BE    DEMLKHK3            NO                                           
         CLI   OPTDTYP,C'S'        TEST FOR DISPLAY OF SVI INDICES              
         BE    DEMLKHK3            YES                                          
         ZIC   R0,DEMONDEM         R0=N'DEMOS                                   
         LH    R1,DBFACTOR         R1=WEIGHTING FACTOR                          
         LA    R2,THISDEMS         R2=A(DEMO VALUES)                            
*                                                                               
DEMLKHK2 L     RF,0(R2)            GET DEMO VALUES                              
         SR    RE,RE                                                            
         SLDA  RE,1                                                             
         DR    RE,R1               WEIGHTED DEMO/WEIGHT                         
         AH    RF,=H'1'                                                         
         SRA   RF,1                                                             
         ST    RF,0(R2)                                                         
         LA    R2,4(R2)                                                         
         BCT   R0,DEMLKHK2                                                      
*                                  EXTRACT SPDEMLK DBLOCK VALUES                
DEMLKHK3 DS    0H                                                               
         ST    R5,ADBLOCK                                                       
         MVI   GOSUBN,GADQT#       GET A(DAY/QH TABLE)                          
         GOTO1 AGOSUB                                                           
*                                                                               
         DS    0H                                                               
         ZIC   R1,DBDQPTR                                                       
         BCTR  R1,0                                                             
*        CLI   DBSELMED,C'N'                                                    
*        BNE   *+8                                                              
*        LA    R1,X'01'                                                         
         MHI   R1,DBDQLEN                                                       
         A     R1,ADBDQD                                                        
         MVC   THISKDAY,DBDQKDAY-DBDQD(R1)                                      
         XC    FULL,FULL           DETERMINE D/T SUB-INDEX NUMBER               
         ZIC   RF,DBACTSQC                                                      
         ZIC   RE,DBDQSQH-DBDQD(R1)                                             
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         ST    RF,FULL                                                          
*                                                                               
                                                                                
         L     R0,ADBDQD                                                        
DMLKHK3G CR    R0,R1                                                            
         BNL   DMLKHK3M                                                         
         AHI   R1,-(DBDQLEN)                                                    
DMLKHK3H ZIC   RF,DBDQEQH-DBDQD(R1)                                             
         ZIC   RE,DBDQSQH-DBDQD(R1)                                             
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         A     RF,FULL                                                          
         ST    RF,FULL                                                          
         B     DMLKHK3G                                                         
DMLKHK3M EQU   *                                                                
         MVC   THISDTSI,FULL+2     DAY/TIME SUB-INDEX NUMBER                    
*                                                                               
* this was an attempt to align the dem32 reports for 3a                         
* FOR OLDER BOOKS BEFORE 3A  WE HAVE TO FUDGE THE INDEX                         
* TO GET IT TO ALIGN COPRRECTLY WHEN REQUESTING WITH A NEW 3A BOOK              
* SINCE THE REPORT STARTS AT 3A WE NEED TO SHIFT THE CODE BOOKS DOWN            
*                                                                               
***      CLC   DBACTBK,=X'6F0B'   EFFECTIVE 3A BOOK                             
**       CLC   DBACTBK,=X'710B'   EFFECTIVE 3A BOOK                             
*                                                                               
         CLI   DBSELMED,C'O'                                                    
         BNE   DMLKHK3N                                                         
         CLC   DBACTBK,=X'7331'   NOV3015 EFFECTIVE 3A BOOK                     
         BL    DMLKHK3P                                                         
         B     DMLKHK3O                                                         
*                                                                               
DMLKHK3N CLC   DBACTBK,=X'730B'   DEC15 EFFECTIVE 3A BOOK                       
         BH    DMLKHK3P                                                         
* IF START TIME >3A AND CURRENT QTR BTWEEN 3A-545A                              
DMLKHK3O CLC   1(2,R2),=H'300'                                                  
         BL    DMLKHK3P                                                         
**       ZICM  RF,3(R2),(3)       ENDTIME                                       
         CLI   DBACTSQC,84        3A                                            
         BL    DMLKHK3P                                                         
         CLI   DBACTSQC,95        545                                           
         BH    DMLKHK3P                                                         
         MVC   TEMPMTIM,3(R2)                                                   
         MVI   GOSUBN,MTQ#                                                      
         GOTO1 AGOSUB                                                           
         ZIC   RF,TEMPQHR       REQUEST END QH                                  
                                                                                
*                                                                               
*                                                                               
**       CR    RF,RE                                                            
**       BNH   DMLKHK3P                                                         
**       SR    RF,RE                                                            
**       SR    RE,RE                                                            
**       LA    R1,15              RQUESTED                                      
**       DR    RE,R1              # QTR HOURS PAST 6AM                          
*                                                                               
**       SR    RF,RE                                                            
**       AHI   RF,1                                                             
         A     RF,FULL                                                          
         ST    RF,FULL                                                          
         MVC   THISDTSI,FULL+2     DAY/TIME SUB-INDEX NUMBER                    
*                                                                               
*                                                                               
DMLKHK3P DS    0H                  QUARTER HOUR ADJUSTMENT FACTOR               
         MVI   THISQHAF,100             ASSUME IT'S ZERO (100-BASED)            
         CLC   =AL2(DBDQUXTD),DBDQTAB+0 USING XTND FOR D/Q ENTRIES?             
         BNE   DLKHKQAFX                 NOPE, LEAVE ADJ FACTOR ALONE           
         L     RF,ADBDQD                 YES, QH ADJ FCTR IS B4 D/QHs           
         SHI   RF,(DBDQXFXL-(DBDQADJF-DBDQXTND))  RF-->ADJ FACTOR               
         ZICM  R1,0(RF),(3)                       R1 = ADJ FACTOR,              
         AHI   R1,100                              MAKE IT 100-BASED            
         STC   R1,THISQHAF                         AND SAVE IT                  
DLKHKQAFX EQU  *                                                                
*                                                                               
         ZIC   R1,DBACTSQC                                                      
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
                                                                                
         TM    MYFLAG1,MYF1LNBK    IF LATEST N BOOK REQUESTED,                  
         BZ    DLKHKLBX                                                         
         CLC   PVACTBK,DBACTBK      AND PREV ACTBK <> CURRENT ACTBK,            
         BE    DLKHKLBX                                                         
         MVC   PVACTBK,DBACTBK       REMEMBER THE CURRENT ACTBK,                
         MVC   THISBOOK,DBACTBK      MOVE IT TO SORT RECORD,                    
         ZAP   DUB,THISLBK                                                      
         CVB   RF,DUB                                                           
         SLL   RF,1                                                             
         LA    RF,LNBKLIST(RF)                                                  
         MVC   0(2,RF),DBACTBK       PUT IT IN LATEST  N  BOOK LIST,            
         AP    THISLBK,=P'1'         INCREMENT LATEST BOOK NUMBER               
DLKHKLBX EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         USING DBXTLID,RE                                                       
         ICM   RE,15,DBEXTEND                                                   
         BZ    DLKHKDTX                                                         
         CLC   DBXTLID,=C'DYTM'                                                 
         BE    *+12                                                             
         ICM   RE,15,DBXTLNXT                                                   
         B     *-18                                                             
         ZIC   RF,DBXTLIDX                                                      
         LA    RF,1(RF)                                                         
         STC   RF,THISDAYR                                                      
DLKHKDTX EQU   *                                                                
         DROP  RE                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         TM    MISCFLG1,MF1WHHD    IF AT LEAST ONE WEEKLY HH DEMO,              
         BZ    DLKHKSWX             NEED TO SEED THEM W/ "MAIN" DEMOS           
         MVC   ADEMLIST,SPLKALST    SET A(DEMO LIST)                            
         LA    R0,WHHDEMS                                                       
         ST    R0,AFRDMVL           SET A("FROM" DEMO VALUES)                   
         LA    R0,THISDEMS                                                      
         ST    R0,ATODMVL           SET A("TO" DEMO VALUES)                     
         MVI   GOSUBN,SWHH#                                                     
         GOTO1 AGOSUB               SEED WKLY HH DEMOS W/ "MAIN" DEMOS          
DLKHKSWX EQU   *                                                                
                                                                                
*                                  POST DEMOS FOR EACH QUARTER HOUR             
DEMLKHK4 STC   R1,THISSQH                                                       
         STC   R1,THISEQH                                                       
*                                                                               
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
         LA    R1,1(R1)            BUMP SQH                                     
         CLM   R1,1,DBACTEQC       TEST SQH GR EQH                              
         BNH   DEMLKHK4            YES - ALL DONE                               
DLKHK099 EQU   *                                                                
         EJECT                                                                  
         DS    0H                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   DLKHKDIX                                                         
         CLI   SVTHSSTN,1                                                       
         BH    DLKHKDIX                                                         
         CLI   SVTHSBK,1                                                        
         BH    DLKHKDIX                                                         
         CLC   PREVDAYR,THISDAYR                                                
         BE    DLKHKDIX                                                         
*                                                                               
         MVC   PREVDAYR,THISDAYR                                                
                                                                                
         MVC   ADBLOCK,SPLKDBLK                                                 
         MVI   GOSUBN,PDTI#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
DLKHKDIX EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         B     DEMLKHKX                                                         
*                                  EXIT BACK TO SPDEMLK FRO NEXT RECORD         
DEMLKHKX DS    0H                                                               
         MVC   DMCB(24),SAVEDMCB   RESTORE SPDEMLK'S CALLER'S DMCB              
         J     EXITE                                                            
         DROP  R5,R6                                                            
         EJECT                                                                  
* Remove SVI factors from output values returned from SPDEMLK                   
*                                                                               
DROPSVIS LA    R1,THISDEMS         R1=A(RETURNED DEMO VALUES)                   
         LA    RF,8(R1)            RF=A(2ND DEMO VALUE ENTRY)                   
         ZIC   R0,DEMONDEM         R0=N'OUTPUT ENTRIES                          
         MVC   4(4,R1),0(RF)                                                    
         LA    R1,4(R1)                                                         
         LA    RF,8(RF)                                                         
         BCT   R0,*-14                                                          
         BR    RE                                                               
         SPACE 1                                                                
* Remove demos from output values returned from SPDEMLK                         
*                                                                               
DROPDEMS LA    R1,THISDEMS         R1=A(RETURNED DEMO VALUES)                   
         LA    RF,4(R1)            RF=A(FIRST SVI VALUE)                        
         ZIC   R0,DEMONDEM         R0=N'OUTPUT VALUES                           
         MVC   0(4,R1),0(RF)       SHIFT SVI TO DEMO POSITION                   
         LA    R1,4(R1)                                                         
         LA    RF,8(RF)                                                         
         BCT   R0,*-14                                                          
         BR    RE                                                               
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--DML+        
               K)'                                                              
*--------------------- BUILD KEY FOR TSAR RECORD ---------------------*         
                                                                                
* At entry,                                                                     
*   TMPRCTYP set to type of TSAR DEMO RECORD to build key for.                  
*   THISxxxx fields set                                                         
* At exit,                                                                      
*   TSARKEY set                                                                 
                                                                                
BLDTSKEY DS    0H                                                               
         XC    TSARKEY,TSARKEY                                                  
         LA    R3,TSARKEY                                                       
         USING TSDEMRCD,R3                                                      
         MVC   TDRRCTYP,TMPRCTYP                                                
                                                                                
*                                                                               
         DS    0H                                                               
         CLI   TDRRCTYP,TDRRTDMV   DEMO VALUES                                  
         BE    BTSKDMV                                                          
         CLI   TDRRCTYP,TDRRTDTI   DAY/TIME INDICES                             
         BE    BTSKDTI                                                          
         B     BTSKXN                                                           
                                                                                
*                                                                               
** DEMO VALUES TSAR RECORD **                                                   
*                                                                               
BTSKDMV  DS    0H                                                               
         ZICM  RF,THISSTA,(1)                                                   
         BZ    BTSKDMVB                                                         
         LH    RE,DSPRCTST                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
BTSKDMVB STC   RF,TDRSTA                                                        
                                                                                
         ZICM  RF,THISBK,(1)                                                    
         BZ    BTSKDMVD                                                         
         LH    RE,DSPRCTBK                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
BTSKDMVD STC   RF,TDRBK                                                         
                                                                                
         ZICM  RF,THISDAY,(1)                                                   
         BZ    BTSKDMVF                                                         
         LH    RE,DSPRCTDT                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
BTSKDMVF STC   RF,TDRDAY                                                        
*                                                                               
         MVC   TDRDAYR,THISDAYR                                                 
         MVC   TDRKDAY,THISKDAY                                                 
         MVC   TDRSQH,THISSQH                                                   
         MVC   TDREQH,THISEQH                                                   
                                                                                
*                                                                               
         DS    0H                                                               
         B     BTSKXY                                                           
                                                                                
*                                                                               
** DAY/TIME INDICES TSAR RECORD **                                              
*                                                                               
BTSKDTI  DS    0H                                                               
         ZICM  RF,THISDAY,(1)                                                   
         BZ    BTSKDTIB                                                         
         LH    RE,DSPRCTDT                                                      
         LA    RE,REQCTLTB(RE)                                                  
         ZIC   R0,(RCTFROM-RCTDSECT)(RE)                                        
         AR    RF,R0                                                            
         BCTR  RF,0                                                             
BTSKDTIB STC   RF,TDRDAY            DAY/TIME NUMBER                             
*                                                                               
         MVC   TDRDAYR,THISDAYR     COMPONENT NUMBER                            
         B     BTSKXY                                                           
                                                                                
         DROP  R3                                                               
                                                                                
*                                                                               
** EXITS **                                                                     
*                                                                               
BTSKXY   DS    0H                                                               
         J     YES                                                              
*                                                                               
BTSKXN   DS    0H                                                               
         J     NO                                                               
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--SBT+        
               #)'                                                              
*--------------------------- SUBTRACT TIMES --------------------------*         
                                                                                
* A clock arithmetic routine--subtracts one time from another.                  
*  This routine assumes that the input times are valid.                         
* At entry,                                                                     
*   TEMPSTIM = (military) time to subtract from                                 
*   TEMPMTIM = (military) time to subtract                                      
* At exit,                                                                      
*   TEMPETIM = the result of the subtraction (in miltary time)                  
                                                                                
SBTRCTIM DS    0H                                                               
         ZICM  RF,TEMPSTIM,(3)                                                  
         ZICM  R1,TEMPMTIM,(3)                                                  
                                                                                
*                                                                               
         DS    0H                  ADJUST THE "START" TIME                      
         LA    R2,2400                                                          
         LR    R3,R2                                                            
         AR    R3,R1                                                            
*                                                                               
SBT012   CR    R1,RF                DON'T WANT NEGATIVE RESULTS                 
         BL    *+10                                                             
         AR    RF,R0                                                            
         B     SBT012                                                           
*                                                                               
SBT014   CR    R3,RF                DON'T WANT TIMES ABOVE 2400                 
         BNL   *+10                                                             
         SR    RF,R0                                                            
         B     SBT014                                                           
                                                                                
*                                                                               
         DS    0H                                                               
         SR    R0,R0                                                            
         D     R0,=F'100'          SPLIT INTO HOURS & MINUTES                   
         SR    RE,RE                                                            
         D     RE,=F'100'            "    "     "   "    "                      
                                                                                
*                                                                               
         DS    0H                  THE SUBTRACTION ARITHMETIC                   
         CR    RE,R0                COMPARE MINUTES                             
         BNL   *+10                                                             
         AH    RE,=H'60'                                                        
         BCTR  RF,0                                                             
         SR    RE,R0                SUBTRACT MINUTES                            
         SR    RF,R1                SUBTRACT HOURS                              
                                                                                
*                                                                               
         DS    0H                  PUT BACK INTO MILITARY FORMAT                
         MH    RF,=H'100'                                                       
         AR    RF,RE                                                            
         STCM  RF,3,TEMPETIM        AND STORE RESULT HERE                       
                                                                                
*                                                                               
SBTX     DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--GAD+        
               QT#)'                                                            
*------------------------ GET A(DAY/QH TABLE) ------------------------*         
                                                                                
* At entry,                                                                     
*   ADBLOCK  = A(DBLOCK)                                                        
* At exit,                                                                      
*   ADBDQD   = A(Internal day/qhr table)                                        
                                                                                
GETADQTB DS    0H                                                               
         L     R5,ADBLOCK                                                       
         USING DBLOCKD,R5                                                       
                                                                                
*                                                                               
         DS    0H                                                               
         LA    R3,DBDQD             PICK UP ADDR DIRECTLY FROM HERE             
         CLC   =AL2(DBDQUXTD),DBDQTAB+0   DO WE NEED TO LOOK IN XTND?           
         BNE   GADQT12X                    NOPE                                 
*                                                                               
         DS    0H                                                               
         LA    RF,DBEXTEND-4                                                    
GADQT12G DS    0H                   LOOK THROUGH DBEXTEND                       
         ICM   RF,15,4(RF)                                                      
         BZ    GADQT12X                                                         
         CLC   0(4,RF),DBDQTAB+2     FOR NAME GIVEN HERE                        
         BNE   GADQT12G                                                         
         LA    R3,DBDQXFXL(RF)                                                  
GADQT12X EQU   *                                                                
*                                                                               
         DS    0H                                                               
         ST    R3,ADBDQD                                                        
         DROP  R5                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--ADJ+        
               QH#)'                                                            
*----------------------- ADJUST QH FOR SORTING -----------------------*         
                                                                                
* At entry,                                                                     
*   TMPSQH   = start quarter-hour needing adjustment                            
*   TMPEQH   = end   quarter-hour needing adjustment                            
*   THISQHAF = quarter-hour adjustment factor                                   
* At exit,                                                                      
*   TMPSQH   = adjusted start quarter-hour                                      
*   TMPEQH   = adjusted end   quarter-hour                                      
                                                                                
ADJQH    DS    0H                                                               
         ZIC   R0,THISQHAF         R0 = ADJ FACTOR, 100-BASED                   
         SHI   R0,100                                                           
                                                                                
*                                                                               
         DS    0H                                                               
         LHI   RE,2                                                             
         LA    RF,TMPSQH                                                        
*                                                                               
ADJQH012 DS    0H                                                               
         CLI   0(RF),96            IS THIS A VALID QUARTER HOUR?                
         BNL   ADJQH016                                                         
                                                                                
         DS    0H                                                               
         ZIC   R1,0(RF)                                                         
         AR    R1,R0               ADD ADJUSTMENT FACTOR TO QH                  
         BNM   *+8                  IF NEGATIVE,                                
         AHI   R1,96                 ADD 96 TO RESULT                           
         CHI   R1,96                IF EQUAL TO OR GREATER END-OF-DAY,          
         BL    *+8                                                              
         SHI   R1,96                 SUBTRACT 96 FROM RESULT                    
         STC   R1,0(RF)                                                         
*                                                                               
ADJQH016 DS    0H                                                               
         AHI   RF,1                                                             
         BCT   RE,ADJQH012                                                      
                                                                                
*                                                                               
ADJQHX   DS    0H                                                               
         J     EXIT                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--BDB+        
               #)'                                                              
*-------------------------- BUILD DEMOBLOCK --------------------------*         
                                                                                
* Builds the DBLOCK in the area addressed by ADBLOCK                            
* At entry,                                                                     
*   R2-->current day/times entry being processed                                
*   R3-->current book entry being processed                                     
*   R4-->current station entry being processed                                  
                                                                                
BLDBLOCK DS    0H                                                               
         USING STABKD,R4                                                        
*                                                                               
         L     R6,ADBLOCK                                                       
         USING DBLOCKD,R6                                                       
*                                                                               
         DS    0H                 CLEAR DBLOCK                                  
         LR    R0,R6               R0-->DESTINATION                             
         LA    R1,DBLOCK1X-DBLOCK1 R1 = L(DESTINATION)                          
         SR    RE,RE                                                            
         SR    RF,RF                                                            
         MVCL  R0,RE                                                            
*                                                                               
         DS    0H                 BUILD DBLOCK                                  
         MVC   DBAREC,AIOAREA1     A(I/O AREA)                                  
         MVC   DBCOMFCS,AFAC       A(COMFACS)                                   
         MVC   DBFILE,DBFIL        FILE                                         
         MVI   DBFUNCT,DBGETDEM    DEMAND REQUEST FUNCTION                      
         MVC   DBSELSRC,DBSRC       SELECTED SOURCE                             
         MVC   DBSELMED,DBMED          "     MEDIA                              
         MVC   DBSELSTA,STASTA         "     STATION                            
         MVC   DBSELMK,STASPILL        "     SPILL MARKET                       
         MVC   DBSELCLI,OPTCLI         "     CLIENT                             
*                                                                               
         DS    0H                                                               
         MVC   DBSELBK,0(R3)           "     BOOK                               
         CLC   0(2,R3),ESTBOOK                                                  
         BNE   *+10                                                             
         MVC   DBSELBK,OPTUPBK         "     BOOK FOR UPGRADES                  
*                                                                               
         CLC   0(3,R2),=C'ROT'                                                  
         BE    BDB016                                                           
         CLC   0(3,R2),=C'PUR'                                                  
         BNE   *+14                                                             
         MVC   DBSELPUR,3(R2)          "     PURE NUMBER                        
         B     BDB016X                                                          
         MVC   DBSELDAY,0(R2)          "     DAY                                
*                                                                               
         MVC   DBSELTIM(4),1(R2)                                                
         CLC   DBFIL,=C'PAV'                                                    
         BNE   BDB010                                                           
*                                                                               
****     MVC   DBSELTIM(2),=H'600'     "     START TIME                         
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   BDB009G                                                          
         MVC   TEMPSTIM,1(R2)                                                   
*&&DO                                                                           
         MVC   TEMPMTIM,=H'200'              (SUBTRACT 2 HOURS)                 
*&&                                                                             
         XC    TEMPMTIM,TEMPMTIM                                                
         MVI   GOSUBN,SBT#                                                      
         GOTO1 AGOSUB                                                           
         MVC   DBSELTIM(2),TEMPETIM                                             
BDB009G  EQU   *                                                                
****     MVC   DBSELTIM+2(2),=H'545'   "     END TIME                           
*                                                                               
*                                                                               
BDB010   MVC   DBSELWKN,2(R3)          "     WEEK NUMBER                        
         B     BDB016X                                                          
                                                                                
BDB016   DS   0H                                                                
         ZICM  R5,3(R2),(3)                                                     
         LA    R5,LDTROTN(R5)      R5-->L(ROTATION ENTRY)                       
         XC    DUB,DUB                                                          
         XC    DBXTROTN(DBXTROTL),DBXTROTN                                      
         MVC   DUB(4),=C'DYTM'     LINK IDENTIFICATION                          
         CLC   1(3,R5),=C'PUR'                                                  
         BNE   *+10                                                             
         MVC   DUB(4),=C'PURE'                                                  
         LA    R0,DBXTROTN                                                      
         ST    R0,DUB+4                                                         
         MVI   SDBXF,C'D'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   RF,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         CLC   1(3,R5),=C'PUR'                                                  
         BE    BDB016P                                                          
                                                                                
         USING DBXTLD,RF                                                        
         ZIC   R1,0(R5)            DBEXTEND LINK FOR DAYS & TIMES               
         SH    R1,=H'2'                                                         
         EXMVC R1,DBXTLIST,1(R5)                                                
         LA    R1,DBXTLIST+1(R1)                                                
         MVI   0(R1),0                  END OF DAY/TIME LIST                    
         DROP  RF                                                               
         B     BDB016X                                                          
                                                                                
BDB016P  DS    0H                                                               
         ZIC   R1,0(R5)            DBEXTEND LINK FOR PURE NUMBER                
         BCTR  R1,0                                                             
         LR    R0,R1                                                            
         LA    R5,1(R5)                 R5-->LIST OF COMPONENTS                 
         USING DBXPUD,RF                                                        
         LA    R1,DBXPULST                                                      
BDB016T  MVC   0(L'DBXPULST,R1),3(R5)   MOVE PURE# INTO LINK                    
         LA    R1,L'DBXPULST(R1)                                                
         LA    R5,5(R5)                                                         
         SH    R0,=H'5'                                                         
         BP    BDB016T                                                          
         BZ    *+6                                                              
         DC    H'0'                                                             
         MVC   0(2,R1),=X'FFFF'         END OF PURE# LIST                       
         DROP  RF                                                               
         B     BDB016X                                                          
BDB016X  EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  NEED LONGER DAYS/QHS TABLE                   
         CLI   DBMED,C'T'           FOR MEDIA=USTV                              
         BNE   BDBDQX                                                           
         CLI   DBSRC,C'N'           FOR SOURCE=NSI                              
         BNE   BDBDQX                                                           
         CLC   DBFIL,=C'TP '        FOR TP FILE                                 
         BNE   BDBDQX                                                           
                                                                                
         MVC   DUB+0(4),=C'DBD3'                                                
         LA    RE,DBXTDQT                                                       
         ST    RE,DUB+4                                                         
         XC    0(DBXTDQTL,RE),0(RE)                                             
         MVI   SDBXF,C'D'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
BDBDQX   EQU   *                                                                
*                                                                               
         MVC   DBBTYPE,3(R3)        BOOK TYPE                                   
         CLC   0(2,R3),ESTBOOK                                                  
         BNE   *+10                                                             
         MVC   DBBTYPE,OPTUPBT      BOOK TYPE FOR UPGRADES                      
*                                                                               
         MVC   DBSELSPO,OPTSPRT        "     SPORT OPTION                       
         MVC   DBSELAGY,AGYALPH     AGENCY                                      
*do best for now test                                                           
         MVI   DBBEST,C'A'          ASK FOR ALL RECORDS                         
         CLI   OPTBEST,C'B'                                                     
         BNE   *+8                                                              
         MVI   DBBEST,C'B'           UNLESS BEST REQUESTED                      
*                                                                               
         CLI   DBSELMED,C'N'       FOR NETW ALLOW NUMERIC BKTYP                 
         BNE   BDB020                                                           
         CLI   DBBTYPE,C'Z'                                                     
         BNH   *+8                                                              
         NI    DBBTYPE,X'0F'                                                    
         MVI   DBBEST,C'L'         EXACT MATCH LK UP (NOT BIT MATCH)            
*                                                                               
BDB020   CLI   TAPEOPT,C'Y'        IF IMP BASED CALCULATIONS REQUESTED,         
         BNE   *+8                                                              
         MVI   DBTAPEP,C'Y'         WE WANT TAPE PRECISION                      
         OC    STASPILL,STASPILL   IF NO NUMERIC SPILL MARKET,                  
         BNZ   *+20                                                             
         OC    ALPHAMKT,ALPHAMKT    AND THERE WAS ALPHA MKT INPUT,              
         BZ    *+10                                                             
         MVC   DBSELALF,ALPHAMKT    USE IT                                      
                                                                                
         DS    0H                  SET UP PRECISION IN DBLOCK EXTNSN            
* 2 DECIMAL CODE                                                                
*                                                                               
*                                                                               
         OC    OPTUPBK,OPTUPBK            NO UPGRADES FOR NOW                   
         BNZ   BDBX                       FOR PRECISION                         
******** CLI   OPTDMA,C'I'                  IMPRESSION BASED WAS FORCED         
******** BNE   BDBX                                                             
         CLI   OPTDEC,C'0'                                                      
         BNL   BDB050                                                           
         TM    DEMFLAG1,DF1STERO+DF1DEM32   ONLY DEM32 SET 2 DEC                
         BNO   BDBX                                                             
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    BDBX                                                             
BDB050   DS    0H                                                               
         MVI   THISDEC,C'Y'     SET FLAG FOR 2 DEC = Y                          
*                                                                               
* END OF 2 DECIMAL CODE                                                         
         XC    MYDBXTRA,MYDBXTRA                                                
         LA    R1,MYDBXTRA                                                      
         ST    R1,DUB+4                                                         
         MVC   DUB+0(4),=C'SPOT'                                                
         MVI   SDBXF,C'D'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R1,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTTID,R1                                                       
**** FOR NOW JUST FOR ZEN'S PRECISION SUPPORT DFUDGE THE DISPLACEMENT           
**** UNTIL DBEXTRAD DSECT IS LIVE                                               
**       LA    RE,DBXTRC2T                GIVE ZEN HIS DECMIAL                  
**       SHI   RE,1                        SUPPORT                              
**       MVC   0(1,RE),OPTDEC                                                   
         MVC   DBXTSCTL,OPTDEC                                                  
*                                                                               
         MVC   DBXTID(4),=C'SPOT'                                               
         MVI   DBXTTRP,X'01'               1 DEC RTG/PUT                        
         MVI   DBXTTSP,X'01'               1 DEC SHARS                          
         MVI   DBXTTIP,X'02'               IMP'S TO 100'S                       
* 2 DECIMAL CODE                                                                
*                                                                               
*^^TEST                                                                         
         MVI   DBXTRC2T,C'Y'                                                    
*^^EOTEST                                                                       
*                                                                               
* END OF 2 DECIMAL CODE                                                         
         DROP  R1                                                               
*                                                                               
         DROP  R6                                                               
         DROP  R4                                                               
*                                                                               
BDBX     DS    0H                                                               
         J     EXIT                                                             
*&&DO                                                                           
***********************************************************                     
*---------------COUNTY COVERAGE DEMAND HOOK --------------------------*         
                                                                                
CUNHOOK  NTR1                                                                   
         LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
                                                                                
****     MVI   THISDAYR,1          COMP#                                        
         MVI   THISDAYR,XFF        COMP#                                        
****  UNCOMMENTED THIS                                                          
         MVI   THISDTSI,XFF        SET MAYA NUMBER TO 1 ALWAYS                  
         MVI   THISDTSI,XFF        SINE WE DONT HAVE ROTATIONS                  
****                                                                            
** EXTRACT DATA FOR PAV FILE **                                                 
*                                                                               
                                                                                
*                                                                               
         MVC   THISASQC,DBACTSQC   GET ACTUAL START                             
         MVC   THISAEQC,DBACTEQC    AND END QH'S                                
         MVC   THISSQH,DBACTSQC   GET ACTUAL START                              
         MVC   THISEQH,DBACTEQC    AND END QH'S                                 
         ZIC   RE,THISEQH                                                       
         AHI   RE,1                                                             
         STC   RE,THISEQH                                                       
                                                                                
*                                                                               
         DS    0H                  SET PROGRAM NAMES                            
         MVC   WORK,SPACES                                                      
         MVC   DBFILE,=C'TP '                                                   
         GOTO1 VDEFINE,MYDMCB,=C'PROG+',DBLOCK,WORK                             
         MVC   THISPROG,WORK        SET THIS PROGRAM'S NAME                     
         MVC   THISPROG+12(3),SPACES   DONT SHOW WEEKS RUN                      
                                                                                
                                                                                
         DS    0H                  LOOK UP VUTS (TO DERIVE SHARES)              
*                                                                               
         DS    0H                  GO EXTRACT DEMO VALUES                       
*                                                                               
* 2 DECIMAL CODE                                                                
*^^TEST                                                                         
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
*^^EOTEST                                                                       
* END OF 2 DECIMAL CODE                                                         
*                                                                               
         LA    R0,DEMODEMS                                                      
         ST    R0,ADEMLIST          SET A(DEMO LIST)                            
*                                                                               
CULKPH18 DS    0H                  POST INTO SORT BUFFER                        
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
*                                                                               
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'DAY',DBLOCK,WORK                               
         ZIC   R1,WORK+1                                                        
         SLL   R1,4                (UNDO WHAT DEFINE DID)                       
         STC   R1,THISKDAY                                                      
*                                                                               
         MVC   DBFILE,DBFIL                                                     
*                                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         GOTO1 VDEMOUT,MYDMCB,(C'L',ADEMLIST),DBLOCKD,THISDEMS                  
*                                                                               
* MAYA INDEX NUMEBRS ACTUALLY DONT MEAN MUCH TO THIS FILE                       
* BUT SINCE WE ARE FUDING IT LIKE A TIME PERIOD FILE                            
* JUST PASS DOWN THIS MEANINGLESS NUMBER TO THE PC                              
* TO GET IT TO WORK                                                             
*                                                                               
         ST    R6,ADBLOCK                                                       
         MVI   GOSUBN,GADQT#       GET A(DAY/QH TABLE)                          
         GOTO1 AGOSUB                                                           
                                                                                
         DS    0H                                                               
         ZIC   R1,DBDQPTR                                                       
         BCTR  R1,0                                                             
         CLI   DBSELMED,C'N'                                                    
         BNE   *+8                                                              
         LA    R1,X'01'                                                         
         MHI   R1,DBDQLEN                                                       
         A     R1,ADBDQD                                                        
         XC    FULL,FULL           DETERMINE D/T SUB-INDEX NUMBER               
         ZIC   RF,DBACTSQC                                                      
         ZIC   RE,DBDQSQH-DBDQD(R1)                                             
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         ST    RF,FULL                                                          
         L     R0,ADBDQD                                                        
CULKPH20 CR    R0,R1                                                            
         BNL   CULKPH22                                                         
         AHI   R1,-(DBDQLEN)                                                    
         ZIC   RF,DBDQEQH-DBDQD(R1)                                             
         ZIC   RE,DBDQSQH-DBDQD(R1)                                             
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         A     RF,FULL                                                          
         ST    RF,FULL                                                          
         B     CULKPH20                                                         
CULKPH22 EQU   *                                                                
* NO MAYA NUMBER FOR NOW                                                        
*&&DO                                                                           
***      MVC   THISDTSI,FULL+2     DAY/TIME SUB-INDEX NUMBER                    
         ZICM  RE,THISDTSI,(3)                                                  
         AHI   RE,1                                                             
         STCM  RE,3,THISDTSI                                                    
*&&                                                                             
                                                                                
* JUST POST THE DAYPARTS DAY AND TIMES                                          
         L     RE,DBAQUART                                                      
         USING QHELEM,RE                                                        
         MVC   THISKDAY,QHDAY                                                   
         MVC   THISSQH,QHSQH                                                    
         MVC   THISEQH,QHEQH                                                    
         ZIC   RE,THISEQH                                                       
         AHI   RE,1                                                             
         STC   RE,THISEQH                                                       
         DROP  RE                                                               
*                                                                               
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   CUNHKX                                                           
*                                                                               
         CLI   SVTHSSTN,1                                                       
         BH    CUNHKX                                                           
         CLI   SVTHSBK,1                                                        
         BH    CUNHKX                                                           
         CLC   PREVDAYR,THISDAYR                                                
         BE    CUNHKX                                                           
*                                                                               
         MVC   PREVDAYR,THISDAYR                                                
*                                                                               
         LA    RE,DBLOCK1                                                       
         ST    RE,ADBLOCK                                                       
         MVI   GOSUBN,PDTI#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         B     CUNHKX                                                           
*                                                                               
                                                                                
CULKPH26 DS    0H                  POST ENTIRE PROGRAM                          
CUNHKX    DS    0H                                                              
         J     EXIT                                                             
***********************************************************                     
* TRANSLATE 1 BYTE BOOKTYPE TO ALPHA STATE CODE                                 
* ENTRY DUB+3(1) = 1 BYTE INTERNAL BOOKTYPE = STATCODE                          
* EXIT  HALF = 2 BYTE ALPHA STATE CODE                                          
***********************************************************                     
GETSTATE NTR1                                                                   
         L     R1,ASTACODE                                                      
GETSTA04 CLC   =X'FFFF',0(R1)  MUST FIND ALPHA STATE CODE                       
         BNE   *+6             OR ELSE SOMETHING IS AMISS                       
         DC    H'0'                                                             
         CLC   0(1,R1),DUB+3                                                    
         BE    GETSTA10                                                         
         AHI   R1,L'STACODE                                                     
         B     GETSTA04                                                         
GETSTA10 MVC   HALF,1(R1)                                                       
         J     EXIT                                                             
                                                                                
                                                                                
*&&                                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--MIS+        
               C STUFF)'                                                        
*--------------------- SUBR05 MISCELLANEOUS STUFF --------------------*         
                                                                                
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05--LTO+        
               R && CONSTANTS)'                                                 
*------------------------- LTORG & CONSTANTS -------------------------*         
         LTORG                                                                  
                                                                                
                                                                                
SUBR05L  EQU   *-SUBR05                                                         
         DS    0CL(4096-SUBR05L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
**********************************************************************          
***********************************************************************         
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR05)'            
***********************************************************************         
*======================== SUBROUTINE POOL FIVE =======================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR06Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR06Q                                                    
SUBR06   NMOD1 0,1B0206**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R05#)         SUBTRACT FOR SUB-RTN #5                      
         SLL   R1,2                                                             
         B     R06_00(R1)                                                       
                                                                                
GDM#     EQU   (R06_01-R06_00)/4+R05#   GET DEMOS                               
ADJWCUM# EQU   (R06_02-R06_00)/4+R05#   GET DEMOS                               
CUNHK#   EQU   (R06_03-R06_00)/4+R05#                                           
GSTATE#  EQU   (R06_04-R06_00)/4+R05#                                           
IDB#     EQU   (R06_05-R06_00)/4+R05#                                           
PDDR#    EQU   (R06_06-R06_00)/4+R05#   POST DUMMY DATA RECORD                  
GADLD#   EQU   (R06_07-R06_00)/4+R05#   POST DUMMY DATA RECORD                  
FCANLAT# EQU   (R06_08-R06_00)/4+R05#   FORMAT CANADA LATEST                    
SETSTAB# EQU   (R06_09-R06_00)/4+R05#   SET STABK ENTRY (CANADA)                
CHKLIVE# EQU   (R06_10-R06_00)/4+R05#   CHECK LIVE ZEROCELL BK                  
NONZERO# EQU   (R06_11-R06_00)/4+R05#   SET STANDARD BOOKTYPE                   
D32PV#   EQU   (R06_12-R06_00)/4+R05#   DOWNLOAD PAV DATA                       
CHKNHUT# EQU   (R06_13-R06_00)/4+R05#   CHECK NEW HUT                           
                                                                                
R06_00   DS    0H                                                               
R06_01   B     GETDEM              GET DEMOS                                    
R06_02   B     ADJWHCUM            ADJSUT WEEKLY HOMES CUMS                     
R06_03   B     CUNHOOK             BUILD DBLOCK                                 
R06_04   B     GETSTATE            GET STATE CODE                               
R06_05   B     INITDBLK            INIT DBLOCK                                  
R06_06   B     PDUMDREC            POST DUMMY DATA RECORD                       
R06_07   B     GADLDTAB            GET A(DOWNLOAD DATA TABLES)                  
R06_08   B     FCANLAT                                                          
R06_09   B     SETSTBK                                                          
R06_10   B     CHKLIVEZ                                                         
R06_11   B     NONZEROC                                                         
R06_12   B     D32DLPAV            DOWNLOAD PAV DATA                            
R06_13   B     CHKNHUT                                                          
R06#     EQU   (*-R06_00)/4+R05#                                                
         DC    H'0'                                                             
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR06--DML+        
               K)'                                                              
                                                                                
*----------------------------- GET DEMOS -----------------------------*         
                                                                                
* ROUTINE TO EDIT A DEMO VALUE                                                  
* ON ENTRY R3=A(3 BYTE DEMO EXPRESSION)                                         
*          R4=A(3 BYTE DEMO VALUE)                                              
*          R2=A(7 BYTE OUTPUT DEMO VALUE)                                       
*                                                                               
GETDEM   DS    0H                                                               
         XC    DUB,DUB                                                          
         SR    R0,R0                                                            
         ICM   R0,7,0(R4)          R0=DEMO VALUE                                
                                                                                
         CLI   OPTDTYP,C'S'        TEST TO OUTPUT SVI INDICES                   
         BNE   *+16                 NOPE                                        
         TM    DEMFLAG1,DF1STERO    YES, EDIT AS INTEGER VALUE                  
         BO    GETDEM9               DEPENDING IF STEREO SESSION                
         B     GETDEM5               OR NOT                                     
                                                                                
         MVC   DUB(1),DBFIL                                                     
         MVC   DUB+1(1),1(R3)                                                   
         MVI   DUB+2,0                                                          
         L     R1,AEDITTAB         R1=A(EDIT TABLE)                             
         CLI   OPTDEC,C'0'                                                      
         BNE   *+8                                                              
         L     R1,AEDITTA4        R1=A(EDIT TABLE)                              
         CLI   OPTDEC,C'2'                                                      
         BNE   GETDEM0A                                                         
         L     R1,AEDITTA3        R1=A(EDIT TABLE)                              
         CLI   DBMED,C'C'          CANADA?                                      
         JNE   GETDEM0A                                                         
         CLI   DBSRC,C'A'                                                       
         JNE   *+8                                                              
         L     R1,AEDITTA5         R1=A(EDIT TABLE)                             
* 2 DECIMAL CODE                                                                
*                                                                               
******   CLI   OPTDMA,C'I'         IMPRESSION BASED WAS FORCED                  
******   BNE   GETDEM2                                                          
******   CLI   DBMED,C'C'          WE DONT SEND 2 DECIMALS                      
******   BNE   *+12                                                             
******   L     R1,AEDITTAB                                                      
******   B     GETDEM2             4 CANADIAN                                   
GETDEM0A CLI   DBMED,C'N'          WE DO IT FOR NHT                             
         BE    GETDEM0                                                          
         CLI   DBMED,C'C'          WE DO IT FOR BBM                             
         BE    GETDEM0                                                          
         CLI   DBMED,C'W'          DO IT FOR WEEKLY ALSO                        
         BE    GETDEM0                                                          
         CLI   DBMED,C'O'          DO IT FOR OVERNIGHTS                         
         BE    GETDEM0                                                          
         CLI   DBMED,C'T'                                                       
         BNE   GETDEM2                                                          
GETDEM0  DS    0H                                                               
                                                                                
*                                                                               
GETDEM01 TM    DEMFLAG1,DF1STERO+DF1DEM32   DEM32 ?                             
         BO    GETDEM00                                                         
****     CLI   OPTDEC,C'2'        ONLY MAINFRAME TURNS THIS ON                  
*****    BNE   GETDEM00                                                         
*                                                                               
         CLI   SVBINDEC,C'Y'      MAKE SURE THIS RECORD IS CONVERTED            
         BE    GETDEM1                                                          
         L     R1,AEDITTAB         R1=A(EDIT TABLE)                             
         B     GETDEM2                                                          
*                                                                               
GETDEM00 TM    DEMFLAG1,DF1STERO+DF1DEM32   DEM32 ?                             
         BNO   GETDEM2                                                          
         CLI   SVTDRDEC,C'Y'                                                    
         BE    *+12                                                             
         L     R1,AEDITTAB                                                      
         B     GETDEM2                                                          
*                                                                               
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BNL   GETDEM1                                                          
         L     R1,AEDITTAB                                                      
         B     GETDEM2                                                          
*****    BL    GETDEM2                                                          
GETDEM1  DS    0H                                                               
*****    L     R1,AEDITTA2         R1=A(EDIT TABLE2)                            
         TM    DEMFLAG1,DF1STERO+DF1DEM32   DEM32 ?                             
         BNO   GETDEM2                                                          
* DEM32 SESSION CHECK WHAT DECIMAL WAS ASKED FOR                                
         CLI   OPTDEC,C'0'         IF NO DEC= OPTION THEN DEFAULT TO            
         BNL   *+8                 OLD 2 DECIMAL TABLE                          
         L     R1,AEDITTA2         R1=A(EDIT TABLE2) OLD 2 DECIMAL TAB          
                                                                                
* END OF 2 DECIMAL CODE                                                         
*                                                                               
*                                  SEARCH TABLE FOR DEMO                        
GETDEM2  CLI   0(R1),EOT           TEST E-O-T                                   
         BE    GETDEM4                                                          
         CLC   0(2,R1),DUB         MATCH FILE/DEMO MODIFIER                     
         BE    *+12                                                             
         LA    R1,L'EDITTAB(R1)                                                 
         B     GETDEM2                                                          
         MVC   DUB+2(1),2(R1)      EXTRACT EDIT VALUES                          
*                                  EDIT DEMO VALUE                              
GETDEM4  TM    DUB+2,X'80'         TEST DEMO NEEDS SCALING                      
         BZ    *+8                                                              
         MH    R0,=H'10'                                                        
                                                                                
         TM    DEMFLAG1,DF1STERO   IS THIS A STEREO SESSION?                    
         BO    GETDEM9              YES, USE ANOTHER EDIT FORMAT                
*                                                                               
* 2 DECIMAL CODE                                                                
*&&DO                                                                           
         CLI   DBMED,C'W'          WTP STUFF                                    
         BNE   *+12                FORCE BACK TO 1 DECIMAL                      
         MVI   DUB+2,1                                                          
         B     GETDEM4A                                                         
*&&                                                                             
         CLI   DUB+2,2                                                          
         BNE   *+16                                                             
         CLI   SVBINDEC,C'Y'                                                    
         BE    *+8                                                              
         MVI   DUB+2,1                                                          
*                                                                               
*                                                                               
*  END OF 2 DECIMAL CODE                                                        
                                                                                
         CLI   THISTYPE,BINTSHR                                                 
         BE    GETDEM8                                                          
         CLI   THISTYPE,BINTHPT                                                 
         BE    GETDEM8                                                          
         TM    DUB+2,X'02'         TEST EDIT TO 2 DECIMALS                      
         BO    GETDEM6                                                          
GETDEM4A TM    DUB+2,X'01'         TEST EDIT TO 1 DECIMAL                       
         BO    GETDEM8                                                          
GETDEM5  EDIT  (R0),(7,0(R2))                                                   
         B     GETDEMX                                                          
GETDEM6  EDIT  (R0),(7,0(R2)),2,ZERO=BLANK                                      
         B     GETDEMX                                                          
GETDEM8  EDIT  (R0),(7,0(R2)),1,ZERO=BLANK                                      
         B     GETDEMX                                                          
*                                                                               
GETDEM9  DS    0H                  EDITTING DEMOS FOR STEREO                    
         TM    DEMFLAG1,DF1STERO+DF1DEM32   DEM32 ?                             
         BO    GETDEM10                                                         
                                                                                
         TM    DUB+2,X'02'          TEST EDIT TO 2 DECIMALS                     
         BO    GETDEM9B                                                         
         TM    DUB+2,X'01'          TEST EDIT TO 1 DECIMAL                      
         BO    GETDEM9C                                                         
GETDEM9A EDIT  (R0),(7,0(R2)),ALIGN=LEFT,ZERO=NOBLANK                           
         B     GETDEM9X                                                         
GETDEM9B EDIT  (R0),(7,0(R2)),2,ALIGN=LEFT,ZERO=NOBLANK                         
         B     GETDEM9X                                                         
GETDEM9C EDIT  (R0),(7,0(R2)),1,ALIGN=LEFT,ZERO=NOBLANK                         
         B     GETDEM9X                                                         
GETDEM9X ST    R0,FULL                                                          
         B     GETDEMX                                                          
                                                                                
*                                                                               
** DEM32 SESSION DEMO EDITING **                                                
*                                                                               
GETDEM10 DS    0H                  EDITTING DEMOS FOR DEM32                     
         MVI   PRECFLAG,C'N'                                                    
         TM    DUB+2,X'02'          TEST EDIT TO 2 DECIMALS                     
         BO    GETDEM11                                                         
         TM    DUB+2,X'01'          TEST EDIT TO 1 DECIMAL                      
         BO    GETDEM12                                                         
*                                                                               
         CLI   DEMOPRE,0           IF NO PRECISION ALREADY                      
         BE    *+8                                                              
         MVI   PRECFLAG,C'Y'                                                    
         MVI   DEMOPRE,0                                                        
         B     GETDEM13                                                         
GETDEM11 DS    0H                                                               
         CLI   DEMOPRE,2           IF 2 DECIMAL ALREADY                         
         BE    *+8                                                              
         MVI   PRECFLAG,C'Y'                                                    
         MVI   DEMOPRE,2                                                        
         B     GETDEM13                                                         
GETDEM12 DS    0H                                                               
         CLI   DEMOPRE,1           IF 1 DECIMAL PLACE ALREADY                   
         BE    *+8                                                              
GETDM12A MVI   PRECFLAG,C'Y'                                                    
         MVI   DEMOPRE,1                                                        
         B     GETDEM13                                                         
GETDEM13 DS    0H                                                               
         EDIT  (R0),(7,0(R2)),ALIGN=LEFT,ZERO=NOBLANK                           
         ST    R0,FULL                                                          
         B     GETDEMX                                                          
                                                                                
*                                                                               
GETDEMX  DS    0H                                                               
* SPECIAL CODE TO SEE IF DEMOPRE IS 2 DECIMALS, MAKE SURE ITS IN THE            
* DEMOLIST RECORD AS TWO DECIMALS ALSO                                          
*                                                                               
*                                                                               
         CLI   DEMOPRE,2                                                        
         BNE   *+16                                                             
         CLI   SVTDRDEC,C'Y'                                                    
         BE    *+8                                                              
         MVI   DEMOPRE,1                                                        
*                                                                               
         J     EXIT                                                             
*                                                                               
                                                                                
*---------------------ADJUST WEEKLY HOME CUMMS------------------------*         
ADJWHCUM DS    0H                                                               
         LA    R6,DBLOCK1          DEMLOOK BLOCK                                
         USING SPDEMLKD,R6         R6=A(DEMLOOK BLOCK)                          
         TM    DEMFLAG1,DF1STERO+DF1DEM32  MAINFRAME                            
         BZ    DMLKWHHF                                                         
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    DMLKWHHH                                                         
DMLKWHHF L     RF,SPLKALST                                                      
         SR    R1,R1                                                            
DMLKWHHG DS  0H                                                                 
         CLI   0(RF),XFF                                                        
         BE    DMLKWHHK                                                         
         CLI   2(RF),DNWHH1         WEEKLY HOUSEHOLD DEMO?                      
         BL    DMLKWHHH            NOPE                                         
         CLI   2(RF),DNWHH4                                                     
         BH    DMLKWHHH            NOPE                                         
                                                                                
         CLI   OPTDEC,C'0'                                                      
         BNE   DMLKWHHK                                                         
                                                                                
         L     R0,CUMWHH(R1)                                                    
                                                                                
         LR    R5,R1                 SAVE R1 WE HAVE TO USE IT FOR NOW          
         LR    R1,R0                                                            
         SR    R0,R0                                                            
         MH    R0,=F'10'                                                        
****     AHI   R1,5                                                             
         SR    R0,R0                                                            
         D     R0,=F'10'           R1 HAS WEEKLY VALUE                          
         LR    R0,R1                                                            
         LR    R1,R5                 RESTORE R1                                 
         ST    R0,CUMWHH(R1)                                                    
                                                                                
DMLKWHHH DS  0H                                                                 
         LA    R1,4(R1)                                                         
         LA    RF,3(RF)                                                         
         B     DMLKWHHG                                                         
DMLKWHHK DS  0H                                                                 
         DROP  R6                                                               
         J     EXIT                                                             
                                                                                
***********************************************************                     
*---------------COUNTY COVERAGE DEMAND HOOK --------------------------*         
                                                                                
CUNHOOK  NTR1                                                                   
         LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
                                                                                
***      MVI   THISDAYR,1          COMP#                                        
*****    MVI   THISDAYR,0          COMP#                                        
         MVI   THISDAYR,X'FF'      COMP#                                        
***      MVI   THISDTSI,XFF        SINE WE DONT HAVE ROTATIONS                  
****     XC    THISDTSI,THISDTSI   SINE WE DONT HAVE ROTATIONS                  
*                                                                               
** EXTRACT DATA FOR PAV FILE **                                                 
*                                                                               
                                                                                
*                                                                               
         MVC   THISASQC,DBACTSQC   GET ACTUAL START                             
         MVC   THISAEQC,DBACTEQC    AND END QH'S                                
         MVC   THISSQH,DBACTSQC   GET ACTUAL START                              
         MVC   THISEQH,DBACTEQC    AND END QH'S                                 
         ZIC   RE,THISEQH                                                       
         AHI   RE,1                                                             
         STC   RE,THISEQH                                                       
                                                                                
*                                                                               
         DS    0H                  SET PROGRAM NAMES                            
         MVC   WORK,SPACES                                                      
         MVC   DBFILE,=C'TP '                                                   
         GOTO1 VDEFINE,MYDMCB,=C'PROG+',DBLOCK,WORK                             
         MVC   THISPROG,WORK        SET THIS PROGRAM'S NAME                     
         MVC   THISPROG+12(3),SPACES   DONT SHOW WEEKS RUN                      
                                                                                
                                                                                
         DS    0H                  LOOK UP VUTS (TO DERIVE SHARES)              
*                                                                               
         DS    0H                  GO EXTRACT DEMO VALUES                       
*                                                                               
* 2 DECIMAL CODE                                                                
*^^TEST                                                                         
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
*^^EOTEST                                                                       
* END OF 2 DECIMAL CODE                                                         
*                                                                               
         LA    R0,DEMODEMS                                                      
         ST    R0,ADEMLIST          SET A(DEMO LIST)                            
*                                                                               
CULKPH18 DS    0H                  POST INTO SORT BUFFER                        
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
*                                                                               
         MVC   WORK,SPACES                                                      
         GOTO1 VDEFINE,MYDMCB,=C'DAY',DBLOCK,WORK                               
         ZIC   R1,WORK+1                                                        
         SLL   R1,4                (UNDO WHAT DEFINE DID)                       
         STC   R1,THISKDAY                                                      
*                                                                               
         MVC   DBFILE,DBFIL                                                     
*                                                                               
                                                                                
*                                                                               
         DS    0H                                                               
         GOTO1 VDEMOUT,MYDMCB,(C'L',ADEMLIST),DBLOCKD,THISDEMS                  
*                                                                               
* MAYA INDEX NUMEBRS ACTUALLY DONT MEAN MUCH TO THIS FILE                       
* BUT SINCE WE ARE FUDING IT LIKE A TIME PERIOD FILE                            
* JUST PASS DOWN THIS MEANINGLESS NUMBER TO THE PC                              
* TO GET IT TO WORK                                                             
*                                                                               
         ST    R6,ADBLOCK                                                       
         MVI   GOSUBN,GADQT#       GET A(DAY/QH TABLE)                          
         GOTO1 AGOSUB                                                           
                                                                                
         DS    0H                                                               
         ZIC   R1,DBDQPTR                                                       
         BCTR  R1,0                                                             
         CLI   DBSELMED,C'N'                                                    
         BNE   *+8                                                              
         LA    R1,X'01'                                                         
         MHI   R1,DBDQLEN                                                       
         A     R1,ADBDQD                                                        
         XC    FULL,FULL           DETERMINE D/T SUB-INDEX NUMBER               
         ZIC   RF,DBACTSQC                                                      
         ZIC   RE,DBDQSQH-DBDQD(R1)                                             
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         ST    RF,FULL                                                          
         L     R0,ADBDQD                                                        
CULKPH20 CR    R0,R1                                                            
         BNL   CULKPH22                                                         
         AHI   R1,-(DBDQLEN)                                                    
         ZIC   RF,DBDQEQH-DBDQD(R1)                                             
         ZIC   RE,DBDQSQH-DBDQD(R1)                                             
         SR    RF,RE                                                            
         AHI   RF,1                                                             
         A     RF,FULL                                                          
         ST    RF,FULL                                                          
         B     CULKPH20                                                         
CULKPH22 EQU   *                                                                
*&&DO                                                                           
* NO MAYA NUMBER FOR NOW                                                        
***      MVC   THISDTSI,FULL+2     DAY/TIME SUB-INDEX NUMBER                    
         ZICM  RE,THISDTSI,(3)                                                  
         AHI   RE,1                                                             
         STCM  RE,3,THISDTSI                                                    
*&&                                                                             
* JUST POST THE DAYPARTS DAY AND TIMES                                          
         L     RE,DBAQUART                                                      
         USING QHELEM,RE                                                        
         MVC   THISKDAY,QHDAY                                                   
         MVC   THISSQH,QHSQH                                                    
         MVC   THISEQH,QHEQH                                                    
         ZIC   RE,THISEQH                                                       
         AHI   RE,1                                                             
         STC   RE,THISEQH                                                       
         DROP  RE                                                               
*                                                                               
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32                                       
         BNO   CUNHKX                                                           
*                                                                               
         CLI   SVTHSSTN,1                                                       
         BH    CUNHKX                                                           
         CLI   SVTHSBK,1                                                        
         BH    CUNHKX                                                           
         CLC   PREVDAYR,THISDAYR                                                
         BE    CUNHKX                                                           
*                                                                               
         MVC   PREVDAYR,THISDAYR                                                
*&&DO                                                                           
         LA    RE,DBLOCK1                                                       
         ST    RE,ADBLOCK                                                       
         MVI   GOSUBN,PDTI#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         B     CUNHKX                                                           
*&&                                                                             
                                                                                
CULKPH26 DS    0H                  POST ENTIRE PROGRAM                          
CUNHKX    DS    0H                                                              
         J     EXIT                                                             
         DROP  R6                                                               
***********************************************************                     
* TRANSLATE 1 BYTE BOOKTYPE TO ALPHA STATE CODE                                 
* ENTRY DUB+3(1) = 1 BYTE INTERNAL BOOKTYPE = STATCODE                          
* EXIT  HALF = 2 BYTE ALPHA STATE CODE                                          
***********************************************************                     
GETSTATE NTR1                                                                   
         L     R1,ASTACODE                                                      
GETSTA04 CLC   =X'FFFF',0(R1)  MUST FIND ALPHA STATE CODE                       
         BNE   *+6             OR ELSE SOMETHING IS AMISS                       
         DC    H'0'                                                             
         CLC   0(1,R1),DUB+3                                                    
         BE    GETSTA10                                                         
         AHI   R1,L'STACODE                                                     
         B     GETSTA04                                                         
GETSTA10 MVC   HALF,1(R1)                                                       
         J     EXIT                                                             
                                                                                
*                                                                               
INITDBLK DS    0H                                                               
         LA    R1,DBLOCK1                                                       
         USING DBLOCKD,R1                                                       
                                                                                
         XC    DBLOCK,DBLOCK                                                    
         MVC   DBAREC,AIOAREA1     I/O AREA                                     
         MVC   DBCOMFCS,AFAC       COMFACS                                      
         MVC   DBFILE,=C'TP '      DEFAULT TO TIME PERIOD FILE                  
         MVI   DBTAPEP,C'Y'        FORCE IMPRESSION BASED                       
         MVC   DBSELMED,DBMED      MEDIA                                        
         MVC   DBSELSRC,DBSRC      SOURCE                                       
         MVC   DBSELAGY,AGYALPH    AGENCY ALPHA                                 
**       MVC   DBSELBK,BKS         BOOK                                         
         LA    RF,DBSTABK                                                       
         USING STABKD,RF                                                        
         MVC   DBSELBK,STABKS                                                   
         J     EXIT                                                             
                                                                                
         DROP  R1,RF                                                            
*                                                                               
                                                                                
*----------------------- POST DUMMY DATA RECORD ----------------------*         
                                                                                
* Posts dummy records to be used as "space-fillers" when data is                
*  passed back to STEREO.                                                       
                                                                                
PDUMDREC DS    0H                                                               
         CLC   DBFIL,=C'PAV'                                                    
         BE    PDDRPAV                                                          
         B     PDDRX                                                            
                                                                                
*                                                                               
** PAV FILE **                                                                  
*                                                                               
PDDRPAV  DS    0H                                                               
         LA    R4,TSARBLCK                                                      
         USING TSARD,R4                                                         
         ZICM  R2,TSAREC+1,(7)                                                  
         LA    R3,2(R2)                                                         
         USING TSDEMRCD,R3                                                      
         XC    0(TDRFIXL,R3),0(R3)                                              
         MVI   TDRRCTYP,TDRRTDMV    RECORD TYPE = DEMO VALUE                    
         MVC   TDRSTA,SVTHSSTN      STATION                                     
         MVC   TDRBK,SVTHSBK         & BOOK COMBO                               
         MVI   TDRKDAY,X01          DUMMY KEY DAY                               
         MVI   TDRWKS,X'0F'         MIGHT AS WELL PUT ALL WEEKS                 
         OI    TDRFLAG1,TF1DUMDV    DUMMY DEMO VALUE                            
         DROP  R3                                                               
         LA    R0,TDRFIXL+2                                                     
         STCM  R0,3,0(R2)                                                       
         DROP  R4                                                               
*                                                                               
         DS    0H                                                               
         GOTO1 APOST                POST DUMMY DATA RECORD                      
         B     PDDRX                                                            
                                                                                
*                                                                               
PDDRX    DS    0H                                                               
         J     EXIT                                                             
                                                                                
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--GAD+        
               LD#)'                                                            
*-------------------- GET A(DOWNLOAD DATA TABLES) --------------------*         
                                                                                
* Gets address of corresponding download data entry                             
* At entry,                                                                     
*   TMPRCTYP = TSAR demo record type                                            
* At exit,                                                                      
*   ADLDNTRY = A(download data table entry)                                     
                                                                                
GADLDTAB DS    0H                                                               
         ICM   R2,15,ADLDTABS      R2-->DOWNLOAD DATA TABLES                    
         BZ    GADLDX                                                           
         USING DLDTABD,R2                                                       
                                                                                
*                                                                               
GADLD012 DS    0H                                                               
         CLI   DLDTLEN,0                                                        
         BNE   *+6                                                              
         DC    H'0'                                                             
         CLC   DLDTFIL,DBFIL                                                    
         BNE   GADLD018                                                         
         CLC   DLDTSRC,DBSRC                                                    
         BNE   GADLD018                                                         
         CLC   DLDTMED,DBMED                                                    
         BNE   GADLD018                                                         
         CLC   DLDTRTYP,TMPRCTYP                                                
         BNE   GADLD018                                                         
         CLC   DLDTVRSN,D32PCVER                                                
         BH    GADLD018                                                         
         B     GADLD019                                                         
*                                                                               
GADLD018 DS    0H                  BUMP TO NEXT DOWNLOAD DATA ENTRY             
         ZIC   R0,DLDTLEN                                                       
         AR    R2,R0                                                            
         B     GADLD012                                                         
GADLD019 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                                                               
         B     GADLDX                                                           
                                                                                
*                                                                               
GADLDX   DS    0H                                                               
         ST    R2,ADLDNTRY                                                      
         J     EXIT                                                             
         DROP  R2                                                               
*                                                                               
* ROUTINE TO FORMAT A WEEKLY DBACTBK TO A MONTHLY REQUEST BOOK FOR              
* CANADA                                                                        
* THIS IS BECAUSE WE PASS BACK WEEKLY BOOKS EVEN THOUGH WE ASK FOR              
* MONTHLY FILE (FILE=TP)                                                        
*                                                                               
FCANLAT  DS    0X                                                               
**       OC    THISBOOK,THISBOOK                                                
**       JNZ   FCANLATX                                                         
*  CSI LATEST BOOK TP FILE CODE                                                 
         GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     X        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         JNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         L     R0,FULL             R0-->OUTPUT AREA                             
         GOTO1 VDATCON,DMCB,(0,DUB2),(6,(R0))                                   
         L     R0,FULL2                                                         
         L     RF,FULL             BUMP OUTPUT POINTER SO                       
****     LA    RF,3(RF)                                                         
         ST    RF,FULL              BOOKTYPE WON'T OVERWRITE DATE               
         MVI   DUB+3,0             CLEAR OUT BKTYPE W                           
FCANLATX J     EXIT                                                             
                                                                                
* ROUTINE TO SET SET THE CORRECT ACTUAL BOOK READ FOR CANADIAN                  
* LOOKUPS - THIS PROBLEM IS A REAL HAIRY ISSUE STEMMING FROM THE                
* FACT THAT WE CAN GET WEEKLY FOR MONTHLY                                       
* ENTRY R3,R4-> STABKS                                                          
*                                                                               
SETSTBK DS    0H                                                                
* RESET STABK TABLE'S BOOK ENTRY - DEM00 DOESNT LOCK IN THE LATEST              
* BOOK VALUE ANYMORE AND IS PASSING NULLS. WE MUST SET THE BOOK IN              
* THE STABK TABLE TO LAST BOOK READ BY SPDEMLK                                  
* THIS WAY WE CAN FORMAT THE BOOKS CORRECTLY LATER IN THE DEMLINE               
* MODE                                                                          
         USING STABKD,R4                                                        
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   SETSTABX                                                         
         CLC   0(L'ESTBOOK,R3),ESTBOOK                                          
         BE    SETSTABX                                                         
         CLC   0(L'MBKBOOK,R3),MBKBOOK                                          
         BE    SETSTABX                                                         
         LA    RF,L'STABKS                                                      
         CLC   THISDAY,NDAYS       ONLY DO IT ONCE PER STATION/BOOK             
         BNE   SETSTABX            COMBO SO DO IT THE LAST DAYTIME              
         ZIC   RE,THISBK           SINCE ITS THE SAME STA/BK                    
         MR    RE,RE                                                            
         LA    RF,STABKS-L'STABKS(RF)                                           
**       OC    0(2,RF),0(RF)       LATEST?                                      
**       BNZ   SETSTABX                                                         
         MVC   0(2,RF),SVACTBK     THIS IS LATEST SINCE BOOK=0000               
         MVC   3(1,RF),SVBKTYPE                                                 
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)       IF WE ASK FOR C'WTP' , BBM                   
         BNE   *+8                 AND LATEST SET BOOKTYPE TO C'W'              
         CLI   DBSRC,C'A'          BECAUSE WEEKLIES ARE LOADED AS               
         BNE   *+8                 BOOKTYPE C'W'                                
         MVI   3(RF),C'W'                                                       
SETSTABX J     EXIT                                                             
         DROP  R4                                                               
*******************************************************************             
* ROUTINE TO CHECK IF ANY OF THE UPGRADE BOOKS IS LIVE ZERO CELL                
* JUL06 OR LATER                                                                
* IF ONE OF THE  BOOKS IS LIVE ZERO CELL THEN ALL THE OTHER BOOKS               
* PRIOR TO JUL06 WILL READ ZERO CELL BOOKTYPE (1-4)                             
********************************************************************            
* LOOK AT ALL THE BOOKS PARAMETER                                               
CHKLIVEZ LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
         MVC   ZSVBKTYP,DBBTYPE    SAVE BOOKTYPE COMING IN                      
         CLI   DBSELSRC,C'N'                                                    
         BNE   CHKLIVEX                                                         
         CLI   DBSELMED,C'T'                                                    
         BNE   CHKLIVEX                                                         
         CLC   DBSELBK,=X'6A07'    BOOK JUL06 OR LATER?                         
         BNL   CHKLIVEY                                                         
*                                                                               
         B     CHKLIVEX                                                         
* IF THE BOOK BEING LOOKED UP NOW IS JUL06 OR LATER THAN SET THE                
* UPGRADE BOOKTYPE TO ZERO CELL. THE LOGIC IN THE UPGRADE                       
* ROUTINE IS TO REREAD FOR STANDRAD IF ZEROCELL NOT FOUND.                      
*                                                                               
CHKLIVEY CLI   DBBTYPE,C'W'                                                     
         BNE   *+8                                                              
         MVI   OPTUPBT,C'4'                                                     
         CLI   DBBTYPE,C'C'                                                     
         BNE   *+8                                                              
         MVI   OPTUPBT,C'3'                                                     
         CLI   DBBTYPE,C'H'                                                     
         BNE   *+8                                                              
         MVI   OPTUPBT,C'2'                                                     
         CLI   DBBTYPE,0                                                        
         BNE   *+8                                                              
         MVI   OPTUPBT,C'1'                                                     
*                                                                               
CHKLIVEX XIT1                                                                   
*                                                                               
NONZEROC DS    0H                                                               
*                                                                               
* CHECK IF WE ARE ASKING FOR ZERO CELL DATA                                     
*                                                                               
*  CHECK IF ANY OF THE BOOKS TO BE USED IN THE UPGRADE FORMULA                  
*  IS JUL06 OR LATER ..IF SO MAKE SURE WE ONLY SET THE BOOKTYPES                
*  TO 1-4 FOR THE PARALLEL PERIOD BOOKS                                         
*                                                                               
*                                                                               
         MVI   ZCELLBTY,X'FF'         SET DEFAULT VALUE                         
         CLI   DBSELSRC,C'N'                                                    
         BNE   NOZEROX                                                          
         CLI   DBSELMED,C'T'                                                    
         BNE   NOZEROX                                                          
*                                                                               
         CLI   DBBTYPE,C'1'           X'FF'= NOT ZEROCELL BKTYPE                
         BNE   NOZERO2                                                          
         MVC   ZCELLBTY,DBBTYPE                                                 
         MVI   DBBTYPE,0                                                        
         B     NOZEROX                                                          
                                                                                
NOZERO2  CLI   DBBTYPE,C'2'                                                     
         BNE   NOZERO3                                                          
         MVC   ZCELLBTY,DBBTYPE                                                 
         MVI   DBBTYPE,C'H'                                                     
         B     NOZEROX                                                          
NOZERO3  CLI   DBBTYPE,C'3'                                                     
         BNE   NOZERO4                                                          
         MVC   ZCELLBTY,DBBTYPE                                                 
         MVI   DBBTYPE,C'C'                                                     
         B     NOZEROX                                                          
NOZERO4  CLI   DBBTYPE,C'4'                                                     
         BNE   NOZERO5                                                          
         MVC   ZCELLBTY,DBBTYPE                                                 
         MVI   DBBTYPE,C'W'                                                     
         B     NOZEROX                                                          
NOZERO5  DS    0X                                                               
*                                                                               
*                                                                               
NOZEROX  XIT1                                                                   
         DROP  R6                                                               
*                                                                               
*******************************************************************             
* ROUTINE TO CHECK IF NEW HUT BOOK TYPES NEED TO BE APPLIED                     
* IF ONE OF THE HUT/PUT BOOKS ARE LATER THEN JAN/14                             
* AND THE SHARE BOOKS FALL WITHIN THE YEAR 2013                                 
* THEN THE BOOK TYPE WILL BE CHANGED TO THE NEW BOOK TYPE                       
********************************************************************            
* LOOK AT ALL THE BOOKS PARAMETER                                               
CHKNHUT  LA    R6,DBLOCK1                                                       
         USING DBLOCKD,R6                                                       
         MVC   ZSVBKTYP,DBBTYPE    SAVE BOOKTYPE COMING IN                      
         MVI   NHUTFLAG,C'N'                                                    
         CLI   DBSELSRC,C'N'                                                    
         BNE   CHKNHUTX                                                         
         CLI   DBSELMED,C'T'                                                    
         BNE   CHKNHUTX                                                         
* ANY BOOKS EQUAL TO OR LATER THEN JAN/14                                       
*  PUT/HUT BOOK                                                                 
         CLC   OPTUPGD+2(2),=AL2(JAN_14)                                        
         BL    *+14                 HAS TO BE VALID BETWEEN JAN14               
         CLC   OPTUPGD+2(2),=X'9999'   AND 9999                                 
         BL    CHKNHUTY                                                         
         CLC   OPTUPGD+4(2),=AL2(JAN_14)                                        
         BL    *+14                 HAS TO BE VALID BETWEEN JAN14               
         CLC   OPTUPGD+4(2),=X'9999'   AND 9999                                 
         BL    CHKNHUTY                                                         
         CLC   OPTUPGD+6(2),=AL2(JAN_14)                                        
         BL    *+14                 HAS TO BE VALID BETWEEN JAN14               
         CLC   OPTUPGD+6(2),=X'9999'   AND 9999                                 
         BL    CHKNHUTY                                                         
         B     CHKNHUTX                                                         
* IS THEY SHARE BOOK IN THE YEAR 2013                                           
*  SHARE BOOK                                                                   
CHKNHUTY CLC   DBSELBK,=AL2(JAN_13)    BOOK JAN/13 OR LATER?                    
         BL    CHKNHUTX                                                         
         CLC   DBSELBK,=AL2(DEC_13)    BOOK DEC/13 OR LATER?                    
         BH    CHKNHUTX                                                         
* IF THE BOOK BEING LOOKED UP NOW IS JUL06 OR LATER THAN SET THE                
* UPGRADE BOOKTYPE TO ZERO CELL. THE LOGIC IN THE UPGRADE                       
* ROUTINE IS TO REREAD FOR STANDRAD IF ZEROCELL NOT FOUND.                      
*                                                                               
         CLI   DBBTYPE,BOOKTYPE_L                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZL                                              
         CLI   DBBTYPE,BOOKTYPE_U                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZU                                              
         CLI   DBBTYPE,BOOKTYPE_Z                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZZ                                              
         CLI   DBBTYPE,BOOKTYPE_J                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZJ                                              
         CLI   DBBTYPE,BOOKTYPE_LS                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZS                                              
         CLI   DBBTYPE,BOOKTYPE_WS                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZA                                              
         CLI   DBBTYPE,BOOKTYPE_HS                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZE                                              
         CLI   DBBTYPE,BOOKTYPE_L3                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_Z3                                              
         CLI   DBBTYPE,BOOKTYPE_C3                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZD                                              
         CLI   DBBTYPE,BOOKTYPE_W3                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZB                                              
         CLI   DBBTYPE,BOOKTYPE_H3                                              
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZF                                              
         CLI   DBBTYPE,BOOKTYPE_C                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZC                                              
         CLI   DBBTYPE,BOOKTYPE_W                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZW                                              
         CLI   DBBTYPE,BOOKTYPE_H                                               
         BNE   *+8                                                              
         MVI   DBBTYPE,BOOKTYPE_ZH                                              
         CLI   DBBTYPE,BOOKTYPE_STANDARD                                        
         BNE   CHKNHUTX                                                         
         MVI   DBBTYPE,BOOKTYPE_Z7                                              
         MVI   NHUTFLAG,C'Y'       PROCESSING NEW HUT BOOTKYPE                  
*                                                                               
CHKNHUTX XIT1                                                                   
         DROP  R6                                                               
*                                                                               
         TITLE 'DEDEM02 - TP && PAV DEMO LOOK-UPS/UPGRADES (SUBR02--D32+        
               PV#)'                                                            
*--------------------- DEM32 DOWLOAD PROGRAM AVG ---------------------*         
                                                                                
* At entry,                                                                     
*   R5-->TSAR demo record containing TP demo information                        
                                                                                
D32DLPAV DS    0H                                                               
         USING TSDEMRCD,R5                                                      
                                                                                
         LA    RF,DBSTABK             CHECK TO SEE IF VALID BOOK                
         USING STABKD,RF              IF NO VALID DONT DWNLOAD                  
         MVC   DUB(L'STABKS),STABKS   ANY DATA                                  
         DROP  RF                                                               
         CLC   DUB(2),INVBOOK                                                   
         BE    D32PVX                                                           
                                                                                
         DS    0H                  DO SETELEM FOR FALINK FIRST                  
         MVC   FALEMPC,=Y(FMHPVDP)                                              
                                                                                
         CLI   PUFLLOO,C'N'        IS "P/U FROM LAST LEFT OFF" NOT OK?          
         BNE   D32PV012K                                                        
         L     RF,AAPSAV2                                                       
         USING APSAV2D,RF                                                       
         CLC   AS2EMPC,FALEMPC      TRY TO RESUME FROM LAST OFF?                
         BE    *+6                                                              
         DC    H'0'                                                             
         DROP  RF                                                               
         B     D32PV012M                                                        
D32PV012K EQU  *                                                                
                                                                                
         SR    R1,R1                                                            
         GOTO1 ADM32SET                                                         
D32PV012M EQU  *                                                                
                                                                                
                                                                                
         DS    0H                  "RECORD" TYPE                                
         MVC   FALDMPC,=Y(FMDPVDPRTYP)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV029                                                         
*                                                                               
         LA    R0,=AL1(FMDPVDPRTYP_DE)   ASSUME DETAIL LINE                     
         CLI   TDRK2SQH,XFF              TEST IF SUMMARY LINE                   
         BNE   *+8                                                              
         LA    R0,=AL1(FMDPVDPRTYP_RO)    IF SO, INDICATE IT                    
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                ADD DATA TO DOWNLOAD                   
D32PV029 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  STATION NUMBER                               
         MVC   FALDMPC,=Y(FMDPVDPSTNN)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV034                                                         
*                                                                               
         ZICM  RF,TDRSTA,(1)               GET STATION NUMBER                   
         BZ    D32PV034                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV034 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  BOOK NUMBER                                  
         MVC   FALDMPC,=Y(FMDPVDPBKN)                                           
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV039                                                         
*                                                                               
         ZICM  RF,TDRBK,(1)                GET BOOK NUMBER                      
         BZ    D32PV039                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV039 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DAY/TIME NUMBER                              
         MVC   FALDMPC,=Y(FMDPVDPDTN)                                           
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV043                                                         
*                                                                               
         ZICM  RF,TDRDAY,(1)               GET DAY/TIME NUMBER                  
         BZ    D32PV043                                                         
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV043 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  COMPONENT POSITION W/IN ROTATION             
         MVC   FALDMPC,=Y(FMDPVDPCMPN)                                          
         BAS   RE,D32PVOKD                                                      
**       BAS   RE,D32TPOKD                                                      
         BNE   D32PV046                                                         
*                                                                               
         SR    RF,RF                                                            
         CLI   TDRDAYR,XFF                                                      
         BE    *+8                                                              
         IC    RF,TDRDAYR                                                       
         STC   RF,BYTE                                                          
                                                                                
         LA    R0,BYTE                                                          
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
***      BAS   RE,D32TPAD                                                       
D32PV046 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  STATION                                      
         MVC   FALDMPC,=Y(FMDPVDPSTTN)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV059                                                         
*                                                                               
         MVC   MYSTAS,STAS                                                      
         MVC   ALPHAMKT,ALFMKTS                                                 
         MVI   GOSUBN,TSTA#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV059 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  BOOK                                         
         MVC   FALDMPC,=Y(FMDPVDPBOOK)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV069                                                         
*                                                                               
         LA    RF,DBSTABK                                                       
         USING STABKD,RF                                                        
         MVC   DUB(L'STABKS),STABKS    GET BOOK/WEEK#/BOOKTYPE                  
         CLC   DUB(2),ESTBOOK          DONT PASS DURATION FOR PAV               
**       BNE   *+8                     UPGRADES                                 
**       MVI   TDRPDUR,0                                                        
         BNE   *+10                                                             
         XC    TDRPDUR,TDRPDUR                                                  
         DROP  RF                                                               
                                                                                
         MVI   GOSUBN,TBK#             TRANSLATE BOOK                           
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV069 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DAY/START TIME/END TIME                      
         MVC   TMPKSE,TDRK2KDY                                                  
         MVC   THISNDYS,TDRNDAYS                                                
         MVI   GOSUBN,GDY#          GET DAY AND TIMES                           
         GOTO1 AGOSUB                                                           
*                                                                               
         DS    0H                                                               
         TM    TEMPIDAY,X'90'      LOOK FOR SPECIAL INTERNAL DAY CODE           
         BNO   D32PV072X                                                        
         MVC   FALDMPC,=Y(FMDPVDPTDAY)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV072X                                                        
         MVC   WORK+0(2),=C'AV'                                                 
         MVC   WORK+2(1),TEMPIDAY                                               
         OI    WORK+2,X'F0'                                                     
                                                                                
         LA    R0,WORK                                                          
         LHI   R1,3                                                             
         BAS   RE,D32PVAD                                                       
         B     D32PV073                                                         
D32PV072X EQU  *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDPVDPIDAY)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV073                                                         
                                                                                
         LA    R0,TEMPIDAY                                                      
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV073 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDPVDPSTIM)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV076                                                         
                                                                                
         LA    R0,TEMPSTIM                                                      
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV076 EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVC   FALDMPC,=Y(FMDPVDPETIM)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV079                                                         
                                                                                
         LA    R0,TEMPETIM                                                      
         SR    R1,R1                                                            
         BAS   RE,D32PVAD                                                       
D32PV079 EQU   *                                                                
         DS    0H                  TOTAL PROGRAM DUARATION                      
         MVC   FALDMPC,=Y(FMDPVDPGDUR)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV080                                                         
*                                                                               
         XC    WORK,WORK                                                        
         MVC   WORK(L'TDRPDUR),TDRPDUR                                          
         LA    R0,WORK                                                          
         LA    R1,L'TDRPDUR                                                     
         BAS   RE,D32PVAD                                                       
D32PV080 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  ACTIVE WEEKS                                 
         CLI   DBMED,C'O'                                                       
         BE    D32PV084                                                         
         MVC   FALDMPC,=Y(FMDPVDPWKS)                                           
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV084                                                         
*                                                                               
         MVC   TMPWKS,TDRWKS                                                    
         MVI   GOSUBN,TWK#                                                      
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV084 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  PROGRAM NAME                                 
         MVC   FALDMPC,=Y(FMDPVDPPNAM)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV089                                                         
*                                                                               
         MVC   WORK,SPACES                                                      
         MVC   WORK(16),TDRPROG                                                 
         LA    RE,WORK                                                          
         LA    RF,15(RE)                                                        
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         SR    RF,RE                                                            
         LA    RF,1(RF)                                                         
         STH   RF,HALF                                                          
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
D32PV089 EQU   *                                                                
                                                                                
                                                                                
         DS    0H                  DEMO VALUES                                  
         MVC   FALDMPC,=Y(FMDPVDPDMVL)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV099                                                         
*                                                                               
         SR    R6,R6                                                            
         ICM   R6,1,STNDEMS         R6 = # OF DEMOS (ACTUALLY) RQUESTED         
         BZ    D32PV099                                                         
                                                                                
         LA    R2,WORK              R2-->OUTPUT AREA FOR DEMO VALUE             
         L     R3,ASTDMEXP                                                      
         LA    R3,1(R3)             R3-->DEMO EXPRESSIONS                       
         LA    R4,TDRDEMS           R4-->DEMO VALUES                            
         MVI   PRECFLAG,C'Y'       SET DEMO PREC FLAG TO YES                    
         MVI   DEMOPRE,0           SET DEFAULT PREC TO ZERO PLACES              
*                                                                               
D32PV083 DS    0H                                                               
         CLI   PUFLLOO3,C'N'        RE-ESTABLISHED NTH DEMO YET?                
         BNE   D32PV083G             EITHER YES OR N/A                          
         L     RF,AAPSAV2                                                       
         CLM   R6,1,(AS2DEMON-APSAV2D)(RF)                                      
         BNE   D32PV095                                                         
         MVI   PUFLLOO3,C'Y'        RE-ESTABLISHED NTH DEMO,                    
         B     D32PV095              BUT DON'T ADD TO FALINK AGAIN              
D32PV083G EQU  *                                                                
*                                                                               
         MVC   WORK,SPACES          INITIALIZE OUTPUT AREA                      
                                                                                
         OC    0(L'TDRDEMS,R4),0(R4)   IF DEMO VALUE IS ZERO,                   
         BNZ   D32PV085                                                         
         CLC   BKS(2),INVBOOK           AND IT'S AN INVALID BOOK,               
         BNE   D32PV085                                                         
         LA    R1,1                     JUST PASS BACK A BLANK                  
         B     D32PV088                                                         
                                                                                
D32PV085 DS    0H                                                               
         MVI   GOSUBN,GDM#         FORMAT DEMO VALUE                            
         GOTO1 AGOSUB                                                           
         B     D32PV088                                                         
*                                                                               
D32PV088 DS    0H                   R1 = L(FORMATTED DEMO VALUE)                
*                                                                               
D32PV090 MVC   FALDMPC,=Y(FMDPVDPDMVL)                                          
         L     R1,FULL              PICK UP L(FORMATTED DEMO VALUE)             
         LA    R0,WORK                                                          
         BAS   RE,D32PVAD                                                       
*                                                                               
D32PV095 LA    R3,L'DEMS(R3)                                                    
         LA    R4,L'TDRDEMS(R4)                                                 
         BCT   R6,D32PV083                                                      
D32PV099 EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  PURE NUMBER                                  
         MVC   FALDMPC,=Y(FMDPVDPPURE)                                          
         BAS   RE,D32PVOKD                                                      
         BNE   D32PV104                                                         
*                                                                               
         CLC   TDRPURE,=X'FFFF'                                                 
         BE    D32PV104                                                         
                                                                                
         MVC   TMPPURE,TDRPURE                                                  
         MVI   GOSUBN,TPUR#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         LA    R0,WORK                                                          
         LH    R1,HALF                                                          
         BAS   RE,D32PVAD                                                       
*                                                                               
D32PV104 EQU   *                                                                
                                                                                
                                                                                
*                                                                               
D32PVX   DS    0H                                                               
         J     EXIT                                                             
         DROP  R5                                                               
* Little helper routine to see if data can be downloaded                        
* At entry,                                                                     
*   FALDMPC = map code of data to check                                         
                                                                                
D32PVOKD NTR1                                                                   
         MVI   GOSUBN,OKDL#                                                     
         GOTO1 AGOSUB                                                           
         J     EXIT                                                             
                                                                                
                                                                                
* Little helper routine to add data to FALINK buffer                            
* At entry,                                                                     
*   FALDMPC = map code of data to be added                                      
*   R0      = A(data to be added)                                               
                                                                                
D32PVAD  NTR1                                                                   
         ST    R0,ADLDATA          SET A(DATA TO DOWNLOAD)                      
         ST    R1,LDLDATA          SET L(DATA TO DOWNLOAD)                      
         MVI   ADMODE,ADMADD                                                    
         GOTO1 ADM32ADD                                                         
         JL    XITMODL                                                          
                                                                                
         TM    BRKFLAG1,BF1FALNK  DID FALINK CALL FOR A BREAK?                  
         BZ    D32PVADG            NOPE                                         
         L     RF,AAPSAV2          YES, NEED TO SAVE LOCAL VARIABLES            
         USING APSAV2D,RF                                                       
         CLC   FALDMPC,=Y(FMDPVDPDMVL)  IF ADDING DEMO DATA,                    
         BNE   *+8                                                              
         STCM  R6,1,AS2DEMON             SAVE NTH DEMO TO ADDDATA CALL          
         DROP  RF                                                               
         J     XITMOD              EXIT DEM03 NOW                               
D32PVADG EQU   *                                                                
*                                                                               
         J     EXIT                                                             
         LTORG                                                                  
SUBR06L  EQU   *-SUBR06                                                         
         DS    0CL(4096-SUBR06L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
***********************************************************************         
*======================== SUBROUTINE POOL FIVE =======================*         
                                                                                
* At entry,                                                                     
*   R9-->DEMWRKD,                                                               
*   R8-->TWA,                                                                   
*   R7-->DEMTMPD,                                                               
*   R1 = equated sub-routine number.                                            
                                                                                
SUBR07Q  EQU   (((*-DEM02+4095)/4096)*4096)                                     
                                                                                
         ORG   DEM02+SUBR07Q                                                    
SUBR07   NMOD1 0,1B0207**                                                       
         USING DEMWRKD,R9          R9=A(GLOBAL WORK AREA)                       
         USING DEMTWAD,R8          R8=A(TWA)                                    
         USING DEMTMPD,R7          R7=A(TEMP W/S)                               
                                                                                
         L     RC,ALOCWRK                                                       
         USING DM02WRKD,RC                                                      
*                                                                               
         SH    R1,=Y(R06#)         SUBTRACT FOR SUB-RTN #5                      
         SLL   R1,2                                                             
         B     R07_00(R1)                                                       
                                                                                
TBK#     EQU   (R07_01-R07_00)/4+R06#   TRANSLATE BOOK                          
DMUPTP#  EQU   (R07_02-R07_00)/4+R06#   DEMUP TIME PERIOD UPGRADES              
***TRNSBT#  EQU   (R07_03-R07_00)/4+R06#   TRANSLATE BOOKTYPE                   
                                                                                
R07_00   DS    0H                                                               
R07_01   B     TRSLTBK             TRANSLATE BOOK                               
R07_02   B     DEMUPTP             TIME PERIOD UPGRADES                         
***R07_03   B     TRANSBT             TRANSLATE BOOKTYPE                        
R07#     EQU   (*-R07_00)/4+R06#                                                
         DC    H'0'                                                             
*                                                                               
*--------------------------- TRANSLATE BOOK --------------------------*         
                                                                                
* Translates book into a printable format                                       
* At entry,                                                                     
*   DUB+0(4) = book/week#/booktype                                              
* At exit,                                                                      
*   WORK     = formatted book                                                   
*   HALF     = length of formatted book                                         
                                                                                
TRSLTBK  DS    0H                                                               
         MVC   WORK,SPACES                                                      
         LA    R4,WORK                                                          
                                                                                
*                                                                               
         DS    0H                  FORMAT BOOK                                  
         CLC   DUB(2),INVBOOK       CHECK VALIDITY OF BOOK                      
         BE    TBK020                                                           
         CLC   DUB(2),ESTBOOK       CHECK IF ESTIMATE BOOK                      
         BE    TBK030                                                           
         CLC   DUB(2),MBKBOOK       CHECK IF MULTBOOK BOOK                      
         BE    TBK030                                                           
         B     TBK050                                                           
                                                                                
TBK020   DS    0H                  INVALID BOOK                                 
         MVC   DUB(L'BKS),BKS       STILL NEED TO OUTPUT ACT BK INPTTED         
         B     TBK050                                                           
                                                                                
*                                                                               
TBK030   DS    0H                  ESTIMATE BOOK                                
         TM    DEMFLAG1,DF1STERO                                                
         BZ    TBK039                                                           
*                                                                               
         DS    0H                   GET ACTUAL DATA OF NTH BOOK INPUT           
         LA    R1,TSARBLCK                                                      
         SR    R5,R5                                                            
         ICM   R5,7,((TSAREC+1)-TSARD)(R1)                                      
         LA    R5,2(R5)                                                         
         USING TSDEMRCD,R5                                                      
                                                                                
         L     R1,ASTINCHK                                                      
         USING STICKEYD,R1                                                      
TBK032   CLI   STICKKNU,IKNBOO       LOCATE ENTRIES FOR BOOK INPUT              
         BH    TBK037                                                           
         BL    TBK034                                                           
         CLC   STICKNTH,TDRBK        FIND NTH INPUT OF BOOK                     
         BH    TBK037                                                           
         BE    TBK035                                                           
TBK034   ZIC   R0,STICLEN                                                       
         AR    R1,R0                                                            
         B     TBK032                                                           
TBK035   LA    RE,STICDATA         EXTRACT DATA                                 
TBK036   CLI   0(RE),STSPSOPI       UNTIL START-NEST INDICATOR REACHED          
         BE    TBK038               AND EXIT                                    
         MVC   0(1,R4),0(RE)                                                    
         LA    R4,1(R4)                                                         
         LA    RE,1(RE)                                                         
         B     TBK036                                                           
TBK037   LA    R4,1(R4)            ELSE, BUMP 1 FOR DUMMY DATA INPUT            
TBK038   EQU   *                                                                
         B     TBKX                                                             
         DROP  R1,R5                                                            
TBK039   EQU   *                                                                
                                                                                
*                                                                               
TBK050   DS    0H                                                               
         CLI   DBMED,C'W'                                                       
         BE    TBK060                                                           
         CLI   DBMED,C'O'                                                       
         BE    TBK060                                                           
*                                                                               
         DS    0H                                                               
         MVI   STARTDAY,0          USE DEFAULT START DAY IN NSIWEEK             
         CLI   DBMED,C'C'           CHECK FOR CANADIEN                          
         BNE   TBK053X                                                          
         CLI   DBSRC,C'N'            NIELSEN                                    
         BNE   TBK053X                                                          
         CLC   DBFIL,=C'TP '         TIME PERIOD                                
         BNE   TBK053X                                                          
         CLC   DUB(2),=X'6001'       ON OR AFTER JAN/96                         
         BL    TBK053X                                                          
                                                                                
* NEW CODE WTP ASSUME WEEKLYTP ASSUME MONTHLY                                   
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RE)                                                    
         BNE   TBK054X                                                          
*                                                                               
         CLC   DUB(2),=X'6001'       ON OR AFTER JAN/96                         
         BL    TBK053X                                                          
*                                                                               
         MVI   STARTDAY,1           OVERRIDE START DAY TO MONDAY                
         B     TBK060                                                           
TBK053X  EQU   *                                                                
*                                                                               
         DS    0H                                                               
         MVI   STARTDAY,0          USE DEFAULT START DAY IN NSIWEEK             
         CLI   DBMED,C'C'           CHECK FOR CANADIEN                          
         BNE   TBK054X                                                          
         CLI   DBSRC,C'A'            BBM                                        
         BNE   TBK054X                                                          
         CLI   DUB+3,C'W'            BOOKTYPE "W"                               
         BNE   TBK054X                                                          
         CLC   DBFIL,=C'TP '         TIME PERIOD                                
         BNE   TBK054X                                                          
         CLC   DUB(2),=X'6301'       ON OR AFTER JAN/99                         
         BL    TBK054X                                                          
* NEW CODE WTP ASSUME WEEKLYTP ASSUME MONTHLY                                   
         L     RE,ADEMFIL                                                       
         CLC   =C'LPM',8(RE)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RE)                                                    
         BNE   TBK054X                                                          
*                                                                               
         MVI   STARTDAY,1           OVERRIDE START DAY TO MONDAY                
         B     TBK060                                                           
TBK054X  EQU   *                                                                
                                                                                
         B     TBK080              GO FORMAT AS MONTHLY BOOK                    
                                                                                
*                                                                               
TBK060   DS    0H                  FORMAT WEEKLY BOOK                           
         CLI   DBMED,C'O'                                                       
         BNE   *+8                                                              
         MVI   STARTDAY,1                                                       
         GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     +        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         BNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         GOTO1 VDATCON,DMCB,(X'80',DUB2),(5,(R4))                               
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         B     TBK100                                                           
                                                                                
*                                                                               
TBK080   DS    0H                  FORMAT MONTHLY BOOK                          
         CLC   BKS(L'LATBOOK),LATBOOK  CHECK IF LATEST BOOK REQUESTED           
         BE    TBK085                                                           
         CLI   DUB,XFF              CHECK IF LATEST N BOOKS REQUESTED           
         BE    TBK085                                                           
         B     TBK093                                                           
*                                                                               
TBK085   DS    0H                                                               
         MVC   0(6,R4),=C'LATEST'    YES, FORMAT AS LATEST N BOOKS              
         LA    R4,6(R4)                                                         
                                                                                
         CLC   BKS(L'LATBOOK),LATBOOK                                           
         BNE   *+22                                                             
         MVC   0(3,R4),SPACES        A SPACE BEFORE AND AFTER                   
         MVI   1(R4),C'-'             THIS DASH                                 
         LA    R4,3(R4)                                                         
         B     TBK088                                                           
                                                                                
         CLI   DUB,XFF               LATEST N                                   
         BNE   *+18                                                             
         MVC   1(1,R4),DUB+1                                                    
         LA    R4,2(R4)                                                         
         B     TBK088                                                           
                                                                                
         DC    H'0'                                                             
                                                                                
TBK088   DS    0H                                                               
         CLC   BKS(L'LATBOOK),LATBOOK                                           
         BE    TBK093                                                           
         B     TBK100                                                           
*                                                                               
TBK093   DS    0H                                                               
*  IF CANAAIAN MONTHLY FILE REQUEST - HAVE TO CHECK IF THE INTERNAL             
*  BOOK IS WEEKLY AND FORMAT CORRECTLY.  TRANSLATE THE CORRECT WEEKLY           
*  WEEK TO A MONTHLY BOOK DISPLAY                                               
***************************                                                     
*  CSI LATEST BOOK TP FILE CODE                                                 
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   TBK098                                                           
         CLI   DBSRC,C'A'           CANADIAN WTP FILE REQUESTED                 
         BE    TBK096                                                           
         CLC   DUB(2),=X'6001'                                                  
         BL    TBK098                                                           
         B     TBK097                                                           
TBK096   CLI   DUB+3,C'W'                                                       
         BNE   TBK098                                                           
         MVI   DUB+3,0                                                          
TBK097   GOTO1 VNSIWEEK,DMCB,(C'D',DUB),(STARTDAY,VGETDAY),VADDAY,     X        
               VDATCON                                                          
         ZICM  R1,DMCB+1,(7)                                                    
         JNZ   *+6                                                              
         DC    H'0'                                                             
         MVC   DUB2(6),0(R1)                                                    
         GOTO1 VDATCON,DMCB,(0,DUB2),(6,(R4))                                   
**       L     R0,FULL2                                                         
**       L     RF,FULL             BUMP OUTPUT POINTER SO                       
**       LA    RF,3(RF)                                                         
**       ST    RF,FULL              BOOKTYPE WON'T OVERWRITE DATE               
**       B     TBK100                                                           
         CLI   3(R4),C'/'          IF OUTPUT IS MMM/YY,                         
         BNE   *+12                                                             
         MVC   3(2,R4),4(R4)        THEN REMOVE THE '/'                         
         BCTR  R4,0                                                             
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         MVI   0(R4),C' '           AND BLANK OUT "GARBAGE"                     
         B     TBK100                                                           
*                                                                               
**************************                                                      
TBK098   DS    0H                                                               
         GOTO1 VDATCON,DMCB,(X'83',DUB),(6,(R4))                                
         CLI   3(R4),C'/'          IF OUTPUT IS MMM/YY,                         
         BNE   *+12                                                             
         MVC   3(2,R4),4(R4)        THEN REMOVE THE '/'                         
         BCTR  R4,0                                                             
         ZIC   R0,DMCB+4                                                        
         AR    R4,R0                                                            
         MVI   0(R4),C' '           AND BLANK OUT "GARBAGE"                     
         B     TBK100                                                           
                                                                                
*                                                                               
TBK100   DS    0H                  DO BOOK TYPE                                 
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   TBK101                                                           
         CLI   DBSRC,C'A'                                                       
         BNE   TBK101               DONT PRINT OUT THE BOOKTYPE W               
         L     RF,ADEMFIL           FOR WTP  (BBM)                              
         CLC   =C'LPM',8(RF)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RF)                                                    
         BNE   TBK101                                                           
         CLI   DUB+3,C'W'                                                       
         BE    TBK109                                                           
TBK101   DS    0H                                                               
*                                                                               
*                                                                               
         CLI   DBMED,C'U'          COUNTY COVERAGE COVERT BOOKTYPE              
         BNE   TBK105              TO STATE CODE                                
         CLI   DUB+3,0             MUST HAVE STATECODE                          
         BNE   *+6                 OR ELSE SOMETHING IS                         
         DC    H'0'                REALLY AMISS                                 
         MVI   GOSUBN,GSTATE#                                                   
         GOTO1 AGOSUB                                                           
         CLI   DUB+3,0              ANY BOOK TYPE?                              
         BNE   *+6                  MUST HAVE STATECODE OR                      
         DC    H'0'                 ELSE SOMETHING IS AMISS                     
         MVI   0(R4),C'('                                                       
         MVC   1(2,R4),HALF                                                     
         MVI   3(R4),C')'                                                       
         LA    R4,4(R4)                                                         
         B     TBK109                                                           
TBK105   EQU   *                                                                
*                                                                               
         CLI   DUB+3,0              ANY BOOK TYPE?                              
         BE    TBK109                NOPE                                       
         MVI   0(R4),C'('                                                       
*******  MVC   1(1,R4),DUB+3                                                    
* DISPLAY 2 CHARACTER BOOKTYPE                                                  
         XC    DMCB2,DMCB2                                                      
         MVI   DMCB2,12                                                         
         MVC   DMCB2+1(1),DUB+3                                                 
         GOTO1 ATRANSBT                                                         
         MVC   1(2,R4),=C'??'                                                   
         CLI   DMCB2+4,X'FF'                                                    
         BE    *+10                                                             
         MVC   1(2,R4),DMCB2+4                                                  
*                                                                               
         CLI   DMCB2+5,0           1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    TBK106                                                           
         CLI   DMCB2+5,X'40'       1 CHARACTER OR 2 CHARACTER BOOKTYPE?         
         BE    TBK106                                                           
*                                                                               
         MVI   3(R4),C')'          2 CHARACTER BOOKTYPE                         
         AHI   R4,4                ADJUST FOR L(BOOKTYPE)                       
         B     TBK109                                                           
*&&DO                                                                           
         CLI   DBMED,C'T'                                                       
         BNE   TBK106                                                           
         CLI   1(R4),X'81'                                                      
         BL    *+16                                                             
         CLI   1(R4),X'B9'                                                      
         BH    *+8                                                              
         OI    1(R4),X'40'       CAPITAL LETTERS                                
*&&                                                                             
TBK106   MVI   2(R4),C')'                                                       
         LA    R4,3(R4)                                                         
TBK109   EQU   *                                                                
                                                                                
*                                                                               
         DS    0H                  DO WEEK NUMBER                               
         CLI   DUB+2,0              ANY WEEK NUMBER                             
         BE    TBK119                NOPE                                       
         MVC   2(4,R4),=C'WEEK'                                                 
         MVC   6+1(1,R4),DUB+2                                                  
         OI    6+1(R4),X'F0'                                                    
         LA    R4,8(R4)                                                         
TBK119   EQU   *                                                                
                                                                                
*                                                                               
TBKX     DS    0H                                                               
         LA    R0,WORK                                                          
         SR    R4,R0                                                            
         STH   R4,HALF             SET LENGTH INTO HALF                         
*                                                                               
         J     EXIT                                                             
*                                                                               
* TIME PERIOD UOGRADES                                                          
*                                                                               
         USING STABKD,R4                                                        
DEMUPTP  LA    R6,SPDEMUP1         INITIALIZE UPGRADE BLOCK                     
         USING SPDEMUPD,R6         R6=A(UPGRADE BLOCK)                          
         XC    SPDEMUPD(SPDEMUP2),SPDEMUPD                                      
         MVC   SPUPAREC,AIOAREA1                                                
         MVC   SPUPAFAC,AFAC                                                    
         MVC   SPUPAGY,AGYALPH                                                  
         MVC   SPUPMED,DBMED                                                    
         MVC   SPUPSTA,STASTA                                                   
                                                                                
         MVI   SPUPSYS,0                                                        
         L     RF,ASYSNTRY                 FOR REP SET SPUPSYS                  
         CLI   (SYSOVSYS-SYSTABD)(RF),8                                         
         BNE   *+8                                                              
         MVI   SPUPSYS,C'R'                                                     
* I DONT SEE A POINT IN HAVING TO MAINTAIN THIS CHECK ANYMORE                   
* BPOO (11/2011)                                                                
*&&DO                                                                           
         CLI   DBSRC,C'F'                                                       
         BE    DEMUP1                                                           
         CLI   DBSRC,C'N'           SYSCODE ALLOWED FOR                         
         BNE   DEMUP2              NSI CABLE, WIRED AND FUSION                  
         CLI   OPTMBKBT,C'W'                                                    
         BE    *+8                                                              
         CLI   OPTMBKBT,C'4'       ZERO CELL WIRED                              
         BE    *+8                                                              
         CLI   OPTMBKBT,C'3'       CABLE ZERO CELL                              
         BE    *+8                                                              
         CLI   OPTMBKBT,C'C'                                                    
         BE    *+8                                                              
         CLI   OPTMBKBT,C'U'       LIVE CABLE                                   
         BE    *+8                                                              
         CLI   OPTMBKBT,C'Z'       LIUVE WIRED                                  
         BE    *+8                                                              
         CLI   OPTUPBT,C'W'                                                     
         BE    *+8                                                              
         CLI   OPTUPBT,C'4'        ZERO CELL WIRED                              
         BE    *+8                                                              
         CLI   OPTUPBT,C'3'        CABLE ZERO CELL                              
         BE    *+8                                                              
         CLI   OPTUPBT,C'U'        LIVE CABLE                                   
         BE    *+8                                                              
         CLI   OPTUPBT,C'Z'        LIVE WIRED                                   
         BE    *+8                                                              
         CLI   OPTUPBT,C'C'                                                     
         BNE   DEMUP2                                                           
*&&                                                                             
***  MOVE SYSCODE FOR THIS STATION INTO AN AREA FOR SPDEMUP                     
DEMUP1   LA    R0,L'SYSCODES                                                    
         ZIC   R1,THISSTA                                                       
         BCTR  R1,0                                                             
         MR    R0,R0                                                            
         LA    R1,SYSCODES(R1)    R1 POINTS TO CURR SYSCODE FOR STATION         
         MVC   SPUPSYSC,0(R1)                                                   
DEMUP2   DS    0H                                                               
*                                                                               
         CLI   DBMED,C'C'                                                       
         BNE   DEMUP3                                                           
         L     RF,ADEMFIL                                                       
         CLC   =C'LPM',8(RF)                                                    
         BE    DEMUP3                                                           
         CLC   =C'WTP',8(RF)                                                    
         BE    DEMUP3                                                           
*        MVI   DBBEST,C'M'                                                      
*        MVI   DBUSEBBM,C'Y'                                                    
         OI    SPUPOPT2,SPO2CMON+SPO2UBBM                                       
DEMUP3   DS    0H                                                               
*                                                                               
         CLC   0(3,R2),=C'ROT'     IF MULITPLE DAY/TIMES INPUTTED,              
         BE    *+20                 SET UP MULTI-D/T LINK                       
         MVC   SPUPDAY,0(R2)                                                    
         MVC   SPUPTIM,1(R2)                                                    
         B     DEMUP06X                                                         
                                                                                
         DS    0H                  MULTIPLE DAY/TIMES INPUTTED                  
         MVC   DUB+0(4),=C'DYTM'                                                
         LA    RE,DBXTROTN                                                      
         ST    RE,DUB+4                                                         
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTLD,RE                                                        
                                                                                
         ZICM  RF,3(R2),(3)                                                     
         LA    RF,LDTROTN(RF)       1(RF)-->LIST OF DAYS/TIMES                  
         MVC   DBXTLID,=C'DYTM'                                                 
         ZIC   R1,0(RF)                                                         
         AHI   R1,-2                                                            
         EXMVC R1,DBXTLIST,1(RF)                                                
         LA    R1,DBXTLIST+1(R1)                                                
         MVI   0(R1),0                                                          
         DROP  RE                                                               
         OI    SPUPOPTS,SPOPEXT                                                 
DEMUP06X EQU   *                                                                
*                                                                               
         DS    0H                  NEED LONGER DAYS/QHS TABLE                   
         CLI   DBMED,C'T'           FOR MEDIA=USTV                              
         BNE   DEMUPDQX                                                         
         CLI   DBSRC,C'N'           FOR SOURCE=NSI                              
         BNE   DEMUPDQX                                                         
                                                                                
         MVC   DUB+0(4),=C'DBD3'                                                
         LA    RE,DBXTDQT                                                       
         ST    RE,DUB+4                                                         
         XC    0(DBXTDQTL,RE),0(RE)                                             
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#         SET UP MULTI-D/T LINK                       
         GOTO1 AGOSUB                                                           
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         OI    SPUPOPTS,SPOPEXT                                                 
DEMUPDQX EQU   *                                                                
*                                                                               
         MVC   SPUPSPL,STASPILL                                                 
         MVC   SPUPFIL,OPTUPFIL                                                 
         MVC   SPUPBTYP,OPTUPBT                                                 
**** FUDGE IN THE BOOKTYPE FOR NOW FOR BBM WEEKLY                               
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BNE   DEMUP24                                                          
         CLI   DBSRC,C'A'                                                       
         BNE   DEMUP24                                                          
         MVI   SPUPBTYP,C'W'                                                    
         MVI   SPUPBEST,C'N'                                                    
DEMUP24  CLI   SPUPFIL,0                                                        
         BNE   *+8                                                              
         MVI   SPUPFIL,C'T'                                                     
         MVC   SPUPSRC,DBSRC                                                    
         MVC   SPUPTPTT,DBTPTTS                                                 
         MVC   SPUPFBK,OPTUPBK                                                  
         MVC   SPLPMPMK,OPTLPMMK   SET LPM PUT MARKET                           
                                                                                
         MVC   SPUP2YRP,OPT2YRP                                                 
         MVC   SPUP2YRR,OPT2YRR                                                 
         MVC   SPUPUDAY,OPTUPDT                                                 
         MVC   SPUPUTIM,OPTUPDT+1                                               
         MVC   SPUPTYPE(L'OPTUPGD),OPTUPGD                                      
         MVC   SPUPCLI,OPTCLI                                                   
         CLI   PROF1W+3,C'Y'                                                    
         BNE   *+8                                                              
         OI    SPUPOPTS,SPOANGFR                                                
         OC    OPTIMS,OPTIMS       IN MKT SHARE REQST?                          
         BZ    DEMUP30                                                          
         XC    DBXTIMS(DBXTIMSL),DBXTIMS                                        
         LA    RE,DBXTIMS          PASS EXTENSION W/AFFL LIST SET               
         ST    RE,DUB+4                                                         
         MVC   DUB+0(4),=C'IMS '                                                
         L     RF,AOPTNTRY                                                      
         USING OPTTABD,RF                                                       
         CLI   OPTIMSF,C'S'                                                     
         BNE   *+10                                                             
         MVC   DUB+0(4),=C'ISS '                                                
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   RE,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING SPIMSD,RE                                                        
         MVC   SPIMSID,=C'IMS '                                                 
                                                                                
         CLI   OPTIMSF,C'S'                                                     
         BNE   *+10                                                             
         MVC   SPIMSID,=C'ISS '                                                 
         DROP  RF                                                               
*                                                                               
*                                                                               
         MVC   SPIMSAFF(OPTIMSL),OPTIMS                                         
         OI    SPUPOPTS,SPOPEXT     INDICATE EXTEND IN USE                      
         DROP  RE                                                               
* CODE TO SET UP MBKS LINKS FOR WEEKLY                                          
*                                                                               
                                                                                
DEMUP30  OC    OPTMBK(OPTMBKL),OPTMBK                                           
         BZ    DEMUP62                                                          
         CLI   DBMED,C'T'          MONTHLY                                      
         BE    DEMUP31                                                          
         CLI   DBMED,C'W'          WEEKLY                                       
         BE    DEMUP31                                                          
         CLI   DBMED,C'C'          CANADIAN                                     
         BNE   DEMUP62                                                          
*****DEMUP31  OC    OPTMBK+2(OPTMBKL-2),OPTMBK+2                                
DEMUP31  OC    OPTMBK(OPTMBKL),OPTMBK                                           
         BNZ   DEMUP32                                                          
         MVC   SPUPFBK,OPTMBK                                                   
         B     DEMUP62                                                          
DEMUP32  XC    DBXTMBK(DBXTMBKL),DBXTMBK                                        
         LA    RE,DBXTMBK          PASS EXTENSION W/AFFL LIST SET               
         ST    RE,DUB+4                                                         
         MVC   DUB+0(4),=C'MBKS'                                                
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R5,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXMBD,R5                                                        
         MVC   DBXMBID,=C'MBKS'                                                 
         LA    R5,DBXMBKS                                                       
         ST    R5,FULL2             SAVE A(BEGINNING OF LIST)                   
                                                                                
*  NOW DECODE THE BOOKS INTO THE LINK                                           
         LA    R4,OPTMBK                                                        
         MVI   BYTE,0                                                           
         XC    DUB2,DUB2                                                        
         XC    WBZBFLAG,WBZBFLAG                                                
DEMUP34  CLC   =C'WBZ',SPUPSTA    CHECK BOOKS FOR WBZ                           
         BNE   DEMUP34C                                                         
         MVC   HALF,0(R4)                                                       
         TM    1(R4),X'80'        START OF RANGE?                               
         BZ    *+8                                                              
         XI    HALF+1,X'80'                                                     
         CLC   =X'6625',HALF      OCT01/02                                      
         BNH   DEMUP34A                                                         
         CLI   WBZBFLAG,0         FIRST TIME CHECKING WBZ                       
         BNE   *+8                                                              
         MVI   WBZBFLAG,WBZBFORE                                                
         CLI   WBZBFLAG,WBZAFTER  WBZ BOOK BEFORE 10/01/02                      
         BE    DEMUP34B           MAKE SURE ALL BOOKS ASKED                     
         BNE   DEMUP34C           IS BEFORE 10/01/02                            
                                                                                
DEMUP34A CLI   WBZBFLAG,0         FIRST TIME CHECKING WBZ                       
         BNE   *+8                                                              
         MVI   WBZBFLAG,WBZAFTER                                                
         CLI   WBZBFLAG,WBZBFORE  WBZ BOOK AFTER 10/01/02                       
         BE    DEMUP34B           MAKE SURE ALL BOOKS ASKED                     
         MVI   WBZBFLAG,WBZAFTER  IS AFTER  10/01/02                            
         B     DEMUP34C                                                         
DEMUP34B MVI   FERN,159           MUST BE LATER THAN OCT0102                    
         B     DEMUP48                                                          
DEMUP34C TM    1(R4),X'80'        START OF RANGE?                               
         BO    DEMUP36                                                          
DEMUP35  L     RE,FULL2           FIRST BOOK GOES TO SPUPFBK                    
         CR    RE,R5                                                            
         BNE   *+10                                                             
         MVC   SPUPFBK,0(R4)                                                    
                                                                                
         MVC   0(2,R5),0(R4)                                                    
         AHI   R5,2                NEXT OUTPUT AREA                             
         AHI   R4,2                NEXT CHUNK OF OPTMBK LIST                    
                                                                                
         B     DEMUP54                                                          
DEMUP36  MVC   DUB2(2),2(R4)      SAVE END BOOK RANGE                           
         XI    DUB2+1,X'40'       TURN OFF END RANGE FLAG IN DUB2               
         TM    3(R4),X'40'         NEXT BOOK MUST BE END RANGE                  
         BO    *+6                                                              
         DC    H'0'                                                             
                                                                                
         CLC   =C'WBZ',SPUPSTA                                                  
         BNE   DEMUP36B                                                         
         CLC   =X'6625',DUB2      CHECK END BOOK RANGE WBZ                      
         BNH   DEMUP36A           CONSISTENCY WITH START                        
         CLI   WBZBFLAG,WBZAFTER  BOOK RANGE                                    
         BE    DEMUP34B                                                         
         B     DEMUP36B                                                         
DEMUP36A CLI   WBZBFLAG,WBZBFORE                                                
         BE    DEMUP34B                                                         
                                                                                
DEMUP36B MVC   0(2,R5),0(R4)      MOVE IN BEGINING OF RANGE                     
         XI    1(R5),X'80'        TURN OFF START RANGE FLAG                     
         ZIC   R1,0(R5)           R1=YEAR#                                      
         ZIC   R0,1(R5)           R0=WEEK#                                      
                                                                                
         L     RE,FULL2           FIRST BOOK GOES TO SPUPFBK                    
         CR    RE,R5                                                            
         BNE   *+10                                                             
         MVC   SPUPFBK,0(R5)                                                    
         AHI   R5,2                                                             
DEMUP38  AHI   R0,1                                                             
         CHI   R0,52              IF HIGHER THAN WEEK 52                        
         BNH   DEMUP40                                                          
*  NEXT YEAR RECALCULATE YEAR AND WEEK#                                         
         SHI   R0,52              NEW WEEK NUMBER                               
         AHI   R1,1               NEW YEAR                                      
                                                                                
DEMUP40  XC    DUB,DUB                                                          
         STC   R1,DUB                                                           
         STC   R0,DUB+1                                                         
         CLC   DUB(2),DUB2        COMPARE NEXT BOOK TO END BOOK                 
         BH    DEMUP50                                                          
DEMUP41  MVC   0(2,R5),DUB        MOVE IN NEXT BOOK INTO LIST                   
         AHI   R5,2                                                             
         L     RF,FULL2                                                         
         AHI   RF,53*2            ONLY 53 BOOKS ALLOWED                         
         CR    R5,RF                                                            
         BL    *+16                                                             
         MVI   FERN,148                                                         
DEMUP48  MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
         B     DEMUP38            CREATE NEXT BOOK                              
DEMUP50  AHI   R4,4               PROCESS NEXT CHUNK OF OPTMBK LIST             
DEMUP54  L     RF,FULL2                                                         
         AHI   RF,53*2            ONLY 53 BOOKS ALLOWED                         
         CR    R5,RF                                                            
         BL    *+16                                                             
         MVI   FERN,148                                                         
         MVI   APMODE,FORCEEND                                                  
         J     XITMODL                                                          
         CLI   0(R4),0            END OF OPTMBK LIST?                           
         BNE   DEMUP34                                                          
         DROP  R5                                                               
                                                                                
                                                                                
DEMUP62  DS    0H                                                               
* SET USERID                                                                    
         LA    RE,DBXUID           PASS EXTENSION W/AFFL LIST SET               
         ST    RE,DUB+4                                                         
         MVC   DUB+0(4),=C'UID '                                                
         MVI   SDBXF,C'U'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
                                                                                
         ICM   R5,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXUIID,R5                                                       
         MVC   DBXUIID,=C'UID '                                                 
         MVC   DBXUUID,USERID                                                   
*****    CLI   PRECPROF,C'I'       'I' PRECISION REQUESTED?                     
*****    BNE   *+8                  YES, PASS                                   
*****  FORCE TO BE IMPRESSIONS BASED                                            
         OI    SPUPOPTS,SPOPDMAI     THROUGH PRECISION FOR UPGRADES             
                                                                                
         CLI   PROF1W+7,C'Y'       normalize huts/puts requested                
         BNE   *+8                  YES, PASS                                   
         OI    SPUPOPTS,SPOPNORM     THROUGH FOR UPGRADES                       
                                                                                
         CLI   PROF1W+8,C'M'       FOR CSI/BBM WEEKLY                           
         BNE   SETOP2X              CALC MONTH                                  
         L     RE,ADEMFIL                                                       
         CLC   =C'WTP',8(RE)                                                    
         BE    *+8                                                              
         OI    SPUPOPT2,SPO2CMON                                                
         CLI   PROF1W+9,C'Y'                                                    
         BNE   *+8                                                              
         OI    SPUPOPT2,SPO2UBBM                                                
SETOP2X  DS    0C                                                               
                                                                                
         L     RF,ASYSNTRY                                                      
         CLI   (SYSOVSYS-SYSTABD)(RF),8  IF REP SYSTEM,                         
         BNE   *+8                                                              
         OI    SPUPOPTS,SPOPNORM          ALWAYS NORMALIZE HUT/PUT              
                                                                                
         CLI   OPTSPRT,0                                                        
         BE    DEMUPGD2                                                         
         OI    SPUPOPTS,SPOSPRTY                                                
         CLI   OPTSPRT,C'Y'                                                     
         BE    DEMUPGD2                                                         
         NI    SPUPOPTS,X'FF'-SPOSPRTY                                          
         OI    SPUPOPTS,SPOSPRTN                                                
         CLI   OPTSPRT,C'N'                                                     
         BE    DEMUPGD2                                                         
         DC    H'0'                                                             
DEMUPGD2 DS    0H                                                               
                                                                                
         CLC   0(L'MBKBOOK,R3),MBKBOOK                                          
         BNE   DMUPG4X                                                          
         L     RE,ADEMFIL                                                       
         CLC   =C'TP',8(RE)                                                     
         BE    DEMUPGD3                                                         
         CLC   =C'WTP',8(RE)                                                    
         BE    DEMUPGD3                                                         
         CLC   =C'LPM',8(RE)                                                    
         BE    DEMUPGD3                                                         
         MVC   SPUPFBK,OPTMBK                                                   
         MVC   SPUPFBKL,OPTMBK+L'SPUPFBK                                        
DEMUPGD3 MVC   SPUPBTYP,OPTMBKBT                                                
         MVI   SPUPFIL,C'T'                                                     
         MVC   SPUPTYPE(8),=XL8'0400006400000000'                               
         L     RE,ADEMFIL                                                       
         CLC   =C'TP',8(RE)                                                     
         BE    *+10                                                             
         CLC   =C'LPM',8(RE)                                                    
         BE    *+10                                                             
         CLC   =C'WTP',8(RE)                                                    
         BNE   DMUPG4X                                                          
         MVC   SPUPTYPE(8),=XL8'0F00006400000000'  WEEKLY SEND TYPE F           
         CLI   DBSRC,C'A'                                                       
         BNE   DMUPG4X                                                          
         MVI   SPUPBTYP,C'W'                                                    
         MVI   SPUPBEST,C'N'                                                    
DMUPG4X  EQU   *                                                                
         OC    OPTUPGD,OPTUPGD     IN MKT SHARE W/OUT UPG EXPRESS?              
         BNZ   DMUPG6X             DEFAULT TO INDEX 100 CALL                    
                                                                                
         OC    OPTIMS,OPTIMS                                                    
         BZ    DMUPG6X                                                          
****     MVC   SPUPTYPE(8),=XL8'0400006400000000'                               
         MVC   SPUPTYPE(8),=XL8'0A00006400000000'                               
         MVC   SPUPFBK,0(R3)                                                    
         MVC   SPUPBTYP,3(R3)                                                   
                                                                                
DMUPG6X  EQU   *                                                                
         MVI   THISDEC,C'N'           DONT SUPPORT 2 DEC FOR UPGRADES           
*&&DO                                                                           
         CLI   OPTDEC,C'0'            THIS ALLOWS DEC= CARD FOR                 
         BL    *+8                    UPGRADES - TAKE OUT COMMENTED             
         MVI   THISDEC,C'Y'           WHEN READY                                
*&&                                                                             
*&&DO                                                                           
* 2 DECIMAL CODE                                                                
* BPOO TEST 11/16/2000                                                          
*        DS    0H                  SET UP PRECISION IN DBLOCK EXTNSN            
*                                                                               
         OC    OPTUPBK,OPTUPBK     NO UPGRADE 2 DECIMALS RIGHT NOW TOO          
         BNZ   DEMUP80                                                          
         CLI   OPTDMA,C'I'                                                      
         BNE   DEMUP80                                                          
*                                                                               
         CLI   OPTDEC,C'2'             IF OPTION OF MAINFRAME INVOKED           
         BE    DEMUP65                                                          
*                                                                               
         TM    DEMFLAG1,DF1STERO+DF1DEM32    ONLY DEM32 HAS 2 DEC               
         BNO   DEMUP80                                                          
* ONLY VERSION 1.2.0.3 OR HIGHER                                                
         CLC   D32PCVER,=AL4(XTRCVER7)                                          
         BL    DEMUP80                                                          
*&&                                                                             
*****                                                                           
*********************************************************************           
* PUT BACK FOLLOWING CODE WHEN READY TO DO DEC=2 FOR UPGRADES****               
**********************************************************************          
DEMUP65  DS    0H                                                               
*&&DO                                                                           
*  IF DEC= CARD GIVEN SET UP THE PRECISION STUFF                                
         CLI   OPTDEC,C'0'                                                      
         BL    DEMUP80                                                          
*                                                                               
         XC    DUB,DUB                                                          
         LA    R0,WORK2                                                         
         ST    R0,DUB+4                                                         
         MVC   DUB+0(4),=C'SPOT'                                                
         MVI   SDBXF,C'S'                                                       
         MVI   GOSUBN,SDBX#                                                     
         GOTO1 AGOSUB                                                           
*                                                                               
         ICM   R1,15,FULL                                                       
         BNZ   *+6                                                              
         DC    H'0'                                                             
         USING DBXTTID,R1                                                       
*                                                                               
**** FOR NOW JUST FOR ZEN'S PRECISION SUPPORT FUDGE THE DISPLACEMENT            
**** UNTIL DBEXTRAD DSECT IS LIVE                                               
****     LA    RE,DBXTRC2T                GIVE ZEN HIS DECMIAL                  
****     SHI   RE,1                        SUPPORT                              
****     MVC   0(1,RE),OPTDEC                                                   
         MVC   DBXTSCTL,OPTDEC                                                  
*                                                                               
         MVC   DBXTID(4),=C'SPOT'                                               
         MVI   DBXTTRP,X'01'               1 DEC RTG/PUT                        
         MVI   DBXTTSP,X'01'               1 DEC SHARS                          
         MVI   DBXTTIP,X'02'               IMP'S TO 100'S                       
         MVI   TMPWHOLE,WHOLERTG                                                
         OI    TMPWHOLE,WHOLESHR                                                
         OI    TMPWHOLE,WHOLEPUT                                                
         TM    TMPWHOLE,WHOLERTG           ROUND RATINGS TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTRC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLESHR           ROUND SHARES  TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTSC2T,C'Y'                YEP                                 
         TM    TMPWHOLE,WHOLEPUT           ROUND PUTS    TO WHOLE #S?           
         BZ    *+8                                                              
         MVI   DBXTPC2T,C'Y'                YEP                                 
         DROP  R1                                                               
*&&                                                                             
*                                                                               
***********************************************************************         
* NEW CODE TO TEST DEC=2  100404                                      *         
         CLI   DEC2PROJ,C'Y'                                                    
         BNE   DEMUP80                                                          
         CLI   OPTDEC,C'2'             IF OPTION OF MAINFRAME INVOKED *         
         BNE   DEMUP80                                                *         
         OI    SPUPOPTS,SPOP2DEC                                      *         
         OI    SPUPOPT2,SPOP2IPR   2 DEC IMPRESSIONS                            
         MVI   THISDEC,C'Y'           WHEN READY                      *         
***********************************************************************         
* END OF  2 DECIMAL CODE                                                        
DEMUP80  DS    0H                                                               
*                                                                               
*                                  CALL DEMUP TO CALCULATE DEMOS                
         MVC   SPUPUID,USERID                                                   
         GOTO1 VSPDEMUP,DMCB,SPDEMUPD,DEMODEMS,THISDEMS                         
         CLI   0(R1),0             TEST FOR ERRORS                              
         JNE   EXIT                                                             
         MVC   THISAFFL(3),=C'N/A'                                              
         MVC   THISMNUM(3),=C'N/A'                                              
*                                  SET POSTING KEY VALUES & PROG NAME           
         TM    DEMFLAG1,DF1STERO   IF STEREO SESSION,                           
         BZ    *+8                                                              
         MVI   RECTYPE,TDRRTDMV     INDICATE TYPE OF RECD TO POST               
         MVC   THISPROG,SPUPPRG                                                 
         MVI   THISDAYR,XFF        FORCE HIGHEST DAY # W/IN ROTATION            
         MVC   THISKDAY,THISDAY                                                 
         XI    THISKDAY,X'FF'      SORT TO DAY/TIME END                         
         MVI   THISSQH,X'FF'                                                    
         MVI   THISEQH,X'FF'                                                    
**       BAL   RE,DEMPOST          GO AND POST DEMO VALUES                      
**       BAS   RE,DEMPOST          GO AND POST DEMO VALUES                      
         MVI   GOSUBN,DPST#                                                     
         GOTO1 AGOSUB                                                           
         J     EXIT                                                             
         DROP  R6,R4                                                            
         EJECT                                                                  
*&&DO                                                                           
**********************************************************************          
* TRANSLATE BOOKTYPE BETWEEN INTERNAL AND 2 CHARACTER AND VICE VERSA            
* ENTRY -DMCB2+0(1) = INDICATOR FROM 1 CHAR TO 2 CHAR OR VICE VERSA             
*                   =12 FOR TRANSLATION FROM 1 TO 2 CHARACTER                   
*        DMCB2+(1)  = 1 CHARACTER INTERNAL BOOKTYPE                             
*     OR DMCB2+1(2) = 2 CHARACTER EXTERNAL BOOKTYPE                             
* EXIT   DMCB2+4(1) = 1 CHARACTER INTERNAL BOOKTYPE                             
*     OR DMCB2+4(2) = 2 CHARACTER EXTERNAL BOOKTYPE                             
**********************************************************************          
TRANSBT  DS    0H                                                               
                                                                                
*                                                                               
                                                                                
         L     RF,AFAC                                                          
         ICM   RF,15,CDEMTABS-COMFACSD(RF)                                      
         GOTO1 (RF),DMCB,SPBOOKTB                                               
         ICM   R6,15,0(R1)                                                      
         JNZ   *+6                                                              
         DC    H'0'                                                             
         L     R0,4(R1)            LENGTH OF EACH ENTRY                         
         CLI   DMCB2+0,12          TRANSLATE 1 TO 2 CHAR BOOKTYPE?              
         JE    TRNSBT40                                                         
         USING SPBKTYPD,R6                                                      
                                                                                
TRNSBT10 CLI   0(R6),X'FF'         EOT?                                         
         JNE   TRNSBT20                                                         
         MVI   DMCB2+4,X'FF'       IF NOT IN TABLE                              
         J     TRNSBTX             PASS BACK INVALID INDICATOR                  
                                                                                
TRNSBT20 OC    DMCB2+1(2),=X'4040' PAD INPUT WITH SPACES                        
         CLC   SPBKTYPA,DMCB2+1    IS BOOKTYPE IN TABLE?                        
         JE    TRNSBT30                                                         
         AR    R6,R0               NO TRY NEXT                                  
         J     TRNSBT10                                                         
TRNSBT30 MVC   DMCB2+4(L'SPBKTYPN),SPBKTYPN  MOVE INTERNAL DEMO BKTYP           
         J     TRNSBTX                                                          
                                                                                
                                                                                
*************************************************************                   
* TRANSLATE FROM 1 CHARACTER INTERNAL TO 2 CHARCTER FORMAT  *                   
*************************************************************                   
TRNSBT40 CLI   0(R6),X'FF'         EOT?                                         
         JNE   TRNSBT50                                                         
         MVI   DMCB2+4,X'FF'       IF INVALID BOOKTYPE THEN RETURN              
         J     TRNSBTX             INVALID INDICATOR                            
                                                                                
TRNSBT50 CLC   SPBKTYPN,DMCB2+1    IS 1 CHARACTER BOOKTYPE IN TABLE?            
         JE    TRNSBT60                                                         
         AR    R6,R0               NO TRY NEXT                                  
         J     TRNSBT40                                                         
TRNSBT60 MVC   DMCB2+4(L'SPBKTYPA),SPBKTYPA  MOVE 2 CHARCTER BOOKTYPE           
*                                                                               
TRNSBTX  J     EXIT                                                             
                                                                                
*&&                                                                             
*                                                                               
         LTORG                                                                  
                                                                                
SUBR07L  EQU   *-SUBR07                                                         
         DS    0CL(4096-SUBR07L+1)                                              
                                                                                
         DROP  R7,R8,R9,RB,RC                                                   
***********************************************************************         
         TITLE 'DEDEM02 - $DEM T/P && PAV DEMO LOOK-UPS/UPGRADES (EQUAT+        
               ES)'                                                             
*                                                                               
***********************************************************************         
*========================== T21B02's EQUATES =========================*         
                                                                                
LOCWORKL EQU   IUNWRKL+DM02WRKL                                                 
***********************************************************************         
         TITLE 'DEDEM02 - $DEM T/P && PAV DEMO LOOK-UPS/UPGRADES (TABLE+        
               S)'                                                              
***********************************************************************         
*=============================== TABLES ==============================*         
                                                                                
*                                  TABLE OF DISPLACEMENTS                       
DISPTAB  DS    0AL(2+2)                                                         
         DC    AL2(GOSUB-DEM02),AL2(AGOSUB-DEMTMPD)                             
         DC    AL2(SUBR01-DEM02),AL2(ASUBR01-DEMTMPD)                           
         DC    AL2(SUBR02-DEM02),AL2(ASUBR02-DEMTMPD)                           
         DC    AL2(SUBR03-DEM02),AL2(ASUBR03-DEMTMPD)                           
         DC    AL2(SUBR04-DEM02),AL2(ASUBR04-DEMTMPD)                           
         DC    AL2(SUBR05-DEM02),AL2(ASUBR05-DEMTMPD)                           
         DC    AL2(SUBR06-DEM02),AL2(ASUBR06-DEMTMPD)                           
         DC    AL2(SUBR07-DEM02),AL2(ASUBR07-DEMTMPD)                           
         DC    AL2(EDITTAB-DEM02),AL2(AEDITTAB-DEMTMPD)                         
* 2 DECIMAL CODE                                                                
*                                                                               
         DC    AL2(EDITTAB2-DEM02),AL2(AEDITTA2-DEMTMPD)                        
         DC    AL2(EDITTAB3-DEM02),AL2(AEDITTA3-DEMTMPD)                        
         DC    AL2(EDITTAB4-DEM02),AL2(AEDITTA4-DEMTMPD)                        
         DC    AL2(EDITTAB5-DEM02),AL2(AEDITTA5-DEMTMPD)                        
*                                                                               
* END OF 2 DECIMAL CODE                                                         
         DC    AL2(KDAYTAB-DEM02),AL2(AKDAYTAB-DEMTMPD)                         
         DC    AL2(IDAYTAB-DEM02),AL2(AIDAYTAB-DEMTMPD)                         
         DC    AL2(VUTLIST-DEM02),AL2(AVUTLIST-DEMTMPD)                         
         DC    AL2(PUTLIST-DEM02),AL2(APUTLIST-DEMTMPD)                         
         DC    AL2(SHRLIST-DEM02),AL2(ASHRLIST-DEMTMPD)                         
         DC    AL2(NUMWKTAB-DEM02),AL2(ANUMWKTB-DEMTMPD)                        
         DC    AL2(FRSTWKTB-DEM02),AL2(A1STWKTB-DEMTMPD)                        
         DC    AL2(PROFTAB-DEM02),AL2(APROFTAB-DEMTMPD)                         
         DC    AL2(DLDATTAB-DEM02),AL2(ADLDTABS-DEMTMPD)                        
         DC    AL2(KDAYTAB2-DEM02),AL2(AKDAYTA2-DEMTMPD)                        
DISPTABQ EQU   (*-DISPTAB)/(L'DISPTAB)                                          
                                                                                
*                                  TABLE FOR DEMO EDITTING ROUTINE              
EDITTAB  DS    0XL3                FILE/DEMO MODIFIER/EDIT RULES                
         DC    C'TC',X'01'         THIS TABLE IS REALLY FOR 1 DECIMAL           
         DC    C'TI',X'01'         PRECISION ALL AROUND                         
         DC    C'TR',X'01'                                                      
         DC    C'TP',X'01'                                                      
         DC    C'TS',X'01'                                                      
         DC    C'TQ',X'01'                                                      
         DC    C'TX',X'01'                                                      
         DC    C'TE',X'01'                                                      
         DC    C'TF',X'01'                                                      
         DC    C'TD',X'01'          ADD THIS IN                                 
         DC    C'PI',X'01'                                                      
         DC    C'PT',X'01'         (IS ACTUALLY TSA IMP, NOT TSA SHR)           
         DC    C'PR',X'01'                                                      
         DC    C'PP',X'01'                                                      
         DC    C'PS',X'01'                                                      
         DC    C'PQ',X'01'                                                      
         DC    C'PX',X'01'                                                      
         DC    C'PD',X'01'                                                      
         DC    C'RR',X'01'                                                      
         DC    C'RA',X'01'                                                      
         DC    C'RC',X'01'                                                      
         DC    C'RU',X'01'                                                      
         DC    C'RI',X'01'                                                      
         DC    C'RO',X'01'                                                      
         DC    C'CI',X'01'                                                      
         DC    C'CR',X'01'                                                      
         DC    C'CE',X'01'                                                      
         DC    C'CF',X'01'                                                      
         DC    C'CU',X'00'                                                      
         DC    C'CS',X'01'                                                      
         DC    C'CL',X'00'                                                      
         DC    C'CA',X'00'                                                      
         DC    C'CC',X'01'                                                      
         DC    C'CD',X'01'                                                      
         DC    AL1(EOT)                                                         
         EJECT                                                                  
*                                                                               
* 2 DECIMAL CODE                                                                
*                                                                               
*                            COULD BE ACTIVATED W OPTION ON MAINFRAME           
* this was activated in previous version for pc whole numbers                   
*                            EDITTABLE FOR DEM32 (2 DECIMALS)                   
EDITTAB2 DS    0XL3                FILE/DEMO MODIFIER/EDIT RULES                
         DC    C'TC',X'01'                                                      
         DC    C'TI',X'02'         KEEP IN MIND THIS TABLE                      
*        DC    C'TR',X'01'         IS FOR 2 DECIMAL PRECISION                   
         DC    C'TR',X'02'         SUPPORT WITHOUT THE DEC=2 OPTION             
         DC    C'TP',X'01'         PASSED BY THE PC BECAUSE                     
*        DC    C'TP',X'02'         WE HAD SUPPORTED 2 DECIMAL ALWAYS            
         DC    C'TS',X'01'         BEING PASSED TO PC                           
*        DC    C'TS',X'02'                                                      
******   DC    C'TA',X'01'                                                      
         DC    C'TQ',X'01'                                                      
         DC    C'TX',X'01'                                                      
         DC    C'TE',X'01'                                                      
         DC    C'TD',X'01'                                                      
         DC    C'PI',X'01'                                                      
         DC    C'PT',X'01'         (IS ACTUALLY TSA IMP, NOT TSA SHR            
****     DC    C'PR',X'01'                                                      
         DC    C'PR',X'02'                                                      
*****    DC    C'PP',X'01'                                                      
         DC    C'PP',X'02'                                                      
*****    DC    C'PS',X'01'                                                      
*****    DC    C'PA',X'01'                                                      
         DC    C'PS',X'02'                                                      
         DC    C'PQ',X'01'                                                      
         DC    C'PX',X'01'                                                      
         DC    C'PD',X'01'                                                      
         DC    C'CI',X'01'                                                      
         DC    C'CR',X'01'                                                      
         DC    C'CE',X'01'                                                      
         DC    C'CF',X'01'                                                      
         DC    C'CU',X'00'                                                      
         DC    C'CS',X'01'                                                      
         DC    C'CL',X'00'                                                      
         DC    C'CA',X'00'                                                      
         DC    C'CC',X'01'                                                      
         DC    C'CD',X'01'                                                      
         DC    AL1(EOT)                                                         
         EJECT                                                                  
                                                                                
*                                                                               
* 2 DECIMAL CODE  WITH SUPPORT OF "DEC=0, 1 OR 2" OPTION FROM PC                
*                                                                               
*                            COULD BE ACTIVATED W OPTION ON MAINFRAME           
*                                                                               
*                            EDITTABLE FOR DEM32 (2 DECIMALS)                   
EDITTAB3 DS    0XL3                FILE/DEMO MODIFIER/EDIT RULES                
         DC    C'TC',X'01'                                                      
         DC    C'TI',X'02'                                                      
         DC    C'TR',X'02'     ONLY SUPPORT 2 DECIMAL FOR RATINGS               
         DC    C'TP',X'01'                                                      
         DC    C'TS',X'01'                                                      
         DC    C'TQ',X'01'                                                      
         DC    C'TX',X'01'                                                      
         DC    C'TE',X'02'                                                      
         DC    C'TD',X'01'                                                      
         DC    C'PI',X'01'                                                      
         DC    C'PT',X'01'         (IS ACTUALLY TSA IMP, NOT TSA SHR            
         DC    C'PR',X'02'                                                      
         DC    C'PP',X'01'                                                      
         DC    C'PS',X'01'                                                      
         DC    C'PQ',X'01'                                                      
         DC    C'PX',X'01'                                                      
         DC    C'PD',X'01'                                                      
         DC    C'CI',X'01'                                                      
         DC    C'CR',X'01'                                                      
         DC    C'CE',X'01'                                                      
         DC    C'CF',X'01'                                                      
         DC    C'CU',X'00'                                                      
         DC    C'CS',X'01'                                                      
         DC    C'CL',X'00'                                                      
         DC    C'CA',X'00'                                                      
         DC    C'CC',X'01'                                                      
         DC    C'CD',X'01'                                                      
         DC    AL1(EOT)                                                         
*                                                                               
*                                  TABLE FOR DEMO EDITTING ROUTINE              
EDITTAB4 DS    0XL3                FILE/DEMO MODIFIER/EDIT RULES                
         DC    C'TC',X'00'         THIS TABLE IS REALLY FOR WHOLE               
         DC    C'TI',X'00'         NUMBERS                                      
         DC    C'TR',X'00'                                                      
         DC    C'TP',X'00'                                                      
         DC    C'TS',X'00'                                                      
         DC    C'TQ',X'00'                                                      
         DC    C'TX',X'00'                                                      
         DC    C'TE',X'00'                                                      
         DC    C'TD',X'00'          ADD THIS IN                                 
         DC    C'PI',X'00'                                                      
         DC    C'PT',X'00'         (IS ACTUALLY TSA IMP, NOT TSA SHR)           
         DC    C'PR',X'00'                                                      
         DC    C'PP',X'00'                                                      
         DC    C'PS',X'00'                                                      
         DC    C'PQ',X'00'                                                      
         DC    C'PX',X'00'                                                      
         DC    C'PD',X'00'                                                      
         DC    C'RR',X'00'                                                      
         DC    C'RA',X'00'                                                      
         DC    C'RC',X'00'                                                      
         DC    C'RU',X'00'                                                      
         DC    C'RI',X'00'                                                      
         DC    C'CI',X'01'                                                      
         DC    C'CR',X'01'                                                      
         DC    C'CE',X'01'                                                      
         DC    C'CF',X'01'                                                      
         DC    C'CU',X'00'                                                      
         DC    C'CS',X'01'                                                      
         DC    C'CL',X'00'                                                      
         DC    C'CA',X'00'                                                      
         DC    C'CC',X'01'                                                      
         DC    C'CD',X'01'                                                      
         DC    AL1(EOT)                                                         
         EJECT                                                                  
*                                                                               
* FOR CANADA                                                                    
* 2 DECIMAL CODE  WITH SUPPORT OF "DEC=0, 1 OR 2" OPTION FROM PC                
*                                                                               
*                            COULD BE ACTIVATED W OPTION ON MAINFRAME           
*                                                                               
*                            EDITTABLE FOR DEM32 (2 DECIMALS)                   
EDITTAB5 DS    0XL3                FILE/DEMO MODIFIER/EDIT RULES                
         DC    C'TC',X'01'                                                      
         DC    C'TI',X'01'                                                      
         DC    C'TR',X'02'     ONLY SUPPORT 2 DECIMAL FOR RATINGS               
         DC    C'TP',X'01'                                                      
         DC    C'TS',X'01'                                                      
         DC    C'TQ',X'01'                                                      
         DC    C'TX',X'01'                                                      
         DC    C'TE',X'02'                                                      
         DC    C'TD',X'01'                                                      
         DC    C'PI',X'01'                                                      
         DC    C'PT',X'01'         (IS ACTUALLY TSA IMP, NOT TSA SHR            
         DC    C'PR',X'02'                                                      
         DC    C'PP',X'01'                                                      
         DC    C'PS',X'01'                                                      
         DC    C'PQ',X'01'                                                      
         DC    C'PX',X'01'                                                      
         DC    C'PD',X'01'                                                      
         DC    C'CI',X'01'                                                      
         DC    C'CR',X'01'                                                      
         DC    C'CE',X'01'                                                      
         DC    C'CF',X'01'                                                      
         DC    C'CU',X'00'                                                      
         DC    C'CS',X'01'                                                      
         DC    C'CL',X'00'                                                      
         DC    C'CA',X'00'                                                      
         DC    C'CC',X'01'                                                      
         DC    C'CD',X'01'                                                      
         DC    AL1(EOT)                                                         
*                                                                               
STAWIDTH EQU   64                  TOTAL WIDTH OF STATION HEADINGS              
DEMWIDTH EQU   8                   WIDTH FOR ONE DEMO ENTRY                     
         SPACE 1                                                                
*                                  TABLE TO CONVERT KEY DAY VALUES              
KDAYTAB  DS    0XL(1+1+3+1)                                                     
         DC     X'0',X'10',C'MON',X'40'                                         
         DC     X'0',X'20',C'TUE',X'20'                                         
         DC     X'0',X'30',C'WED',X'10'                                         
         DC     X'0',X'40',C'THU',X'08'                                         
         DC     X'0',X'50',C'FRI',X'04'                                         
         DC     X'0',X'60',C'SAT',X'02'                                         
         DC     X'0',X'70',C'SUN',X'01'                                         
         DC     C'T',X'95',C'M-F',X'7C'                                         
         DC     C'T',X'FF',C'VAR',X'00'                                         
         DC     C'P',X'00',C'M-F',X'7C'                                         
         DC     C'P',X'80',C'M-S',X'7F'                                         
         DC     C'P',X'90',C'VAR',X'90'                                         
         DC     C'P',X'FF',C'VAR',X'00'                                         
         DC     C'R',X'95',C'M-F',X'7C'                                         
                                                                                
         DC     X'FF',X'FF',C'???',X'00'                                        
KDAYTAB2 DS    0XL(1+1+3+1)                                                     
         DC     X'0',X'10',C'MON',X'40'                                         
         DC     X'0',X'20',C'TUE',X'20'                                         
         DC     X'0',X'30',C'WED',X'10'                                         
         DC     X'0',X'40',C'THU',X'08'                                         
         DC     X'0',X'50',C'FRI',X'04'                                         
         DC     X'0',X'60',C'SAT',X'02'                                         
         DC     X'0',X'70',C'SUN',X'01'                                         
         DC     C'C',X'95',C'M-F',X'7C'                                         
         DC     C'C',X'96',C'M-S',X'7D'                                         
         DC     C'C',X'97',C'S-S',X'7E'                                         
                                                                                
         DC     X'FF',X'FF',C'???',X'00'                                        
         SPACE 1                                                                
*                                  TABLE TO CONVERT INPUT DAY VALUES            
IDAYTAB  DS    0XL4                                                             
         DC    X'40',C'MON'                                                     
         DC    X'20',C'TUE'                                                     
         DC    X'10',C'WED'                                                     
         DC    X'08',C'THU'                                                     
         DC    X'04',C'FRI'                                                     
         DC    X'02',C'SAT'                                                     
         DC    X'01',C'SUN'                                                     
         DC    X'FF'                                                            
*                                                                               
VUTLIST  DC    X'81',C'V',AL1(1)   RATING TIMES SHARE                           
         DC    X'81',C'V',AL1(2)                                                
         DC    X'81',C'V',AL1(3)                                                
         DC    X'FF'                                                            
                                                                                
PUTLIST  DC    X'81',C'P',AL1(1)   STRAIGHT PUT                                 
         DC    X'81',C'P',AL1(2)                                                
         DC    X'81',C'P',AL1(3)                                                
         DC    X'FF'                                                            
                                                                                
SHRLIST  DC    X'00',C'S',AL1(1)   SHARES                                       
         DC    X'00',C'S',AL1(2)                                                
         DC    X'00',C'S',AL1(3)                                                
         DC    X'FF'                                                            
*                                                                               
NUMWKTAB DC    AL1(0,1,1,2,1,2,2,3,1,2,2,3,2,3,3,4)                             
FRSTWKTB DC    AL1(0,4,3,3,2,2,2,2,1,1,1,1,1,1,1,1)                             
         EJECT                                                                  
*                                  TABLE OF PROFILE INFORMATION                 
PROFTAB  DS    0X                                                               
PRFTBID  DS     CL4                 PROFILE ID                                  
PRFTBRTN DS     AL2                 ROUTINE TO GET PROFILE                      
PRFTBASV DS     AL2                 A(FIELD) TO STORE PROFILE                   
PRFTBLSV DS     XL1                 L(FIELD) TO STORE PROFILE                   
PRFTBQ   EQU   *-PROFTAB           L(PROFILE INFO ENTRY)                        
         ORG   PROFTAB                                                          
         DC    C'RRMP',AL2(GPRFRRMP00-GETPROFL),AL2(PROFRRMP-DEMWRKD)           
         DC    AL1(L'PROFRRMP)                                                  
         DC    AL1(EOT)                                                         
         EJECT                                                                  
*======================== DOWNLOAD DATA TABLES =======================*         
                                                                                
DLDATTAB    DS  0D                                                              
                                                                                
                                                                                
TNT098267A  DS  0X                                                              
            DC   AL1(TNT098267AX-TNT098267A)                                    
            DC   C'TP NT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TNT098267AA DS   0X                                                             
            DC    AL1(TNT098267AAX-TNT098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(FMDTPDPAFFL)                                              
            DC    AL2(FMDTPDPMNAM)                                              
            DC    AL2(0)                                                        
TNT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TNT098267AX EQU *                                                               
                                                                                
                                                                                
TNT098267B  DS  0X                                                              
            DC   AL1(TNT098267BX-TNT098267B)                                    
            DC   C'TP NT'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TNT098267BA DS   0X                                                             
            DC    AL1(TNT098267BAX-TNT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TNT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TNT098267BX EQU *                                                               
                                                                                
                                                                                
TNT098296C  DS  0X                                                              
            DC   AL1(TNT098296CX-TNT098296C)                                    
            DC   C'TP NT'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TNT098296CA DS   0X                                                             
            DC    AL1(TNT098296CAX-TNT098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TNT098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TNT098296CX EQU *                                                               
                                                                                
                                                                                
PNT100173A  DS  0X                                                              
            DC   AL1(PNT100173AX-PNT100173A)                                    
            DC   C'PAVNT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL4(XTRCVER4)                                                  
PNT100173AA DS   0X                                                             
            DC    AL1(PNT100173AAX-PNT100173AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(FMDPVDPTDAY)                                              
            DC    AL2(FMDPVDPGDUR)                                              
            DC    AL2(0)                                                        
PNT100173AAX EQU *                                                              
            DC    AL1(0)                                                        
PNT100173AX EQU *                                                               
                                                                                
                                                                                
PNT098267A  DS  0X                                                              
            DC   AL1(PNT098267AX-PNT098267A)                                    
            DC   C'PAVNT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
PNT098267AA DS   0X                                                             
            DC    AL1(PNT098267AAX-PNT098267AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(FMDPVDPGDUR)                                              
            DC    AL2(0)                                                        
PNT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
PNT098267AX EQU *                                                               
                                                                                
                                                                                
PNT098267B  DS  0X                                                              
            DC   AL1(PNT098267BX-PNT098267B)                                    
            DC   C'PAVNT'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
PNT098267BA DS   0X                                                             
            DC    AL1(PNT098267BAX-PNT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
PNT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
PNT098267BX EQU *                                                               
                                                                                
                                                                                
TMT098267A  DS  0X                                                              
            DC   AL1(TMT098267AX-TMT098267A)                                    
            DC   C'TP MT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TMT098267AA DS   0X                                                             
            DC    AL1(TMT098267AAX-TMT098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
TMT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TMT098267AX EQU *                                                               
                                                                                
                                                                                
TMT098267B  DS  0X                                                              
            DC   AL1(TMT098267BX-TMT098267B)                                    
            DC   C'TP MT'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TMT098267BA DS   0X                                                             
            DC    AL1(TMT098267BAX-TMT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TMT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TMT098267BX EQU *                                                               
                                                                                
                                                                                
TMT098296C  DS  0X                                                              
            DC   AL1(TMT098296CX-TMT098296C)                                    
            DC   C'TP MT'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TMT098296CA DS   0X                                                             
            DC    AL1(TMT098296CAX-TMT098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TMT098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TMT098296CX EQU *                                                               
                                                                                
                                                                                
PMT098267A  DS  0X                                                              
            DC   AL1(PMT098267AX-PMT098267A)                                    
            DC   C'PAVMT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
PMT098267AA DS   0X                                                             
            DC    AL1(PMT098267AAX-PMT098267AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(0)                                                        
PMT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
PMT098267AX EQU *                                                               
                                                                                
                                                                                
PMT098267B  DS  0X                                                              
            DC   AL1(PMT098267BX-PMT098267B)                                    
            DC   C'PAVMT'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
PMT098267BA DS   0X                                                             
            DC    AL1(PMT098267BAX-PMT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
PMT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
PMT098267BX EQU *                                                               
                                                                                
                                                                                
TST098267A  DS  0X                                                              
            DC   AL1(TST098267AX-TST098267A)                                    
            DC   C'TP ST'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TST098267AA DS   0X                                                             
            DC    AL1(TST098267AAX-TST098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
TST098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TST098267AX EQU *                                                               
                                                                                
                                                                                
TST098267B  DS  0X                                                              
            DC   AL1(TST098267BX-TST098267B)                                    
            DC   C'TP ST'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TST098267BA DS   0X                                                             
            DC    AL1(TST098267BAX-TST098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TST098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TST098267BX EQU *                                                               
                                                                                
                                                                                
TST098296C  DS  0X                                                              
            DC   AL1(TST098296CX-TST098296C)                                    
            DC   C'TP ST'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TST098296CA DS   0X                                                             
            DC    AL1(TST098296CAX-TST098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TST098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TST098296CX EQU *                                                               
                                                                                
                                                                                
PST098267A  DS  0X                                                              
            DC   AL1(PST098267AX-PST098267A)                                    
            DC   C'PAVST'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
PST098267AA DS   0X                                                             
            DC    AL1(PST098267AAX-PST098267AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(0)                                                        
PST098267AAX EQU *                                                              
            DC    AL1(0)                                                        
PST098267AX EQU *                                                               
                                                                                
                                                                                
PST098267B  DS  0X                                                              
            DC   AL1(PST098267BX-PST098267B)                                    
            DC   C'PAVST'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
PST098267BA DS   0X                                                             
            DC    AL1(PST098267BAX-PST098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
PST098267BAX EQU *                                                              
            DC    AL1(0)                                                        
PST098267BX EQU *                                                               
                                                                                
                                                                                
TAR098267A  DS  0X                                                              
            DC   AL1(TAR098267AX-TAR098267A)                                    
            DC   C'TP AR'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TAR098267AA DS   0X                                                             
            DC    AL1(TAR098267AAX-TAR098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
TAR098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TAR098267AX EQU *                                                               
                                                                                
                                                                                
TAR098267B  DS  0X                                                              
            DC   AL1(TAR098267BX-TAR098267B)                                    
            DC   C'TP AR'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TAR098267BA DS   0X                                                             
            DC    AL1(TAR098267BAX-TAR098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TAR098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TAR098267BX EQU *                                                               
                                                                                
                                                                                
TAR098296C  DS  0X                                                              
            DC   AL1(TAR098296CX-TAR098296C)                                    
            DC   C'TP AR'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TAR098296CA DS   0X                                                             
            DC    AL1(TAR098296CAX-TAR098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TAR098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TAR098296CX EQU *                                                               
                                                                                
DAR098267A  DS  0X                                                              
            DC   AL1(DAR098267AX-DAR098267A)                                    
            DC   C'RDPAR'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
DAR098267AA DS   0X                                                             
            DC    AL1(DAR098267AAX-DAR098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
DAR098267AAX EQU *                                                              
            DC    AL1(0)                                                        
DAR098267AX EQU *                                                               
                                                                                
                                                                                
DAR098267B  DS  0X                                                              
            DC   AL1(TAR098267BX-TAR098267B)                                    
            DC   C'RDPAR'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
DAR098267BA DS   0X                                                             
            DC    AL1(TAR098267BAX-TAR098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
DAR098267BAX EQU *                                                              
            DC    AL1(0)                                                        
DAR098267BX EQU *                                                               
                                                                                
                                                                                
DAR098296C  DS  0X                                                              
            DC   AL1(DAR098296CX-DAR098296C)                                    
            DC   C'RDPAR'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
DAR098296CA DS   0X                                                             
            DC    AL1(DAR098296CAX-DAR098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
DAR098296CAX EQU *                                                              
            DC    AL1(0)                                                        
DAR098296CX EQU *                                                               
                                                                                
                                                                                
THN098267A  DS  0X                                                              
            DC   AL1(THN098267AX-THN098267A)                                    
            DC   C'TP HN'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
THN098267AA DS   0X                                                             
            DC    AL1(THN098267AAX-THN098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
THN098267AAX EQU *                                                              
            DC    AL1(0)                                                        
THN098267AX EQU *                                                               
                                                                                
                                                                                
THN098267B  DS  0X                                                              
            DC   AL1(THN098267BX-THN098267B)                                    
            DC   C'TP HN'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
THN098267BA DS   0X                                                             
            DC    AL1(THN098267BAX-THN098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
THN098267BAX EQU *                                                              
            DC    AL1(0)                                                        
THN098267BX EQU *                                                               
                                                                                
                                                                                
THN098296C  DS  0X                                                              
            DC   AL1(THN098296CX-THN098296C)                                    
            DC   C'TP HN'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
THN098296CA DS   0X                                                             
            DC    AL1(THN098296CAX-THN098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
THN098296CAX EQU *                                                              
            DC    AL1(0)                                                        
THN098296CX EQU *                                                               
                                                                                
                                                                                
PHN098267A  DS  0X                                                              
            DC   AL1(PHN098267AX-PHN098267A)                                    
            DC   C'PAVHN'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
PHN098267AA DS   0X                                                             
            DC    AL1(PHN098267AAX-PHN098267AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(0)                                                        
PHN098267AAX EQU *                                                              
            DC    AL1(0)                                                        
PHN098267AX EQU *                                                               
                                                                                
                                                                                
PHN098267B  DS  0X                                                              
            DC   AL1(PHN098267BX-PHN098267B)                                    
            DC   C'PAVHN'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
PHN098267BA DS   0X                                                             
            DC    AL1(PHN098267BAX-PHN098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
PHN098267BAX EQU *                                                              
            DC    AL1(0)                                                        
PHN098267BX EQU *                                                               
                                                                                
                                                                                
TNW098267A  DS  0X                                                              
            DC   AL1(TNW098267AX-TNW098267A)                                    
            DC   C'TP NW'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TNW098267AA DS   0X                                                             
            DC    AL1(TNW098267AAX-TNW098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(FMDTPDPAFFL)                                              
            DC    AL2(FMDTPDPMNAM)                                              
            DC    AL2(0)                                                        
TNW098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TNW098267AX EQU *                                                               
                                                                                
                                                                                
TNW098267B  DS  0X                                                              
            DC   AL1(TNW098267BX-TNW098267B)                                    
            DC   C'TP NW'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TNW098267BA DS   0X                                                             
            DC    AL1(TNW098267BAX-TNW098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TNW098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TNW098267BX EQU *                                                               
                                                                                
                                                                                
TNW098296C  DS  0X                                                              
            DC   AL1(TNW098296CX-TNW098296C)                                    
            DC   C'TP NW'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TNW098296CA DS   0X                                                             
            DC    AL1(TNW098296CAX-TNW098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TNW098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TNW098296CX EQU *                                                               
                                                                                
                                                                                
TNC098267A  DS  0X                 TP/CSI - DEMO VALUES                         
            DC   AL1(TNC098267AX-TNC098267A)                                    
            DC   C'TP NC'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TNC098267AA DS   0X                                                             
            DC    AL1(TNC098267AAX-TNC098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)     ROTATION TYPE                            
            DC    AL2(FMDTPDPSTNN)     STATION NUMBER                           
            DC    AL2(FMDTPDPBKN)      BOOK NUMBER                              
            DC    AL2(FMDTPDPSBKN)     SUB-BOOK NUMBER                          
            DC    AL2(FMDTPDPDTN)      DAY/TIME NUMBER                          
            DC    AL2(FMDTPDPCMPN)     D/T COMPONENT NUMBER                     
            DC    AL2(FMDTPDPSTTN)     STATION                                  
            DC    AL2(FMDTPDPBOOK)     BOOK                                     
            DC    AL2(FMDTPDPSUBK)     SUB-BOOK                                 
            DC    AL2(FMDTPDPIDAY)     DAY                                      
            DC    AL2(FMDTPDPSTIM)     START TIME                               
            DC    AL2(FMDTPDPETIM)     END TIME                                 
            DC    AL2(FMDTPDPWKS)      WEEKS                                    
            DC    AL2(FMDTPDPPNAM)     PROGRAM NAME                             
            DC    AL2(FMDTPDPDMVL)     DEMO VALUE                               
            DC    AL2(FMDTPDPDUMV)     DUMMY DEMO VALUE                         
            DC    AL2(FMDTPDPPREC)     DEMO PRECISION                           
            DC    AL2(FMDTPDPPTYP)     PROGRAM TYPE                             
            DC    AL2(FMDTPDPDTSI)     DAY/TIME SUB-INDEX                       
            DC    AL2(0)                                                        
TNC098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TNC098267AX EQU *                                                               
                                                                                
                                                                                
TNC098267B  DS  0X                 TP/CSI - DEMO NAME LIST                      
            DC   AL1(TNC098267BX-TNC098267B)                                    
            DC   C'TP NC'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TNC098267BA DS   0X                                                             
            DC    AL1(TNC098267BAX-TNC098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)     DEMO NAME                                
            DC    AL2(FMDDMLSCPP)      CPP FLAG                                 
            DC    AL2(FMDDMLSCPLB)     CPP/CPM LABEL                            
            DC    AL2(0)                                                        
TNC098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TNC098267BX EQU *                                                               
                                                                                
                                                                                
TNC098296C  DS  0X                 TP/CSI - DAY/TIME INDICES                    
            DC   AL1(TNC098296CX-TNC098296C)                                    
            DC   C'TP NC'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TNC098296CA DS   0X                                                             
            DC    AL1(TNC098296CAX-TNC098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)      DAY/TIME NUMBER                          
            DC    AL2(FMDDTIXCMPN)     COMPONENT NUMBER                         
            DC    AL2(FMDDTIXMXSI)     MAX SUB-INDEX NUMBER                     
            DC    AL2(0)                                                        
TNC098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TNC098296CX EQU *                                                               
         EJECT                                                                  
*------------------------------- BBM TP ------------------------------*         
                                                                                
TAC098267A  DS  0X                 TP/BBM - DEMO VALUES                         
            DC   AL1(TAC098267AX-TAC098267A)                                    
            DC   C'TP AC'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TAC098267AA DS   0X                                                             
            DC    AL1(TAC098267AAX-TAC098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)     ROTATION TYPE                            
            DC    AL2(FMDTPDPSTNN)     STATION NUMBER                           
            DC    AL2(FMDTPDPBKN)      BOOK NUMBER                              
            DC    AL2(FMDTPDPSBKN)     SUB-BOOK NUMBER                          
            DC    AL2(FMDTPDPDTN)      DAY/TIME NUMBER                          
            DC    AL2(FMDTPDPCMPN)     D/T COMPONENT NUMBER                     
            DC    AL2(FMDTPDPSTTN)     STATION                                  
            DC    AL2(FMDTPDPBOOK)     BOOK                                     
            DC    AL2(FMDTPDPSUBK)     SUB-BOOK                                 
            DC    AL2(FMDTPDPIDAY)     DAY                                      
            DC    AL2(FMDTPDPSTIM)     START TIME                               
            DC    AL2(FMDTPDPETIM)     END TIME                                 
            DC    AL2(FMDTPDPWKS)      WEEKS                                    
            DC    AL2(FMDTPDPPNAM)     PROGRAM NAME                             
            DC    AL2(FMDTPDPDMVL)     DEMO VALUE                               
            DC    AL2(FMDTPDPDUMV)     DUMMY DEMO VALUE                         
            DC    AL2(FMDTPDPPREC)     DEMO PRECISION                           
            DC    AL2(FMDTPDPPTYP)     PROGRAM TYPE                             
            DC    AL2(FMDTPDPDTSI)     DAY/TIME SUB-INDEX                       
            DC    AL2(0)                                                        
TAC098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TAC098267AX EQU *                                                               
                                                                                
                                                                                
TAC098267B  DS  0X                 TP/BBM - DEMO NAME LIST                      
            DC   AL1(TAC098267BX-TAC098267B)                                    
            DC   C'TP AC'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TAC098267BA DS   0X                                                             
            DC    AL1(TAC098267BAX-TAC098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)     DEMO NAME                                
            DC    AL2(FMDDMLSCPP)      CPP FLAG                                 
            DC    AL2(FMDDMLSCPLB)     CPP/CPM LABEL                            
            DC    AL2(0)                                                        
TAC098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TAC098267BX EQU *                                                               
                                                                                
                                                                                
TAC098296C  DS  0X                 TP/BBM - DAY/TIME INDICES                    
            DC   AL1(TAC098296CX-TAC098296C)                                    
            DC   C'TP AC'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TAC098296CA DS   0X                                                             
            DC    AL1(TAC098296CAX-TAC098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)      DAY/TIME NUMBER                          
            DC    AL2(FMDDTIXCMPN)     COMPONENT NUMBER                         
            DC    AL2(FMDDTIXMXSI)     MAX SUB-INDEX NUMBER                     
            DC    AL2(0)                                                        
TAC098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TAC098296CX EQU *                                                               
         EJECT                                                                  
*------------------------------- ARB TV ------------------------------*         
                                                                                
TAT098267A  DS  0X                                                              
            DC   AL1(TAT098267AX-TAT098267A)                                    
            DC   C'TP AT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TAT098267AA DS   0X                                                             
            DC    AL1(TAT098267AAX-TAT098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
TAT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TAT098267AX EQU *                                                               
                                                                                
                                                                                
TAT098267B  DS  0X                                                              
            DC   AL1(TAT098267BX-TAT098267B)                                    
            DC   C'TP AT'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TAT098267BA DS   0X                                                             
            DC    AL1(TAT098267BAX-TAT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TAT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TAT098267BX EQU *                                                               
                                                                                
                                                                                
TAT098296C  DS  0X                                                              
            DC   AL1(TAT098296CX-TAT098296C)                                    
            DC   C'TP AT'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TAT098296CA DS   0X                                                             
            DC    AL1(TAT098296CAX-TAT098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TAT098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TAT098296CX EQU *                                                               
                                                                                
                                                                                
*------------------------------- RADAR  ------------------------------*         
                                                                                
TRR098267A  DS  0X                                                              
            DC   AL1(TRR098267AX-TRR098267A)                                    
            DC   C'RTPRR'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TRR098267AA DS   0X                                                             
            DC    AL1(TRR098267AAX-TRR098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
TRR098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TRR098267AX EQU *                                                               
                                                                                
                                                                                
TRR098267B  DS  0X                                                              
            DC   AL1(TRR098267BX-TRR098267B)                                    
            DC   C'RTPRR'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TRR098267BA DS   0X                                                             
            DC    AL1(TRR098267BAX-TRR098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TRR098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TRR098267BX EQU *                                                               
                                                                                
                                                                                
TRR098296C  DS  0X                                                              
            DC   AL1(TRR098296CX-TRR098296C)                                    
            DC   C'RTPRR'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TRR098296CA DS   0X                                                             
            DC    AL1(TRR098296CAX-TRR098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TRR098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TRR098296CX EQU *                                                               
                                                                                
******                                                                          
TRR098287A  DS  0X                                                              
            DC   AL1(TRR098287AX-TRR098287A)                                    
            DC   C'TP RR'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TRR098287AA DS   0X                                                             
            DC    AL1(TRR098267AAX-TRR098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(0)                                                        
TRR098287AAX EQU *                                                              
            DC    AL1(0)                                                        
TRR098287AX EQU *                                                               
                                                                                
                                                                                
TRR098287B  DS  0X                                                              
            DC   AL1(TRR098287BX-TRR098287B)                                    
            DC   C'TP RR'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TRR098287BA DS   0X                                                             
            DC    AL1(TRR098287BAX-TRR098287BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TRR098287BAX EQU *                                                              
            DC    AL1(0)                                                        
TRR098287BX EQU *                                                               
                                                                                
                                                                                
TRR098299C  DS  0X                                                              
            DC   AL1(TRR098299CX-TRR098299C)                                    
            DC   C'TP RR'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TRR098299CA DS   0X                                                             
            DC    AL1(TRR098299CAX-TRR098299CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TRR098299CAX EQU *                                                              
            DC    AL1(0)                                                        
TRR098299CX EQU *                                                               
                                                                                
*                                                                               
* COUNTY COVERAGE                                                               
*&&DO                                                                           
CNT100173A  DS  0X                                                              
            DC   AL1(CNT100173AX-CNT100173A)                                    
            DC   C'CTPNU'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL4(XTRCVER4)                                                  
CNT100173AA DS   0X                                                             
            DC    AL1(CNT100173AAX-CNT100173AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(FMDPVDPTDAY)                                              
            DC    AL2(0)                                                        
CNT100173AAX EQU *                                                              
            DC    AL1(0)                                                        
CNT100173AX EQU *                                                               
                                                                                
                                                                                
CNT098267A  DS  0X                                                              
            DC   AL1(CNT098267AX-CNT098267A)                                    
            DC   C'CTPNU'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
CNT098267AA DS   0X                                                             
            DC    AL1(CNT098267AAX-CNT098267AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(0)                                                        
CNT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
CNT098267AX EQU *                                                               
                                                                                
                                                                                
CNT098267B  DS  0X                                                              
            DC   AL1(CNT098267BX-CNT098267B)                                    
            DC   C'CTPNU'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
CNT098267BA DS   0X                                                             
            DC    AL1(CNT098267BAX-CNT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
CNT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
CNT098267BX EQU *                                                               
***************************************************                             
*&&                                                                             
TCT098267A  DS  0X                                                              
            DC   AL1(TCT098267AX-TCT098267A)                                    
            DC   C'CTPNU'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TCT098267AA DS   0X                                                             
            DC    AL1(TCT098267AAX-TCT098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(FMDTPDPTDAY)                                              
            DC    AL2(0)                                                        
TCT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TCT098267AX EQU *                                                               
                                                                                
                                                                                
TCT098267B  DS  0X                                                              
            DC   AL1(TCT098267BX-TCT098267B)                                    
            DC   C'CTPNU'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TCT098267BA DS   0X                                                             
            DC    AL1(TCT098267BAX-TCT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TCT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TCT098267BX EQU *                                                               
                                                                                
                                                                                
TCT098296C  DS  0X                                                              
            DC   AL1(TCT098296CX-TCT098296C)                                    
            DC   C'CTPNU'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TCT098296CA DS   0X                                                             
            DC    AL1(TCT098296CAX-TCT098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TCT098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TCT098296CX EQU *                                                               
*                                                                               
*  TP OVERNIGHTS                                                                
TOT098267A  DS  0X                                                              
            DC   AL1(TOT098267AX-TOT098267A)                                    
            DC   C'TP NO'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TOT098267AA DS   0X                                                             
            DC    AL1(TOT098267AAX-TOT098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(FMDTPDPTDAY)                                              
            DC    AL2(FMDTPDPAFFL)                                              
            DC    AL2(FMDTPDPMNAM)                                              
            DC    AL2(0)                                                        
TOT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TOT098267AX EQU *                                                               
                                                                                
                                                                                
TOT098267B  DS  0X                                                              
            DC   AL1(TOT098267BX-TOT098267B)                                    
            DC   C'TP NO'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TOT098267BA DS   0X                                                             
            DC    AL1(TOT098267BAX-TOT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TOT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TOT098267BX EQU *                                                               
                                                                                
                                                                                
TOT098296C  DS  0X                                                              
            DC   AL1(TOT098296CX-TOT098296C)                                    
            DC   C'TP NO'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TOT098296CA DS   0X                                                             
            DC    AL1(TOT098296CAX-TOT098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TOT098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TOT098296CX EQU *                                                               
***********************************************************                     
*  TP FUSION                                                                    
TTF098267A  DS  0X                                                              
            DC   AL1(TTF098267AX-TTF098267A)                                    
            DC   C'TP FT'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
TTF098267AA DS   0X                                                             
            DC    AL1(TTF098267AAX-TTF098267AA),AL2(FMHTPDP)                    
            DC    AL2(FMDTPDPRTYP)                                              
            DC    AL2(FMDTPDPSTNN)                                              
            DC    AL2(FMDTPDPBKN)                                               
            DC    AL2(FMDTPDPSBKN)                                              
            DC    AL2(FMDTPDPDTN)                                               
            DC    AL2(FMDTPDPCMPN)                                              
            DC    AL2(FMDTPDPSTTN)                                              
            DC    AL2(FMDTPDPBOOK)                                              
            DC    AL2(FMDTPDPSUBK)                                              
            DC    AL2(FMDTPDPIDAY)                                              
            DC    AL2(FMDTPDPSTIM)                                              
            DC    AL2(FMDTPDPETIM)                                              
            DC    AL2(FMDTPDPWKS)                                               
            DC    AL2(FMDTPDPPNAM)                                              
            DC    AL2(FMDTPDPDMVL)                                              
            DC    AL2(FMDTPDPDUMV)                                              
            DC    AL2(FMDTPDPPREC)                                              
            DC    AL2(FMDTPDPPTYP)                                              
            DC    AL2(FMDTPDPDTSI)                                              
            DC    AL2(FMDTPDPTDAY)                                              
            DC    AL2(0)                                                        
TTF098267AAX EQU *                                                              
            DC    AL1(0)                                                        
TTF098267AX EQU *                                                               
                                                                                
                                                                                
TTF098267B  DS  0X                                                              
            DC   AL1(TTF098267BX-TTF098267B)                                    
            DC   C'TP FT'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
TTF098267BA DS   0X                                                             
            DC    AL1(TTF098267BAX-TTF098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
TTF098267BAX EQU *                                                              
            DC    AL1(0)                                                        
TTF098267BX EQU *                                                               
                                                                                
                                                                                
TTF098296C  DS  0X                                                              
            DC   AL1(TTF098296CX-TTF098296C)                                    
            DC   C'TP FT'                                                       
            DC   AL1(TDRRTDTI)                                                  
            DC   AL1(00,98,10,23)                                               
TTF098296CA DS   0X                                                             
            DC    AL1(TTF098296CAX-TTF098296CA),AL2(FMHDTIX)                    
            DC    AL2(FMDDTIXDTN)                                               
            DC    AL2(FMDDTIXCMPN)                                              
            DC    AL2(FMDDTIXMXSI)                                              
            DC    AL2(0)                                                        
TTF098296CAX EQU *                                                              
            DC    AL1(0)                                                        
TTF098296CX EQU *                                                               
***********************************************************                     
*  OVERNIGHTS PAV DOWNLOAD TABLE                                                
POT100173A  DS  0X                                                              
            DC   AL1(POT100173AX-POT100173A)                                    
            DC   C'PAVNO'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL4(XTRCVER4)                                                  
POT100173AA DS   0X                                                             
            DC    AL1(POT100173AAX-POT100173AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(FMDPVDPTDAY)                                              
            DC    AL2(FMDPVDPGDUR)                                              
            DC    AL2(0)                                                        
POT100173AAX EQU *                                                              
            DC    AL1(0)                                                        
POT100173AX EQU *                                                               
                                                                                
                                                                                
POT098267A  DS  0X                                                              
            DC   AL1(POT098267AX-POT098267A)                                    
            DC   C'PAVNO'                                                       
            DC   AL1(TDRRTDMV)                                                  
            DC   AL1(00,98,09,24)                                               
POT098267AA DS   0X                                                             
            DC    AL1(POT098267AAX-POT098267AA),AL2(FMHPVDP)                    
            DC    AL2(FMDPVDPRTYP)                                              
            DC    AL2(FMDPVDPSTNN)                                              
            DC    AL2(FMDPVDPBKN)                                               
            DC    AL2(FMDPVDPSBKN)                                              
            DC    AL2(FMDPVDPDTN)                                               
            DC    AL2(FMDPVDPCMPN)                                              
            DC    AL2(FMDPVDPSTTN)                                              
            DC    AL2(FMDPVDPBOOK)                                              
            DC    AL2(FMDPVDPSUBK)                                              
            DC    AL2(FMDPVDPIDAY)                                              
            DC    AL2(FMDPVDPSTIM)                                              
            DC    AL2(FMDPVDPETIM)                                              
            DC    AL2(FMDPVDPWKS)                                               
            DC    AL2(FMDPVDPPNAM)                                              
            DC    AL2(FMDPVDPDMVL)                                              
            DC    AL2(FMDPVDPDUMV)                                              
            DC    AL2(FMDPVDPPREC)                                              
            DC    AL2(FMDPVDPPURE)                                              
            DC    AL2(FMDPVDPNOR)                                               
            DC    AL2(FMDPVDPGDUR)                                              
            DC    AL2(0)                                                        
POT098267AAX EQU *                                                              
            DC    AL1(0)                                                        
POT098267AX EQU *                                                               
                                                                                
                                                                                
POT098267B  DS  0X                                                              
            DC   AL1(POT098267BX-POT098267B)                                    
            DC   C'PAVNO'                                                       
            DC   AL1(TDRRTDML)                                                  
            DC   AL1(00,98,09,24)                                               
POT098267BA DS   0X                                                             
            DC    AL1(POT098267BAX-POT098267BA),AL2(FMHDMLS)                    
            DC    AL2(FMDDMLSRCAT)                                              
            DC    AL2(FMDDMLSNCAT)                                              
            DC    AL2(FMDDMLSFDNM)                                              
            DC    AL2(FMDDMLSCPP)                                               
            DC    AL2(FMDDMLSCPLB)                                              
            DC    AL2(0)                                                        
POT098267BAX EQU *                                                              
            DC    AL1(0)                                                        
POT098267BX EQU *                                                               
                                                                                
***********************************************************                     
            DC  AL1(0)                                                          
DLDATTABX   EQU *                                                               
*                                                                               
***********************************************************************         
         TITLE 'DEDEM02 - $DEM T/P && PAV DEMO LOOK-UPS/UPGRADES (DEDEM+        
               WRK)'                                                            
       ++INCLUDE DESTACODE                                                      
* DEDEMWRK                                                                      
       ++INCLUDE DEDEMWRK                                                       
         ORG   APSAVE                                                           
         SPACE 1                                                                
* SAVE STORAGE FOR OVERLAY                                                      
*                                                                               
CHUNKLEN DS    H                   TOTAL L'STATION CHUNK                        
HEADLEN  DS    H                   L'STATION HEADINGS                           
STADISP  DS    H                   DISP. INTO HEADING OF STATION                
EXECLEN  DS    H                   L'STATION HEADINGS-2 (FOR EX)                
DATADISP DS    (MAXSTAS)H          DATA DISPS. ONE PER STATION                  
SVTHSSTN DS    XL1                 SAVE STATION # IN STEREO SESSION             
SVTHSBK  DS    XL1                 SAVE BOOK    # IN STEREO SESSION             
STBKDATA DS    CL1                 ANY DATA FOR STTN/BOOK COMBO (Y/N)?          
PRECFLAG DS    CL1                 DID PRECISION CHANGE FOR DEMO                
DEMOPRE  DS    CL1                 PRECISION FOR DEMO                           
RESUMAPP DS    CL1                 RESUMING FROM APPLC BREAK? (Y/X'00')         
SVACTSRC DS    CL1                                                              
SVBKTYPE DS    CL1                                                              
STABKPTR DS    A                   STABKPTR                                     
MYAPSAVL EQU   *-APSAVE                                                         
         DS    0CL(L'APSAVE-MYAPSAVL+1)                                         
         ORG                                                                    
         TITLE 'DEDEM02 - $DEM T/P && PAV DEMO LOOK-UPS/UPGRADES (DBEXT+        
               RAD)'                                                            
***********************************************************************         
*============================= DEDBEXTRAD ============================*         
                                                                                
       ++INCLUDE DEDBEXTRAD                                                     
***********************************************************************         
         TITLE 'DEDEM02 - $DEM T/P && PAV DEMO LOOK-UPS/UPGRADES'               
DM02WRKD DSECT                                                                  
DM02W_RD DS    A                   DEM03'S RD                                   
DM02WRKX EQU   *                                                                
DM02WRKL EQU   DM02WRKX-DM02WRKD                                                
* DSECT TO COVER TEMPORARY WORKING STORAGE                                      
*                                                                               
DEMTMPD  DSECT                                                                  
*                                                                               
MYDMWORK DS    12D                                                              
MYDMCB   DS    6F                                                               
SAVEDMCB DS    6F                                                               
ALOCWRK  DS    A                   A(LOC WRK AREA)-USED B/W SUBRTN POOL         
SAVERE   DS    A                   SAVED RE VALUE IN DEMHOOK                    
SAVERF   DS    A                   SAVED RF                                     
SVINDEX  DS    F                                                                
SVTDRDEC DS    X                                                                
SVBINDEC DS    X                                                                
DMLRLFLG DS    F                   DEMO LIST RELEASE FLAG                       
DIVIDEND DS    D                                                                
DIVISOR  DS    F                                                                
REMAINDR DS    F                                                                
QUOTIENT DS    F                                                                
DEC2PROJ DS    C                   Y/N   ALLOW 2 DECIMAL UPGRADES               
ZCELLBTY DS    C                                                                
ZSVBKTYP DS    C                                                                
NHUTFLAG DS    C                                                                
*                                                                               
AIUNWRK  DS    A                   A(WORK AREA FOR IUN STUFF)                   
AVUTS    DS    A                   A(VUT VALUES PASSED TO PROCIUN)              
ASUBRTN  DS    A                                                                
ADBLOCK  DS    A                   A(DBLOCK AREA)                               
ADBDQD   DS    A                   A(DAY/QHR TABLE)                             
ADEMLIST DS    A                   A(DEMO LIST)                                 
ADLDNTRY DS    A                   A(DOWNLOAD DATA TABLE ENTRY)                 
AFRDMVL  DS    A                   A("FROM" LIST OF DEMO VALUES)                
ATODMVL  DS    A                   A("TO" LIST OF DEMO VALUES)                  
*                                                                               
MYBASES  DS    0A                  BASE REGS FOR MAIN DEM02 NMOD                
MYBASE2  DS    A                    A(2ND 4096 BYTES OF THIS PROGRAM)           
MYBASE1  DS    A                    A(1ST 4096 BYTES OF THIS PROGRAM)           
*                                                                               
AGOSUB   DS    A                   A(SUBROUTINE POOL INTERFACE)                 
ASUBR01  DS    A                   A(SUB-ROUTINE POOL ONE)                      
ASUBR02  DS    A                   A(SUB-ROUTINE POOL TWO)                      
ASUBR03  DS    A                   A(SUB-ROUTINE POOL THREE)                    
ASUBR04  DS    A                   A(SUB-ROUTINE POOL FOUR)                     
ASUBR05  DS    A                   A(SUB-ROUTINE POOL FIVE)                     
ASUBR06  DS    A                   A(SUB-ROUTINE POOL SIX                       
ASUBR07  DS    A                   A(SUB-ROUTINE POOL SEVEN                     
                                                                                
AEDITTAB DS    A                   A(EDITTAB)                                   
*2 DECIMAL CODE                                                                 
AEDITTA2 DS    A                   A(EDITTAB2)                                  
AEDITTA3 DS    A                   A(EDITTAB3)                                  
AEDITTA4 DS    A                   A(EDITTAB4)                                  
AEDITTA5 DS    A                   A(EDITTAB5)                                  
AKDAYTAB DS    A                   A(KDAYTAB)                                   
AKDAYTA2 DS    A                   A(KDAYTAB2) COUNTY COVERAGE                  
AIDAYTAB DS    A                   A(IDAYTAB)                                   
AVUTLIST DS    A                   A(VUTLIST)                                   
APUTLIST DS    A                   A(PUTLIST)                                   
ASHRLIST DS    A                   A(SHRLIST)                                   
ANUMWKTB DS    A                   A(NUMWKTAB)                                  
A1STWKTB DS    A                   A(FRSTWKTB)                                  
APROFTAB DS    A                   A(PROFTAB)                                   
ADLDTABS DS    A                   A(DOWNLOAD DATA TABLES)                      
*                                                                               
APROFILE DS    A                   A(PROFILE STORAGE AREA)                      
LPROFILE DS    XL1                 L(PROFILE STORAGE AREA)                      
*                                                                               
MAXNDT   DS    H                   MAX # DAY/TIME COMBOS (STEREO/PAV)           
*                                                                               
MYDATDSP DS    H                                                                
MYCNTR   DS    H                                                                
*                                                                               
MYPROF1W DS    XL(L'PROF1W)                                                     
MYSTAS   DS    CL(L'STAS)          MY (INTERNAL) STATIONS FIELD                 
STPROG   DS    CL16                START TIME PROGRAM NAME                      
NDPROG   DS    CL16                END TIME PROGRAM NAME                        
DAYTIME  DS    CL13                OUTPUT DAY/TIME VALUE                        
ALPHAMKT DS    CL3                 ALPHA MARKET                                 
ACTVWKS  DS    CL4                 ACTIVE WEEKS (1234)                          
RQSTSQHR DS    XL1                 REQUEST'S START QUARTER OUR                  
RQSTEQHR DS    XL1                 REQUEST'S END   QUARTER OUR                  
TEMPMTIM DS    XL2                 TEMPORARY MILITARY TIME                      
TEMPQHR  DS    XL1                 TEMPORARY QUARTER HOUR                       
TEMPIDAY DS    XL1                 TEMPORARY INTERNAL DAY                       
TEMPSTIM DS    XL2                 TEMPORARY START TIME IN MILITARY             
TEMPETIM DS    XL2                 TEMPORARY END   TIME IN MILITARY             
STARTDAY DS    XL1                 NSIWEEK START DAY (1-7)                      
PVACTBK  DS    XL2                 PREVIOUS ACTUAL BOOK                         
LNBKLIST DS    4XL2                LIST OF LATEST N BOOKS (MAX 4)               
MYNLBK   DS    PL1                 NUMBER OF LATEST BOOKS                       
PRECPROF DS    CL1                 PRECISION SET IN PROFILE                     
CANMMBK  DS    CL1                 CANAD MTR MKT--C'N'=WKLY, C'M'=MTHLY         
TAPEOPT  DS    CL1                 Y=TAPE BASED, N=BOOK BASED DEMO CALC         
TMPRCTYP DS    XL(L'TDRRCTYP)      TEMP STORAGE FOR TSAR DEM RECD TYPE          
TMPPURE  DS    XL2                 TEMP STORAGE FOR PURE NUMBER                 
FROMTYPE DS    CL1                 FROM FILE TYPE PASSED TO DEMUP               
PREVDAYR DS    XL(L'THISDAYR)      USED W/IN DEMLKHK HOOK ROUTINE               
* 2 DECIMAL CODE                                                                
TMPWHOLE DS    XL(L'WHOLEFLG)      WHOLE # FLAG FOR EXTRACTING DEMOS            
PGDUR    DS    X                                                                
*                                                                               
SVCOMNUM DS    CL(L'BYTE)                                                       
SVMAYA   DS    CL(L'TDRDTSBI)                                                   
COMFLAG  DS    CL1                                                              
SVACTBK  DS    XL(L'DBACTBK)                                                    
WBZBFLAG DS    XL1                                                              
WBZBFORE EQU   01                  WBZ BOOK BEFORE 10/01/2002                   
WBZAFTER EQU   02                  WBZ BOOK AFTER  10/01/2002                   
*                                                                               
         DS    XL16                                                             
                                                                                
*                                                                               
MYFLAG1  DS    XL1                                                              
MYF1LNBK EQU    X80                 PROCESSING LATEST N BOOK                    
MYF1SEWK EQU    X40                 GET START/END DATE OF WKS IN MONTH          
MYF1DTRO EQU    X20                 PROCESSING DAY/TIME ROTATION                
MYF1RDOK EQU    X10                 DEMAND READ OKAY--GOT DEMO RECDS            
MYF1TRUE EQU    X01                 GENERIC BOOLEAN FLAG                        
MYFLAG2  DS    XL1                                                              
                                                                                
*                                                                               
* 2 DECIMAL CODE                                                                
*                                                                               
*                                                                               
WHOLEFLG DS    XL1                 MODIFIERS TO DISPLAY AS WHOLE #S             
WHOLERTG EQU    X80                 RTGS DISPLAYED AS XX.0                      
WHOLESHR EQU    X40                 SHRS DISPLAYED AS XX.0                      
WHOLEPUT EQU    X20                 PUTS DISPLAYED AS XX.0                      
*                                                                               
*                                                                               
* END OF 2 DECIMAL CODE                                                         
*                                                                               
DEMOFROM DS    XL(L'RCTFROM)                                                    
DEMOUPTO DS    XL(L'RCTUPTO)                                                    
RECTYPE  DS    XL(L'TDRRCTYP)      TYPE OF RECD TO POST (STEREO ONLY)           
STNDEMS  DS    XL1                 TOTAL # OF DEMOS REQUSTD FROM STEREO         
GOSUBN   DS    XL1                 SUB-ROUTINE NUMBER                           
MYELCODE DS    XL1                                                              
SDBXF    DS    CL1                 SET DBLOCK EXTENSION FLAG                    
*                                 PICK-UP FROM LAST LEFT OFF FLAGS              
PUFLLOO  DS    CL1                 RE-ESTABLISHED MAP CODES ?                   
PUFLLOO2 DS    CL1                 RE-ESTABLISHED "THIS" FIELDS ?               
PUFLLOO3 DS    CL1                 RE-ESTABLISHED NTH DEMO ?                    
*                                                                               
TMPKSE   DS    0XL(L'THISKDAY+L'THISSQH+L'THISEQH)                              
TMPKDAY  DS    XL(L'THISKDAY)                                                   
TMPSQH   DS    XL(L'THISSQH)                                                    
TMPEQH   DS    XL(L'THISEQH)                                                    
TMPWKS   DS    XL(L'THISWKS)                                                    
*                                                                               
THISKEY  DS    0X                  CURRENT KEY VALUES                           
THISBK   DS    XL1                 CURRENT BOOK NUMBER                          
THISLBK  DS    PL1                 CURRENT LATEST BOOK NUMBER                   
THISDAY  DS    XL1                 CURRENT DAY/TIME ENTRY NUMBER                
THISDAYR DS    XL1                 CURRENT DAY/TIME ENTRY NUMBER IN ROT         
THISKDAY DS    XL1                 CURRENT KEY DAY                              
THISSQH  DS    XL1                 CURRENT START QUARTER HOUR                   
THISEQH  DS    XL1                 CURRENT END QUARTER HOUR                     
THISTYPE DS    XL1                 CURRENT LINE TYPE                            
THIS1WK  DS    XL1                 CURRENT 1ST WEEK OF PROGRAM                  
THISNOR  DS    XL1                 CURRENT NORMAL PROGRAM FLAG                  
THISSTA  DS    XL1                 CURRENT STATION NUMBER                       
THISASQC DS    XL1                 CURRENT DBACTSQC                             
THISAEQC DS    XL1                 CURRENT DBACTEQC                             
THISKEYX EQU   *                                                                
THISPROG DS    (MAXSTAS)CL16       CURRENT PROGRAM NAME                         
THISBOOK DS    (MAXSTAS)XL2        CURRENT BOOK                                 
THISPNUM DS    XL3                 CURRENT PROGRAM NUMBER                       
THISPURE DS    XL2                 CURRENT PURE NUMBER                          
THISPTYP DS    CL2                 CURRENT PROGRAM TYPE                         
THISWKS  DS    XL1                 CURRENT WEEK BITS                            
THISNWK  DS    XL1                 CURRENT # OF WEEKS                           
THISSWKN DS    XL1                 CURRENT START WEEK OF MONTH                  
THISEWKN DS    XL1                 CURRENT END   WEEK OF MONTH                  
*THISNQH  DS    XL1                 CURRENT DURATION IN QH                      
THISNQH  DS    XL2                 CURRENT DURATION IN QH                       
THISNDYS DS    XL1                 CURRENT NUMBER OF DAYS                       
THISQHAF DS    XL1                 CURRENT QH ADJUSTMENT FACTOR                 
THISFLG1 DS    XL1                 CURRENT BINFLAG1                             
THISDTSI DS    XL2                 CURRENT DAY/TIME SUB-INDEX FOR COMP          
THISMXSI DS    XL2                 CURRENT MAX SUB-INDEX # FOR COMPNENT         
THISDEC  DS    CL1                 (Y/N) FLAG FOR 2 DECIMAL                     
THISSRC  DS    CL1                 (Y/N) FLAG FOR 2 DECIMAL                     
THISAFFL DS    CL5                 AFFILIATION                                  
THISMKNM DS    CL25                MARKET NAME                                  
THISMNUM DS    XL2                 MARKET NUMBER                                
         DS    0F                                                               
THISDEMS DS    (MAXDEMS*3)XL4      CURRENT DEMOUT DEMO VALUES                   
THISDEMX DS    0X                                                               
THISDEML EQU   THISDEMX-THISDEMS                                                
WHHDEMS  DS    (MAXDEMS*3)XL4      WEEKLY HOUSEHOLD DEMO VALUES                 
WHHDEML  EQU   *-WHHDEMS                                                        
DEMONDEM DS    XL1                 ACTUAL N'DEMOS TO LOOK-UP                    
DEMODEMS DS    (MAXDEMS*3)XL3,X    DEMO VALUES (+LIST TERMINATOR)               
CUMWHH   DS    (3*4)F              CUMULATED WEEKLY HOUSEHOLD DEMOS             
CUMWHHX  DS    0X                                                               
CUMWHHL  EQU   CUMWHHX-CUMWHH                                                   
*                                                                               
QHVUTS   DS    3F                  VUT VALUES                                   
*                                                                               
SPDMLK2  DS    XL(SPDEMLKL)        2ND SPDEMLK BLOCK                            
*                                                                               
SVDBLOCK DS    XL(DBLOCK1X-DBLOCK1)    AREA TO SAVE DBLOCK                      
*                                                                               
MYDBXTRA DS    XL128               DBLOCK EXTNSION (HOPE 128 IS ENOUGH)         
                                                                                
         DS    0F                  (FORCE FULL-WORD ALIGNMENT)                  
DBXTROTN DS    0X                  DBLOCK EXTENSION FOR ROTATIONS               
         DS    CL4                  LINK ID                                     
         DS    A                    A(NEXT LINK)                                
DBXTDYTM DS    (MAXDTCMP)XL5,XL1    DAY/TIME LINK                               
         ORG   DBXTDYTM                                                         
DBXTPURE DS    (MAXPUCMP+1)XL2      PURE NUMBER LINK                            
         ORG                                                                    
DBXTROTX EQU   *                                                                
DBXTROTL EQU   DBXTROTX-DBXTROTN                                                
                                                                                
         DS    0F                                                               
DBXTIMS  DS    0X                  DBLOCK EXTENSION FOR IMS                     
         DS     XL(SPIMSAFF-SPIMSD)   FIXED-LENGTH PART OF LINK                 
         DS     XL(OPTIMSL)           MAX SIZE OF VARIABLE-LENGTH PART          
         DS     XL1                   EOL                                       
DBXTIMSX EQU   *                                                                
DBXTIMSL EQU   DBXTIMSX-DBXTIMS                                                 
                                                                                
         DS    0F                                                               
DBXTDQT  DS    0X                  DBLOCK EXTENSION FOR DAYS/QHS TABLE          
         DS     XL(DBDQXFXL)          FIXED-LENGTH PART OF LINK                 
         DS     (8*3)XL(DBDQLEN)      ALTERNATE DAY/QHR CONTROL AREA            
         DS     XL1                   EOL                                       
DBXTDQTX EQU   *                                                                
DBXTDQTL EQU   DBXTDQTX-DBXTDQT                                                 
                                                                                
         DS    0F                                                               
DBXTMBK  DS    0X                  DBLOCK EXTENSION FOR MBKS                    
         DS     XL(DBXMBIDX-DBXMBD)   FIXED-LENGTH PART OF LINK                 
         DS     (60)XL(L'SPUPFBK)      ALTERNATE DAY/QHR CONTROL AREA           
         DS     XL1                   EOL                                       
DBXTMBKX EQU   *                                                                
DBXTMBKL EQU   DBXTMBKX-DBXTMBK                                                 
                                                                                
         DS    0F                                                               
SYSCEXT  DS    0X                                                               
         DS    XL(L'SPXTAREA)                                                   
RELO02   DS    F                                                                
                                                                                
*                                 ************* MATH BLOCK ************         
HOMSHR   DS    3F                  SHARE VALUES                                 
HOMSHRL  EQU   *-HOMSHR                                                         
CUMSHR   DS    3F                  CUMULATIVE SHARE                             
CUMSHRL  EQU   *-CUMSHR                                                         
                                                                                
         DS    0F                                                               
MATHFAC  DS    0XL17                                                            
MTHCFACS DS     A                   A(DBLOCK)                                   
MTHFCTR  DS     F                   WEIGHTING FACTOR FOR MULT & DIVIDE          
MTHIFIL  DS     CL3                 INPUT FILE                                  
MTHOFIL  DS     CL3                 OUTPUT FILE                                 
MTHOSRC  DS     CL3                 OUTPUT SOURCE                               
*                                                                               
CUMFCTR  DS    F                   CUMULATIVE MATH FACTOR                       
CUMPNAM1 DS    CL(L'THISPROG)      CUMULATIVE PROGRAM NAME #1                   
CUMPNAM2 DS    CL(L'THISPROG)          "         "     "   #2                   
CUMWKS   DS    XL(L'THISWKS)       CUMULATIVE ACTIVE WEEKS                      
*                                   X'80' = MULTIPLE PROGRAMS WITH              
*                                    DIFFERING ACTIVE WEEKS                     
*                                                                               
GKSPARM  DS    XL5                                                              
*                                                                               
DEMTMPL  EQU   *-DEMTMPD                                                        
         DS    0CL((APWORKX-APWORK)-DEMTMPL+1)                                  
         EJECT                                                                  
         SPACE 1                                                                
* DSECT TO COVER BINSRCH RECORD                                                 
*                                                                               
BINRECD  DSECT                                                                  
BINKEY   DS    0X                  BINSRCH KEY                                  
BINBK    DS    XL1                 BOOK NUMBER                                  
BINLBK   DS    PL1                 LATEST BOOK NUMBER                           
BINDAY   DS    XL1                 DAY NUMBER                                   
BINDAYR  DS    XL1                 DAY NUMBER W/IN ROTATION                     
BINKDAY  DS    XL1                 KEY DAY                                      
BINSQH   DS    XL1                 START QUARTER HOUR                           
BINEQH   DS    XL1                 END QUARTER HOUR                             
BINTYPE  DS    XL1                 FORMAT TYPE (SEE BELOW)                      
BINTDEM  EQU   0                   DEMOS OR RTG/IMPS                            
BINTSHR  EQU   1                   DEMO SHARES       (AVAIL FORMAT)             
BINTHPT  EQU   2                   DEMO HUT/PUT/TOTS (AVAIL FORMAT)             
BIN1WK   DS    XL1                 1ST WEEK PROGRAM AIRED (PAV ONLY)            
BINNOR   DS    XL1                 NORMAL PROGRAM (PAV ONLY)                    
BINSTA   DS    XL1                 STATION NUMBER                               
BINASQC  DS    XL1                 DBACTSQC (PAV ONLY--TO IDENTFY PROG)         
BINAEQC  DS    XL1                 DBACTEQC ( "   "     "    "     "  )         
BINKEYL  EQU   *-BINKEY                                                         
BINDATA  DS    0X                  BINSRCH DATA                                 
BINPROG  DS    CL16                PROGRAM NAME(S)                              
BINBOOK  DS    XL2                 ACTUAL BOOK                                  
*                                   SET TO ST/END WKS OF MTH FOR CSI TP         
BINPNUM  DS    XL3                 PROGRAM NUMBER                               
BINPURE  DS    XL2                 PURE NUMBER (PAV ONLY)                       
BINWKS   DS    XL1                 WEEK BITS (PAV ONLY)                         
BINNWK   DS    XL1                 NUMBER OF WEEKS (PAV ONLY)                   
*BINNQH   DS    XL1                DURATION IN QUARTER HOURS (PAV ONLY)         
BINNQH   DS    XL2                 DURATION IN QUARTER HOURS (PAV ONLY)         
BINNDAYS DS    XL1                 NUMBER OF DAYS (PAV ONLY)                    
BINQHAF  DS    XL(L'THISQHAF)      QUARTER HOUR ADJUSTMENT FACTOR               
BINFLAG1 DS    XL1                 FLAGS ABOUT BINSRCH ENTRY                    
BF11HHR  EQU   X'80'                ENTRY IS 1ST  HALF-HOUR OF PROG             
BF1XHHR  EQU   X'40'                ENTRY IS LAST HALF-HOUR OF PROG             
BINDEC   DS    CL1               (Y/N) IF RECORD CONVERTED TO 2 DEC             
BINSRC   DS    CL1                                                              
BINFXDTL EQU   *-BINDATA           BINSRCH FIXED DATA LENGTH                    
BINDEMS  DS    0XL3                VARIABLE NUMBER OF DEMO VALUES               
                                                                                
                                                                                
         DS    0XL(BINKEYL-(THISKEYX-THISKEY)+1)                                
         DS    0XL((THISKEYX-THISKEY)-BINKEYL+1)                                
         EJECT                                                                  
* DSECT TO COVER TSAR DEMO RECORD                                               
*                                                                               
TSDEMRCD DSECT                                                                  
TDRKEY   DS    0X                  TSAR DEMO RECORD KEY                         
*    NEW SEQUENCING INDEX SO WE CAN SLOT X'10' RECORDS IN BETWEEN               
*    X'80' RECORDS -  NOTE THIS INDEX WILL NOT CHANGE IF DMA=R                  
*    THIS INDEX WILL BE DECREMENTED IF DMA=I                                    
*TDRINDX  DS    XL4                  NEW SEQUENCE                               
TDRRCTYP DS    XL1                  RECORD TYPE (SEE BELOW)                     
TDRSTA   DS    XL1                  STATION NUMBER                              
TDRBK    DS    XL1                  BOOK NUMBER                                 
TDRDAY   DS    XL1                  DAY NUMBER                                  
TDRDAYR  DS    XL1                  DAY NUMBER W/IN ROTATION                    
TDRKDAY  DS    XL1                  KEY DAY                                     
TDRSQH   DS    XL1                  START QUARTER HOUR                          
TDREQH   DS    XL1                  END QUARTER HOUR                            
TDRTYPE  DS    XL1                  FORMAT TYPE (SEE BELOW)                     
TDRTDEM  EQU   0                     DEMOS OR RTG/IMPS                          
TDRTSHR  EQU   1                     DEMO SHARES       (AVAIL FORMAT)           
TDRTHPT  EQU   2                     DEMO HUT/PUT/TOTS (AVAIL FORMAT)           
TDR1WK   DS    XL1                  1ST WEEK PROGRAM AIRED (PAV ONLY)           
TDRNOR   DS    XL1                  NORMAL PROGRAM (PAV ONLY)                   
TDRASQC  DS    XL1                  DBACTSQC (PAV ONLY--IDENTIFY PROG)          
TDRAEQC  DS    XL1                  DBACTEQC (PAV ONLY--IDENTIFY PROG)          
TDRKEYL  EQU   *-TDRKEY                                                         
         DS    0CL(L'TSARKEY-TDRKEYL+1)                                         
TKYBKL   EQU   TDRBK-TDRKEY+L'TDRBK                                             
                                                                                
         ORG   TDRKDAY                                                          
TDRK2PUR DS    XL2                 KEY LAYOUT #2 (PAV ONLY): PURE#              
TDRK2NOR DS    XL1                  NORMAL PROGRAM                              
TDRK2KDY DS    XL1                  KEY DAY                                     
TDRK2SQH DS    XL1                  START QUARTER HOUR                          
TDRK2EQH DS    XL1                  END QUARTER HOUR                            
TDRK21WK DS    XL1                  1ST WEEK PROGRAM AIRED                      
TDRK2SPR DS    XL1                  SPARE                                       
TDRKEY2L EQU   *-TDRKEY                                                         
         DS    0CL(TDRKEYL-TDRKEY2L+1)                                          
         DS    0CL(TDRKEY2L-TDRKEYL+1)                                          
                                                                                
*                                                                               
TDRDATA  DS    0X                  TSAR DEMO RECORD DATA                        
TDRPROG  DS    CL16                 PROGRAM NAME(S)                             
TDRPTYP  DS    CL2                  PROGRAM TYPE                                
TDRPURE  DS    XL2                  PURE NUMBER (PAV ONLY)                      
TDRWKS   DS    XL1                  ACTIVE WEEKS BITS (PAV ONLY)                
TDRNDAYS DS    XL1                  NUMBER OF DAYS (PAV ONLY)                   
TDRQHAF  DS    XL(L'THISQHAF)       QUARTER HOUR ADJUSTMENT FACTOR              
TDRFLAG1 DS    XL1                  FLAGS ABOUT TSAR DEMO RECD ENTRY:           
TF11HHR  EQU   BF11HHR               ENTRY IS 1ST  HALF-HOUR OF PROG            
TF1XHHR  EQU   BF1XHHR               ENTRY IS LAST HALF-HOUR OF PROG            
TF1DUMDV EQU   X20                   RECORD CONTAINS DUMMY DEMO VALUES          
TF1ALL   EQU   TF11HHR+TF1XHHR+TF1DUMDV                                         
         DS    0CL(XFF-TF1ALL+1)     ENSURE EACH BIT IS USED ONLY ONCE          
TDRDTSBI DS    XL2                  SUB-INDEX FOR D/T COMPONENT                 
TDRDEC   DS    CL1                  Y/N  2 DECIMAL INDICATOR                    
TDRAFFL  DS    CL5                  AFFILIATION                                 
TDRPDUR  DS    XL2                  PROGRAM TOTAL DURATION                      
*TDRPDUR  DS    XL1                  PROGRAM TOTAL DURATION                     
TDRFIXL  EQU   *-TSDEMRCD           L(FIXED PART OF RECORD)                     
TDRDEMS  DS    0XL3                 VARIABLE NUMBER OF DEMO VALUES              
                                                                                
         ORG   TDRDATA             AREA FOR DAY/TIME LIST                       
TDRDATA2 DS    0X                   ie. TDRRCTYP=TDRRTDTL                       
TDREBCDT DS    CL(1+L'DAYTIME)      L'DAYTIME, DAYTIME                          
TDRNUMDT DS    XL2                  TOTAL # OF DAY/TIME COMBOS                  
TDRFIXL2 EQU   *-TSDEMRCD                                                       
TDRDYTMS DS    0XL(DTNTRYQ)                                                     
                                                                                
         ORG   TDRDATA             AREA FOR DAY/TIME INDICES                    
TDRDATA3 DS    0X                   ie. TDRRCTYP=TDRRTDTI                       
TDRMXSBI DS     XL2                  MAX SUB-INDEX FOR D/T COMPONENT            
TDRFIXL3 EQU   *-TSDEMRCD                                                       
                                                                                
                                                                                
* TDRRCTYP can have the following values:                                       
TDRRTDML EQU   X'10'               RECORD CONTAINS DEMO LIST                    
TDRRTDTI EQU   X'20'                 "       "     DAY/TIME INDICES             
TDRRTDMV EQU   X'80'                 "       "     DEMO VALUES                  
TDRRTDTL EQU   X'F0'                 "       "     DAY/TIME LIST                
         EJECT                                                                  
* DSECT TO COVER PREVIOUS VALUES OUTPUTTED TO STEREO                            
*                                                                               
SPVOVALD DSECT                                                                  
SPOVSTA  DS    CL9                 WABCT/PHI--CALL LETTERS(/SPILL MKT)          
SPOVBOOK DS    CL17                "NOV/95(B)  WEEK 1"                          
SPOVDYQH DS    XL(L'BINKDAY+L'BINSQH+L'BINEQH)                                  
SPOVWKS  DS    XL(L'TDRWKS)                                                     
SPOVPROG DS    CL(L'BINPROG)                                                    
SPVOVALQ EQU   *-SPVOVALD                                                       
         DS    0CL(L'STPRVOVL-SPVOVALQ+1)                                       
                                                                                
* DSECT TO COVER LIST OF DIFFERENT DAY/TIME COMBOS                              
*                                                                               
DTNTRYD  DSECT                                                                  
DTNTHINP DS    XL1                 NTH DAY/TIME INPUT TO STEREO                 
DTKDAY   DS    XL(L'BINKDAY)                                                    
DTSQH    DS    XL(L'BINSQH)                                                     
DTEQH    DS    XL(L'BINEQH)                                                     
DTNTRYQ  EQU   *-DTNTRYD                                                        
                                                                                
*-------------------------- REGETKSRC PARMS --------------------------*         
                                                                                
GKSPARMD DSECT                                                                  
GKSPRSVC DS    CL1                 RATING SERVICE                               
GKSPQLFY DS    CL1                 TRACK QUALIFIER/BK PREFIX                    
GKSPBKBT DS    XL1                 BOOKVAL BITS                                 
GKSPBTYP DS    CL1                 BOOK TYPE                                    
         DS    XL1                 SPARE                                        
GKSPARMX EQU   *                                                                
GKSPARML EQU   GKSPARMX-GKSPARMD                                                
         DS    0XL(L'GKSPARM-GKSPARML+1)                                        
         DS    0XL(GKSPARML-L'GKSPARM+1)                                        
         EJECT                                                                  
* DSECT TO DOWNLOAD DATA TABLES                                                 
*                                                                               
DLDTABD  DSECT                                                                  
DLDTLEN  DS    XL1                 L(ENTRY)                                     
DLDTFMS  DS    0CL(L'DBFIL+L'DBSRC+L'DBMED)                                     
DLDTFIL  DS     CL(L'DBFIL)         FILE                                        
DLDTSRC  DS     CL(L'DBSRC)         SOURCE                                      
DLDTMED  DS     CL(L'DBMED)         MEDIA                                       
DLDTRTYP DS    XL(L'TDRRCTYP)      TSAR DEMO RECORD TYPE                        
DLDTVRSN DS    XL(L'D32PCVER)      STEREO DEM EXTRACT VERSION                   
DLDTFIXL EQU   *-DLDTABD                                                        
                                                                                
DLDTDATA DS    0X                                                               
         EJECT                                                                  
***********************************************************************         
*========================== IUN RECORD DSECT =========================*         
                                                                                
IUNRECD  DSECT                                                                  
*                                                                               
IUNIVS   DS    (IUNNVALS)F        UNIVERSES                                     
*                                                                               
IUNOLD   DS    0F                 ORIGINAL (OLD) BOOK VALUES                    
IOLDRTG  DS    (IUNNVALS)F         RATINGS                                      
         ORG   IOLDRTG+IUNHMDSP                                                 
IUORHOME DS    F                                                                
         ORG                                                                    
IOLDIMP  DS    (IUNNVALS)F         IMPRESSIONS                                  
IOLDHPT  DS    (IUNNVALS)F         HUTS/PUTS                                    
         ORG   IOLDHPT+IUNHMDSP                                                 
IUOPHOME DS    F                                                                
         ORG                                                                    
IOLDTOT  DS    (IUNNVALS)F         TSA TOTALS                                   
         ORG   IOLDTOT+IUNHMDSP                                                 
IUOQHOME DS    F                                                                
         ORG                                                                    
IUNOLDX  EQU   *                                                                
*                                                                               
IUNNEW   DS    0F                 NEW VALUES                                    
INEWRTG  DS    (IUNNVALS)F         RATINGS                                      
         ORG   INEWRTG+IUNHMDSP                                                 
IUNRHOME DS    F                                                                
         ORG                                                                    
INEWIMP  DS    (IUNNVALS)F         IMPRESSIONS                                  
INEWHPT  DS    (IUNNVALS)F         HUTS/PUTS                                    
         ORG   INEWHPT+IUNHMDSP                                                 
IUNPHOME DS    F                                                                
         ORG                                                                    
INEWTOT  DS    (IUNNVALS)F         TSA TOTALS                                   
         ORG   INEWTOT+IUNHMDSP                                                 
IUNQHOME DS    F                                                                
         ORG                                                                    
IUNNEWX  EQU   *                                                                
                                                                                
         DS    0CL((IUNOLDX-IUNOLD)-(IUNNEWX-IUNNEW)+1)                         
         DS    0CL((IUNNEWX-IUNNEW)-(IUNOLDX-IUNOLD)+1)                         
*                                                                               
IUNOTH   DS    0F                 OTHER VALUES                                  
ISHOMES  DS    F                                                                
ISMETA   DS    F                                                                
ISMETB   DS    F                                                                
                                                                                
ILUNVS   DS    (IUNNVALS)F         LOONEYVERSES                                 
ILUNVX   EQU   *                                                                
*                                                                               
IUNRECL  EQU   *-IUNRECD                                                        
                                                                                
                                                                                
IUNNVALS EQU   32                  # OF IUN VALUES                              
IUNLVALS EQU   IUNNVALS*4          LENGTH OF IUN VALUES                         
IUNHMNDX EQU   20                  INDEX TO HOMES RTGS IN IUN RTGS AREA         
IUNHMDSP EQU   IUNHMNDX*4          DISPL TO HOMES RTGS IN IUN RTGS AREA         
***********************************************************************         
         EJECT                                                                  
***********************************************************************         
*============================= REP DSECTS ============================*         
                                                                                
*------------------------------ REGENREP -----------------------------*         
         PRINT OFF                                                              
       ++INCLUDE REGENREPA                                                      
         PRINT ON                                                               
                                                                                
                                                                                
*----------------------------- RERMPPROF -----------------------------*         
         PRINT OFF                                                              
       ++INCLUDE RERMPPROF                                                      
         PRINT ON                                                               
                                                                                
                                                                                
*------------------------------ REGENINV -----------------------------*         
REINVRCD DSECT                                                                  
         PRINT OFF                                                              
       ++INCLUDE REGENINVA                                                      
         PRINT ON                                                               
                                                                                
                                                                                
*------------------------------ REGENAVL -----------------------------*         
         PRINT OFF                                                              
       ++INCLUDE REGENAVL                                                       
         PRINT ON                                                               
*----------------------------- DDMONYREQU ----------------------------*         
         PRINT OFF                                                              
       ++INCLUDE DDMONYREQU                                                     
         PRINT ON                                                               
***********************************************************************         
         EJECT                                                                  
* DDCOMFACS                                                                     
         PRINT OFF                                                              
       ++INCLUDE DDCOMFACS                                                      
         PRINT ON                                                               
         EJECT                                                                  
APSAV2D  DSECT                                                                  
AS2EMPC  DS    XL(L'FALEMPC)       REMEMBER ELEMENT MAP CODE                    
AS2DMPC  DS    XL(L'FALDMPC)       REMEMBER DATA    MAP CODE                    
AS2STMOD DS    XL(L'STMODE)        REMEMBER STEREO MODE                         
AS2DEMON DS    XL1                    "     NTH DEMO FOR ADDDATA CALL           
AS2THSST DS    XL(L'THISSTA)          "     THIS STATION                        
AS2THSBK DS    XL(L'THISBK)           "     THIS BOOK                           
AS2THSDY DS    XL(L'THISDAY)          "     THIS DAY                            
AS2RSMF  DS    XL1                 RESUME FLAG                                  
AS2RFFLK EQU    X80                 RESUME FOR FALINK BREAK                     
AS2RFAPP EQU    X40                 RESUME FOR APPLIC BREAK                     
APSAV2Q  EQU   *-APSAV2D                                                        
*                                                                               
**********************************************************************          
         EJECT                                                                  
***********************************************************************         
*======================== UPDATE LOG (CONT'D) ========================*         
*   DATE   LVL USER   DESCRIPTION                                               
* -------- --- ----   ------------------------------------------------*         
* Dec23/98 110 GLEE - Moved DEMBREAK, DEMRESUM, & DPST# rtns to SUBR04          
*                                                                               
* Dec15/98 109 GLEE - Exits setting CC to HIGH, LOW, & EQUAL                    
*                                                                               
* Dec10/98 108 GLEE - Handle FALINK breaks & resumes                            
*                                                                               
* Dec10/98 107 GLEE - Move PAV look-up routine to SUBR04                        
*                                                                               
* Nov16/98 105 GLEE - Fix bug with day/time sub-index numbers                   
*                                                                               
* Nov13/98 104 GLEE - Fix bug with rotations in PAVHOOK                         
*              GLEE - Skip DTL# routine for DEM32 session                       
*                                                                               
* Nov10/98 103 GLEE - Fix QHRTOMIL to return 0001-2400 military time            
*                                                                               
* Nov09/98 102 GLEE - Pass day/time sub-index for DEM32                         
*                                                                               
* Oct13/98 101 GLEE - Support rotations for TP projections                      
*                                                                               
* Oct12/98 100 GLEE - Set up SUBR04 sub-routine pool                            
*                   - Add new routine to format station                         
*                                                                               
* Oct08/98 099 GLEE - Back up N hours for DEM32 PAV report requests             
*                   - More support for pure numbers                             
*                   - Add cost-per-point label to download                      
*                                                                               
* Oct05/98 098 GLEE - Support for PAV upgrades                                  
*                                                                               
* Oct02/98 097 GLEE - Support for PAV rotations                                 
*                                                                               
* Oct01/98 096 GLEE - Support for DEM32                                         
*                                                                               
* Sep28/98 095 GLEE - Set up SUBR03 sub-routine pool                            
*                   - Change definition of sub-routine numbers                  
*                                                                               
* Aug10/98 094 GLEE - Check for any DBDQD entries in DDT# routine               
*                                                                               
* Aug03/98 093 GLEE - Change some instructions coded in LVL=091                 
*                                                                               
* Jun17/98 090 GLEE - Send dummy PAV data to STEREO when necessary              
*                                                                               
* Jun05/98 089 GLEE - Remove PAV logic in DDT# routine                          
*                                                                               
* Jun02/98 088 GLEE - Accept error returned from SPDEMLK in GIS# rtn            
*                                                                               
* May12/98 087 GLEE - Support for day/time rotations                            
*                                                                               
* Apr08/98 083 GLEE - Set up SUBR02 sub-routine pool                            
*                                                                               
* Apr06/98 082 GLEE - Fix bug in QH to military time translation rtn  *         
*                                                                     *         
* Feb19/98 054 GLEE - Books for Canadian Meter Market may be monthly            
*                      or weekly                                                
*                                                                               
* Feb15/98 053 GLEE - Move GETDAY routine to SUBR01                             
*                                                                               
* Oct02/97 052 GLEE - Display disclaimer msg when displaying wks across         
*                                                                               
* Aug14/97 051 GLEE - New 4th parameter to NSIWEEK {A(DATCON)}                  
*                                                                               
* Apr07/97 050 GLEE - Chg 'T' modifier to 'I' before DEMOCON for PAV            
*                                                                               
* Apr07/97 049 GLEE - Move PROCIUN routine to SUBR01                            
*                                                                               
* Apr04/97 048 GLEE - Add entry in EDITTAB for 'T' modifier for PAV             
*                                                                               
* Jan16/97 047 GLEE - Do dummy TSAR DEMO RECORDS for ACTN=PERIOD also           
*                                                                               
* Jan07/97 046 GLEE - Fix DEMOCON call--parms are file dependent                
*                                                                               
* Oct07/96 045 GLEE - Pass back "LATEST=actual book" to STEREO                  
*                                                                               
* Oct02/96 044 GLEE - Use REP RMP precision profile when appropriate            
*                                                                               
* Sep17/96 043 GLEE - Force normalized HUT/PUT for REP                          
*                                                                               
* Aug19/96 042 GLEE - Tape/book based demo calculations                         
*                                                                               
* Aug19/96 041 GLEE - Support multiple books averaging                          
*          040 GLEE - Moved GETWKS, MILTOQHR, SUB1MIN, and GETDEM               
*                      rtns to SUBR01                                           
*          039 GLEE - Support latest n books                                    
*                                                                               
* Jun20/96 038 GLEE - Fix precision bug for PAV file                            
*                                                                               
* May30/96 037 GLEE - Fix invalid book display for STEREO                       
*              GLEE - Pass typical/4Wk switch to SPDEMUP                        
*                                                                               
* Apr09/96 036 GLEE - Specify week number to STEREO when applicable             
*              GLEE - Limit dummy TSAR DEMO RECORDS to ACTN=DISPLAY             
*                                                                               
* Apr02/96 035 GLEE - Set NSIWEEK start day to Monday for NSI Can TP            
*                                                                               
* Mar20/96 034 GLEE - Spacers for PAV data                                      
*                                                                               
* Dec26/95 033 GLEE - Reset DBLOCK values for each DEMAND call in DDT#          
*                                                                               
* Nov15/95 032 GLEE - Support for STEREO session                                
*                                                                               
* Aug09/95 031 GLEE - Display weeks across screen                               
*                                                                               
* Aug09/95 030 GLEE - Support PAV file                                          
*                                                                               
* Jul18/95 029 GLEE - Clean up                                                  
*                                                                               
* Feb14/95 026 GLEE - support alpha market inputs in Stations field             
*                                                                               
* 10/19/94 025 GLEE - support overnight (1a-5a) daypart radio posting           
*                                                                               
* 10/18/94 024 GLEE - Removed DBMED=C check for setting profile                 
*              GLEE - Passed through DMA option for precision spec              
*                                                                               
* 05/05/94 023 GLEE - CHANGE QHRTOMIL RTN TO SUPPORT RADIO START TIMES          
*                                                                               
* 03/31/94 022 GLEE - MORE CODE FOR SPORTS OPTION                               
*                                                                               
* 03/25/94 021 GLEE - CODE TO FILTER W/ & W/O SPORT PROGRAMS                    
*                                                                               
*  ??????   ?   ??  - HISTORY UNKNOWN                                           
***********************************************************************         
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'225DEDEM02   11/17/20'                                      
         END                                                                    

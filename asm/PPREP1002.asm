*          DATA SET PPREP1002  AT LEVEL 014 AS OF 05/28/20                      
*PHASE PP1002B                                                                  
*INCLUDE PPBVAL                                                                 
*INCLUDE BINSRCH2        LATEST VERSION                                         
*INCLUDE PPFMTINO                                                               
*INCLUDE OFFOUT                                                                 
*INCLUDE PRNTBL                                                                 
*INCLUDE DDUCOM                                                                 
*INCLUDE PRINT                                                                  
*                                                                               
***********************************************************************         
* USER    JIRA       DATE                  CHANGE LOG                 *         
* ---- ----------  -------- ----------------------------------------- *         
* AKAT SPEC-32038  05/28/20 NEW FISICAL CALENDAR FOR SCJ 2020-2021    *         
* SMUR SPEC-24801  06/22/18 OMIT 0 INVOICES FROM LMA ELECTRONIC BILL  *         
* SMUR SPEC-11729  05/07/18 NEW (D)IGITAL AUDIO (18.3)                *         
* AKAT SPEC-24974  09/19/18 CARAT - EDI billing for Smuckers          *         
* AKAT SPEC-26418  08/01/18 NEW FISICAL CALENDAR FOR SCJ 2018-2020    *         
* SMUR SPEC-7724   02/08/18 MEDIABRANDS CANADA - INCLUDE BILL TAX CODE*         
* AKAT SPEC-15712  12/05/17 GM LMA (LOCAL DEALERS) - UPDATE FTP INFO  *         
* YKVA SPEC-15712  11/14/17 GM LMA (LOCAL DEALERS)                    *         
* YKVA SPEC-16295  09/20/17 INCREASE G7TABLE FROM 3K TO 6K            *         
* YKVA SPEC-14613  07/27/17 COPY SCJ FORMAT FROM BN TO OO             *         
* AKAT SPEC-5364   02/17/17 EBILLING FOR HAVAS - PHILLIPS             *         
* AKAT ITMF-8801   07/28/16 NEW FISICAL CALENDAR FOR SCJ 2016-2018    *         
***********************************************************************         
         TITLE 'PP1002 - CHANGE LOG'                                            
*                                                                               
* BPLA   07/15    FIRST ROUND OF CHANGES FOR THE NEW MEDIA CODES                
*                                                                               
* BPLA   06/15    NEW FISICAL CALENDAR FOR SCJ 2015-2016                        
*                                                                               
* BPLA   10/14    CHANGES FOR MSNYA OB10 FILES (ON-HOLD)                        
*                 ENTRY IN AGYLST NO-OPED - LOOK FOR *ON HLD*                   
*        01/15    FOR DIAGEO FILE - SKIP ZERO INVOICES                          
*                                                                               
* BPLA   05-07/14 CHANGES FOR MEDIA L                                           
*                 NEW CALENDAR FOR SCJ                                          
*                                                                               
* BPLA   04/14   DIAGEO INTERFACE FOR CARAT                                     
*                ALLOW IPGPROC INTERFACE FOR AGENCY I5                          
*                                                                               
* BPLA   07/13   IPG STYLE INTERFACE FOR M2TO (U#) TYPE I                       
*                ALSO EXPAND FISCAL YEAR TABLE IN SCPROC                        
*                                                                               
* BPLA   01/13   NEW STYLE DIAGEO INTERFACE                                     
*                                                                               
* BPLA   12/12   FILE CHANGE FOR M2TOA (U#)                                     
*                                                                               
* BPLA   06/12   REACTIVATE BN SCJ INTERFACE                                    
*                                                                               
* BPLA   03/12   MAZDA INTERFACE AGY=H7                                         
*        04/12   SC JOHNSON INTERFACE FOR AGY=BN                                
*                DSNAME DIGITAL BNSD (DIGITAL - MEDIA I AND S)                  
*                                                                               
* BPLA   11/11   SC JOHNSON INTERFACE AGY= H7                                   
*                NOTE - DSNAME FOR PRINT VS. DIGITAL                            
*                ARE H7SP (PRINT) H7SD (DIGITAL - MEDIA I AND S)                
*                DOES NOT USE ID FROM MASTD (LIKE SPREPBT02)                    
*                MQAGYID WILL BE FROM MASTD                                     
*                PLUS SUFFIX (3) FOR INMETO FILES                               
*                PLUS SUFFIX (4) FOR ORTO FILES                                 
*                                                                               
* BPLA   09/11   DENOTE MIDAS BILLS                                             
*                                                                               
* BPLA   02/11   SUPPORT ALL BUT OFFICE REQUESTS                                
*                QCLIENT= *-X  (X= OFFICE CODE)                                 
*                                                                               
* BPLA   02/11   WILA DATA SET NAME CHANGES                                     
*                                                                               
* BPLA   12/10   NEW MCCANN FILE - TAPE TYPE I                                  
*                MCLOU ID AND MCLO ID                                           
*                                                                               
* BPLA   11/10   DATASET NAME CHANGES FOR MCCANN IDS                            
*                                                                               
* BPLA   10/10   ADD INVOICE # FILTERING                                        
*                                                                               
* BPLA   10/10   MODIFICATION TO M2GPROC TO HANDLE VARIOUS INVOICE              
*                FORMATS                                                        
*                                                                               
* BPLA   09/10   MODIFY DIAGEO INTERFACE - PO# FROM EST. USER 1                 
*                AGENCY M2 NOT H7                                               
*                                                                               
* BPLA   08/10   FIX BURGER KING LOGIC TO ALLOW FOR MULTIPLE REQUESTS           
*                                                                               
* SMYE   06/10   REMOVE REFERENCES TO DELETED POWER CODES                       
*                                                                               
* BPLA   05/10   ENTRY IN WGBRTAB (WINGLATINO) FOR OFFICE S                     
*                CHANGE MQAGYID TO H7PY FOR MINDSHARE'S BURGER                  
*                KING FILE.                                                     
*                REMOVE CODE FOR AGENCY OG - NOW REUSED                         
*                                                                               
* BPLA   04/10   SPECIAL CODE FOR 2 COST 2 CLIENTS (LLB AND MCI)                
*                AGENCY GSD&M (GSTX - G7)                                       
*                ALSO - NEW TAPE TYPE (C) FOR MCCANN (IPG - CHRYSLER)           
*                                                                               
* BPLA   12/09   BURGER KING FILE FOR MINDSHARE                                 
*                                                                               
* BPLA   08/09   ADD OFFICE CODE A TO TABLE FOR WINGLATINO (G+)                 
*                                                                               
* BPLA   04/09   MTXGREY (H7) INTERFACE (USES M2GPROC)                          
*                                                                               
* BPLA   07/08   CHANGE TO SEND AOR BILLS FOR MEGREY (M2)                       
*                ONLY $ IS AMT DUE + AOR INDICATOR                              
*                                                                               
* BPLA   05/08   COMPANY CODE CHG FOR WITO                                      
*                                                                               
* BPLA   04/08   USE M2PROC FOR WITO (WT) AND SET AOR INDICATORS                
*                                                                               
* BPLA   04/08   MORE OFFICES FOR M2 INTERFACE                                  
*                (G2 ADDED EARLIER) G3 IN M2BRTAB                               
*                                                                               
* BPLA   01/08   CHECK BILLING FORMULA IN ED JONES TRANSMISSIONS                
*              TO DETERMINE WHETHER NET OR NET-CD SHOULD BE TRANFERRED          
*                                                                               
* BPLA   12/07   CREATE ONE RECORD FOR MULTIPLE MOS INVOICES FOR MULLEN         
*                ALSO REPORT NET INSTEAD OF NET-CD FOR EDWARD JONES             
*                                                                               
* BPLA   10/07   SOON BILLING FILTER                                            
*                                                                               
* BPLA   09/07   WINGLATINO (G+) INTERFACE                                      
*                                                                               
* BPLA   03/06   MEDIACOM INTERFACE                                             
*                USE OFFICER INSTEAD OF OFFOUT                                  
*                                                                               
* BPLA   01/06   EDWARD JONES (OMD)                                             
*                                                                               
* BPLA   11/05   SET AGENCY M$ (MULLEN) UP EXACTLY LIKE AGENCY G7               
*                                                                               
* BPLA   05/05   CHANGE TO BNPROC (PHD)                                         
*                                                                               
* SMYE   05/05   LET AGENCY M1 (MFI) USE WIPROC (WESTERN) TAPE SPEC'S           
*                                                                               
* BPLA   03/05    M2 INTERFACE                                                  
*                                                                               
* BPLA   02/05    PAD A ZERO AFTER CLT INTERFACE CODE IN DONER FILE             
*                                                                               
* BPLA   01/05    NO-OP THE SONY CLIENT CHANGE FOR FORMAT M                     
*                                                                               
* BPLA   01/05    SKIP SOME SONY CLIENTS FOR FORMAT M                           
*                 (MCCANN- ADWARE)                                              
*                                                                               
* BPLA  07/04    SPECS FOR MCCANN (ADWARE)                                      
*                                                                               
* SMYE 03/29/04  SET AGENCY GQ (GSCA) UP EXACTLY LIKE AGENCY G7                 
*                  SEE SMYE 12/15/98 BELOW                                      
*                                                                               
* YKAP 07/03     "SOMETHING" FOR WI (WILA)                                      
*                                                                               
* BPLA 05/03     NEW OPTION TO EXCLUDE COMMISSION ONLY BILLS                    
*                                                                               
* BPLA 04/03     ADD MEDIA I FOR DONER (DAPROC) INTERFACE                       
*                                                                               
* KWAN 08/00     NEW PBILLREC AND PPBVAL DSECT                                  
*                                                                               
* BPLA 04/05/00  SKIP CLIENT DEL FOR AMMARATTI                                  
*                                                                               
* SMYE 12/15/98  LET AGENCY G7 (GSTX) USE PUPROC (AMMIRATTI) TAPE               
*                SPEC WITH MINOR CHANGE(S)                                      
*                                                                               
* SMYE 12/10/98  TEMPORARY CHANGE TO WIPROC - TAPE RECORD LENGTH                
*                CHANGED FROM 300 BACK TO 174 - SEE WIPBIT1 DCB                 
*                (SEE BPLA 3/98 FOR CHANGE TO 300)                              
*                                                                               
* SMYE 08/13/98  ADD CDM TO CLIENTS SKIPPED FOR  AMMIRATTI                      
*                AND SHIFT INVOICE NUMBER OUTPUT FROM                           
*                POS 25-29 TO 24-29 (FULL 6-POS'N NUMBER - NO DASH)             
*                                                                               
* SMYE 06/15/98  IN BDCHRYS (BBDO-CHRYSLER) AND TRAPROC (TRACY LOCK)            
*                USED DATCON TO OUTPUT PBILLDAT (YYMMDD) TO INTERFACE           
*                REC TO ELIMINATE DDS INTERNAL YEAR CODING FOR Y2K+             
*                                                                               
* SMYE 06/08/98  REMOVE INM FROM CLIENTS SKIPPED FOR AMMIRATTI                  
*                                                                               
* SMYE 05/29/98  ADD CWW AND BAC TO CLIENTS SKIPPED FOR AMMIRATTI               
*                                                                               
*  BPLA  5/98    CHANGES FOR USING NEW PPFMTINO                                 
*                (HAS SPECIAL FORMATTING FOR WESTERN)                           
*                TAPES THAT NEED THE 7 CHARACTER OUTPUT                         
*                SHOULD USE MY NEW DSINVNO (NOT DINVNO)                         
*                                                                               
* SMYE 5/98      NEW TAPE FOR SAATCHI FOR TOYOTA  (DFT  -  DFTPROC)             
*                                                                               
* BPLA  3/98     USE GETAOR TO FIND AOR DATA FOR WESTERN TAPE                   
*                RECORD LENGTH NOW 300                                          
*                                                                               
* SMYE 01/27/98  SKIP CLIENTS CDI,CMI,MIN,MLO,INM & LCO FOR AMMARATTI           
*                                                                               
* SMYE 06/16/97  INCLUDE HST TOTALS IN DAPROC (DONER)                           
*                                                                               
* BPLA  5/5/97   LET AGY CE USE TAPE SPEC FOR CA (CAMPBELL-MITHUN)              
*                                                                               
* SMYE 04/25/97  CHANGED DATCON TO NOT OUTPUT "FUNNY DATES" (21ST CENT)         
*                                                                               
* SMYE 01/97     CHANGE TO WIPROC - PUT RETAIL ACCOUNT (PBRACCT)                
*                IN 163-174 (PBIREC+162)                                        
*                TAPE RECORD LENGTH CHANGED FROM 162 TO 174                     
*                                                                               
* SMYE 11/01/96  USE OFFOUT FOR OFFICE DISPLAY                                  
*                                                                               
* BPLA  10/96    DISPLAY REATIL ACCOUNT ON INVOICE LISTING                      
*                UNDER RUN DATE                                                 
*                                                                               
* BPLA 1/96      CHANGE TO AMMIRATTI TAPE                                       
*                                                                               
* SMYE 12/18/95  CHANGED DTCNV TO DATCON WITH NEW PARAM'S                       
*                                                                               
* BPLA 12/95     SKIP CLIENTS COM, CDP AND CPM FOR AMMARATTI                    
*                                                                               
* BPLA 10/95     ADD INVOICE COUNTERS USING BINSRCH                             
*                                                                               
* BPLA 9/95      CHANGES TO AMMARATTI TAPE                                      
*                                                                               
* BPLA 6/95      NEW TAPE FOR AMMARATTI (PU) DATATRACK FORMAT                   
*                                                                               
* BPLA 1/3/95    CHANGE TO WIPROC - ADD NET-CD AND EXPAND TAPE                  
*                RECORD LENGTH TO 162 (FROM 153)                                
*                                                                               
* BPLA 12/94     CHANGE TO BJPROC - PUT PRODUCT NAME IN (137-157)               
*                (PBIREC+136) AND REGION IN 160-162 (PBIREC+159)                
*                AND DISTRCIT IN 163-165 (PBIREC+162)                           
*                TAPE RECORD LENGHT CHANGED FROM 150 TO 200                     
*                                                                               
* BPLA 11/94     CHANGE TO BJPROC (IF BJ AND NON-RETAIL                         
*                AND BILLED BY REGION - PUT REGION IN REC+132)                  
*                                                                               
* BPLA 11/94     CHANGE TO JWT TAPE FOR CLIENT WL                               
*                                                                               
* BPLA 9/94      ADD CODE FOR WESTERN TAPE (3 IDS)                              
*                                                                               
* BPLA 9/94      CHANGE TO JWT TAPE                                             
*                FOR OUTDOOR CLIENT FCP USE PRODUCT USER1                       
*                AS CLIENT INTERFACE CODE                                       
*                                                                               
* BPLA 7/94      CHANGE TO KETCHAM SPECS                                        
*                IF KANY AND OFFICE = J                                         
*                SET PBIREC+11(2) = C'65'                                       
*                                                                               
* BPLA 7/94      USE PPFMTINO  TO FORMAT INVOICE NUMBERS                        
*                                                                               
* BPLA 5/23/94   CHANGE FOR KETCHAM TAPE FOR CLIENT AHR                         
*                                                                               
* BPLA 4/26/94   DISPLAY PST UNDER GST                                          
*                                                                               
* BPLA CHANGE TO BJ TAPE- IF RETAIL PUT DISTRIBUTOR IN COL 123-132              
*                                                                               
* BPLA 12/15/93 IN FMTAMT IF AMOUNT IS OVER 100 MILLION STAGGER                 
*               AMOUNTS                                                         
* BPLA 8/18/93  DDB TAPE ADD OFFICE F - AGENCY=DDB                              
*                                                                               
* BPLA 7/6/93   SPECIAL CODE FOR DDB OFFICES ON THEIR TAPE                      
*               BIGGER TAPE RECORD WAS 91 BYTES NOW 93                          
*               ALL DISPLACEMENTS PAST 10 BUMPED BY 2 BYTES                     
*                                                                               
* BPLA 3/10/93  CODE FOR WUNDERMAN (WW) TAPE                                    
*                                                                               
* BPLA 11/04/92 USE "UFC" AND "NET" FOR UPFRONT BILLING                         
*                                                                               
* BPLA 10/13/92 USE PPBVAL TO GET "EFFECTIVE" VALUES AND SET THEM               
*               IN PBILLREC  - NOTE - USE PPBVEBC FOR CASH DISC.                
*                                                                               
* BPLA 7/15/92 IF BILL IS BOTH AOR AND COMM ONLY DISPLAY "AOR"                  
*                                                                               
* BPLA 6/1/92  OFFICE 5 ADDED TO DDBNH                                          
*                                                                               
* BPLA 4/13/92 OFFICE CODES 7 + 8 ADDED TO DDBNH                                
*                                                                               
* BPLA 2/7/92  CHECK NEW PROGPROF OPTIONS FOR NEW PAGE FOR CLIENT               
*              AND PRODUCT                                                      
*                                                                               
* BPLA 12/9/91 FIX GST DISPLAY (ALLOW FOR BIGGER AMOUNTS)                       
*                                                                               
* BPLA 8/29/91 FIX HANDLEING OF CD INVOICES ON JWT TAPE                         
*                                                                               
* BPLA 8/26/91 DISPLAY .00 INSTEAD OF BLANKS FOR ZERO AMOUNTS                   
*                                                                               
* BPLA 6/4/91  SPECIAL PRD INTERFACE NUMBER FORMAT FOR KETCHUM                  
*              CLIENT PH AND PHD                                                
*                                                                               
* BPLA 3/27/91 INTERFACE TAPE FOR KETCHUM                                       
*                                                                               
* BPLA 3/25/91 ADD CLIENT INTERFACE NUMBER TO REPORT                            
*                                                                               
* BPLA 3/6/91  INTERFACE TAPE FOR DSTO                                          
*                                                                               
* BPLA 1/29/91 ADD GST COLUMN AND INCLUDE GST IN BILL AMOUNT                    
*              FOR CANADIAN AGYS.                                               
* ROSA 2/3/90  ADD NEW BILLING OPTION (COMMISS ONLY) TO OPT6                    
* BPLA 4/12/89 AOR BUG FIXED                                                    
*                                                                               
* BPLA 3/17/89 AOR OPTION - AOR ONLY,EXCLUDE AOR                                
* BPLA 9/27/88 ALLOW FOR ALPHA-NUMCERIC JWT INTERFACE CODES                     
* ROSA 7/28/88 ADD JWT INTERFACE                                                
*                                                                               
         TITLE 'PP1002 - PRINTPAK BILL REGISTER AND SPECIAL INTERFACE'          
*                                                                               
*                                                                               
* QOPT1        'F' = PRINT FORMULAS                                             
* QOPT2        'R' = PRINT REVERSAL INFO                                        
* QOPT3        'N' = NO PRINTING                                                
* QOPT4        ' ' = NO TAPE, Y = NORMAL TAPE, ELSE SPECIAL TAPE CODE           
* QOPT5         S= SOON BILLS ONLY                                              
* QOPT6         AOR OPTION                                                      
*               A=AOR ONLY                                                      
*               B=AOR ONLY AND AOR/CLIENT                                       
*               X=EXCLUDE AOR                                                   
*               N=EXCLUDE COMMISSION ONLY                                       
*               BLANK=AOR AND NON-AOR                                           
*              'C' = COMMISION ONLY BILLS                                       
* QOPT7    Y =  PRINT 50 INPUT AND OUTPUT RECORDS                               
*               BUT DON'T ACTUALLY PRODUCE A TAPE                               
*                                                                               
* QINVNO1      COL 53(4) START INVOICE NUMBER                                   
* QINVNO2      COL 57(4) END INVOICE NUMBER                                     
*                                                                               
PP1002   CSECT                                                                  
         PRINT NOGEN                                                            
         NMOD1 0,**PP1002                                                       
         SPACE 2                                                                
         L     RA,0(R1)                                                         
         USING PPWORKD,RA                                                       
*                                                                               
         LA    R8,SPACEND                                                       
         USING PP10WRKD,R8                                                      
*                                                                               
         L     R9,PPWORK2C                                                      
         USING PPWORK2D,R9                                                      
         MVC   ADMASTC,VMASTC          SAVE VMASTC                              
         DROP  R9                                                               
*                                                                               
         L     RC,PPFILEC                                                       
         USING PPFILED,RC                                                       
         LA    R9,PP1002+4095                                                   
         LA    R9,1(R9)                                                         
         USING PP1002+4096,R9           ** NOTE USE OF R9 AS                    
*                                          SECOND BASE REGISTER                 
         LA    R7,P                                                             
         USING BILLINED,R7                                                      
*                                                                               
         RELOC RELO                                                             
         SPACE 2                                                                
         CLI   MODE,RUNFRST                                                     
         BE    RUNF                                                             
         CLI   MODE,PROCBIL                                                     
         BE    PRBIL                                                            
         CLI   MODE,FBUYREQ                                                     
         BE    FBLR                                                             
         CLI   MODE,LBUYREQ                                                     
         BE    LBLR                                                             
***OFF                                                                          
         CLI   MODE,OFCFRST                                                     
         BE    FBOFF                                                            
         CLI   MODE,OFCLAST                                                     
         BE    LBOFF                                                            
***OFF                                                                          
         CLI   MODE,FBUYCLI                                                     
         BE    FBC                 FIRST BILL FOR CLIENT                        
         CLI   MODE,RUNLAST                                                     
         BE    LAST                                                             
*                                                                               
EXIT     DS    0H                                                               
         XIT1                                                                   
         EJECT                                                                  
RUNF     DS    0H                  RUN FIRST                                    
         RELOC RELO                                                             
*                                                                               
         L     RF,ADMASTC            USE MASTC'S AGYID                          
         USING MASTD,RF                                                         
         MVC   AMQRPT,MCVMQRPT                                                  
         DROP  RF                                                               
*                                                                               
         L     RF,=A(FMTAMTS)                                                   
         ST    RF,AFMTAMTS                                                      
*                                                                               
         MVI   BKOPENSW,C'N'      SET BK FILE NOT OPEN                          
*                                                                               
         GOTO1 DATCON,DMCB,(5,0),(20,CTODAY) TODAY - YYYYMMDD                   
         GOTO1 DATCON,DMCB,(5,0),(3,MTODAYB) TODAY BINARY                       
*                                                                               
*        GET TIME OF DAY                                                        
         TIME                                                                   
*                                                                               
*        R0 NOW HAS TIME HHMMSSHS  (PWOS)                                       
*                                                                               
         ST    R0,FULL                                                          
         SRL   R0,4                                                             
         ST    R0,MYFULL                                                        
         XC    DUB,DUB                                                          
         MVC   DUB+5(3),MYFULL                                                  
         OI    DUB+7,X'0F'                                                      
         CVB   R6,DUB                                                           
         EDIT  (R6),(5,TIMEOFD),2,FILL=0                                        
         MVI   TIMEOFD+5,C'.'                                                   
         UNPK  WORK(3),FULL+2(2)                                                
         MVC   TIMEOFD+6(2),WORK     HH.MM.SS                                   
*                                                                               
         MVI   ZEROS,C'0'                                                       
         MVC   ZEROS+1(L'ZEROS-1),ZEROS                                         
         MVI   DYNSW,C'N'          SET TAPE NOT ALLOCATED                       
*                                                                               
*        GET A(OFFICER)                                                         
*                                                                               
         XC    DMCB(12),DMCB                                                    
*                                                                               
         MVC   DUB,SPACES          GET OFFICER                                  
         MVC   DUB(6),=C'T00A38'                                                
         GOTO1 LOADER,DMCB,DUB,0                                                
*                                                                               
         MVC   VOFFICER,4(R1)      SAVE ADDRESS                                 
         MVI   PHHDSW,0            INIT PHHDSW                                  
         MVI   SMHDSW,0            INIT SMHDSW                                  
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
REQF     DS    0H                                                               
         SPACE 3                                                                
FBLR     DS    0H                  FIRST FOR REQUEST                            
*                                                                               
         XC    LOWINV,LOWINV     CLEAR LOW INVOICE NUMBER FILTER                
         MVC   HIINV,=X'FFFF'    SET HIGH INVOICE NUMBER FILTER TO MAX          
         CLC   QINVNO1(4),SPACES                                                
         BE    REQF5                                                            
         PACK  DUB,QINVNO1(4)                                                   
         CVB   R0,DUB                                                           
         STH   R0,LOWINV                                                        
*                                                                               
REQF5    DS    0H                                                               
         CLC   QINVNO2(4),SPACES                                                
         BE    REQF10                                                           
         PACK  DUB,QINVNO2(4)                                                   
         CVB   R0,DUB                                                           
         STH   R0,HIINV                                                         
*                                                                               
REQF10   DS    0H                                                               
         MVC   QINVNO1(4),SPACES      CLEAR FOR PPG                             
         MVC   QINVNO2(4),SPACES      CLEAR FOR PPG                             
*                                                                               
         MVI   TESTMQ,C'P'         SET TO PROD MQ NOTIFICATION                  
         CLI   QOPT7,C'N'                                                       
         BNE   *+8                                                              
         MVI   TESTMQ,C'N'         SUPPRESS MQ                                  
         CLI   QOPT7,C'Y'          TRACING OUTPUT RECORDS                       
         BNE   *+8                 ALSO SUPPRESS MQ                             
         MVI   TESTMQ,C'N'         SUPPRESS MQ                                  
         CLI   QOPT7,C'T'                                                       
         BNE   *+8                                                              
         MVI   TESTMQ,C'T'         TEST MQ                                      
*                                                                               
REQF13B  DS    0H                                                               
         CLC   QAGENCY,=C'SJ'   SJR TESTING                                     
         BE    REQF13B1                                                         
         CLC   QAGENCY,=C'BN'   PHDNY?                                          
         BE    REQF13B1         ALSO HAS SC JOHNSON                             
         CLC   QAGENCY,=C'OO'   OMD?                                            
         BE    REQF13B1         ALSO HAS SC JOHNSON                             
         CLC   QAGENCY,=C'H7'   MINDSHARE?                                      
         BNE   REQF13M                                                          
REQF13B1 CLI   QOPT4,C'S'       FILE TYPE S - SC JOHNSON                        
         BNE   REQF13B2                                                         
         MVI   SCSFTP,C'Y'                                                      
         B     REQF13B6                                                         
*                                                                               
REQF13B2 CLI   QOPT4,C'M'       FILE TYPE M - MAZDA                             
         BNE   REQF13B5                                                         
         MVI   MZSFTP,C'Y'                                                      
         B     REQF13B6                                                         
*                                                                               
REQF13B5 CLC   QAGENCY,=C'H7'  MINDSHARE - BURGER KING                          
         BNE   REQF13M                                                          
         CLI   QOPT4,C'B'      FILE TYPE B - BURGER KING                        
         BNE   REQF13M                                                          
         MVI   BKSFTP,C'Y'      DOING BURGER KING SFTP                          
*                                                                               
*        NOTE BKOPENSW ALSO SET FOR SC JOHNSON FILE AND MAZDA                   
*                                                                               
REQF13B6 CLI   BKOPENSW,C'Y'    IS BK FILE ALREADY OPEN?                        
         BE    REQF13M          IF SO, SKIP CODE BELOW                          
*                                                                               
         MVC   DSNAME,SPACES                                                    
         MVC   DSNAME+0(4),=C'BIL.'                                             
         MVC   DSNAME+4(3),=C'PRT'                                              
         MVI   DSNAME+7,C'.'                                                    
         CLI   QOPT4,C'B'             SEE IF DOING BURGER KING FILE             
         BNE   REQF13B7                                                         
         MVC   DSNAME+8(4),=C'H7PK'   MINDSHARE-BURGER KING (PRINT)             
         B     REQF13BA                                                         
*                                                                               
REQF13B7 CLI   QOPT4,C'M'             SEE IF DOING MAZDA FILE                   
         BNE   REQF13B8                                                         
****     L     RF,ADMASTC             USE MASTC'S AGYID                         
****     USING MASTD,RF                                                         
****     L     R1,MCAEXTRA                                                      
****     MVC   DSNAME+8(4),MCAGYCOD-MCEXTRA(R1)                                 
****     DROP  RF                                                               
         MVC   DSNAME+8(4),=C'H7MZ'   MINDSHARE-MAZDA                           
         B     REQF13BA                                                         
*                                                                               
REQF13B8 MVC   DSNAME+8(2),QAGENCY                                              
         MVC   DSNAME+10(2),=C'SP'    MUST BE SC JOHNSON FILE                   
*                                 BUT COULD BE AGENCY H7,OO,BN                  
         CLI   QMEDIA,C'I'            SEE IF DIGITAL MEDIA I OR S               
         BE    REQF13B9                                                         
         CLI   QMEDIA,C'S'            SEE IF DIGITAL MEDIA I OR S               
         BE    REQF13B9                                                         
         CLI   QMEDIA,C'L'            SEE IF DIGITAL MEDIA L SOCIAL             
         BE    REQF13B9                                                         
         CLI   QMEDIA,C'B'            SEE IF DIGITAL MEDIA B MOBILE             
         BE    REQF13B9                                                         
         CLI   QMEDIA,C'V'            SEE IF DIGITAL MEDIA V NAT. VIDEO         
         BE    REQF13B9                                                         
         CLI   QMEDIA,C'W'            SEE IF DIGITAL MEDIA W LOC. VIDEO         
         BE    REQF13B9                                                         
         CLI   QMEDIA,C'D'            SEE IF DIGITAL MEDIA D DIG. AUDIO         
         BE    REQF13B9                                                         
*                                                                               
         B     REQF13BA                                                         
*                                                                               
REQF13B9 MVC   DSNAME+10(4),=C'SD'    DIGITAL                                   
*                                                                               
REQF13BA MVC   DSNAME+12(2),=C'.D'                                              
         MVC   DSNAME+14(6),CTODAY+2    YYMMDD                                  
         MVC   DSNAME+20(2),=C'.T'                                              
         MVC   DSNAME+22(2),TIMEOFD         WITHOUT .'S                         
         MVC   DSNAME+24(2),TIMEOFD+3                                           
         MVC   DSNAME+26(2),TIMEOFD+6                                           
         MVC   MQMAPNM,=C'SFTPDISK.PROD.'                                       
         CLI   QOPT7,C'Y'                                                       
         BE    REQF13H                                                          
         CLI   QOPT7,C'N'   NO MQ NOTIFICATION                                  
         BE    REQF13H      ALSO PUT 'TEST' IN MQMAPNM                          
         CLI   TESTMQ,C'T'  PUTTING TO TEST BROKER?                             
         BNE   *+10                                                             
REQF13H  MVC   MQMAPNM+9(4),=C'TEST'                                            
*                                                                               
         MVI   BYTE,X'45'         X'04' = BIG NAMES                             
         MVC   DUB,=X'000005000001'                                             
         CLI   BKSFTP,C'Y'        SEE IF DOING BK FILE                          
         BNE   REQF13H5                                                         
         GOTO1 DYNALLOC,DMCB,(X'80',=C'BKPBIT1 '),(BYTE,DUB),          X        
               (X'80',MQMAPNM)                                                  
*                                                                               
         OPEN  (BKPBIT1,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
         MVI   BKOPENSW,C'Y'     SET BK FILE OPEN                               
         B     REQF13M                                                          
*                                                                               
REQF13H5 CLI   SCSFTP,C'Y'       SEE IF DOING SC JOHNSON FILE                   
         BNE   REQF13H7                                                         
         GOTO1 DYNALLOC,DMCB,(X'80',=C'SCPBIT1 '),(BYTE,DUB),          X        
               (X'80',MQMAPNM)                                                  
*                                                                               
         OPEN  (SCPBIT1,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
         MVI   BKOPENSW,C'Y'     SET SC FILE OPEN                               
         B     REQF13M                                                          
*                                                                               
REQF13H7 CLI   MZSFTP,C'Y'       SEE IF DOING MAZDA FILE                        
         BNE   REQF13H9                                                         
         GOTO1 DYNALLOC,DMCB,(X'80',=C'MZPBIT1 '),(BYTE,DUB),          X        
               (X'80',MQMAPNM)                                                  
*                                                                               
         OPEN  (MZPBIT1,(OUTPUT))                                               
         LTR   RF,RF                                                            
         BZ    *+6                                                              
         DC    H'0'                                                             
         MVI   BKOPENSW,C'Y'     SET MZ FILE OPEN                               
         B     REQF13M                                                          
*                                                                               
REQF13H9 DS    0H                                                               
         DC    H'0'             SHOULDN'T GET HERE                              
*                               UNKNOW FILE TYPE FOR H7,SJ                      
*                                                                               
REQF13M  DS    0H                                                               
*                                                                               
         SR    R0,R0            SET INVOICE LIST BINSRCH PARS                   
         L     R1,=A(INVTAB)                                                    
         A     R1,RELO                                                          
         SR    R2,R2                                                            
         LA    R3,4                                                             
         LA    R4,4                                                             
         L     R5,=A(INVMAX)    INVMAX IS 10,000 INVS PER CLT                   
         STM   R0,R5,INVPARS                                                    
*                                                                               
         CLI   FIRSTSW,0           FIRST TIME TEST                              
         BNE   FBLR1                                                            
         MVI   FIRSTSW,1                                                        
*                                                                               
         ZAP   SBCOUNT,=P'0'       CLEAR STARBUCKS RECORD COUNT                 
         ZAP   SBTOTAL,=P'0'       CLEAR STARBUCKS $ TOTAL                      
         ZAP   DGCOUNT,=P'0'       CLEAR DIAGEO RECORD COUNT                    
         ZAP   GMCOUNT,=P'0'       CLEAR GM LMA RECORD COUNT                    
         ZAP   DGTOTAL,=P'0'       CLEAR DIAGEO $ TOTAL                         
         ZAP   DG2COUNT,=P'0'      CLEAR DIAGEO RECORD COUNT                    
         ZAP   DG2TOTAL,=P'0'      CLEAR DIAGEO $ TOTAL                         
         MVI   DGISKIP,C'N'                                                     
*                                                                               
         ZAP   OBCOUNT,=P'0'       OB10  RECORD COUNT                           
         ZAP   OBTOTAL,=P'0'       OB10 $ TOTAL                                 
         MVI   OBISKIP,C'N'                                                     
*                                                                               
         LA    R3,RUNTOTS                                                       
         BAS   RE,CLRTOTS                                                       
         LA    R3,TRUNTOTS         TOTAL FOR TAPE                               
         BAS   RE,CLRTOTS                                                       
*                                                                               
         XC    RUNINVS,RUNINVS      RUN INVOICE TOTALS                          
         XC    TRUNINVS,TRUNINVS    TAPE INVOICE TOTALS                         
*                                                                               
         XC    START(12),START                                                  
         XC    AOUTP,AOUTP                                                      
         XC    LSTBLKY,LSTBLKY                                                  
         XC    EATOTS,EATOTS       CLEAR ESTIMATE AMTS                          
         MVC   SAVMAX,MAXLINES                                                  
*                                                                               
FBLR1    DS    0H                                                               
*                                                                               
         MVI   RACTSW,0              ZERO REQUEST ACTIVITY                      
         MVI   OACTSW,0              ZERO REQUEST ACTIVITY                      
*                                                                               
         MVC   DYNDDN,=CL8'P10TAPE'                                             
         MVC   DYNDSN,=CL20'PRTTAPE.PP010XX1'                                   
         MVC   DYNDSN+13(2),QAGENCY                                             
*                                                                               
         CLC   QAGENCY,=C'H7'       MSNYA                                       
         BNE   FBLR1A                                                           
         CLI   QOPT4,C'A'           AMGEN FILE?  OR CHECK ID?                   
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'2'       USE SUFFIX 2                                
*                                                                               
         CLI   QOPT4,C'C'           COLGATE FILE?  OR CHECK ID?                 
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'3'       USE SUFFIX 2                                
*                                                                               
         B     FBLR1C               ELSE LEAVE AS 1                             
*                                                                               
FBLR1A   CLC   QAGENCY,=C'MC'                                                   
         BNE   FBLR1B                                                           
         CLC   RCORIGID,=X'2D33'    MCBT  # 11571                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'2'      USE SUFFIX 2 INSTEAD OF 1                    
         CLC   RCORIGID,=X'2C95'    MCTT  # 11413                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'3'      USE SUFFIX 3 INSTEAD OF 1                    
         CLC   RCORIGID,=X'39F0'   UMCHR  # 14832                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'4'      USE SUFFIX 4 INSTEAD OF 1                    
         CLC   RCORIGID,=X'2D21'   MCLOU  # 11553                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'5'      USE SUFFIX 5 INSTEAD OF 1                    
         CLC   RCORIGID,=X'038D'   MLOU  # 909                                  
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'5'      USE SUFFIX 5 INSTEAD OF 1                    
*                                                                               
*        FOR ANY OTHER MCCANN ID'S LEAVE SUFFIX AS 1                            
*                                                                               
         B     FBLR1C                                                           
*                                                                               
FBLR1B   CLC   QAGENCY,=C'U#'                                                   
         BNE   FBLR1B3                                                          
         CLC   RCORIGID,=X'39E6'     UMTOA  # 14822                             
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'2'      USE SUFFIX 2 INSTEAD OF 1                    
*                                                                               
         CLC   RCORIGID,=X'3E71'     INMETO # 15985                             
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'3'      USE SUFFIX 3 INSTEAD OF 1                    
*                                                                               
         CLC   RCORIGID,=X'3FB6'     CITO # 16310                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'5'      USE SUFFIX 5 INSTEAD OF 1                    
*                                                                               
         CLC   RCORIGID,=X'3FB7'     RMTO # 16311                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'6'      USE SUFFIX 5 INSTEAD OF 1                    
*                                                                               
         CLC   RCORIGID,=X'3E66'     ORTO # 15974                               
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'4'      USE SUFFIX 4 INSTEAD OF 1                    
         B     FBLR1C             OTHERWISE LEFT AS 1                           
*                                                                               
FBLR1B3  CLC   QAGENCY,=C'WI'     WILA?                                         
         BNE   FBLR1B4                                                          
         CLC   RCORIGID,=H'15634'    IPGSAPWI                                   
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'2'                                                   
         CLC   RCORIGID,=H'15635'    WILAUSA                                    
         BNE   *+8                                                              
         MVI   DYNDSN+15,C'3'                                                   
         B     FBLR1C          OTHER WILA ID'S - LEAVE AS 1                     
*                                                                               
FBLR1B4  CLC   QAGENCY,=C'BN'   PHD                                             
         BNE   FBLR1B5                                                          
         CLI   QOPT4,C'B'       SEE IF STARBUCKS FORMAT                         
         BNE   FBLR1C           IF  NOT, LEAVE SUFFIX ALONE                     
         MVI   DYNDSN+15,C'2'   IF SO, SET SUFFIX TO 2                          
*                                                                               
FBLR1B5  CLC   QAGENCY,=C'UB'   CARAT?                                          
         BNE   FBLR1C           NO                                              
         CLI   QOPT4,C'G'       GM FORMAT?                                      
         BNE   *+8              NO                                              
         MVI   DYNDSN+15,C'2'   ALTER SUFFIX TO 2 FOR GM                        
         CLI   QOPT4,C'S'       SMUCKERS FORMAT?                                
         BNE   FBLR1C           IF NOT LEAVE SUFFIX ALONE                       
         MVI   DYNDSN+15,C'3'   ALTER SUFFIX TO 3 FOR SMUCKERS                  
         B     FBLR1C                                                           
*                                                                               
FBLR1C   CLC   QAGENCY,=C'G+'   WINGLATINO                                      
         BNE   *+10                                                             
         MVC   DYNDSN+13(2),=C'G@'       USE G@ SINCE + SIGN CAN'T BE           
*                                    PART OF DATASET NAME                       
*                                                                               
*              NO-OP MIX FOR TAPE SPECS CHK                                     
**                                                                              
         CLI   QOPT4,C'N'                                                       
         BE    FBLR2                                                            
*                                                                               
         MVC   BYTE,QOPT4          TAPE SPEC                                    
         CLI   BYTE,C'Y'           Y = BLANK                                    
         BNE   *+8                                                              
         MVI   BYTE,C' '                                                        
         CLI   TAPTYP,0            TEST ALREADY SET                             
         BNE   *+14                                                             
         MVC   TAPTYP,BYTE                                                      
         B     FBLR2                                                            
         CLC   TAPTYP,BYTE         MAY NOT MIX TAPE SPECS                       
         BE    FBLR3                                                            
*                                                                               
         MVC   P(80),QPROG                                                      
         MVC   PSECOND(55),=C'**MIXED TAPE SPECS IN ONE RUN - THIS REQUX        
               EST BYPASSED**'                                                  
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         MVI   MODE,LBUYREQ                                                     
         B     EXIT                                                             
*                                                                               
FBLR2    DS    0H                                                               
         CLI   QOPT4,C'N'          NO TAPE                                      
         BE    FBLR3                                                            
         LM    R3,R5,AGYLST                                                     
         A     R3,RELO                                                          
         A     R5,RELO                                                          
         MVC   WORK(4),SPACES                                                   
         MVC   WORK(2),RCAGYFLT                                                 
         MVC   WORK+2(1),TAPTYP    SPECIAL FORMAT CODE                          
*                                                                               
         CLC   WORK(4),0(R3)                                                    
         BE    *+8                                                              
         BXLE  R3,R4,*-10                                                       
*                                                                               
         L     RF,4(R3)                                                         
         LTR   RF,RF               TEST HAVE TAPE PROC                          
         BNZ   FBLR2D                                                           
         CLI   QOPT4,C' '         OK IF NO TAPE SPEC                            
         BNH   FBLR3                                                            
*                                                                               
         MVC   P(80),QPROG                                                      
         MVC   PSECOND(35),=C'**INVALID TAPE SPEC- REQ BYPASSED**'              
         MVI   SKIPSPEC,C'Y'                                                    
         GOTO1 REPORT                                                           
         MVI   MODE,LBUYREQ                                                     
         B     EXIT                                                             
*                                                                               
FBLR2D   DS    0H                                                               
         A     RF,RELO                                                          
         ST    RF,AOUTP                                                         
*                                                                               
FBLR3    DS    0H                                                               
         LA    R3,PRDTOTS                                                       
         BAS   RE,CLRTOTS                                                       
         LA    R3,CLTTOTS                                                       
         BAS   RE,CLRTOTS                                                       
***OFF                                                                          
         LA    R3,OFFTOTS                                                       
         BAS   RE,CLRTOTS                                                       
***OFF                                                                          
         LA    R3,REQTOTS                                                       
         BAS   RE,CLRTOTS                                                       
*                                                                               
         XC    CLTINVS,CLTINVS   CLEAR CLIENT AND REQ INVOICE TOTALS            
         XC    REQINVS,REQINVS                                                  
*                                                                               
         XC    LASTKEY,LASTKEY                                                  
         MVI   FORCEHED,C'Y'                                                    
         MVC   PAGE,=H'1'                                                       
         MVI   TOTSW,0                                                          
         OC    START(12),START                                                  
         BNZ   *+10                                                             
         MVC   START(12),QSTART    SET START-END FROM FRST REQ                  
         CLC   START(12),SPACES                                                 
         BNE   FBLR4                                                            
         MVC   START+00(2),RCDATE+06   YY                                       
         MVC   START+02(2),RCDATE+00   MM                                       
         MVC   START+04(2),RCDATE+03   DD       ***   CONVERT START             
         GOTO1 DATCON,DMCB,(0,START),(0,START)  *** TO NEW DATE FORMAT          
         MVC   END,START                                                        
FBLR4    DS    0H                                                               
         CLC   QSTART(12),SPACES                                                
         BNE   *+10                                                             
         MVC   QSTART(12),START                                                 
         B     EXIT                                                             
         SPACE 3                                                                
AGYLST   DS    0F                AGENCY TABLE                                   
         DC    A(AGYLST+12)                                                     
         DC    A(8)                                                             
         DC    A(AGYLSTX-1)                                                     
*                                                                               
         DC    CL4'AR  ',A(YNPROC)       YNR - ARMY                             
         DC    CL4'BDC ',A(BDCHRYS)    BBDO-CHRYSLER                            
         DC    CL4'BJ  ',A(BJPROC)                                              
         DC    CL4'BJC ',A(BDCHRYS)    B&J -CHRYSLER                            
         DC    CL4'BNB ',A(SBPROC)       PHDNY - STARBUCKS FORMAT               
         DC    CL4'BNC ',A(BDCHRYS)    BBDO-CHRYSLER                            
         DC    CL4'BNH ',A(NHS)                                                 
         DC    CL4'BNP ',A(BNPROC)       PHDDE                                  
         DC    CL4'BNS ',A(SCPROC)       PHDNY - SC JOHNSON  FORMAT             
         DC    CL4'CA  ',A(CMTH)                                                
         DC    CL4'CE  ',A(CMTH)         CAMPBELL-MITHUNE-ESTY                  
         DC    CL4'CH  ',A(INTRP)                                               
         DC    CL4'CO  ',A(COMPROC)                                             
         DC    CL4'CW  ',A(DDBNH)        CW=DDB-NEEDHAM                         
         DC    CL4'DA  ',A(DAPROC)       DSTO - DONER SHUR PEPPLER              
         DC    CL4'DF  ',A(DFPROC)                                              
         DC    CL4'DFT ',A(DFTPROC)      SAATCHI - TOYOTA                       
         DC    CL4'DK  ',A(ROSS)         DKG SAME AS ROSS                       
         DC    CL4'DR  ',A(MARST)      DR=SCALI=MARST                           
         DC    CL4'D9I ',A(IPGPROC)      ****TEST - IPG                         
         DC    CL4'FC  ',A(FCB)                                                 
         DC    CL4'FCC ',A(FCCOORS)    FC COORS                                 
         DC    CL4'FCL ',A(MARST)      FOOTE-CONE(LIEBER-KATZ)                  
         DC    CL4'FCT ',A(FCTACO)     FC TACO BELL                             
         DC    CL4'FCA ',A(FCATT)      FC ATT                                   
         DC    CL4'FT  ',A(FCB)                                                 
         DC    CL4'G7  ',A(G7PROC)       GSTX                                   
         DC    CL4'G+  ',A(M2GPROC)      WINGLATINO - LIKE MEDIACOM             
         DC    CL4'H7  ',A(M2GPROC)      MAXUS - LIKE MEDIACOM                  
*ON-HLD* DC    CL4'H7A ',A(OBPROC)     MSYNA - AMGEN 0B10 FORMAT                
         DC    CL4'H7B ',A(BKPROC)      MINDSHARE - BURGER KING FORMAT          
*ON-HLD* DC    CL4'H7C ',A(OBPROC)     MSYNA - COLGATE 0B10 FORMAT              
         DC    CL4'H7S ',A(SCPROC)      MINDSHARE - SC JOHNSON  FORMAT          
         DC    CL4'H7M ',A(MZPROC)      MINDSHARE - MAZDA FORMAT                
*        DC    CL4'H9  ',A(H9PROC)       STARCOM FOR PHILLIP MORRIS             
         DC    CL4'H9P ',A(H9PROC)       STARCOM FOR PHILLIP MORRIS             
         DC    CL4'IJI ',A(IPGPROC)      ****TEST - IPG                         
         DC    CL4'I5I ',A(IPGPROC)      ICCNJ                                  
*OLDAGY* DC    CL4'JW  ',A(JWT)                                                 
         DC    CL4'KA  ',A(KETCH)        KETCHUM                                
         DC    CL4'KN  ',A(BJPROC)       NB- K&E USES B&J FORMAT                
         DC    CL4'LM  ',A(STSPECS)      LOEWE-MARSCHALK (STANDARD)             
         DC    CL4'LMI ',A(IPGPROC)      ****TEST - IPG                         
         DC    CL4'LT  ',A(STSPECS)      LOEWE-MARSCHALK (STANDARD)             
         DC    CL4'MC  ',A(INTRP)                                               
         DC    CL4'MCA ',A(MCAPROC)      MCCANN - ATT                           
         DC    CL4'MCC ',A(MCCPROC)      MCCANN - CHRYSLER                      
         DC    CL4'MCI ',A(IPGPROC)      MCCANN - LIKE IPG                      
         DC    CL4'MCM ',A(MCMPROC)      MCCANN - ADWARE                        
         DC    CL4'MCS ',A(WIPROC2)      MCCANN - TM ADVERTISING                
         DC    CL4'MY  ',A(COMPROC)      NEW RUMRILL-HOYT                       
         DC    CL4'M1  ',A(WIPROC)       MFI SAME AS WESTERN (WILA)             
         DC    CL4'M1A ',A(WIPROC2)      MFI SAME AS WESTERN (WILA)             
         DC    CL4'M1I ',A(IPGPROC)      WESTERN IPG                            
         DC    CL4'M2  ',A(M2GPROC)      MEDIACOM - `FMS                        
**NO-OP  DC    CL4'M2D ',A(DGPROC)       MEDIACOM - DIAGEO FORMAT               
**                                       M2 LOST DIAGEO                         
**                                       SOME OTHER AGENCY MAY USE              
**                                                                              
**OLD**  DC    CL4'M$  ',A(PUPROC)       MULLEN SAME AS AMMIRATTI               
         DC    CL4'M$  ',A(G7PROC)       MULLEN SAME AS GSTX                    
         DC    CL4'NE  ',A(DDBNH)        DDB-NEEDHAM                            
         DC    CL4'NEH ',A(NHS)                                                 
         DC    CL4'NIH ',A(NHS)                                                 
         DC    CL4'NR  ',A(DDBNH)        NR=DDB-NEEDHAM                         
         DC    CL4'NTH ',A(NHS)          NEEDHAM - CANADA                       
         DC    CL4'OM  ',A(OMPROC)       OGILVY & MATHER                        
         DC    CL4'OOE ',A(OOPROCE)      OMD - FOR EDWARD JONES                 
         DC    CL4'OOS ',A(SCPROC)       OMD - SC JOHNSON  FORMAT               
         DC    CL4'OUE ',A(OOPROCE)   CANADA - FOR EDWARD JONES*                
         DC    CL4'RC  ',A(ROSS)                                                
         DC    CL4'RH  ',A(COMPROC)      RUMRILL-HOYT                           
         DC    CL4'RN  ',A(COMPROC)                                             
         DC    CL4'RR  ',A(ROSS)                                                
         DC    CL4'SC  ',A(MARST)      SCALI=LIEBER KATZ=MARSTELLER             
         DC    CL4'SG  ',A(KETCH)        MARTIN ADV - KETHCUM SPEC              
         DC    CL4'SJ  ',A(STSPECS)      SJR (STANDARD)                         
         DC    CL4'SJM ',A(MZPROC)      SJR TEST  - MAZDA FORMAT                
         DC    CL4'SJS ',A(SCPROC)      SJR TEST  - SC JOHNSON  FORMAT          
         DC    CL4'ST  ',A(MARST)      MARSTELLER                               
**OLD**  DC    CL4'TBG ',A(TBGFOOD)      BATES - GENERAL FOODS                  
*****    DC    CL4'THT ',A(DFTPROC)      ZENITH  - TOYOTA                       
         DC    CL4'TR  ',A(TLPROC)       TRACY LOCK - NEW                       
         DC    CL4'TRO ',A(TRAPROC)      TRACY LOCK - OLD                       
         DC    CL4'UBD ',A(DGPROC)       CARAT - DIAGEO FORMAT                  
         DC    CL4'UBG ',A(GMPROC)       CARAT - CARAT - GM LMA                 
         DC    CL4'UBS ',A(SMIPROC)      CARAT - SMUCKERS                       
         DC    CL4'US  ',A(BJPROC)       NB- UNSY USES B&J FORMAT               
         DC    CL4'U#  ',A(M2PROC)       M2 - M2T0A                             
         DC    CL4'U#I ',A(IPGPROC)      M2 - M2T0A                             
         DC    CL4'HDI ',A(IPGPROC)      HDTO TEST                              
         DC    CL4'WI  ',A(WIPROC)       WESTERN - WILA                         
         DC    CL4'WIA ',A(WIPROC2)      WESTERN - WILA                         
         DC    CL4'WII ',A(IPGPROC)      WESTERN - IPG                          
         DC    CL4'WJ  ',A(WIPROC)       WESTERN - WITEST                       
         DC    CL4'WR  ',A(WIPROC)       WESTERN - WRLA                         
         DC    CL4'WRA ',A(WIPROC2)      WESTERN - WRLA                         
         DC    CL4'WT  ',A(M2PROC)       NOW WITO - USE SAME SPEC AS U#         
         DC    CL4'YN  ',A(YNPROC)       YNR                                    
         DC    CL4'FMP ',A(PHPROC)       HAVAS - PHILLIPS                       
*                                    *AGENCY CODE UNKNOWN AT THIS TIME          
*                                                                               
AGYLSTX  EQU   *                                                                
         DC    CL4'XX',A(0)                                                     
         EJECT                                                                  
FBC      DS    0H                  FIRST FOR CLIENT                             
*                                                                               
*        SET SAVCOFF HERE FOR ALL REQUESTS                                      
*                                                                               
         MVC   SAVCOFF,SPACES                                                   
         MVC   SAVCOFF(1),PCLTOFF    SAVE OFFICE FOR HEADLINES                  
*                                                                               
         XC    WORK,WORK                                                        
OFFD     USING OFFICED,WORK                                                     
         MVI   OFFD.OFCSYS,C'P'                                                 
*                                                                               
         MVC   OFFD.OFCAGY,QAGENCY                                              
         MVC   OFFD.OFCPMED,QMEDIA                                              
         MVC   OFFD.OFCOFC,PCLTOFF                                              
*                                                                               
         GOTO1 VOFFICER,DMCB,(C'2',WORK),(0,VCOMFACS)                           
         CLI   0(R1),0                                                          
         BNE   TBCLTF0                                                          
         MVC   SAVCOFF,OFFD.OFCOFC2                                             
*                                                                               
         DROP  OFFD                                                             
*                                                                               
TBCLTF0  DS    0H                                                               
         CLC   SAVCOFF,=X'0000'   IF STILL ZEROS, MAKE SPACES                   
         BNE   *+10                                                             
         OC    SAVCOFF,SPACES    NEEDED FOR CLIENTS WITHOUT AN OFFICE           
*                                                                               
         CLI   QOPT4,C'N'           SEE IF A TAPE REQUEST                       
         BE    FBC0X                NO - PROCESS ALL CLTS                       
*                                                                               
         CLC   QAGENCY,=C'DF'       SEE IF SAATCHI                              
*****    BE    FBC0                 YES                                         
*****    CLC   QAGENCY,=C'TH'       OR ZENITH                                   
         BNE   FBC0D                NO                                          
*                                                                               
FBC0     CLI   QOPT4,C'T'           AND IF TOYOTA TAPE                          
         BNE   FBC0X                                                            
*                              IF SO SKIP ALL BUT FOLLOWING CLIENTS             
         CLC   PCLTKCLT,=C'TOC'      CONHILL ?                                  
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'LEX'      TEAM ONE ?                                 
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'LDA'      TEAM ONE ?                                 
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'LDL'      TEAM ONE ?                                 
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'TM '      SAATCHI ?                                  
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'TMD'      SAATCHI ?                                  
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'TMS'      SAATCHI ?                                  
         BE    FBC0X                 YES - PROCESS                              
         CLC   PCLTKCLT,=C'TX '      SAATCHI ?                                  
         BE    FBC0X                 YES - PROCESS                              
         B     FBC0N               SKIP TO NEXT CLIENT                          
*                                                                               
FBC0D    DS    0H                                                               
         B     FBC0X                                                            
**                                                                              
**       06/10 AGENCY "PU" IS DELETED SO BELOW NO-OPPED                         
**                                                                              
**       CLC   QAGENCY,=C'PU'       SEE IF AMMARITTI                            
**       BNE   FBC0F                                                            
**       CLC   PCLTKCLT,=C'COM'     IF SO THEN SKIP CLIENT COM                  
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'CDI'     AND CDI                                     
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'CDM'     AND CDM                                     
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'CMI'     AND CMI                                     
**       BE    FBC0N                                                            
*NOP*    CLC   PCLTKCLT,=C'INM'     AND INM  (*NOP* 06/08/98)                   
*NOP*    BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'LCO'     AND LCO                                     
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'MIN'     AND MIN                                     
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'MLO'     AND MLO                                     
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'BAC'     AND BAC                                     
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'DEL'     AND DEL      04/05/00                       
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'CWW'     AND CWW                                     
**       BNE   FBC0X                                                            
*                                                                               
FBC0N    MVI   MODE,LBUYCLI         SKIP TO NEXT CLIENT                         
         B     EXIT                                                             
*                                                                               
FBC0F    DS    0H                                                               
         B     FBC0X                                                            
**                                                                              
**       01/05 SONY CLIENT SKIPPING NO-OPED                                     
**                                                                              
**C0F    CLC   QAGENCY,=C'MC'       MCCANN?                                     
**       BNE   FBC0X                                                            
**       CLI   QOPT4,C'M'            ADWARE FILE?                               
**       BNE   FBC0X                                                            
**                                                                              
**       CLC   PCLTKCLT,=C'RCL'      SKIP SOME SONY CLTS                        
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'RLA'      SONY CLT                                   
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'RNE'      SONY CLT                                   
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'RNW'      SONY CLT                                   
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'RSE'      SONY CLT                                   
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'RSO'      SONY CLT                                   
**       BE    FBC0N                                                            
**       CLC   PCLTKCLT,=C'RSW'      SONY CLT                                   
**       BE    FBC0N                                                            
*                                                                               
FBC0X    DS    0H                                                               
         XC    B1PROF,B1PROF        FIRST READ B1 AND B1X PROFILES              
         XC    B1XPROF,B1XPROF      B1X PROFILE                                 
         XC    WORK,WORK                                                        
         MVC   WORK(4),=C'POB1'                                                 
         MVC   WORK+4(2),QAGENCY                                                
         MVC   WORK+6(1),QMEDIA                                                 
         MVC   WORK+7(3),PCLTKCLT                                               
         CLI   PCLTOFF,C' '                                                     
         BNH   FBC1                                                             
         MVI   WORK+10,C'*'                                                     
         MVC   WORK+11(1),PCLTOFF                                               
*                                                                               
FBC1     DS    0H                                                               
         GOTO1 GETPROF,DMCB,WORK,B1PROF,DATAMGR                                 
         MVC   WORK(4),=C'PB1X'                                                 
         NI    WORK,X'BF'          MAKE SYS LOWER CASE FOR PAGE A               
         GOTO1 GETPROF,DMCB,WORK,B1XPROF,DATAMGR                                
*                                                                               
*                                                                               
         CLI   QCLIENT,C'*'        ONE OFFICE REQUEST ?                         
         BE    FBC1B               YES                                          
         CLI   QCLIENT,C'$'        ALL OFFICE REQUEST ?                         
         BE    FBC1B               YES                                          
         CLC   QCLIENT,=C'ALL'     ALL CLIENTS REQUEST ?                        
         BNE   FBC1D               NO - ONE CLIENT ONLY REQUEST                 
*                                                                               
FBC1B    MVI   PCLTREC,0           TO CLEAR MEDIA NAME OVERRIDE                 
*                                                                               
FBC1D    MVI   NEWCLT,C'Y'                                                      
         MVC   SVMID,SPACES                                                     
         MVC   SVMID2,SPACES                                                    
         MVC   SVMID(7),=C'CLIENT='                                             
         MVC   SVMID+8(3),PCLTKCLT                                              
         MVC   SVMID+12(L'PCLTNAME),PCLTNAME                                    
         MVC   WORK(8),SPACES                                                   
         CLI   PCLTNUM,X'FF'                                                    
         BNE   FBC2                                                             
         MVI   WORK,C'('                                                        
         UNPK  WORK+1(5),PCLTNUM+1(3)                                           
         MVI   WORK+5,C')'                                                      
         B     FBC4                                                             
*                                                                               
FBC2     MVC   BYTE,PCLTNUM                                                     
         NI    BYTE,X'F0'                                                       
         CLI   BYTE,X'80'                                                       
         BNE   FBC3                                                             
         XC    FULL,FULL                                                        
         MVC   FULL+1(3),PCLTNUM                                                
         NI    FULL+1,X'7F'                                                     
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         MVI   WORK,C'('                                                        
         UNPK  WORK+1(5),DUB                                                    
         MVI   WORK+6,C')'                                                      
         B     FBC4                                                             
*                                                                               
FBC3     DS    0H                                                               
         MVC   WORK+1(3),PCLTNUM                                                
         OC    WORK+1(3),SPACES                                                 
         CLC   WORK+1(3),SPACES                                                 
         BE    FBC4X                                                            
         MVI   WORK,C'('                                                        
         LA    R1,WORK+3                                                        
FBC3C    CLI   0(R1),C' '                                                       
         BH    FBC3D                                                            
         BCT   R1,FBC3C                                                         
*                                                                               
FBC3D    MVI   1(R1),C')'                                                       
*                                                                               
FBC4     DS    0H                                                               
         LA    R1,SVMID+12+L'PCLTNAME                                           
FBC4C    CLI   0(R1),C' '                                                       
         BH    FBC4E                                                            
         BCT   R1,FBC4C                                                         
FBC4E    MVC   2(8,R1),WORK                                                     
*                                                                               
FBC4X    DS    0H                                                               
         LA    R1,SVMID+12+L'PCLTNAME+10                                        
FBC5     CLI   0(R1),C' '                                                       
         BH    FBC10                                                            
         BCT   R1,FBC5                                                          
*                                                                               
FBC10    LA    R2,SVMID2                                                        
         LA    R1,132(R1)           SAME DISPLACEMENT INTO SVMID2               
         SR    R1,R2                                                            
         LTR   R1,R1                                                            
         BP    *+6                                                              
         DC    H'0'               SOMETING VERY WRONG                           
*                                                                               
         EX    R1,*+8                                                           
         B     FBCX                                                             
         MVC   SVMID2(0),=40C'-'                                                
*                                                                               
FBCX     B     EXIT                                                             
         EJECT                                                                  
         SPACE 3                                                                
LBLR     DS    0H                  LAST FOR REQUEST                             
         CLI   QCLIENT,C'$'                                                     
         BE    LBLR2                                                            
*                                                                               
         MVC   CLTINVS,INVPARS+8   LAST CLIENT'S INVOICE TOTAL                  
*                                                                               
         CLI   RACTSW,0            CHK FOR ACTIVITY                             
         BNE   PRB2B               IF YES - GO FINISH LAST PRD/CLT              
LBLR2    DS    0H                                                               
         CLI   RACTSW,0                                                         
         BE    EXIT                                                             
         LA    R3,REQTOTS                                                       
         LA    R4,RUNTOTS                                                       
         BAS   RE,ROLTOTS                                                       
         L     R0,RUNINVS                                                       
         A     R0,REQINVS                                                       
         ST    R0,RUNINVS                                                       
         CLI   QOPT4,C'N'                                                       
         BE    LBLR4                                                            
         LA    R3,REQTOTS                                                       
         LA    R4,TRUNTOTS         ALSO POST TO TAPE TOTALS                     
         BAS   RE,ROLTOTS                                                       
         L     R0,TRUNINVS                                                      
         A     R0,REQINVS                                                       
         ST    R0,TRUNINVS                                                      
*                                                                               
LBLR4    BAS   RE,PRNT                                                          
         MVC   BLINE(18),=C'**REQUEST TOTALS**'                                 
         MVC   BLINE+25(9),=C'INVOICES='                                        
         EDIT  (B4,REQINVS),(7,BLINE+34),0,COMMAS=YES,ALIGN=LEFT                
*                                                                               
         LA    R3,REQTOTS                                                       
         MVI   TOTSW,2                                                          
         GOTO1 AFMTAMTS                                                         
         BAS   RE,PRNT                                                          
         B     EXIT                                                             
         SPACE 3                                                                
LAST     DS    0H                  RUN LAST                                     
         BAS   RE,PRNT                                                          
         MVC   BLINE(14),=C'**RUN TOTALS**'                                     
         MVC   BLINE+25(9),=C'INVOICES='                                        
         EDIT  (B4,RUNINVS),(7,BLINE+34),0,COMMAS=YES,ALIGN=LEFT                
         LA    R3,RUNTOTS                                                       
         MVI   TOTSW,2                                                          
         GOTO1 AFMTAMTS                                                         
         MVI   SPACING,2                                                        
         BAS   RE,PRNT                                                          
         MVC   BLINE(15),=C'**TAPE TOTALS**'                                    
         MVC   BLINE+25(9),=C'INVOICES='                                        
         EDIT  (B4,TRUNINVS),(7,BLINE+34),0,COMMAS=YES,ALIGN=LEFT               
         LA    R3,TRUNTOTS                                                      
         MVI   TOTSW,2                                                          
         GOTO1 AFMTAMTS                                                         
         BAS   RE,PRNT                                                          
         L     RF,AOUTP                                                         
         LTR   RF,RF                                                            
         BZ    EXIT                                                             
         BASR  RE,RF                                                            
*                                                                               
         CLI   BKSFTP,C'Y'       AM I DOING A BURGER KING SFTP?                 
         BE    RUNLBK                                                           
         CLI   SCSFTP,C'Y'       AM I DOING A SC JOHNSON SFTP?                  
         BE    RUNLBK1                                                          
         CLI   MZSFTP,C'Y'       AM I DOING A MAZDA SFTP?                       
         BE    RUNLBK1M                                                         
*                                                                               
         B     EXIT                                                             
         EJECT                                                                  
RUNLBK   DS    0H      HERE IF DOING BURGER KING SFTP (MINDSHARE)               
*                                                                               
         CLOSE (BKPBIT1)                                                        
         B     RUNLBK2                                                          
*                                                                               
RUNLBK1  CLOSE (SCPBIT1)          SC JOHNSON FILE                               
         B     RUNLBK2                                                          
*                                                                               
RUNLBK1M CLOSE (MZPBIT1)          MAZDA FILE                                    
         B     RUNLBK2                                                          
*                                                                               
RUNLBK2  DS    0H                                                               
         CLI   TESTMQ,C'N'       SEE IF SUPRESSING MQ NOTIFICATION              
         BE    RUNLBK5                                                          
* SEND MQ MESSAGE WITH FILE NAME                                                
         LA    R5,ELEM                                                          
         USING MQMSGD,R5                                                        
         MVI   ELEM,C' '                                                        
         MVC   ELEM+1(MQMSGLNQ-1),ELEM                                          
         LA    R1,MQMAPNM                                                       
         MVC   MQFILE(34),14(R1)   BIL.SYS.AGID.DYYMMDD.THHMMSS                 
*                                  SYS=SYSTEM,AGID= 4 CHARACTER AGY ID          
*                          14(R1) TO GET PAST SPTPDISK.PROD (OR TEST)           
         MVC   MQDATE(6),28(R1)    YYMMDD OF FILE NAME                          
         MVC   MQTIME(6),36(R1)    HHMMSS OF FILE NAME                          
*                                                                               
         BRAS  RE,MQOPEN                                                        
*                                                                               
         MVC   MQHID,=CL6'DANOT1'                                               
         MVC   MQSYS,MQFILE+4  SYSTEM (+4 PAST BIL.)                            
         MVC   MQAGYID,=C'H7PY'      AGENCY ID - MINDSHARE                      
         CLI   BKSFTP,C'Y'       BURGER KING?                                   
         BE    RUNLBK3                                                          
         CLI   SCSFTP,C'Y'       SC JOHNSON?                                    
         BNE   RUNLBK2M                                                         
*                                                                               
         MVC   MQQUAL(10),=C'SC BILLING'                                        
RUNLBK2B L     RF,ADMASTC                                                       
         L     RF,MCAEXTRA-MASTD(RF)                                            
         MVC   MQAGYID,MCAGYCOD-MCEXTRA(RF)                                     
         B     RUNLBK4                                                          
*                                                                               
RUNLBK2M CLI   MZSFTP,C'Y'       MAZDA?                                         
         BNE   RUNLBK2X                                                         
         MVC   MQQUAL(10),=C'MZ BILLING'                                        
         B     RUNLBK2B          REST SAME AS SCJ                               
*                                                                               
******   MVC   MQAGYID,=C'H7MZ'  AGENCY ID - MINDSHARE MAZDA                    
******   B     RUNLBK4                                                          
*                                                                               
RUNLBK2X DC    H'0'      UNKNOWN SFTP FILE                                      
*                                                                               
RUNLBK3  MVC   MQQUAL(7),=C'BILLING'                                            
*                                                                               
RUNLBK4  GOTO1 AMQRPT,DMCB,(0,=C'PUT'),ELEM,MQMSGLNQ,0                          
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DCHO                                                                   
*                                                                               
         GOTO1 AMQRPT,DMCB,(0,=C'CLOSE'),0,0,0                                  
         CLI   DMCB+8,0                                                         
         BE    RUNLBK5                                                          
         DCHO                                                                   
*                                                                               
RUNLBK5  MVC   P+1(49),MQMAPNM       WHOLE FILE NAME                            
         BRAS  RE,PRNT                                                          
         B     EXIT                                                             
*                                                                               
         DROP  R5                                                               
*                                                                               
*                                  PROCESS BILL                                 
         SPACE 2                                                                
PRBIL    DS    0H                                                               
*                                                                               
         CLC   PBILKBNO,LOWINV       BE SURE BILL PASSES INV # RANGE            
         BL    EXIT                                                             
         CLC   PBILKBNO,HIINV                                                   
         BH    EXIT                                                             
*                                                                               
         CLI   QOPT5,C'S'            SOON BILLS ONLY?                           
         BNE   PRBIL5                                                           
         TM    PBILSTAT,PSTSOONQ    UPDATIVE SOON BILL                          
         BZ    EXIT                                                             
*                                                                               
PRBIL5   CLC   QAGENCY,=C'DF'       SEE IF SAATCHI                              
         BNE   PRB05                NO                                          
         CLI   QOPT4,C'T'           AND IF TOYOTA TAPE                          
         BNE   PRB05                NO                                          
         CLC   PBILKCLT,=C'TX '     SAATCHI CLIENT TX ?                         
         BNE   PRB05                NO                                          
         CLC   PBILKPRD,=C'TMS'     PRODUCT TMS FOR CLIENT TX ?                 
         BNE   EXIT                 NO - SKIP                                   
*                                                                               
PRB05    DS    0H                                                               
         TM    PBILCMSW,X'02'      IS IT A COMMISION ONLY BILL                  
         BNZ   PRB09               YES, OK                                      
         CLI   QOPT6,C'C'          NO, ARE WE SKIPPING OTHERS                   
         BE    EXIT                                                             
         B     PRB09A                                                           
*                                                                               
PRB09    DS    0H                                                               
         CLI   QOPT6,C'N'          EXCLUDING COMMISSION ONLY?                   
         BE    EXIT                                                             
PRB09A   DS    0H                                                               
*                                                                               
         CLI   QOPT6,C' '            CHECK AOR OPTION                           
         BE    PRB09D                                                           
         CLI   QOPT6,C'A'            ONLY AOR                                   
         BNE   PRB09B                                                           
         TM    PBILCMSW,X'20'                                                   
         BNO   EXIT                                                             
         B     PRB09D                                                           
*                                                                               
PRB09B   CLI   QOPT6,C'B'            AOR AND AOR/CLIENT                         
         BNE   PRB09C                                                           
         TM    PBILCMSW,X'30'                                                   
         BNO   EXIT                                                             
         B     PRB09D                                                           
*                                                                               
PRB09C   CLI   QOPT6,C'X'            SEE IF EXCLUDING AOR                       
         BNE   PRB09D                                                           
         TM    PBILCMSW,X'20'                                                   
         BO    EXIT                                                             
*                                                                               
PRB09D   DS    0H                                                               
*                                                                               
*        SPECIAL HANDLING OF GSTX (G7) BILLS FOR CLIENTS LLB AND MCI            
*        FOR THESE COST 2 CLIENTS SET BNETP TO BNET2P (COST2 NET)               
*        SO THAT NO COMMISSION WILL BE REPORTED                                 
*                                                                               
         CLC   QAGENCY,=C'G7' GSTX                                              
         BNE   PRB09DX                                                          
         CLC   PBILKCLT,=C'LLB'     MUST BE EITHER CLIENT LLB OR MCI            
         BE    PRB09D5                                                          
         CLC   PBILKCLT,=C'MCI'                                                 
         BNE   PRB09DX                                                          
*                                                                               
PRB09D5  CLI   PBILOTH,X'09'       THIS ELEMENT MUST BE PRESENT                 
         BNE   PRB09DX                                                          
         TM    PBILLIND,X'80'      MUST BE COST 2 FACTOR BILL                   
         BZ    PRB09DX                                                          
         MVC   PBILLNET,PBILLOPN   SET PBILLNET TO COST 2 NET                   
*                                                                               
PRB09DX  GOTO1 =V(PPBVAL),DMCB,(C'B',PBILLREC),PPBVALD                          
*****                                                                           
*****    SET EFFECTIVE VALUES INTO PBILLREC                                     
*****                                                                           
         MVC   PBILLGRS,PPBVEBG                                                 
         MVC   PBILLBIL,PPBVEBB                                                 
         MVC   PBILLNET,PPBVEBN                                                 
*                                 SET MYGST AND MYPST AND MYHST                 
*****    ZAP   MYGST,=P'0'                                                      
*****    ZAP   MYPST,=P'0'                                                      
         L     R0,PPBVGST                                                       
         CVD   R0,DUB                                                           
         ZAP   MYGST,DUB                                                        
         L     R0,PPBVPST                                                       
         CVD   R0,DUB                                                           
         ZAP   MYPST,DUB                                                        
         L     R0,PPBVHST                                                       
         CVD   R0,DUB                                                           
         ZAP   MYHST,DUB                                                        
*                                                                               
*****    CLC   QAGENCY,=C'DA'    DONER AGENCY ?                                 
*****    BNE   *+10              NO                                             
*****    SP    MYPST,MYHST       YES - REMOVE HST INCLUDED IN PST TOTAL         
************                                                                    
******   NOTE USE PPBVEBC FOR CASH DISC                                         
******   DO NOT CALCULATE FROM PBILLGRS AND PBILLBIL (G-CD)                     
************                                                                    
*                                                                               
         CLC   PBILLKEY(14),LSTBLKY  IF FIRST FOR EST/MOS                       
         BE    PRB1                                                             
         MVI   REVSW,C' '          SET NOT A REVISION                           
         MVC   LSTBLKY,PBILLKEY                                                 
         XC    EATOTS,EATOTS                                                    
         B     PRB1D                                                            
*                                                                               
PRB1     DS    0H                                                               
         MVI   REVSW,C'R'          SET IS A REVISION                            
*                                                                               
PRB1D    DS    0H                  ADD TO ESTIMATE AMTS                         
         LA    R2,PBILLGRS                                                      
         LA    R3,EATOTS                                                        
         LA    R4,4                4 FIELDS STARTING AT GROSS                   
*                                                                               
PRB1F    DS    0H                                                               
         ZAP   DUB,0(BPLEQ,R2)                                                  
         CVB   R0,DUB                                                           
         A     R0,0(R3)                                                         
         ST    R0,0(R3)                                                         
*                                                                               
         LA    R2,BPLEQ(R2)                                                     
         LA    R3,4(R3)                                                         
         BCT   R4,PRB1F                                                         
*                                                                               
         CLC   PBILLDAT,QSTART     DATES FILTER                                 
         BL    EXIT                                                             
         CLI   QEND,C' '                                                        
         BE    PRB2                                                             
         CLC   PBILLDAT,QEND                                                    
         BH    EXIT                                                             
*                                                                               
PRB2     DS    0H                                                               
         MVI   RETAIL,C'N'                                                      
         CLI   PBRETAIL,0                                                       
         BE    PRB2C                                                            
*                                  RETAIL BILL                                  
         CLI   PBRETAIL,X'81'      IGNORE CORP BILLS                            
         BE    EXIT                                                             
         MVI   RETAIL,C'Y'                                                      
*                                                                               
*                                                                               
PRB2C    CLI   PBILLMOD,C'P'       BYPASS PRD MODE BILLS                        
         BE    EXIT                                                             
         CLI   PBILLMOD,C'S'       AND SERIES MODE                              
         BE    EXIT                                                             
*                                                                               
         CLC   PBILKCLT,LASTKCLT    SEE IF SAME CLIENT                          
         BE    PRB2C2                                                           
*                                                                               
         MVC   CLTINVS,INVPARS+8    SAVE LAST CLIENT'S TOTAL                    
*                                                                               
         SR    R0,R0            RESET INVOICE LIST BINSRCH PARS                 
         L     R1,=A(INVTAB)    FOR NEW CLIENT I REALLY PROCESS                 
         A     R1,RELO                                                          
         SR    R2,R2                                                            
         LA    R3,4                                                             
         LA    R4,4                                                             
         L     R5,=A(INVMAX)     INVMAX IS 10,000 INVOICE PER CLT               
         STM   R0,R5,INVPARS                                                    
*                                                                               
*                                  USE BINSRCH TO ADD TO INVTAB                 
PRB2C2   DS    0H                                                               
         MVC   WORK(2),PBILKBMN                                                 
         MVC   WORK+2(2),PBILKBNO                                               
         GOTO1 BINSRCH,INVPARS,(1,WORK)                                         
         OC    1(3,R1),1(R1)                                                    
         BNZ   *+6                                                              
         DC    H'0'                TABLE FULL                                   
*                                                                               
         CLI   QOPT3,C'N'          NO PRINTING                                  
         BE    PRB26                                                            
*                                                                               
PRB2C5   CLC   PBILKCLT(6),LASTKCLT CHK FOR SAME      CLT + PRD                 
         BE    PRB3                YES                                          
         CLC   PBILKCLT,LASTKCLT   CHK FOR CHANGE IN CLT                        
         BNE   PRB2A               FORCE CHG IN PRD ALSO                        
         CLC   PBILKPRD,LASTKPRD                                                
         BE    PRB2D                                                            
PRB2A    CLI   LASTKPRD,0                                                       
         BE    PRB2D                                                            
PRB2B    DS    0H                                                               
         MVC   BLPRD,LASTKPRD                                                   
*                                                                               
         CLC   QAGENCY,=C'H9'                                                   
         BNE   *+20                                                             
         CLC   QOPT4,=C'P'                                                      
         BNE   *+10                                                             
*                                                                               
         MVC   BLPRD,SH9PRD                                                     
         MVC   BLINE+4(19),=C' **PRODUCT TOTALS**'                              
         LA    R3,PRDTOTS                                                       
         MVI   TOTSW,1                                                          
         GOTO1 AFMTAMTS                                                         
         MVI   SPACING,2                                                        
         MVI   MAXLINES,99                                                      
         BAS   RE,PRNT                                                          
         LA    R3,PRDTOTS                                                       
         BAS   RE,CLRTOTS                                                       
         CLI   MODE,LBUYREQ        REQUEST LAST                                 
         BE    PRB2F               MUST ALSO DO CLIENT TOTALS                   
         CLI   MODE,OFCLAST        OR LAST FOR OFFICE                           
         BE    PRB2F               MUST ALSO DO CLIENT TOTALS                   
*                                                                               
         CLC   PBILKCLT,LASTKCLT   SEE IF NEW CLIENT ALSO                       
         BNE   PRB2D               IF YES THEN DON'T CHK PROFILE                
*                                                                               
         CLI   PROGPROF+1,C'Y'     CHK PAGE FOR PRODUCT                         
         BNE   PRB2D                                                            
         MVI   FORCEHED,C'Y'                                                    
         MVI   NEWCLT,C'Y'         SO CLIENT WILL REPRINT                       
*                                  FOR EACH PRODUCT                             
*                                                                               
*                                                                               
PRB2D    CLC   PBILKCLT,LASTKCLT                                                
         BE    PRB3                                                             
*                                                                               
         CLI   LASTKCLT,0          SEE IF FIRST TIME                            
         BNE   PRB2F                                                            
         MVC   LASTPROF,PROGPROF   MUST SAVE PROFILE                            
         B     PRB3                                                             
*                                                                               
PRB2F    MVC   BLPRD,LASTKCLT                                                   
         XC    LASTKPRD(25),LASTKPRD                                            
         MVC   BLINE+5(17),=C'**CLIENT TOTALS**'                                
*                                                                               
         MVC   BLINE+25(9),=C'INVOICES='                                        
         EDIT  (B4,CLTINVS),(7,BLINE+34),0,COMMAS=YES,ALIGN=LEFT                
*                                                                               
*                                                                               
         LA    R3,CLTTOTS                                                       
         MVI   TOTSW,1                                                          
         GOTO1 AFMTAMTS                                                         
         MVI   SPACING,2                                                        
         MVI   MAXLINES,99                                                      
         BAS   RE,PRNT                                                          
*                                                                               
*                                  FIRST CHECK PROFILE OF LAST CLIENT           
         CLI   LASTPROF+0,C'Y'     CHK NEW PAGE FOR CLIENT                      
         BNE   *+8                                                              
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         CLI   LASTPROF+1,C'Y'     OR NEW PAGE FOR PRODUCT                      
         BNE   *+8                                                              
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         CLI   PROGPROF+0,C'Y'     CHK NEW PAGE FOR CLIENT                      
         BNE   *+8                                                              
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         CLI   PROGPROF+1,C'Y'     OR NEW PAGE FOR PRODUCT                      
         BNE   *+8                                                              
         MVI   FORCEHED,C'Y'                                                    
*                                                                               
         MVC   LASTPROF,PROGPROF                                                
*                                                                               
***OFF                                                                          
         CLI   QCLIENT,C'$'          SEE IF DOING OFFILCE LIST                  
         BNE   PRB2M                 ROLL CLTTOTS TO OFFTOTS                    
         LA    R3,CLTTOTS                                                       
         LA    R4,OFFTOTS                                                       
         BAS   RE,ROLTOTS                                                       
         L     R0,OFFINVS                                                       
         A     R0,CLTINVS                                                       
         ST    R0,OFFINVS                                                       
         B     PRB2P                                                            
***OFF                                                                          
PRB2M    LA    R3,CLTTOTS                                                       
         LA    R4,REQTOTS                                                       
         BAS   RE,ROLTOTS                                                       
         L     R0,REQINVS                                                       
         A     R0,CLTINVS                                                       
         ST    R0,REQINVS                                                       
PRB2P    LA    R3,CLTTOTS                                                       
         BAS   RE,CLRTOTS                                                       
         XC    CLTINVS,CLTINVS                                                  
         CLI   MODE,LBUYREQ            RETURN TO REQTOTALS                      
         BE    LBLR2                                                            
         CLI   MODE,OFCLAST            RETURN TO OFFICE TOTALS                  
         BE    LBOFF5                                                           
PRB3     DS    0H                                                               
         CLI   NEWCLT,C'Y'         SEE IF NEW CLIENT                            
         BNE   PRB4                                                             
         MVC   P,SVMID                                                          
         MVC   PSECOND,SVMID2                                                   
         MVI   ALLOWLIN,5                                                       
         MVI   NEWCLT,C'N'                                                      
         MVI   SPACING,2                                                        
         BAS   RE,PRNT                                                          
*                                                                               
PRB4     DS    0H                                                               
         MVC   LASTKEY,PBILLKEY                                                 
         SPACE 2                                                                
*                                  CREATE PRINT LINE(S)                         
         MVC   BLPRD,PBILKPRD           PRD                                     
         OC    PBILKEST,PBILKEST                                                
         BZ    PRB7                                                             
         LA    R3,PBILKEST                                                      
         BAS   RE,CVD                                                           
         MVC   BLEST(3),WORK+2        ONE EST                                   
*                                                                               
* SPECIAL CHECK OF USER FIELD 2 ONLY FOR H9 AND P OPTION                        
*                                                                               
         CLC   QAGENCY,=C'H9'                                                   
         BNE   PRB8                                                             
         CLC   QOPT4,=C'P'                                                      
         BNE   PRB8                                                             
*                                                                               
*                                                                               
         LA    R2,PPRDREC+33                                                    
*                                                                               
         MVI   MELCODE,X'30'                                                    
         BAS   RE,NEXTEL1                                                       
         BNE   *+20                                                             
         OC    2(3,R2),2(R2)                                                    
         BZ    *+16                                                             
         MVC   BLPRD,2(R2)                                                      
         MVC   SH9PRD,BLPRD                                                     
*                                                                               
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    PRB5                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
PRB5     DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTEL                                                        
         BNE   PRB6                                                             
         CLI   PEUSER2+4,C'X'                                                   
         BE    EXIT                                                             
         B     PRB8                                                             
         DROP  R2                                                               
*                                                                               
PRB6     DC    H'0'                                                             
*                                                                               
PRB7     DS    0H                                                               
         MVC   BLEST+1(2),=C'NO'                                                
*                                                                               
         B     PRB8                                                             
*                                                                               
*        PBILESTS AND PBILESTE WERE USED BY "OLD" BILLING                       
*        FOR ESTIMATE RANGES                                                    
*                                                                               
*        NOW USED AS PBILLIMO (INVOICE MONTH)                                   
*                                                                               
**       OC    PBILESTS(4),PBILESTS                                             
**       BZ    PRB8                                                             
**       LA    R3,PBILESTS                                                      
**       BAS   RE,CVD                                                           
**       MVC   BLEST(3),WORK+2                                                  
**       MVI   PSECOND+BLESTD-1,C'-'                                            
**       LA    R3,PBILESTE                                                      
**       BAS   RE,CVD                                                           
**       MVC   PSECOND+BLESTD(3),WORK+2                                         
*                                                                               
PRB8     DS    0H                                                               
         CLI   PBILLPER,C' '       NOT USED FOR NEW BILLING                     
         BNH   PRB9                                                             
         CLI   PBILLPER,C'M'       TEST MONTH BILL                              
         BNE   PRB10                                                            
*PRB9     GOTO1 DTCNV,DMCB,(1,PBILKMOS),(5,BLPER)                               
PRB9     GOTO1 DATCON,DMCB,(3,PBILKMOS),(9,BLPER)                               
*                                                                               
         B     PRB12                                                            
*                                                                               
PRB10    DS    0H                  SPECIAL BILL PERIOD                          
         MVC   FULL(2),PBILKMOS                                                 
         MVC   FULL+2(1),PBILLSTA                                               
*        GOTO1 DTCNV,DMCB,(1,FULL),(4,BLPER)                                    
         GOTO1 DATCON,DMCB,(3,FULL),(7,BLPER)                                   
*                                                                               
         MVI   PSECOND+BLPERD-1,C'-'                                            
         MVC   FULL+2(1),PBILLEND                                               
*        GOTO1 (RF),(R1),,(3,WORK)                                              
         GOTO1 DATCON,(R1),,(5,WORK)                                            
         MVC   PSECOND+BLPERD(5),WORK+3                                         
*                                                                               
PRB12    DS    0H                                                               
*                                                                               
         GOTO1 =V(PPFMTINO),DMCB,PBILLDAT,(2,PBILKBNO),                X        
               (PBILKMED,B1PROF),B1XPROF                                        
*                                                                               
         L     RF,DMCB                                                          
         MVC   DINVFULL,0(RF)   SAVE FULL INVOICE NUMBERR                       
*                                                                               
         L     RF,DMCB+4        ADDRESS OF "SHORT" FORMAT                       
         MVC   DSINVNO(7),0(RF)     MAY INCLUDE DASH                            
******   MVC   BLINO(2),0(RF)                                                   
         MVC   BLINO+2(4),3(RF)     DON'T MOVE '-'                              
         L     RF,DMCB+8        ADDRESS OF Y/M                                  
         MVC   BLINO(2),0(RF)                                                   
         MVC   DINVNO(6),BLINO                                                  
         L     RF,DMCB+12                                                       
         MVC   DINVMED,0(RF)       MEDIA PART                                   
*                                                                               
PRB13X   DS    0H                                                               
*            SEE IF RETAIL CORP OR DISTRIBUTOR BILL                             
         CLI   PBRETAIL,X'02'                                                   
         BE    PRB13X2                                                          
         CLI   PBRETAIL,X'01'                                                   
         BNE   PRB13X5                                                          
*                                                                               
PRB13X2  MVC   PSECOND+BLRDATD(12),=C'RETAIL ACCT='                             
         MVC   PSECOND+BLRDATD+12(12),PBRACCT                                   
*                                                                               
PRB13X5  DS    0H                                                               
*                                                                               
*        GOTO1 DTCNV,DMCB,PBILLDAT,(3,BLRDAT)          RUN DATE                 
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(5,BLRDAT)         RUN DATE             
*                                                                               
*        GOTO1 (RF),(R1),(1,PBILINVD),(4,BLBDAT)       BILL DATE                
         GOTO1 DATCON,(R1),(3,PBILINVD),(7,BLBDAT)      BILL DATE               
*                                                      TYPE OF BILL             
         MVC   BLTYP(2),PBILLTYP                                                
         TM    PBILSTAT,X'20'      SEE IF GRP M MIDAS BILL                      
         BZ    PRB13X7                                                          
         MVI   BLTYP+2,C'T'                                                     
         LA    R3,BLTYP+2                                                       
         B     PRB14B              MUST BE NEW TYPE                             
*                                  NO ROOM FOR A DASH                           
*                                                                               
PRB13X7  LA    R3,BLTYP+2                                                       
         CLI   PBILLTYP,C'0'       SEE IF NEW BILL                              
         BNH   PRB14               YES                                          
*                                                                               
         MVC   BLTYP(3),=C'ORI'                                                 
         LA    R3,BLTYP+3                                                       
         CLI   PBILLTYP,C'3'                                                    
         BE    PRB14                                                            
         MVC   BLTYP(3),=C'DET'                                                 
         CLI   PBILLTYP,C'4'                                                    
         BE    PRB14                                                            
         MVC   BLTYP(3),=C'MAN'                                                 
PRB14    DS    0H                                                               
         MVI   0(R3),C'-'                                                       
*                                                                               
PRB14B   TM    PBILCMSW,X'02'          FOR COMMISSION ONLY BILL                 
         BZ    PRB15                                                            
         MVC   1(3,R3),=C'AOR'                                                  
         TM    PBILCMSW,X'20'        SEE IF ALSO AOR                            
         BO    PRB14D                                                           
         MVC   1(3,R3),=C'COM'                                                  
*                                                                               
PRB14D   CLC   QAGENCY,=C'WI'      WESTERN INTERNATIONAL                        
*SMY*    BNE   PRB14E                                                           
         BE    PRB14D5                                                          
         CLC   QAGENCY,=C'M1'      MEDIA FIRST INTERNATIONAL USES               
         BNE   PRB14E                "WI" PROC'S                                
PRB14D5  CLI   QOPT4,C'A'                                                       
         BE    PRB16                                                            
*                                                                               
PRB14E   CLI   QOPT6,C'C'          TEST TO LEAVE NET                            
         BE    *+10                                                             
         ZAP   PBILLNET,=P'0'      NO, SET NET = 0 (AC = RCVBL)                 
         B     PRB16                                                            
*                                                                               
PRB15    DS    0H                                                               
         MVC   1(3,R3),=C'ADJ'                                                  
         CLI   PBILSEP,C'A'                                                     
         BE    PRB16                                                            
         MVC   1(3,R3),=C'CD '                                                  
         CLI   PBILSEP,C'C'                                                     
         BE    PRB16                                                            
         MVC   1(3,R3),=C'AOR'                                                  
         TM    PBILCMSW,X'20'        AOR BILL                                   
         BO    PRB16                                                            
         MVC   1(3,R3),=C'UFC'                                                  
         TM    PBILCMSW,X'01'         UP FRONT COMMISSION                       
         BO    PRB16                                                            
         MVC   1(3,R3),=C'NET'                                                  
         TM    PBILCMSW,X'08'         UP FRONT COMMISSION - NET                 
         BO    PRB16                                                            
*                                                                               
         MVC   1(3,R3),=C'REG'                                                  
*                                                                               
PRB16    DS    0H                                                               
*                                                                               
         ZAP   BILTOTS+30(6),MYGST                                              
         ZAP   BILTOTS+36(6),MYPST                                              
*                                                                               
**NEW 3/17/89                                                                   
         CLI   QOPT6,C'A'          SEE IF AOR ONLY                              
         BE    PRB16A              YES - THEN INCLUDE IN TOTALS                 
         TM    PBILCMSW,X'20'      SEE IF AOR BILL                              
         BZ    PRB16B                                                           
PRB16A   ZAP   BILTOTS(6),=P'0'                                                 
         ZAP   BILTOTS+6(6),=P'0'                                               
         ZAP   BILTOTS+12(6),=P'0'                                              
         ZAP   BILTOTS+18(6),PBILLRCV    SET AC TO RCVBL                        
         ZAP   BILTOTS+24(6),PBILLRCV    ACTUAL                                 
         AP    BILTOTS+24(6),MYGST                                              
         AP    BILTOTS+24(6),MYPST                                              
         ZAP   BILTOTS+30(6),MYGST                                              
         ZAP   BILTOTS+36(6),MYPST                                              
         B     PRB16F                                                           
*                                                                               
*        SET MATS IN 5 FIELDS FOR ACCUMES                                       
*        (MATCH 5 PRINT COLUMNS)                                                
*                                                                               
PRB16B   DS    0H                                                               
         CLC   QAGENCY,=C'H9'                                                   
         BE    PRB16E                                                           
*                                                                               
         ZAP   BILTOTS+0*BPLEQ(BPLEQ),PBILLGRS     GROSS                        
         ZAP   BILTOTS+1*BPLEQ(BPLEQ),PBILLNET     NET                          
         ZAP   BILTOTS+2*BPLEQ(BPLEQ),=P'0'                                     
         SP    BILTOTS+2*BPLEQ(BPLEQ),PBILLRCV     CD IS -(RCVBL)               
*                                                                               
         CLI   PBILSEP,C'C'        FOR SEP CD BILL                              
         BE    PRB16C                                                           
         ZAP   BILTOTS+2*BPLEQ(BPLEQ),=P'0'        CD IS 0                      
*                                                                               
         CLI   PBILCDSW,C'S'       IF SEP (ON OTHER BILL) BILL                  
         BE    PRB16C                                                           
         ZAP   BILTOTS+2*BPLEQ(BPLEQ),PPBVEBC      EFFECTIVE CD                 
*                                                                               
PRB16C   ZAP   BILTOTS+4*BPLEQ(BPLEQ),PBILLRCV     RCVBL                        
         AP    BILTOTS+4*BPLEQ(BPLEQ),MYGST        ADD GST TO BILL AMT          
         AP    BILTOTS+4*BPLEQ(BPLEQ),MYPST        ADD PST TO BILL AMT          
         ZAP   BILTOTS+5*BPLEQ(BPLEQ),MYGST        AND GST TOTALS               
         ZAP   BILTOTS+6*BPLEQ(BPLEQ),MYPST        AND PST TOTALS               
*                                                                               
         ZAP   DUB,PBILLRCV                                                     
         TM    PBILCMSW,X'02'      UNLESS COMMISSION ONLY BILL                  
         BNZ   PRB16D                                                           
         TM    PBILBASA,X'04'                      IS CD ALREADY OUT?           
         BNZ   PRB16D                              YES                          
         SP    DUB,BILTOTS+2*BPLEQ(BPLEQ)          NO, TAKE IT OUT NOW          
*                                                                               
PRB16D   DS    0H                                                               
         ZAP   BILTOTS+3*BPLEQ(BPLEQ),DUB          FOR AC CALC                  
         SP    BILTOTS+3*BPLEQ(BPLEQ),PBILLNET     -NET = TRUE AC               
         B     PRB16F                                                           
*                                                                               
PRB16E   DS    0H                                                               
*                                                                               
         ZAP   BILTOTS+0*BPLEQ(BPLEQ),PBILLGRS     GROSS                        
         SP    BILTOTS+0*BPLEQ(BPLEQ),PBILLBIL                                  
         AP    BILTOTS+0*BPLEQ(BPLEQ),PBILLRCV                                  
*                                                                               
         ZAP   BILTOTS+2*BPLEQ(BPLEQ),PBILLGRS                                  
         SP    BILTOTS+2*BPLEQ(BPLEQ),PBILLBIL     CD IS -(RCVBL)               
*                                                                               
         ZAP   BILTOTS+1*BPLEQ(BPLEQ),PBILLNET     NET                          
         AP    BILTOTS+1*BPLEQ(BPLEQ),BILTOTS+2*BPLEQ(BPLEQ)                    
*                                                                               
         ZAP   BILTOTS+3*BPLEQ(BPLEQ),BILTOTS+0*BPLEQ(BPLEQ)                    
         SP    BILTOTS+3*BPLEQ(BPLEQ),BILTOTS+1*BPLEQ(BPLEQ)                    
         SP    BILTOTS+3*BPLEQ(BPLEQ),BILTOTS+2*BPLEQ(BPLEQ)                    
*                                                                               
         ZAP   BILTOTS+4*BPLEQ(BPLEQ),PBILLRCV     RCVBL                        
*                                                                               
PRB16F   DS    0H                                                               
         LA    R3,BILTOTS                                                       
         GOTO1 AFMTAMTS                                                         
*                                                                               
         BAS   RE,PRNT                                                          
*                                                                               
         CLI   QOPT1,C'F'               FORMULA OPTION                          
         BNE   PRB22                    NO                                      
         OC    PBILBASA(5),PBILBASA                                             
         BZ    PRB22                    NO FORMULA                              
         CLI   PBILBASA,5          DONT PRINT IF G-CD +0 PCT                    
         BNE   *+14                                                             
         OC    PBILADJ,PBILADJ                                                  
         BZ    PRB22                                                            
         LA    R3,BLINO                                                         
         MVC   0(8,R3),=C'FORMULA='                                             
         SR    RF,RF                                                            
         IC    RF,PBILBASA                                                      
         SLL   RF,2                                                             
         LA    RF,ADJWRDS-4(RF)                                                 
         MVC   9(4,R3),0(RF)                                                    
         LA    R3,11(R3)                                                        
         CLI   1(RF),C' '                                                       
         BE    *+8                                                              
         LA    R3,3(R3)                                                         
         MVI   1(R3),C'0'                                                       
         LA    R0,1                                                             
         OC    PBILADJ,PBILADJ                                                  
         BZ    PRB18                                                            
         EDIT  (B3,PBILADJ),(8,1(R3)),5,ALIGN=LEFT                              
         LR    R4,R3                                                            
         AR    R4,R0               POINT TO END                                 
PRB17    DS    0H                                                               
         LR    R5,R4                                                            
         CLI   0(R4),C'0'                                                       
         BE    PRB17D                                                           
         CLI   0(R4),C'.'                                                       
         BE    PRB17B                                                           
         B     PRB18                                                            
PRB17B   LA    R4,1                END SCAN ON .                                
PRB17D   BCTR  R0,R0               SHORTEN LENGTH                               
         MVI   0(R5),C' '                                                       
PRB17F   BCT   R4,PRB17                                                         
*                                                                               
PRB18    DS    0H                                                               
         MVI   0(R3),C'+'                                                       
         TM    PBILADJ,X'80'                                                    
         BZ    *+8                                                              
         MVI   0(R3),C'-'                                                       
*                                                                               
         AR    R3,R0                                                            
         MVC   2(6,R3),=C'PCT OF'                                               
         SR    RF,RF                                                            
         IC    RF,PBILBASB                                                      
         SLL   RF,2                                                             
         LA    RF,ADJWRDS-4(RF)                                                 
         MVC   9(4,R3),0(RF)                                                    
         MVI   MAXLINES,99                                                      
         BAS   RE,PRNT                                                          
*                                                                               
PRB22    DS    0H                                                               
         CLI   QOPT2,C'R'               REVERSALS OPTION                        
         BNE   PRB26                    NO                                      
         CLI   PBILLCDT,C'0'                                                    
         BE    PRB26                    NOT REVERSED                            
         LA    R3,BLINO                                                         
         MVC   0(11,R3),=C'REVERSED BY'                                         
         MVC   12(4,R3),PBILLCAN+2                                              
         MVC   17(2,R3),=C'ON'                                                  
*        GOTO1 DTCNV,DMCB,PBILLCDT,(3,20(R3))                                   
         GOTO1 DATCON,DMCB,(0,PBILLCDT),(5,20(R3))                              
*                                                                               
         MVI   MAXLINES,99                                                      
         BAS   RE,PRNT                                                          
*                                                                               
PRB26    DS    0H                                                               
         LA    R3,BILTOTS                                                       
         LA    R4,PRDTOTS                                                       
         BAS   RE,ROLTOTS                                                       
         LA    R3,BILTOTS                                                       
         LA    R4,CLTTOTS                                                       
         BAS   RE,ROLTOTS                                                       
         MVI   RACTSW,1            SET REQUEST ACTIVITY                         
         MVI   OACTSW,1            SET REQUEST ACTIVITY                         
*                                                                               
PRB28    DS    0H                                                               
         L     RF,AOUTP            SPECIAL INTERFACE MODULE                     
         LTR   RF,RF                                                            
         BZ    EXIT                                                             
         CLI   QOPT4,C'N'           SEE IF NOT PUTTING ON TAPE                  
         BE    EXIT                                                             
         BASR  RE,RF                                                            
         CLI   OBISKIP,C'Y'        OBPROC SKIP INVOICE                          
         BE    PRB28X                                                           
         CLI   DGISKIP,C'Y'        DID DGPROC SAY TO SKIP THIS INVOICE?         
         BNE   EXIT                                                             
PRB28X   LA    R3,BILTOTS    REMOVE BILTOTS FROM PRDTOTS AND CLTTOTS            
         LA    R4,PRDTOTS                                                       
         BAS   RE,SUBTOTS                                                       
         LA    R3,BILTOTS                                                       
         LA    R4,CLTTOTS                                                       
         BAS   RE,SUBTOTS                                                       
         CLI   OBISKIP,C'Y'   DON'T REMOVE FROM RUNINVS AND TRUNINVS            
         BE    EXIT                                                             
         L     R1,RUNINVS                                                       
         SH    R1,=H'1'                                                         
         ST    R1,RUNINVS                                                       
         L     R1,TRUNINVS                                                      
         SH    R1,=H'1'                                                         
         ST    R1,TRUNINVS                                                      
         B     EXIT                                                             
*                                                                               
         EJECT                                                                  
***OFF                                                                          
LBOFF    DS    0H                                                               
*                                                                               
         MVC   CLTINVS,INVPARS+8   LAST CLIENT'S INVOICE TOTAL                  
*                                                                               
         CLI   OACTSW,0                                                         
         BNE   PRB2B      MUST DO PRD/CLT TOTALS FIRST                          
*                         WILL RETURN TO LBOFF5                                 
LBOFF5   MVI   BLPRD,C'*'                                                       
*****    MVC   BLPRD+1(1),RCSVOFC                                               
*****    MVI   BLPRD+2,C' '                                                     
*****    GOTO1 =V(OFFOUT),DMCB,RCSVOFC,HEXOUT,BLPRD+1                           
         MVC   BLPRD+1(2),SAVCOFF  (FROM OFFICER CALL)                          
         MVC   BLINE+5(17),=C'**OFFICE TOTALS**'                                
*                                                                               
         MVI   OACTSW,0                                                         
*                                                                               
         CLC   OFFTOTS(24),=4PL6'0'                                             
         BNE   LBOFF8                                                           
         OC    OFFINVS,OFFINVS     ANY INVOICES?                                
         BNZ   LBOFF8                                                           
*                                                                               
         MVC   BLINE+25(11),=C'NO ACTIVITY'                                     
         BAS   RE,PRNT                                                          
         B     EXIT                                                             
*                                                                               
LBOFF8   DS    0H                                                               
         MVC   BLINE+25(9),=C'INVOICES='                                        
         EDIT  (B4,OFFINVS),(7,BLINE+34),0,COMMAS=YES,ALIGN=LEFT                
*                                                                               
         LA    R3,OFFTOTS                                                       
         MVI   TOTSW,2                                                          
         GOTO1 AFMTAMTS                                                         
         MVI   MAXLINES,99                                                      
         BAS   RE,PRNT                                                          
         LA    R3,OFFTOTS                                                       
         LA    R4,REQTOTS                                                       
         BAS   RE,ROLTOTS                                                       
         LA    R3,OFFTOTS                                                       
         BAS   RE,CLRTOTS                                                       
*                                                                               
         L     R0,REQINVS        ROLL OFFICE INVOICE TOTAL                      
         A     R0,OFFINVS        TO REQUEST                                     
         ST    R0,REQINVS                                                       
         XC    OFFINVS,OFFINVS                                                  
*                                                                               
         B     EXIT                                                             
         SPACE 3                                                                
FBOFF    DS    0H                                                               
         MVI   FORCEHED,C'Y'                                                    
         XC    LASTKEY,LASTKEY                                                  
         MVI   OACTSW,0                                                         
         LA    R3,OFFTOTS                                                       
         BAS   RE,CLRTOTS                                                       
         XC    OFFINVS,OFFINVS                                                  
         B     EXIT                                                             
***OFF                                                                          
*                                  FORMAT $ AMTS                                
         SPACE 2                                                                
*                                                                               
NEXTEL1  DS    0H                                                               
         ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTEL1X                                                         
         CLC   0(1,R2),MELCODE                                                  
         BER   RE                                                               
         B     NEXTEL1                                                          
*                                                                               
NEXTEL1X LTR   RE,RE       NOT FOUND -                                          
         BR    RE                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         EJECT                                                                  
         SPACE 2                                                                
PRNT     NTR1                                                                   
         SPACE 2                                                                
         MVI   RCSUBPRG,0                                                       
         CLI   PAGYNAT,C'C'           SEE IF CANADIAN                           
         BNE   *+8                                                              
         MVI   RCSUBPRG,50                                                      
*                                                                               
         CLI   FORCEHED,C'Y'                                                    
         BE    PRNT2                                                            
         ZIC   R1,LINE                                                          
         ZIC   R0,ALLOWLIN                                                      
         AR    R1,R0                                                            
         STC   R1,BYTE                                                          
         CLC   BYTE,MAXLINES                                                    
         BL    PRNT90                                                           
PRNT2    DS    0H                                                               
         CLI   MODE,LBUYREQ          REQUEST TOTALS                             
         BNL   PRNT90                                                           
         CLI   QCLIENT,C'$'          SEE IF DOING OFFICE LIST REQ               
         BNE   PRNT3                                                            
         MVC   HEAD4(8),=C'OFFICE X'                                            
*****    MVC   HEAD4+7(1),RCSVOFC                                               
*****    GOTO1 =V(OFFOUT),DMCB,RCSVOFC,HEXOUT,HEAD4+7                           
         MVC   HEAD4+7(2),SAVCOFF                                               
         B     PRNT4                                                            
PRNT3    CLI   QCLIENT,C'*'                                                     
         BNE   PRNT4                                                            
         CLI   QCLIENT+1,C'-'          ALL BUT OFFICE REQUEST                   
         BE    PRNT3B                                                           
         MVC   HEAD4(8),=C'OFFICE X'                                            
*****    MVC   HEAD4+7(1),QCLIENT+1                                             
*****    GOTO1 =V(OFFOUT),DMCB,QCLIENT+1,HEXOUT,HEAD4+7                         
         MVC   HEAD4+7(2),SAVCOFF                                               
         B     PRNT4                                                            
*                                                                               
PRNT3B   MVC   HEAD4(16),=C'* NOT OFFICE X *'                                   
         MVC   HEAD4+13(1),QCLIENT+2                                            
         B     PRNT4                                                            
*                                                                               
PRNT4    DS    0H                                                               
         CLI   QOPT6,C'A'         TEST AOR ONLY                                 
         BNE   PRNT5                                                            
         MVC   HEAD5(18),=C'**AOR BILLS ONLY**'                                 
*                                                                               
PRNT5    DS    0H                                                               
         CLI   QOPT6,C'B'         AOR AND AOR/CLIENT                            
         BNE   PRNT5B                                                           
         MVC   HEAD5(24),=C'**AOR AND CLIENT BILLS**'                           
*                                                                               
PRNT5B   DS    0H                                                               
         CLI   QOPT6,C'X'         NON=AOR BILLS ONLY                            
         BNE   PRNT6                                                            
         MVC   HEAD5(22),=C'**NON-AOR BILLS ONLY**'                             
*                                                                               
PRNT6    DS    0H                                                               
         CLI   QOPT6,C'C'         COMMISSION ONLY BILLS                         
         BNE   PRNT7                                                            
         MVC   HEAD5(25),=C'**COMMISSION ONLY BILLS**'                          
*                                                                               
PRNT7    DS    0H                                                               
         CLI   QOPT6,C'N'     NON-COMMISSION ONLY BILLS                         
         BNE   PRNT8                                                            
         MVC   HEAD5(34),=C'**COMMISSION ONLY BILLS EXCLUDED**'                 
PRNT8    DS    0H                                                               
         CLI   QOPT5,C'S'     SOON BILLS ONLY                                   
         BNE   PRNT90                                                           
         LA    R1,HEAD5                                                         
         CLC   HEAD5(5),SPACES  SEE IF HEAD5 USED ALREADY                       
         BE    *+8                                                              
         LA    R1,HEAD6         IF SO, USE HEAD6                                
         MVC   0(19,R1),=C'**SOON BILLS ONLY**'                                 
*                                                                               
PRNT90   DS    0H                                                               
         GOTO1 REPORT                                                           
*                                                                               
         MVC   MAXLINES,SAVMAX                                                  
         B     EXIT                                                             
         SPACE 3                                                                
ROLTOTS  DS    0H                                                               
         LA    R0,7           FOR BCT                                           
ROLTOTS2 DS    0H                                                               
         AP    0(6,R4),0(6,R3)                                                  
         LA    R4,6(R4)                                                         
         LA    R3,6(R3)                                                         
         BCT   R0,ROLTOTS2                                                      
         BR    RE                                                               
         SPACE 3                                                                
SUBTOTS  DS    0H             SUBTRACT FOR TOTALS                               
         LA    R0,7           FOR BCT                                           
SUBTOTS2 DS    0H                                                               
         SP    0(6,R4),0(6,R3)                                                  
         LA    R4,6(R4)                                                         
         LA    R3,6(R3)                                                         
         BCT   R0,SUBTOTS2                                                      
         BR    RE                                                               
         SPACE 3                                                                
CLRTOTS  DS    0H                                                               
         LA    R0,7                                                             
         ZAP   0(6,R3),=PL6'0'                                                  
         LA    R3,6(R3)                                                         
         BCT   R0,*-10                                                          
         BR    RE                                                               
         SPACE 3                                                                
CVD      DS    0H                                                               
         XC    FULL,FULL                                                        
         MVC   FULL+2(2),0(R3)                                                  
*                                                                               
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
         BR    RE                                                               
         SPACE 3                                                                
ADJWRDS  DS    0C                                                               
         DC    C'G   '                                                          
         DC    C'N   '                                                          
         DC    C'    '                                                          
         DC    C'    '                                                          
         DC    C'G-CD'                                                          
         DC    C'N-CD'                                                          
         SPACE 2                                                                
         EJECT                                                                  
         LTORG                                                                  
MQOPEN   NTR1  BASE=*,LABEL=*                                                   
*                                                                               
         MVI   DMCB+8,X'A0'        SUPPRESS LENGTH FOR MESSAGE & HDR            
*                                                                               
* IF WE'RE RUNNING A TEST, SEND TO TEST MQ BROKER                               
         CLI   TESTMQ,C'T'         IS THIS A MQ TEST RUN                        
         BNE   *+8                  NO                                          
         OI    DMCB+8,X'01'         YES -PUT TO TEST MQ BROKER                  
*                                                                               
         GOTO1 AMQRPT,DMCB,(0,=C'OPEN'),(0,=C'MEDIACOMSFTP****'),,0             
         CLI   DMCB+8,0                                                         
         BE    *+6                                                              
         DCHO                                                                   
         XIT1                                                                   
*                                                                               
         LTORG                                                                  
         EJECT                                                                  
FMTAMTS  NMOD1 0,FMTAMTS                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         MVI   STAGSW,0                                                         
         CP    0(6,R3),=P'9999999999'   COMPARE GROSS TO 100 MILLION            
         BL    *+8                                                              
         MVI   STAGSW,1            SET TO STAGGER TOTALS                        
*                                                                               
         LA    R5,0(R3)            GROSS                                        
         LA    R4,BLGRS                                                         
         LH    R6,=H'-1'          USED WHEN STAGGERING                          
         BAS   RE,FMTEDT                                                        
*                                                                               
         LA    R5,6(R3)           NET                                           
         LA    R4,BLNET                                                         
         LA    R6,131              NEXT LINE -1                                 
         BAS   RE,FMTEDT                                                        
*                                                                               
         LA    R5,12(R3)           CD                                           
         LA    R4,BLCD                                                          
         LH    R6,=H'-1'                                                        
         BAS   RE,FMTEDT                                                        
*                                                                               
         LA    R5,18(R3)           AC                                           
         LA    R4,BLAC                                                          
         LA    R6,131              NEXT LINE-1                                  
         BAS   RE,FMTEDT                                                        
*                                                                               
         LA    R5,24(R3)           ACTUAL                                       
         LA    R4,BLBIL                                                         
         LH    R6,=H'-1'                                                        
         BAS   RE,FMTEDT                                                        
*                                                                               
         CLI   PAGYNAT,C'C'        SEE IF CANADIAN                              
         BNE   FMTAX                                                            
*                                                                               
         LA    R5,30(R3)           GST (PAST IS AT 36(R3))                      
         LA    R4,BLGST                                                         
         BAS   RE,FMTEDT8       PRINT PST UNDER GST                             
*                                                                               
FMTAX    MVI   TOTSW,0                                                          
         XIT1                                                                   
         SPACE 2                                                                
FMTEDT   DS    0H                                                               
         CLI   STAGSW,1       SEE IF STAGGERING                                 
         BNE   FMTEDT5                                                          
         AR    R4,R6          ADJUST R4 FOR STAGGERING                          
         EDIT  (P6,0(R5)),(16,0(R4)),2,COMMAS=YES,CR=YES                        
*                                                                               
         CLI   TOTSW,0                                                          
         BER   RE                                                               
         CLI   14(R4),C'C'                                                      
         BER   RE                                                               
         MVI   14(R4),C'*'                                                      
         CLI   TOTSW,1                                                          
         BER   RE                                                               
         MVI   15(R4),C'*'                                                      
         BR    RE                                                               
         SPACE 3                                                                
*                                                                               
FMTEDT5  EDIT  (P6,0(R5)),(15,0(R4)),2,COMMAS=YES,CR=YES                        
*                                                                               
         CLI   TOTSW,0                                                          
         BER   RE                                                               
         CLI   13(R4),C'C'                                                      
         BER   RE                                                               
         MVI   13(R4),C'*'                                                      
         CLI   TOTSW,1                                                          
         BER   RE                                                               
         MVI   14(R4),C'*'                                                      
         BR    RE                                                               
         SPACE 3                                                                
FMTEDT8  DS    0H               SPECIAL EDT FOR GST AND PST                     
         EDIT  (P6,0(R5)),(14,0(R4)),2,COMMAS=YES,CR=YES                        
         EDIT  (P6,6(R5)),(14,132(R4)),2,COMMAS=YES,CR=YES                      
*                                                                               
         CLI   TOTSW,0                                                          
         BER   RE                                                               
         CLI   12(R4),C'C'                                                      
         BE    FMTEDT8C                                                         
         MVI   12(R4),C'*'                                                      
         CLI   TOTSW,1                                                          
         BE    FMTEDT8C                                                         
         MVI   13(R4),C'*'                                                      
*                                                                               
FMTEDT8C DS    0H                                                               
         CLI   12+132(R4),C'C'                                                  
         BER   RE                                                               
         MVI   12+132(R4),C'*'                                                  
         CLI   TOTSW,1                                                          
         BER   RE                                                               
         MVI   13+132(R4),C'*'                                                  
*                                                                               
         BR    RE                                                               
         LTORG                                                                  
         TITLE 'MARSTELLER'                                                     
*                   MARSTELLER INTERFACE TAPE                                   
*                   (ALSO FOOTE-CONE/LIEBER KATZ AND SCALI)                     
         SPACE 2                                                                
MARST    NMOD1 0,MARST                                                          
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,MARST2                                                         
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (STPBIT1,(OUTPUT))                                               
*                                                                               
MARST2   DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    MARSTL                                                           
         XC    PBIREC,PBIREC                                                    
         MVC   PBIREC(3),PCLTKCLT      +0 -CLT CODE                             
         MVC   PBIREC+3(3),PCLTNUM     +3 -CLT INTERFACE                        
         MVC   PBIREC+6(3),PPRDKPRD    +6 -PRD CODE                             
         MVI   PBIREC+9,C' '           +9 -PRD ACCT CODE                        
         MVC   PBIREC+10(4),PPRDACCT                                            
         CLI   PPRDACCT,X'FF'                                                   
         BNE   MARST4                                                           
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+9(5),DUB                                                  
MARST4   DS    0H                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+14(3),DUB        +14-EST                                  
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,PBIREC+17)  +17-MOS (4)              
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+17)  +17-MOS (4)          
         MVC   PBIREC+21(2),DINVNO                  +21-INVOICE                 
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+23(4),DUB                                                 
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+27) +27-INV. DATE         
         ZAP   PBIREC+33(6),PBILLGRS                      +33-GORSS             
         ZAP   PBIREC+39(6),PBILLNET                      +39-NET               
         ZAP   PBIREC+45(6),PBILLRCV                      +45-ACTUAL            
         ZAP   PBIREC+51(6),PBILLRCV                                            
         SP    PBIREC+51(6),PBILLNET                      +51-AGY COMM          
         ZAP   PBIREC+57(6),PPBVEBC                       +57 EFF CD            
         MVC   PBIREC+63(1),PBILKMED                      +63(1)- MEDIA         
*                                                                               
         TM    PBILBASA,X'04'       TEST IF RCVBL IS LESS CD                    
         BZ    MARST7                                                           
         CLI   PBILCDSW,C'N'                                                    
         BNE   *+8                                                              
*                                                                               
MARST7   DS    0H                                                               
         MVI   PBIREC+64,C'N'      NO, SET CD ABSENT                            
*                                                                               
         MVI   PBIREC+72,C'P'          +72- PRINT                               
         MVI   PBIREC+73,C'D'           +73 D=DETAIL                            
         CLI   PBILLTYP,C'4'                                                    
         BE    MARST8                                                           
         CLI   PBILLTYP,C'B'       NEW BILLING - CALL DETAIL                    
         BE    MARST8                                                           
*                                                                               
*              NOTE - OLD MANUAL,OLD SUMMARY,NEW MANUAL                         
*                     ALL CALLED 'ORIGINAL'                                     
*                                                                               
         MVI   PBIREC+73,C'O'               O=ORIGINAL                          
MARST8   LA    R1,STPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
MARSTX   DS    0H                                                               
         XIT1                                                                   
MARSTL   DS    0H                                                               
         LA    R2,STPBIT1                                                       
         CLOSE ((2),)                                                           
         B     MARSTX                                                           
         SPACE 2                                                                
STPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=08300,          DOS BLKSIZE=08300               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'FOOTE CONE '                                                    
*                                  FOOTE-CONE INTERFACE TAPE                    
         SPACE 2                                                                
FCB      NMOD1 0,FCB                                                            
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,FCB2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (FCPBIT1,(OUTPUT))                                               
*                                                                               
FCB2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    FCBL                                                             
         XC    PBIREC,PBIREC                                                    
         MVC   PBIREC(8),=C'02001125'        1-8                                
*                                                                               
         LA    R3,FCBMED                                                        
FCB4     DS    0H                                                               
         CLC   PBILKMED,0(R3)                                                   
         BE    FCB6                                                             
         LA    R3,3(R3)                                                         
         B     FCB4                                                             
FCB6     DS    0H                                                               
         MVC   PBIREC+8(2),1(R3)             9-10 MEDIA                         
*                                                                               
         LA    R3,FCBOFF                                                        
FCB8     DS    0H                                                               
         CLC   PCLTOFF(1),0(R3)                                                 
         BE    FCB10                                                            
         CLI   0(R3),X'FF'                                                      
         BE    FCB10                                                            
         LA    R3,3(R3)                                                         
         B     FCB8                                                             
FCB10    DS    0H                                                               
         MVC   PBIREC+10(2),1(R3)       11-12 - OFFICE                          
*                                                                               
         MVC   PBIREC+12(4),PPRDACCT    13-16 = ACCT NO.                        
         CLI   PPRDACCT,X'FF'                                                   
         BNE   FCB12                                                            
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+12(4),DUB         ONLY LAST 4 DIGITS                      
*                                                                               
FCB12    DS    0H                                                               
         MVC   PBIREC+16(3),PBILKPRD    17-19 = PRD                             
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+19(4),DUB         20-23   EST                             
*                                                                               
         CLC   PBILKMOS,PBILKBMN                                                
         LA    RF,=C'00'                                                        
         BL    FCB13               ADJ                                          
         LA    RF,=C'60'                                                        
         BE    FCB13               CURRENT                                      
         LA    RF,=C'70'                                                        
*                                  FUTURE                                       
FCB13    DS    0H                                                               
         MVC   PBIREC+23(2),0(RF)                                               
*                                                                               
         MVC   PBIREC+25(2),=C'00'      26-33  INV. NO.  00MMNNNN               
         MVC   PBIREC+27(2),DINVNO                                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+29(4),DUB                                                 
*                                                                               
         ZAP   DUB,PPBVEBC         EFFECTIVE CD                                 
         UNPK  PBIREC+33(12),DUB                                                
*                                                                               
         ZAP   DUB,PBILLBIL        G-CD                                         
         SP    DUB,PBILLNET        - (G-AC-CD) = AC                             
         UNPK  PBIREC+45(12),DUB                                                
*                                                                               
         UNPK  PBIREC+57(12),PBILLRCV    ACTUAL AMOUNT                          
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,PBIREC+69) 70-75  DUE DATE           
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',PBIREC+69) 70-75 DUEDATE         
                                                                                
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,PBIREC+75) 76-81  INV DATE           
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+75) 76-81 INVDATE         
*                                                                               
         MVC   PBIREC+81(20),PCLTNAME        82-101  CLT NAME                   
         MVC   PBIREC+101(20),PPRDNAME       102-121  PRD NAME                  
         MVC   PBIREC+121(3),PBILKCLT        122-124   CLT                      
         MVC   PBIREC+124(3),PBILKPRD        125-127  PRD                       
         MVI   PBIREC+127,C' '                                                  
*                                                                               
         LA    R1,FCPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
FCBX     XIT1                                                                   
         SPACE 2                                                                
FCBL     DS    0H                                                               
         LA    R2,FCPBIT1                                                       
         CLOSE ((2),)                                                           
         B     FCBX                                                             
         SPACE 3                                                                
FCBMED   DS    0C                                                               
         DC    C'M03'                                                           
         DC    C'N01'                                                           
         DC    C'O06'                                                           
         DC    C'S02'                                                           
         DC    C'T03'                                                           
*                                                                               
FCBOFF   DS    0C                                                               
         DC    C'102'                                                           
         DC    C'204'                                                           
         DC    C'306'                                                           
         DC    C'508'                                                           
         DC    C'610'                                                           
         DC    C'490'                                                           
         DC    X'FF',C'00'                                                      
*                                                                               
*                                                                               
         SPACE 2                                                                
FCPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00128,                                            X        
               BLKSIZE=00128,          DOS BLKSIZE=00128               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'CAMPBELL - MTIHUNE'                                             
*                                  CAMPBELL-MITHUNE                             
         SPACE 2                                                                
CMTH     NMOD1 0,CMTH                                                           
         L     RC,PPFILEC                                                       
         BC    0,CM2                                                            
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (CAPBIT1,(OUTPUT))                                               
*                                                                               
CM2      DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    CML                                                              
         XC    PBIREC,PBIREC                                                    
*                                                                               
         MVC   PBIREC(3),PBILKCLT                                               
         MVC   PBIREC+3(3),PBILKPRD                                             
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+6(3),DUB                                                  
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),PBIREC+9    MOS (4)                     
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+9)   MOS (4)              
         MVC   PBIREC+13(2),PAGYPROF+2                                          
         MVI   PBIREC+15,C'-'                                                   
         MVC   PBIREC+16(2),DINVNO                                              
         MVI   PBIREC+18,C'-'                                                   
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+19(4),DUB                                                 
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+23                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+23)                       
         UNPK  PBIREC+29(10),PBILLGRS                                           
         ZAP   DUB,PBILLNET        G - CD - AC                                  
         AP    DUB,PPBVEBC        PLUS EFFECTIVE CD  = G - AC                   
         UNPK  PBIREC+39(10),DUB                                                
         ZAP   DUB,PPBVEBC        EFFECTIVE CD                                  
         UNPK  PBIREC+49(10),DUB                                                
*                                  TEST SPECIAL CD HANDLING                     
         ZAP   DUB,PBILLRCV        RCVBL MUST BE +                              
         BNP   CM10                                                             
         CLI   PBILCDSW,C'C'                                                    
         BNE   CM10                                                             
         TM    PBILBASA,X'04'      CD IN BASE                                   
         BZ    CM10                                                             
*******  OC    PBILADJ,PBILADJ     TEST REAL FORMULA                            
*******  BNZ   CM10                YES                                          
         ZAP   DOUBLE,PPBVEBC      EFFECTIVE CD                                 
         BNP   CM10                CD MUST ALSO BE POS                          
*                                                                               
         AP    DUB,DOUBLE          ADD CD BACK INTO RCVBL                       
CM10     DS    0H                                                               
         UNPK  PBIREC+59(10),DUB                                                
         MVC   PBIREC+69(3),PCLTNUM                                             
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),PBIREC+72                               
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',PBIREC+72)                       
*                                                                               
         LA    R1,CAPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
CMX      DS    0H                                                               
         XIT1                                                                   
         SPACE 2                                                                
CML      DS    0H                                                               
         LA    R2,CAPBIT1                                                       
         CLOSE ((2),)                                                           
         B     CMX                                                              
         SPACE 2                                                                
CAPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'FOOTE-CONE '                                                    
*                                  FOOTE-CONE INTERFACE TAPE                    
         SPACE 2                                                                
FCCOORS  NMOD1 0,FCCOORS                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,FCC2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (FCPBIT1C,(OUTPUT))                                              
*                                                                               
FCC2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    FCCL                                                             
         MVC   PBIREC(80),SPACES                                                
*                                                                               
         MVC   PBIREC(2),QAGENCY       AGENCY                                   
         MVI   PBIREC+2,C'P'                                                    
         MVC   PBIREC+3(1),QMEDIA      MED                                      
         MVC   PBIREC+4(3),PBILKCLT    CLT                                      
         MVC   PBIREC+7(3),PBILKPRD    PRD                                      
         MVC   HALF,PBILKEST           EST                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+10(3),DUB                                                 
         MVC   PBIREC+13(4),SPACES      DMA                                     
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    FCC4                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
FCC4     DS    0H                                                               
         MVC   PBIREC+17(4),PESTNAME    ACCOUNT                                 
         MVC   PBIREC+21(2),DINVNO      INVOICE NO                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+23(4),DUB                                                 
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+27                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),PBIREC+33                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),PBIREC+39                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+27)                       
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',PBIREC+33)                       
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+39)                       
         UNPK  PBIREC+43(12),PBILLBIL      GROSS-CD                             
*                                                                               
*                                                                               
         LA    R1,FCPBIT1C                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
FCCX     XIT1                                                                   
         SPACE 2                                                                
FCCL     DS    0H                                                               
         LA    R2,FCPBIT1C                                                      
         CLOSE ((2),)                                                           
         B     FCCX                                                             
*                                                                               
         LTORG                                                                  
         SPACE 2                                                                
FCPBIT1C DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00080,                                            X        
               BLKSIZE=00080,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'FOOTE-CONE - TACO BELL'                                         
         SPACE 2                                                                
FCTACO   NMOD1 0,FCTACO                                                         
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,FCT2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (FCPBIT1D,(OUTPUT))                                              
*                                                                               
FCT2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    FCTL                                                             
         MVC   PBIREC(128),SPACES                                               
*                                                                               
         MVC   PBIREC(2),QAGENCY       AGENCY                                   
         MVI   PBIREC+2,C'P'                                                    
         MVC   PBIREC+3(1),QMEDIA      MED                                      
         MVC   PBIREC+4(3),PBILKCLT    CLT                                      
         MVC   PBIREC+7(3),PBILKPRD    PRD                                      
         MVC   HALF,PBILKEST           EST                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+10(3),DUB                                                 
         MVC   PBIREC+17(2),DINVNO      INVOICE NO                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+19(4),DUB                                                 
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+23  INV DATE                     
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+23)  INV DATE             
         UNPK  PBIREC+29(10),PBILLRCV     ACTUAL                                
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),PBIREC+69                               
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+69)                       
         MVC   PBIREC+73(2),SPACES                                              
         MVC   PBIREC+75(6),PNBMGR1     REGION AND DISTRICT                     
         CLI   PBILDUED,0                                                       
         BE    FCT4                                                             
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),PBIREC+81   DUE DATE                    
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',PBIREC+81)   DUE DATE            
*                                                                               
FCT4     DS    0H                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    FCT5                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
FCT5     DS    0H                                                               
         MVC   PBIREC+17(4),PESTNAME    ACCOUNT                                 
*                                                                               
         LA    R1,FCPBIT1D                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
FCTX     XIT1                                                                   
         SPACE 2                                                                
FCTL     DS    0H                                                               
         LA    R2,FCPBIT1D                                                      
         CLOSE ((2),)                                                           
         B     FCTX                                                             
*                                                                               
         LTORG                                                                  
         SPACE 2                                                                
FCPBIT1D DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00128,                                            X        
               BLKSIZE=00128,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'FOOTE-CONE INTERFACE TAPE  ATT'                                 
*                                  FOOTE-CONE INTERFACE TAPE - ATT              
         SPACE 2                                                                
FCATT    NMOD1 0,FCATT                                                          
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,FCA2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (FCPBIT1A,(OUTPUT))                                              
*                                                                               
FCA2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    FCAL                                                             
         MVC   PBIREC(100),SPACES                                               
*                                                                               
         MVI   PBIREC,C'I'                                                      
         MVC   PBIREC+1(3),PBILKCLT                                             
         MVC   PBIREC+4(3),PBILKPRD                                             
         MVC   HALF,PBILKEST           EST                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+7(3),DUB                                                  
*                                                                               
         MVC   PBIREC+16(2),DINVNO        INVOICE NO                            
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+18(4),DUB                                                 
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    FCA4                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
FCA4     DS    0H                                                               
         MVC   PBIREC+24(20),PESTNAME                                           
         OC    PBIREC+24(20),SPACES                                             
         MVC   PBIREC+80(20),PPRDNAME                                           
         OC    PBIREC+80(20),SPACES                                             
         MVC   PBIREC+79(1),QMEDIA                                              
         UNPK  PBIREC+49(10),PBILLRCV      RECEIVABLE                           
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+59                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+59)                       
*                                                                               
         LA    R1,FCPBIT1A                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
FCAX     XIT1                                                                   
         SPACE 2                                                                
FCAL     DS    0H                                                               
         LA    R2,FCPBIT1A                                                      
         CLOSE ((2),)                                                           
         B     FCAX                                                             
*                                                                               
         SPACE 2                                                                
FCPBIT1A DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
         TITLE 'BBDO - CHRYSLER'                                                
*                                  BBDO-CHRYSLER                                
         SPACE 2                                                                
BDCHRYS  NMOD1 0,BDCHRYS                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,BDC2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (BDPBIT1C,(OUTPUT))                                              
*                                                                               
BDC2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    BDCL                                                             
         MVC   PBIREC(80),SPACES                                                
*                                                                               
         MVC   PBIREC(2),QAGENCY   AGENCY                                       
         CLC   QAGENCY,=C'BD'      FOR BD                                       
         BE    BDC3                                                             
         CLC   QAGENCY,=C'BN'      AND BN                                       
         BNE   BDC3B                                                            
BDC3     DS    0H                                                               
         MVC   PBIREC(2),=C'PC'    SPECIAL AGENCY CODE                          
BDC3B    DS    0H                                                               
         MVI   PBIREC+2,C'P'           SYSTEM                                   
         MVC   PBIREC+3(1),QMEDIA      MED                                      
         MVC   PBIREC+4(3),PBILKCLT    CLT                                      
         MVC   PBIREC+7(3),PBILKPRD    PRD                                      
         MVC   HALF,PBILKEST           EST                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+10(3),DUB                                                 
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),PBIREC+13   MOS (4)                     
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+13)   MOS (4)             
*****    MVC   PBIREC+17(6),PBILLDAT              RUN DATE                      
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(X'20',PBIREC+17)  RUN DATE             
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+40  INV DATE                     
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+40)  INV DATE             
         LA    R4,PBIREC+46        INVOICE NUMBER   (M-MM-NNNN)                 
         MVC   0(1,R4),PBILKMED                                                 
         MVI   1(R4),C'-'                                                       
         MVC   2(2,R4),DINVNO      MONTH                                        
         MVI   4(R4),C'-'                                                       
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  5(4,R4),DUB                                                      
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    BDC4                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
BDC4     DS    0H                                                               
         MVC   PBIREC+55(20),PESTNAME     EA NUMBER                             
         MVC   PBIREC+75(20),PESTNAM2     ACCT NUMBER                           
*                                                                               
         UNPK  PBIREC+95(12),PBILLGRS     GROSS                                 
         ZAP   DUB,PPBVEBC                EFFECTIVE CD                          
         UNPK  PBIREC+119(12),DUB         CASH DISC                             
         AP    DUB,PBILLNET               CD + (NET - CD) = NET                 
         UNPK  PBIREC+107(12),DUB         NET (IGNORING CD)                     
         UNPK  PBIREC+131(12),PBILLNET    NET (LESS CD)                         
*                                                                               
         LA    R1,BDPBIT1C                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
BDCX     XIT1                                                                   
         SPACE 2                                                                
BDCL     DS    0H                                                               
         LA    R2,BDPBIT1C                                                      
         CLOSE ((2),)                                                           
         B     BDCX                                                             
*                                                                               
         LTORG                                                                  
         SPACE 2                                                                
BDPBIT1C DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=00200,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
         TITLE 'PHDDE'                                                          
*                                                                               
         SPACE 2                                                                
BNPROC   NMOD1 0,BNPROC                                                         
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,BNC2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (BNPBIT1C,(OUTPUT))                                              
*                                                                               
BNC2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    BNCL                                                             
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVI   PBIREC+L'PBIREC,C' '                                             
         MVC   PBIREC+L'PBIREC+1(233),PBIREC+L'PBIREC                           
*                                                                               
         MVC   PBIREC(2),PCLTAOFC  ACC OFFICE CODE                              
         MVI   PBIREC+2,C'P'           SYSTEM                                   
         MVC   PBIREC+3(1),QMEDIA      MED                                      
         MVC   PBIREC+4(3),PBILKCLT    CLT                                      
         MVC   PBIREC+7(20),PCLTNAME   CLT NAME                                 
         MVC   PBIREC+27(3),PBILKPRD   PRD                                      
         MVC   PBIREC+30(20),PPRDNAME  PRD NAME                                 
         MVC   HALF,PBILKEST           EST                                      
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+50(3),DUB                                                 
         MVI   PBIREC+93,C'P'          INV# IS SYSTEM/MEDIA/6CHAR#              
         MVC   PBIREC+94(1),QMEDIA     MED                                      
         MVC   PBIREC+95(6),DINVNO                                              
         GOTO1 DATCON,DMCB,PBILLDAT,(5,PBIREC+101)      RUN DATE                
         GOTO1 DATCON,DMCB,(3,PBILDUED),(5,PBIREC+109)  DUE DATE                
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(6,PBIREC+117)  MOS                     
         EDIT  PBILLRCV,(12,PBIREC+123),2,MINUS=YES     ACTUAL                  
         EDIT  PBILLNET,(12,PBIREC+135),2,MINUS=YES     NET                     
         MVC   PBIREC+147(4),=C'0.00'                                           
         ZAP   DUB,PBILLRCV                                                     
         SP    DUB,PBILLNET                                                     
         EDIT  (P8,DUB),(12,PBIREC+151),2,MINUS=YES     COMM (ACT-NET)          
         EDIT  PBILLGRS,(12,PBIREC+163),2,MINUS=YES     GROSS                   
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    BNC4                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
BNC4     DS    0H                                                               
         MVC   PBIREC+53(20),PESTNAME     EST NAME                              
         MVC   PBIREC+73(20),PESTNAM2                                           
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   BNC10                                                            
         MVC   PBIREC+175(32),PUSER1                                            
         OC    PBIREC+175(32),SPACES                                            
         MVC   PBIREC+207(16),PUSER2                                            
         OC    PBIREC+207(16),SPACES                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
BNC10    DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   BNC15                                                            
         MVC   PBIREC+223(32),PEUSER1                                           
         OC    PBIREC+223(32),SPACES                                            
         MVC   PBIREC+255(16),PEUSER2                                           
         OC    PBIREC+255(16),SPACES                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
BNC15    CLI   RETAIL,C'Y'                              RETAIL ?                
         BNE   *+10                                                             
         MVC   PBIREC+283(12),PBRACCT                   RETAIL ACCT             
*                                                                               
         MVI   PBIREC+295,C'X'                                                  
*                                                                               
         TM    PBILCMSW,X'20'      TEST AOR BILL                                
         BZ    BNC90                                                            
         EDIT  PBILLRCV,(12,PBIREC+271),2,MINUS=YES     ACTUAL                  
*                                                                               
BNC90    CLI   QOPT7,C'Y'          PRINTING TRACE ?                             
         BNE   BNCPUT                                                           
         LHI   R0,296              YES                                          
         GOTO1 =V(PRNTBL),DMCB,0,PBIREC,C'DUMP',(R0),=C'1D'                     
         B     BNCX                                                             
BNCPUT   LA    R1,BNPBIT1C                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
BNCX     XIT1                                                                   
         SPACE 2                                                                
BNCL     DS    0H                                                               
         LA    R2,BNPBIT1C                                                      
         CLOSE ((2),)                                                           
         B     BNCX                                                             
*                                                                               
         LTORG                                                                  
         SPACE 2                                                                
BNPBIT1C DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00296,                                            X        
               BLKSIZE=00296,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'ROSS ROY'                                                       
*                                  ROSS ROY                                     
         SPACE 2                                                                
ROSS     NMOD1 0,ROSS                                                           
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,ROSS2                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (RRPBIT1,(OUTPUT))                                               
*                                                                               
ROSS2    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    ROSSL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC(2),DINVNO                                                 
RRP4     DS    0H                                                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+2(4),DUB          INV NO.                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)                                
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)                            
         MVC   PBIREC+06(2),WORK+2                                              
         MVC   PBIREC+08(2),WORK+4                                              
         MVC   PBIREC+10(2),WORK+0                                              
*                                                                               
         MVI   PBIREC+12,C'0'                                                   
         MVC   PBIREC+13(3),PCLTNUM                                             
         MVC   PBIREC+16(2),=C'13'                                              
         CLI   PBILKMED,C'O'                                                    
         BE    RRP5                                                             
         MVC   PBIREC+16(2),=C'11'                                              
         CLI   PBILKMED,C'N'                                                    
         BE    RRP5                                                             
         MVC   PBIREC+16(2),=C'12'      ALL OTHER MEDIA?                        
RRP5     DS    0H                                                               
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)                                
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)                            
         MVC   PBIREC+18(2),WORK+2                                              
         MVC   PBIREC+20(2),WORK+4                                              
         MVC   PBIREC+22(2),WORK+0                                              
*                                                                               
         ZAP   DUB,PPBVEBC            EFFECTIVE CD                              
         UNPK  PBIREC+35(9),DUB         CD                                      
*                                                                               
         TM    PBILBASA,X'04'      TEST CD IN BASE                              
         BNZ   *+10                YES                                          
         ZAP   DUB,=P'0'           NO - CLEAR CD                                
         AP    DUB,PBILLRCV        RCVBL (+CD IF TAKEN OUT)                     
         UNPK  PBIREC+24(11),DUB                                                
*                                                                               
         MVI   PBIREC+44,C'0'                                                   
         MVC   PBIREC+45(21),PBIREC+44                                          
         CLC   PBILBASA(5),NPFORM  TEST SKIP 'NETS'                             
         BE    RRP6                                                             
         UNPK  PBIREC+44(11),PBILLNET    NET-NET                                
*                                                                               
         ZAP   DUB,PPBVEBC          EFFECTIVE CD                                
         AP    DUB,PBILLNET         + NET -CD = NET  (GROSS - AC)               
         UNPK  PBIREC+55(11),DUB    GROSS - AC                                  
*                                                                               
RRP6     DS    0H                                                               
         MVC   PBIREC+66(2),PAGYPROF+2                                          
         MVC   PBIREC+68(6),PBIREC     REPEAT INVOICE NUMBER                    
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    RRP7                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
RRP7     DS    0H                                                               
         MVC   PBIREC+74(20),PESTNAME                                           
         MVC   PBIREC+94(20),PPRDNAME                                           
*                                                                               
         LA    R1,RRPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
ROSSX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
NPFORM   DC    X'0101',FL3'-850000'                                             
*                                                                               
ROSSL    DS    0H                                                               
         LA    R2,RRPBIT1                                                       
         CLOSE ((2),)                                                           
         B     ROSSX                                                            
         SPACE 2                                                                
RRPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00114,                                            X        
               BLKSIZE=01140,                                          X        
               MACRF=PM                                                         
         SPACE 3                                                                
         LTORG                                                                  
         TITLE 'INTERPUBLIC'                                                    
*                             INTERPUBLIC                                       
         SPACE 2                                                                
INTRP    NMOD1 0,INTRP                                                          
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,INT2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (INPBIT1,(OUTPUT))                                               
*                                                                               
INT2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    INTL                                                             
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC(2),QAGENCY             AGENCY                             
         MVI   PBIREC+2,C'P'                 PRINT                              
         MVC   PBIREC+3(1),QMEDIA            MEDIA                              
*                                                                               
         MVC   PBIREC+4(3),PBILKCLT          CLIENT                             
         MVI   PBIREC+7,C'0'                                                    
         MVC   PBIREC+8(3),PCLTNUM           CLT NUMBER                         
         MVC   PBIREC+11(1),PCLTOFF          OFFICE                             
*                                                                               
         MVC   PBIREC+12(3),PBILKPRD         PRD CODE                           
         MVC   PBIREC+16(4),PPRDACCT         PRD ACCT NO.                       
         CLI   PPRDACCT,X'FF'                TEST BINARY                        
         BNE   INT4                                                             
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+15(5),DUB                                                 
*                                                                               
INT4     DS    0H                                                               
         MVC   HALF,PBILKEST            EST                                     
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+20(3),DUB                                                 
*                                                                               
         MVC   PBIREC+23(2),DINVNO           INV NO. - MONTH                    
         MVC   HALF,PBILKBNO                 NUMBER                             
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+25(4),DUB                                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+29      INV DATE                 
*****    GOTO1 (RF),(R1),(3,PBILDUED),PBIREC+35        DUE DATE                 
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+29)     INV DATE          
         GOTO1 (RF),(R1),(3,PBILDUED),(X'20',PBIREC+35)       DUE DATE          
*                                                                               
         ZAP   DOUBLE,PPBVEBC      DOUBLE = EFFECTIVE CD                        
*                                                                               
         ZAP   DUB,PBILLRCV             RCVBL                                   
         TM    PBILBASA,X'04'           TEST CD TAKEN OUT                       
         BZ    *+10                                                             
         AP    DUB,DOUBLE               YES - ADD IT BACK                       
         UNPK  PBIREC+41(10),DUB                                                
*                                                                               
         ZAP   DUB,PBILLNET                                                     
         AP    DUB,DOUBLE                                                       
         UNPK  PBIREC+51(10),DUB        NET PLUS CD                             
*                                                                               
         PACK  WORK(8),PBIREC+41(10)    RCVBL (+C.D.)                           
         SP    WORK(8),DUB              LESS NET (+C.D.)                        
         UNPK  PBIREC+61(10),WORK(8)    =AC                                     
*                                                                               
         UNPK  PBIREC+71(10),DOUBLE     CD                                      
*                                                                               
         LA    R1,INPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
INTX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
INTL     DS    0H                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         LA    R2,INPBIT1                                                       
         CLOSE ((2),)                                                           
         B     INTX                                                             
         SPACE 2                                                                
INPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,          DOS BLKSIZE=00100               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
         TITLE '''STANDARD'' SPECS'                                             
*        'STANDARD' - SJR,LOEWE MARSCHALK, ETC.                                 
         SPACE 2                                                                
STSPECS  NMOD1 0,STNDRD                                                         
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,STD2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (SJPBIT1,(OUTPUT))                                               
*                                                                               
STD2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    STDL                                                             
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC(2),QAGENCY             AGENCY                             
         MVI   PBIREC+2,C'P'                 PRINT                              
         MVC   PBIREC+3(1),QMEDIA            MEDIA                              
*                                                                               
         MVC   PBIREC+4(3),PBILKCLT          CLIENT                             
         MVC   PBIREC+7(3),PBILKPRD          PRD CODE                           
         MVC   HALF,PBILKEST                 EST                                
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+10(3),DUB                                                 
         MVC   PBIREC+16(1),PCLTOFF          OFFICE                             
         MVC   PBIREC+17(2),DINVNO           INV NO. - MONTH                    
         MVC   HALF,PBILKBNO                 NUMBER                             
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+19(4),DUB                                                 
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+23      INV DATE                 
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+23)     INV DATE          
*                                                                               
         UNPK  PBIREC+29(10),PBILLRCV   RCVBL                                   
         UNPK  PBIREC+39(10),PBILLNET   NET                                     
*                                                                               
         ZAP   DOUBLE,PPBVEBC          DOUBLE = EFFECTIVE CD                    
*                                                                               
         ZAP   DUB,PBILLRCV             RCVBL                                   
         TM    PBILBASA,X'04'           TEST CD TAKEN OUT                       
         BZ    *+10                                                             
         AP    DUB,DOUBLE               YES - ADD IT BACK                       
         ZAP   WORK(8),PBILLNET                                                 
         AP    WORK(8),DOUBLE                                                   
         SP    DUB,WORK(8)              LESS NET (+C.D.)                        
         UNPK  PBIREC+49(10),DUB        =AC                                     
*                                                                               
         UNPK  PBIREC+59(10),DOUBLE     CD                                      
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,WORK)          MOS                   
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)          MOS               
         MVC   PBIREC+69(4),WORK                                                
*****    GOTO1 DATCON,(R1),(3,PBILDUED),(0,PBIREC+81)       DUE DATE            
         GOTO1 DATCON,(R1),(3,PBILDUED),(X'20',PBIREC+81)     DUE DATE          
*                                                                               
         MVC   PBIREC+87(4),PPRDACCT         PRD ACCT NO.                       
         CLI   PPRDACCT,X'FF'                TEST BINARY                        
         BNE   STD4                                                             
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+87(5),DUB                                                 
*                                                                               
STD4     DS    0H                                                               
         LA    R1,SJPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
STDX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
STDL     DS    0H                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         LA    R2,SJPBIT1                                                       
         CLOSE ((2),)                                                           
         B     STDX                                                             
         SPACE 2                                                                
SJPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,          DOS BLKSIZE=00100               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
         TITLE 'MCCANN - ATT'                                                   
*                             MCCANN - ATT                                      
         SPACE 2                                                                
MCAPROC  NMOD1 0,MCAPROC                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,MCA2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (MCABIT1,(OUTPUT))                                               
*                                                                               
MCA2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    MCAL                                                             
*                                                                               
         OC    PBILKEST,PBILKEST   SKIP EST 0 BILLS                             
         BZ    MCAX                                                             
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'P'                   PRINT                              
         MVC   PBIREC+1(1),QMEDIA            MEDIA                              
*                                                                               
         MVC   PBIREC+3(3),PBILKCLT          CLIENT                             
         MVC   PBIREC+6(3),PBILKPRD          PRD CODE                           
         MVC   HALF,PBILKEST                 EST                                
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+9(6),DUB                                                  
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,PBIREC+15)  MOS (4)                  
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+15)  MOS (4)              
*                                                                               
         L     R0,EATOTS+12        EST AMOUNTS (USE ACTUAL)                     
         CVD   R0,DUB                                                           
         ZAP   PBIREC+19(6),DUB                                                 
*                                                                               
         MVC   PBIREC+46(2),DINVNO           INV NO. - MONTH                    
         MVC   HALF,PBILKBNO                 NUMBER                             
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+48(4),DUB                                                 
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'21',PBIREC+40)    INV DATE           
*                                                                               
         ZAP   PBIREC+52(6),PBILLRCV                         ACTUAL             
         ZAP   PBIREC+58(6),PBILLGRS                         GROSS              
         ZAP   PBIREC+64(6),PBILLNET                         NET                
         ZAP   PBIREC+70(6),PPBVEBC                          EFF CD             
*                                                                               
         MVC   PBIREC+76(1),REVSW  REVISION STATUS                              
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    MCA4                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
MCA4     DS    0H                                                               
         MVC   PBIREC+78(3),PESTNAME    3 CHARS OF EST NAME                     
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),PBIREC+81   DUE DATE                    
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',PBIREC+81)   DUE DATE            
*                                                                               
         LA    R1,MCABIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
MCAX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
MCAL     DS    0H                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         LA    R2,MCABIT1                                                       
         CLOSE ((2),)                                                           
         B     MCAX                                                             
         SPACE 2                                                                
MCABIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=01000,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
         TITLE 'MCCANN - ADWARE'                                                
*                             MCCANN TAPE CODE M                                
         SPACE 2                                                                
MCMPROC  NMOD1 0,MCMPROC                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,MCM1                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (MCMBIT1,(OUTPUT))                                               
         ZAP   MCMRECS,=P'0'                                                    
*                                                                               
MCM1     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    MCML                                                             
*                                                                               
         OC    PBILKEST,PBILKEST   SKIP EST 0 BILLS                             
         BZ    MCMX                                                             
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(250),PBIREC   CLEAR ALL 500 BYTES                     
*                                                                               
*                                      COMPANY AND OFFICE CODE                  
*                                      FROM PRODUCT INTERFACE                   
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDICEL,R2                                                      
         MVI   MELCODE,X'30'     LOOK FOR INTERFACE CODE ELEMENT                
         BRAS  RE,NEXTELM                                                       
         BNE   MCM1D                                                            
         MVC   PBIREC+0(4),PPRDINFC                                             
*                                                                               
         DROP  R2                                                               
*                                                                               
MCM1D    DS    0H                                                               
*                                          (FROM PRODUCT INTERFACE #)           
         MVI   PBIREC+4,C'0'                                                    
         MVC   PBIREC+5(6),DINVNO            SHORT INVOICE #                    
*                                                                               
*                                             INVOICE DATE (CYYMMDD)            
         GOTO1 DATCON,DMCB,(3,PBILINVD),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+11(7),WORK             CYYMMDD                            
*                                                                               
         MVC   PBIREC+18(3),WORK             INVOICE YEAR (CYY)                 
         MVI   PBIREC+21,C'O'                                                   
                                                                                
         MVC   PBIREC+22(3),PBILKCLT         CLIENT CODE                        
         MVC   PBIREC+27(3),PBILKPRD         PRODUCT CODE                       
         MVI   PBIREC+37,C'U'                PRINT                              
*                                                                               
         MVC   PBIREC+39(1),PBILKMED         MEDIA                              
         MVC   HALF,PBILKEST                 EST                                
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+40(3),DUB                                                 
*                                          MONTH OF SERVICE (CYYMM)             
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+82(5),WORK             CYYMM                              
*                                                                               
*                                          INVOICE DUE DATE (CYYMMDD)           
         GOTO1 DATCON,DMCB,(3,PBILDUED),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+87(7),WORK             CYYMM                              
*                                                                               
*                                          INVOICE RUN DATE (CYYMMDD)           
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+94(7),WORK             CYYMM                              
*                                                                               
*                                                                               
         CP    PBILLRCV,=P'0'       IS IT NEGATIVE?                             
         BL    MCMP5                                                            
         EDIT  PBILLRCV,(12,PBIREC+101),0,FILL=0,ZERO=NOBLANK                   
         B     MCMP10                                                           
*                                                                               
MCMP5    EDIT  PBILLRCV,(12,PBIREC+101),0,FILL=0,ZERO=NOBLANK,MINUS=YES         
*                                                                               
MCMP10   DS    0H                                                               
*                                                                               
         ZAP   MYDUB,PBILLNET         NET -CD                                   
         CP    MYDUB,=P'0'                                                      
         BL    MCMP15                                                           
         EDIT  MYDUB,(12,PBIREC+113),0,FILL=0,ZERO=NOBLANK                      
         B     MCMP20                                                           
*                                                                               
MCMP15   EDIT  MYDUB,(12,PBIREC+113),0,FILL=0,ZERO=NOBLANK,MINUS=YES            
*                                                                               
MCMP20   DS    0H                                                               
         ZAP   MYDUB,PBILLRCV         CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   MCMP22                                                           
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   MCMP22                 YES                                       
         SP    MYDUB,PPBVEBC          MINUS EFFECTIVE CD                        
*                                                                               
MCMP22   DS    0H                                                               
         SP    MYDUB,PBILLNET        RCV - NET = AC                             
         CP    MYDUB,=P'0'                                                      
         BL    MCMP25                                                           
         EDIT  MYDUB,(12,PBIREC+125),0,FILL=0,ZERO=NOBLANK                      
         B     MCMP30                                                           
*                                                                               
MCMP25   EDIT  MYDUB,(12,PBIREC+125),0,FILL=0,ZERO=NOBLANK,MINUS=YES            
*                                                                               
MCMP30   DS    0H                                                               
         CP    PBILLGRS,=P'0'                                                   
         BL    MCMP35                                                           
         EDIT  PBILLGRS,(12,PBIREC+137),0,FILL=0,ZERO=NOBLANK                   
         B     MCMP40                                                           
*                                                                               
MCMP35   EDIT  PBILLGRS,(12,PBIREC+137),0,FILL=0,ZERO=NOBLANK,MINUS=YES         
*                                                                               
MCMP40   DS    0H                                                               
         MVC   PBIREC+149(12),=12C'0'    COST OF SALES - ALWAYS ZEROS           
*                                                                               
         MVC   PBIREC+186(12),PBIREC+137      ALSO GORSS                        
*                                                                               
         MVC   PBIREC+161(9),=9C'0'    CASH DISCOUNT - ALWAYS ZEROS             
         B     MCMP50                                                           
***                                                                             
***      CP    PPBVEBC,=P'0'                                                    
***      BL    MCMP45                                                           
***      EDIT  PPBVEBC,(9,PBIREC+161),0,FILL=0,ZERO=NOBLANK                     
***      B     MCMP50                                                           
***                                                                             
***P45   EDIT  PPBVEBC,(9,PBIREC+161),0,FILL=0,ZERO=NOBLANK,MINUS=YES           
*                                                                               
MCMP50   DS    0H                                                               
         MVI   PBIREC+170,C'P'       ALWAYS PASSED                              
         B     MCMP58                                                           
*                                                                               
*        CODE BELOW TO POSSBILY SET IT DIFFERENTLY NO-OPED                      
*                                                                               
*        CD INDICATOR    N = NOT PASSED - WHAT EXACTLY DOES THIS MEAN?          
*                        O = OFFERED - WHAT EXACTLY DOES THIS MEAN?             
*                        P = PASSED - WHAT EXACTLY DOES THIS MEAN?              
*        MAY NEED TO CHECK BILLING FORMULA?                                     
*                                                                               
***      CP    PPBVEBC,=P'0'        IS THERE BILLABLE CD?                       
***      BNE   MCMP52                                                           
***      MVI   PBIREC+170,C'N'      IF ZERO SET TO NOT PASSED?                  
***      TM    PBILBASA,X'04'       IS CD SUBTRACTED FROM BASIS?                
***      BZ    MCMP58                                                           
***      MVI   PBIREC+170,C'O'      OFFERED                                     
***      B     MCMP58                                                           
***                                                                             
***P52   MVI   PBIREC+170,C'N'       NOT PASSED                                 
***      TM    PBILBASA,X'04'        IS CD SUBTRACTED FROM BASIS?               
***      BZ    MCMP58                                                           
***      MVI   PBIREC+170,C'P'       PASSED                                     
*                                                                               
MCMP58   MVC   PBIREC+171(12),=12C'0'                                           
*                                                                               
         MVC   PBIREC+199(5),PBIREC+94    ALSO BILLED DATE                      
         MVI   PBIREC+204,C'2'        POST PAYABLE FLAG 2= NET-CD               
                                                                                
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    MCMP60              YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
MCMP60   DS    0H                                                               
         MVC   PBIREC+52(20),PESTNAME                                           
         MVC   PBIREC+73(9),PESTNAM2    ALL THAT I CAN FIT                      
         OC    PBIREC+52(30),SPACES                                             
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   MCMP70                                                           
         MVC   PBIREC+205(32),PUSER1                                            
         OC    PBIREC+205(32),SPACES                                            
         MVC   PBIREC+237(16),PUSER2                                            
         OC    PBIREC+237(16),SPACES                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
MCMP70   DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   MCMP75                                                           
*                                                                               
         CLI   TAPTYP,C'C'       CHRYSLER FORMAT?                               
         BNE   MCMP72                                                           
         MVC   PBIREC+253(32),PEUSER1                                           
         OC    PBIREC+253(32),SPACES                                            
         B     MCMP74                                                           
*                                                                               
MCMP72   MVC   PBIREC+263(32),PEUSER1                                           
         OC    PBIREC+263(32),SPACES                                            
*                                                                               
MCMP74   MVC   PBIREC+285(16),PEUSER2                                           
         OC    PBIREC+285(16),SPACES                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
MCMP75   DS    0H                                                               
         CLI   TAPTYP,C'C'               CHRYSLER FORMAT?                       
         BNE   MCMP100                   UCOM GOES HERE?                        
*                                                                               
         LA    R3,UCOMBLK     SET-UP UCOM CONTROL BLOCK                         
         XC    UCOMBLK(L'UCOMBLK),UCOMBLK                                       
         USING DDUCOMD,R3                                                       
         MVC   KEYSAVE,KEY         SAVE KEY                                     
         MVC   UCACOMF,VCOMFACS     COMFACS                                     
         MVI   UCSYS,C'P'        SYSTEM TO PRINT                                
         MVC   UCAGY,QAGENCY                                                    
         MVC   UCMED,QMEDIA                                                     
         MVC   UCCLT,PBILKCLT      CLIENT                                       
         MVC   UCPRD,PBILKPRD      PRODUCT                                      
         MVC   UCEST,PBILKEST      ESTIMATE                                     
         OI    UCOPT,UCOEST        RETURN ESTIMATE UCOMMS                       
         GOTO1 =V(DDUCOM),UCOMBLK                                               
         CLI   UCERROR,0                                                        
         BNE   MCMP75X      ERROR RETURN - JUST EXIT DON'T DIE                  
         TM    UCDATA,UCDNOEST                                                  
         BO    MCMP75X      NO EST DATA                                         
*                                                                               
         L     R1,UCEDATA     EST DATA                                          
         LA    RF,UCELENS     LENGTHS                                           
         LA    RE,PBIREC+301  START OF 1ST EST UCOMM                            
         LHI   R0,1           JUST ONE                                          
MCMP75C  CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(32,RE),0(R1)                                                   
         OC    0(32,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,MCMP75C                                                       
*                                                                               
         DROP  R3                                                               
*                                                                               
MCMP75X  MVC   KEY,KEYSAVE                                                      
         GOTO1 HIGH                RESTORE SEQUENCE                             
         B     MCMP100X                                                         
*                                                                               
*                                                                               
MCMP100  MVC   PBIREC+301(20),PESTNAME    PRINT CAN FIX BOTH NAMES              
         MVC   PBIREC+321(20),PESTNAM2                                          
         OC    PBIREC+301(40),SPACES                                            
*                                                                               
MCMP100X MVI   PBIREC+340,C'0'      END OF RECORD MARKER                        
*                                                                               
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BNE   MCMPUT                                                           
         CP    MCMRECS,=P'50'                                                   
         BH    MCMPUT                                                           
         AP    MCMRECS,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(128),PBIREC                                                    
         MVC   PSECOND(128),PBIREC+128                                          
         GOTO1 REPORT                                                           
         MVC   P(93),PBIREC+256                                                 
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+260,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+325,P,16,0                                    
         GOTO1 REPORT                                                           
*                                                                               
MCMPUT   DS    0H                                                               
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BE    MCMX                                                             
*                                                                               
         LA    R1,MCMBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
MCMX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
MCML     DS    0H                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         LA    R2,MCMBIT1                                                       
         CLOSE ((2),)                                                           
         B     MCMX                                                             
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
NEXTELM  NTR1  BASE=*,LABEL=*                                                   
NEXTEL   ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELMX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTEL                                                           
NEXTELMX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
MCMBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00341,                                            X        
               BLKSIZE=00341,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
MCCPROC  NMOD1 0,MCCPROC                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         ZAP   MCCRECS,=P'0'                                                    
*                                                                               
MCC1     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    MCCRL                                                            
*                                                                               
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'    SAVE FOR RUNLAST                                 
*                                                                               
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(250),PBIREC   CLEAR ALL 500 BYTES                     
*                                                                               
*                                      COMPANY AND OFFICE CODE                  
*                                      FROM PRODUCT INTERFACE                   
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDICEL,R2                                                      
         MVI   MELCODE,X'30'     LOOK FOR INTERFACE CODE ELEMENT                
         BRAS  RE,NEXTELC                                                       
         BNE   MCC1D                                                            
         MVC   PBIREC+0(4),PPRDINFC                                             
*                                                                               
         DROP  R2                                                               
*                                                                               
MCC1D    DS    0H                                                               
*                                          (FROM PRODUCT INTERFACE #)           
         MVI   PBIREC+4,C'0'                                                    
         MVC   PBIREC+5(6),DINVNO            SHORT INVOICE #                    
*                                                                               
*                                             INVOICE DATE (CYYMMDD)            
         GOTO1 DATCON,DMCB,(3,PBILINVD),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+11(7),WORK             CYYMMDD                            
*                                                                               
         MVC   PBIREC+18(3),WORK             INVOICE YEAR (CYY)                 
         MVI   PBIREC+21,C'O'                                                   
                                                                                
         MVC   PBIREC+22(3),PBILKCLT         CLIENT CODE                        
         MVC   PBIREC+27(3),PBILKPRD         PRODUCT CODE                       
         MVI   PBIREC+37,C'U'                PRINT                              
*                                                                               
         MVC   PBIREC+39(1),PBILKMED         MEDIA                              
         MVC   HALF,PBILKEST                 EST                                
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+40(3),DUB                                                 
*                                          MONTH OF SERVICE (CYYMM)             
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+82(5),WORK             CYYMM                              
*                                                                               
*                                          INVOICE DUE DATE (CYYMMDD)           
         GOTO1 DATCON,DMCB,(3,PBILDUED),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+87(7),WORK             CYYMM                              
*                                                                               
*                                          INVOICE RUN DATE (CYYMMDD)           
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(15,WORK)                               
         UNPK  DUB,WORK(4)         X'0CYYDDDF' --> C'00CYYDDD'                  
         MVC   WORK(1),DUB+2       CENTURY                                      
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(X'20',WORK+1) YYMMDD                   
         MVC   PBIREC+94(7),WORK             CYYMM                              
*                                                                               
*        PACKED TO ACCUMLATE IN BINSRCH                                         
*                                                                               
*                                                                               
         ZAP   PBIREC+101(12),PBILLRCV     AMT DUE                              
         ZAP   PBIREC+113(12),PBILLNET     NET-CD                               
*                                                                               
         ZAP   MYDUB,PBILLRCV         CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   MCCP22                                                           
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   MCCP22                 YES                                       
         SP    MYDUB,PPBVEBC          MINUS EFFECTIVE CD                        
*                                                                               
MCCP22   DS    0H                                                               
         SP    MYDUB,PBILLNET        RCV - NET = AC                             
*                                                                               
*        PACKED TO ACCUMLATE IN BINSRCH                                         
*                                                                               
         ZAP   PBIREC+125(12),MYDUB                                             
         ZAP   PBIREC+137(12),PBILLGRS                                          
*                                                                               
         MVC   PBIREC+149(12),=12C'0'    COST OF SALES - ALWAYS ZEROS           
*                                                                               
*        PACKED TO ACCUMLATE IN BINSRCH                                         
*                                                                               
         ZAP   PBIREC+186(12),PBIREC+137(12)   ALSO GROSS BILLED                
*                                                                               
         MVC   PBIREC+161(9),=9C'0'    CASH DISCOUNT - ALWAYS ZEROS             
         B     MCCP51                                                           
***                                                                             
***      CP    PPBVEBC,=P'0'                                                    
***      BL    MCCP45                                                           
***      EDIT  PPBVEBC,(9,PBIREC+161),0,FILL=0,ZERO=NOBLANK                     
***      B     MCCP51                                                           
***                                                                             
***P45   EDIT  PPBVEBC,(9,PBIREC+161),0,FILL=0,ZERO=NOBLANK,MINUS=YES           
*                                                                               
MCCP51   DS    0H                                                               
         MVI   PBIREC+170,C'P'       ALWAYS PASSED                              
         B     MCCP58                                                           
*                                                                               
*        CODE BELOW TO POSSBILY SET IT DIFFERENTLY NO-OPED                      
*                                                                               
*        CD INDICATOR    N = NOT PASSED - WHAT EXACTLY DOES THIS MEAN?          
*                        O = OFFERED - WHAT EXACTLY DOES THIS MEAN?             
*                        P = PASSED - WHAT EXACTLY DOES THIS MEAN?              
*        MAY NEED TO CHECK BILLING FORMULA?                                     
*                                                                               
***      CP    PPBVEBC,=P'0'        IS THERE BILLABLE CD?                       
***      BNE   MCCP52                                                           
***      MVI   PBIREC+170,C'N'      IF ZERO SET TO NOT PASSED?                  
***      TM    PBILBASA,X'04'       IS CD SUBTRACTED FROM BASIS?                
***      BZ    MCCP58                                                           
***      MVI   PBIREC+170,C'O'      OFFERED                                     
***      B     MCCP58                                                           
***                                                                             
***P52   MVI   PBIREC+170,C'N'       NOT PASSED                                 
***      TM    PBILBASA,X'04'        IS CD SUBTRACTED FROM BASIS?               
***      BZ    MCCP58                                                           
***      MVI   PBIREC+170,C'P'       PASSED                                     
*                                                                               
MCCP58   MVC   PBIREC+171(12),=12C'0'                                           
*                                                                               
         MVC   PBIREC+186(12),PBIREC+137   ALSO GROSS BILLED                    
*                                                                               
         MVC   PBIREC+199(5),PBIREC+94    ALSO BILLED DATE                      
         MVI   PBIREC+204,C'2'        POST PAYABLE FLAG 2= NET-CD               
                                                                                
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    MCCP60              YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
MCCP60   DS    0H                                                               
         MVC   PBIREC+52(20),PESTNAME                                           
         MVC   PBIREC+73(9),PESTNAM2    ALL THAT I CAN FIT                      
         OC    PBIREC+52(30),SPACES                                             
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   MCCP70                                                           
         MVC   PBIREC+205(32),PUSER1                                            
         OC    PBIREC+205(32),SPACES                                            
         MVC   PBIREC+237(16),PUSER2                                            
         OC    PBIREC+237(16),SPACES                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
MCCP70   DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   MCCP75                                                           
*                                                                               
****     CLI   TAPTYP,C'C'       CHRYSLER FORMAT?                               
****     BNE   MCCP72                                                           
         MVC   PBIREC+253(32),PEUSER1                                           
         OC    PBIREC+253(32),SPACES                                            
         B     MCCP74                                                           
*                                                                               
***P72   MVC   PBIREC+263(32),PEUSER1                                           
***      OC    PBIREC+263(32),SPACES                                            
*                                                                               
MCCP74   MVC   PBIREC+285(16),PEUSER2                                           
         OC    PBIREC+285(16),SPACES                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
MCCP75   DS    0H                                                               
****     CLI   TAPTYP,C'C'               CHRYSLER FORMAT?                       
****     BNE   MCCP100                   UCOM GOES HERE?                        
*                                                                               
         LA    R3,UCOMBLK     SET-UP UCOM CONTROL BLOCK                         
         XC    UCOMBLK(L'UCOMBLK),UCOMBLK                                       
         USING DDUCOMD,R3                                                       
         MVC   KEYSAVE,KEY         SAVE KEY                                     
         MVC   UCACOMF,VCOMFACS     COMFACS                                     
         MVI   UCSYS,C'P'        SYSTEM TO PRINT                                
         MVC   UCAGY,QAGENCY                                                    
         MVC   UCMED,QMEDIA                                                     
         MVC   UCCLT,PBILKCLT      CLIENT                                       
         MVC   UCPRD,PBILKPRD      PRODUCT                                      
         MVC   UCEST,PBILKEST      ESTIMATE                                     
         OI    UCOPT,UCOEST        RETURN ESTIMATE UCOMMS                       
         GOTO1 =V(DDUCOM),UCOMBLK                                               
         CLI   UCERROR,0                                                        
         BNE   MCCP75X      ERROR RETURN - JUST EXIT DON'T DIE                  
         TM    UCDATA,UCDNOEST                                                  
         BO    MCCP75X      NO EST DATA                                         
*                                                                               
         L     R1,UCEDATA     EST DATA                                          
         LA    RF,UCELENS     LENGTHS                                           
         LA    RE,PBIREC+301  START OF 1ST EST UCOMM                            
         LHI   R0,1           JUST ONE                                          
MCCP75C  CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(32,RE),0(R1)                                                   
         OC    0(32,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,MCCP75C                                                       
*                                                                               
         DROP  R3                                                               
*                                                                               
MCCP75X  MVC   KEY,KEYSAVE                                                      
         GOTO1 HIGH                RESTORE SEQUENCE                             
         B     MCCP100X                                                         
*                                                                               
*                                                                               
MCCP100  MVC   PBIREC+301(20),PESTNAME    PRINT CAN FIX BOTH NAMES              
         MVC   PBIREC+321(20),PESTNAM2                                          
         OC    PBIREC+301(40),SPACES                                            
*                                                                               
MCCP100X MVI   PBIREC+340,C'0'      END OF RECORD MARKER                        
*                                                                               
         CLI   SVQOPT7,C'Y'  TEST RUN                                           
         BNE   MCCAR1                                                           
         CP    MCCRECS,=P'50'                                                   
         BH    MCCAR1                                                           
         AP    MCCRECS,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(128),PBIREC                                                    
         MVC   PSECOND(128),PBIREC+128                                          
         GOTO1 REPORT                                                           
         MVC   P(93),PBIREC+256                                                 
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+260,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+325,P,16,0                                    
         GOTO1 REPORT                                                           
*                                                                               
MCCAR1   DS    0H                                                               
*                                                                               
*  AT THIS POINT MUST ADD TAPE RECORD TO TABLE AND IF THERE IS A                
*   DUPLICATE ADD THEM TOGETHER                                                 
*       CREATE KEY                                                              
*                                                                               
         MVC    MCCMED,PBILKMED                                                 
         MVC    MCCCLI,PBILKCLT                                                 
         MVC    MCCPRO,PBILKPRD                                                 
         MVC    MCCEST,PBILKEST                                                 
         MVC    MCCINVMO,PBILKBMN+1    BILLING MONTH                            
         MVC    MCCINVN,PBILKBNO                                                
*                                                                               
         MVC    MCCREC(250),PBIREC                                              
         MVC    MCCREC+250(341-250),PBIREC+250                                  
*                                                                               
         L      R2,AOFMCCT        ADDRESS OF MCCTAB                             
         PRINT  GEN                                                             
         GOTO1 =V(BINSRCH),MBINVALS                                             
         PRINT  NOGEN                                                           
*                                                                               
         CLI    MBINVALS,1         RECORD INSERTED                              
         BE     MGOTOXIT                                                        
         OC     MBINVALS+1(3),MBINVALS+1 IF ZERO TABLE IS FULL                  
         BNZ    *+6                                                             
         DC     H'0'                                                            
*                                                                               
*   HAVE DUPLICATE MUST ADD FIELDS                                              
*                                                                               
         L       RF,MBINVALS              ADDRESS OF FOUND RECORD               
         LA      RF,L'MCCKEY(RF)          PAST KEY                              
         MVC     82(5,RF),PBIREC+82        SAVE MOS                             
*                                                                               
         AP      101(12,RF),PBIREC+101(12)                                      
         AP      113(12,RF),PBIREC+113(12)                                      
         AP      125(12,RF),PBIREC+125(12)                                      
         AP      137(12,RF),PBIREC+137(12)                                      
         AP      186(12,RF),PBIREC+186(12)                                      
*                                                                               
MGOTOXIT DS    0H                                                               
         MVC   MBINVALS,=A(MCCMED)                                              
         MVI   MBINVALS,1                                                       
         XIT1                                                                   
*                                                                               
MCCRL    DS    0H                                                               
*                                                                               
         ZAP   MCOUNT,=P'0'                                                     
         CLI   SVQOPT7,C'Y'       TEST RUN - NO TAPE                            
         BE    MCCRL5                                                           
*                                                                               
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (MCCBIT1,(OUTPUT))                                               
MCCRL5   DS    0H                                                               
         L     R2,MCCRECNT         FOR BCT    RECORD COUNT                      
         CH    R2,=H'0'            NO RECORDS                                   
         BE    MZEROCNT                                                         
         L     R3,AOFMCCT                                                       
         LA    R3,L'MCCKEY(R3)     BUMP PAST PSUEDO KEY                         
MCCAGN   ZAP   BIGDUB,101(12,R3)                                                
         CP    BIGDUB,=P'0'       IS IT NEGATIVE?                               
         BL    MCCP5                                                            
         EDIT  BIGDUB,(12,101(R3)),0,FILL=0,ZERO=NOBLANK                        
         B     MCCP10                                                           
*                                                                               
MCCP5    EDIT  BIGDUB,(12,101(R3)),0,FILL=0,ZERO=NOBLANK,MINUS=YES              
*                                                                               
MCCP10   DS    0H                                                               
         ZAP   BIGDUB,113(12,R3)                                                
         CP    BIGDUB,=P'0'       IS IT NEGATIVE?                               
         BL    MCCP15                                                           
         EDIT  BIGDUB,(12,113(R3)),0,FILL=0,ZERO=NOBLANK                        
         B     MCCP20                                                           
*                                                                               
MCCP15   EDIT  BIGDUB,(12,113(R3)),0,FILL=0,ZERO=NOBLANK,MINUS=YES              
*                                                                               
MCCP20   DS    0H                                                               
         ZAP   BIGDUB,125(12,R3)                                                
         CP    BIGDUB,=P'0'       IS IT NEGATIVE?                               
         BL    MCCP25                                                           
         EDIT  BIGDUB,(12,125(R3)),0,FILL=0,ZERO=NOBLANK                        
         B     MCCP30                                                           
*                                                                               
MCCP25   EDIT  BIGDUB,(12,125(R3)),0,FILL=0,ZERO=NOBLANK,MINUS=YES              
*                                                                               
MCCP30   DS    0H                                                               
         ZAP   BIGDUB,137(12,R3)                                                
         CP    BIGDUB,=P'0'       IS IT NEGATIVE?                               
         BL    MCCP35                                                           
         EDIT  BIGDUB,(12,137(R3)),0,FILL=0,ZERO=NOBLANK                        
         B     MCCP40                                                           
*                                                                               
MCCP35   EDIT  BIGDUB,(12,137(R3)),0,FILL=0,ZERO=NOBLANK,MINUS=YES              
*                                                                               
MCCP40   DS    0H                                                               
         ZAP   BIGDUB,186(12,R3)                                                
         CP    BIGDUB,=P'0'       IS IT NEGATIVE?                               
         BL    MCCP45                                                           
         EDIT  BIGDUB,(12,186(R3)),0,FILL=0,ZERO=NOBLANK                        
         B     MCCP50                                                           
*                                                                               
MCCP45   EDIT  BIGDUB,(12,186(R3)),0,FILL=0,ZERO=NOBLANK,MINUS=YES              
*                                                                               
MCCP50   DS    0H                                                               
MCCAGN5  DS    0H                                                               
         CLI   SVQOPT7,C'Y'        TEST RUN - NO TAPE                           
         BE    MCCAGN7                                                          
*                                                                               
         LA    R1,MCCBIT1                                                       
         PUT   (1),(3)                                                          
*                                                                               
MCCAGN7  DS    0H                                                               
         CLI   SVQOPT7,C'Y'                                                     
         BNE   MCBINGO                                                          
         CP    MCOUNT,=P'100'                                                   
         BH    MCBINGO                                                          
         AP    MCOUNT,=P'1'                                                     
         MVC   P(14),=C'***OUTPUT HEX '                                         
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,(R3),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,60(R3)                                                        
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,120(R3)                                                       
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,180(R3)                                                       
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,240(R3)                                                       
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,300(R3)                                                       
         GOTO1 HEXOUT,DMCB,(RF),P,41,0                                          
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***OUTPUT CHAR'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),0(R3)                                                     
         GOTO1 REPORT                                                           
         MVC   P(100),100(R3)                                                   
         GOTO1 REPORT                                                           
         MVC   P(100),200(R3)                                                   
         GOTO1 REPORT                                                           
         MVC   P(41),300(R3)                                                    
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
MCBINGO  LA    R3,353(R3)   TO NEXT RECORD IN TABLE                             
         BCT   R2,MCCAGN                                                        
*                                                                               
MZEROCNT DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'     TEST RUN - NO TAPE                              
         BE    MZEROX                                                           
*                                                                               
         LA    R2,MCCBIT1                                                       
         CLOSE ((2),)                                                           
MZEROX   B     MGOTOXIT                                                         
*                                                                               
*                                                                               
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
NEXTELC  NTR1  BASE=*,LABEL=*                                                   
NEXTELC5 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELCX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELC5                                                         
NEXTELCX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
MCCBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00341,                                            X        
               BLKSIZE=00341,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
MBINVALS DS    0F                                                               
         DC    X'01'              ADD RECORD                                    
         DC    AL3(MCCMED)        RECORD TO BE ADDED                            
         DC    A(MCCTABLE)        ADDRESS OF TABLE WHERE REC IS TO BE           
MCCRECNT DC    F'0'               NUMBER OF RECORDS ADDED                       
         DC    F'353'             LEN OF RECORD                                 
         DC    F'12'              KEY SIZE                                      
         DC    F'1500'            MAX NUMBER OF RECORDS                         
*                                                                               
AOFMCCT  DC    A(MCCTABLE)                                                      
MCCKEY   DS    0XL12                                                            
MCCMED   DS    CL1                                                              
MCCCLI   DS    CL3                                                              
MCCPRO   DS    CL3                                                              
MCCEST   DS    XL2                                                              
MCCINUMB DS    0XL3                                                             
MCCINVMO DS    XL1           INVOICE MONTH                                      
MCCINVN  DS    XL2           INVOICE NUMBER                                     
*            ______                                                             
*              12                                                               
MCCREC   DS    CL341                                                            
ENDMCCR  DS    0C                                                               
***********************                                                         
MCOUNT   DS    PL4                                                              
*                                                                               
         TITLE 'IPG'                                                            
*                             TAPE CODE I                                       
         SPACE 2                                                                
IPGPROC  NMOD1 0,IPGPROC                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,IPG1                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (IPGBIT1,(OUTPUT))                                               
*                                                                               
IPG1     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    IPGL                                                             
*                                                                               
         LA    RE,PBIREC           CLEAR THE RECORD W/ BLANKS                   
         LHI   R1,1200                                                          
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         MVI   PBIREC,C'P'               SYSTEM                                 
         MVC   PBIREC+1(2),PBILKAGY      AGENCY                                 
         MVC   PBIREC+3(1),PBILKMED      MEDIA                                  
         MVC   PBIREC+5(3),PBILKCLT      CLIENT                                 
         MVC   PBIREC+8(20),PCLTNAME     CLT NAME                               
         OC    PBIREC+8(20),SPACES                                              
         MVC   PBIREC+29(1),PCLTOFF      CLT MEDIA OFFICE                       
         MVC   PBIREC+30(2),PCLTAOFC     ACC OFFICE CODE                        
         MVC   PBIREC+32(3),PBILKPRD     PRD                                    
         MVC   PBIREC+35(20),PPRDNAME    PRD NAME                               
         OC    PBIREC+35(20),SPACES                                             
*                                                                               
         OC    PPRDACCT,PPRDACCT         ANYTHING ?                             
         BZ    IPGP10                    NO, NEXT FIELD                         
         MVI   PBIREC+64,C'0'            PRODUCT ACCOUNT NUMBER                 
         MVC   PBIREC+65(4),PPRDACCT                                            
         CLI   PPRDACCT,X'FF'                                                   
         BNE   IPGP10                                                           
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
         MVC   PBIREC+64(5),WORK                                                
*                                                                               
IPGP10   DS    0H                                                               
         OC    PCLTNUM,PCLTNUM                                                  
         BZ    IPGP20                                                           
         MVC   PBIREC+69(3),PCLTNUM                                             
         CLI   PCLTNUM,X'FF'                                                    
         BNE   IPGP15                                                           
         UNPK  WORK(5),PCLTNUM+1(2)                                             
         MVC   PBIREC+69(4),WORK+1       INTERFACE CODE                         
         B     IPGP20                                                           
*                                                                               
IPGP15   DS    0H                                                               
         MVC   BYTE,PCLTNUM                                                     
         NI    BYTE,X'F0'                                                       
         CLI   BYTE,X'80'                                                       
         BNE   IPGP20                                                           
         XC    FULL,FULL                                                        
         MVC   FULL+1(3),PCLTNUM                                                
         NI    FULL+1,X'7F'        SET OFF X'80' BIT                            
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+69(5),DUB                                                 
*                                                                               
IPGP20   DS    0H                                                               
         MVC   HALF,PBILKEST             EST                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+77(3),DUB                                                 
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK         TEST HAVE EST HDR                       
         BE    IPGP30                   YES                                     
         MVC   WORK(64),KEY             SAVE KEY FOR SEQ                        
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
IPGP30   DS    0H                                                               
         MVC   PBIREC+80(20),PESTNAME     EST NAME                              
         OC    PBIREC+80(20),SPACES                                             
         MVC   PBIREC+100(20),PESTNAM2                                          
         OC    PBIREC+100(20),SPACES                                            
*                                         DO UDEFS HERE SINCE GOT REC           
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   IPGP35                                                           
         MVC   PBIREC+541(32),PUSER1                                            
         OC    PBIREC+541(32),SPACES                                            
         MVC   PBIREC+573(16),PUSER2                                            
         OC    PBIREC+573(16),SPACES                                            
         DROP  R2                                                               
*                                                                               
IPGP35   DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   IPGP40                                                           
         MVC   PBIREC+589(32),PEUSER1                                           
         OC    PBIREC+589(32),SPACES                                            
         MVC   PBIREC+621(16),PEUSER2                                           
         OC    PBIREC+621(16),SPACES                                            
         DROP  R2                                                               
*                                                                               
IPGP40   DS    0H                                                               
         TM    PBILCMSW,X'20'          SEE IF AOR BILL                          
         BZ    IPGP45                                                           
         GOTO1 =A(GETAOR)                                                       
         MVC   PBIREC+130(30),WORK     AOR NAME LINE 1                          
*        ZAP   DUB,PBILLACM            AOR ORIG BILL COMISSION                  
*        LHI   R2,393                  POSITION                                 
*        BAS   RE,FMTAMT               FORMAT THE AMOUNT                        
*                                                                               
IPGP45   DS    0H                                                               
         CLI   RETAIL,C'Y'             RETAIL ?                                 
         BNE   IPGP47                                                           
         MVC   PBIREC+160(12),PBRACCT  RETAIL ACCOUNT                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+359(11),DUB      RETAIL ACTUAL FOR OUTLET                 
         B     *+16                                                             
IPGP47   MVC   PBIREC+55(9),PNBPGR1    DIVISION REGION AND DISTRICT             
         OC    PBIREC+55(9),SPACES                                              
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(20,WORK)       MOS                     
         MVC   PBIREC+172(6),WORK                       MOVE IN YYYYMM          
         GOTO1 DATCON,DMCB,PBILLDAT,(20,PBIREC+180)     RUN/BILL DATE           
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,PBIREC+190) INVOICE DATE            
         GOTO1 DATCON,DMCB,(3,PBILDUED),(20,PBIREC+198) DUE DATE                
         GOTO1 DATCON,DMCB,(2,PBILEDID),(20,PBIREC+218) TRANSMITTAL DT          
         OC    PBILLSTA,PBILLSTA      ANY STRT/END DATE ?                       
         BZ    IPGP49                 NO, SKIP                                  
         CLI   PBILLSTA,C' '                                                    
         BE    IPGP49                                                           
         MVC   FULL(2),PBILKMOS                                                 
         MVC   FULL+2(1),PBILLSTA                                               
         GOTO1 DATCON,DMCB,(3,FULL),(20,PBIREC+226)     STRT DAY OF BIL         
         MVC   FULL+2(1),PBILLEND                                               
         GOTO1 DATCON,DMCB,(3,FULL),(20,PBIREC+234)     END DAY OF BILL         
*                                                                               
IPGP49   GOTO1 =V(PPFMTINO),DMCB,PBILLDAT,(2,PBILKBNO),                X        
               (PBILKMED,B1PROF),B1XPROF                                        
         L     RF,DMCB                                                          
         MVC   PBIREC+258(10),0(RF)     SAVE FULL INVOICE NUMBER                
         MVC   PBIREC+268(2),PBILLTYP   BILL TYPE+MODE (I.E. B4 OR M7)          
*                                                                               
         ZAP   DUB,PBILLGRS              GROSS                                  
         LHI   R2,272                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,PBILLBIL              GROSS-CD                               
         LHI   R2,294                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,=P'0'                 IF AOR BILL, NET IS ZERO               
         TM    PBILCMSW,X'20'            SEE IF AOR BILL                        
         BNZ   *+10                                                             
         ZAP   DUB,PBILLNET              NET -CD                                
         LHI   R2,327                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,PBILLRCV              RECEIVABLE                             
*                                                                               
         CLC   QAGENCY,=C'HD'             HDTO TEST OF M2TOA                    
         BE    *+14                                                             
         CLC   QAGENCY,=C'U#'             SEE IF M2TOA                          
         BNE   IPGP51                                                           
*                                                                               
         AP    DUB,MYGST                 INCLUDE CANDAIAN TAXES                 
         AP    DUB,MYPST                 NOTE - MYPST INCLUDES MYHST            
*                                                                               
IPGP51   LHI   R2,371                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,PPBVEBC               EFFECTIVE CD                           
         LHI   R2,382                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
*                                                                               
         CLC   QAGENCY,=C'HD'            TEST                                   
         BE    *+14                                                             
         CLC   QAGENCY,=C'U#'            SEE IF M2TOA                           
         BNE   IPGB52                                                           
         ZAP   DUB,PPBVEBC              EFFECTIVE CD                            
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         TM    PBILBASA,X'04'         CD OUT IN BILL FORMULA?                   
         BNZ   IPGB51C                                                          
         AP    DOUBLE,DUB             ADD CD TO GET NET                         
*                                                                               
IPGB51C  ZAP   MYDUB,PBILLRCV                                                   
         SP    MYDUB,DOUBLE            REVENUE = RCV - NET                      
         ZAP   DUB,MYDUB                 M2TOA COMM = RVC-NET                   
*                                                                               
         TM    PBILBASA,X'04'         CD OUT IN BILL FORMULA?                   
         BZ    IPGB53                                                           
         ZAP   DUB,=P'0'                 ALSO CLEAR CD FIELD                    
         LHI   R2,382                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
*                                      MUST RE-SET DUB                          
         ZAP   MYDUB,PBILLRCV                                                   
         SP    MYDUB,DOUBLE            REVENUE = RCV - NET                      
         ZAP   DUB,MYDUB                 M2TOA COMM = RVC-NET                   
*                                                                               
         B     IPGB53                                                           
*                                                                               
IPGB52   ZAP   DUB,PBILLRCV              COMM (ACT-(NET-CD))                    
         SP    DUB,PBILLNET                                                     
*                                                                               
IPGB53   LHI   R2,393                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         L     R0,PPBVETAX               PPBVETAX IS BINARY                     
         CVD   R0,DUB                    SALES TAX - U.S.                       
         LHI   R2,437                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,MYGST                 GST                                    
         LHI   R2,448                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         SP    MYPST,MYHST               REMOVE HST FROM PST TOTAL              
         ZAP   DUB,MYPST                 PST                                    
         LHI   R2,459                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,MYHST                 HST                                    
         LHI   R2,470                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
*                                                                               
         MVI   PBIREC+482,C'N'                                                  
         TM    PBILCMSW,X'20'            TRUE AOR BILL?                         
         BZ    *+8                                                              
         MVI   PBIREC+482,C'Y'                                                  
         MVI   PBIREC+483,C'N'                                                  
         TM    PBILCMSW,X'10'            AOR CLIENT BILL?                       
         BZ    *+8                                                              
         MVI   PBIREC+483,C'Y'                                                  
         MVI   PBIREC+484,C'N'                                                  
         TM    PBILCMSW,X'04'            NO TAX IN AOR BILL?                    
         BZ    *+8                                                              
         MVI   PBIREC+484,C'Y'                                                  
         MVI   PBIREC+485,C'N'                                                  
         TM    PBILCMSW,X'02'            COMM ONLY BILL?                        
         BZ    *+8                                                              
         MVI   PBIREC+485,C'Y'                                                  
         MVI   PBIREC+486,C'N'                                                  
         TM    PBILCMSW,X'01'            SEP COMM BILL?                         
         BZ    *+8                                                              
         MVI   PBIREC+486,C'Y'                                                  
         MVI   PBIREC+487,C'N'                                                  
         TM    PBILCMSW,X'08'            NET BILL (SEP COMM CLIENT)?            
         BZ    *+8                                                              
         MVI   PBIREC+487,C'Y'                                                  
         MVI   PBIREC+488,C'N'                                                  
         TM    PBILCMSW,X'80'            COMM ADJUSTMENT BILL?                  
         BZ    *+8                                                              
         MVI   PBIREC+488,C'Y'                                                  
*                                        GET PRD/EST/REGION/DISTR UCOMM         
*                                        GET PRD/EST/REGION/DISTR UCOMM         
         LA    R2,UCOMBLK                SET-UP UCOM CONTROL BLOCK              
         XC    UCOMBLK(L'UCOMBLK),UCOMBLK                                       
         USING DDUCOMD,R2                                                       
         MVC   KEYSAVE,KEY         SAVE KEY                                     
         MVC   UCACOMF,VCOMFACS    COMFACS                                      
         MVI   UCSYS,C'P'          SYSTEM TO PRINT                              
         MVC   UCAGY,QAGENCY                                                    
         MVC   UCMED,QMEDIA                                                     
         MVC   UCCLT,PBILKCLT      CLIENT                                       
         MVC   UCPRD,PBILKPRD      PRODUCT                                      
         OI    UCOPT,UCOPRD        RETURN PRODUCT UCOMMS                        
         MVC   UCEST,PBILKEST      ESTIMATE                                     
         OI    UCOPT,UCOEST        RETURN ESTIMATE UCOMMS                       
         CLI   RETAIL,C'Y'         RETAIL ?                                     
         BE    IPGP60              THERE WON'T BE REG/DISTR/DIV DATA            
         OC    PNBPGR1(9),PNBPGR1  ANY DATA ?                                   
         BZ    IPGP60                                                           
         CLC   PNBPGR1(9),SPACES                                                
         BE    IPGP60                                                           
         CLI   PNBPGR1,C'0'        SEE IF I HAVE A DIVISION CODE                
         BL    IPGP60                                                           
         MVC   UCDIV,PNBPGR1                                                    
         CLI   PNBMGR1,C'0'        SEE IF I HAVE A REGION CODE                  
         BL    *+14                                                             
         MVC   UCREG,PNBMGR1       RETURN REGION UCOMS                          
         OI    UCOPT,UCOREG                                                     
*                                                                               
         CLI   PNBMGR2,C'0'        SEE IF I HAVE A DISTR CODE                   
         BL    IPGP60                                                           
         MVC   UCDST,PNBMGR2       RETURN DISTRICT UCOMS                        
         OI    UCOPT,UCODST                                                     
*                                                                               
IPGP60   GOTO1 =V(DDUCOM),UCOMBLK                                               
         CLI   UCERROR,0                                                        
         BNE   IPGP70       ERROR RETURN - JUST EXIT DON'T DIE                  
         TM    UCDATA,UCDNOPRD+UCDNOEST+UCDNOREG+UCDNODST                       
         BO    IPGP70       NO PRD NOR EST NOR REGION NOR DISTRICT DATA         
         TM    UCDATA,UCDNOPRD                                                  
         BO    IPGPUCE                                                          
         L     R1,UCPDATA     PRD DATA                                          
         LA    RF,UCPLENS     LENGTHS                                           
         LA    RE,PBIREC+637  START OF 1ST PRODUCT UCOMM                        
         LHI   R0,4                                                             
IPGPUCP5 CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(32,RE),0(R1)                                                   
         OC    0(32,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,IPGPUCP5                                                      
*                                                                               
IPGPUCE  TM    UCDATA,UCDNOEST                                                  
         BO    IPGPUCR                                                          
         L     R1,UCEDATA     EST DATA                                          
         LA    RF,UCELENS     LENGTHS                                           
         LA    RE,PBIREC+765  START OF 1ST EST UCOMM                            
         LHI   R0,4                                                             
IPGPUCE5 CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(32,RE),0(R1)                                                   
         OC    0(32,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,IPGPUCE5                                                      
*                                                                               
IPGPUCR  TM    UCOPT,UCOREG+UCODST   DID WE ASK FOR REG/DIST UCOMMS?            
         BZ    IPGP70                NO, DONE W/ UCOMMS                         
         TM    UCDATA,UCDNOREG                                                  
         BO    IPGPUCD                                                          
         L     R1,UCRDATA     REGION DATA                                       
         LA    RF,UCRLENS     LENGTHS                                           
         LA    RE,PBIREC+893  START OF 1ST REG UCOMM                            
         LHI   R0,4                                                             
IPGPUCR5 CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(32,RE),0(R1)                                                   
         OC    0(32,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,IPGPUCR5                                                      
*                                                                               
IPGPUCD  TM    UCDATA,UCDNODST                                                  
         BO    IPGP70                                                           
         L     R1,UCDDATA     DISTR DATA                                        
         LA    RF,UCDLENS     LENGTHS                                           
         LA    RE,PBIREC+1021 START OF 1ST DISTR UCOMM                          
         LHI   R0,4                                                             
IPGPUCD5 CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(32,RE),0(R1)                                                   
         OC    0(32,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,IPGPUCD5                                                      
*                                                                               
*                                                                               
IPGP70   MVC   KEY,KEYSAVE     RESTORE SEQ READ                                 
         GOTO1 HIGH                                                             
         DROP  R2                                                               
*                                                                               
         SR    R2,R2                                                            
         ICM   R2,3,PBILLLEN       LENGTH OF RECORD W/OUT ELEMS                 
         CHI   R2,133                                                           
         BNH   IPGP100             NO ELEMENTS, DONE                            
         CLI   PBILOTH,X'09'       IS THERE OTHERS ELEM ?                       
         BNE   IPGP100                                                          
         CLI   PBILLJOB,X'FF'      SKIP JOB=NONE                                
         BE    *+16                                                             
         MVC   PBIREC+526(L'PBILLJOB),PBILLJOB     AD CODE                      
         OC    PBIREC+526(L'PBILLJOB),SPACES                                    
*                                                                               
         ZAP   DUB,PBILLOPG              OPEN RATE GROSS                        
         LHI   R2,404                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,PBILLOPN              OPEN RATE NET                          
         LHI   R2,415                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
         ZAP   DUB,PBILLCNR              CONTRACT RATE RECEIVABLE               
         LHI   R2,426                    POSITION                               
         BAS   RE,FMTAMT                 FORMAT THE AMOUNT                      
*                                                                               
*                                                                               
IPGP100  DS    0H                                                               
         MVI   PBIREC+925,C'?'     PRESET TAX TO MIX OR UNKNOWN                 
         LA    R2,PBILLREC+33                                                   
         MVI   MELCODE,X'84'       NOW GET PST FROM PBLPSTEL                    
         BRAS  RE,NEXTELM                                                       
         BNE   IPGP105                                                          
                                                                                
         USING PBLPSTEL,R2                                                      
         CLI   PBLPVCOD,0          ANY VAT CODE?                                
         BE    IPGP105                                                          
         MVC   PBIREC+925(L'PBLPVCOD),PBLPVCOD                                  
         B     IPGP110                                                          
         DROP  R2                                                               
*                                                                               
IPGP105  LA    R2,PBILLREC+33                                                   
         MVI   MELCODE,X'0A'       VAT ELEM                                     
         BRAS  RE,NEXTELM                                                       
         BNE   IPGP110                                                          
                                                                                
         USING PBILVEL,R2                                                       
         CLI   PBILLVCD,X'FF'                                                   
         BE    IPGP110                                                          
         CLI   PBILLVCD,0                                                       
         BE    IPGP110                                                          
         MVC   PBIREC+925(L'PBILLVCD),PBILLVCD                                  
*                                                                               
IPGP110  MVI   PBIREC+1149,SEMICOL                                              
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BNE   IPGPUT                                                           
         LHI   R0,1150             YES                                          
         GOTO1 =V(PRNTBL),DMCB,0,PBIREC,C'DUMP',(R0),=C'1D'                     
         B     IPGX                                                             
*                                                                               
IPGPUT   LA    R1,IPGBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
IPGX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
IPGL     DS    0H                                                               
*                                                                               
*                                                                               
         LA    R2,IPGBIT1                                                       
         CLOSE ((2),)                                                           
         B     IPGX                                                             
         SPACE 2                                                                
SEMICOL  EQU   X'5E'                                                            
         EJECT                                                                  
FMTAMT   NTR1                      DUB HAS AMOUNT, R2 POSIT IN PBIREC           
         UNPK  WORK(11),DUB                                                     
         LA    R4,WORK                                                          
         TM    WORK+10,X'10'       IF AMOUNT NEGATIVE                           
         BZ    *+12                                                             
         LA    R4,1(R4)                                                         
         MVI   WORK+11,C'-'        ADD MINUS SIGN AT END                        
*                                                                               
         OI    WORK+10,X'F0'       REMOVE OVERPUNCH                             
         LA    R2,PBIREC-1(R2)                                                  
         MVC   0(11,R2),0(R4)                                                   
         XIT1                                                                   
         EJECT                                                                  
         LTORG                                                                  
*                                                                               
IPGBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=01150,                                            X        
               BLKSIZE=01150,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         TITLE 'NEEDHAM-HARPER-STEERS'                                          
*                                  NEEDHAM-HARPER-STEERS                        
         SPACE 2                                                                
NHS      NMOD1 0,NHS                                                            
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,NHS2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (NHPBIT1,(OUTPUT))                                               
*                                                                               
NHS2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    NHSL                                                             
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         CLI   PBILKMED,C'O'                                                    
         BE    NHS20                                                            
*                                                                               
         MVI   PBIREC,C'1'                                                      
         MVC   PBIREC+1(3),PCLTNUM                                              
         MVC   WORK+1(4),PPRDACCT                                               
         CLI   PPRDACCT,X'FF'                                                   
         BNE   NHS4                                                             
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
NHS4     DS    0H                                                               
         MVC   PBIREC+4(2),WORK+3  PRD NUM                                      
         LA    RF,=C'40'                                                        
         CLI   PBILKMED,C'N'                                                    
         BE    NHS5                                                             
         LA    RF,=C'31'                                                        
         CLI   PBILKMED,C'M'                                                    
         BE    NHS5                                                             
         LA    RF,=C'37'                                                        
         CLI   PBILKMED,C'T'                                                    
         BE    NHS5                                                             
         LA    RF,=C'33'                                                        
         CLI   PBILKMED,C'S'                                                    
         BE    NHS5                                                             
         DC    H'0'             UNKNOWN MEDIA                                   
*                                                                               
NHS5     DS    0H                                                               
         MVC   PBIREC+7(2),0(RF)   MEDIA CODE                                   
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+9(3),DUB                                                  
         MVI   PBIREC+12,C'0'                                                   
*                                                                               
*                                                                               
         ZAP   DUB,PBILLRCV        RCVBL                                        
         TM    PBILBASA,X'04'      ADD CD IF TAKEN OUT                          
         BZ    NHS6                                                             
         CLI   PBILCDSW,C'N'       BUT NOT IF SUPPRESSED                        
         BE    NHS6                                                             
         CLI   PBILCDSW,C'S'        OR ON SEP BILL                              
         BE    NHS6                                                             
         AP    DUB,PPBVEBC        + EFFECTIVE CD                                
*                                  = RCVBL +CD                                  
*                                                                               
NHS6     DS    0H                                                               
         MVC   PBIREC+30(2),=2C'0'                                              
         MVC   PBIREC+32(2),SPACES                                              
         ZAP   PBIREC+34(6),DUB    'GROSS' BILLING                              
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),WORK                                    
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)                            
         MVC   PBIREC+45(4),WORK+2                                              
         MVC   PBIREC+49(2),WORK                                                
         MVC   PBIREC+117(2),DINVNO                                             
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+119(4),DUB                                                
*                                                                               
         MVI   PBIREC+128,C'1'                                                  
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),WORK                                    
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)                            
         MVC   PBIREC+129(4),WORK+2                                             
         MVC   PBIREC+133(2),WORK                                               
*                                                                               
         ZAP   DUB,PBILLNET        G - AC - CD                                  
         AP    DUB,PPBVEBC         + EFFECTIVE CD                               
         ZAP   PBIREC+138(6),DUB   =G - AC                                      
         MVC   PBIREC+135(3),SPACES                                             
*                                                                               
*                                                                               
         ZAP   DUB,PBILLRCV                                                     
*                                  SUBTRACT OUT CD IF NECESSARY                 
         TM    PBILBASA,X'04'                                                   
         BNZ   NHS7                                                             
*                                                                               
         SP    DUB,PPBVEBC         SUBTRACT EFFECTIVE CD                        
*                                                                               
NHS7     DS    0H                                                               
         ZAP   PBIREC+144(6),DUB                                                
         B     NHS50                                                            
*                                                                               
*                                  SPECIAL OUTDOOR                              
*                                                                               
NHS20    DS    0H                                                               
         MVI   PBIREC,C'3'                                                      
         MVC   PBIREC+1(3),PCLTNUM                                              
         MVC   WORK+1(4),PPRDACCT                                               
         CLI   PPRDACCT,X'FF'                                                   
         BNE   NHS24                                                            
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
NHS24    DS    0H                                                               
         MVC   PBIREC+4(2),WORK+3  PRD NUM                                      
*                                                                               
         MVC   PBIREC+7(2),=C'51'                                               
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+9(4),DUB          EST                                     
         MVI   PBIREC+19,C'0'                                                   
*                                                                               
         ZAP   PBIREC+20(4),=P'051033'                                          
*                                                                               
NHS26    DS    0H                                                               
         MVC   PBIREC+27(2),=C'11'                                              
*                                                                               
         UNPK  PBIREC+31(9),PBILLRCV         RCVBL                              
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),WORK                                    
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)                            
         MVC   PBIREC+46(4),WORK+2                                              
         MVC   PBIREC+50(2),WORK                                                
*                                                                               
         UNPK  PBIREC+86(9),PBILLNET    G - AC (-CD)                            
         MVI   PBIREC+95,C'0'                                                   
         MVC   PBIREC+96(8),PBIREC+95                                           
         MVC   PBIREC+104(9),PBIREC+86       REPEAT NET                         
*                                       INV NO IN WORK(6)                       
         MVC   WORK(2),DINVNO                                                   
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK+2(4),DUB                                                    
         PACK  PBIREC+117(4),WORK(6)                                            
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),WORK                                    
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)                            
         MVC   WORK+6(2),WORK                                                   
         PACK  PBIREC+129(4),WORK+2(6)    MMDDYY                                
         MVC   PBIREC+135(9),PBIREC+31       REPEAT ACTUAL BILLING              
*                                                                               
NHS50    DS    0H                                                               
*                                                                               
*                                                                               
         LA    R1,NHPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
NHSX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
NHSL     DS    0H                                                               
         LA    R2,NHPBIT1                                                       
         CLOSE ((2),)                                                           
         B     NHSX                                                             
*                                                                               
         SPACE 3                                                                
NHPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00150,                                            X        
               BLKSIZE=00600,          DOS BLKSIZE=00600               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'DDB-NEEDHAM'                                                    
*                                  DDB-NEEDHAM                                  
         SPACE 2                                                                
DDBNH    NMOD1 0,DDBNH                                                          
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,DN2                                                            
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (DNPBIT1,(OUTPUT))                                               
*                                                                               
DN2      DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    DNL                                                              
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC+0,C'5'       REC ID                                       
*                                                                               
         LA    RF,=C'CWA'          AGENCY - CW                                  
         CLC   =C'CW',QAGENCY                                                   
         BE    DN3                                                              
*                                                                               
         LA    RF,=C'RET'          AGENCY - NR = RET                            
         CLC   =C'NR',QAGENCY                                                   
         BE    DN3                                                              
*                                                                               
         LA    RF,=C'DDB'          AGENCY                                       
         CLI   PCLTOFF,C'Y'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'2'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'1'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'C'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'W'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'4'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'5'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'T'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'I'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'F'                                                     
         BE    DN3                                                              
*                                                                               
         LA    RF,=C'DDW'                                                       
         CLI   PCLTOFF,C'L'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'S'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'Z'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'V'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'7'                                                     
         BE    DN3                                                              
         CLI   PCLTOFF,C'8'                                                     
         BE    DN3                                                              
*                                                                               
         LA    RF,=C'ZZZ'          'UNKNOWN AGENCY'                             
*                                                                               
DN3      DS    0H                                                               
         MVC   PBIREC+1(3),0(RF)   AGENCY                                       
*                                                                               
         LA    RF,=C'01'           MAGAZINES                                    
         CLI   QMEDIA,C'M'                                                      
         BE    DN4                                                              
         LA    RF,=C'01'           TRADE                                        
         CLI   QMEDIA,C'T'                                                      
         BE    DN4                                                              
         LA    RF,=C'01'           SUPPLEMENTS                                  
         CLI   QMEDIA,C'S'                                                      
         BE    DN4                                                              
         LA    RF,=C'02'           NEWSPAPERS                                   
         CLI   QMEDIA,C'N'                                                      
         BE    DN4                                                              
         LA    RF,=C'04'           OUTDOOR                                      
         CLI   QMEDIA,C'O'                                                      
         BE    DN4                                                              
         DC    H'0'                                                             
*                                                                               
DN4      DS    0H                                                               
         MVC   PBIREC+4(2),0(RF)   SET MEDIA CODE                               
*                                                                               
         MVC   PBIREC+6(4),PPRDACCT    PRODUCT NUMBER                           
         CLI   PPRDACCT,X'FF'                                                   
         BNE   DN5                                                              
         MVC   FULL,PPRDACCT                                                    
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+6(4),DUB                                                  
*                                                                               
DN5      DS    0H                                                               
         CLC   QAGENCY,=C'NE'      FOR AGENCY NE                                
         BNE   DN5F                                                             
         CLI   PBRETAIL,X'02'      FOR DISTRIBUTOR (NON-CORP) BILLS             
         BE    DN5B                                                             
         CLI   PBRETAIL,X'01'      AND FOR CORP BILLS                           
         BNE   DN5F                                                             
*                                  USE OUTLET (LAST 4 OF PBRACCT)               
DN5B     DS    0H                                                               
         MVC   PBIREC+6(4),SPACES                                               
         LA    RF,PBRACCT+L'PBRACCT-1                                           
         CLI   0(RF),C' '                                                       
         BH    *+8                                                              
         BCT   RF,*-8                                                           
         LA    R1,PBRACCT                                                       
         LR    RE,RF                                                            
         SR    RE,R1                                                            
         BM    DN5F                                                             
         CH    RE,=H'3'            IF 4 OR LESS                                 
         BNH   DN5D                USE ALL OF IT                                
         LA    RE,3                                                             
         LR    R1,RF                                                            
         SH    R1,=H'3'                                                         
*                                                                               
DN5D     DS    0H                                                               
         EX    RE,*+8                                                           
         B     *+10                                                             
         MVC   PBIREC+6(0),0(R1)                                                
*                                                                               
DN5F     DS    0H                                                               
         CLI   PCLTOFF,C'L'        SPECIAL FOR SOME OFFICES                     
         BE    DN5G                                                             
         CLI   PCLTOFF,C'7'                                                     
         BE    DN5G                                                             
         CLI   PCLTOFF,C'8'                                                     
         BNE   DN5H                                                             
*                                                                               
DN5G     DS    0H                  CLIENT/PRODUCT                               
         MVC   PBIREC+6(6),SPACES                                               
         MVC   PBIREC+6(3),PBILKCLT                                             
         LA    RF,PBIREC+9         CCCPPP, CCPPP_ OR CCPP__                     
         CLI   PBIREC+8,C' '                                                    
         BH    *+6                                                              
         BCTR  RF,0                                                             
         MVC   0(3,RF),PBILKPRD                                                 
*                                                                               
DN5H     DS    0H                                                               
         MVC   PBIREC+12(2),DINVNO       INVOICE NUMBER                         
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+14(4),DUB                                                 
*                                                                               
         MVC   HALF,PBILKEST       ESTIMATE                                     
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+18(4),DUB                                                 
*                                                                               
         CLC   PBILKCLT(2),=C'GT'    SPECIAL 'ESTIMATE' FOR SOME                
         BE    DN4F                                                             
         CLC   PBILKCLT(2),=C'VX'                                               
         BE    DN4F                                                             
         B     DN7                                                              
*                                                                               
DN4F     DS    0H                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    DN6                 YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
DN6      DS    0H                                                               
         MVC   PBIREC+18(4),PESTNAME+2    USE ESTNAME+2(4)                      
*                                                                               
DN7      DS    0H                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),WORK   MONTH OF SERVICE                 
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)  MONTH OF SERVICE          
         MVC   PBIREC+22(2),WORK+2             MONTH                            
         MVC   PBIREC+24(1),WORK+1             YEAR(1)                          
*                                                                               
         MVI   PBIREC+31,C'P'                                                   
*                                                                               
         ZAP   DUB,PPBVEBC         EFFECTIVE CD                                 
         UNPK  PBIREC+32(8),DUB    = CD                                         
         ZAP   DOUBLE,DUB          SAVE CD AMOUNT                               
*                                                                               
         ZAP   DUB,PBILLRCV        RECIEVABLE                                   
         SP    DUB,PBILLNET        LESS (G-AC-CD)                               
         TM    PBILBASA,X'04'      TEST CD REFLECTED IN RCVBL                   
         BNZ   *+10                YES - OK                                     
         SP    DUB,DOUBLE          ELSE SUBTRACT CD                             
         UNPK  PBIREC+57(8),DUB    = COMMISSION                                 
*                                                                               
         UNPK  PBIREC+40(9),PBILLRCV    RECIEVABLE                              
*                                                                               
         UNPK  PBIREC+49(8),=P'0'  NON-COMMISSION AMOUNT                        
*                                                                               
         UNPK  PBIREC+65(8),=P'0'  FEE AMOUNT                                   
*                                                                               
         ZAP   DUB,PBILLNET        NET                                          
         AP    DUB,DOUBLE          PLUS CD                                      
         UNPK  PBIREC+73(9),DUB                                                 
*                                                                               
         MVC   PBIREC+82(5),PBIREC+6     REPEAT PRD ACCT FIELD                  
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),WORK     INV DATE                       
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)     INV DATE               
         MVC   PBIREC+87(4),WORK+2                                              
         MVC   PBIREC+91(2),WORK                                                
*                                                                               
         LA    R1,DNPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DNX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
DNL      DS    0H                                                               
         LA    R2,DNPBIT1                                                       
         CLOSE ((2),)                                                           
         B     DNX                                                              
         SPACE 3                                                                
DNPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00093,                                            X        
               BLKSIZE=00930,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'BOZELL && JACOBS'                                               
*                                  BOZELL & JACOBS                              
         SPACE 2                                                                
BJPROC   NMOD1 0,BJPROC                                                         
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,BJ2                                                            
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (BJPBIT1,(OUTPUT))                                               
*                                                                               
BJ2      DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    BJL                                                              
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVI   PBIREC,C'P'              PRINT                                   
         MVC   PBIREC+1(1),QMEDIA       MEDIA                                   
         MVC   PBIREC+2(1),PCLTOFF      OFFICE                                  
         MVC   PBIREC+3(6),PBILKCLT     CLT + PRD                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+9(3),DUB          EST                                     
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),PBIREC+12      MOS (4)                  
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+12)     MOS (4)           
         MVC   PBIREC+16(2),PAGYPROF+2                                          
         MVC   PBIREC+18(2),DINVNO                     INV MONTH                
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+20(4),DUB              INV NO.                            
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+24   INV DATE                    
*****    GOTO1 (RF),(R1),(3,PBILDUED),PBIREC+30     DUE DATE                    
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+24)   INV DATE            
         GOTO1 (RF),(R1),(3,PBILDUED),(X'20',PBIREC+30)     DUE DATE            
*                                                                               
         UNPK  PBIREC+36(10),PBILLGRS        GROSS                              
         UNPK  PBIREC+46(10),PBILLBIL        GROSS LESS CD                      
         UNPK  PBIREC+56(10),PBILLNET        G - CD - AC                        
         UNPK  PBIREC+66(10),PBILLRCV        RCVBL (ACTUAL)                     
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    BJP4                YES                                          
         MVC   WORK(32),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(32),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
BJP4     DS    0H                                                               
         MVC   PBIREC+82(20),PESTNAME   EST NAME                                
         MVC   PBIREC+102(20),PESTNAM2  EST NAME 2                              
         OC    PBIREC+82(40),SPACES                                             
*                                                                               
         CLI   RETAIL,C'Y'                SEE IF RETAIL BILL                    
         BNE   BJP8                                                             
         MVC   PBIREC+122(10),PBRACCT     RETAIL ACCOUNT                        
         B     BJP12                  SKIP TO NAME                              
***                                   NOTE - THEY ONLY USE 10 BYTES             
*                                                                               
BJP8     DS    0H                                                               
         CLI   PBILLTYP,C'M'       SEE IF MANUAL BILL                           
         BE    BJP12                                                            
         CLI   PNBMGR1,C'0'        SEE IF I HAVE A REGION CODE                  
         BL    BJP10                                                            
         MVC   PBIREC+162(3),PNBMGR1    REGION CODE                             
*                                                                               
BJP10    CLI   PNBMGR2,C'0'        SEE IF I HAVE A DISTRICT                     
         BL    BJP12                                                            
         MVC   PBIREC+165(3),PNBMGR2    DISTRICT                                
*                                                                               
BJP12    MVC   PBIREC+136(20),PPRDNAME   PRODUCT NAME                           
         OC    PBIREC+136(20),SPACES                                            
         MVC   PBIREC+159(3),PPRDDIV DIVISION                                   
         OC    PBIREC+159(3),SPACES                                             
*                                                                               
*                                                                               
BJPX     LA    R1,BJPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
BJX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
BJL      DS    0H                                                               
         LA    R2,BJPBIT1                                                       
         CLOSE ((2),)                                                           
         B     BJX                                                              
         SPACE 3                                                                
BJPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=00200,          DOS BLKSIZE=00200               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'DANCER'                                                         
*                                  DANCER                                       
         SPACE 2                                                                
DFPROC   NMOD1 0,DFPROC                                                         
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,DF2                                                            
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (DFPBIT1,(OUTPUT))                                               
*                                                                               
DF2      DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    DFL                                                              
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC(2),QAGENCY   AGNECY                                       
         MVI   PBIREC+2,C'P'              PRINT                                 
         MVC   PBIREC+3(1),QMEDIA       MEDIA                                   
         MVC   PBIREC+4(6),PBILKCLT     CLT + PRD                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+10(3),DUB          EST                                    
         MVC   PBIREC+16(1),PCLTOFF      OFFICE                                 
         MVC   PBIREC+17(2),DINVNO                     INV MONTH                
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+19(4),DUB              INV NO.                            
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+23   INV DATE                    
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+23)   INV DATE            
         UNPK  PBIREC+29(10),PBILLRCV        RCVBL (ACTUAL)                     
         UNPK  PBIREC+39(10),PBILLNET        G - CD - AC                        
         ZAP   DUB,PBILLRCV                  RECEIVABLE                         
         SP    DUB,PBILLNET                  LESS PAYABLE = COMM                
         UNPK  PBIREC+49(10),DUB             COMMISSION                         
         ZAP   DUB,PPBVEBC                   EFFECTIVE CD                       
         UNPK  PBIREC+59(10),DUB             CD                                 
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),WORK           MOS (4)                  
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)          MOS (4)           
         MVC   PBIREC+69(4),WORK                                                
*****    GOTO1 (RF),(R1),(3,PBILDUED),PBIREC+81     DUE DATE                    
         GOTO1 (RF),(R1),(3,PBILDUED),(X'20',PBIREC+81)     DUE DATE            
*                                                                               
         LA    R1,DFPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DFX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
DFL      DS    0H                                                               
         LA    R2,DFPBIT1                                                       
         CLOSE ((2),)                                                           
         B     DFX                                                              
         SPACE 3                                                                
DFPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,          DOS BLKSIZE=00150               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         SPACE 3                                                                
         TITLE 'COMPTON'                                                        
*                                  COMPTON                                      
         SPACE 2                                                                
COMPROC  NMOD1 0,COMPROC                                                        
         L     RC,PPFILEC                                                       
*                                                                               
         BC    0,COMPR1                                                         
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (COPBIT1,(OUTPUT))                                               
*                                                                               
COMPR1   DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    COMPRL                                                           
*                                                                               
         CLI   PBILLMOD,C'S'       BYPASS EST BILLS IF PRODUCT                  
         BE    COMPRX                OR SERIES MODE                             
         CLI   PBILLMOD,C'P'       BYPASS EST BILLS IF PRODUCT                  
         BE    COMPRX                OR SERIES MODE                             
*                                  CLEAR RECORD                                 
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                  MEDIA                                        
         MVC   PBIREC(2),=C'12'    NEWS                                         
         CLI   PBILKMED,C'N'                                                    
         BE    COMPR2                                                           
         MVC   PBIREC(2),=C'16'    TRADE + SUPP                                 
         CLI   PBILKMED,C'T'                                                    
         BE    COMPR2                                                           
         MVC   PBIREC(2),=C'14'    MAG AND SUPPL                                
         CLI   PBILKMED,C'M'                                                    
         BE    COMPR2                                                           
         CLI   PBILKMED,C'S'                                                    
         BE    COMPR2                                                           
         MVC   PBIREC(2),=C'24'    OUTDOOR                                      
         CLI   PBILKMED,C'O'                                                    
         BE    COMPR2                                                           
         DC    H'0'                UNKNOWN MEDIA                                
*                                                                               
COMPR2   DS    0H                                                               
*                                  EST                                          
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+2(4),DUB                                                  
*                                                                               
         MVC   PBIREC+11(6),=20C'0'                                             
*                                  MONTH OF SERVICE                             
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,PBIREC+17)                           
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+17)                       
*                                                                               
         MVC   PBIREC+21(2),SPACES                                              
*                                  CLIENT                                       
         MVC   PBIREC+24(3),PBILKCLT                                            
*                                  PRODUCT                                      
         MVC   PBIREC+27(3),PBILKPRD                                            
*                                                                               
         MVC   PBIREC+030(03),=20C'0'                                           
         MVC   PBIREC+078(06),=20C'0'                                           
         MVC   PBIREC+091(11),=20C'0'                                           
*                                                                               
*                                  ACTUAL                                       
         ZAP   DUB,PBILLRCV                                                     
         UNPK  PBIREC+102(09),DUB                                               
*                                                                               
*                                  CASH DISC.                                   
         MVC   PBIREC+111(07),=20C'0'                                           
         CLI   PBILCDSW,C'N'       CD SUPPRESSED                                
*******  NOP   0                   ** WAS BE COMPR3 **                          
         ZAP   DUB,PPBVEBC         EFFECTIVE CD                                 
         UNPK  PBIREC+111(07),DUB                                               
*                                                                               
*                                  NET                                          
COMPR3   DS    0H                                                               
         ZAP   DUB,PBILLNET                                                     
         UNPK  PBIREC+118(09),DUB                                               
*                                                                               
*                                                                               
         MVC   PBIREC+127(9),=20C'0'                                            
         MVC   PBIREC+136(05),=20C'0'                                           
*                                  TODAY M/D/Y                                  
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),WORK                                    
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)                            
         LA    R2,WORK                                                          
         MVC   PBIREC+141(4),2(R2)                                              
         MVC   PBIREC+145(2),0(R2)                                              
*                                  INVOICE NUMBER                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+147(3),DUB                                                
*                                  ESTIMATE NAME                                
         OC    PBILKEST,PBILKEST                                                
         BZ    COMPR4                                                           
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   WORK(12),PESTKEY                                                 
         BE    COMPR3F             HAVE EST REC                                 
*                                                                               
         MVC   WORK(64),KEY                                                     
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
*                                                                               
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
COMPR3F  DS    0H                                                               
         MVC   PBIREC+150(11),PESTNAME                                          
         OC    PBIREC+150(11),SPACES                                            
*                                                                               
COMPR4   DS    0H                                                               
*                                  CLIENT NAME                                  
         MVC   PBIREC+161(16),PCLTNAME                                          
*                                                                               
*                                  WRITE RECORD                                 
         LA    R1,COPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
COMPRX   DS    0H                                                               
         XIT1                                                                   
*                                                                               
COMPRL   DS    0H                                                               
         LA    R2,COPBIT1                                                       
         CLOSE ((2),)                                                           
         B     COMPRX                                                           
*                                                                               
*                                **COMPTON DTF**                                
COPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=00200,          DOS BLKSIZE=00200               X        
               MACRF=PM                                                         
*                                                                               
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'TED BATES - GENERAL FOODS'                                      
*                                  TED BATES - GENERAL FOODS                    
         SPACE 2                                                                
TBGFOOD  NMOD1 0,TBGF                                                           
         L     RC,PPFILEC                                                       
*                                                                               
         BC    0,TBPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (TBPBIT1,(OUTPUT))                                               
*                                                                               
TBPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    TBPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'P'         SYSTEM                                       
         MVC   PBIREC+1(1),QMEDIA  MEDIA                                        
         MVC   PBIREC+3(3),PBILKCLT  CLIENT                                     
         MVC   PBIREC+6(3),PBILKPRD  PRODUCT                                    
         MVC   HALF,PBILKEST         EST                                        
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+9(3),DUB                                                  
*                                                                               
         MVI   PBIREC+12,C'B'                                                   
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),PBIREC+13   MOS (4)                     
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+13)   MOS (4)             
*                                                                               
*                                                                               
         ZAP   PBIREC+17(6),PBILLRCV   RECEIVABLE                               
         ZAP   PBIREC+23(6),PBILLGRS   GROSS                                    
         ZAP   PBIREC+29(6),PBILLNET   NET                                      
         ZAP   PBIREC+35(6),PPBVEBC    EFFECTIVE CD                             
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    TBPR2               YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
TBPR2    MVC   PBIREC+53(3),PESTNAME  FOR SALE DATE TRANSLATION                 
*                                                                               
         LA    R1,TBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
TBX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
TBPRL    DS    0H                                                               
         LA    R2,TBPBIT1                                                       
         CLOSE ((2),)                                                           
         B     TBX                                                              
*                                                                               
TBPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00060,                                            X        
               BLKSIZE=00600,          DOS BLKSIZE=00600               X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'LORD GELLER'                                                    
*                                  LORD GELLER                                  
         SPACE 2                                                                
**PROC   NMOD1 0,LGPROC                                                         
**       L     RC,PPFILEC                                                       
**                                                                              
**       BC    0,LGPR1                                                          
**       OI    *-3,X'F0'                                                        
**       GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
**       OPEN  (LGPBIT1,(OUTPUT))                                               
**                                                                              
**PR1    DS    0H                                                               
**       CLI   MODE,RUNLAST                                                     
**       BE    LGPRL                                                            
**                                                                              
**       MVI   PBIREC,C' '                                                      
**       MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
**                                                                              
**       MVI   PBIREC,C'1'                                                      
**       MVC   PBIREC+1(4),PCLTNUM   CLIENT NUMBER                              
**                                                                              
**       MVC   PBIREC+5(3),PPRDACCT+1   PRODUCT NUMBER (+1(3))                  
**       CLI   PPRDACCT,X'FF'                                                   
**       BNE   LGPR2                                                            
**       MVC   FULL,PPRDACCT                                                    
**                                                                              
**       MVI   FULL,0                                                           
**       L     R0,FULL                                                          
**       CVD   R0,DUB                                                           
**       OI    DUB+7,X'0F'                                                      
**       UNPK  WORK(5),DUB                                                      
**       MVC   PBIREC+5(3),WORK+2                                               
**                                                                              
**PR2    DS    0H                                                               
**       MVC   PBIREC+8(2),DINVNO       INVNO(2)                                
**                                                                              
**       MVC   PBIREC+10(2),=C'OM'   MEDIA IN INVOCE NUMBER                     
**       CLI   PBILKMED,C'M'                                                    
**       BE    LGPR4                                                            
**       MVC   PBIREC+10(2),=C'ON'                                              
**       CLI   PBILKMED,C'N'                                                    
**       BE    LGPR4                                                            
**       MVC   PBIREC+10(2),=C'OO'                                              
**       CLI   PBILKMED,C'O'                                                    
**       BE    LGPR4                                                            
**       MVC   PBIREC+10(2),=C'SU'                                              
**       CLI   PBILKMED,C'S'                                                    
**       BE    LGPR4                                                            
**       MVC   PBIREC+10(2),=C'OT'                                              
**       CLI   PBILKMED,C'T'                                                    
**       BE    LGPR4                                                            
**                                                                              
**PR4    DS    0H                                                               
**       MVC   HALF,PBILKBNO                                                    
**       LH    R0,HALF                                                          
**       CVD   R0,DUB                                                           
**       OI    DUB+7,X'0F'                                                      
**       UNPK  PBIREC+12(4),DUB                                                 
**                                                                              
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
**       GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
**       MVC   PBIREC+16(4),WORK+2                                              
**       MVC   PBIREC+20(2),WORK                                                
**                                                                              
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
**       GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
**       MVC   PBIREC+22(4),WORK+2                                              
**       MVC   PBIREC+26(2),WORK                                                
**                                                                              
**       MVC   PBIREC+28(2),=C'00'                                              
**       MVC   HALF,PBILKEST         EST                                        
**       LH    R0,HALF                                                          
**       CVD   R0,DUB                                                           
**       OI    DUB+7,X'0F'                                                      
**       UNPK  PBIREC+30(3),DUB                                                 
**                                                                              
**       UNPK  PBIREC+34(11),PBILLRCV   RECEIVABLE                              
**       ZAP   DUB,PPBVEBC          EFFECTIVE CD                                
**       UNPK  PBIREC+45(9),DUB                                                 
**       UNPK  PBIREC+54(11),PBILLNET   NET                                     
**                                                                              
**       ZAP   DUB,PBILLRCV           CALC COMMISSION                           
**       TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
**       BNZ   LGPR5                                                            
**       TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
**       BNZ   LGPR5                  YES                                       
**       SP    DUB,PPBVEBC            MINUS EFFECTIVE CD                        
**                                                                              
**PR5    DS    0H                                                               
**       SP    DUB,PBILLNET          RCV - NET = AC                             
**       UNPK  PBIREC+65(11),DUB                                                
**                                                                              
**       MVC   PBIREC+76(11),=11C'0'                                            
**       MVC   PBIREC+87(9),=11C'0'                                             
**       ZAP   PBIREC+96(11),PBILLGRS    GROSS                                  
**                                                                              
**       MVC   PBIREC+122(1),PCLTOFF                                            
**       MVC   PBIREC+123(3),PBILKCLT                                           
**       MVC   PBIREC+126(3),PBILKPRD                                           
**                                                                              
**       LA    R1,LGPBIT1                                                       
**       LA    R0,PBIREC                                                        
**       PUT   (1),(0)                                                          
**                                                                              
**X      DS    0H                                                               
**       XIT1                                                                   
**                                                                              
**PRL    DS    0H                                                               
**       LA    R2,LGPBIT1                                                       
**       CLOSE ((2),)                                                           
**       B     LGX                                                              
**                                                                              
**PBIT1  DCB   DDNAME=P10TAPE,                                                  
**             DSORG=PS,                                                        
**             RECFM=FB,                                                        
**             LRECL=00135,                                                     
**             BLKSIZE=00135,                                                   
**             MACRF=PM                                                         
**       SPACE 2                                                                
**       LTORG                                                                  
         TITLE 'DONER SHUR PEPPLER'                                             
*                                  DONER                                        
         SPACE 2                                                                
DAPROC   NMOD1 0,DAPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    DAPR1                                                            
*                                                                               
         BC    0,DAPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (DAPBIT1,(OUTPUT))                                               
*                                                                               
DAPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    DAPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC(8),=CL8'DETROIT'                                          
         CLI   PCLTOFF,C'1'                                                     
         BE    DAP2                                                             
         MVC   PBIREC(8),=CL8'MONTREAL'                                         
         CLI   PCLTOFF,C'9'                                                     
         BE    DAP2                                                             
         MVC   PBIREC(8),=CL8'TORONTO'                                          
         CLI   PCLTOFF,C'7'                                                     
         BE    DAP2                                                             
         MVC   PBIREC(8),=CL8'OTHER  '                                          
         MVC   P(35),=C'** INVALID OFFICE ** - SET TO OTHER'                    
         GOTO1 REPORT                                                           
*                                                                               
DAP2     DS    0H                                                               
*                                                                               
         MVC   PBIREC+8(2),=C'PI'                                               
         CLI   PBILKMED,C'I'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PM'                                               
         CLI   PBILKMED,C'M'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PN'                                               
         CLI   PBILKMED,C'N'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PO'                                               
         CLI   PBILKMED,C'O'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PS'                                               
         CLI   PBILKMED,C'S'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PT'                                               
         CLI   PBILKMED,C'T'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PL'                                               
         CLI   PBILKMED,C'L'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PB'                                               
         CLI   PBILKMED,C'B'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PV'                                               
         CLI   PBILKMED,C'V'                                                    
         BE    DAPR4                                                            
         MVC   PBIREC+8(2),=C'PW'                                               
         CLI   PBILKMED,C'W'                                                    
         BE    DAPR4                                                            
         DC    H'0'          UNKNOWN MEDIA                                      
*                                                                               
DAPR4    DS    0H                                                               
         MVC   PBIREC+10(2),DINVNO                                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+12(4),DUB                                                 
*                                                                               
**OLD**  MVC   PBIREC+18(5),=C'00000'                                           
         MVC   PBIREC+17(6),=C'000000'                                          
         MVC   BYTE,PCLTNUM                                                     
         NI    BYTE,X'F0'                                                       
         CLI   BYTE,X'80'       SEE IF INTERFACE CODE IS IN                     
         BE    DAPR6            SPECIAL FORMAT                                  
         MVC   P(36),=C'** INVALID/MISSING INTERFACE CODE **'                   
**OLD**  MVC   P+40(12),=C'SET TO 00000'                                        
         MVC   P+40(13),=C'SET TO 000000'                                       
         GOTO1 REPORT                                                           
*                                                                               
DAPR6    DS    0H                                                               
         XC    FULL,FULL                                                        
         MVC   FULL+1(3),PCLTNUM                                                
         NI    FULL+1,X'7F'      SET OFF X'80 BIT                               
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
**OLD**  UNPK  PBIREC+18(5),DUB                                                 
         UNPK  PBIREC+17(5),DUB                                                 
         MVI   PBIREC+22,C'0'           ADD ZERO TO END                         
*                                                                               
         MVC   PBIREC+23(2),PPRDACCT    FIRST 2 BYTES OF PPRDACCT               
*                                                                               
         MVC   PBIREC+25(3),PBILKCLT                                            
         MVC   PBIREC+28(3),PBILKPRD                                            
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
         MVC   PBIREC+34(6),WORK                                                
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
         MVC   PBIREC+40(6),WORK                                                
*                                                                               
*                                                                               
         UNPK  PBIREC+52(11),PBILLGRS   GROSS                                   
         UNPK  PBIREC+63(11),PBILLRCV   RECEIVABLE                              
         ZAP   DUB,PPBVEBC              EFFECTIVE CD                            
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         AP    DOUBLE,DUB             ADD CD TO GET NET                         
         UNPK  PBIREC+74(11),DOUBLE     NET                                     
*                                                                               
* CHANGE MADE 4/23/02                                                           
         ZAP   DUB,=P'0'                                                        
         UNPK  PBIREC+113(11),DUB                                               
*                                                                               
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,PBIREC+85)                           
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+85)                       
         MVC   PBIREC+89(2),=C'01'                SET DAY TO 01                 
*                                                                               
         UNPK  PBIREC+91(11),MYGST                                              
*                                                                               
*****    ZAP   DUB,=P'0'                                                        
*****    UNPK  PBIREC+102(11),DUB       SALES TAX - SET TO ZERO                 
*                                                                               
         UNPK  PBIREC+102(11),MYHST        HST                                  
         SP    MYPST,MYHST             REMOVE HST INCLUDED IN PST TOTAL         
*                                                                               
         UNPK  PBIREC+124(11),MYPST        QST                                  
         AP    MYPST,MYHST             ADD BACK HST FOR TOTALS                  
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   DAPUT                                                            
         CP    DACOUNT,=P'50'                                                   
         BH    DAPUT                                                            
         AP    DACOUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(11),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,5,0                                     
         GOTO1 REPORT                                                           
         B     *+6                                                              
DACOUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
DAPUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    DAX                                                              
*                                                                               
         LA    R1,DAPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DAX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
DAPRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    DAX                                                              
*                                                                               
         LA    R2,DAPBIT1                                                       
         CLOSE ((2),)                                                           
         B     DAX                                                              
*                                                                               
DAPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00135,                                            X        
               BLKSIZE=00135,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
         TITLE 'KETCHUM ADVERTISING'                                            
         SPACE 2                                                                
KETCH    NMOD1 0,KETCH                                                          
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    KETR1                                                            
*                                                                               
         BC    0,KETR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (KETBIT1,(OUTPUT))                                               
*                                                                               
KETR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    KETRL                                                            
*                                                                               
         MVC   WORK(12),PBILLREC    MUST READ ESTIMATE FOR NAME                 
         MVI   WORK+3,X'07'                                                     
         CLC   PESTREC(12),WORK                                                 
         BE    KETR3                                                            
         MVC   WORK(64),KEY          SAVE PPG'S KEY AND KEYSAVE                 
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,X'07'                                                      
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
KETR3    DS    0H                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVI   PBIREC+256,C' '                                                  
         MVC   PBIREC+257(21),PBIREC+256                                        
*                                                                               
         MVC   PBIREC(3),PCLTKCLT                                               
*                                                                               
         MVC   PBIREC+6(2),=C'CM'          CONSUMER MAGS                        
         CLI   PBILKMED,C'M'                                                    
         BE    KETR3D                                                           
         MVC   PBIREC+6(2),=C'NP'          NEWSPAPERS                           
         CLI   PBILKMED,C'N'                                                    
         BE    KETR3D                                                           
         MVC   PBIREC+6(2),=C'TP'          TRADE                                
         CLI   PBILKMED,C'T'                                                    
         BE    KETR3D                                                           
         MVC   PBIREC+6(2),=C'OD'          OUTDOOR                              
         CLI   PBILKMED,C'O'                                                    
         BE    KETR3D                                                           
         MVC   PBIREC+6(2),=C'SP'        SUPPLEMENTS  - JUST IN CASE            
         CLI   PBILKMED,C'S'                                                    
         BE    KETR3D                                                           
         MVC   PBIREC+6(2),SPACES         UNKNOWN MEDIA                         
*                                                                               
KETR3D   DS    0H                                                               
*                                                                               
         CLC   PBILKAGY,=C'KA'          SEE IF KETCHAM                          
         BNE   KETR3F                                                           
         CLI   PCLTOFF,C'J'             SEE IF OFFICE J                         
         BNE   KETR3F                                                           
         MVC   PBIREC+10(2),=C'65'      ORGANIZATION - KJNY                     
*                                                                               
KETR3F   MVC   PBIREC+14(3),PBILKPRD                                            
*                                                                               
KETR4    DS    0H                                                               
         MVC   PBIREC+17(2),DINVNO                                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+19(4),DUB                                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'14',WORK)   INV DATE                 
         MVC   PBIREC+23(8),WORK       (HAS CENTURY)                            
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,PBIREC+31)                           
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+31)                       
         MVC   PBIREC+35(2),SPACES                                              
*                                                                               
         MVC   PBIREC+60+1(1),PCLTOFF                                           
*                                                                               
         UNPK  PBIREC+66(10),PBILLRCV   RECEIVABLE                              
         ZAP   DUB,PPBVEBC           EFFECTIVE CD                               
         UNPK  PBIREC+86(10),DUB                                                
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         AP    DOUBLE,DUB             ADD CD TO GET NET                         
         UNPK  PBIREC+76(10),DOUBLE     NET                                     
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'14',WORK)      DUE DATE              
         MVC   PBIREC+104(8),WORK   INCLUDES CENTURY                            
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+120(3),DUB                                                
*                                                                               
         MVC   PBIREC+180(20),PESTNAME                                          
*                                                                               
         MVC   PBIREC+243(4),PCLTNUM                                            
         CLI   PCLTNUM,X'FF'                                                    
         BNE   KETR5                                                            
         UNPK  WORK(5),PCLTNUM+1(3)                                             
         MVC   PBIREC+243(4),WORK+1       INTERFACE CODE                        
         B     KETR6                                                            
*                                                                               
KETR5    DS    0H                                                               
         MVC   BYTE,PCLTNUM                                                     
         NI    BYTE,X'F0'                                                       
         CLI   BYTE,X'80'                                                       
         BNE   KETR6                                                            
         XC    FULL,FULL                                                        
         MVC   FULL+1(3),PCLTNUM                                                
         NI    FULL+1,X'7F'        SET OFF X'80' BIT                            
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+243(4),DUB                                                
*                                                                               
KETR6    DS    0H                                                               
         MVC   PBIREC+247(4),PPRDACCT                                           
*                                                                               
         CLI   PPRDACCT,X'FF'  SEE IF CONVERSION M/B DONE                       
         BNE   KETR9           NO CONVERSION // NO PRODUCT                      
         MVI   DUB,0                                                            
         MVC   DUB+1(3),PPRDACCT+1                                              
         L     RF,DUB                                                           
         CVD   RF,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+247(4),DUB                                                
KETR9    DS    0H                                                               
         CLC   QAGENCY,=C'KA'      ONLY FOR KETCHUM                             
         BNE   KETR10X                                                          
         CLC   PCLTKCLT,=C'PH '                                                 
         BE    KETR10                                                           
         CLC   PCLTKCLT,=C'PHD'                                                 
         BNE   KETR10C                                                          
*                                                                               
KETR10   MVC   PBIREC+247(2),PNBMGR2+1   LAST 2 DIGITS OF DISTRICT              
         B     KETR10X                   IS FOLLOWED BY LAST DIGITS             
*                                        OF NORMAL PRD ACCOUNT NUMBER           
*                                                                               
KETR10C  CLC   PCLTKCLT,=C'AHR'        SPECIAL FOR ACURA                        
         BNE   KETR10X                                                          
         MVC   PBIREC+247(2),PNBMGR1+1   LAST 2 DIGITS OF REGION                
*                                      FOLLOWED BY LAST DIGITS OF PRD           
*                                      ACCOUNT NUMBER                           
*                                                                               
*                                                                               
KETR10X  DS    0H                                                               
         MVC   PBIREC+240(3),=C'DDS'                                            
         MVC   PBIREC+264(2),=C'SI'                                             
         CP    PBILLRCV,=P'0'                                                   
         BNL   *+10                                                             
         MVC   PBIREC+264(2),=C'CI'                                             
*                                                                               
         MVC   PBIREC+266(1),PBILKMED                                           
*                                                                               
         ZAP   DUB,PBILLRCV           CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   KETR12                                                           
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   KETR12                 YES                                       
         SP    DUB,PPBVEBC            MINUS EFFECTIVE CD                        
*                                                                               
KETR12   DS    0H                                                               
         SP    DUB,PBILLNET          RCV - NET = AC                             
         UNPK  PBIREC+268(10),DUB                                               
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   KETUT                                                            
         CP    KECOUNT,=P'50'                                                   
         BH    KETUT                                                            
         AP    KECOUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(130),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(130),PBIREC+130                                                
         GOTO1 REPORT                                                           
         MVC   P(18),PBIREC+260                                                 
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+260,P,18,0                                    
         GOTO1 REPORT                                                           
         B     *+6                                                              
KECOUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
KETUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'        TEST RUN - NO TAPE                             
         BE    KETX                                                             
*                                                                               
         LA    R1,KETBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
KETX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
KETRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'           TEST RUN - NO TAPE                          
         BE    KETX                                                             
*                                                                               
         LA    R2,KETBIT1                                                       
         CLOSE ((2),)                                                           
         B     KETX                                                             
*                                                                               
KETBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00278,                                            X        
               BLKSIZE=00278,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
         TITLE 'Y && R'                                                         
*                                  Y & R                                        
         SPACE 2                                                                
YNPROC   NMOD1 0,YNPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         BC    0,YNPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (YNPBIT1,(OUTPUT))                                               
*                                                                               
YNPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    YNPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC+1(2),DINVNO       INVNO(2)                                
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+3(4),DUB                                                  
*                                                                               
         MVI   PBIREC+7,C'0'                                                    
         MVC   PBIREC+8(4),PPRDACCT     CLIENT NO. (= PRD NUM)                  
         CLI   PPRDACCT,X'FF'                                                   
         BNE   YNPR2                                                            
         MVC   FULL,PPRDACCT                                                    
*                                                                               
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
         MVC   PBIREC+7(5),WORK                                                 
*                                                                               
YNPR2    DS    0H                                                               
         MVC   PBIREC+12(3),=C'000'  DIVISION = 000                             
         MVI   PBIREC+15,C'0'                                                   
*                                                                               
         MVC   PBIREC+16(2),PPRDNAME  PRD NUMBER= NAME(2)                       
         MVI   PBIREC+18,C'R'                                                   
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),WORK   MOS                              
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)   MOS                      
         MVC   PBIREC+19(2),WORK+2             MM                               
         MVC   PBIREC+21(2),WORK               YY                               
*                                                                               
         MVC   PBIREC+23(1),PBILKMED  MEDIA                                     
         CLI   PBILKMED,C'T'       BUT TRADE=D                                  
         BNE   *+8                                                              
         MVI   PBIREC+23,C'D'                                                   
         MVC   PBIREC+24(3),PBILKCLT  CLIENT                                    
         MVC   PBIREC+27(3),PBILKPRD  PRODUCT                                   
         MVC   HALF,PBILKEST         EST                                        
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+30(3),DUB                                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
         MVC   PBIREC+33(4),WORK+2                                              
         MVC   PBIREC+37(2),WORK                                                
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
         MVC   PBIREC+39(4),WORK+2                                              
         MVC   PBIREC+43(2),WORK                                                
*                                                                               
         ZAP   DUB,PBILLRCV        RECEIVABLE                                   
         TM    PBILBASA,X'04'      IS CD ALREADY TAKEN OUT                      
         BZ    YNPR4                                                            
         AP    DUB,PPBVEBC         ADD EFFECTIVE CD                             
*                                                                               
YNPR4    DS    0H                                                               
         UNPK  PBIREC+45(9),DUB                                                 
         ZAP   DUB,PPBVEBC           EFFECTIVE CD                               
         UNPK  PBIREC+54(9),DUB                                                 
         AP    DUB,PBILLNET          NET PLUS CD                                
         UNPK  PBIREC+63(9),DUB                                                 
         MVC   PBIREC+72(9),=9C'0'                                              
*                                                                               
         MVC   PBIREC+84(4),=9C'0'                                              
         MVC   PBIREC+88(2),=9C'0'                                              
*                                                                               
         LA    R4,=C'161'          MEDIA CODES                                  
         CLI   QMEDIA,C'N'                                                      
         BE    YNPR6                                                            
         LA    R4,=C'171'                                                       
         CLI   QMEDIA,C'M'                                                      
         BE    YNPR6                                                            
         LA    R4,=C'181'                                                       
         CLI   QMEDIA,C'T'                                                      
         BE    YNPR6                                                            
         LA    R4,=C'191'                                                       
         CLI   QMEDIA,C'S'                                                      
         BE    YNPR6                                                            
         LA    R4,=C'291'                                                       
         CLI   QMEDIA,C'O'                                                      
         BE    YNPR6                                                            
         DC    H'0'          UNKNOWN MEDIA                                      
*                                                                               
YNPR6    DS    0H                                                               
         MVC   PBIREC+90(3),0(R4)                                               
*                                                                               
         LA    R1,YNPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
YNX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
YNPRL    DS    0H                                                               
         LA    R2,YNPBIT1                                                       
         CLOSE ((2),)                                                           
         B     YNX                                                              
*                                                                               
YNPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00093,                                            X        
               BLKSIZE=00093,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
         TITLE 'HAVAS - PHILLIPS'                                               
*                                                                               
PHPROC   NMOD1 0,PHPROC                                                         
*                                                                               
         L     RC,PPFILEC                                                       
*                                                                               
         BC    0,PHPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (PHPBIT1,(OUTPUT))                                               
*                                                                               
PHPR1    CLI   MODE,RUNLAST             RUNLAST?                                
         BE    PHPRL                    YES                                     
*                                                                               
         LA    RE,PBIREC               RE = PBIREC                              
         LHI   R1,400                  R1 = 400                                 
         LA    RF,1(RE)                RF = LAST BYTE OF TPREC                  
         MVI   0(RE),C' '              INIT T0 A SPACE                          
         MOVE  ((RF),(R1)),(RE)        INIT TPREC TO SPACES                     
*                                                                               
         CLI   PHHDSW,C'Y'             HEADER ALREADY WRITTEN TO TAPE?          
         BE    PH0PR02                 YES                                      
*                                                                               
         LA    R2,PBIREC               R2 = TAPE RECORD LINE TO OPUTPUT         
         LA    R3,PHEADTAB             HEADLINE TABLE                           
         XR    R4,R4                   CLEAR R4                                 
*                                                                               
PH0PR00  IC    R4,0(R3)                ENTRY LENGTH                             
         BCTR  R4,0                    -1 FOR EX                                
         EX    R4,*+8                  EXECUTE MVC                              
         B     *+10                    FOR IDF                                  
         MVC   0(0,R2),1(R3)           HEADLINE                                 
         LA    R3,2(R3,R4)             BUMP TO NEXT HEADLINE                    
         CLI   0(R3),X'FF'             END OF TABLE?                            
         BE    PH0PR01                 YES - NO DELIMITER ON LAST ENTRY         
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
         B     PH0PR00                 PROCESS NEXT ENTRY                       
*                                                                               
PH0PR01  BAS   RE,PHTAPE               PUT PBIREC TO TAPE                       
*                                                                               
         LA    RE,PBIREC               RE = PBIREC                              
         LHI   R1,400                  R1 = 400                                 
         LA    RF,1(RE)                RF = LAST BYTE OF TPREC                  
         MVI   0(RE),C' '              INIT T0 A SPACE                          
         MOVE  ((RF),(R1)),(RE)        INIT TPREC TO SPACES                     
*                                                                               
         MVI   PHHDSW,C'Y'             FLAG HEADER WRITTEN TO TAPE              
*                                                                               
PH0PR02  LA    R2,PBIREC               R2 = TAPE RECORD LINE TO OPUTPUT         
*                                                                               
         MVC   0(2,R2),=C'CR'          CREDIT INVOICE                           
         CP    PBILLGRS,=P'0'          INVOICE AMOUNT NEGATIVE?                 
         BL    *+10                    YES                                      
         MVC   0(3,R2),=C'INV'         STANDARD INVOICE                         
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVC   0(1,R2),PBILKMED        MEDIA                                    
         MVC   1(6,R2),DINVNO          BILL INVOICE NUMBER                      
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         GOTO1 DATCON,DMCB,PBILLDAT,(10,0(R2))                                  
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         LA    R3,PESTREC+33           A(ESTIMATE RECORD)                       
         USING PESTUDEF,R3             ESTIMATE UDEF DSECT                      
         MVI   MELCODE,X'08'           USER ELEMENT                             
         BAS   RE,NXTEL                HAVE ESTIMATE UDEF?                      
         BNE   *+16                    NO                                       
         MVC   0(L'PEUSER1,R2),PEUSER1 EST UDEF1 = PO NUMBER                    
         OC    0(L'PEUSER1,R2),SPACES  SPACE PAD IN CASE BINARY ZEROS           
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
         DROP  R3                      DROP ESTIMATE RECORD USING               
*                                                                               
         MVC   0(4,R2),=C'OB10'        BILL TO CUSTOMER ID NUMBER               
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVC   0(11,R2),=C'HAVAS MEDIA'     SHIP TO NAME                        
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVC   0(13,R2),=C'200 HUDSON ST'   SHIP TO ADDRESS                     
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVC   0(08,R2),=C'NEW YORK'   SHIP TO CITY                             
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVC   0(02,R2),=C'NY'         SHIP TO STATE                            
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVC   0(05,R2),=C'10013'      SHIP TO ZIP CODE                         
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         LA    R3,PESTREC+33           A(ESTIMATE RECORD)                       
         USING PESTUDEF,R3             ESTIMATE UDEF DSECT                      
         MVI   MELCODE,X'08'           USER ELEMENT                             
         BAS   RE,NXTEL                HAVE ESTIMATE UDEF?                      
         BNE   *+16                    NO                                       
         MVC   0(L'PEUSER1,R2),PEUSER1 EST UDEF1 = PO NUMBER                    
         OC    0(L'PEUSER1,R2),SPACES  SPACE PAD IN CASE BINARY ZEROS           
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
         DROP  R3                      DROP ESTIMATE RECORD USING               
*                                                                               
         LA    R3,PESTREC+33           A(ESTIMATE RECORD)                       
         USING PESTELEM,R3             ESTIMATE ELEM DSECT                      
         MVI   MELCODE,X'07'           EST ELEMENT                              
         BAS   RE,NXTEL                HAVE ESTIMATE ELEM?                      
         BNE   *+16                    NO                                       
         MVC   0(20,R2),PESTNAME       EST NAME                                 
         OC    0(20,R2),SPACES         SPACE PAD IN CASE BINARY ZEROS           
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
         DROP  R3                      DROP ESTIMATE RECORD USING               
*                                                                               
         EDIT  PBILLRCV,(13,0(R2)),2,ZERO=NOBLANK,ALIGN=LEFT,MINUS=YES          
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         MVI   0(R2),C'1'              QUANTITY                                 
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         EDIT  PBILLRCV,(13,0(R2)),2,ZERO=NOBLANK,ALIGN=LEFT,MINUS=YES          
         BAS   RE,FINDLST              FIND END AND SET DELIMITER               
*                                                                               
         LA    R3,PPRDREC+33           PRODUCT RECORD                           
         USING PPRDUDEF,R3             PRODUCT UDEF ELEMENT DSECT               
         MVI   MELCODE,X'08'           PRODUCT UDEF ELEMENT                     
         BRAS  RE,NXTEL                HAVE PRODUCT UDEF?                       
         BNE   *+16                    NO                                       
         MVC   0(32,R2),PUSER1         PRODUCT UDEF 1 (EMAIL ADDRESS)           
         OC    0(32,R2),SPACES         SPACE PAD IN CASE BINARY ZEROS           
         DROP  R3                      DROP PRODUCT RECORD USING                
*                                                                               
         BAS   RE,PHTAPE               PUT PBIREC TO TAPE                       
*                                                                               
PHPRX    J     EXIT                    EXIT                                     
         DROP  R7                      DROP BILL RECORD USING                   
*                                                                               
PHPRL    LA    R2,PHPBIT1              DCB                                      
         CLOSE ((2),)                  CLOSE TAPE                               
         B     PHPRX                   EXIT                                     
*                                                                               
NXTEL    DS    0H                      LOCAL NEXTEL USING R3                    
         XR    R0,R0                   CLEAR R0                                 
*                                                                               
NXTEL1   CLI   0(R3),0                 END OF RECORD?                           
         BE    NXTELX                  YES - RETURN CC NEQ                      
         CLC   0(1,R3),MELCODE         FOUND THE ELEMENT WE WANT?               
         BER   RE                      YES - RETRUN CC EQU                      
         ICM   R0,1,1(R3)              ELEMENT LENGTH                           
         BZ    NXTELX                  IF ZERO, EXIT                            
         AR    R3,R0                   BUMP TO NEXT ELEMENT                     
         B     NXTEL1                  NO - LOOK FOR NEXT ELEM                  
*                                                                               
NXTELX   LTR   RE,RE                   NOT FOUND - RETURN CC NEQ                
         BR    RE                      RETURN                                   
*                                                                               
FINDLST  LA    R2,PBIREC+400            PAST END OF DATA                        
         CLI   0(R2),X'40'             HAVE DATA HERE?                          
         BH    *+8                     YES - DELIMITER GOES 1 AFTER             
         BCT   R2,*-8                  NO - GO BACK 1 CHAR & TRY AGAIN          
         MVI   1(R2),C','              DELIMITER                                
         LA    R2,2(R2)                BUMP R2                                  
         BR    RE                      RETURN                                   
*                                                                               
PHTAPE   NTR1                                                                   
*                                                                               
         CLI   QOPT7,C'Y'              PRINTING TRACE?                          
         BNE   PHTAPE10                NO                                       
*                                                                               
         LHI   R0,400                  YES                                      
         GOTO1 =V(PRNTBL),DMCB,0,PBIREC,C'DUMP',(R0),=C'1D'                     
*                                                                               
PHTAPE10 LA    R1,PHPBIT1              DCB                                      
         LA    R0,PBIREC               RECORD                                   
         PUT   (1),(0)                 PUT RECORD TO TAPE                       
*                                                                               
         J     EXIT                    RETURN                                   
*                                                                               
PHEADTAB DC   X'13',C'INVOICE CREDIT NOTE'                                      
         DC   X'0E',C'INVOICE NUMBER'                                           
         DC   X'0C',C'INVOICE DATE'                                             
         DC   X'15',C'PURCHASE ORDER NUMBER'                                    
         DC   X'1A',C'BILL TO CUSTOMER ID NUMBER'                               
         DC   X'0C',C'SHIP TO NAME'                                             
         DC   X'0F',C'SHIP TO ADDRESS'                                          
         DC   X'0C',C'SHIP TO CITY'                                             
         DC   X'0D',C'SHIP TO STATE'                                            
         DC   X'10',C'SHIP TO ZIP CODE'                                         
         DC   X'09',C'PO NUMBER'                                                
         DC   X'0B',C'DESCRIPTION'                                              
         DC   X'0A',C'UNIT PRICE'                                               
         DC   X'07',C'QUANITY'                                                  
         DC   X'11',C'TOTAL LINE AMOUNT'                                        
         DC   X'0D',C'EMAIL ADDRESS'                                            
         DC   X'FF'                                                             
*                                                                               
PHPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00400,                                            X        
               BLKSIZE=00400,                                          X        
               MACRF=PM                                                         
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'WUNDERMAN'                                                      
****                                                                            
****     CODE UNUSED - AGENCY NOT ACTIVE                                        
****                                                                            
*                                  WUNDERMAN                                    
WWPROC   NMOD1 0,WWPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'          FOR TESTING - NO TAPE                        
         BE    WWPR1                                                            
*                                                                               
         BC    0,WWPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (WWPBIT1,(OUTPUT))                                               
*                                                                               
WWPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    WWPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC+1(2),DINVNO       INVNO(2)                                
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+3(4),DUB                                                  
*                                                                               
         MVI   PBIREC+7,C'4'                                                    
         MVC   PBIREC+8(4),PPRDACCT     CLIENT NO. (= PRD NUM)                  
         CLI   PPRDACCT,X'FF'                                                   
         BNE   WWPR2                                                            
         MVC   FULL,PPRDACCT                                                    
*                                                                               
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
         MVC   PBIREC+7(5),WORK                                                 
*                                                                               
WWPR2    DS    0H                                                               
*                                                                               
         MVC   PBIREC+12(6),PPRDNAME  PRD NUMBER= NAME(6)                       
         MVI   PBIREC+18,C'R'                                                   
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),WORK   MOS                              
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)   MOS                      
         MVC   PBIREC+19(2),WORK+2             MM                               
         MVC   PBIREC+21(2),WORK               YY                               
*                                                                               
         MVC   HALF,PBILKEST         EST                                        
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+23(3),DUB                                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
         MVC   PBIREC+33(4),WORK+2                                              
         MVC   PBIREC+37(2),WORK                                                
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
         MVC   PBIREC+39(4),WORK+2                                              
         MVC   PBIREC+43(2),WORK                                                
*                                                                               
         ZAP   DUB,PBILLRCV        RECEIVABLE                                   
         TM    PBILBASA,X'04'      IS CD ALREADY TAKEN OUT                      
         BZ    WWPR4                                                            
         AP    DUB,PPBVEBC         RE-ADD EFFECTIVE CD                          
*                                                                               
WWPR4    DS    0H                                                               
         UNPK  PBIREC+45(9),DUB                                                 
         ZAP   DUB,PPBVEBC           NOW USE EFFECTIVE CD                       
         UNPK  PBIREC+54(9),DUB                                                 
         AP    DUB,PBILLNET          NET PLUS CD                                
         UNPK  PBIREC+63(9),DUB                                                 
         MVC   PBIREC+72(9),=9C'0'                                              
*                                                                               
         MVC   PBIREC+84(4),=9C'0'                                              
         MVC   PBIREC+88(2),=9C'0'                                              
*                                                                               
         LA    R4,=C'010'          MEDIA CODES                                  
         CLI   QMEDIA,C'N'                                                      
         BE    WWPR6                                                            
         LA    R4,=C'070'                                                       
         CLI   QMEDIA,C'M'                                                      
         BE    WWPR6                                                            
         LA    R4,=C'070'                                                       
         CLI   QMEDIA,C'T'                                                      
         BE    WWPR6                                                            
         LA    R4,=C'350'                                                       
         CLI   QMEDIA,C'O'                                                      
         BE    WWPR6                                                            
         LA    R4,=C'999'   UNKNOWN - THEY CLAIM THEY DON'T HAVE                
*                                     SUPPLEMENTS                               
WWPR6    DS    0H                                                               
         MVC   PBIREC+90(3),0(R4)                                               
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   WWPUT                                                            
         CP    WWCOUNT,=P'50'                                                   
         BH    WWPUT                                                            
         AP    WWCOUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(93),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,28,0                                     
         GOTO1 REPORT                                                           
         B     *+6                                                              
WWCOUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
WWPUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    WWX                                                              
*                                                                               
         LA    R1,WWPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
WWX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
WWPRL    DS    0H                                                               
         LA    R2,WWPBIT1                                                       
         CLOSE ((2),)                                                           
         B     WWX                                                              
*                                                                               
WWPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00093,                                            X        
               BLKSIZE=00093,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         TITLE 'OGILVY MATHER'                                                  
*                                  O & M                                        
         SPACE 2                                                                
OMPROC   NMOD1 0,OMPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         BC    0,OMPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (OMPBIT1,(OUTPUT))                                               
*                                                                               
OMPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    OMPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC+0,C'X'                                                    
         MVC   PBIREC+1(1),PCLTOFF      OFFICE                                  
*                                                                               
         MVI   PBIREC+2,C'3'       NEWSPAPER                                    
         CLI   PBILKMED,C'N'                                                    
         BE    OMPR1D                                                           
         MVI   PBIREC+2,C'7'       OUTDOOR                                      
         CLI   PBILKMED,C'O'                                                    
         BE    OMPR1D                                                           
         MVI   PBIREC+2,C'4'       MAGAZINE                                     
         CLI   PBILKMED,C'M'                                                    
         BE    OMPR1D                                                           
         MVI   PBIREC+2,C'5'       TRADE                                        
         CLI   PBILKMED,C'T'                                                    
         BE    OMPR1D                                                           
         MVI   PBIREC+2,C'6'       SUPPLEMENTS                                  
         CLI   PBILKMED,C'S'                                                    
         BE    OMPR1D                                                           
         DC    H'0'                                                             
*                                                                               
OMPR1D   DS    0H                                                               
         MVC   PBIREC+3(3),PBILKCLT     CLIENT                                  
         MVC   PBIREC+6(3),PBILKPRD     PRODUCT                                 
*                                                                               
         MVC   PBIREC+9(4),PPRDACCT      PRD NUM                                
         CLI   PPRDACCT,X'FF'                                                   
         BNE   OMPR2                                                            
         MVC   FULL,PPRDACCT                                                    
*                                                                               
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(4),DUB                                                      
         MVC   PBIREC+9(4),WORK                                                 
*                                                                               
OMPR2    DS    0H                                                               
         MVC   PBIREC+13(20),PPRDNAME                                           
         MVC   PBIREC+33(2),DINVNO       INVNO(2)                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+35(4),DUB                                                 
*                                                                               
         MVC   HALF,PBILKEST         EST                                        
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+39(4),DUB                                                 
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    OMPR4               YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
OMPR4    DS    0H                                                               
         MVC   PBIREC+43(3),PESTGRPS    ESTIMATE FILTERS                        
         OC    PBIREC+43(3),SPACES                                              
         MVC   PBIREC+46(20),PESTNAME   ESTIMATE NAME                           
         MVC   PBIREC+66(20),PESTNAM2   NAME 2                                  
         OC    PBIREC+46(40),SPACES                                             
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),WORK   MOS                              
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)   MOS                      
         MVC   PBIREC+86(2),WORK+2             MM                               
         MVC   PBIREC+88(2),WORK               YY                               
*                                                                               
         ZAP   DUB,PBILLRCV        RECEIVABLE                                   
         TM    PBILBASA,X'04'      IS CD ALREADY TAKEN OUT                      
         BZ    OMPR4D                                                           
         AP    DUB,PPBVEBC        ADD EFFECTIVE CD                              
*                                                                               
OMPR4D   DS    0H                                                               
         UNPK  PBIREC+90(12),DUB                                                
         MVC   PBIREC+102(12),=12C'0'                                           
         ZAP   DUB,PPBVEBC           EFFECTIVE CD                               
         UNPK  PBIREC+114(12),DUB                                               
         ZAP   DUB,PBILLRCV           CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   OMPR5                                                            
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   OMPR5                  YES                                       
         SP    DUB,PPBVEBC            MINUS EFFECTIVE CD                        
*                                                                               
OMPR5    DS    0H                                                               
         SP    DUB,PBILLNET          RCV - NET = AC                             
         UNPK  PBIREC+126(12),DUB                                               
         MVC   PBIREC+138(12),=12C'0'                                           
         UNPK  PBIREC+150(12),PBILLNET   NET                                    
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK) INVOICE DATE                   
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK) INVOICE DATE               
         MVC   PBIREC+162(2),WORK+2                                             
         MVC   PBIREC+164(2),WORK+4                                             
         MVC   PBIREC+166(2),WORK+0                                             
*                                                                               
         MVC   PBIREC+228(12),PBRACCT   RETAIL ACCT                             
         OC    PBIREC+228(12),SPACES                                            
*                                                                               
         MVC   PBIREC+240(2),RCDATE+00   MM                                     
         MVC   PBIREC+242(2),RCDATE+03   DD                                     
         MVC   PBIREC+244(2),RCDATE+06   YY                                     
         TM    PBILCMSW,X'20'      TEST AOR BILL                                
         BZ    *+8                                                              
         MVI   PBIREC+252,C'A'                                                  
         TM    PBILCMSW,X'10'      TEST AOR CLIENT BILL                         
         BZ    *+8                                                              
         MVI   PBIREC+252,C'C'                                                  
*                                                                               
         LA    R1,OMPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
OMX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
OMPRL    DS    0H                                                               
         LA    R2,OMPBIT1                                                       
         CLOSE ((2),)                                                           
         B     OMX                                                              
*                                                                               
OMPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00256,                                            X        
               BLKSIZE=00256,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
         SPACE 2                                                                
* *******************************************************************           
H9PROC   NMOD1 0,H9PROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         BC    0,H9PR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (H9PBIT1,(OUTPUT))                                               
*                                                                               
H9PR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    H9PRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         CLI   TAPTYP,C'P'                                                      
         BE    PM01                                                             
*        CODE FOR OTHER AGENCIES                                                
*                                                                               
PM01     DS    0H                                                               
PM       USING PM50,PBIREC+4                                                    
*                                                                               
         TM    PBILCMSW,B'00100000'                                             
         BO    H9X                                                              
         MVC   PBIREC(4),=X'004F0000'                                           
         MVC   PM.PM50VEN,=C'310771'                                            
*                                                                               
         MVC   PM.PM50MED,=C'PN'       NEWSPAPER                                
         CLI   PBILKMED,C'N'                                                    
         BE    H9PR1D                                                           
         MVC   PM.PM50MED,=C'OD'       OUTDOOR                                  
         CLI   PBILKMED,C'O'                                                    
         BE    H9PR1D                                                           
         MVC   PM.PM50MED,=C'PM'       MAGAZINE OR T OR S                       
*                                                                               
H9PR1D   DS    0H                                                               
         MVI   PM.PM50TYP,C'C'                                                  
         MVC   PM.PM50RTP,=C'50'                                                
         MVC   PM.PM50INV(1),DINVFULL                                           
         MVC   PM.PM50INV+1(7),DINVFULL+2                                       
         MVC   PM.PM50FLL,SPACES                                                
*                                                                               
*                                                                               
H9PR2    DS    0H                                                               
*                                                                               
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    H9PR4               YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
H9PR4    DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   H9PR4C                                                           
         MVC   PM.PM50EST(1),=C'0'                                              
         MVC   PM.PM50EST+1(1),PEUSER2                                          
         MVC   PM.PM50EST+2(1),=C'-'                                            
         MVC   PM.PM50EST+3(2),PM.PM50MED                                       
         MVC   PM.PM50EST+5(1),=C'-'                                            
         CLI   PEUSER2+4,C'X'                                                   
         BE    H9X                                                              
         MVC   PM.PM50EST+6(4),PEUSER2                                          
         B     H9PR4D                                                           
*                                                                               
         DROP  R2                                                               
H9PR4C   DC    H'0'                                                             
*                                                                               
H9PR4D   DS    0H                                                               
*                                                                               
         ZAP   PM.PM50CGA,PBILLGRS        CGA- CASH GROSS AMOUNT                
         SP    PM.PM50CGA,PBILLBIL        CGA- CASH GROSS AMOUNT                
         AP    PM.PM50CGA,PBILLRCV        CGA- CASH GROSS AMOUNT                
*                                                                               
         ZAP   PM.PM50CDS,PBILLGRS        CDS- CASH DISCOUNT                    
         SP    PM.PM50CDS,PBILLBIL                                              
*                                                                               
         ZAP   PM.PM50NCA,PBILLNET        NCA- NET COST AMOUNT                  
         AP    PM.PM50NCA,PM.PM50CDS                                            
*                                                                               
         TM    PBILCMSW,B'00010000'                                             
         BO    H9PR6                                                            
*                                                                               
         ZAP   PM.PM50NCD,=P'0'                                                 
         ZAP   PM.PM50PSF,=P'0'                                                 
*                                                                               
H9PR5    DS    0H                                                               
         LA    R1,H9PBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
* CODE FOR 55 REC                                                               
*                                                                               
         MVC   PM.PM50RTP,=C'55'                                                
*                                                                               
         LA    R2,PPRDREC+33                                                    
*                                                                               
         MVI   MELCODE,X'30'                                                    
         BAS   RE,NEXTEL2                                                       
         BNE   *+20                                                             
         OC    2(3,R2),2(R2)                                                    
         BZ    *+10                                                             
         MVC   PM.PM50FLL+6(3),2(R2)                                            
*                                                                               
         LA    R1,H9PBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
         B     H9X                                                              
MTDATE   DS    CL6                                                              
H9PR6    DS    0H                                                               
*                                                                               
         MVC   MTDATE,PBILLDAT                                                  
*                                                                               
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
H9PR6A   DS    0H                                                               
         GOTO1 SEQ                                                              
         GOTO1 GETBILL                                                          
         CLC   KEY(16),WORK                                                     
         BE    *+6                                                              
         DC    H'0'                                                             
         GOTO1 HIGH                                                             
*                                                                               
         CLC   MTDATE,PBILLDAT                                                  
         BNE   H9PR6A                                                           
*                                                                               
         TM    PBILCMSW,B'00100000'                                             
         BZ    H9PR6A                                                           
*                                                                               
         ZAP   PM.PM50NCD,PBILLRCV                                              
         ZAP   PM.PM50PSF,PM.PM50CGA                                            
         SP    PM.PM50PSF,PM.PM50NCA                                            
         AP    PM.PM50PSF,PM.PM50NCD                                            
         MP    PM.PM50PSF,=P'-1'                                                
*        CLC   PM.PM50INV(8),=C'M23-0239'                                       
*        BNE   *+6                                                              
*        DC    H'0'                                                             
         B     H9PR5                                                            
H9X      DS    0H                                                               
         XIT1                                                                   
*                                                                               
H9PRL    DS    0H                                                               
         LA    R2,H9PBIT1                                                       
         CLOSE ((2),)                                                           
         DROP  PM                                                               
         B     H9X                                                              
*                                                                               
NEXTEL2  DS    0H                                                               
         ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTEL2X                                                         
         CLC   0(1,R2),MELCODE                                                  
         BER   RE                                                               
         B     NEXTEL2                                                          
*                                                                               
NEXTEL2X LTR   RE,RE       NOT FOUND -                                          
         BR    RE                                                               
*                                                                               
*                                                                               
*                                                                               
H9PBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=VB,                                               X        
               LRECL=00408,                                            X        
               BLKSIZE=04084,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
         SPACE 2                                                                
         TITLE 'J WALTER THOMPSON'                                              
*                                  JWT                                          
         SPACE 2                                                                
JWT      NMOD1 0,JWPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
JWPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    JWPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC+0,C'1'    CLIENT BILLING                                  
*                                                                               
**                              FOR NON-NUMERIC INTERFACE CODES                 
         MVC   PBIREC+1(2),=C'93'                                               
         MVC   PBIREC+3(2),PCLTNUM                                              
         CLI   PCLTNUM,X'FF'                                                    
         BNE   JWPR1B                                                           
         UNPK  PBIREC+1(5),PCLTNUM+1(3)   INTERFACE CODE                        
         MVI   PBIREC+5,C' '               CLEAR                                
*                                                                               
JWPR1B   DS    0H                                                               
         CLC   PCLTKCLT,=C'WL '   SEE IF CLIENT IS WL                           
         BE    JWPR1B5                                                          
         CLI   PCLTKMED,C'O'    SEE IF OUTDOOR                                  
         BNE   JWPR1B8                                                          
         CLC   PCLTKCLT,=C'FCP'   SPECIAL FOR CLIENT FCP                        
         BNE   JWPR1B8                                                          
*                                                                               
JWPR1B5  LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   JWPR1B8        IF NOT FOUND LEAVE PCLTNUM INFO ALONE             
         MVC   PBIREC+1(4),PUSER1                                               
*                                                                               
         DROP  R2                                                               
*                                                                               
JWPR1B8  DS    0H                                                               
         CLI   PPRDACCT,255    SEE IF CONVERSION M/B DONE                       
         BNE   NOBINAC         NO CONVERSION // NO PRODUCT                      
         MVI   DUB,0                                                            
         MVC   DUB+1(3),PPRDACCT+1                                              
         L     RF,DUB                                                           
         CVD   RF,DUB                                                           
         OI    DUB+7,15                                                         
         UNPK  PBIREC+5(3),DUB+6(2)                                             
NOBINAC  DS    0H                                                               
*                                                                               
*                                                                               
*                                                                               
         MVC   PBIREC+8(2),DINVNO      INVOICE NO - MONTH                       
*******                           NOTE THAT DINVNO MIGHT HAVE                   
*******                           BEEN ADJUSTED BY B1XPROF                      
*     MEDIA CODE                                                                
         MVC   PBIREC+10(1),PBILKMED                                            
         CLI   PBILKMED,C'S'      IF SUPPLEMENTS                                
         BNE   *+8                                                              
         MVI   PBIREC,C'N'        CHANGE TO NEWSPAPERS                          
         B     JWPR1D                                                           
*                                                                               
*        OTHERWISE LEAVE AS NORMAL CODE                                         
*                                                                               
*                                                                               
JWPR1D   DS    0H                                                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+12(4),DUB                                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK) INVOICE DATE                   
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK) INVOICE DATE               
         MVC   PBIREC+16(4),WORK+2  DATE BILLED MMDD                            
         MVC   PBIREC+20(2),WORK   DATE BILLED YY                               
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK) DATE DUE                       
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK) DATE DUE                   
         MVC   PBIREC+22(4),WORK+2    MMDD                                      
         MVC   PBIREC+26(2),WORK+0    YY                                        
*                                                                               
         MVC   HALF,PBILKEST            ESTIMATE NUMBER                         
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+28(6),DUB                                                 
*                                                                               
         CLI   PBILSEP,C'C'         SEE IF CD SEPERATE BILL                     
         BNE   JWPR3                                                            
         ZAP   PBIREC+34(11),=P'0'                                              
*                                                                               
         ZAP   DUB,PBILLRCV                                                     
         CVB   R0,DUB                                                           
         LCR   R0,R0                 REVERSE SIGN OF CD                         
         CVD   R0,DUB                                                           
*                                                                               
         ZAP   PBIREC+45(9),DUB                                                 
         ZAP   PBIREC+54(11),PBILLRCV                                           
         ZAP   PBIREC+65(11),=P'0'                                              
         MVC   PBIREC+76(11),=11C'0'  TIME OF STAFF                             
         ZAP   PBIREC+87(9),=P'0'    AOR FEE                                    
         MVC   PBIREC+96(3),=C'000'                                             
         B     JWPR10                                                           
*                                                                               
JWPR3    DS    0H                                                               
         TM    PBILCMSW,X'20'   SEE IF AOR BILL                                 
         BNO   JWPR4                                                            
         MVI   PBIREC+0,C'4'                                                    
         MVC   PBIREC+5(3),=C'088'     SET PRODUCT TO 088 FOR AOR               
         ZAP   PBIREC+87(9),PBILLRCV                                            
         ZAP   PBIREC+34(11),=P'0'                                              
         ZAP   PBIREC+45(9),=P'0'                                               
         ZAP   PBIREC+54(11),=P'0'                                              
         ZAP   PBIREC+65(11),=P'0'                                              
         B     JWPR10                                                           
*                                                                               
JWPR4    DS    0H                                                               
         ZAP   WORK(5),PPBVEBC                EFFECTIVE CD                      
*                                                                               
         ZAP   PBIREC+45(9),=P'0'                                               
         CLI   PBILCDSW,C'S'                   SEE IF CD IS                     
         BE    *+10                            SEPERATE INVOICE                 
         ZAP   PBIREC+45(9),WORK(5)            CD                               
**                THEIR 'GROSS' = RECIEVABLE (+CD IF BILL FORMULA               
**                                TOOK IT OUT)                                  
         ZAP   PBIREC+34(11),PBILLRCV                                           
         TM    PBILBASA,X'04'           WAS CD TAKEN OUT                        
         BNO   *+10                                                             
         AP    PBIREC+34(11),WORK(5)           ADD IT BACK                      
         ZAP   PBIREC+54(11),PBILLNET               NET                         
**                                                                              
         CLI   PBILCDSW,C'S'                   SEE IF CD IS                     
         BNE   *+10                            SEPERATE INVOICE                 
         AP    PBIREC+54(11),WORK(5)           RE-ADD CD                        
**                                                                              
         ZAP   DUB,PBILLRCV           CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   JWPR5                                                            
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   JWPR5                  YES                                       
         SP    DUB,PBIREC+45(9)      NO- TAKE OUT NOW                           
*                             NOTE THAT THIS IS USING "ALTERED" CD              
*                                                                               
JWPR5    DS    0H                                                               
         SP    DUB,PBIREC+54(11)                                                
         ZAP   PBIREC+65(11),DUB+3(5)                                           
*                                                                               
**                THEIR 'GROSS' = CD + COST + REVENUE                           
*                                                                               
****     ZAP   PBIREC+34(11),PBIREC+65(11)   REVENUE                            
****     AP    PBIREC+34(11),PBIREC+45(9)    +CD                                
****     AP    PBIREC+34(11),PBIREC+54(11)   +NET/NET                           
         MVC   PBIREC+76(11),=11C'0'  TIME OF STAFF                             
         ZAP   PBIREC+87(9),=P'0'    AOR FEE                                    
         MVC   PBIREC+96(3),=C'000'                                             
*                                                                               
JWPR10   CLI   QOPT7,C'Y'                                                       
         BNE   JWLAR1                                                           
         CP    COUNT,=P'50'                                                     
         BH    JWLAR1                                                           
         AP    COUNT,=P'1'                                                      
         MVC   P(18),=C'***BILLING RECORD'                                      
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,60,0                                      
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+60,P,60,0                                   
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,60,0                                        
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+60,P,60,0                                     
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         B     *+6                                                              
COUNT    DC    PL2'0'                                                           
*                                                                               
*                                                                               
*                                                                               
JWLAR1   DS    0H                                                               
*                                                                               
*  AT THIS POINT MUST ADD TAPE RECORD TO TABLE AND IF THERE IS A                
*   DUPLICATE ADD THEM TOGETHER                                                 
*       CREATE KEY                                                              
*                                                                               
         MVC    JWTMED,PBILKMED                                                 
         MVC    JWTCLI,PBILKCLT                                                 
         MVC    JWTPRO,PBILKPRD                                                 
         MVC    JWTEST,PBILKEST                                                 
         MVC    JWTINVMO,PBILKBMN+1    BILLING MONTH                            
         MVC    JWTINVN,PBILKBNO                                                
*                                                                               
         MVC    JWTREC,PBIREC                                                   
*                                                                               
         L      R2,AOFJWTT        ADDRESS OF JWTTAB                             
         PRINT  GEN                                                             
         GOTO1 =V(BINSRCH),BINVALS                                              
         PRINT  NOGEN                                                           
*                                                                               
         CLI    BINVALS,1          RECORD INSERTED                              
         BE     GOTOXIT                                                         
         OC     BINVALS+1(3),BINVALS+1 IF ZERO TABLE IS FULL                    
         BNZ    *+6                                                             
         DC     H'0'                                                            
*                                                                               
*   HAVE DUPLICATE MUST ADD FIELDS                                              
*                                                                               
         L       RF,BINVALS               ADDRESS OF FOUND RECORD               
         LA      RF,L'JWTKEY(RF)          PAST KEY                              
         AP      45(9,RF),PBIREC+45(9)     CD                                   
         AP      34(11,RF),PBIREC+34(11)     GROSS                              
         AP      54(11,RF),PBIREC+54(11)                                        
         AP      65(11,RF),PBIREC+65(11)                                        
         AP      87(9,RF),PBIREC+87(9)      AOR FEE                             
*                                                                               
GOTOXIT  DS    0H                                                               
         MVC   BINVALS,=A(JWTMED)                                               
         MVI   BINVALS,1                                                        
         XIT1                                                                   
*                                                                               
JWPRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    JWPRL5                                                           
*                                                                               
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (JWPBIT1,(OUTPUT))                                               
JWPRL5   DS    0H                                                               
         L     R2,JWTRECNT         FOR BCT    RECORD COUNT                      
         CH    R2,=H'0'            NO RECORDS                                   
         BE    ZEROCNT                                                          
         L     R3,AOFJWTT                                                       
         LA    R3,L'JWTKEY(R3)     BUMP PAST PSUEDO KEY                         
JWTAGN   MVC   JWTKEY(9),45(R3)                                                 
         UNPK  45(9,R3),JWTKEY(9)                                               
         TM    53(R3),X'D0'        CHECK IF NEGATIVE                            
         BO    *+8                                                              
         OI    53(R3),X'F0'        POSITIVE                                     
         MVC   JWTKEY(11),34(R3)                                                
         UNPK  34(11,R3),JWTKEY(11)                                             
         TM    44(R3),X'D0'        CHECK IF NEGATIVE                            
         BO    *+8                                                              
         OI    44(R3),X'F0'        POSITIVE                                     
         MVC   JWTKEY(11),54(R3)                                                
         UNPK  54(11,R3),JWTKEY(11)                                             
         TM    64(R3),X'D0'        CHECK IF NEGATIVE                            
         BO    *+8                                                              
         OI    64(R3),X'F0'        POSITIVE                                     
         MVC   JWTKEY(11),65(R3)                                                
         UNPK  65(11,R3),JWTKEY(11)                                             
         TM    75(R3),X'D0'        CHECK IF NEGATIVE                            
         BO    *+8                                                              
         OI    75(R3),X'F0'        POSITIVE                                     
*                                    CHK FOR AOR BILL REMOVED                   
         MVC   JWTKEY(9),87(R3)                                                 
         UNPK  87(9,R3),JWTKEY(9)                                               
         TM    95(R3),X'D0'        CHECK IF NEGATIVE                            
         BO    *+8                                                              
         OI    95(R3),X'F0'        POSITIVE                                     
**NEW 1/12/89                                                                   
JWTAGN5  DS    0H                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    JWTAGN7                                                          
*                                                                               
         LA    R1,JWPBIT1                                                       
         PUT   (1),(3)                                                          
*                                                                               
JWTAGN7  DS    0H                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   BINGO                                                            
         CP    COUNT,=P'100'                                                    
         BH    BINGO                                                            
         AP    COUNT,=P'1'                                                      
         MVC   P(14),=C'***OUTPUT     '                                         
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,(R3),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,60(R3)                                                        
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
BINGO    LA    R3,147(R3)   TO NEXT RECORD IN TABLE                             
         BCT   R2,JWTAGN                                                        
*                                                                               
ZEROCNT  DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'       TEST RUN - NO TAPE                              
         BE    ZEROX                                                            
*                                                                               
         LA    R2,JWPBIT1                                                       
         CLOSE ((2),)                                                           
ZEROX    B     GOTOXIT                                                          
*                                                                               
JWPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00135,                                            X        
               BLKSIZE=00540,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*EXTEL   DS    0H                                                               
*        ZIC   R0,1(R2)                                                         
*        AR    R2,R0                                                            
*        CLI   0(R2),0                                                          
*        BE    NEXTELX                                                          
*        CLC   0(1,R2),MELCODE                                                  
*        BER   RE                                                               
*        B     NEXTEL                                                           
*                                                                               
*EXTELX  LTR   RE,RE       NOT FOUND - SET CC NOT EQUAL                         
*        BR    RE                                                               
*                                                                               
BINVALS  DS    0F                                                               
         DC    X'01'              ADD RECORD                                    
         DC    AL3(JWTMED)        RECORD TO BE ADDED                            
         DC    A(JWTTABLE)        ADDRESS OF TABLE WHERE REC IS TO BE           
JWTRECNT DC    F'0'               NUMBER OF RECORDS ADDED                       
         DC    F'147'             LEN OF RECORD                                 
         DC    F'12'              KEY SIZE                                      
         DC    F'2000'            MAX NUMBER OF RECORDS                         
*                                                                               
AOFJWTT  DC    A(JWTTABLE)                                                      
JWTKEY   DS    0XL12                                                            
JWTMED   DS    CL1                                                              
JWTCLI   DS    CL3                                                              
JWTPRO   DS    CL3                                                              
JWTEST   DS    XL2                                                              
JWTINUMB DS    0XL3                                                             
JWTINVMO DS    XL1           INVOICE MONTH                                      
JWTINVN  DS    XL2           INVOICE NUMBER                                     
*            ______                                                             
*              12                                                               
JWTREC   DS    CL135                                                            
ENDJWTR  DS    0C                                                               
***********************                                                         
         TITLE 'TRACY LOCK - NEW'                                               
*                                  TRACY LOCK                                   
         SPACE 2                                                                
TLPROC   NMOD1 0,TRAP                                                           
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,TLC2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (TLPBIT1,(OUTPUT))                                               
*                                                                               
TLC2     DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    TLCL                                                             
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'B'         PRINT                                        
         MVC   PBIREC+1(6),=6C'0'  CLIENT NUMBER                                
         CLI   PCLTNUM,C' '                                                     
         BNH   *+10                                                             
         MVC   PBIREC+3(4),PCLTNUM                                              
         MVI   PBIREC+7,C'3'       ALL MEDIA EXCEPT OUTDOOR                     
         CLI   QMEDIA,C'O'                                                      
         BNE   *+8                                                              
         MVI   PBIREC+7,C'4'                                                    
*                                                                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+8(4),DUB          INV NO.                                 
         MVC   PBIREC+87(2),DINVNO                                              
*                                                                               
         UNPK  PBIREC+26(10),PBILLGRS     GROSS                                 
         UNPK  PBIREC+44(10),PBILLNET     NET                                   
         ZAP   DUB,PPBVEBC               EFFECTIVE CD                           
         UNPK  PBIREC+36(8),DUB          =CD                                    
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+54(3),DUB                                                 
*                                  SPECIAL MEDIA CODES                          
         MVI   PBIREC+57,C'1'      NEWSPAPER                                    
         CLI   QMEDIA,C'N'                                                      
         BE    TLC8                                                             
         MVI   PBIREC+57,C'2'      MAGAZINE                                     
         CLI   QMEDIA,C'M'                                                      
         BE    TLC8                                                             
         MVI   PBIREC+57,C'3'      TRADE                                        
         CLI   QMEDIA,C'T'                                                      
         BE    TLC8                                                             
         MVI   PBIREC+57,C'4'      SUPPLEMENTS                                  
         CLI   QMEDIA,C'S'                                                      
         BE    TLC8                                                             
         MVI   PBIREC+57,C'5'      OUTDOOR                                      
         CLI   QMEDIA,C'O'                                                      
         BE    TLC8                                                             
         DC    H'0'                UNKNOWN MEDIA                                
*                                                                               
TLC8     DS    0H                                                               
         MVI   PBIREC+58,C'8'      REGULAR BILLS                                
         TM    PBILCMSW,X'02'                                                   
         BZ    *+8                                                              
         MVI   PBIREC+58,C'9'      COMMISSION ONLY BILLS                        
*                                                                               
         LA    R1,TLPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
TLCX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
TLCL     DS    0H                                                               
         LA    R2,TLPBIT1                                                       
         CLOSE ((2),)                                                           
         B     TLCX                                                             
         SPACE 2                                                                
TLPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=02000,                                          X        
               MACRF=PM                                                         
         SPACE 3                                                                
         LTORG                                                                  
***********************                                                         
         TITLE 'TRACY LOCK - OLD'                                               
*                                  TRACY LOCK                                   
         SPACE 2                                                                
TRAPROC  NMOD1 0,TRAP                                                           
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,TRAC2                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (TRPBIT1,(OUTPUT))                                               
*                                                                               
TRAC2    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    TRACL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'P'         PRINT                                        
         MVC   PBIREC+1(1),QMEDIA                                               
         MVC   PBIREC+2(3),PBILKCLT                                             
         MVC   PBIREC+5(4),PCLTNUM                                              
         MVC   PBIREC+9(20),PCLTNAME                                            
         MVC   PBIREC+29(3),PBILKPRD                                            
*                                                                               
         MVC   PBIREC+32(4),PPRDACCT                                            
         CLI   PPRDACCT,X'FF'                                                   
         BNE   TRAC2C                                                           
         MVC   FULL,PPRDACCT                                                    
*                                                                               
         MVI   FULL,0                                                           
         L     R0,FULL                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  WORK(5),DUB                                                      
         MVC   PBIREC+32(4),WORK+1                                              
*                                                                               
TRAC2C   DS    0H                                                               
         MVC   PBIREC+36(20),PPRDNAME                                           
*                                  EST                                          
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+56(3),DUB                                                 
*                                                                               
*                                  ESTIMATE NAME                                
         OC    PBILKEST,PBILKEST                                                
         BZ    TRAC3                                                            
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   WORK(12),PESTKEY                                                 
         BE    TRAC2D              HAVE EST REC                                 
*                                                                               
         MVC   WORK(64),KEY                                                     
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
*                                                                               
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
TRAC2D   DS    0H                                                               
         MVC   PBIREC+59(20),PESTNAME                                           
*                                                                               
TRAC3    DS    0H                                                               
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+89(4),DUB          INV NO.                                
         MVC   PBIREC+87(2),DINVNO                                              
*                                                                               
*****    MVC   PBIREC+93(6),PBILLDAT                                            
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(X'20',PBIREC+93)  RUN DATE             
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),PBIREC+99                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),PBIREC+105                              
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),WORK           MOS (4)                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',PBIREC+99)                       
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',PBIREC+105)                      
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)          MOS (4)           
         MVC   PBIREC+111(4),WORK                                               
*                                                                               
         UNPK  PBIREC+115(12),PBILLGRS    GROSS                                 
         UNPK  PBIREC+127(12),PBILLNET    NET-NET                               
         UNPK  PBIREC+139(12),PBILLRCV    ACTUAL                                
*                                                                               
         LA    R1,TRPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
TRACX    DS    0H                                                               
         XIT1                                                                   
*                                                                               
TRACL    DS    0H                                                               
         LA    R2,TRPBIT1                                                       
         CLOSE ((2),)                                                           
         B     TRACX                                                            
         SPACE 2                                                                
TRPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=02000,                                          X        
               MACRF=PM                                                         
         SPACE 3                                                                
         LTORG                                                                  
         TITLE 'WESTERN'                                                        
*                                  WESTERN TAPE                                 
         SPACE 2                                                                
WIPROC   NMOD1 0,WIPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    WIPR1                                                            
*                                                                               
         BC    0,WIPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (WIPBIT1,(OUTPUT))                                               
*                                                                               
WIPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    WIPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(50),SPACES     SINCE RECORD NOW 300 BYTES             
*                                                                               
WIP2     DS    0H                                                               
*                                                                               
         MVC   PBIREC(1),PCLTOFF                                                
*                                                                               
         MVC   PBIREC+1(2),=C'PM'                                               
         CLI   PBILKMED,C'M'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PN'                                               
         CLI   PBILKMED,C'N'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PO'                                               
         CLI   PBILKMED,C'O'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PS'                                               
         CLI   PBILKMED,C'S'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PT'                                               
         CLI   PBILKMED,C'T'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PL'                                               
         CLI   PBILKMED,C'L'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PI'                                               
         CLI   PBILKMED,C'I'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PB'                                               
         CLI   PBILKMED,C'B'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PV'                                               
         CLI   PBILKMED,C'V'                                                    
         BE    WIPR4                                                            
         MVC   PBIREC+1(2),=C'PW'                                               
         CLI   PBILKMED,C'W'                                                    
         BE    WIPR4                                                            
         DC    H'0'      UNKNOWN MEDIA                                          
*                                                                               
WIPR4    DS    0H                                                               
*                                                                               
         MVC   PBIREC+3(3),PBILKCLT                                             
         MVC   PBIREC+6(20),PCLTNAME                                            
*                                                                               
         MVC   PBIREC+36(3),PBILKPRD                                            
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+39(3),DUB        ESTIMATE                                 
*                                                                               
         MVC   PBIREC+45(20),PESTNAME                                           
*                                                                               
         MVC   PBIREC+80(2),DINVNO                                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+82(4),DUB                                                 
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
         MVC   PBIREC+90(6),WORK                                                
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
         MVC   PBIREC+96(6),WORK                                                
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,PBIREC+102) MTH OF SERV              
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',PBIREC+102) MTH OF SERV          
*                                                                               
         UNPK  PBIREC+106(09),PBILLRCV  RECEIVABLE                              
         ZAP   DUB,PPBVEBC              EFFECTIVE CD                            
         UNPK  PBIREC+115(09),DUB                                               
*                                                                               
         L     R0,PPBVETAX              PPBVETAX IS BINARY                      
         CVD   R0,DUB                                                           
         UNPK  PBIREC+124(09),DUB       SALES TAX - U.S.                        
*                                                                               
         UNPK  PBIREC+133(09),MYGST        GST                                  
*                                                                               
         UNPK  PBIREC+142(09),MYPST        QST                                  
*                                                                               
         MVC   PBIREC+151(2),PBILKAGY                                           
*                                                                               
         ZAP   DUB,PBILLNET             NET/NET                                 
         UNPK  PBIREC+153(09),DUB       (NET-CD)                                
*                                                                               
         CLI   RETAIL,C'Y'                SEE IF RETAIL BILL                    
         BNE   WPR4E                                                            
         MVC   PBIREC+162(12),PBRACCT     RETAIL ACCOUNT                        
         OC    PBIREC+162(12),SPACES                                            
*                                                                               
WPR4E    DS    0H                                                               
         TM    PBILCMSW,X'20'          SEE IF AOR BILL                          
         BZ    WPR4G                                                            
         GOTO1 =A(GETAOR)                                                       
         MVC   PBIREC+191(30),WORK     AOR NAME LINE 1                          
*                                                                               
WPR4G    DS    0H                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   WIPUT                                                            
         CP    WICOUNT,=P'50'                                                   
         BH    WIPUT                                                            
         AP    WICOUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(124),PBIREC+124                                          
         GOTO1 REPORT                                                           
         MVC   P(52),PBIREC+248                                                 
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+260,P,40,0                                    
         GOTO1 REPORT                                                           
         B     *+6                                                              
WICOUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
WIPUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    WIX                                                              
*                                                                               
         LA    R1,WIPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
WIX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
WIPRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    WIX                                                              
*                                                                               
         LA    R2,WIPBIT1                                                       
         CLOSE ((2),)                                                           
         B     WIX                                                              
*                                                                               
WIPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00174,              *** WAS 300 12/10/98 ***      X        
               BLKSIZE=00174,            *** WAS 300 12/10/98 ***      X        
               MACRF=PM                                                         
         LTORG                                                                  
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                  WESTERN TAPE 2                               
*                                                                               
*  NOTE RECORD LENGTH IS 426 BUT RECORD AREA(PBIREC+34+200) IS 500              
*                                                                               
         SPACE 2                                                                
WIPROC2  NMOD1 0,WIPROC2                                                        
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    W2PR1                                                            
*                                                                               
         BC    0,W2PR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (W2PBIT1,(OUTPUT))                                               
*                                                                               
W2PR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    W2PRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(250),PBIREC       SINCE RECORD NOW 500 BYTES          
*                                                                               
W2P2     DS    0H                                                               
*                                                                               
W2       USING WID,PBIREC                                                       
         MVC   W2.WIOFFICE,PCLTOFF                                              
         MVI   W2.WISYSTEM,C'P'                                                 
         MVC   W2.WIMEDIA,PCLTKMED                                              
         MVC   W2.WICLICOD,PCLTKCLT                                             
         MVC   W2.WICLINAM,PCLTNAME                                             
         MVC   W2.WIPRDCOD,PPRDKPRD                                             
         MVC   W2.WIAGENCY,PPRDKAGY                                             
         MVC   W2.WIINVNUM,DINVNO                                               
*                                                                               
         MVC   HALF,PBILKEST         EST                                        
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  W2.WIESTNUM,DUB                                                  
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',W2.WIINVDAT)                     
         MVC   W2.WIARDAT,W2.WIINVDAT                                           
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',W2.WIDUEDAT)                     
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',W2.WIMONSER)                     
         CLI   PBRETAIL,X'01'                                                   
         BE    YESRET                                                           
         CLI   PBRETAIL,X'02'                                                   
         BE    YESRET                                                           
         B     NONRET                                                           
YESRET   DS    0H                                                               
         MVC   W2.WIRETAIL,PBRACCT                                              
*                                                                               
NONRET   DS    0H                                                               
         EDIT  (P6,PBILLGRS),W2.WIGROSS,FILL=0                                  
         CP    PBILLGRS,=P'0'                                                   
         BNL   *+8                                                              
         MVI   W2.WIGROSS,C'-'                                                  
*                                                                               
         EDIT  (P6,PBILLNET),W2.WINET,FILL=0                                    
         CP    PBILLNET,=P'0'                                                   
         BNL   *+8                                                              
         MVI   W2.WINET,C'-'                                                    
*                                                                               
         EDIT  (P6,PPBVBACT),W2.WIACTBAM,FILL=0                                 
         CP    PPBVBACT,=P'0'                                                   
         BNL   *+8                                                              
         MVI   W2.WIACTBAM,C'-'                                                 
*                                                                               
         EDIT  (P6,PPBVBC),W2.WICASH,FILL=0                                     
         CP    PPBVBC,=P'0'                                                     
         BNL   *+8                                                              
         MVI   W2.WICASH,C'-'                                                   
*                                                                               
         EDIT  PPBVETAX,W2.WITAX,FILL=0                                         
         TM    PPBVETAX,X'80'                                                   
         BZ    *+8                                                              
         MVI   W2.WITAX,C'-'                                                    
*                                                                               
         EDIT  PPBVGST,W2.WIGST,FILL=0                                          
         TM    PPBVGST,X'80'                                                    
         BZ    *+8                                                              
         MVI   W2.WIGST,C'-'                                                    
*                                                                               
         EDIT  PPBVPST,W2.WIPST,FILL=0                                          
         TM    PPBVPST,X'80'                                                    
         BZ    *+8                                                              
         MVI   W2.WIPST,C'-'                                                    
*                                                                               
         ZAP   DUB,PPBVBACT        G-CD                                         
         SP    DUB,PBILLNET        - (G-AC-CD) = AC                             
         EDIT  (P8,DUB),W2.WIAGYCOM,FILL=0                                      
         CP    DUB,=P'0'                                                        
         BNL   *+8                                                              
         MVI   W2.WIAGYCOM,C'-'                                                 
*                                                                               
         MVC   W2.WIPRDDES,PPRDNAME                                             
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'                LOOK FOR USER ELEMENT               
         BRAS  RE,NEXTELM                                                       
         BNE   W2P3                                                             
         MVC   W2.WIUDEFP1,PUSER1                                               
         MVC   W2.WIUDEFP2,PUSER2                                               
*                                                                               
         DROP  R2                                                               
*                                                                               
W2P3     DS    0H                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    W2P4                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
W2P4     DS    0H                                                               
         MVC   W2.WIESTNAM,PESTNAME                                             
*                                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   W2P5                                                             
         MVC   W2.WIUDEFE1,PEUSER1                                              
         MVC   W2.WIUDEFE2,PEUSER2                                              
*                                                                               
         DROP  R2                                                               
*                                                                               
W2P5     DS    0H                                                               
*                                                                               
         CLI   PCLTNUM,X'FF'       CHECK IF FIRST BYTE IS 'FF'                  
         BNE   W2P6                IF YES THEN NEXT TWO BYTES                   
*                                  ARE PACKED DEC WITHOUT SIGN                  
         SR    R4,R4                                                            
         ICM   R4,3,PCLTNUM+1                                                   
         SLL   R4,4                SHIFT 4 TO THE LEFT                          
         O     R4,=X'0000000C'     INSERT C AT THE END                          
         EDIT  (P4,(R4)),W2.WICLTNUM                                            
         B     W2P8                                                             
*                                                                               
W2P6     DS    0H                                                               
         MVC   BYTE,PCLTNUM                                                     
         NI    BYTE,X'F0'          SET OFF LOWER HALF BYTE BITS                 
         CLI   BYTE,X'80'          ONLY X'80' WILL BE LEFT ON                   
         BNE   W2P7                IN THIS FORMAT                               
         XC    FULL,FULL                                                        
         MVC   FULL+1(3),PCLTNUM                                                
         NI    FULL+1,X'7F'        SET OFF X'80' IN FULL                        
         EDIT  FULL,W2.WICLTNUM                                                 
         B     W2P8                                                             
*                                                                               
W2P7     DS    0H                                                               
         MVC   W2.WICLTNUM(3),PCLTNUM                                           
*                                                                               
W2P8     DS    0H                                                               
*                                                                               
         LA    RF,TYPETAB                                                       
*                                                                               
W2P9     DS    0H                                                               
         CLI   0(RF),0                                                          
         BE    W2P12               NOT FOUND                                    
         CLI   PBILLTYP,C'0'       SEE IF OLD TYPE                              
         BH    W2P10                                                            
         CLC   0(2,RF),PBILLTYP    FOR NEW MATCH 2 CHARS                        
         BE    W2P12                                                            
         B     W2P11                                                            
*                                                                               
W2P10    CLC   0(1,RF),PBILLTYP                                                 
         BE    W2P12                                                            
W2P11    LA    RF,5(RF)                                                         
         B     W2P9                                                             
*                                                                               
W2P12    MVC   W2.WIBILLTP,2(RF)                                                
*        DC    H'0'                                                             
         OC    PBIREC(L'SPACES),SPACES                                          
         OC    PBIREC+131(L'SPACES),SPACES                                      
         OC    PBIREC+263(L'SPACES),SPACES                                      
         OC    PBIREC+395(105),SPACES                                           
*                                                                               
*                                                                               
         DROP  W2                                                               
*                                                                               
W2PUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BNE   W2PUTX                                                           
         LHI   R0,500        500 BYTES                                          
         GOTO1 =V(PRNTBL),DMCB,0,PBIREC,C'DUMP',(R0),=C'1D'                     
         B     W2X                                                              
*                                                                               
W2PUTX   LA    R1,W2PBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
W2X      DS    0H                                                               
         XIT1                                                                   
*                                                                               
W2PRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    W2X                                                              
*                                                                               
         LA    R2,W2PBIT1                                                       
         CLOSE ((2),)                                                           
         B     W2X                                                              
*********************************************************************           
*                                                                               
TYPETAB  DC    C'1 ',C'MAN'                                                     
         DC    C'3 ',C'ORG'                                                     
         DC    C'4 ',C'DET'                                                     
         DC    C'B4',C'B4 '                                                     
         DC    C'B5',C'B5 '                                                     
         DC    C'B6',C'B6 '                                                     
         DC    C'B7',C'B7 '                                                     
         DC    C'M4',C'M4 '                                                     
         DC    C'M5',C'M5 '                                                     
         DC    C'M6',C'M6 '                                                     
         DC    C'M7',C'M7 '                                                     
         DC    C'R4',C'R4 '        FINANCIAL REBATE BILLS                       
         DC    C'R5',C'R5 '                                                     
         DC    C'R6',C'R6 '                                                     
         DC    C'R7',C'R7 '                                                     
         DC    X'FF41',C'S  '      RETAIL SUMMARY BILLS                         
         DC    X'FF81',C'C  '      RETAIL CONTROL BILLS                         
         DC    X'FE00',C'AOR'      AOR BILLS                                    
         DC    X'0000',C'UNK'                                                   
*                                                                               
*********************************************************************           
W2PBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00500,              *** WAS 300 12/10/98 ***      X        
               BLKSIZE=05000,            *** WAS 300 12/10/98 ***      X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *         
*                                                                               
         TITLE 'AMMIRATTI - DATATRAK FORMAT'                                    
*                                                                               
         SPACE 2                                                                
PUPROC   NMOD1 0,PUPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    PUPR1                                                            
*                                                                               
         BC    0,PUPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (PUPBIT1,(OUTPUT))                                               
*                                                                               
PUPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    PUPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
*        FIRST 23 BYTES ARE SPACES                                              
*                                                                               
PUPR4    DS    0H                                                               
*****    MVC   HALF,PBILKBNO                                                    
*****    LH    R0,HALF                                                          
*****    CVD   R0,DUB                                                           
*****    OI    DUB+7,X'0F'                                                      
*****    UNPK  PBIREC+24(5),DUB     INVOICE NUMBER (THEY NEED 5 BYTES)          
*                                                                               
         MVC   PBIREC+23(6),DINVNO  INVOICE NUMBER (THEY NEED 6 BYTES)          
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
         MVC   PBIREC+29(2),WORK+2       MM                                     
         MVC   PBIREC+31(2),WORK+4       DD                                     
         MVC   PBIREC+33(2),WORK         YY                                     
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
         MVC   PBIREC+35(2),WORK+2       MM                                     
         MVC   PBIREC+37(2),WORK+4       DD                                     
         MVC   PBIREC+39(2),WORK         YY                                     
*                                                                               
         CLC   QAGENCY,=C'G7'      "GSTX" AGENCY ?                              
         BE    PUPR4X              YES - SKIP A/R DATE                          
*                                                                               
         CLC   QAGENCY,=C'M$'      MULLEN AGENCY ?                              
         BE    PUPR4X              YES - SKIP A/R DATE                          
*                                                                               
         OC    PBILPOST,PBILPOST        SEE IF POSTED TO ACC                    
         BZ    PUPR4X                                                           
*                    PUT IN A/R DATE Y/M                                        
*                    NOTE THAT DAY GETS CLOBBERED BY PRODUCT CODE               
*                                                                               
*****    GOTO1 DATCON,DMCB,(2,PBILPOST),(0,WORK)                                
         GOTO1 DATCON,DMCB,(2,PBILPOST),(X'20',WORK)                            
         MVC   PBIREC+41(2),WORK+2       MM                                     
         MVC   PBIREC+43(2),WORK         YY                                     
*                                                                               
PUPR4X   DS    0H                                                               
         MVC   PBIREC+45(3),PBILKPRD                                            
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+49(4),DUB        ESTIMATE NUMBER 4 BYTES                  
*                                                                               
         MVC   PBIREC+53(3),PBILKCLT                                            
*                                                                               
         LA    R6,PBIREC+57                                                     
         EDIT  (P6,PBILLRCV),(11,0(R6)),0,FILL=0                                
         CP     PBILLRCV,=P'0'         SEE IF NEGATIVE                          
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         AP    DOUBLE,PPBVEBC         ADD CD TO GET NET                         
         LA    R6,PBIREC+68                                                     
         EDIT  (P8,DOUBLE),(11,0(R6)),0,FILL=0                                  
         CP     DOUBLE,=P'0'         SEE IF NEGATIVE                            
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         LA    R6,PBIREC+79                                                     
         EDIT  (P6,PPBVEBC),(9,0(R6)),0,FILL=0                                  
         CP     PPBVEBC,=P'0'        SEE IF NEGATIVE                            
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         ZAP   MYDUB,PBILLRCV         CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   PUPR8                                                            
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   PUPR8                  YES                                       
         SP    MYDUB,PPBVEBC          MINUS EFFECTIVE CD                        
*                                                                               
PUPR8    DS    0H                                                               
         SP    MYDUB,PBILLNET        RCV - NET = AC                             
         LA    R6,PBIREC+88                                                     
         EDIT  (P8,MYDUB),(11,0(R6)),0,FILL=0                                   
         CP     MYDUB,=P'0'        SEE IF NEGATIVE                              
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
*                                                                               
         LA    R6,PBIREC+99                                                     
         EDIT  (P6,PBILLGRS),(11,0(R6)),0,FILL=0                                
         CP     PBILLGRS,=P'0'     SEE IF NEGATIVE                              
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
*                                                                               
         MVC   PBIREC+110(1),PBILKMED                                           
         CLI   PBILKMED,C'N'                                                    
         BNE   *+8                                                              
         MVI   PBIREC+111,C'P'          MAKE NEWSPAPERS "NP"                    
*                                                                               
         MVC   PBIREC+112(3),PBILKCLT   THEIR ADVERTISER INTERFACE              
         MVC   PBIREC+115(3),PBILKPRD                                           
*                                                                               
*        PBIREC+120(8) IS SPACES - THEIR AGENCY INTERFACE                       
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,WORK)                                
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)                            
         MVC   PBIREC+128(2),WORK+2      MM                                     
         MVC   PBIREC+130(2),WORK+4      DD                                     
         MVC   PBIREC+132(2),WORK        YY                                     
         MVC   PBIREC+130(2),=C'01'               SET DAY TO 01                 
         MVC   PBIREC+134(6),PBIREC+128                                         
         MVC   PBIREC+136(2),=C'30'                                             
         CLI   PBILKMOS+1,4        APR                                          
         BE    PUPR9                                                            
         CLI   PBILKMOS+1,6        JUN                                          
         BE    PUPR9                                                            
         CLI   PBILKMOS+1,9        SEP                                          
         BE    PUPR9                                                            
         CLI   PBILKMOS+1,11       NOV                                          
         BE    PUPR9                                                            
         MVC   PBIREC+136(2),=C'31'                                             
         CLI   PBILKMOS+1,2        FEB                                          
         BNE   PUPR9                                                            
         MVC   PBIREC+136(2),=C'28'                                             
         TM    PBILKMOS,X'03'       CHECK FOR LEAP YEAR                         
         BNZ   PUPR9                                                            
         MVC   PBIREC+136(2),=C'29'                                             
*                                                                               
PUPR9    DS    0H                                                               
         MVC   PBIREC+140(20),PPRDNAME                                          
         OC    PBIREC+140(20),SPACES                                            
*                               SALES TAX (U.S.)                                
         LA    R6,PBIREC+160                                                    
         EDIT  (B4,PPBVETAX),(11,0(R6)),0,FILL=0                                
         L     R0,PPBVETAX        SEE IF NEGATIVE                               
         LTR   R0,R0                                                            
         BNM    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
*                                                                               
         MVC   PBIREC+171(1),PCLTOFF     OFFICE INTERFACE CODE                  
         MVC   PBIREC+172(1),PCLTOFF     OFFICE CODE                            
*                                                                               
         MVC   PBIREC+174(2),=C'PR'     FOR PRINTPAK                            
*                                                                               
         MVC   PBIREC+176(2),PBILLDAT+2  MM  MTH OF RUN-ON DATE                 
*                                                                               
*        REST OF RECORD (22 BYTES) IS SPACES                                    
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   PUPUT                                                            
         CP    PUCOUNT,=P'50'                                                   
         BH    PUPUT                                                            
         AP    PUCOUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(76),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,5,0                                     
         GOTO1 REPORT                                                           
*                                                                               
*                                                                               
PUPUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    PUX                                                              
*                                                                               
         LA    R1,PUPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
PUX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
PUPRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    PUX                                                              
*                                                                               
         LA    R2,PUPBIT1                                                       
         CLOSE ((2),)                                                           
         B     PUX                                                              
*                                                                               
PUCOUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
PUPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=00200,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        FOR GSTX (G7) AND MULLEN (M$)                                          
*                                                                               
G7PROC   NMOD1 0,G7PROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
G7PR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    G7PRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
*        FIRST 23 BYTES ARE SPACES                                              
*                                                                               
G7PR4    DS    0H                                                               
*****    MVC   HALF,PBILKBNO                                                    
*****    LH    R0,HALF                                                          
*****    CVD   R0,DUB                                                           
*****    OI    DUB+7,X'0F'                                                      
*****    UNPK  PBIREC+24(5),DUB     INVOICE NUMBER (THEY NEED 5 BYTES)          
*                                                                               
         MVC   PBIREC+23(6),DINVNO  INVOICE NUMBER (THEY NEED 6 BYTES)          
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILINVD),(0,WORK)      INV DATE                  
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'20',WORK)      INV DATE              
         MVC   PBIREC+29(2),WORK+2       MM                                     
         MVC   PBIREC+31(2),WORK+4       DD                                     
         MVC   PBIREC+33(2),WORK         YY                                     
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)      DUE DATE                  
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)      DUE DATE              
         MVC   PBIREC+35(2),WORK+2       MM                                     
         MVC   PBIREC+37(2),WORK+4       DD                                     
         MVC   PBIREC+39(2),WORK         YY                                     
*                                                                               
         CLC   QAGENCY,=C'G7'      "GSTX" AGENCY ?                              
         BE    G7PR4X              YES - SKIP A/R DATE                          
*                                                                               
*****    CLC   QAGENCY,=C'GQ'      "GSCA" AGENCY ?                              
*****    BE    G7PR4X              YES - SKIP A/R DATE                          
*                                                                               
         CLC   QAGENCY,=C'M$'      MULLEN AGENCY ?                              
         BE    G7PR4X              YES - SKIP A/R DATE                          
*                                                                               
         OC    PBILPOST,PBILPOST        SEE IF POSTED TO ACC                    
         BZ    G7PR4X                                                           
*                    PUT IN A/R DATE Y/M                                        
*                    NOTE THAT DAY GETS CLOBBERED BY PRODUCT CODE               
*                                                                               
*****    GOTO1 DATCON,DMCB,(2,PBILPOST),(0,WORK)                                
         GOTO1 DATCON,DMCB,(2,PBILPOST),(X'20',WORK)                            
         MVC   PBIREC+41(2),WORK+2       MM                                     
         MVC   PBIREC+43(2),WORK         YY                                     
*                                                                               
G7PR4X   DS    0H                                                               
         MVC   PBIREC+45(3),PBILKPRD                                            
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+49(4),DUB        ESTIMATE NUMBER 4 BYTES                  
*                                                                               
         MVC   PBIREC+53(3),PBILKCLT                                            
*                                                                               
         ZAP    PBIREC+57(11),PBILLRCV    ACTUAL                                
*                                                                               
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         AP    DOUBLE,PPBVEBC         ADD CD TO GET NET                         
         ZAP   PBIREC+68(11),DOUBLE                                             
*                                                                               
         ZAP    PBIREC+79(9),PPBVEBC       CD                                   
*                                                                               
         ZAP   MYDUB,PBILLRCV         CALC COMMISSION                           
         TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
         BNZ   G7PR8                                                            
         TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
         BNZ   G7PR8                  YES                                       
         SP    MYDUB,PPBVEBC          MINUS EFFECTIVE CD                        
*                                                                               
G7PR8    DS    0H                                                               
         SP    MYDUB,PBILLNET        RCV - NET = AC                             
         ZAP   PBIREC+88(11),MYDUB     RCV - NET = AC                           
*                                                                               
         ZAP    PBIREC+99(11),PBILLGRS      GROSS                               
*                                                                               
         MVC   PBIREC+110(1),PBILKMED                                           
         CLI   PBILKMED,C'N'                                                    
         BNE   *+8                                                              
         MVI   PBIREC+111,C'P'          MAKE NEWSPAPERS "NP"                    
*                                                                               
         MVC   PBIREC+112(3),PBILKCLT   THEIR ADVERTISER INTERFACE              
         MVC   PBIREC+115(3),PBILKPRD                                           
*                                                                               
*        PBIREC+120(8) IS SPACES - THEIR AGENCY INTERFACE                       
*                                                                               
*****    GOTO1 DATCON,DMCB,(3,PBILKMOS),(0,WORK)                                
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(X'20',WORK)                            
         MVC   PBIREC+128(2),WORK+2      MM                                     
         MVC   PBIREC+130(2),WORK+4      DD                                     
         MVC   PBIREC+132(2),WORK        YY                                     
         MVC   PBIREC+130(2),=C'01'               SET DAY TO 01                 
         MVC   PBIREC+134(6),PBIREC+128                                         
         MVC   PBIREC+136(2),=C'30'                                             
         CLI   PBILKMOS+1,4        APR                                          
         BE    G7PR9                                                            
         CLI   PBILKMOS+1,6        JUN                                          
         BE    G7PR9                                                            
         CLI   PBILKMOS+1,9        SEP                                          
         BE    G7PR9                                                            
         CLI   PBILKMOS+1,11       NOV                                          
         BE    G7PR9                                                            
         MVC   PBIREC+136(2),=C'31'                                             
         CLI   PBILKMOS+1,2        FEB                                          
         BNE   G7PR9                                                            
         MVC   PBIREC+136(2),=C'28'                                             
         TM    PBILKMOS,X'03'       CHECK FOR LEAP YEAR                         
         BNZ   G7PR9                                                            
         MVC   PBIREC+136(2),=C'29'                                             
*                                                                               
G7PR9    DS    0H                                                               
         MVC   PBIREC+140(20),PPRDNAME                                          
         OC    PBIREC+140(20),SPACES                                            
*                               SALES TAX (U.S.)                                
         L     R0,PPBVETAX                                                      
         CVD   R0,DUB                                                           
         ZAP   PBIREC+160(11),DUB                                               
*                                                                               
         MVC   PBIREC+171(1),PCLTOFF     OFFICE INTERFACE CODE                  
         MVC   PBIREC+172(1),PCLTOFF     OFFICE CODE                            
*                                                                               
         MVC   PBIREC+174(2),=C'PR'     FOR PRINTPAK                            
*                                                                               
         MVC   PBIREC+176(2),PBILLDAT+2  MM  MTH OF RUN-ON DATE                 
*                                                                               
*        REST OF RECORD (22 BYTES) IS SPACES                                    
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   G7LAR1                                                           
         MVI   SVQOPT7,C'Y'                                                     
         CP    G7COUNT,=P'50'                                                   
         BH    G7LAR1                                                           
         AP    G7COUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TEMP RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(76),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TEMP RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,5,0                                     
         GOTO1 REPORT                                                           
         B     *+6                                                              
G7COUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
G7LAR1   DS    0H                                                               
*                                                                               
*                                                                               
*  AT THIS POINT MUST ADD TAPE RECORD TO TABLE AND IF THERE IS A                
*   DUPLICATE ADD THEM TOGETHER                                                 
*       CREATE KEY                                                              
*                                                                               
         MVC    G7MED,PBILKMED                                                  
         MVC    G7CLI,PBILKCLT                                                  
         MVC    G7PRO,PBILKPRD                                                  
         MVC    G7EST,PBILKEST                                                  
         MVC    G7INVMO,PBILKBMN+1     BILLING MONTH                            
         MVC    G7INVN,PBILKBNO                                                 
*                                                                               
         MVC    G7REC,PBIREC                                                    
*                                                                               
         L      R2,AOFG7T         ADDRESS OF G7TAB                              
         PRINT  GEN                                                             
         GOTO1 =V(BINSRCH),GBINVALS                                             
         PRINT  NOGEN                                                           
*                                                                               
         CLI    GBINVALS,1         RECORD INSERTED                              
         BE     G7TOXIT                                                         
         OC     GBINVALS+1(3),GBINVALS+1 IF ZERO TABLE IS FULL                  
         BNZ    *+6                                                             
         DC     H'0'                                                            
*                                                                               
*   HAVE DUPLICATE MUST ADD FIELDS                                              
*                                                                               
         L       RF,GBINVALS              ADDRESS OF FOUND RECORD               
         LA      RF,L'G7KEY(RF)           PAST KEY                              
*                                                                               
         CLC     128(6,RF),PBIREC+128     CHECK IF START DATE                   
         BL      *+10                     NEEDS TO BE LOWERED                   
         MVC     128(6,RF),PBIREC+128                                           
         CLC     134(6,RF),PBIREC+134     CHECK IF END DATE                     
         BH      *+10                     NEEDS TO BE RAISED                    
         MVC     134(6,RF),PBIREC+134                                           
*                                                                               
         AP      57(11,RF),PBIREC+57(11)  ACTUAL                                
         AP      68(11,RF),PBIREC+68(11)  NET                                   
         AP      79(09,RF),PBIREC+79(09)  CD                                    
         AP      88(11,RF),PBIREC+88(11)  COMMISSION                            
         AP      99(11,RF),PBIREC+99(11)  GROSS                                 
         AP      160(11,RF),PBIREC+160(11)  SALES TAX                           
*                                                                               
G7TOXIT  DS    0H                                                               
         MVC   GBINVALS,=A(G7MED)                                               
         MVI   GBINVALS,1                                                       
         XIT1                                                                   
         EJECT                                                                  
*                      FINALLY PRODUCE RECORDS                                  
G7PRL    DS    0H                                                               
*                                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'           TEST RUN - NO TAPE                        
         BE    G7PRL5                                                           
*                                                                               
         BC    0,G7PR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (G7PBIT1,(OUTPUT))                                               
*                                                                               
G7PRL5   DS    0H                                                               
         L     R2,G7RECNT          FOR BCT RECORD COUNT                         
         CH    R2,=H'0'            NO RECORDS                                   
         BE    G7ZERO                                                           
         L     R3,AOFG7T                                                        
         LA    R3,L'G7KEY(R3)      BUMP PAST PSUEDO KEY                         
G7AGN    MVC   G7KEY(11),57(R3)                                                 
*                                                                               
         LA    R6,57(R3)                                                        
         EDIT  (P11,G7KEY),(11,0(R6)),0,FILL=0                                  
         CP     G7KEY(11),=P'0'         SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         MVC   G7KEY(11),68(R3)                                                 
         LA     R6,68(R3)                                                       
         EDIT  (P11,G7KEY),(11,0(R6)),0,FILL=0                                  
         CP     G7KEY(11),=P'0'         SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         MVC   G7KEY(09),79(R3)                                                 
         LA    R6,79(R3)                                                        
         EDIT  (P9,G7KEY),(9,0(R6)),0,FILL=0                                    
         CP     G7KEY(9),=P'0'         SEE IF NEGATIVE                          
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         MVC   G7KEY(11),88(R3)                                                 
         LA    R6,88(R3)                                                        
         EDIT  (P11,G7KEY),(11,0(R6)),0,FILL=0                                  
         CP     G7KEY(11),=P'0'         SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         MVC   G7KEY(11),99(R3)                                                 
         LA    R6,99(R3)                                                        
         EDIT  (P11,G7KEY),(11,0(R6)),0,FILL=0                                  
         CP     G7KEY(11),=P'0'         SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
         MVC   G7KEY(11),160(R3)                                                
         LA    R6,160(R3)                                                       
         EDIT  (P11,G7KEY),(11,0(R6)),0,FILL=0                                  
         CP     G7KEY(11),=P'0'         SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R6),C'-'                                                      
*                                                                               
**NEW 1/12/89                                                                   
G7AGN5   DS    0H                                                               
         CLI   SVQOPT7,C'Y'        TEST RUN - NO TAPE                           
         BE    G7AGN7                                                           
*                                                                               
         LA    R1,G7PBIT1                                                       
         PUT   (1),(3)                                                          
*                                                                               
G7AGN7   DS    0H                                                               
         CLI   SVQOPT7,C'Y'                                                     
         BNE   G7AGNX                                                           
         CP    G7COUNT,=P'100'                                                  
         BH    G7AGNX                                                           
         AP    G7COUNT,=P'1'                                                    
         MVC   P(13),=C'***OUTPUT HEX'                                          
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,(R3),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,60(R3)                                                        
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,120(R3)                                                       
         GOTO1 HEXOUT,DMCB,(RF),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    RF,180(R3)                                                       
         GOTO1 HEXOUT,DMCB,(RF),P,20,0                                          
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***OUTPUT CHAR'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),0(R3)                                                     
         GOTO1 REPORT                                                           
         MVC   P(100),100(R3)                                                   
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
G7AGNX   LA    R3,212(R3)   TO NEXT RECORD IN TABLE                             
         BCT   R2,G7AGN                                                         
*                                                                               
G7ZERO   DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'     TEST RUN - NO TAPE                              
         BE    G7ZEROX                                                          
*                                                                               
         LA    R2,G7PBIT1                                                       
         CLOSE ((2),)                                                           
G7ZEROX  B     G7TOXIT                                                          
*                                                                               
G7PBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00200,                                            X        
               BLKSIZE=00200,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
GBINVALS DS    0F                                                               
         DC    X'01'              ADD RECORD                                    
         DC    AL3(G7MED)         RECORD TO BE ADDED                            
         DC    A(G7TABLE)         ADDRESS OF TABLE WHERE REC IS TO BE           
G7RECNT  DC    F'0'               NUMBER OF RECORDS ADDED                       
         DC    F'212'             LEN OF RECORD                                 
         DC    F'12'              KEY SIZE                                      
         DC    F'6000'            MAX NUMBER OF RECORDS (WAS 3K 9/17)           
*                                                                               
AOFG7T   DC    A(G7TABLE)                                                       
G7KEY    DS    0XL12                                                            
G7MED    DS    CL1                                                              
G7CLI    DS    CL3                                                              
G7INUMB  DS    0XL3                                                             
G7INVMO  DS    XL1           INVOICE MONTH                                      
G7INVN   DS    XL2           INVOICE NUMBER                                     
G7PRO    DS    CL3                                                              
G7EST    DS    XL2                                                              
*            ______                                                             
*              12                                                               
G7REC    DS    CL200                                                            
ENDG7R   DS    0C                                                               
***********************                                                         
         EJECT                                                                  
*                                                                               
*        SC JOHNSON INTERFACE (H7,SJ, BN, OO)                                   
*                                                                               
SCPROC   NMOD1 0,SCPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
SCPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    SCPRL                                                            
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'                                                     
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         OC    SCLMOS,SCLMOS  DO I HAVE ONE YET?                                
         BNZ   SCIP1                                                            
         MVC   SCLMOS,PBILKMOS   SAVE THIS MOS AS LOWEST START MOS              
         MVC   SCHMOS,PBILKMOS   AND AS HIGEST END  MOS                         
         B     SCIP1X                                                           
*                                                                               
SCIP1    CLC   PBILKMOS,SCLMOS                                                  
         BNL   *+10                                                             
         MVC   SCLMOS,PBILKMOS  IF LOWER, SAVE IT                               
         CLC   PBILKMOS,SCHMOS                                                  
         BNH   *+10                                                             
         MVC   SCHMOS,PBILKMOS  IF HIGHER, SAVE IT                              
SCIP1X   DS    0H                                                               
*                                                                               
         CLC   QAGENCY,=C'BN'    SEE IF PHDNY                                   
         BE    *+14                                                             
         CLC   QAGENCY,=C'OO'    OR OMD                                         
         BNE   SCIP1XH                                                          
*                                 USE 1ST EST USER                              
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELS                                                       
         BNE   SCIP5             IF NOT FOUND, LEAVE BLANK                      
*                                                                               
         MVC   PBIREC+10(8),PEUSER1   1ST EST USER1                             
         OC    PBIREC+10(8),SPACES                                              
         B     SCIP5             REST SAME AS H7                                
*                                                                               
         DROP  R2                                                               
*                                                                               
SCIP1XH  LA    R3,UCOMBLK     SET-UP UCOM CONTROL BLOCK                         
         XC    UCOMBLK(L'UCOMBLK),UCOMBLK                                       
         USING DDUCOMD,R3                                                       
         MVC   KEYSAVE,KEY         SAVE KEY                                     
         MVC   UCACOMF,VCOMFACS     COMFACS                                     
         MVI   UCSYS,C'P'        SYSTEM TO PRINT                                
         MVC   UCAGY,QAGENCY                                                    
         MVC   UCMED,QMEDIA                                                     
         MVC   UCCLT,PBILKCLT      CLIENT                                       
         MVC   UCPRD,PBILKPRD      PRODUCT                                      
         MVC   UCEST,PBILKEST      ESTIMATE                                     
         OI    UCOPT,UCOEST      RETURN ESTIMATE UCOMMS                         
         GOTO1 =V(DDUCOM),UCOMBLK                                               
         CLI   UCERROR,0                                                        
         BNE   SCIP4        ERROR RETURN - JUST EXIT DON'T DIE                  
         TM    UCDATA,UCDNOEST                                                  
         BO    SCIP4        NO EST DATA                                         
*                                                                               
         L     R1,UCEDATA     EST DATA                                          
         LA    RF,UCELENS     LENGTHS                                           
         LA    RE,PBIREC+10   START OF 1ST EST UCOMM                            
         LHI   R0,1           JUST ONE                                          
SCIP2    CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    *+16                                                             
         MVC   0(08,RE),0(R1)  ONLY 8 CHARACTERS                                
         OC    0(08,RE),=32C' '                                                 
         LA    RE,32(RE)                                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,SCIP2                                                         
*                                                                               
         DROP  R3                                                               
*                                                                               
SCIP4    MVC   KEY,KEYSAVE                                                      
         GOTO1 HIGH                RESTORE SEQUENCE                             
*                                                                               
SCIP5    MVC   PBIREC+18(3),PBILKPRD                                            
*                                                                               
         MVC   WORK(10),DINVFULL                                                
         LA    R1,PBIREC+21                                                     
         LA    R2,DINVFULL                                                      
         LA    R3,10                                                            
SCIP5A   CLI   0(R2),C'-'              ELIMINATE DASHES                         
         BNE   SCIP5C                                                           
SCIP5B   LA    R2,1(R2)                                                         
         BCT   R3,SCIP5A                                                        
         B     SCIP5X                                                           
*                                                                               
SCIP5C   MVC   0(1,R1),0(R2)                                                    
         LA    R1,1(R1)                                                         
         B     SCIP5B                                                           
*                                                                               
SCIP5X   DS    0H                                                               
*                                                                               
******   MVC   PBIREC+21(2),DINVNO     MTH PART OF INV #                        
******   MVC   PBIREC+23(2),DINVMED    MEDIA PART OF INV #                      
******   MVC   PBIREC+25(4),DINVNO+2                                            
*                                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+37(3),DUB        ESTIMATE NUMBER                          
*                                                                               
         GOTO1 DATCON,DMCB,PBILLDAT,(20,PBIREC+45)     RUN/BILL DATE            
         GOTO1 DATCON,DMCB,(3,PBILDUED),(20,PBIREC+53) DUE DATE                 
*                                                                               
         MVC   PBIREC+61(3),PBILKPRD                                            
         MVC   WORK(2),PBILKMOS            YYMM FROM HEADER                     
         MVI   WORK+2,X'01'                DAY TO 01                            
*                                                                               
         GOTO1 DATCON,DMCB,(3,WORK),(20,WORK+6)                                 
         MVC   PBIREC+67(4),WORK+6     YYYY                                     
         GOTO1 DATCON,DMCB,(3,WORK),(4,WORK+6)                                  
         MVC   PBIREC+64(3),WORK+6     MMM                                      
         MVC   PBIREC(6),=C'DETAIL'                                             
         MVC   PBIREC+71(2),DINVMED   USE MEDIA PART OF INV. NO.?               
*                                                                               
SCPR4    DS    0H                                                               
*                                                                               
         ZAP   PBIREC+91(8),PBILLRCV    ACTUAL                                  
         ZAP   PBIREC+107(8),PBILLGRS      GROSS                                
*                                                                               
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         AP    DOUBLE,PPBVEBC         ADD CD TO GET NET                         
         ZAP   PBIREC+123(8),DOUBLE                                             
*                                                                               
         ZAP   PBIREC+139(8),PPBVEBC       CD                                   
         TM    PBIREC+146,X'0D'        MUST REVERSE THE SIGN                    
         BNO   SCPR4C                                                           
         NI    PBIREC+146,X'F0'                                                 
         OI    PBIREC+146,X'0C'        MAKES IT POSTIVE                         
         B     SCPR4D                                                           
*                                                                               
SCPR4C   OI    PBIREC+146,X'0D'        MAKES IF NEGATIVE                        
SCPR4D   DS    0H                                                               
*                               SALES TAX (U.S.)                                
         L     R0,PPBVETAX                                                      
         CVD   R0,DUB                                                           
         ZAP   PBIREC+155(8),DUB                                                
*                                                                               
*        REST OF RECORD IS SPACES                                               
*                                                                               
         CLI   SVQOPT7,C'Y'   TEST RUN                                          
         BNE   SCLAR1                                                           
*                                                                               
         B     SCLAR1         NORMALLY SKIP THIS DISPLAY                        
*                             PATCH IF YOU WANT TO SEE IT                       
         CP    SCCOUNT,=P'50'                                                   
         BH    SCLAR1                                                           
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TEMP RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(76),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TEMP RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,5,0                                     
         GOTO1 REPORT                                                           
*                                                                               
*                                                                               
SCLAR1   DS    0H                                                               
*                                                                               
*                                                                               
*  AT THIS POINT MUST ADD TAPE RECORD TO TABLE AND IF THERE IS A                
*   DUPLICATE ADD THEM TOGETHER                                                 
*       CREATE KEY                                                              
*                                                                               
         MVC    SCMED,PBILKMED                                                  
         MVC    SCCLI,PBILKCLT                                                  
         MVC    SCPRO,PBILKPRD                                                  
         MVC    SCEST,PBILKEST                                                  
         MVC    SCINVMO,PBILKBMN+1     BILLING MONTH                            
         MVC    SCINVN,PBILKBNO                                                 
*                                                                               
         MVC    SCREC,PBIREC                                                    
*                                                                               
         L      R2,AOFSCT         ADDRESS OF SCTAB                              
         PRINT  GEN                                                             
         GOTO1 =V(BINSRCH),SCINVALS                                             
         PRINT  NOGEN                                                           
*                                                                               
         CLI    SCINVALS,1         RECORD INSERTED                              
         BE     SCTOXIT                                                         
         OC     SCINVALS+1(3),SCINVALS+1 IF ZERO TABLE IS FULL                  
         BNZ    *+6                                                             
         DC     H'0'                                                            
*                                                                               
*   HAVE DUPLICATE MUST ADD FIELDS                                              
*                                                                               
         L       RF,SCINVALS              ADDRESS OF FOUND RECORD               
         LA      RF,L'SCKEY(RF)           PAST KEY                              
*                                                                               
         AP      91(8,RF),PBIREC+91(8)  ACTUAL                                  
         AP      107(8,RF),PBIREC+107(8) GROSS                                  
         AP      123(8,RF),PBIREC+123(8) NET                                    
         AP      139(8,RF),PBIREC+139(8)  CASH DISCOUNT                         
         AP      155(8,RF),PBIREC+155(8)  SALES TAX                             
*                                                                               
SCTOXIT  DS    0H                                                               
         MVC   SCINVALS,=A(SCMED)                                               
         MVI   SCINVALS,1                                                       
         XIT1                                                                   
         EJECT                                                                  
*                      FINALLY PRODUCE RECORDS                                  
SCPRL    DS    0H                                                               
*                                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'           TEST RUN - NO TAPE                        
         BE    SCPRL5                                                           
*                                                                               
****     BC    0,SCPR1                                                          
****     OI    *-3,X'F0'                                                        
****     GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
****     OPEN  (SCPBIT1,(OUTPUT))                                               
*                                                                               
SCPRL5   DS    0H                                                               
         MVI   SCRECSW,0                                                        
         L     R2,SCRECNT          FOR BCT RECORD COUNT                         
         CH    R2,=H'0'            NO RECORDS                                   
         BE    SCZERO                                                           
         ZAP   SCTOTAL,=P'0'       TOTAL OF INVOICES                            
         ZAP   SCCOUNT,=P'0'       FILE RECORDS                                 
*                                                                               
         L     R3,AOFSCT                                                        
         MVC   QMEDIA,0(R3)        SET QMEDIA FROM FIRST KEY                    
*                                                                               
*        NOTE THAT IF THEY NEED MEDIA I AND S ON A SEPARATE                     
*        FILE, THEY SHOULD REQUEST THEM ON A DIFFERNT NIGHT                     
*        OR VIA A DIFFERNT ID. OTHERWISE ALL MEDIA WILL                         
*        GET ON THE SAME FILE AND THE HEADER WILL BE WRONG                      
*                                                                               
*        MAYBE I COULD HAVE THEM USE A DIFFERENT FILE TYPE (MAYBE D)            
*        THAT WOULD ALSO REQUIRE THEY FOLLOW THE NOTE ABOVE - ELSE              
*        THE MIXED FILE TYPE ERROR WILL OCCUR                                   
*                                                                               
*        FIRST PUT OUT HEADER RECORD                                            
*                                                                               
         LA    RE,PBIREC           CLEAR PBIREC                                 
         LHI   R1,L'PBIREC-1                                                    
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         MVC   PBIREC(6),=C'HEADER'                                             
         MVC   PBIREC+10(14),=C'PRINT INVOICES'                                 
         JIF   QMEDIA,NE,C'S',AND,QMEDIA,NE,C'I',AND,QMEDIA,NE,C'L',ANDX        
               ,QMEDIA,NE,C'B',AND,QMEDIA,NE,C'V',AND,QMEDIA,NE,C'W',ANX        
               D,QMEDIA,NE,C'D',SCPRL6,JUMP=N                                   
*                                                                               
SCPRL6   MVC   PBIREC+10(16),=C'DIGITAL INVOICES'                               
SCPRL6A  MVC   PBIREC+30(8),CTODAY      YYYYMMDD                                
*                                                                               
         LA    R4,SCFIST                SC'S FISCAL CALENDAR TABLE              
SCPRL6B  CLC   MTODAYB,0(R4)            CHK VS. PERIOD START                    
         BL    DATEERR                                                          
         CLC   MTODAYB,3(R4)            CHK VS. PERIOD END                      
         BNH   SCPRL6F                  FOUND MY PERIOD                         
         LA    R4,6(R4)                 NEXT PERIOD                             
         CLI   0(R4),X'FF'              CHK END OF TABLE                        
         BE    DATEERR                                                          
         B     SCPRL6B                                                          
*                                                                               
DATEERR  DC    H'0'                     UPDATE FISCAL TABLE                     
*                                       CAN'T FIND THE PERIOD                   
*                                                                               
SCPRL6F  DS    0H                                                               
         GOTO1 DATCON,DMCB,(3,0(R4)),(20,PBIREC+38)                             
         GOTO1 DATCON,DMCB,(3,3(R4)),(20,PBIREC+46)                             
         B     SCPRL6X                                                          
*                                                                               
* CODE BELOW WOULD SET FISCAL DATES TO START AND END OF TODAY' MTH              
*                                                                               
***      MVC   PBIREC+38(6),CTODAY      YYYYMM                                  
***      MVC   PBIREC+44(2),=C'01'      SET DAY TO 01                           
***      MVC   PBIREC+46(6),CTODAY                                              
***      MVC   PBIREC+52(2),=C'30'      END DAY TO 30                           
***      CLC   CTODAY+4(2),=C'04'       APRIL                                   
***      BE    SCPRL6B                                                          
***      CLC   CTODAY+4(2),=C'06'       JUNE                                    
***      BE    SCPRL6B                                                          
***      CLC   CTODAY+4(2),=C'09'       SEPTEMBER                               
***      BE    SCPRL6B                                                          
***      CLC   CTODAY+4(2),=C'11'       NOVEMBER                                
***      BE    SCPRL6B                                                          
***      MVC   PBIREC+52(2),=C'31'                                              
***      CLC   CTODAY+4(2),=C'02'       UNLESS FEB                              
***      BNE   SCPRL6B                                                          
***      MVC   PBIREC+52(2),=C'28'                                              
***      TM    MTODAYB,X'03'      CHECK FOR LEAP YEAR                           
***      BNZ   *+10                                                             
***      MVC   PBIREC+52(2),=C'29'                                              
*                                                                               
***RL6B  DS    0H                                                               
*                                                                               
*        NO-OPED CODE BELOW LOOKS A T LOWEST AND HIGEST MOS                     
*        IN THE FILE                                                            
*                                                                               
****     MVC   WORK(2),SCLMOS                                                   
****     MVI   WORK+2,X'01'     SET DAY TO 1                                    
****     GOTO1 DATCON,DMCB,(3,WORK),(20,WORK+6) YYYYMMDD                        
****     MVC   PBIREC+38(6),WORK+6      YYYYMM  (NO DAY)                        
****     MVC   WORK(2),SCHMOS                                                   
****     MVI   WORK+2,X'01'     SET DAY TO 1                                    
****     GOTO1 DATCON,DMCB,(3,WORK),(20,WORK+6) YYYYMMDD                        
****     MVC   PBIREC+46(6),WORK+6      YYYYMM  (NO DAY)                        
*                                                                               
*        FISCAL START AND END DAYS MAY BE NEEDED                                
*        MAY NOT BE EASY TO ASCERTAIN                                           
*                                                                               
SCPRL6X  LA    R3,PBIREC           OUTPUT HEADER                                
         MVI   SCRECSW,C'H'                                                     
         B     SCAGN5                                                           
*                                                                               
SCPRL8   L     R3,AOFSCT                                                        
         LA    R3,L'SCKEY(R3)      BUMP PAST PSUEDO KEY                         
SCAGN    MVC   MYDUB,91(R3)                                                     
         AP    SCTOTAL,MYDUB                                                    
*                                                                               
         LA    R5,91(R3)                                                        
         EDIT  (P8,MYDUB),(15,1(R5)),2,FILL=0                                   
         MVI    0(R5),C'+'                                                      
         CP     MYDUB,=P'0'             SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R5),C'-'                                                      
*                                                                               
         MVC   MYDUB,107(R3)                                                    
         LA     R5,107(R3)                                                      
         EDIT  (P8,MYDUB),(15,1(R5)),2,FILL=0                                   
         MVI    0(R5),C'+'                                                      
         CP     MYDUB,=P'0'             SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R5),C'-'                                                      
*                                                                               
         MVC   MYDUB,123(R3)                                                    
         LA    R5,123(R3)                                                       
         EDIT  (P8,MYDUB),(15,1(R5)),2,FILL=0                                   
         MVI    0(R5),C'+'                                                      
         CP     MYDUB,=P'0'            SEE IF NEGATIVE                          
         BNL    *+8                                                             
         MVI    0(R5),C'-'                                                      
*                                                                               
         MVC   MYDUB,139(R3)                                                    
         LA    R5,139(R3)                                                       
         EDIT  (P8,MYDUB),(15,1(R5)),2,FILL=0                                   
         MVI    0(R5),C'+'                                                      
         CP     MYDUB,=P'0'             SEE IF NEGATIVE                         
         BH     *+8                ONLY THIS ONE IS BRANCH HIGH                 
         MVI    0(R5),C'-'                                                      
*                                                                               
         MVC   MYDUB,155(R3)                                                    
         LA    R5,155(R3)                                                       
         EDIT  (P8,MYDUB),(15,1(R5)),2,FILL=0                                   
         MVI   0(R5),C'+'                                                       
         CP    MYDUB,=P'0'             SEE IF NEGATIVE                          
         BNL   *+8                                                              
         MVI   0(R5),C'-'                                                       
*                                                                               
         CLI   QMEDIA,C'I'                                                      
         BE    SCAGN3                                                           
         CLI   QMEDIA,C'S'                                                      
         BE    SCAGN3                                                           
         CLI   QMEDIA,C'L'         SOCIAL                                       
         BE    SCAGN3                                                           
         CLI   QMEDIA,C'B'         MOBILE                                       
         BE    SCAGN3                                                           
         CLI   QMEDIA,C'V'         NAT. VIDEO                                   
         BE    SCAGN3                                                           
         CLI   QMEDIA,C'W'         LOC. VIDEO                                   
         BE    SCAGN3                                                           
         CLI   QMEDIA,C'D'         DIGITAL AUDIO                                
         BE    SCAGN3                                                           
         B     SCAGN5                                                           
*                                                                               
SCAGN3   DS    0H                    HERE IF DIGITAL MEDIA                      
         MVC   139(16,R3),155(R3)    MOVE TAX TO WHERE CD WAS                   
         MVC   155(16,R3),SPACES     CLEAR OLD TAX FIELD                        
*                                                                               
SCAGN5   DS    0H                                                               
         AP    SCCOUNT,=P'1'                                                    
         CLI   SVQOPT7,C'Y'          TEST RUN - NO RECORDS TO FILE              
         BE    SCAGN7                                                           
*                                                                               
         L     R1,=A(SCPBIT1)                                                   
         PUT   (1),(3)                                                          
*                                                                               
SCAGN7   DS    0H                                                               
         CLI   SVQOPT7,C'Y'          DISPLAY FIRST 100 RECORDS                  
         BNE   SCAGNX                                                           
         CP    SCCOUNT,=P'50'                                                   
         BH    SCAGNX                                                           
*                                                                               
         MVC   P(13),=C'***OUTPUT HEX'                                          
         GOTO1 REPORT                                                           
         LR    R5,R3                                                            
         GOTO1 HEXOUT,DMCB,(R5),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    R5,60(R3)                                                        
         GOTO1 HEXOUT,DMCB,(R5),P,60,0                                          
         GOTO1 REPORT                                                           
         LA    R5,120(R3)                                                       
         GOTO1 HEXOUT,DMCB,(R5),P,60,0                                          
         GOTO1 REPORT                                                           
*                                                                               
SCAGN9   MVC   P(13),=C'***OUTPUT CHAR'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),0(R3)                                                     
         GOTO1 REPORT                                                           
         MVC   P(100),100(R3)                                                   
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
SCAGNX   DS    0H                                                               
         CLI   SCRECSW,C'H'          DID I JUST DO THE HEADER                   
         BNE   SCAGNX3       GO DO THE DETAILS                                  
         MVI   SCRECSW,0     CLEAR                                              
         B     SCPRL8        GO DO THE DETAILS                                  
*                                                                               
SCAGNX3  CLI   SCRECSW,C'F'          DID I JUST DO THE FOOTER                   
         BE    SCZERO        DONE                                               
*                                                                               
SCAGNXX  LA    R3,212(R3)   TO NEXT RECORD IN TABLE                             
         BCT   R2,SCAGN                                                         
*                                                                               
*        LAST  PUT OUT FOOTER RECORD                                            
*                                                                               
         LA    RE,PBIREC           CLEAR PBIREC                                 
         LHI   R1,L'PBIREC-1                                                    
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         MVC   PBIREC(6),=C'FOOTER'                                             
         AP     SCCOUNT,=P'1'     BUMP FOR FOOTER RECORD                        
         EDIT   (P3,SCCOUNT),(10,PBIREC+10),0,FILL=0                            
         LA     R5,PBIREC+20                                                    
         EDIT  (P8,SCTOTAL),(15,1(R5)),2,FILL=0                                 
         MVI    0(R5),C'+'                                                      
         CP     SCTOTAL,=P'0'           SEE IF NEGATIVE                         
         BNL    *+8                                                             
         MVI    0(R5),C'-'                                                      
*                                                                               
         LA    R3,PBIREC                                                        
         MVI   SCRECSW,C'F'                                                     
         B     SCAGN5                                                           
*                                                                               
SCZERO   DS    0H                                                               
*                                                                               
         XIT1                                                                   
         SPACE 2                                                                
         LTORG                                                                  
SCCOUNT  DC    PL3'0'                                                           
SCTOTAL  DS    PL8                                                              
SCRECSW  DS    CL1                                                              
SCLMOS   DS    CL2         LOWEST MOS                                           
SCHMOS   DS    CL2         HIGHEST MOS                                          
*                                                                               
         EJECT                                                                  
NEXTELS  NTR1  BASE=*,LABEL=*                                                   
NEXTELS2 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELSX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELS2                                                         
NEXTELSX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
SCPBIT1  DCB   DDNAME=SCPBIT1,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00180,                                            X        
               BLKSIZE=00180,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*        SC JOHNSON FISCAL CALENDAR 2011 THRU 2013                              
*                                                                               
*        2011-2012 - FOR HISTORICAL REFERENCE                                   
*                                                                               
**FIST   DC   XL3'6F0702',XL3'6F0805'  JUL02/11 - AUG05/11                      
*****    DC   XL3'6F0806',XL3'6F0902' AUG06/11 - SEP02/11                       
*****    DC   XL3'6F0903',XL3'6F091E' SEP03/11 - SEP30/11                       
*****    DC   XL3'6F0A01',XL3'6F0B04' OCT01/11 - NOV04/11                       
*****    DC   XL3'6F0B05',XL3'6F0C02' NOV05/11 - DEC02/11                       
*****    DC   XL3'6F0C03',XL3'6F0C1E' DEC03/11 - DEC30/11                       
*****    DC   XL3'6F0C1F',XL3'700203' DEC31/11 - FEB03/12                       
*****    DC   XL3'700204',XL3'700302' FEB04/12 - MAR02/12                       
*****    DC   XL3'700303',XL3'70031E' MAR03/12 - MAR30/12                       
*****    DC   XL3'70031F',XL3'700504' MAR31/12 - MAY04/12                       
*****    DC   XL3'700505',XL3'700601' MAY05/12 - JUN01/12                       
*****    DC   XL3'700602',XL3'70061D' JUN02/12 - JUN29/12                       
*                                                                               
*        2012-2013                                                              
*                                                                               
SCFIST   DC   XL3'70061E',XL3'700803' JUN30/12 - AUG03/12                       
         DC   XL3'700804',XL3'70081F' AUG04/12 - AUG31/12                       
         DC   XL3'700901',XL3'70091C' SEP01/12 - SEP28/12                       
         DC   XL3'70091D',XL3'700B02' SEP29/12 - NOV02/12                       
         DC   XL3'700B03',XL3'700B1E' NOV03/12 - NOV30/12                       
         DC   XL3'700C01',XL3'700C1C' DEC01/12 - DEC28/12                       
         DC   XL3'700C1D',XL3'710201' DEC29/12 - FEB01/13                       
         DC   XL3'710202',XL3'710301' FEB02/13 - MAR01/13                       
         DC   XL3'710302',XL3'71031D' MAR02/13 - MAR29/13                       
         DC   XL3'71031E',XL3'710503' MAR30/13 - MAY03/13                       
         DC   XL3'710504',XL3'71051F' MAY04/13 - MAY31/13                       
         DC   XL3'710601',XL3'71061C' JUN01/13 - JUN28/13                       
*                                                                               
*        2013-2014 (ESTIMATED FOR NOW)                                          
*                                                                               
         DC   XL3'71061D',XL3'710802' JUN29/13 - AUG02/13                       
         DC   XL3'710803',XL3'71081E' AUG03/13 - AUG30/13                       
         DC   XL3'71081F',XL3'71091B' AUG31/13 - SEP27/13                       
         DC   XL3'71091C',XL3'710B01' SEP28/13 - NOV01/13                       
         DC   XL3'710B02',XL3'710B1D' NOV02/13 - NOV29/13                       
         DC   XL3'710B1E',XL3'710C1B' NOV30/13 - DEC27/13                       
         DC   XL3'710C1C',XL3'72011F' DEC28/13 - JAN31/14                       
         DC   XL3'720201',XL3'72021C' FEB01/14 - FEB28/14                       
         DC   XL3'720301',XL3'72031C' MAR01/14 - MAR28/14                       
         DC   XL3'72031D',XL3'720502' MAR29/14 - MAY02/14                       
         DC   XL3'720503',XL3'72051E' MAY03/14 - MAY30/14                       
         DC   XL3'72051F',XL3'72061B' MAY31/14 - JUN27/14                       
*                                                                               
*        2014-2015                                                              
*                                                                               
         DC   XL3'72061C',XL3'720801' JUN28/14 - AUG01/14                       
         DC   XL3'720802',XL3'72081D' AUG02/14 - AUG29/14                       
         DC   XL3'72081E',XL3'72091A' AUG30/14 - SEP26/14                       
         DC   XL3'72091B',XL3'720A1F' SEP27/14 - OCT31/14                       
         DC   XL3'720B01',XL3'720B1C' NOV01/14 - NOV28/14                       
         DC   XL3'720B1D',XL3'730102' NOV29/14 - JAN02/15                       
         DC   XL3'730103',XL3'730206' JAN03/15 - FEB06/15                       
         DC   XL3'730207',XL3'730306' FEB07/15 - MAR06/15                       
         DC   XL3'730307',XL3'730403' MAR07/15 - APR03/15                       
         DC   XL3'730404',XL3'730508' APR04/15 - MAY08/15                       
         DC   XL3'730509',XL3'730605' MAY09/15 - JUN05/15                       
         DC   XL3'730606',XL3'730703' JUN06/15 - JUL03/15                       
*                                                                               
*        2015-2016                                                              
*                                                                               
         DC   XL3'730704',XL3'730807' JUL04/15 - AUG07/15                       
         DC   XL3'730808',XL3'730904' AUG08/15 - SEP04/15                       
         DC   XL3'730905',XL3'730A02' SEP05/15 - OCT02/15                       
         DC   XL3'730A03',XL3'730B06' OCT03/15 - NOV06/15                       
         DC   XL3'730B07',XL3'730C04' NOV07/15 - DEC04/15                       
         DC   XL3'730C05',XL3'740101' DEC05/15 - JAN01/16                       
         DC   XL3'740102',XL3'740205' JAN02/16 - FEB05/16                       
         DC   XL3'740206',XL3'740304' FEB06/16 - MAR04/16                       
         DC   XL3'740305',XL3'740401' MAR05/16 - APR01/16                       
         DC   XL3'740402',XL3'740506' APR02/16 - MAY06/16                       
         DC   XL3'740507',XL3'740603' MAY07/16 - JUN03/16                       
         DC   XL3'740604',XL3'740701' JUN04/16 - JUL01/16                       
*                                                                               
*        2016-2017                                                              
*                                                                               
         DC   XL3'740702',XL3'740805' JUL02/16 - AUG05/16                       
         DC   XL3'740806',XL3'740902' AUG06/16 - SEP02/16                       
         DC   XL3'740903',XL3'74091E' SEP03/16 - SEP30/16                       
         DC   XL3'740A01',XL3'740B04' OCT01/16 - NOV04/16                       
         DC   XL3'740B05',XL3'740C02' NOV05/16 - DEC02/16                       
         DC   XL3'740C03',XL3'740C1E' DEC03/16 - DEC30/16                       
         DC   XL3'740C1F',XL3'750203' DEC31/16 - FEB03/17                       
         DC   XL3'750204',XL3'750303' FEB04/17 - MAR03/17                       
         DC   XL3'750304',XL3'75031F' MAR04/17 - MAR31/17                       
         DC   XL3'750401',XL3'750505' APR01/17 - MAY05/17                       
         DC   XL3'750506',XL3'750602' MAY06/17 - JUN02/17                       
         DC   XL3'750603',XL3'75061E' JUN03/17 - JUN30/17                       
*                                                                               
*        2017-2018                                                              
*                                                                               
         DC   XL3'750701',XL3'750804' JUL01/17 - AUG04/17                       
         DC   XL3'750805',XL3'750901' AUG05/17 - SEP01/17                       
         DC   XL3'750902',XL3'75091D' SEP02/17 - SEP29/17                       
         DC   XL3'75091E',XL3'750B03' SEP30/17 - NOV03/17                       
         DC   XL3'750B04',XL3'750C01' NOV04/17 - DEC01/17                       
         DC   XL3'750C02',XL3'750C1D' DEC02/17 - DEC29/17                       
         DC   XL3'750C1E',XL3'760202' DEC30/17 - FEB02/18                       
         DC   XL3'760203',XL3'760302' FEB03/18 - MAR02/18                       
         DC   XL3'760303',XL3'76031E' MAR03/18 - MAR30/18                       
         DC   XL3'76031F',XL3'760504' MAR31/18 - MAY04/18                       
         DC   XL3'760505',XL3'760601' MAY05/18 - JUN01/18                       
         DC   XL3'760602',XL3'76061D' JUN02/18 - JUN29/18                       
*                                                                               
*        2018-2019                                                              
*                                                                               
         DC   XL3'76061E',XL3'760803' JUN30/18 - AUG03/18                       
         DC   XL3'760804',XL3'76081F' AUG04/18 - AUG31/18                       
         DC   XL3'760901',XL3'76091C' SEP01/18 - SEP28/18                       
         DC   XL3'76091D',XL3'760B02' SEP29/18 - NOV02/18                       
         DC   XL3'760B03',XL3'760B1E' NOV03/18 - NOV30/18                       
         DC   XL3'760C01',XL3'760C1C' DEC01/18 - DEC28/18                       
         DC   XL3'760C1D',XL3'770201' DEC29/18 - FEB01/19                       
         DC   XL3'770202',XL3'770301' FEB02/19 - MAR01/19                       
         DC   XL3'770302',XL3'77031D' MAR02/19 - MAR29/19                       
         DC   XL3'77031E',XL3'770503' MAR30/19 - MAY03/19                       
         DC   XL3'770504',XL3'77051F' MAY04/19 - MAY31/19                       
         DC   XL3'770601',XL3'77061C' JUN01/19 - JUN28/19                       
*                                                                               
*        2019-2020                                                              
*                                                                               
         DC   XL3'77061D',XL3'770802' JUN29/19 - AUG02/19                       
         DC   XL3'770803',XL3'77081E' AUG03/19 - AUG30/19                       
         DC   XL3'77081F',XL3'77091B' AUG31/19 - SEP27/19                       
         DC   XL3'77091C',XL3'770B01' SEP28/19 - NOV01/19                       
         DC   XL3'770B02',XL3'770B1D' NOV02/19 - NOV29/19                       
         DC   XL3'770B1E',XL3'770C1B' NOV30/19 - DEC27/19                       
         DC   XL3'770C1C',XL3'78011F' DEC28/19 - JAN31/20                       
         DC   XL3'780201',XL3'78021C' FEB01/20 - FEB28/20                       
         DC   XL3'78021D',XL3'78031B' FEB29/20 - MAR27/20                       
         DC   XL3'78031C',XL3'780501' MAR28/20 - MAY01/20                       
         DC   XL3'780502',XL3'78051D' MAY02/20 - MAY29/20                       
***      DC   XL3'78051E',XL3'78061A' MAY30/20 - JUN26/20                       
         DC   XL3'78051E',XL3'780703' MAY30/20 - JUL03/20                       
*                                                                               
*        2020-2021                                                              
*                                                                               
         DC   XL3'780704',XL3'780807' JUL04/20 - AUG07/20                       
         DC   XL3'780808',XL3'780904' AUG08/20 - SEP04/20                       
         DC   XL3'780905',XL3'780A02' SEP05/20 - OCT02/20                       
         DC   XL3'780A03',XL3'780B06' OCT03/20 - NOV06/20                       
         DC   XL3'780B07',XL3'780C04' NOV07/20 - DEC04/20                       
         DC   XL3'780C05',XL3'790101' DEC05/20 - JAN01/21                       
         DC   XL3'790102',XL3'790205' JAN02/21 - FEB05/21                       
         DC   XL3'790206',XL3'790305' FEB06/21 - MAR05/21                       
         DC   XL3'790306',XL3'790402' MAR06/21 - APR02/21                       
         DC   XL3'790403',XL3'790507' APR03/21 - MAY07/21                       
         DC   XL3'790508',XL3'790604' MAY08/21 - JUN04/21                       
         DC   XL3'790605',XL3'790702' JUN05/21 - JUL02/21                       
*                                                                               
         DC   XL3'FFFFFF'         END OF TABLE                                  
         EJECT                                                                  
*                                                                               
SCINVALS DS    0F                                                               
         DC    X'01'              ADD RECORD                                    
         DC    AL3(SCMED)         RECORD TO BE ADDED                            
         DC    A(SCTABLE)         ADDRESS OF TABLE WHERE REC IS TO BE           
SCRECNT  DC    F'0'               NUMBER OF RECORDS ADDED                       
         DC    F'212'             LEN OF RECORD                                 
         DC    F'12'              KEY SIZE                                      
         DC    F'2000'            MAX NUMBER OF RECORDS                         
*                                                                               
AOFSCT   DC    A(SCTABLE)                                                       
SCKEY    DS    0XL12                                                            
SCMED    DS    CL1                                                              
SCCLI    DS    CL3                                                              
SCINUMB  DS    0XL3                                                             
SCINVMO  DS    XL1           INVOICE MONTH                                      
SCINVN   DS    XL2           INVOICE NUMBER                                     
SCPRO    DS    CL3                                                              
SCEST    DS    XL2                                                              
*            ______                                                             
*              12                                                               
SCREC    DS    CL200                                                            
ENDSCR   DS    0C                                                               
         EJECT                                                                  
*                                                                               
*        MAZDA INTERFACE (H7 + SJ)                                              
*                                                                               
MZPROC   NMOD1 0,MZPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
MZPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    MZPRL                                                            
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'                                                     
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(250),PBIREC                                             
         MVC   PBIREC+250(250),PBIREC                                           
*                                                                               
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    MZPR1C              YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
MZPR1C   DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   MZPR1E                                                           
*                                                                               
*        AS OF MAR 15/2012 FORMAT OF ESTIMATE USER1 IS:                         
*        CCCC-NNNNN CCCC= COST CENTER, NNNNN= INTERNAL ORDER #                  
*                                                                               
         MVC   PBIREC+159(4),PEUSER1                                            
         MVC   PBIREC+169(5),PEUSER1+5                                          
         OC    PBIREC+159(4),SPACES                                             
         OC    PBIREC+169(5),SPACES                                             
         MVC   PBIREC+7(6),PEUSER2     G/L ACCOUNT                              
*                                                                               
         DROP  R2                                                               
*                                                                               
*                                                                               
MZPR1E   MVI   PBIREC,C'L'             DETAIL RECORD                            
*                                                                               
*        COST CENTER - EST USER1 FIELD?  (PBIREC+159)                           
*        INTERNAL ORDER - EST USER1 FIELD?  (PBIREC+169)                        
*                                                                               
*        OLD CODE - SET DEFAULT G/L CODE - NOW IN EST USER 2                    
*******  MVC   PBIREC+7(6),=C'631000'   DEFAULT G/L ACCOUNT                     
*                                                                               
         MVC   PBIREC+211(3),PBILKPRD                                           
         MVC   PBIREC+364(L'DINVFULL),DINVFULL                                  
*                                                                               
         MVC   WORK(2),PBILKMOS            YYMM FROM HEADER                     
         MVI   WORK+2,X'01'                DAY TO 01                            
*                                                                               
         GOTO1 DATCON,DMCB,(3,WORK),(6,WORK+6)                                  
         MVC   PBIREC+273(11),=C'TRADE MEDIA'                                   
         LA    RE,PBIREC+285                                                    
         CLI   PBILKMED,C'T'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(12),=C'SEARCH MEDIA'                                  
         LA    RE,PBIREC+286                                                    
         CLI   PBILKMED,C'S'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(12),=C'SOCIAL MEDIA'                                  
         LA    RE,PBIREC+286                                                    
         CLI   PBILKMED,C'L'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(12),=C'MOBILE MEDIA'                                  
         LA    RE,PBIREC+286                                                    
         CLI   PBILKMED,C'B'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(13),=C'OUTDOOR MEDIA'                                 
         LA    RE,PBIREC+287                                                    
         CLI   PBILKMED,C'O'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(14),=C'MAGAZINE MEDIA'                                
         LA    RE,PBIREC+288                                                    
         CLI   PBILKMED,C'M'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(15),=C'NEWSPAPER MEDIA'                               
         LA    RE,PBIREC+289                                                    
         CLI   PBILKMED,C'N'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(16),=C'NAT. VIDEO MEDIA'                              
         LA    RE,PBIREC+290                                                    
         CLI   PBILKMED,C'V'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(16),=C'LOC. VIDEO MEDIA'                              
         LA    RE,PBIREC+290                                                    
         CLI   PBILKMED,C'W'                                                    
         BE    MZP1A                                                            
         MVC   PBIREC+273(17),=C'INTERACTIVE MEDIA'                             
         LA    RE,PBIREC+291                                                    
         CLI   PBILKMED,C'I'                                                    
         BE    MZP1A                                                            
         DC    H'0'     UNKNOWN MEDIA CODE                                      
*                                                                               
MZP1A    DS    0H                                                               
         MVC   0(6,RE),WORK+6     FLOAT MOS AFTER MEDIA                         
*                                                                               
*        OLD CODE - SET DEFAULT G/L CODE - NOW IN EST USER 2                    
*******  MVC   PBIREC+7(6),=C'631000'    BUDGET CODE/GL ACCOUNT                 
*                                                                               
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(20,PBIREC+347)  INVOICE DATE           
         GOTO1 DATCON,DMCB,(3,PBILDUED),(X'20',WORK)       DUE DATE             
*                                                                               
         MVC   PBIREC+339(2),WORK+2    MM                                       
         MVI   PBIREC+341,C'/'                                                  
         MVC   PBIREC+342(2),WORK+4    DD    DUE DATE = MM/DD/YY                
         MVI   PBIREC+344,C'/'                                                  
         MVC   PBIREC+345(2),WORK      YY                                       
*                                                                               
         MVC   PBIREC+355(8),CTODAY    CCYYMMDD                                 
*                                                                               
MZPR4    DS    0H                                                               
*                                                                               
         ZAP   PBIREC+28(8),PBILLRCV    ACTUAL                                  
*                                                                               
*        REST OF RECORD IS SPACES                                               
*                                                                               
         CLI   SVQOPT7,C'Y'   TEST RUN                                          
         BNE   MZLAR1                                                           
*                                                                               
         B     MZLAR1         NORMALLY SKIP THIS DISPLAY                        
*                             PATCH IF YOU WANT TO SEE IT                       
         CP    MZCOUNT,=P'50'                                                   
         BH    MZLAR1                                                           
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
         MVC   P(14),=C'***TEMP RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(124),PBIREC+124                                          
         GOTO1 REPORT                                                           
         MVC   P(127),PBIREC+248                                                
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TEMP RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+260,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+325,P,50,0                                    
         GOTO1 REPORT                                                           
*                                                                               
*                                                                               
MZLAR1   DS    0H                                                               
*                                                                               
*                                                                               
*  AT THIS POINT MUST ADD TAPE RECORD TO TABLE AND IF THERE IS A                
*   DUPLICATE ADD THEM TOGETHER                                                 
*       CREATE KEY                                                              
*                                                                               
         MVI    MZTYPE,C'1'                                                     
         XC     MZMOS,MZMOS                                                     
*                                                                               
MZLAR2   DS     0H                                                              
         MVC    MZMED,PBILKMED                                                  
         MVC    MZCLI,PBILKCLT                                                  
         MVC    MZPRO,PBILKPRD                                                  
         MVC    MZEST,PBILKEST                                                  
         MVC    MZINVMO,PBILKBMN+1     BILLING MONTH                            
         MVC    MZINVN,PBILKBNO                                                 
*                                                                               
         MVC    MZREC(250),PBIREC                                               
         MVC    MZREC+250(125),PBIREC+250                                       
         MVI    MZREC,C'1'        CHANGES THE 'L'                               
         CLI    MZTYPE,C'1'                                                     
         BE     MZLAR3                                                          
         MVI    MZREC,C'2'        MZTYPE MUST BE 2                              
         MVC   MZMOS,PBILKMOS                                                   
*                                                                               
MZLAR3   L      R2,AOFMZT         ADDRESS OF MZTAB                              
         PRINT  GEN                                                             
         GOTO1 =V(BINSRCH),MZINVALS                                             
         PRINT  NOGEN                                                           
*                                                                               
         CLI    MZINVALS,1         RECORD INSERTED                              
         BE     MZTOXIT                                                         
         OC     MZINVALS+1(3),MZINVALS+1 IF ZERO TABLE IS FULL                  
         BNZ    *+6                                                             
         DC     H'0'                                                            
*                                                                               
*   HAVE DUPLICATE MUST ADD FIELDS                                              
*                                                                               
         CLI    MZTYPE,C'1'                                                     
         BE     *+6                                                             
         DC     H'0'                     SOMETHING WRONG                        
*                                                                               
         L      RF,MZINVALS              ADDRESS OF FOUND RECORD                
         LA     RF,L'MZKEY(RF)           PAST KEY                               
*                                                                               
         AP     28(8,RF),PBIREC+28(8)  ACTUAL                                   
*                                                                               
MZTOXIT  DS    0H                                                               
         CLI   MZTYPE,C'1'         DID I JUST ADD A TYPE 1 REC?                 
         BNE   MZTOXITX            IF  NOT THEN DONE                            
         MVI   MZTYPE,C'2'                                                      
         MVC   MZINVALS,=A(MZMED)                                               
         MVI   MZINVALS,1                                                       
         B     MZLAR2              NOW ADD TYPE 2 RECORD                        
*                                                                               
MZTOXITX DS    0H                                                               
         MVC   MZINVALS,=A(MZMED)                                               
         MVI   MZINVALS,1                                                       
         XIT1                                                                   
         EJECT                                                                  
*                      FINALLY PRODUCE RECORDS                                  
MZPRL    DS    0H                                                               
*                                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'           TEST RUN - NO TAPE                        
         BE    MZPRL5                                                           
*                                      NO ALLOCATION HERE                       
****     BC    0,MZPRL5                                                         
****     OI    *-3,X'F0'                                                        
****     GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
****     OPEN  (MZPBIT1,(OUTPUT))                                               
*                                                                               
MZPRL5   DS    0H                                                               
         ZAP   MZHCNT,=P'0'        INVOICE HEADERS                              
         ZAP   MZLCNT,=P'0'        ALL RECORDS                                  
         ZAP   MZCOUNT,=P'0'       RECORD COUNT                                 
         MVI   MZRECSW,0                                                        
         L     R2,MZRECNT          FOR BCT RECORD COUNT                         
         CH    R2,=H'0'            NO RECORDS                                   
         BE    MZZERO                                                           
*                                                                               
         LA    RE,PBIREC           CLEAR PBIREC                                 
         LH    R1,=H'600'                                                       
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
*        FIRST PUT OUT HEADER RECORD                                            
*                                                                               
         MVI   PBIREC,C'A'    FILE HEADER                                       
         MVC   PBIREC+1(3),=C'TMG'       SOURCE IDENTIFER                       
         MVC   PBIREC+11(8),=C'MEDIA_AP' INTERFACE IDENTIFER                    
         MVC   PBIREC+21(8),CTODAY       USE TODAY AS THE SEQUENCE #            
         MVC   PBIREC+29(8),CTODAY                                              
         MVC   PBIREC+37(31),=C'TEAM MAZDA MEDIA PAYMENT FILE -'                
         MVC   PBIREC+70(2),CTODAY+4      MONTH                                 
         MVI   PBIREC+72,C'/'                                                   
         MVC   PBIREC+73(4),CTODAY        CENTURY                               
*                                                                               
         MVI   MZRECSW,C'A'        FILE HEADER                                  
         AP    MZLCNT,=P'1'                                                     
         B     MZAGN5                                                           
*                                                                               
MZPRL8   L     R3,AOFMZT                                                        
         LA    R3,L'MZKEY(R3)      BUMP PAST PSUEDO KEY                         
*                                                                               
MZAGN    DS    0H                                                               
         CLI   0(R3),C'1'          FIRST INVOICE DETAIL                         
         BNE   MZAGN2                                                           
*                                                                               
*        DO INVOICE HEADER (H) RECORD FIRST                                     
*                                                                               
*                                                                               
         LA    RE,PBIREC           CLEAR PBIREC                                 
         LH    R1,=H'600'                                                       
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         MVI   PBIREC,C'H'                                                      
         MVC   PBIREC+1(8),347(R3)   INVOICE DATE                               
         MVC   PBIREC+9(2),=C'YI'    DEFAULT/FIXED                              
         MVC   PBIREC+11(4),=C'US10' FIXED                                      
*********MVC   PBIREC+15(8),355(R3)   RUN DATE                                  
         MVC   PBIREC+15(8),CTODAY   FILE CREATION DATE                         
         MVC   PBIREC+23(3),=C'USD'  CURRENCY                                   
*                                                                               
*        PBIREC+28(8) TO BE INVOICE # WITHOUT DASHES                            
*                                                                               
         MVC   PBIREC+28(2),364(R3)  MEDIA PART                                 
         MVC   PBIREC+30(2),367(R3)  MONTH PART                                 
         MVC   PBIREC+32(4),370(R3)  INV # PART                                 
*********MVC   PBIREC+28(L'DINVFULL),364(R3)  INVOICE#                          
         MVC   PBIREC+44(12),=C'TEAM MAZDA -'                                   
         MVC   PBIREC+57(2),351(R3)  MONTH OF BILLING                           
         MVI   PBIREC+59,C'/'                                                   
         MVC   PBIREC+60(2),349(R3)  YEAR OF BILLING                            
         MVI   MZRECSW,C'H'          INVOICE HEADER                             
         AP    MZHCNT,=P'1'                                                     
         AP    MZLCNT,=P'1'                                                     
         B     MZAGN5                                                           
*                                                                               
MZAGN1   ZAP   MYDUB,28(8,R3)        FIRST DETAIL RECORD                        
*                                                                               
         MVI   PBIREC,C'L'                                                      
         MVC   PBIREC+1(2),=C'31'                                               
         CP    28(8,R3),=P'0'                                                   
         BNL   *+10                                                             
         MVC   PBIREC+1(2),=C'21'    CREDIT MEMO                                
*                                                                               
         MVC   PBIREC+7(6),=C'110641'      HARD CODED                           
         MVC   PBIREC+28(12),=C'000000000000'  SINCE $ FIELD IS 27 LONG         
         LA    R5,PBIREC+40                                                     
         EDIT  (P8,MYDUB),(15,0(R5)),2,FILL=0                                   
         MVI   PBIREC+126,C'M'       AP-MANUAL WIRES?                           
         MVC   PBIREC+211(3),=C'DUE'                                            
         MVC   PBIREC+215(8),339(R3) DUE MM/DD/YY                               
*                                                                               
         MVC   PBIREC+273(30),273(R3) MEDIA AND MOS                             
         LA    R5,PBIREC+303                                                    
MZAGN1A  CLI   0(R5),C' '       FIND FIRST NON-SPACE                            
         BNE   MZAGN1B                                                          
         SH    R5,=H'1'         BACK-UP R5                                      
         B     MZAGN1A                                                          
MZAGN1B  SH    R5,=H'5'         MUST HAVE HIT MOS                               
         MVC   0(6,R5),SPACES   CLEAR MOS FOR THIS RECORD                       
         AP    MZLCNT,=P'1'                                                     
         B     MZAGN5                                                           
*                                                                               
MZAGN2   ZAP   MYDUB,28(8,R3)        NON-FIRST DETAIL RECORD                    
*                                                                               
         MVI   PBIREC,C'L'                                                      
         MVC   PBIREC+1(2),=C'40'                                               
         CP    28(8,R3),=P'0'                                                   
         BNL   *+10                                                             
         MVC   PBIREC+1(2),=C'50'    CREDIT MEMO                                
******   WHERE G/L ACCOUNT IS TO BE STORED IN DDS STILL UNKNOWN                 
         MVC   PBIREC+7(16),7(R3)    GL ACCOUNT - PRD USER 1?                   
******                                                                          
         MVC   PBIREC+28(12),=C'000000000000'                                   
         LA    R5,PBIREC+40                                                     
         EDIT  (P8,MYDUB),(15,0(R5)),2,FILL=0                                   
         MVC   PBIREC+159(4),159(R3) COST CENTER - EST USER 1?                  
         MVC   PBIREC+169(5),169(R3) INTERNAL ORDER - EST USER 2?               
         MVC   PBIREC+211(3),211(R3) PRODUCT CODE                               
         MVC   PBIREC+273(30),273(R3) MEDIA AND MOS                             
         AP    MZLCNT,=P'1'                                                     
         B     MZAGN5                                                           
*                                                                               
MZAGN5   DS    0H                                                               
         LA    R4,PBIREC                                                        
         CLI   SVQOPT7,C'Y'          TEST RUN - NO RECORDS TO FILE              
         BE    MZAGN7                                                           
*                                                                               
         L     R1,=A(MZPBIT1)                                                   
         PUT   (1),(4)                                                          
*                                                                               
MZAGN7   DS    0H                                                               
         AP    MZCOUNT,=P'1'                                                    
         CLI   SVQOPT7,C'Y'          DISPLAY FIRST 100 RECORDS                  
         BNE   MZAGNX                                                           
         CLI   PBIREC,C'T'           ALWAYS SHOW TRAILER                        
         BE    MZAGN8                                                           
         CP    MZCOUNT,=P'75'                                                   
         BH    MZAGNX                                                           
*                                                                               
MZAGN8   MVC   P(13),=C'***OUTPUT HEX'                                          
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,0(R4),P,60,0                                         
         GOTO1 REPORT                                                           
         LA    R4,60(R4)                                                        
         GOTO1 HEXOUT,DMCB,0(R4),P,60,0                                         
         GOTO1 REPORT                                                           
         LA    R4,60(R4)                                                        
         GOTO1 HEXOUT,DMCB,0(R4),P,60,0                                         
         GOTO1 REPORT                                                           
         LA    R4,60(R4)                                                        
         GOTO1 HEXOUT,DMCB,0(R4),P,60,0                                         
         GOTO1 REPORT                                                           
         LA    R4,60(R4)                                                        
         GOTO1 HEXOUT,DMCB,0(R4),P,60,0                                         
         GOTO1 REPORT                                                           
         LA    R4,60(R4)                                                        
         GOTO1 HEXOUT,DMCB,0(R4),P,60,0                                         
         GOTO1 REPORT                                                           
         LA    R4,60(R4)                                                        
         GOTO1 HEXOUT,DMCB,0(R4),P,75,0                                         
         GOTO1 REPORT                                                           
*                                                                               
MZAGN9   MVC   P(14),=C'***OUTPUT CHAR'                                         
         GOTO1 REPORT                                                           
         LA    R4,PBIREC        RESET TO START OF REC                           
         MVC   P(100),0(R4)                                                     
         GOTO1 REPORT                                                           
         MVC   P(100),100(R4)                                                   
         GOTO1 REPORT                                                           
         MVC   P(100),200(R4)                                                   
         GOTO1 REPORT                                                           
         MVC   P(75),300(R4)                                                    
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
MZAGNX   DS    0H                                                               
         CLI   MZRECSW,C'A'  DID I JUST DO THE FILE HEADER                      
         BNE   MZAGNX2       GO DO THE DETAILS                                  
         MVI   MZRECSW,0     CLEAR                                              
         MVC   PBIREC(100),SPACES  CLEAR PBIREC                                 
         B     MZPRL8        GO DO THE H RECORD                                 
*                                                                               
MZAGNX2  DS    0H                                                               
         CLI   MZRECSW,C'H'  DID I JUST DO THE INVOICE HEADER                   
         BNE   MZAGNX3       GO DO THE DETAILS                                  
         MVI   MZRECSW,0     CLEAR                                              
         MVC   PBIREC(100),SPACES  CLEAR PBIREC                                 
         B     MZAGN1        GO DO FIRST DETAIL RECORD                          
*                            SAME BINSEARCH RECORD AS INV. HEADER               
*                                                                               
MZAGNX3  CLI   MZRECSW,C'F'          DID I JUST DO THE TRAILER                  
         BE    MZZERO        DONE                                               
*                                                                               
MZAGNXX  LA    R3,390(R3)   TO NEXT RECORD IN TABLE                             
*                                                                               
         LA    RE,PBIREC           CLEAR PBIREC                                 
         LH    R1,=H'600'                                                       
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         BCT   R2,MZAGN                                                         
*                                                                               
*        LAST  PUT OUT TRAILER RECORD                                           
*                                                                               
         LA    RE,PBIREC           CLEAR PBIREC                                 
         LH    R1,=H'600'                                                       
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         AP    MZLCNT,=P'1'        ADD ONE FOR TRAILER                          
         MVI   PBIREC,C'T'         TRAILER RECORD                               
         EDIT  (P3,MZHCNT),(6,PBIREC+1),0,FILL=0                                
         EDIT  (P3,MZLCNT),(8,PBIREC+7),0,FILL=0                                
         LA    R3,PBIREC                                                        
         MVI   MZRECSW,C'F'                                                     
         B     MZAGN5                                                           
*                                                                               
MZZERO   DS    0H                                                               
*                                                                               
         MVC   MZINVALS,=A(MZMED)                                               
         MVI   MZINVALS,1                                                       
         XIT1                                                                   
         SPACE 2                                                                
         EJECT                                                                  
         LTORG                                                                  
MZRECSW  DS    CL1                                                              
MZHCNT   DS    PL3                INVOICE HEADER COUNT                          
MZLCNT   DS    PL3                INVOICE DETAIL COUNT                          
MZCOUNT  DS    PL3                RECORD COUNT                                  
*                                                                               
*                                                                               
         EJECT                                                                  
*                                                                               
MZPBIT1  DCB   DDNAME=MZPBIT1,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00550,                                            X        
               BLKSIZE=00550,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         LTORG                                                                  
         EJECT                                                                  
*                                                                               
*                                                                               
MZINVALS DS    0F                                                               
         DC    X'01'              ADD RECORD                                    
         DC    AL3(MZMED)         RECORD TO BE ADDED                            
         DC    A(MZTABLE)         ADDRESS OF TABLE WHERE REC IS TO BE           
MZRECNT  DC    F'0'               NUMBER OF RECORDS ADDED                       
         DC    F'390'             LEN OF RECORD                                 
         DC    F'15'              KEY SIZE                                      
         DC    F'1200'            MAX NUMBER OF RECORDS                         
*                                                                               
AOFMZT   DC    A(MZTABLE)                                                       
*                                                                               
MZKEY    DS    0XL15                                                            
MZMED    DS    CL1                                                              
MZCLI    DS    CL3                                                              
MZPRO    DS    CL3                                                              
MZEST    DS    XL2                                                              
MZINUMB  DS    0XL3                                                             
MZINVMO  DS    XL1           INVOICE MONTH                                      
MZINVN   DS    XL2           INVOICE NUMBER                                     
MZTYPE   DS    XL1           1=HEADER,2=DETAIL                                  
MZMOS    DS    XL2           ONLY PRESENT FOR TYPE 2                            
*            ______                                                             
*              15                                                               
MZREC    DS    CL375                                                            
ENDMZR   DS    0C                                                               
*                                                                               
***********************                                                         
         TITLE 'SAATCHI - TOYOTA'                                               
*                                  SAATCHI - TOYOTA TAPE                        
         SPACE 2                                                                
DFTPROC  NMOD1 0,DFTPROC                                                        
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    DFTPR1                                                           
*                                                                               
         BC    0,DFTPR1                                                         
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (DFTPBIT1,OUTPUT)                                                
*                                                                               
DFTPR1   DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    DFTPRL                                                           
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC+18(4),=C'001,'       ADDRESS SEQUENCE                     
         MVC   PBIREC+22(7),=C'100139,'    SAC-SRC                              
         MVC   PBIREC+29(3),=C'61,'        REFERENCE TYPE                       
*                                                                               
         CLC   PBILKCLT(3),=C'TOC'      CONHILL ?                               
         BE    DFTPR3                   YES                                     
         CLC   PBILKCLT(3),=C'LEX'      TEAM ONE ?                              
         BE    DFTPR4                   YES                                     
         CLC   PBILKCLT(3),=C'LDA'      TEAM ONE ?                              
         BE    DFTPR4                   YES                                     
         CLC   PBILKCLT(3),=C'LDL'      TEAM ONE ?                              
         BE    DFTPR4                   YES                                     
         CLC   PBILKCLT(3),=C'TM '      SAATCHI ?                               
         BE    DFTPR2                   YES                                     
         CLC   PBILKCLT(3),=C'TX '      SAATCHI ?                               
         BE    DFTPR2                   YES                                     
         CLC   PBILKCLT(3),=C'TMD'      SAATCHI ?                               
         BE    DFTPR2                   YES                                     
         CLC   PBILKCLT(3),=C'TMS'      SAATCHI ?                               
         BE    DFTPR2                   YES                                     
         DC    H'0'                     MUST BE ONE OF ABOVE CLIENTS            
*                                                                               
DFTPR2   DS    0H                  SAATCHI CLIENTS                              
         MVC   PBIREC(9),=C'01001539,'     VENDOR NUMBER                        
         B     DFTPR5                                                           
*                                                                               
DFTPR3   DS    0H                  CONHILL CLIENTS                              
         MVC   PBIREC(9),=C'01021083,'     VENDOR NUMBER                        
         B     DFTPR5                                                           
*                                                                               
DFTPR4   DS    0H                  TEAM ONE CLIENTS                             
         MVC   PBIREC(9),=C'01029620,'     VENDOR NUMBER                        
         MVC   PBIREC+18(4),=C'002,'       ADDRESS SEQUENCE                     
         MVC   PBIREC+22(7),=C'100611,'    SAC-SRC                              
         MVC   PBIREC+29(3),=C'71,'        REFERENCE TYPE                       
*                                                                               
DFTPR5   DS    0H     REFERENCE NUMBER=MEDIA+MM+NNNN (8 BYTES)                  
*                                              (INVOICE NUMBER)                 
         MVC   PBIREC+09(1),PBILKMED      MEDIA                                 
         MVC   PBIREC+10(6),DINVNO        MONTH + NUMBER                        
*****    MVC   HALF,PBILKBNO                                                    
*****    LH    R0,HALF                                                          
*****    CVD   R0,DUB                                                           
*****    OI    DUB+7,X'0F'                                                      
*****    UNPK  PBIREC+12(4),DUB          INVOICE NUMBER                         
         MVI   PBIREC+17,C','                                                   
*     REFERENCE DATE - BILL INV DATE (MMDDYYYY)                                 
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,WORK)      INV DATE                 
         MVC   PBIREC+32(2),WORK+4       MM                                     
         MVC   PBIREC+34(2),WORK+6       DD                                     
         MVC   PBIREC+36(4),WORK         YYYY                                   
         MVI   PBIREC+40,C','                                                   
*                                                                               
*     PAY DATE - BILL DUE DATE LESS 2 DAYS (NOT INCLUDING WEEKENDS)             
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILDUED),(0,WORK)   DUE DATE (YYMMDD)            
         GOTO1 GETDAY,DMCB,WORK,WORK+6                                          
         CLC   WORK+6(3),=3C' '                                                 
         BNE   *+6                                                              
         DC    H'0'                INVALID DATE                                 
         ZIC   R6,0(R1)            DAY OF WEEK (1=MON...7=SUN)                  
         L     R5,=F'-4'           NUMBER OF DAYS TO SUBTRACT                   
         CH    R6,=H'1'            MONDAY ?                                     
         BE    DFTPR6              YES                                          
         CH    R6,=H'2'            TUESDAY ?                                    
         BE    DFTPR6              YES                                          
         L     R5,=F'-3'                                                        
         CH    R6,=H'7'            SUNDAY ?                                     
         BE    DFTPR6              YES                                          
         L     R5,=F'-2'           MUST BE WED - SAT                            
DFTPR6   DS    0H                                                               
         GOTO1 ADDAY,DMCB,WORK,WORK+8,(R5)                                      
         GOTO1 DATCON,DMCB,(0,WORK+8),(20,WORK),0                               
         MVC   PBIREC+41(2),WORK+4       MM                                     
         MVC   PBIREC+43(2),WORK+6       DD                                     
         MVC   PBIREC+45(4),WORK         YYYY                                   
         MVI   PBIREC+49,C','                                                   
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK    SEE IF HAVE EST HDR                          
         BE    DFTPR7              YES                                          
         MVC   WORK(64),KEY        SAVE FOR SEQ RESTORE                         
         XC    KEY,KEY                                                          
         XC    PESTUDEF,PESTUDEF   CLEAR USER DESCRIPTION ELEMENT               
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                RESTORE SEQ                                  
*                                                                               
DFTPR7   DS    0H     ESTIMATE FIELDS USED FOR NEXT THREE TAPE FIELDS           
*  GL ACCOUNT- LAST 7 DIGITS OF BUDGET CODE - (IN PESTNAM2 OR PEUSER2)          
*         **** NOTE - DASHES (-) ELIMINATED ****                                
*  AND COST CENTER                                                              
*  FIRST 4 DIGITS OF BUDGET CODE - (FROM PESTNAM2 OR PEUSER2))                  
*                                                                               
         LA    R6,7                MAX. NO OF CHARACTERS                        
         LA    R4,PBIREC+56        POINT TO END OF OUTPUT FIELD                 
         LA    R5,PESTNAM2+15      POINT TO END OF INPUT FIELD                  
         LA    R3,PESTNAM2         POINT TO START OF INPUT FIELD                
         MVC   PBIREC+58(4),PESTNAM2                                            
         MVI   PBIREC+62,C','                                                   
         CLC   =C'LDA',PBILKCLT    CLIENT USING PEUSER2 ?                       
         BNE   DFTPR7D             NO                                           
*                                                                               
         MVC   PBIREC+58(4),SPACES                                              
         MVC   PBIREC+50(7),SPACES                                              
*                                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   DFTPR7F                                                          
         MVC   PBIREC+58(4),PEUSER2                                             
         LA    R5,PEUSER2+15       POINT TO END OF INPUT FIELD                  
         LA    R3,PEUSER2          POINT TO START OF INPUT FIELD                
         B     DFTPR7D                                                          
         DROP  R2                                                               
*                                                                               
DFTPR7B  BCTR  R5,0                MOVE TO "LEFT" (INPUT)                       
         CR    R5,R3               AT END OF INPUT ?                            
         BL    DFTPR7F             YES - DID NOT GET 7 CHARACTERS               
DFTPR7D  CLI   0(R5),C' '          BLANK ?                                      
         BNH   DFTPR7B             YES - NEXT CHARACTER                         
         CLI   0(R5),C'-'          DASH ?                                       
         BE    DFTPR7B             YES - NEXT CHARACTER                         
         MVC   0(1,R4),0(R5)       MOVE DIGIT TO OUTPUT                         
         BCTR  R4,0                MOVE TO "LEFT" (OUTPUT)                      
         BCTR  R5,0                MOVE TO "LEFT" (INPUT)                       
         CR    R5,R3               AT END OF INPUT ?                            
         BL    DFTPR7F             YES - DID NOT GET 7 CHARACTERS               
         BCT   R6,DFTPR7D                                                       
DFTPR7F  MVI   PBIREC+57,C','                                                   
*                                                                               
         MVC   PBIREC+63(12),PESTNAME    ESTIMATE NUMBER                        
*                               FIRST 12 CHARACTERS OF PESTNAME                 
         MVI   PBIREC+75,C','                                                   
         GOTO1 DATCON,DMCB,(5,0),(20,WORK)   TODAY'S DATE USED FOR              
         MVC   PBIREC+76(4),WORK             CALENDAR YEAR (YYYY)               
         MVI   PBIREC+80,C','                                                   
*              PBIREC+81(7)              PROJECT # (BLANK)                      
         MVI   PBIREC+88,C','                                                   
*                                                                               
*              PBIREC+89(40)             REMARKS (LEAVE BLANK)                  
         MVI   PBIREC+129,C','                                                  
*                                                                               
         LA    R6,PBIREC+130             DIST AMT (NO COMMAS - 2 DEC)           
         EDIT  (P6,PBILLRCV),(12,0(R6)),2,FILL=0                                
         CP    PBILLRCV,=P'0'            SEE IF NEGATIVE                        
         BNL   *+8                                                              
         MVI   0(R6),C'-'                                                       
         MVI   PBIREC+142,C','                                                  
*                                        SUBSIDIARY CODE                        
         MVC   PBIREC+143(3),=C'07,'                                            
         CLC   PBIREC+58(4),=C'0110'     TEST "COST CENTER"                     
         BE    DFTPR8                                                           
         MVC   PBIREC+143(3),=C'10,'                                            
         CLC   PBIREC+58(4),=C'0877'     TEST "COST CENTER"                     
         BE    DFTPR8                                                           
         MVC   PBIREC+143(3),=C'01,'     DEFAULT SUBSIDIARY CODE                
*                                                                               
DFTPR8   MVC   PBIREC+146(4),PBIREC+76   FISCAL YEAR (YYYY)                     
*                                        SAME AS CALENDAR YEAR ABOVE            
*                                                                               
*****    ZAP   DOUBLE,PBILLNET        NET -CD                                   
*****    AP    DOUBLE,PPBVEBC         ADD CD TO GET NET                         
*****    LA    R6,PBIREC+68                                                     
*****    EDIT  (P8,DOUBLE),(11,0(R6)),0,FILL=0                                  
*****    CP     DOUBLE,=P'0'         SEE IF NEGATIVE                            
*****    BNL    *+8                                                             
*****    MVI    0(R6),C'-'                                                      
*                                                                               
*****    LA    R6,PBIREC+79                                                     
*****    EDIT  (P6,PPBVEBC),(9,0(R6)),0,FILL=0                                  
*****    CP     PPBVEBC,=P'0'        SEE IF NEGATIVE                            
*****    BNL    *+8                                                             
*****    MVI    0(R6),C'-'                                                      
*                                                                               
*****    ZAP   MYDUB,PBILLRCV         CALC COMMISSION                           
*****    TM    PBILCMSW,X'02'         UNLESS COMMISSION ONLY BILL               
*****    BNZ   DFTPR8                                                           
*****    TM    PBILBASA,X'04'         IS CD ALREADY TAKEN OUT                   
*****    BNZ   DFTPR8                 YES                                       
*****    SP    MYDUB,PPBVEBC          MINUS EFFECTIVE CD                        
*DFTPR8                                                                         
*****    SP    MYDUB,PBILLNET        RCV - NET = AC                             
*****    LA    R6,PBIREC+88                                                     
*****    EDIT  (P8,MYDUB),(11,0(R6)),0,FILL=0                                   
*****    CP     MYDUB,=P'0'        SEE IF NEGATIVE                              
*****    BNL    *+8                                                             
*****    MVI    0(R6),C'-'                                                      
*                                                                               
*****    LA    R6,PBIREC+99                                                     
*****    EDIT  (P6,PBILLGRS),(11,0(R6)),0,FILL=0                                
*****    CP     PBILLGRS,=P'0'     SEE IF NEGATIVE                              
*****    BNL    *+8                                                             
*****    MVI    0(R6),C'-'                                                      
*                                                                               
*****    MVC   PBIREC+136(2),=C'28'                                             
*****    TM    PBILKMOS,X'03'       CHECK FOR LEAP YEAR                         
*****    BNZ   DFTPR9                                                           
*****    MVC   PBIREC+136(2),=C'29'                                             
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   DFTDFTT                                                          
*NOP*    CP    DFTCOUNT,=P'50'                                                  
*NOP*    BH    DFTDFTT                                                          
         AP    DFTCOUNT,=P'1'                                                   
*****    MVC   P(23),=C'***BILLING RECORD - HEX'                                
*****    GOTO1 REPORT                                                           
*****    GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
*****    GOTO1 REPORT                                                           
*****    GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
*****    GOTO1 REPORT                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(130),PBIREC                                                    
         MVC   PSECOND(20),PBIREC+130                                           
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
DFTDFTT  DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    DFTX                                                             
*                                                                               
         LA    R1,DFTPBIT1                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DFTX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
DFTPRL   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    DFTX                                                             
*                                                                               
         LA    R2,DFTPBIT1                                                      
         CLOSE ((2),)                                                           
         B     DFTX                                                             
*                                                                               
DFTCOUNT DC    PL2'0'                                                           
*                                                                               
*                                                                               
DFTPBIT1 DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00150,                                            X        
               BLKSIZE=00150,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
         TITLE 'M2 INTERFACE'                                                   
*                                                                               
         SPACE 2                                                                
M2PROC   NMOD1 0,M2PROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    M2PR1                                                            
*                                                                               
         BC    0,M2PR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (M2PBIT1,(OUTPUT))                                               
*                                                                               
M2PR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    M2PRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC+2,C'P'       PRINT MEDIA                                  
         MVI   PBIREC+3,C'A'                                                    
         CLC   QAGENCY,=C'U#'      M2TOA?                                       
         BNE   M2PR2                                                            
         CLI   QMEDIA,C'M'         MAG                                          
         BE    M2PR2                                                            
*******  CLI   QMEDIA,C'S'         SUPPLEMENTS  - NOW REPORT AS S               
*******  BE    M2PR2                                                            
         CLI   QMEDIA,C'T'         TRADE                                        
         BE    M2PR2                                                            
         MVC   PBIREC+3(1),QMEDIA   FOR MEDIA O,I,N,S,L,B,V,W                   
*                                                                               
M2PR2    MVC   PBIREC+5(3),PBILKCLT                                             
*                                                                               
M2PR4    DS    0H                                                               
         TM    PBILCMSW,X'20'          SEE IF AOR BILL                          
         BZ    M2PR6                                                            
         GOTO1 =A(GETAOR)                                                       
         MVC   PBIREC+11(3),=C'AOR'    AOR INDICATOR                            
         MVC   PBIREC+72(12),WORK  AOR NAME - ONLY ROOM FOR 12 CHARS            
M2PR6    DS    0H                                                               
         MVC   PBIREC+18(2),DINVNO                                              
         MVC   HALF,PBILKBNO                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+20(4),DUB                                                 
*                                                                               
*     BILL DATE - BILL INV DATE (MMDDYYYY)                                      
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,WORK)      INV DATE                 
         MVC   PBIREC+24(2),WORK+4       MM                                     
         MVC   PBIREC+26(2),WORK+6       DD                                     
         MVC   PBIREC+28(4),WORK         YYYY                                   
*                                                                               
         CP    PBILLRCV,=P'0'        SEE IF POSITIVE                            
         BL    *+8                                                              
         MVI   PBIREC+32,C'+'                                                   
         EDIT  PBILLRCV,(9,PBIREC+33),ZERO=NOBLANK                              
         CLC   PBIREC+40(2),=C' 0'                                              
         BNE   *+8                                                              
         MVI   PBIREC+40,C'0'           ALTER 0 TO 00                           
*                                                                               
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         CP    DOUBLE,=P'0'        SEE IF POSITIVE                              
         BL    *+8                                                              
         MVI   PBIREC+42,C'+'                                                   
         EDIT  (P8,DOUBLE),(9,PBIREC+43),ZERO=NOBLANK                           
         CLC   PBIREC+50(2),=C' 0'                                              
         BNE   *+8                                                              
         MVI   PBIREC+50,C'0'           ALTER 0 TO 00                           
*                                                                               
         ZAP   DUB,PPBVEBC              EFFECTIVE CD                            
         ZAP   DOUBLE,PBILLNET        NET -CD                                   
         AP    DOUBLE,DUB             ADD CD TO GET NET                         
*                                                                               
         ZAP   MYDUB,PBILLRCV                                                   
         SP    MYDUB,DOUBLE            REVENUE = RCV - NET                      
         CP    MYDUB,=P'0'         SEE IF POSITIVE                              
         BL    *+8                                                              
         MVI   PBIREC+52,C'+'                                                   
         EDIT  MYDUB,(9,PBIREC+53),ZERO=NOBLANK                                 
         CLC   PBIREC+60(2),=C' 0'                                              
         BNE   *+8                                                              
         MVI   PBIREC+60,C'0'           ALTER 0 TO 00                           
*                                                                               
         CP    PPBVEBC,=P'0'         SEE IF POSITIVE                            
         BL    *+8                                                              
         MVI   PBIREC+62,C'+'                                                   
         EDIT  PPBVEBC,(9,PBIREC+63),ZERO=NOBLANK                               
         CLC   PBIREC+70(2),=C' 0'                                              
         BNE   *+8                                                              
         MVI   PBIREC+70,C'0'           ALTER 0 TO 00                           
*                                                                               
*     DUE DATE - DUE INV DATE (MMDDYYYY)                                        
         GOTO1 DATCON,DMCB,(3,PBILDUED),(20,WORK)      DUE DATE                 
         MVC   PBIREC+84(2),WORK+4       MM                                     
         MVC   PBIREC+86(2),WORK+6       DD                                     
         MVC   PBIREC+88(4),WORK         YYYY                                   
*                                                                               
         MVC   PBIREC+92(2),PBIREC+24    BILL MM                                
         MVC   PBIREC+94(4),PBIREC+28    BILL YYYY                              
*                                                                               
         CP    MYHST,=P'0'              ANY HST?                                
         BNE   M2HST                                                            
         CP    MYPST,=P'0'              QST?                                    
         BNE   M2QST                                                            
         CP    MYGST,=P'0'              ANY GST?                                
         BNE   M2GST                                                            
*                                                                               
*        NO TAXES PRESENT - JUST SEND $0 TAXES                                  
*                                                                               
*****    MVC   PBIREC+98(3),=C'GST'                                             
         MVI   PBIREC+101,C'+'                                                  
         MVC   PBIREC+109(2),=C'00'    NO QST EITHER                            
         MVI   PBIREC+111,C'+'                                                  
         MVC   PBIREC+119(2),=C'00'    NO GST EITHER                            
         B     M2P20                                                            
*                                                                               
M2GST    DS    0H               ONLY GST                                        
         MVC   PBIREC+98(3),=C'GST'                                             
         MVI   PBIREC+101,C'+'                                                  
         MVC   PBIREC+109(2),=C'00'    NO QST                                   
         CP    MYGST,=P'0'                                                      
         BL    *+8                                                              
         MVI   PBIREC+111,C'+'                                                  
         EDIT  MYGST,(9,PBIREC+112),ZERO=NOBLANK                                
         CLC   PBIREC+119(2),=C' 0'                                             
         BNE   *+8                                                              
         MVI   PBIREC+119,C'0'          ALTER 0 TO 00                           
         B     M2P20                                                            
*                                                                               
*                                                                               
M2QST    DS    0H               QST PRESENT WITHOUT HST                         
         MVC   PBIREC+98(3),=C'QST'                                             
         CP    MYPST,=P'0'                                                      
         BL    *+8                                                              
         MVI   PBIREC+101,C'+'                                                  
         EDIT  MYPST,(9,PBIREC+102),ZERO=NOBLANK                                
         CLC   PBIREC+109(2),=C' 0'                                             
         BNE   *+8                                                              
         MVI   PBIREC+109,C'0'          ALTER 0 TO 00                           
         CP    MYGST,=P'0'                                                      
         BL    *+8                                                              
         MVI   PBIREC+111,C'+'                                                  
         EDIT  MYGST,(9,PBIREC+112),ZERO=NOBLANK                                
         CLC   PBIREC+119(2),=C' 0'                                             
         BNE   *+8                                                              
         MVI   PBIREC+119,C'0'          ALTER 0 TO 00                           
         B     M2P20                                                            
*                                                                               
M2HST    DS    0H               HST PRESENT                                     
         SP    MYPST,MYHST      REMOVE HST FROM PST                             
         CP    MYPST,=P'0'      ANY QST?                                        
*******  BNE   M2HSTQ           BRANCH TO DIE                                   
         BNE   M2QST            PROCESS QST (WITH GST) FIRST                    
         CP    MYGST,=P'0'      GST PRESENT?                                    
*******  BNE   M2HSTG           BRANCH TO DIE                                   
         BNE   M2GST            PROCESS GST                                     
*                               IF NEITHER SEND $0 FOR THOSE TAXES              
*                               SEEMS THEY WANT WITHOUT CODES                   
         MVI   PBIREC+101,C'+'                                                  
         MVC   PBIREC+102(9),=C'       00'    NO QST EITHER                     
         MVI   PBIREC+111,C'+'                                                  
         MVC   PBIREC+112(9),=C'       00'    NO GST EITHER                     
         B     M2P20                                                            
*                                                                               
M2HSTQ   DC    H'0'             THEY CLAIM THIS WON'T HAPPEN                    
*                                                                               
M2HSTG   DC    H'0'             THEY CLAIM THIS WON'T HAPPEN                    
*                                                                               
M2P20    MVC   PBIREC+121(2),=C'07'                                             
         CLC   RCORIGID,=X'39E6'         UMTOA? ID # 14822                      
         BE    M2P20A                                                           
         MVC   PBIREC+121(2),=C'05'                                             
         CLC   RCORIGID,=X'3E71'         INMETO ID # 15985                      
         BE    M2P20A                                                           
         MVC   PBIREC+121(2),=C'04'                                             
         CLC   RCORIGID,=X'3E66'         ORTO ID # 15974                        
         BE    M2P20A                                                           
         MVC   PBIREC+121(2),=C'09'                                             
         CLC   RCORIGID,=X'3FB6'         CITO ID # 16310                        
         BE    M2P20A                                                           
         MVC   PBIREC+121(2),=C'08'                                             
         CLC   RCORIGID,=X'3FB7'         RMTO ID # 16310                        
         BE    M2P20A                                                           
         MVC   PBIREC+121(2),=C'01'      OTHER M2 IDS                           
         CLC   QAGENCY,=C'WT'            WITO?                                  
         BNE   *+10                                                             
         MVC   PBIREC+121(2),=C'05'      COMPANY CODE FOR WITO                  
*                                                                               
M2P20A   MVC   PBIREC+123(2),PCLTAOFC    ACC OFFICE                             
         MVC   PBIREC+125(3),PBILKPRD                                           
         CLI   PBRETAIL,0                RETAIL BILL?                           
         BE    M2P25                                                            
*                                                                               
*        LEFT JUSTIFY RETAIL PARTICIPANT CODE                                   
*                                                                               
         LA    R2,PBIREC+140                                                    
         LA    R3,PBRACCT+11                                                    
         LA    R4,12         FOR BCT                                            
M2P20B   CLI   0(R3),C' '    ANY CHARACTER THERE?                               
         BH    M2P20C                                                           
         BCTR  R3,0           BACK UP R3                                        
         BCT   R4,M2P20B                                                        
         B     M2P20X                                                           
*                                                                               
M2P20C   MVC   0(1,R2),0(R3)                                                    
         BCTR  R2,0          BACK UP BOTH R2 AND R3                             
         BCTR  R3,0                                                             
         BCT   R4,M2P20B                                                        
         B     M2P20X                                                           
*                                                                               
M2P20X   OC    PBIREC+129(12),=12C'0'                                           
*                                                                               
M2P25    DS    0H                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   M2PUT                                                            
         CP    M2COUNT,=P'50'                                                   
         BH    M2PUT                                                            
         AP    M2COUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
*                                                                               
M2P30    DS    0H                                                               
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(17),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,11,0                                    
         GOTO1 REPORT                                                           
         B     *+6                                                              
M2COUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
M2PUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    M2PUT5                                                           
*                                                                               
         LA    R1,M2PBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
M2PUT5   CP    MYHST,=P'0'          ANY HST PRESENT?                            
         BE    M2X                  NO - THEN DONE                              
*                                                                               
*        CLEAR BILL AMOUNTS AND SEND HST IN ANOTHER RECORD                      
*                                                                               
         MVI   PBIREC+32,C'+'                                                   
         MVC   PBIREC+33(9),=C'       00'                                       
         MVI   PBIREC+42,C'+'                                                   
         MVC   PBIREC+43(9),=C'       00'                                       
         MVI   PBIREC+52,C'+'                                                   
         MVC   PBIREC+53(9),=C'       00'                                       
         MVI   PBIREC+62,C'+'                                                   
         MVC   PBIREC+63(9),=C'       00'                                       
         MVC   PBIREC+98(3),=C'HST'                                             
         MVI   PBIREC+101,C'+'                                                  
         MVC   PBIREC+102(9),=C'       00'                                      
*                                                                               
         MVI   PBIREC+111,C' '       CLEAR POSITIVE SIGN                        
*                                                                               
         CP    MYHST,=P'0'                                                      
         BL    *+8                                                              
         MVI   PBIREC+111,C'+'                                                  
         EDIT  MYHST,(9,PBIREC+112),ZERO=NOBLANK                                
         CLC   PBIREC+119(2),=C' 0'                                             
         BNE   *+8                                                              
         MVI   PBIREC+119,C'0'     ALTER 0 TO 00                                
*                                                                               
         ZAP   MYHST,=P'0'         SO I WON'T DO ANOTHER                        
         AP    M2COUNT,=P'1'                                                    
         B     M2P30                DO HST RECORD                               
*                                                                               
M2X      DS    0H                                                               
         XIT1                                                                   
*                                                                               
M2PRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    M2X                                                              
*                                                                               
         LA    R2,M2PBIT1                                                       
         CLOSE ((2),)                                                           
         B     M2X                                                              
*                                                                               
M2PBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00141,                                            X        
               BLKSIZE=00141,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
*                                                                               
         TITLE 'OMD - EDWARD JONES'                                             
*                             TAPE CODE E                                       
         SPACE 2                                                                
OOPROCE  NMOD1 0,OOPROCE                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
         BC    0,OO1                                                            
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (OOBIT1,(OUTPUT))                                                
         ZAP   OORECS,=P'0'                                                     
*                                                                               
OO1      DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    OOL                                                              
*                                                                               
         OC    PBILKEST,PBILKEST   SKIP EST 0 BILLS                             
         BZ    OOX                                                              
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(100),PBIREC   CLEAR ALL 350 BYTES                     
*                                                                               
*        MUST READ ESTIMATE HEADER                                              
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    OO1B                YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
OO1B     DS    0H                                                               
*                                                                               
*                                                                               
OO1D     DS    0H                                                               
*                                                                               
*        HEADER RECORD                                                          
*                                                                               
         MVC   PBIREC(2),=C'00'           SPECIAL IDENTIFER                     
         MVC   PBIREC+4(6),DINVNO         SHORT INVOICE #                       
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,WORK)      INV DATE                 
         MVC   PBIREC+16(2),WORK+4       MM                                     
         MVC   PBIREC+18(2),WORK+6       DD                                     
         MVC   PBIREC+20(4),WORK         YYYY                                   
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILDUED),(20,WORK)      DUE DATE                 
         MVC   PBIREC+26(2),WORK+4       MM                                     
         MVC   PBIREC+28(2),WORK+6       DD                                     
         MVC   PBIREC+30(4),WORK         YYYY                                   
*                                                                               
         MVC   PBIREC+36(5),=C'PROMP'        VENDOR IDENTIFER                   
         CLC   QAGENCY,=C'OU'             OMDTO?                                
         BNE   *+10                                                             
         MVC   PBIREC+36(5),=C'PRMPC'        VENDOR IDENTIFER                   
*                                                                               
         MVC   PBIREC+62(15),ZEROS                                              
         MVC   PBIREC+77(15),ZEROS                                              
         MVC   PBIREC+92(15),ZEROS                                              
         MVC   PBIREC+107(15),ZEROS                                             
         MVC   PBIREC+192(15),ZEROS                                             
*                                                                               
         MVI   PBIREC+349,C'0'           SO RECORD WON'T BE COMPRESSED          
*                                        WHEN TRANSMITTED                       
         BAS   RE,OOOUT                      OUTPUT HEADER RECORD               
*                                                                               
*        DETAIL RECORD                                                          
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(100),PBIREC   CLEAR ALL 350 BYTES                     
*                                                                               
         MVC   PBIREC(2),=C'01'              SPECIAL IDENTIFER                  
         MVC   PBIREC+2(3),=C'USA'           COUNTRY                            
*                                                                               
         CLC   QAGENCY,=C'OU'                SEE IF CANADIAN                    
         BNE   *+10                                                             
         MVC   PBIREC+2(3),=C'CAN'                                              
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'                LOOK FOR USER ELEMENT               
         BRAS  RE,NEXTELM                                                       
         BNE   OO1D5                                                            
         MVC   PBIREC+10(5),PUSER1          HEADQUATER #                        
*                                                                               
         DROP  R2                                                               
*                                                                               
OO1D5    DS    0H                                                               
         MVI   PBIREC+16,C'H'                HEADQUARTER/ IR IDENTIFER          
*                                            H=HEADQUATERS,I= IR                
         ZAP   MYDUB,PBILLNET                NET-CD                             
*                                                                               
         CLC   QAGENCY,=C'OU'                SEE IF CANADIAN                    
         BNE   OOD16                                                            
         CLC   PBILLDAT,=X'FAF8F0F1F0F9'   SEE IF BEFORE JAN09/08               
         BL    OO1D7                       IF SO, USE NET-CD                    
*                                                                               
OOD16    CLI   PBILBASA,X'06'     NET-CD IN FORMULA?                            
         BE    OO1D7                                                            
         AP    MYDUB,PPBVEBC      PLUS EFFECTIVE CD  = G - AC (NET)             
         CLI   PBILBASA,X'02'     NET IN FORMULA?                               
         BE    OO1D7                                                            
         DC    H'0'               MUST BE ONE OF THOSE                          
*                                                                               
OO1D7    EDIT  MYDUB,(15,PBIREC+62),2,FILL=0,ZERO=NOBLANK                       
         CP    MYDUB,=P'0'                                                      
         BNL   *+8                                                              
         MVI   PBIREC+62,C'-'                                                   
*                                                                               
OOP10    DS    0H                                                               
         CLC   QAGENCY,=C'OU'         SEE IF CANADIAN                           
         BE    OOP10C                                                           
         L     R0,PPBVETAX                                                      
         CVD   R0,MYDUB                                                         
         EDIT  MYDUB,(15,PBIREC+77),2,FILL=0,ZERO=NOBLANK                       
         CP    MYDUB,=P'0'                                                      
         BNL   *+8                                                              
         MVI   PBIREC+77,C'-'                                                   
*                                                                               
         MVC   PBIREC+92(15),ZEROS     FREIGHT AMOUNT                           
         MVI   PBIREC+104,C'.'         DECIMAL                                  
         MVC   PBIREC+107(15),ZEROS    MISCELLANEOUS AMOUNT                     
         MVI   PBIREC+119,C'.'         DECIMAL                                  
         B     OOP20                                                            
*                                                                               
OOP10C   DS    0H                   FOR CANADIAN AGY DO CANADIAN TAXES          
         ZAP   MYDUB,MYGST          GST                                         
         EDIT  MYDUB,(15,PBIREC+77),2,FILL=0,ZERO=NOBLANK                       
         CP    MYDUB,=P'0'                                                      
         BNL   *+8                                                              
         MVI   PBIREC+77,C'-'                                                   
*                                                                               
OOP10C10 ZAP   MYDUB,MYHST          HST                                         
         EDIT  MYDUB,(15,PBIREC+92),2,FILL=0,ZERO=NOBLANK                       
         CP    MYDUB,=P'0'                                                      
         BNL   *+8                                                              
         MVI   PBIREC+92,C'-'                                                   
*                                                                               
OOP10C20 ZAP   MYDUB,MYPST          QST = PST-HST                               
         SP    MYDUB,MYHST                                                      
         EDIT  MYDUB,(15,PBIREC+107),2,FILL=0,ZERO=NOBLANK                      
         CP    MYDUB,=P'0'                                                      
         BNL   *+8                                                              
         MVI   PBIREC+107,C'-'                                                  
*                                                                               
OOP20    DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   OOP30                                                            
         MVC   PBIREC+122(15),PEUSER2         PROJECT CODE                      
         OC    PBIREC+122(15),SPACES                                            
         MVC   PBIREC+315(10),PEUSER1         ITEM NUMBER                       
         OC    PBIREC+315(10),SPACES                                            
         DROP  R2                                                               
*                                                                               
OOP30    DS    0H                                                               
         MVC   PBIREC+250(7),=C'GENERAL'          ACTIVITY ID#                  
         MVC   PBIREC+265(3),=C'ACT'              ANALYSIS TYPE                 
         MVC   PBIREC+268(5),=C'PRGRM'            RESOURCE TYPE                 
         MVC   PBIREC+273(5),=C'ADVRT'            RESOURCE CATEGORY             
*                                                                               
         MVC   PBIREC+137(6),DINVNO SHORT INVOICE #                             
*                                                                               
         MVC   PBIREC+192(15),ZEROS NUMBER OF ITEMS ORDERED                     
*                                                                               
         MVI   PBIREC+231,C'A'      INVOICE/ALLOCATE INDICATOR                  
*                                                                               
         MVC   PBIREC+291(10),ZEROS PO LINE NUMBER                              
*                                                                               
         MVC   SVEDWARD,PBIREC+62  SAVE $ AMOUNTS FOR TRAILER RECORD            
*                                                                               
         MVI   PBIREC+349,C'0'           SO RECORD WON'T BE COMPRESSED          
*                                        WHEN TRANSMITTED                       
         BAS   RE,OOOUT                      OUTPUT DETAIL RECORD               
*                                                                               
*        TRAILER RECORD                                                         
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         MVC   PBIREC+250(100),PBIREC   CLEAR ALL 350 BYTES                     
*                                                                               
         MVC   PBIREC(2),=C'99'              SPECIAL IDENTIFER                  
*                                                                               
         MVC   PBIREC+62(L'SVEDWARD),SVEDWARD   RESTORE AMOUNTS                 
*                                                                               
         MVC   PBIREC+192(15),ZEROS          NUMBER OF ITEMS ORDERED            
*                                                                               
         MVI   PBIREC+349,C'0'           SO RECORD WON'T BE COMPRESSED          
*                                        WHEN TRANSMITTED                       
         BAS   RE,OOOUT                  OUTPUT TRAILER RECORD                  
         B     OOX                                                              
         EJECT                                                                  
*                                                                               
OOOUT    NTR1                                                                   
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BNE   OOPUT                                                            
         CP    OORECS,=P'50'                                                    
         BH    OOPUT                                                            
         AP    OORECS,=P'1'                                                     
         CLC   PBIREC(2),=C'00'      ONLY DO BILLING RECORD FOR HEADER          
         BNE   OOOUTT                                                           
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
OOOUTT   MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(120),PBIREC                                                    
         MVC   PSECOND(120),PBIREC+120                                          
         GOTO1 REPORT                                                           
         MVC   P(110),PBIREC+240                                                
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+195,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+260,P,65,0                                    
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+325,P,25,0                                    
         GOTO1 REPORT                                                           
*                                                                               
OOPUT    DS    0H                                                               
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BE    OOX                                                              
*                                                                               
         LA    R1,OOBIT1                                                        
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
OOX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
OOL      DS    0H                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
*                                                                               
         LA    R2,OOBIT1                                                        
         CLOSE ((2),)                                                           
         B     OOX                                                              
         SPACE 2                                                                
         LTORG                                                                  
*                                                                               
*        MAY NEED FOR GET USER DATA                                             
*                                                                               
NEXTELO  NTR1  BASE=*,LABEL=*                                                   
NEXTELO5 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELOX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELO5                                                         
NEXTELOX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
OOBIT1   DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00350,                                            X        
               BLKSIZE=00350,                                          X        
               MACRF=PM                                                         
         SPACE 2                                                                
         EJECT                                                                  
         TITLE 'MEDIACOM - GREY'                                                
*                                  MEDIACOM                                     
         SPACE 2                                                                
M2GPROC  NMOD1 0,M2GPROC                                                        
         L     RC,PPFILEC                                                       
         SPACE 2                                                                
*                                                                               
         CLI   MODE,RUNLAST                                                     
         BE    M2GL                                                             
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    M2G2                                                             
*                                                                               
         BC    0,M2G2                                                           
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (M2GBIT1,(OUTPUT))                                               
         MVI   DYNSW,C'Y'                                                       
*                                                                               
M2G2     DS    0H                                                               
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC(2),DINVMED     MEDIA PART                                 
         CLI   DINVMED,C' '   SEE IF BEGINS WITH BLANK                          
         BH    M2G2A                                                            
         MVC   PBIREC(1),DINVMED+1                                              
*                                                                               
M2G2A    LA    R1,PBIREC+1       MEDIA CODE COULD BE 1 OR 2 CHARACTERS          
         CLI   PBIREC+1,C' '     SOMETHING THERE?                               
         BNH   *+8                                                              
         LA    R1,PBIREC+2                                                      
*                                                                               
         MVC   0(6,R1),DINVNO    SHORT INVOICE #   YMNNNN                       
*                                                                               
M2G4     DS    0H                                                               
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+8(3),DUB        EST                                       
*                                                                               
         LA    R4,M2BRTAB                                                       
*                                                                               
         CLC   QAGENCY,=C'M2'   MEDIACOM?                                       
         BE    M2G4C                                                            
         LA    R4,WGBRTAB                                                       
         CLC   QAGENCY,=C'G+'   WINGLATINO?                                     
         BE    M2G4C                                                            
         LA    R4,H7BRTAB                                                       
         CLC   QAGENCY,=C'H7'   MAXUS?                                          
         BE    M2G4C                                                            
         DC    H'0'             UNKNOWN AGENCY ACCESSING THIS SPEC              
*                                                                               
M2G4C    CLI   0(R4),X'FF'      END OF TABLE                                    
         BNE   *+6                                                              
         DC    H'0'       UNKNOWN OFFICE                                        
         CLC   0(1,R4),PCLTOFF   (INTERNAL HEX CODE)                            
         BE    M2G4E                                                            
         LA    R4,7(R4)                                                         
         B     M2G4C                                                            
*                                                                               
M2G4E    MVC   PBIREC+18(4),3(R4)   SET RANCH FROM OFFICE TABLE                 
*                                                                               
         LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELM                                                       
         BNE   M2G4G                                                            
         MVC   PBIREC+22(6),PUSER1   AR CLT AND PRD CODES                       
*                                                                               
         DROP  R2                                                               
*                                                                               
M2G4G    DS    0H                                                               
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(X'14',WORK)   INV DATE                 
         MVC   PBIREC+28(8),WORK       (HAS CENTURY)                            
*                                                                               
         MVC   WORK(2),PBILKMOS                                                 
         MVI   WORK+3,X'01'     SET DAY TO 01                                   
         GOTO1 DATCON,DMCB,(3,WORK),(X'14',PBIREC+36)  MOS WITH CENTURY         
         MVC   PBIREC+42(2),SPACES  CLEAR DAY                                   
*                                                                               
         MVC   PBIREC+42(2),=C'62'       OOH                                    
         CLI   QMEDIA,C'O'               OUTDOOR                                
         BE    M2G6                                                             
         MVC   PBIREC+42(2),=C'54'       NEWSPAPERS/SUPPLEMENTS                 
         CLI   QMEDIA,C'N'                                                      
         BE    M2G6                                                             
         MVC   PBIREC+42(2),=C'44'       MAGAZINES/TRADES                       
         CLI   QMEDIA,C'M'                                                      
         BE    M2G6                                                             
         CLI   QMEDIA,C'T'                                                      
         BE    M2G6                                                             
         MVC   PBIREC+42(2),=C'32'       INTERACTIVE                            
         CLI   QMEDIA,C'I'                                                      
         BE    M2G6                                                             
         CLI   QMEDIA,C'L'               SOCIAL                                 
         BE    M2G6                                                             
         CLI   QMEDIA,C'S'               THEY USE FOR SEARCH                    
         BE    M2G6                                                             
         DC    H'0'                     UNKNOWN MEDIA                           
*                                                                               
M2G6     DS    0H                                                               
*                                                                               
         TM    PBILCMSW,X'20'          SEE IF AOR BILL                          
         BNZ   M2GAOR                                                           
*                                                                               
         UNPK  PBIREC+44(10),PBILLNET                                           
         OI    PBIREC+53,X'F0'                                                  
         MVI   PBIREC+54,C'+'                                                   
         CP    PBILLNET,=P'0'                                                   
         BNL   *+8                                                              
         MVI   PBIREC+54,C'-'                                                   
*                                                                               
         MVC   PBIREC+55(11),=C'0000000000+'    OR CD?                          
*                                                                               
         ZAP   DUB,PBILLRCV                                                     
         SP    DUB,PBILLNET                                                     
         UNPK  PBIREC+66(10),DUB     ACTUAL-NET = COMMISSION                    
         OI    PBIREC+75,X'F0'                                                  
         MVI   PBIREC+76,C'+'                                                   
         CP    DUB,=P'0'                                                        
         BNL   *+8                                                              
         MVI   PBIREC+76,C'-'                                                   
*                                                                               
         MVC   PBIREC+77(11),=C'0000000000+'    OR CD?                          
         B     M2G30                                                            
*                                                                               
M2GAOR   DS    0H                    AOR CODE                                   
*                                                                               
         MVC   PBIREC+44(11),=C'0000000000+'                                    
         MVC   PBIREC+55(11),=C'0000000000+'                                    
         MVC   PBIREC+66(11),=C'0000000000+'                                    
*                                                                               
         UNPK  PBIREC+77(10),PBILLRCV   ONLY SEND AMOUNT DUE                    
         OI    PBIREC+86,X'F0'                                                  
         MVI   PBIREC+87,C'+'                                                   
         CP    PBILLRCV,=P'0'                                                   
         BNL   *+8                                                              
         MVI   PBIREC+87,C'-'                                                   
         MVC   PBIREC+92(2),=C'IC'    STANDS FOR INTERCOMPANY                   
*                                                                               
M2G30    MVC   PBIREC+88(3),PBILKPRD                                            
*                                                                               
         MVI   PBIREC+145,C'0'          LAST BYTE                               
*                                                                               
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BNE   M2GPUT                                                           
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
*                                                                               
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(120),PBIREC                                                    
         MVC   PSECOND(26),PBIREC+120                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,15,0                                    
         GOTO1 REPORT                                                           
         GOTO1 REPORT                                                           
*                                                                               
M2GPUT   DS    0H                                                               
         CLI   QOPT7,C'Y'    TEST RUN                                           
         BE    M2GX                                                             
*                                                                               
         LA    R1,M2GBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
M2GX     DS    0H                                                               
         XIT1                                                                   
*                                                                               
M2GL     DS    0H                                                               
         CLI   DYNSW,C'Y'      WAS TAPE ALLOCATED?                              
         BNE   M2GX            IF NOT DON'T TRY TO CLOSE                        
*                                                                               
         LA    R2,M2GBIT1                                                       
         CLOSE ((2),)                                                           
         B     M2GX                                                             
         SPACE 2                                                                
M2GBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00146,                                            X        
               BLKSIZE=00146,                                          X        
               MACRF=PM                                                         
         SPACE 3                                                                
         LTORG                                                                  
*                                                                               
*        INTERNAL HEX CODE, 2 CHAR, BRANCH CODE                                 
*                                                                               
M2BRTAB  DC    X'43',C'GG',C'0001'                                              
         DC    X'45',C'G1',C'0013'                                              
         DC    X'46',C'JB',C'0008'                                              
         DC    X'44',C'WL',C'0053'                                              
         DC    X'4A',C'G5',C'0045'                                              
         DC    X'49',C'G2',C'0138'                                              
         DC    X'4C',C'G3',C'0017'                                              
         DC    X'FFFF'        END OF TABLE                                      
*                                                                               
H7BRTAB  DC    X'46',C'RX',C'0001'                                              
         DC    X'FFFF'        END OF TABLE                                      
*                                                                               
*        OFFICE CODE, 2 CHAR, GFMS BRANCH CODE                                  
*                                                                               
WGBRTAB  DC    C'M',C'M ',C'0152'                                               
         DC    C'A',C'A ',C'0152'     NOT SURE THIS IS RIGHT                    
         DC    C'N',C'N ',C'0053'                                               
         DC    C'L',C'L ',C'0057'                                               
         DC    C'S',C'S ',C'0045'     NEW MAY27/2010                            
         DC    X'FFFF'        END OF TABLE                                      
         EJECT                                                                  
*                             GETAOR - GET AOR INFO                             
         SPACE 2                                                                
GETAOR   CSECT                                                                  
         NMOD1 0,GETAOR                                                         
         L     RC,PPFILEC                                                       
*                                                                               
         MVC   WORK(30),SPACES                                                  
*                                                                               
         MVC   SVKEY,KEY          SAVE KEY                                      
*                                                                               
         XC    KEY,KEY                                                          
*                                                                               
         MVC   KEY(11),PBILLREC    AGY/MED/CLT/PRD/EST                          
         MVI   KEY+3,X'14'                                                      
         GOTO1 HIGH                                                             
         CLC   KEY(12),KEYSAVE                                                  
         BE    GAO4                                                             
         MVC   KEYSAVE+10(2),=X'FFFF'                                           
         CLC   KEY(12),KEYSAVE          SEE IF I FOUND ALL EST REC              
         BE    GAO4                                                             
         MVC   KEY(25),KEYSAVE                                                  
         GOTO1 HIGH                     TRY FOR ALL EST RECORD                  
         CLC   KEY(12),KEYSAVE                                                  
         BNE   GETAORX            NOT FOUND                                     
*                                                                               
*                                                                               
GAO4     DS    0H                                                               
*NOP*    LA    R7,PCONREC          USE CONTRACT RECORD AREA                     
         LA    R7,PJOBREC          USE JOB RECORD AREA                          
*                                                                               
         ST    R7,AREC                                                          
         USING AORREC,R7                                                        
         GOTO1 GETPRT                                                           
*                                                                               
GAO5     DS    0H                                                               
         LA    R2,AORELS                                                        
*                                                                               
GAO6     DS    0H                                                               
         CLI   0(R2),X'02'         ADDRESS ELEM                                 
         BE    GAO7                                                             
         CLI   0(R2),X'03'         AOR INFO ELEM                                
         BE    GAO8                                                             
         CLI   0(R2),0             EOR                                          
         BE    GAO9                                                             
*                                                                               
GAO6D    DS    0H                                                               
         ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         B     GAO6                                                             
*                                                                               
GAO7     DS    0H                  AOR ADDRESS ELEM                             
         USING AORADREL,R2                                                      
         MVC   WORK(30),AORLIN1                                                 
         B     GETAORX                                                          
*                                                                               
GAO8     B     GAO6D           SKIP THIS ELEM                                   
*                                                                               
GAO9     DS    0H                                                               
GETAORX  DS    0H                                                               
         MVC   KEY,SVKEY       RESTORE SEQ READ                                 
         GOTO1 HIGH                                                             
         XIT1                                                                   
         DROP  R2                                                               
         DROP  R7                                                               
         SPACE 2                                                                
         LTORG                                                                  
SVKEY    DS    CL32                                                             
         EJECT                                                                  
         TITLE 'BURGER KING INTERFACE'                                          
*                                                                               
         SPACE 2                                                                
BKPROC   NMOD1 0,BKPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
*  NOTE: FOR BURGER KING  - FILE HAS ALREADY BEEN ALLOCATED                     
*                           AND OPENED                                          
*                                                                               
**       CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
**       BE    BKPR1                                                            
**                                                                              
**       BC    0,BKPR1                                                          
**       OI    *-3,X'F0'                                                        
**       GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
**       OPEN  (BKPBIT1,(OUTPUT))                                               
**                                                                              
BKPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    BKPRL                                                            
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   PBIREC(4),=C'US60'        COMPANY CODE                           
         MVC   PBIREC+16(5),=C'64581'    VENDOR NUMBER                          
         MVC   PBIREC+5(3),PBILKCLT                                             
*                                                                               
*        BK FISCAL YEAR GOES IN COL 5-8                                         
*                                                                               
         MVC   WORK(2),PBILKMOS         YR/MTH OF SERVICE                       
         MVI   WORK+2,X'01'             SET DAY TO 1                            
         GOTO1 DATCON,DMCB,(3,WORK),(20,WORK+6)                                 
         MVC   BKBYR(4),WORK+6     YEAR OF SERVICE                              
         MVC   BKBMTH,WORK+10                                                   
         MVC   BKFISCAL,WORK+6                                                  
*                                                                               
         CLC   WORK+6(4),=C'2011'                                               
         BNL   H7P5                IF IN 2011 OR LATER                          
*                                  LEAVE FISCAL YEAR ALONE                      
         CLC   WORK+10(2),=C'06'   FISCAL YEAR START JULY                       
         BNH   H7P5                                                             
*                                                                               
         GOTO1 ADDAY,DMCB,(C'Y',WORK+8),WORK+12,F'1'                            
         GOTO1 DATCON,DMCB,(0,WORK+12),(20,WORK+6)                              
         MVC   BKFISCAL,WORK+6       CCYY FOR NEXT YEAR                         
*                                                                               
H7P5     MVC   PBIREC+4(4),BKFISCAL                                             
*                                                                               
*                                                                               
*     BILL DATE - BILL INV DATE (MMDDYYYY)                                      
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,WORK)      INV DATE                 
         MVC   PBIREC+8(2),WORK+4       MM                                      
         MVC   PBIREC+10(2),WORK+6       DD                                     
         MVC   PBIREC+12(4),WORK         YYYY                                   
*                                                                               
         MVC   PBIREC+26(2),=C'H1'     INVOICE HEADER                           
         MVC   PBIREC+28(L'DINVFULL),DINVFULL                                   
         MVC   PBIREC+44(3),=C'USD'      CURRENCY CODE                          
         EDIT  PBILLRCV,(11,PBIREC+47),2,FILL=0,ZERO=NOBLANK                    
         L     R0,PPBVETAX               PPBVETAX IS BINARY                     
         CVD   R0,MYDUB                  SALES TAX - U.S.                       
         EDIT  MYDUB,(11,PBIREC+58),2,FILL=0,ZERO=NOBLANK                       
         ZAP   MYDUB,PPBVEBC              EFFECTIVE CD                          
         EDIT  MYDUB,(11,PBIREC+69),2,FILL=0,ZERO=NOBLANK                       
*                                                                               
         MVI   PBIREC+77,C'.'      DECIMAL POINT IN DISCOUNT FIELD              
*                                                                               
*        COMMISSION CALCULATION                                                 
*                                                                               
         ZAP   BKCOM,PBILLRCV    RECEIVABLE                                     
         SP    BKCOM,PBILLNET    MINUS (G-AC-CD)                                
         TM    PBILBASA,X'04'    TEST CD REFLECTED IN RCV                       
         BNZ   *+10                                                             
         SP    BKCOM,MYDUB       SUBTRACT CD                                    
*                                                                               
         MVC   PBIREC+80(2),=C'DI'                                              
         CP    PBILLRCV,=P'0'                                                   
         BNL   *+16                                                             
         MVC   PBIREC+80(2),=C'CN'                                              
         MVC   PBIREC+82(11),=C'CREDIT MEMO'                                    
*                                                                               
BKPR4    DS    0H                                                               
*                                                                               
BKP25    DS    0H                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   BKPUT                                                            
         CP    BKCOUNT,=P'50'                                                   
         BH    BKPUT                                                            
         AP    BKCOUNT,=P'1'                                                    
         MVC   P(23),=C'***BILLING RECORD - HEX'                                
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY,P,65,0                                      
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBILLKEY+65,P,65,0                                   
         GOTO1 REPORT                                                           
*                                                                               
BKP30    DS    0H                                                               
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(08),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,2,0                                     
         GOTO1 REPORT                                                           
         B     *+6                                                              
BKCOUNT  DC    PL2'0'                                                           
*                                                                               
*                                                                               
BKPUT    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    BKPUT5                                                           
*                                                                               
         LA    R1,BKPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
BKPUT5   DS    0H                   NOW DO DETAIL RECORD                        
*                                                                               
         MVC   BKACCT,SPACES     SET ACCOUNT AND COST CENTER TO SPACES          
         MVC   BKCOSTC,SPACES                                                   
         MVC   BKMAR#,SPACES     ALSO MAR#                                      
         MVC   BKCOMACC,=C'0000076523'                                          
*                                                                               
         LA    R3,UCOMBLK     SET-UP UCOM CONTROL BLOCK                         
         XC    UCOMBLK(L'UCOMBLK),UCOMBLK                                       
         USING DDUCOMD,R3                                                       
         MVC   KEYSAVE,KEY         SAVE KEY                                     
         MVC   UCACOMF,VCOMFACS     COMFACS                                     
         MVI   UCSYS,C'P'        SYSTEM TO PRINT                                
         MVC   UCAGY,QAGENCY                                                    
         MVC   UCMED,QMEDIA                                                     
         MVC   UCCLT,PBILKCLT      CLIENT                                       
         MVC   UCPRD,PBILKPRD      PRODUCT                                      
         MVC   UCEST,PBILKEST      ESTIMATE                                     
         OI    UCOPT,UCOEST      RETURN ESTIMATE UCOMMS                         
         GOTO1 =V(DDUCOM),UCOMBLK                                               
         CLI   UCERROR,0                                                        
         BNE   BKPR15E      ERROR RETURN - JUST EXIT DON'T DIE                  
         TM    UCDATA,UCDNOEST                                                  
         BO    BKPR15E                                                          
*                                                                               
*   TRY AND MATCH LAST 2 DIGITS OF FISCAL TO FIRST 2 OF AN EST UCOMM            
*   AND USE ITS MARKET TO FIND ACCOUNT AND COST CENTER FROM BKTABLE             
*                                                                               
*   FORMAT OF ESTIMATE UCOMM SHOULD BE YY-80008001-1234567890                   
*   YY= LAST 2 DIGITS OF FISCAL YEAR, 8000=MEDIA CODE,                          
*   8001=MARKET, 1234567890=10 DIGIT NUMBER                                     
*                                                                               
*   LENGTH MUST BE 22                                                           
*                                                                               
*        NEW  UCOMM FORMAT FOR MAR#                                             
*        LENGTH MAY BE 22 0R 23                                                 
*        11 (FOR 2011) MAY BE SUFFIXED BY A B FOR NOV-DEC/2010                  
*        OR A C FOR JAN-DEC/2011                                                
*        THIS OF COURSE ALTERS DISPLACEMENT OF LATER DATA                       
*                                                                               
         MVC   WORK(4),=C'  --'                                                 
         MVC   WORK(2),BKFISCAL+2   LAST 2 DIGITS OF THE YEAR                   
         CLC   WORK(2),=C'11'    2011?                                          
         BNE   BKPR05                                                           
         MVI   WORK+2,C'C'       WORK=11C-                                      
         CLC   BKBYR,=C'2010'    MOS IN 2010?                                   
         BNE   BKPR05                                                           
         MVI   WORK+2,C'B'       WORK=11B-                                      
         CLC   BKBMTH,=C'11'     SEE IF NOV OR DEC                              
         BNL   BKPR05                                                           
         MVI   WORK+2,C'-'       WORK=11-                                       
*                                                                               
BKPR05   L     R1,UCEDATA     EST DATA                                          
         LA    RF,UCELENS     LENGTHS                                           
         LHI   R0,4                                                             
BKPR10   ST    R1,SAVER1      SAVE THIS ADDRESS                                 
         CLI   0(RF),22       CHECK DATA LENGTH -MUST BE AT LEAST 22            
         BL    BKPR30         ELSE IGNORE                                       
         CLC   WORK(3),0(R1)     DO FISCAL YEARS MATCH?                         
         BNE   BKPR30         NO - THEN SKIP                                    
         CLI   WORK+2,C'-'                                                      
         BE    *+8                                                              
         LA    R1,1(R1)        BUMP R1 FOR 11B AND 11C                          
*                                                                               
         CLC   2(5,R1),=C'-8000' NEXT SHOULD BE MEDIA CODE                      
         BNE   BKPR30         SKIP IF NOT THIS                                  
*                                                                               
*        TRY AND FIND THE MARKET IN BKTABLE                                     
*                                                                               
         LA    RE,BKTABLE                                                       
BKPR15   CLC   7(4,R1),0(RE)                                                    
         BE    BKPR20                                                           
         CLC   0(2,RE),=X'FFFF'       END OF TABLE                              
         BE    BKPR15E                                                          
         LA    RE,24(RE)                                                        
         B     BKPR15                                                           
*                                                                               
BKPR15E  MVC   BKMAR#(09),=C'NOT FOUND'                                         
*                                                                               
         MVC   P+1(22),=C'VALID MAR# - NOT FOUND'                               
         GOTO1 REPORT                                                           
         B     BKPRX                                                            
*                                                                               
BKPR20   MVC   BKACCT,4(RE)   SAVE ACCOUNT NUMBER                               
         MVC   BKCOSTC,14(RE)  AND COST CENTER                                  
*                                                                               
         MVC   BKMAR#(4),WORK                                                   
         LA    RE,BKMAR#+3                                                      
         CLI   WORK+2,C'-'       IF SO - THEN NO SUFFIX PRESENT                 
         BE    *+8                                                              
         LA    RE,1(RE)                                                         
*                                                                               
******   MVC   BKMAR#(2),FISCAL+2                                               
******   MVC   BKMAR#(3),0(R1)   FISCAL PLUS DASH FROM UCOMM                    
******   MVC   BKMAR#+3(4),7(R1) MARKET NUMBER FROM UCOMM                       
******   MVI   BKMAR#+7,C'-'                                                    
******   MVC   BKMAR#+8(3),BKCOSTC+4   FIRST 3 DIGITS OF COST CENTER            
******   MVI   BKMAR#+11,C'-'                                                   
******   MVC   BKMAR#+12(10),12(R1)  10 DIGIT NUMBER FROM UCOMM                 
         MVC   0(4,RE),7(R1) MARKET NUMBER FROM UCOMM                           
         MVI   4(RE),C'-'                                                       
         MVC   5(3,RE),BKCOSTC+4   FIRST 3 DIGITS OF COST CENTER                
         MVI   8(RE),C'-'                                                       
         MVC   9(10,RE),12(R1)  10 DIGIT NUMBER FROM UCOMM                      
         B     BKPRX                                                            
*                                                                               
BKPR30   L     R1,SAVER1      RESTORE R1                                        
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,BKPR10                                                        
         B     BKPR15E        VALID MAR# NOT FOUND                              
*                                                                               
BKPRX    MVC   KEY,KEYSAVE                                                      
         GOTO1 HIGH                RESTORE SEQUENCE                             
*                                                                               
         DROP  R3                                                               
*                                                                               
         LA    RE,PBIREC             CLEAR PBIREC                               
         LHI   R1,L'PBIREC-1                                                    
         LA    RF,1(RE)                                                         
         MVI   0(RE),C' '                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
*                                                                               
         MVC   PBIREC(2),=C'D1'                                                 
         MVC   PBIREC+2(L'DINVFULL),DINVFULL                                    
*                                                                               
         MVC   PBIREC+18(10),BKACCT   G/L ACCOUNT                               
         MVC   PBIREC+28(10),BKCOSTC  COST CENTER                               
*                                                                               
         ZAP   MYDUB,PBILLRCV                                                   
         SP    MYDUB,BKCOM                                                      
         EDIT  MYDUB,(11,PBIREC+38),2,FILL=0,ZERO=NOBLANK                       
*                                                                               
         MVI   PBIREC+38,C'-'                                                   
         CP    MYDUB,=P'0'                                                      
         BL    *+8                                                              
         MVI   PBIREC+38,C'+'                                                   
*                                                                               
         OC    PPBVETAX,PPBVETAX                                                
         BZ    *+10                                                             
         MVC   PBIREC+49(2),=C'P1'                                              
*                                                                               
         MVC   PBIREC+101(23),BKMAR#  MAR NUMBER                                
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   BKPR40                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(08),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,2,0                                     
         GOTO1 REPORT                                                           
*                                                                               
BKPR40   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    BKPR50                                                           
*                                                                               
         LA    R1,BKPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
BKPR50   DS    0H                                                               
         CP    BKCOM,=P'0'         ANY COMMISSION?                              
         BE    BKPR80                                                           
*                                                                               
*        DO ANOTHER DETAIL RECORD                                               
*                                                                               
         EDIT  BKCOM,(11,PBIREC+38),2,FILL=0,ZERO=NOBLANK                       
         MVC   PBIREC+18(10),BKCOMACC        COMMISSION ACCOUNT #               
******                                                                          
******   SHOULD CD AND TAX BE CLEARED IN THIS RECORD?                           
******                                                                          
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    BKPR80                                                           
*                                                                               
         LA    R1,BKPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
BKPR80   XIT1                                                                   
*                                                                               
*        SOME OF THESE MAY NOT APPLY TO PRINT - THEY WERE INCLUDED              
*        JUST IN CASE THEY WERE ENCOUNTERED                                     
*        (MKTS - 8012-8014, 8025-8026, 8035-8036)                               
*                                                                               
BKTABLE  DS    0H                           MKT,G/L ACCT,COST CENTER            
*                                                                               
*        UNCLEAR WHY THE FIRST THREE ENTIRES ARE HERE                           
*        AS THEY SEEM TO RELATE TO TV                                           
*        BUT THEY ASKED THAT THEY BE INCLUDED FOR SOME REASON                   
*                                                                               
         DC    C'800100000764730000206000'  TV NETWORK ADULT GM                 
         DC    C'800200000764730000206000'  TV KIDS GM                          
         DC    C'800300000764770000206000'  TV LOCAL GM                         
*                                                                               
         DC    C'800400000765060000206000'  OTHER DIGITAL MEDIA-PV              
         DC    C'800700000764970000206000'  PRINT ADULT GM                      
         DC    C'800800000764970000206000'  PRINT KIDS GM                       
         DC    C'800900000764970000206000'  PRINT PWK                           
         DC    C'801000000765330000206000'  OUTDOOR NATIONAL/LOCAL              
         DC    C'801100000765060000206000'  OTHER DIGITAL MEDIA GM              
         DC    C'801200000765030000206000'  OTHER SPONSORSHIP GM                
         DC    C'801300000765030000206000'  OTHER MEDIA GM                      
         DC    C'801400000765020000206000'  INTEGRATION                         
         DC    C'801500000765060000206000'  OTHER DIGITAL MEDIA-AD              
         DC    C'801600000765060000206000'  OTHER DIGITAL MEDIA-AD              
         DC    C'801700000765060000206000'  OTHER DIGITAL MEDIA-AD              
         DC    C'801800000765060000206000'  OTHER DIGITAL MEDIA-KIDS            
         DC    C'801900000765060000206000'  OTHER DIGITAL MEDIA-KIDS            
         DC    C'802300000764970000206024'  PRINT AACM                          
         DC    C'802400000765330000206024'  OUTDOOR AACM                        
         DC    C'802500000765030000206024'  OTHER SPONSORSHIP AACM              
         DC    C'802600000765030000206024'  OTHER MEDIA AACM                    
         DC    C'802800000765060000206024'  DIGITAL AACM                        
         DC    C'803300000764970000206025'  PRINT HCM                           
         DC    C'803400000765330000206025'  OUTDOOR HCM                         
         DC    C'803500000765030000206025'  OTHER SPONSORSHIP HCM               
         DC    C'803600000765030000206025'  OTHER MEDIA HCM                     
         DC    C'803800000765060000206025'  DIGITAL HCM                         
         DC    X'FFFF'                                                          
         EJECT                                                                  
*                                                                               
BKX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
BKPRL    DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'          TEST RUN - NO TAPE                           
         BE    BKX                                                              
*                                                                               
         LA    R2,BKPBIT1                                                       
         CLOSE ((2),)                                                           
         B     BKX                                                              
*                                                                               
BKPBIT1  DCB   DDNAME=BKPBIT1,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00132,                                            X        
               BLKSIZE=00132,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
         EJECT                                                                  
         SPACE 2                                                                
*                                                                               
*        MINDSHARE - DIAGEO                                                     
*                                                                               
DGPROC   NMOD1 0,DGPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    DGPR1                                                            
                                                                                
         BC    0,DGPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (DGPBIT1,(OUTPUT))                                               
                                                                                
DGPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    DGPRL                                                            
*                                                                               
         CP    PBILLRCV,=P'0'    SKIP ZERO BILLS                                
         BE    DGSKIP                                                           
*                                                                               
         MVI   DGERRSW,0       CLEAR ERROR SWITCH                               
         MVI   DGISKIP,C'N'                                                     
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'    SAVE FOR RUNLAST                                 
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         LA    R2,UCOMBLK                SET-UP UCOM CONTROL BLOCK              
         XC    UCOMBLK(L'UCOMBLK),UCOMBLK                                       
         USING DDUCOMD,R2                                                       
         MVC   KEYSAVE,KEY         SAVE KEY                                     
         MVC   UCACOMF,VCOMFACS    COMFACS                                      
         MVI   UCSYS,C'P'          SYSTEM TO PRINT                              
         MVC   UCAGY,QAGENCY                                                    
         MVC   UCMED,QMEDIA                                                     
         MVC   UCCLT,PBILKCLT      CLIENT                                       
         MVC   UCPRD,PBILKPRD      PRODUCT                                      
         OI    UCOPT,UCOPRD        RETURN PRODUCT UCOMMS                        
         GOTO1 =V(DDUCOM),UCOMBLK                                               
         CLI   UCERROR,0                                                        
         BNE   DGPRERR      ERROR RETURN - JUST EXIT DON'T DIE                  
         TM    UCDATA,UCDNOPRD                                                  
         BO    DGPRERR      NO PRD DATA                                         
*                                                                               
         L     R1,UCPDATA     PRD DATA                                          
         LA    RF,UCPLENS     LENGTHS                                           
         LA    RE,PBIREC+300  SAVE DATA HERE                                    
         LHI   R0,3           JUST FIRST 3 USED                                 
DGPR75   CLI   0(RF),0        CHECK DATA LENGTH                                 
         BE    DGPRERR        MISSING UCOMM                                     
         MVC   0(32,RE),0(R1)                                                   
         LA    R1,32(R1)      NEXT DATA                                         
         LA    RE,32(RE)      NEXT SAVE LOCATION                                
         LA    RF,1(RF)       NEXT LENGTH                                       
         BCT   R0,DGPR75                                                        
         B     DGPR75X                                                          
*                                                                               
DGPRERR  DS    0H                                                               
         MVC   P(42),=C'*** MISSING UCOMM DATA FOR PRODUCT     ***'             
         MVC   P+35(3),PBILKPRD                                                 
         MVC   PSECOND(23),=C'*** INVOICE SKIPPED ***'                          
         GOTO1 REPORT                                                           
*                                                                               
         MVC   KEY,KEYSAVE                                                      
         GOTO1 HIGH                RESTORE SEQUENCE                             
         MVI   DGERRSW,C'Y'        SET ERRORS ENCOUNTERED                       
DGSKIP   MVI   DGISKIP,C'Y'                                                     
         B     DGX                                                              
*                                  I NEED THE FIRST 3                           
*                                                                               
DGPR75X  MVC   KEY,KEYSAVE                                                      
         GOTO1 HIGH                RESTORE SEQUENCE                             
*                                                                               
*        FILE HEADER RECORD FIRST                                               
*                                                                               
         CP    DGCOUNT,=P'0'         FIRST RECORD?                              
         BNE   DGPR15                IF NOT SKIP HEADER                         
*                                                                               
         MVI   PBIREC,C'0'                                                      
         MVI   PBIREC+1,C','          DELIMITER                                 
         MVC   PBIREC+2(05),=C'CARAT'                                           
         MVI   PBIREC+07,C','          DELIMITER                                
         MVC   PBIREC+08(8),CTODAY   YYYYMMDD                                   
         MVC   PBIREC+16(2),TIMEOFD    HH                                       
         MVC   PBIREC+18(2),TIMEOFD+3  MM                                       
         MVC   PBIREC+20(2),TIMEOFD+6  SS                                       
         AP    DGCOUNT,=P'1'                                                    
*                                                                               
         CLI   QOPT7,C'Y'                                                       
         BNE   DGPR10                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(50),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,50,0                                        
         GOTO1 REPORT                                                           
*                                                                               
DGPR10   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    DGPR15                                                           
*                                                                               
         LA    R1,DGPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DGPR15   DS    0H                 INVOICE RECORD                                
*                                                                               
         MVC   WORK(20),SPACES                                                  
         MVC   WORK(10),DINVFULL                                                
         LA    R1,WORK+10                                                       
         LA    R2,DINVFULL                                                      
         LA    R3,10                                                            
DGPR5A   CLI   0(R2),C'-'              ELIMINATE DASHES                         
         BNE   DGPR5C                                                           
DGPR5B   LA    R2,1(R2)                                                         
         BCT   R3,DGPR5A                                                        
         B     DGPR5X                                                           
*                                                                               
DGPR5C   MVC   0(1,R1),0(R2)                                                    
         LA    R1,1(R1)                                                         
         B     DGPR5B                                                           
*                                                                               
DGPR5X   DS    0H                                                               
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'1'                                                      
         MVI   PBIREC+1,C','          DELIMITER                                 
         MVC   PBIREC+2(10),=C'1000084655'      TRADING PARTNER                 
         MVI   PBIREC+12,C','          DELIMITER                                
         MVC   PBIREC+13(4),PBIREC+364 COMPANY - FROM PRD UCOMM 3               
         MVI   PBIREC+17,C','          DELIMITER                                
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,PBIREC+18)  INV DATE                
*******  MVC   PBIREC+18(8),CTODAY        YYYMMDD                               
         MVI   PBIREC+26,C','          DELIMITER                                
         MVC   PBIREC+27(10),WORK+10      MEDIA                                 
         LA    R5,PBIREC+37                                                     
DGPR16   CLI   0(R5),C' '                                                       
         BH    DGPR17                                                           
         SH    R5,=H'1'                                                         
         B     DGPR16                                                           
*                                                                               
DGPR17   MVI   1(R5),C','                                                       
         EDIT  PBILLRCV,(13,2(R5)),2,FILL=0,ZERO=NOBLANK,FLOAT=-                
         AP    DGTOTAL,PBILLRCV                                                 
*                                                                               
         AP    DGCOUNT,=P'1'                                                    
         CLI   QOPT7,C'Y'                                                       
         BNE   DGPR20                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(50),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,50,0                                        
         GOTO1 REPORT                                                           
*                                                                               
DGPR20   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    DGPR25                                                           
*                                                                               
         LA    R1,DGPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DGPR25   DS    0H                 INVOICE DETAIL                                
*                                                                               
*                                                                               
DGPR29   MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'2'                                                      
         MVI   PBIREC+1,C','        DELIMITER                                   
         MVC   PBIREC++2(10),PBIREC+300   PO NUMBER - FIRST PRD UCOMM           
         MVI   PBIREC+12,C','       DELIMITER                                   
         MVC   PBIREC+13(5),PBIREC+332  PO LINE - FIRST 5 OF PRD UCOMM2         
         MVI   PBIREC+18,C','       DELIMITER                                   
         EDIT  PBILLRCV,(13,PBIREC+19),2,FILL=0,ZERO=NOBLANK,FLOAT=-            
*                                                                               
         DROP  R2                                                               
*                                                                               
         AP    DGCOUNT,=P'1'                                                    
         CLI   QOPT7,C'Y'                                                       
         BNE   DGPR30                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(50),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,50,0                                        
         GOTO1 REPORT                                                           
*                                                                               
DGPR30   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    DGPR35                                                           
*                                                                               
         LA    R1,DGPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DGPR35   DS    0H                                                               
         B     DGX                                                              
*                                                                               
DGX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
DGPRL    DS    0H                                                               
*                              FILE TOTAL RECORD                                
         CP    DGCOUNT,=P'0'   ANY RECORDS CREATED?                             
         BE    DGPRL15                                                          
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
*******  AP    DGCOUNT,=P'1'          DON'T COUNT THIS RECORD                   
         MVI   PBIREC,C'3'                                                      
         MVI   PBIREC+1,C','          DELIMITER                                 
*                                                                               
*        RECORD COUNTS AND TOTAL $                                              
*                                                                               
         EDIT  DGCOUNT,(10,PBIREC+2),0,FILL=0                                   
         MVI   PBIREC+12,C','          DELIMITER                                
         EDIT  DGTOTAL,(13,PBIREC+13),2,FILL=0,ZERO=NOBLANK,FLOAT=-             
*                                                                               
         CLI   SVQOPT7,C'Y'                                                     
         BNE   DGPRL5                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(50),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,50,0                                        
         GOTO1 REPORT                                                           
*                                                                               
DGPRL5   DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'         TEST RUN - NO TAPE                          
         BE    DGPRL15                                                          
*                                                                               
         LA    R1,DGPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DGPRL15  DS    0H                                                               
*                                                                               
*                                                                               
         CLI   DGERRSW,C'Y'          WERE ERRORS ECOUNTERED?                    
         BNE   DGPRL20                                                          
         MVC   P(34),=C'*** WARNING-ERRORS ENCOUNTERED ***'                     
         MVC   PSECOND(54),=C'*** PRODUCTS WITH MISSING UCOMM DATA NOT X        
               PROCESSED ***'                                                   
         MVI   SPACING,2                                                        
         GOTO1 REPORT                                                           
         CP    DGCOUNT,=P'0'         ANY RECORDS CREATED?                       
         BE    DGX                   NO - JUST EXIT                             
*                                                                               
DGPRL20  CLI   SVQOPT7,C'Y'          TEST RUN - NO TAPE                         
         BE    DGX                                                              
*                                                                               
         LA    R2,DGPBIT1                                                       
         CLOSE ((2),)                                                           
         B     DGX                                                              
*                                                                               
         XIT                                                                    
*                                                                               
DGPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00050,                                            X        
               BLKSIZE=00050,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
DGERRSW  DS    CL1                                                              
*                                                                               
NEXTELD  NTR1  BASE=*,LABEL=*                                                   
NEXTELD1 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELDX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELD1                                                         
NEXTELDX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
*                                                                               
*        CARNY - DIAGEO                                                         
*                                                                               
DG2PROC  NMOD1 0,DG2PROC                                                        
         L     RC,PPFILEC                                                       
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    DG2PR1                                                           
                                                                                
         BC    0,DG2PR1                                                         
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (DG2PBIT1,(OUTPUT))                                              
                                                                                
DG2PR1   DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    DG2PRL                                                           
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'    SAVE FOR RUNLAST                                 
*                                                                               
         MVI   PBIREC,C' '     270 BYTES                                        
         MVC   PBIREC+1(200),PBIREC                                             
         MVC   PBIREC+201(69),PBIREC                                            
*                                                                               
         MVC   PBIREC(3),=C'USD'                                                
         MVC   PBIREC+3(4),=C'INVO'                                             
         CP    PBILLRCV,=P'0'                                                   
         BNL   *+10                                                             
         MVC   PBIREC+3(4),=C'CRME'    CREDIT MEMO                              
         MVC   PBIREC+7(2),=C'LF'                                               
         MVC   PBIREC+10(10),=C'1000084655'      VENDOR NUMBER                  
         MVC   PBIREC+27(3),=C'009'        IDOC QUALIFER                        
         MVC   PBIREC+30(L'DINVFULL),DINVFULL                                   
         MVC   PBIREC+65(3),=C'012'        IDOC QUALIFER                        
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,PBIREC+68)  INV DATE                
         MVC   PBIREC+76(3),=C'024'        IDOC QUALIFIER                       
         GOTO1 DATCON,DMCB,(0,PBILLDAT),(20,PBIREC+79)  RUN DATE                
         MVC   PBIREC+87(3),=C'001'         TAX CODE                            
         MVC   PBIREC+94(3),=C'011'        IDOC QUALIFIER                       
         MVC   PBIREC+97(10),=C'MEDIA TOOLS'    COMPANY CODE?                   
*                                                                               
*        00 BEFORE PRD USER 1 IN PBIREC+132(6)                                  
*                                                                               
         EDIT  PBILLRCV,(15,PBIREC+138),2,FILL=0,ZERO=NOBLANK,FLOAT=-           
         MVC   PBIREC+153(2),=C'EA'                                             
         MVC   PBIREC+156(15),PBIREC+138   (SAME AS PBIREC+138)                 
         MVC   PBIREC+171(2),=C'EA'                                             
         MVC   PBIREC+174(3),=C'001'      IDOC QUALIFER                         
*                                                                               
*        PO # FROM EST USER 2 IN PBIREC+177                                     
*                                                                               
         MVC   PBIREC+212(6),PBIREC+132     SAME AS ABOVE                       
         MVC   PBIREC+218(3),=C'003'      IDOC QUALIFER                         
         MVC   PBIREC+221(3),=C'000'      SINCE IT'S AN 18 BYTE FIELD           
         MVC   PBIREC+224(15),PBIREC+138   AMT DUE                              
         MVC   PBIREC+239(3),=C'001'      TAX CODE                              
         MVC   PBIREC+246(3),=C'011'      IDOC QUALIFER                         
         MVC   PBIREC+249(18),PBIREC+221  SAME AS ABOVE                         
         AP    DG2TOTAL,PBILLRCV                                                
*                                                                               
         AP    DG2COUNT,=P'1'                                                   
         CLI   QOPT7,C'Y'                                                       
         BNE   DG2PR20                                                          
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(100),PBIREC+100                                                
         GOTO1 REPORT                                                           
         MVC   P(70),PBIREC+200                                                 
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,100,0                                       
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+100,P,100,0                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+200,P,56,0                                    
         GOTO1 REPORT                                                           
*                                                                               
DG2PR20  DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    DG2PR25                                                          
*                                                                               
         LA    R1,DG2PBIT1                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DG2PR25  DS    0H                 DONE WITH THE INVOICE                         
         B     DG2X                                                             
*                                                                               
*        CODE BELOW READS THE ESTIMATE TO GET USER FIELDS                       
*                                                                               
***      MVC   WORK(12),PBILLREC                                                
***      MVI   WORK+3,7                                                         
***      CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
***      BE    DG2PR27             YES                                          
***      MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
***      XC    KEY,KEY                                                          
***      MVC   KEY(12),PBILLREC                                                 
***      MVI   KEY+3,7                                                          
***      GOTO1 READ                                                             
***      GOTO1 GETEST                                                           
***      MVC   KEY(64),WORK                                                     
***      GOTO1 HIGH                                                             
***                                                                             
***PR27  DS    0H                                                               
***      MVC   WORK(10),SPACES   USE TO SAVE PO#                                
***      LA    R2,PESTREC+33                                                    
***      USING PESTUDEF,R2                                                      
***      MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
***      BRAS  RE,NEXTELG                                                       
***      BNE   DG2PR29                                                          
***      MVC   WORK(10),PEUSER1                                                 
***      OC    WORK(10),SPACES                                                  
***                                                                             
***      DROP  R2                                                               
***                                                                             
DG2X     DS    0H                                                               
         XIT1                                                                   
*                                                                               
DG2PRL   DS    0H                                                               
*                                                                               
         B     DG2PRL15        JUST CLOSE FILE                                  
*                              NO TOTAL RECORD NEEDED                           
                                                                                
*                              FILE TOTAL RECORD                                
*                                                                               
         MVI   PBIREC,C' '     270 BYTES                                        
         MVC   PBIREC+1(200),PBIREC                                             
         MVC   PBIREC+201(69),PBIREC                                            
*                                                                               
*                                                                               
*******  AP    DG2COUNT,=P'1'         DON'T COUNT THIS RECORD                   
         MVI   PBIREC,C'3'                                                      
         MVI   PBIREC+1,C','          DELIMITER                                 
*                                                                               
*        RECORD COUNTS AND TOTAL $                                              
*                                                                               
         EDIT  DG2COUNT,(10,PBIREC+2),0,FILL=0                                  
         MVI   PBIREC+12,C','          DELIMITER                                
         EDIT  DG2TOTAL,(13,PBIREC+13),2,FILL=0,ZERO=NOBLANK,FLOAT=-            
*                                                                               
         CLI   SVQOPT7,C'Y'                                                     
         BNE   DG2PRL5                                                          
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(50),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,50,0                                        
         GOTO1 REPORT                                                           
*                                                                               
DG2PRL5  DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'         TEST RUN - NO TAPE                          
         BE    DG2PRL15                                                         
*                                                                               
         LA    R1,DG2PBIT1                                                      
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
DG2PRL15 DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'          TEST RUN - NO TAPE                         
         BE    DG2X                                                             
*                                                                               
         LA    R2,DG2PBIT1                                                      
         CLOSE ((2),)                                                           
         B     DG2X                                                             
*                                                                               
         XIT                                                                    
*                                                                               
DG2PBIT1 DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00270,                                            X        
               BLKSIZE=00270,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
NEXTELG  NTR1  BASE=*,LABEL=*                                                   
NEXTELG1 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELGX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELG1                                                         
NEXTELGX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
*                                                                               
*        YKVA CODE                                                              
*                                                                               
*        CARAT - GM LMA                                                         
*                                                                               
GMPROC   NMOD1 0,GMPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    GMPR1                                                            
                                                                                
         BC    0,GMPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (GMPBIT1,(OUTPUT))                                               
*                                                                               
GMPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    GMPRL                                                            
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'    SAVE FOR RUNLAST                                 
*                                                                               
         MVC   WORK(12),PBILLREC    MUST READ ESTIMATE FOR NAME                 
         MVI   WORK+3,X'07'                                                     
         CLC   PESTREC(12),WORK                                                 
         BE    GMPR3                                                            
         MVC   WORK(64),KEY          SAVE PPG'S KEY AND KEYSAVE                 
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,X'07'                                                      
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
*                                                                               
GMPR3    MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELL                                                       
         BNE   *+20                                                             
         MVC   PBIREC(12),PEUSER1                                               
         CLC   PBIREC(12),SPACES                                                
         BH    GMPR5                                                            
*                                                                               
         MVC   P(42),=C'*** MISSING USER DATA FOR ESTIMATE     ***'             
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+35(3),DUB+6(2)                                                 
         MVC   PSECOND(23),=C'*** INVOICE SKIPPED ***'                          
         GOTO1 REPORT                                                           
         MVI   GMERRSW,C'Y'        SET ERRORS ENCOUNTERED                       
         MVI   GMISKIP,C'Y'                                                     
         B     GMX                                                              
*                                                                               
         DROP  R2                                                               
*                                                                               
GMPR5    MVC   PBIREC+12(4),=C'CRT2'                                            
         MVC   PBIREC+16(L'DINVNO),DINVNO                                       
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,PBIREC+22)  INV DATE                
*                                                                               
         MVC   WORK(2),PBILKMOS               MONTH OF SERVICE CCYYMM           
         MVI   WORK+2,X'01'     DAY TO 1                                        
         GOTO1 DATCON,DMCB,(3,WORK),(20,WORK+3)                                 
         MVC   PBIREC+30(6),WORK+3                                              
*                                                                               
         EDIT  PBILLRCV,(16,PBIREC+36),2,FILL=0,ZERO=NOBLANK ACTUAL             
         CP    PBILLRCV,=P'0'             SEE IF NEGATIVE                       
         BNE   *+14                                                             
         XC    PBIREC,PBIREC                                                    
         B     GMX                                                              
         BH    *+8                                                              
         MVI   PBIREC+36,C'-'             LEADING MINUS SIGN                    
*                                                                               
         MVI   PBIREC+52,C'0'                                                   
         MVC   PBIREC+53(3),PCLTKCLT      CLT CODE                              
         MVI   PBIREC+56,C'0'                                                   
         MVC   PBIREC+57(3),PPRDKPRD      PRD CODE                              
         MVC   HALF,PBILKEST              EST CODE                              
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  PBIREC+60(6),DUB                                                 
         MVC   PBIREC+87(20),PESTNAME     EST NAME                              
         LA    RE,PBIREC+66               PREFIL EST NAME WITH 000              
         LHI   R1,20                                                            
         LA    RF,1(RE)                                                         
         MVI   0(RE),C'0'                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
                                                                                
         LA    RE,PBIREC+118              PREFIL MED NAME WITH 000              
         LHI   R1,39                                                            
         LA    RF,1(RE)                                                         
         MVI   0(RE),C'0'                                                       
         MOVE  ((RF),(R1)),(RE)                                                 
         MVC   PBIREC+153(5),=C'TRADE'                                          
         CLI   PBILKMED,C'T'                                                    
         BE    GMPR20                                                           
         MVC   PBIREC+152(6),=C'SEARCH'                                         
         CLI   PBILKMED,C'S'                                                    
         BE    GMPR20                                                           
         MVC   PBIREC+152(6),=C'SOCIAL'                                         
         CLI   PBILKMED,C'L'                                                    
         BE    GMPR20                                                           
         MVC   PBIREC+151(7),=C'OUTDOOR'                                        
         CLI   PBILKMED,C'O'                                                    
         BE    GMPR20                                                           
         MVC   PBIREC+150(8),=C'INTERNET'                                       
         CLI   PBILKMED,C'I'                                                    
         BE    GMPR20                                                           
         MVC   PBIREC+150(8),=C'MAGAZINE'                                       
         CLI   PBILKMED,C'M'                                                    
         BE    GMPR20                                                           
         MVC   PBIREC+149(9),=C'NEWSPAPER'                                      
         CLI   PBILKMED,C'N'                                                    
         BE    *+6                                                              
         DC    H'0'                                                             
*                                                                               
GMPR20   AP    GMCOUNT,=P'1'                                                    
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    GMPR30                                                           
         LA    R1,GMPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
         B     GMX                                                              
*                                                                               
GMPR30   MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(124),PBIREC                                                    
         MVC   PSECOND(08),PBIREC+124                                           
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,65,0                                        
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+65,P,65,0                                     
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC+130,P,2,0                                     
         GOTO1 REPORT                                                           
*                                                                               
GMX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
GMPRL    DS    0H                                                               
*                                                                               
*                                                                               
         CLI   GMERRSW,C'Y'          WERE ERRORS ECOUNTERED?                    
         BNE   GMPRL15                                                          
         MVC   P(34),=C'*** WARNING-ERRORS ENCOUNTERED ***'                     
         MVC   PSECOND(54),=C'*** ESTIMATES WITH MISSING UDEF DATA NOT X        
               PROCESSED ***'                                                   
         MVI   SPACING,2                                                        
         GOTO1 REPORT                                                           
         CP    GMCOUNT,=P'0'         ANY RECORDS CREATED?                       
         BE    GMX                   NO - JUST EXIT                             
*                                                                               
*                                                                               
GMPRL15  DS    0H                                                               
         CLI   SVQOPT7,C'Y'         TEST RUN - NO TAPE                          
         BE    GMX                                                              
         LA    R2,GMPBIT1                                                       
         CLOSE ((2),)                                                           
         B     GMX                                                              
*                                                                               
         XIT                                                                    
*                                                                               
GMPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00159,                                            X        
               BLKSIZE=00159,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
GMERRSW  DS    CL1                                                              
*                                                                               
NEXTELL  NTR1  BASE=*,LABEL=*                                                   
NEXTELL1 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELLX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELL1                                                         
NEXTELLX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
*        CARAT - SMUCKERS - SPEC-24974                                          
*                                                                               
SMIPROC  NMOD1 0,**SMIP**          SMUCKERS ROUTINE                             
*                                                                               
         L     RC,PPFILEC          A(PRINTPAK RECORDS)                          
*                                                                               
         CLI   MODE,RUNLAST        MODE RUNLAST?                                
         BNE   SMI05               NO                                           
         CLI   SMHDSW,C'Y'         ANY RECORDS CREATED?                         
         BNE   SMIX                NO - DON'T HAVE ANY RECORDS                  
         LAY   R2,SMFTAB           SMUCKERS CXML FOOTER TABLE                   
         BAS   RE,SMTABLE          PROCESS HARDCODED SMUCKERS TABLE             
         LA    R2,SMPBIT1          R2 = SMUCKERS DCB                            
         CLOSE ((2),)              CLOSE THE TAPE                               
         B     SMIX                DONE                                         
*                                                                               
SMI05    CLI   SMHDSW,C'Y'         HEADER CREATED?                              
         BE    SMI10               YES - ONLY DONE ONCE                         
*                                                                               
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (SMPBIT1,(OUTPUT))  OPEN THE SMUCKERS TAPE                       
*                                                                               
SMI05A   LA    R2,SMDSTAMP         UPDATE DATESTAMP YYYY-MM-DD                  
         MVC   0(4,R2),CTODAY      YYYY                                         
         MVC   5(2,R2),CTODAY+4    MM                                           
         MVC   8(2,R2),CTODAY+6    DD                                           
*                                                                               
         LA    R2,SMTSTAMP         UPDATE TIMSTAMP HH:MM:SS                     
         MVC   0(2,R2),TIMEOFD     HH                                           
         MVC   3(2,R2),TIMEOFD+3   MM                                           
         MVC   6(2,R2),TIMEOFD+6   SS                                           
*                                                                               
         LA    R2,SMHTAB           SMUCKERS CXML HEADER TABLE                   
         BAS   RE,SMTABLE          PROCESS HARDCODED SMUCKERS TABLE             
         MVI   SMHDSW,C'Y'         FLAG HEADER CREATED                          
*                                                                               
SMI10    LA    RE,PBIREC+200       RE = A(WHERE WE BUILD SMUCKERS DATA)         
         LHI   R1,150              LENGTH OF SMUCKERS DATA                      
         LA    RF,1(RE)            POINT TO PBIREC+201                          
         MVI   0(RE),C' '          INIT SPACES                                  
         MOVE  ((RF),(R1)),(RE)    INIT SMUCKRSD TO SPACES                      
*                                                                               
         LA    R5,PBIREC+200       R5 = PBIREC+200                              
         USING SMUCKRSD,R5         SMUCKERS DSECT                               
*                                                                               
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,WORK) YYYYMMDD                      
*                                                                               
         MVC   SMINVDT(4),WORK     YYYY                                         
         MVI   SMINVDT+4,C'-'      -                                            
         MVC   SMINVDT+5(2),WORK+4 MM                                           
         MVI   SMINVDT+7,C'-'      -                                            
         MVC   SMINVDT+8(2),WORK+6 DD                                           
*                                                                               
         MVC   WORK(2),PBILKMOS    MOS YY/MM                                    
         MVI   WORK+2,X'01'        SET DAY TO 1                                 
         GOTO1 DATCON,DMCB,(3,WORK),(20,WORK+3)                                 
*                                                                               
         MVC   SMINVMOS(4),WORK+3  YYYY                                         
         MVI   SMINVMOS+4,C'-'     -                                            
         MVC   SMINVMOS+5(2),WORK+7 MM                                          
         MVI   SMINVMOS+7,C'-'     -                                            
         MVC   SMINVMOS+8(2),WORK+9 DD                                          
*                                                                               
         MVC   SMINVNUM,DINVFULL   FULL INVOICE NUMBER (L-83-5149)              
*                                                                               
         EDIT  PBILLRCV,SMBACT,2,FLOAT=-,ALIGN=LEFT,COMMAS=YES                  
*                                                                               
         MVC   SMIPURP(21),=C'standard">           '                            
         CLI   SMBACT,C'-'         NEGATIVE AMOUNT?                             
         BNE   *+10                NO                                           
         MVC   SMIPURP(21),=C'lineLevelCreditMemo">'                            
*                                                                               
         MVC   SMCNAME,PCLTNAME    CLIENT NAME                                  
*                                                                               
         LA    R3,PESTREC          A(ESTIMATE RECORD)                           
         USING PESTELEM,R3         ESTIMATE X'07' ELEM DSECT                    
         MVI   ELCODE3,X'07'       X'07' ELEMENT                                
         BAS   RE,GETEL3           HAVE ESTIMATE ELEM?                          
         BNE   *+10                NO                                           
         MVC   SMEDESC,PESTNAME    ESTIMATE DESCRIPTION                         
         DROP  R3                  DROP ESTIMATE ELEM USING                     
*                                                                               
         LA    R3,PESTREC          A(ESTIMATE RECORD)                           
         USING PESTUDEF,R3         ESTIMATE UDEF DSECT                          
         MVI   ELCODE3,X'08'       X'08' ELEMENT                                
         BAS   RE,GETEL3           HAVE ESTIMATE ELEM?                          
         BNE   *+16                NO                                           
         MVC   SMEUDEF1,PEUSER1    ESTIMATE UDEF 1                              
         MVC   SMEUDEF2,PEUSER2    ESTIMATE UDEF 2                              
         DROP  R3                  DROP ESTIMATE ELEM USING                     
*                                                                               
         BAS   RE,SADDRESS         GET ADDRESS FOR SMUCKERS                     
*                                                                               
         MVC   SMIDAT(10),SMINVDT  INVOICE DATE (YYYY-MM-DD)                    
         MVC   SMINUM(9),SMINVNUM  INVOICE NUMBER (L-83-5149)                   
         DROP  R5                  DROP SMUCKERS DSECT                          
*                                                                               
         LA    R2,SMBTAB           SMUCKERS CXML BODY TABLE                     
         LA    R4,PBIREC           R4 = PBIREC                                  
         XR    R3,R3               CLEAR R3                                     
*                                                                               
SMI20    CLI   0(R2),X'FF'         END OF TABLE?                                
         BE    SMIX                YES - DONE                                   
         BAS   RE,SMSPFLD          PROCESSED SPECIAL FIELD?                     
         BE    SMI20               YES, FIELD PROCESSED & R2 BUMPED             
         BAS   RE,CLRTPREC         INIT PBIREC TO SPACES FOR 150 CHARS          
         IC    R3,1(R2)            LENGTH OF LITERAL                            
         BCTR  R3,0                DECREMENT FOR EX                             
         EX    R3,*+8              EXECUTE THE MVC                              
         B     *+10                BRANCH OVER MVC                              
         MVC   0(0,R4),2(R2)       MOVE LITERAL TO PBIREC                       
*                                                                               
         LA    R1,SMPBIT1          DCB                                          
         LA    R0,PBIREC           LINE WE'RE ADDING TO TAPE                    
         PUT   (1),(0)             PUT RECORD TO TAPE                           
*                                                                               
         LA    R2,3(R3,R2)         BUMP TO NEXT ENTRY IN THE TABLE              
         B     SMI20               PROCESS NEXT TABLE ENTRY                     
*                                                                               
SMIX     XIT1                      DONE                                         
*                                                                               
SMTABLE  NTR1                                                                   
*                                                                               
         LA    R4,PBIREC           R4 = PBIREC                                  
         XR    R3,R3               CLEAR R3                                     
*                                                                               
SMTAB05  CLI   0(R2),X'FF'         END OF TABLE?                                
         BE    SMIX                YES - DONE                                   
         BAS   RE,CLRTPREC         INIT PBIREC TO SPACES FOR 150 CHARS          
         IC    R3,0(R2)            LENGTH OF LITERAL                            
         BCTR  R3,0                DECREMENT FOR EX                             
         EX    R3,*+8              EXECUTE THE MVC                              
         B     *+10                BRANCH OVER MVC                              
         MVC   0(0,R4),1(R2)       MOVE LITERAL TO PBIREC                       
*                                                                               
         LA    R1,SMPBIT1          DCB                                          
         LA    R0,PBIREC           LINE WE'RE ADDING TO TAPE                    
         PUT   (1),(0)             ADD THE LINE TO TAPE                         
*                                                                               
         LA    R2,2(R3,R2)         BUMP TO NEXT TABLE ENTRY                     
         B     SMTAB05             PROCESS NEXT TABLE ENTRY                     
*                                                                               
CLRTPREC LR    R0,RE               SAVE OFF RE                                  
         LA    RE,PBIREC           RE = PBIREC                                  
         LHI   R1,150              LENGTH OF SMUCKERS FILELINE                  
         LA    RF,1(RE)            POINT TO TPREC+1                             
         MVI   0(RE),C' '          INIT SPACES                                  
         MOVE  ((RF),(R1)),(RE)    INIT 150 BYTES TO SPACES                     
         LR    RE,R0               RESTORE RE                                   
         BR    RE                  RETURN TO CALLER                             
*                                                                               
SMSPFLD  NTR1                                                                   
*                                                                               
         LAY   R3,SMSPCL           SMUCKERS SPECIAL FIELDS TABLE                
*                                                                               
SPFLD00  CLI   0(R3),X'FF'         END OF TABLE?                                
         BE    SPFLDNEQ            YES - SET CC NEQ                             
         CLC   0(1,R2),0(R3)       IS THIS A SPECIAL FIELD?                     
         BE    SPFLD10             YES                                          
         LA    R3,3(R3)            BUMP TO NEXT TABLE ENTRY                     
         B     SPFLD00             PROCESS NEXT TABLE ENTRY                     
*                                                                               
SPFLD10  LA    R4,PBIREC           R4 = PBIREC                                  
         BAS   RE,CLRTPREC         INIT PBIREC TO SPACES FOR 150 CHARS          
         LLC   RF,1(R2)            LENGTH OF LITERAL                            
         BCTR  RF,0                DECREMENT FOR EX                             
         EX    RF,*+8              EXECUTE THE MVC                              
         B     *+10                BRANCH OVER MVC                              
         MVC   0(0,R4),2(R2)       MOVE LITERAL TO PBIREC                       
         LA    R4,1(RF,R4)         MOVE SOFT DATA HERE                          
         LA    R2,3(RF,R2)         BUMP TO NEXT TABLE ENTRY                     
*                                                                               
         LA    R5,PBIREC+200       SPECIAL DATA BUILT HERE                      
         USING SMUCKRSD,R5         SMUCKERS DSECT                               
         LLC   RE,1(R3)            DISPLACEMENT INTO DATA                       
         LLC   RF,2(R3)            LENGTH OF DATA                               
         BCTR  RF,0                DECREMENT FOR EX                             
         AR    R5,RE               INDEX INTO DATA                              
         EX    RF,*+8              EXECUTE THE MVC                              
         B     *+10                BRANCH OVER MVC                              
         MVC   0(0,R4),0(R5)       MOVE SOFT DATA                               
         EX    RF,*+8              EXECUTE THE MVC                              
         B     *+10                SO IDF DOESN'T COMPLAIN                      
         OC    0(0,R4),SPACES      SPACE PAD SOFT DATA                          
         LA    R4,1(RF,R4)         LAST BYTE OF SOFT DATA                       
*                                                                               
         CLI   0(R4),X'40'         LAST CHAR OF DATA?                           
         BH    *+8                 YES                                          
         BCT   R4,*-8              NO, CHECK PREVIOUS BYTE                      
*                                                                               
         LLC   RF,1(R2)            LENGTH OF LITERAL                            
         BCTR  RF,0                DECREMENT FOR EX                             
         EX    RF,*+8              EXECUTE THE MVC                              
         B     *+10                BRANCH OVER MVC                              
         MVC   1(0,R4),2(R2)       MOVE LITERAL TO TPREC                        
         LA    R2,3(RF,R2)         BUMP TO NEXT TABLE ENTRY                     
*                                                                               
         LA    R1,SMPBIT1          DCB                                          
         LA    R0,PBIREC           LINE WE'RE ADDING TO TAPE                    
         PUT   (1),(0)             ADD THE LINE TO TAPE                         
*                                                                               
         CR    RE,RE               SET CC EQU                                   
         B     SPFLDXIT            AND EXIT                                     
*                                                                               
SPFLDNEQ LTR   RE,RE               SET CC NEQ                                   
*                                                                               
SPFLDXIT XIT1  REGS=(R2)           EXIT BUT KEEP R2 INTACT                      
*                                                                               
SADDRESS NTR1                      GET ADDRESS FOR SMUCKERS                     
*                                                                               
         USING SMUCKRSD,R5         SMUCKERS DSECT                               
         XC    SMADD,SMADD         CLEAR ADDRESS                                
         XC    SMCITY,SMCITY       CLEAR CITY                                   
         XC    SMSTATE,SMSTATE     CLEAR STATE                                  
         XC    SMZIP,SMZIP         CLEAR ZIP CODE                               
*                                                                               
         MVC   WORK(7),PBILLREC    READ PRODUCT AAA RECORD                      
         MVI   WORK+3,X'06'        PRODUCT RECORD CODE                          
         MVC   WORK+7(3),=C'AAA'   PRODUCT RECORD AAA                           
         CLC   PPRDREC(10),WORK    PRODUCT RECORD IN CORE?                      
         BE    SADD10              YES - NO NEED TO RE-READ                     
*                                                                               
         XC    KEY,KEY             CLEAR THE KEY                                
         MVC   KEY(10),WORK        PRODUCT AAA KEY                              
*                                                                               
         GOTO1 HIGH                READ HIGH FOR PRODUCT AAA KEY                
*                                                                               
         CLC   KEY(25),KEYSAVE     FOUND THE KEY?                               
         BE    SADD05              YES                                          
         XC    KEY,KEY             CLEAR THE KEY                                
         MVC   KEY(25),PBILLREC    RESTORE BILLING KEY                          
         GOTO1 HIGH                READ HIGH FOR BILLING KEY                    
         B     SADDX               PRD AAA NOT ON FILE - DONE                   
*                                                                               
SADD05   GOTO1 GETPROD             READ PRODUCT RECORD INTO PPRDREC             
*                                                                               
         XC    KEY,KEY             CLEAR THE KEY                                
         MVC   KEY(25),PBILLREC    RESTORE BILLING KEY                          
         GOTO1 HIGH                READ HIGH FOR BILLING KEY                    
*                                                                               
SADD10   LA    RE,SMADD            ADDRESS                                      
         CLC   PPRDBILL,SPACES     HAVE AN ADDRESS LINE 1?                      
         BNH   SADD20              NO                                           
         MVC   0(20,RE),PPRDBILL   BILL RECEIPT NAME (LINE 1)                   
         AHI   RE,L'PPRDBILL       BUMP PAST ADDRESS LINE 1                     
         CLI   0(RE),X'40'         GREATER THAN A SPACE?                        
         BH    *+8                 YES                                          
         BCT   RE,*-8              FIND LAST CHAR OF ADDRESS LINE 1             
         LA    RE,2(RE)            ADDRESS LINE 2 GOES HERE                     
*                                                                               
SADD20   CLC   PPRDLIN1,SPACES     HAVE AN ADDRESS LINE 2?                      
         BNH   SADD30              NO                                           
         MVC   0(30,RE),PPRDLIN1   ADDRESS (LINE 1)                             
*                                                                               
SADD30   LA    RE,PPRDLIN2         FIND END OF CITY                             
         LA    RF,L'PPRDLIN2       DON'T GO PAST END                            
         LR    R1,RF               TO CALCULATE LENGTH OF CITY                  
*                                                                               
SADD40   CLI   0(RE),C','          COMMA?                                       
         BE    SADD50              YES - CITY ALWAYS FOLLOWED BY COMMA          
         LA    RE,1(RE)            BUMP TO NEXT BYTE                            
         BCT   RF,SADD40           CHECK NEXT BYTE                              
         B     SADDX               CANNOT FIND CITY/STATE/ZIP                   
*                                                                               
SADD50   SR    R1,RF               LENGTH OF CITY                               
         BCTR  R1,0                -1 FOR EX                                    
         EX    R1,*+8              EXECUTE MVC                                  
         B     *+10                SO IDF DOESN'T COMPLAIN                      
         MVC   SMCITY(0),PPRDLIN2  CITY                                         
*                                                                               
         LA    RE,1(RE)            BUMP PAST COMMA                              
         BCTR  RF,0                DECREMENT REMAINING LENGTH                   
*                                                                               
SADD60   CLI   0(RE),C' '          FIRST BYTE OF STATE?                         
         BH    SADD70              YES                                          
         LA    RE,1(RE)            BUMP TO NEXT BYTE                            
         BCT   RF,SADD60           CHECK NEXT BYTE                              
         B     SADDX               CANNOT FIND STATE/ZIP                        
*                                                                               
SADD70   MVC   SMSTATE,0(RE)       STATE                                        
         LA    RE,2(RE)            BUMP PAST STATE                              
         SHI   RF,2                DECREMENT REMAINING LENGTH                   
*                                                                               
SADD80   CLI   0(RE),C' '          FIRST BYTE OF ZIP?                           
         BH    SADD90              YES                                          
         LA    RE,1(RE)            BUMP TO NEXT BYTE                            
         BCT   RF,SADD80           CHECK NEXT BYTE                              
         B     SADDX               CANNOT FIND ZIP                              
*                                                                               
SADD90   MVC   SMZIP,0(RE)         ZIP CODE IS 10 DIGITS                        
*                                                                               
SADDX    B     SMIX                DONE                                         
*                                                                               
SMPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00150,                                            X        
               BLKSIZE=00150,                                          X        
               MACRF=PM                                                         
*                                                                               
         GETELN R3,33,ELCODE3,3    GETEL3 MACRO                                 
*                                                                               
         LTORG                                                                  
***                                                                             
* SMUCKERS XML HEADER TABLE                                                     
* FORMAT IS XL1              TABLE ENTRY LENGTH                                 
*           CL(ENTRY LENGTH) TABLE DATA                                         
***                                                                             
SMHTAB   DC    X'26',C'<?xml version="1.0" encoding="UTF-8"?>'                  
         DC    X'53',C'<!DOCTYPE cXML SYSTEM "http://xml.cxml.org/sche'         
         DC          C'mas/cXML/1.2.023/InvoiceDetail.dtd">'                    
         DC    X'63',C'<cXML payloadID="28642627BGS20180208T18:55" tim'         
         DC          C'estamp="'                                                
SMDSTAMP DC          C'2018-02-08T'                                             
SMTSTAMP DC          C'17:44:46-05:00" version="1.2.023"'                       
         DC    X'11',C'xml:lang="en-US">'                                       
         DC    X'08',C'<Header>'                                                
         DC    X'06',C'<From>'                                                  
         DC    X'1F',C'<Credential domain="NetworkID">'                         
         DC    X'23',C'<Identity> AN01001348934</Identity>'                     
         DC    X'0D',C'</Credential>'                                           
         DC    X'07',C'</From>'                                                 
         DC    X'04',C'<To>'                                                    
         DC    X'1F',C'<Credential domain="NetworkID">'                         
         DC    X'22',C'<Identity>AN01014693236</Identity>'                      
         DC    X'0D',C'</Credential>'                                           
         DC    X'05',C'</To>'                                                   
         DC    X'08',C'<Sender>'                                                
         DC    X'1F',C'<Credential domain="NetworkID">'                         
         DC    X'22',C'<Identity>AN01001348934</Identity>'                      
         DC    X'2B',C'<SharedSecret>BBSharedSecret</SharedSecret>'             
         DC    X'0D',C'</Credential>'                                           
         DC    X'29',C'<UserAgent>Ariba Network V1.1</UserAgent>'               
         DC    X'09',C'</Sender>'                                               
         DC    X'09',C'</Header>'                                               
         DC    X'25',C'<Request deploymentMode="production">'                   
         DC    X'FF'                                                            
***                                                                             
* SMUCKERS XML INVOICE DETAIL TABLE                                             
* FORMAT IS XL1              FIELD NUMBER (USED IN SMSPCL)                      
*           XL1              TABLE ENTRY LENGTH                                 
*           CL(ENTRY LENGTH) TABLE DATA                                         
***                                                                             
SMBTAB   DC    X'19',X'16',C'<InvoiceDetailRequest>'                            
         DC    X'1A',X'88',C'<InvoiceDetailRequestHeader invoiceDate="'         
SMIDAT   DC                C'2018-03-12T00:00:00-05:00" invoiceID="'            
SMINUM   DC                C'L-83-5149" operation="new" purpose="'              
SMIPURP  DC                C'lineLevelCreditMemo">'                             
         DC    X'1B',X'1F',C'<InvoiceDetailHeaderIndicator/>'                   
         DC    X'1C',X'1D',C'<InvoiceDetailLineIndicator/>'                     
         DC    X'1D',X'10',C'<InvoicePartner>'                                  
         DC    X'1E',X'37',C'<Contact addressID="BILL-TO-AP-DOMESTIC" '         
         DC                C'role="billTo">'                                    
         DC    X'1F',X'17',C'<Name xml:lang="en-US">'                           
         DC    X'20',X'07',C'</Name>'                                           
         DC    X'21',X'15',C'<PostalAddress name="'                             
         DC    X'22',X'02',C'">'                                                
         DC    X'23',X'08',C'<Street>'                                          
         DC    X'24',X'09',C'</Street>'                                         
         DC    X'25',X'06',C'<City>'                                            
         DC    X'26',X'07',C'</City>'                                           
         DC    X'27',X'07',C'<State>'                                           
         DC    X'28',X'08',C'</State>'                                          
         DC    X'29',X'0C',C'<PostalCode>'                                      
         DC    X'2A',X'0D',C'</PostalCode>'                                     
         DC    X'2B',X'34',C'<Country isoCountryCode="US">United State'         
         DC                C's</Country>'                                       
         DC    X'2C',X'10',C'</PostalAddress>'                                  
         DC    X'2D',X'13',C'<Phone name="work">'                               
         DC    X'2E',X'11',C'<TelephoneNumber>'                                 
         DC    X'2F',X'30',C'<CountryCode isoCountryCode="US">1</Count'         
         DC                C'ryCode>'                                           
         DC    X'30',X'21',C'<AreaOrCityCode></AreaOrCityCode>'                 
         DC    X'31',X'11',C'<Number></Number>'                                 
         DC    X'32',X'12',C'</TelephoneNumber>'                                
         DC    X'33',X'08',C'</Phone>'                                          
         DC    X'34',X'0A',C'</Contact>'                                        
         DC    X'35',X'11',C'</InvoicePartner>'                                 
         DC    X'36',X'10',C'<InvoicePartner>'                                  
         DC    X'37',X'37',C'<Contact addressID="BILL-TO-AP-DOMESTIC" '         
         DC                C'role="soldTo">'                                    
         DC    X'38',X'17',C'<Name xml:lang="en-US">'                           
         DC    X'39',X'07',C'</Name>'                                           
         DC    X'3A',X'15',C'<PostalAddress name="'                             
         DC    X'3B',X'02',C'">'                                                
         DC    X'3C',X'08',C'<Street>'                                          
         DC    X'3D',X'09',C'</Street>'                                         
         DC    X'3E',X'06',C'<City>'                                            
         DC    X'3F',X'07',C'</City>'                                           
         DC    X'40',X'07',C'<State>'                                           
         DC    X'41',X'08',C'</State>'                                          
         DC    X'42',X'0C',C'<PostalCode>'                                      
         DC    X'43',X'0D',C'</PostalCode>'                                     
         DC    X'44',X'34',C'<Country isoCountryCode="US">United State'         
         DC                C's</Country>'                                       
         DC    X'45',X'10',C'</PostalAddress>'                                  
         DC    X'46',X'13',C'<Phone name="work">'                               
         DC    X'47',X'11',C'<TelephoneNumber>'                                 
         DC    X'48',X'30',C'<CountryCode isoCountryCode="US">1</Count'         
         DC                C'ryCode>'                                           
         DC    X'49',X'21',C'<AreaOrCityCode></AreaOrCityCode>'                 
         DC    X'4A',X'11',C'<Number></Number>'                                 
         DC    X'4B',X'12',C'</TelephoneNumber>'                                
         DC    X'4C',X'08',C'</Phone>'                                          
         DC    X'4D',X'0A',C'</Contact>'                                        
         DC    X'4E',X'11',C'</InvoicePartner>'                                 
         DC    X'4F',X'10',C'<InvoicePartner>'                                  
         DC    X'50',X'2B',C'<Contact addressID="289479" role="remitTo'         
         DC                C'">'                                                
         DC    X'51',X'27',C'<Name xml:lang="en-US">Carat USA</Name>'           
         DC    X'52',X'0F',C'<PostalAddress>'                                   
         DC    X'53',X'1F',C'<Street>P.O. Box 28004</Street>'                   
         DC    X'54',X'15',C'<City>New York</City>'                             
         DC    X'55',X'11',C'<State>NY</State>'                                 
         DC    X'56',X'23',C'<PostalCode>10087-8004</PostalCode>'               
         DC    X'57',X'34',C'<Country isoCountryCode="US">United State'         
         DC                C's</Country>'                                       
         DC    X'58',X'10',C'</PostalAddress>'                                  
         DC    X'59',X'0A',C'</Contact>'                                        
         DC    X'5A',X'11',C'</InvoicePartner>'                                 
         DC    X'5B',X'17',C'<InvoiceDetailShipping>'                           
         DC    X'5C',X'14',C'<Contact addressID="'                              
         DC    X'5D',X'10',C'" role="shipTo">'                                  
         DC    X'5E',X'1E',C'<Name xml:lang="en-US"></Name>'                    
         DC    X'5F',X'2F',C'<PostalAddress name="SMUCKER SERVICES COM'         
         DC                C'PANY">'                                            
         DC    X'60',X'17',C'<DeliverTo></DeliverTo>'                           
         DC    X'61',X'11',C'<Street></Street>'                                 
         DC    X'62',X'09',C'<Street/>'                                         
         DC    X'63',X'0D',C'<City></City>'                                     
         DC    X'64',X'0F',C'<State></State>'                                   
         DC    X'65',X'19',C'<PostalCode></PostalCode>'                         
         DC    X'66',X'27',C'<Country isoCountryCode="US"></Country>'           
         DC    X'67',X'10',C'</PostalAddress>'                                  
         DC    X'68',X'0A',C'</Contact>'                                        
         DC    X'69',X'19',C'<Contact role="shipFrom">'                         
         DC    X'6A',X'24',C'<Name xml:lang="en">Carat USA</Name>'              
         DC    X'6B',X'0F',C'<PostalAddress>'                                   
         DC    X'6C',X'24',C'<Street>500 Woodward Avenue</Street>'              
         DC    X'6D',X'09',C'<Street/>'                                         
         DC    X'6E',X'14',C'<City>Detroit</City>'                              
         DC    X'6F',X'11',C'<State>MI</State>'                                 
         DC    X'70',X'23',C'<PostalCode>48226-3416</PostalCode>'               
         DC    X'71',X'34',C'<Country isoCountryCode="US">United State'         
         DC                C's</Country>'                                       
         DC    X'72',X'10',C'</PostalAddress>'                                  
         DC    X'73',X'0A',C'</Contact>'                                        
         DC    X'74',X'18',C'</InvoiceDetailShipping>'                          
         DC    X'75',X'0A',C'<Comments>'                                        
         DC    X'76',X'0C',C'<Attachment>'                                      
         DC    X'77',X'0B',C'<URL></URL>'                                       
         DC    X'78',X'0D',C'</Attachment>'                                     
         DC    X'79',X'0B',C'</Comments>'                                       
         DC    X'7A',X'1D',C'<Extrinsic name="invoicePDF">'                     
         DC    X'7B',X'0C',C'<Attachment>'                                      
         DC    X'7C',X'0B',C'<URL></URL>'                                       
         DC    X'7D',X'0D',C'</Attachment>'                                     
         DC    X'7E',X'0C',C'</Extrinsic>'                                      
         DC    X'7F',X'1D',C'</InvoiceDetailRequestHeader>'                     
         DC    X'80',X'14',C'<InvoiceDetailOrder>'                              
         DC    X'81',X'18',C'<InvoiceDetailOrderInfo>'                          
         DC    X'82',X'19',C'<OrderReference orderID="'                         
         DC    X'83',X'02',C'">'                                                
         DC    X'84',X'21',C'<DocumentReference payloadID=""/>'                 
         DC    X'85',X'11',C'</OrderReference>'                                 
         DC    X'86',X'19',C'</InvoiceDetailOrderInfo>'                         
         DC    X'87',X'33',C'<InvoiceDetailItem invoiceLineNumber="1" '         
         DC                C'quantity="'                                        
         DC    X'88',X'02',C'">'                                                
         DC    X'89',X'21',C'<UnitOfMeasure>EA</UnitOfMeasure>'                 
         DC    X'8A',X'0B',C'<UnitPrice>'                                       
         DC    X'8B',X'22',C'<Money currency="USD">1.00</Money>'                
         DC    X'8C',X'0C',C'</UnitPrice>'                                      
         DC    X'8D',X'2B',C'<InvoiceDetailItemReference lineNumber="1'         
         DC                C'">'                                                
         DC    X'8E',X'08',C'<ItemID>'                                          
         DC    X'8F',X'10',C'<SupplierPartID>'                                  
         DC    X'8F',X'11',C'</SupplierPartID>'                                 
         DC    X'90',X'09',C'</ItemID>'                                         
         DC    X'91',X'1B',C'<Description xml:lang="en">'                       
         DC    X'92',X'0E',C'</Description>'                                    
         DC    X'93',X'1D',C'</InvoiceDetailItemReference>'                     
         DC    X'94',X'10',C'<SubtotalAmount>'                                  
         DC    X'95',X'16',C'<Money currency="USD">'                            
         DC    X'96',X'08',C'</Money>'                                          
         DC    X'97',X'11',C'</SubtotalAmount>'                                 
         DC    X'98',X'0D',C'<GrossAmount>'                                     
         DC    X'99',X'16',C'<Money currency="USD">'                            
         DC    X'9A',X'08',C'</Money>'                                          
         DC    X'9B',X'0E',C'</GrossAmount>'                                    
         DC    X'9C',X'17',C'<InvoiceDetailDiscount>'                           
         DC    X'9D',X'17',C'<Money currency="USD"/>'                           
         DC    X'9E',X'18',C'</InvoiceDetailDiscount>'                          
         DC    X'9F',X'0B',C'<NetAmount>'                                       
         DC    X'A0',X'16',C'<Money currency="USD">'                            
         DC    X'A1',X'08',C'</Money>'                                          
         DC    X'A2',X'0C',C'</NetAmount>'                                      
         DC    X'A3',X'14',C'</InvoiceDetailItem>'                              
         DC    X'A4',X'15',C'</InvoiceDetailOrder>'                             
         DC    X'A5',X'16',C'<InvoiceDetailSummary>'                            
         DC    X'A6',X'10',C'<SubtotalAmount>'                                  
         DC    X'A7',X'16',C'<Money currency="USD">'                            
         DC    X'A8',X'08',C'</Money>'                                          
         DC    X'A9',X'11',C'</SubtotalAmount>'                                 
         DC    X'AA',X'05',C'<Tax>'                                             
         DC    X'AB',X'22',C'<Money currency="USD">0.00</Money>'                
         DC    X'AC',X'35',C'<Description xml:lang="en-US">total tax</'         
         DC                C'Description>'                                      
         DC    X'AD',X'1C',C'<TaxDetail category="sales">'                      
         DC    X'AE',X'0F',C'<TaxableAmount>'                                   
         DC    X'AF',X'22',C'<Money currency="USD">0.00</Money>'                
         DC    X'B0',X'10',C'</TaxableAmount>'                                  
         DC    X'B1',X'0B',C'<TaxAmount>'                                       
         DC    X'B2',X'22',C'<Money currency="USD">0.00</Money>'                
         DC    X'B3',X'0C',C'</TaxAmount>'                                      
         DC    X'B4',X'1F',C'<Description xml:lang="en-US"/>'                   
         DC    X'B5',X'0C',C'</TaxDetail>'                                      
         DC    X'B6',X'06',C'</Tax>'                                            
         DC    X'B7',X'10',C'<ShippingAmount>'                                  
         DC    X'B8',X'22',C'<Money currency="USD">0.00</Money>'                
         DC    X'B9',X'11',C'</ShippingAmount>'                                 
         DC    X'BA',X'0D',C'<GrossAmount>'                                     
         DC    X'BB',X'16',C'<Money currency="USD">'                            
         DC    X'BC',X'08',C'</Money>'                                          
         DC    X'BD',X'0E',C'</GrossAmount>'                                    
         DC    X'BE',X'0B',C'<NetAmount>'                                       
         DC    X'BF',X'16',C'<Money currency="USD">'                            
         DC    X'C0',X'08',C'</Money>'                                          
         DC    X'C1',X'0C',C'</NetAmount>'                                      
         DC    X'C2',X'0B',C'<DueAmount>'                                       
         DC    X'C3',X'16',C'<Money currency="USD">'                            
         DC    X'C4',X'08',C'</Money>'                                          
         DC    X'C5',X'0C',C'</DueAmount>'                                      
         DC    X'C6',X'17',C'</InvoiceDetailSummary>'                           
         DC    X'C7',X'17',C'</InvoiceDetailRequest>'                           
         DC    X'FF'                                                            
***                                                                             
* SMUCKERS XML FOOTER TABLE                                                     
* FORMAT IS XL1              TABLE ENTRY LENGTH                                 
*           CL(ENTRY LENGTH) TABLE DATA                                         
***                                                                             
SMFTAB   DC    X'0A',C'</Request>'                                              
         DC    X'07',C'</cXML>'                                                 
         DC    X'FF'                                                            
***                                                                             
* SMUCKERS XML INVOICE SPECIAL FIELDS TABLE                                     
* THIS MAPS AGAINST THE FIRST FIELD OF SMBTAB AND IF IT MATCHES                 
* WE INDEX INTO SMUCKRSD (BUILT IN TPREC+200) USING THE DISPLACEMENT            
* IN THE SECOND FIELD FOR A PRE-DEFINED LENGTH (3RD FIELD)                      
* WE DO THIS IN ORDER TO HANDLE DATA THAT WAS BOTH SOFT AND VARIABLE            
* IN LENGTH                                                                     
* FORMAT IS XL1              FIELD NUMBER (MATCHED AGAINST SMBTAB)              
*           AL1              DISPLACEMENT INTO SMUCKRSD IN TPREC+200            
*           AL(ENTRY LENGTH) MAX LENGTH OF SOFT DATA                            
***                                                                             
SMSPCL   DC    X'1F',AL1(SMCNAME-SMUCKRSD),AL1(L'SMCNAME)                       
         DC    X'21',AL1(SMCNAME-SMUCKRSD),AL1(L'SMCNAME)                       
         DC    X'23',AL1(SMADD-SMUCKRSD),AL1(L'SMADD)                           
         DC    X'25',AL1(SMCITY-SMUCKRSD),AL1(L'SMCITY)                         
         DC    X'27',AL1(SMSTATE-SMUCKRSD),AL1(L'SMSTATE)                       
         DC    X'29',AL1(SMZIP-SMUCKRSD),AL1(L'SMZIP)                           
         DC    X'38',AL1(SMCNAME-SMUCKRSD),AL1(L'SMCNAME)                       
         DC    X'3A',AL1(SMCNAME-SMUCKRSD),AL1(L'SMCNAME)                       
         DC    X'3C',AL1(SMADD-SMUCKRSD),AL1(L'SMADD)                           
         DC    X'3E',AL1(SMCITY-SMUCKRSD),AL1(L'SMCITY)                         
         DC    X'40',AL1(SMSTATE-SMUCKRSD),AL1(L'SMSTATE)                       
         DC    X'42',AL1(SMZIP-SMUCKRSD),AL1(L'SMZIP)                           
         DC    X'5C',AL1(SMEUDEF2-SMUCKRSD),AL1(L'SMEUDEF2)                     
         DC    X'82',AL1(SMEUDEF1-SMUCKRSD),AL1(L'SMEUDEF1)                     
         DC    X'87',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'91',AL1(SMEDESC-SMUCKRSD),AL1(L'SMEDESC)                       
         DC    X'95',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'99',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'A0',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'A7',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'BB',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'BF',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'C3',AL1(SMBACT-SMUCKRSD),AL1(L'SMBACT)                         
         DC    X'FF'                                                            
*                                                                               
*                                                                               
*        PHDNY - STARBUCKS                                                      
*                                                                               
SBPROC   NMOD1 0,SBPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    SBPR1                                                            
                                                                                
         BC    0,SBPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (SBPBIT1,(OUTPUT))                                               
                                                                                
SBPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    SBPRL                                                            
*                                                                               
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'    SAVE FOR RUNLAST                                 
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
SBPR15   DS    0H                 INVOICE HEADER                                
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'H'                                                      
         MVI   PBIREC+1,CARET         DELIMITER                                 
         MVC   PBIREC+2(10),=C'127326|100'      STARBUCKS LOCATION              
         MVI   PBIREC+12,CARET         DELIMITER                                
         MVC   PBIREC+13(09),=C'NEWYORK01'                                      
         MVI   PBIREC+22,CARET         DELIMITER                                
*                                                                               
         MVC   SBINVN(10),SPACES                                                
         LA    R1,SBINVN                                                        
         LA    R2,DINVFULL                                                      
         LA    R3,10                                                            
SBIP5A   CLI   0(R2),C'-'              ELIMINATE DASHES                         
         BNE   SBIP5C                                                           
SBIP5B   LA    R2,1(R2)                                                         
         BCT   R3,SBIP5A                                                        
         B     SBIP5X                                                           
*                                                                               
SBIP5C   MVC   0(1,R1),0(R2)                                                    
         LA    R1,1(R1)                                                         
         B     SBIP5B                                                           
*                                                                               
SBIP5X   DS    0H                                                               
         LA    R2,PBIREC+30                                                     
         MVC   PBIREC+23(7),SBINVN                                              
         CLI   SBINVN+6,C' '                                                    
         BH    SBPR17                                                           
         LA    R2,PBIREC+31                                                     
         MVC   PBIREC+23(8),SBINVN                                              
         CLI   SBINVN+7,C' '                                                    
         BH    SBPR17                                                           
         LA    R2,PBIREC+32                                                     
         MVC   PBIREC+23(09),SBINVN                                             
SBPR17   MVI   0(R2),CARET             DELIMITER                                
         LA    R2,1(R2)                                                         
         MVC   0(8,R2),CTODAY        YYYMMDD                                    
         MVI   8(R2),CARET         DELIMITER                                    
         LA    R2,9(R2)                                                         
         EDIT  PBILLRCV,(13,0(R2)),2,ZERO=NOBLANK,FLOAT=-,ALIGN=LEFT            
         AR    R2,R0                                                            
         MVI   0(R2),CARET             DELIMITER                                
         LA    R2,1(R2)                                                         
         MVC   0(05,R2),=C'TRADE'                                               
         MVI   5(R2),CARET                                                      
         CLI   QMEDIA,C'T'                                                      
         BE    SBPR18                                                           
         MVC   0(06,R2),=C'SEARCH'                                              
         MVI   6(R2),CARET                                                      
         CLI   QMEDIA,C'S'                                                      
         BE    SBPR18                                                           
         MVC   0(06,R2),=C'SOCIAL'                                              
         MVI   6(R2),CARET                                                      
         CLI   QMEDIA,C'L'                                                      
         BE    SBPR18                                                           
         MVC   0(06,R2),=C'MOBILE'                                              
         MVI   6(R2),CARET                                                      
         CLI   QMEDIA,C'B'                                                      
         BE    SBPR18                                                           
         MVC   0(10,R2),=C'DIG. AUDIO'                                          
         MVI   10(R2),CARET                                                     
         CLI   QMEDIA,C'D'                                                      
         BE    SBPR18                                                           
         MVC   0(07,R2),=C'OUTDOOR'                                             
         MVI   7(R2),CARET                                                      
         CLI   QMEDIA,C'O'                                                      
         BE    SBPR18                                                           
         MVC   0(08,R2),=C'CONSUMER'                                            
         MVI   8(R2),CARET                                                      
         CLI   QMEDIA,C'M'                                                      
         BE    SBPR18                                                           
         MVC   0(09,R2),=C'NEWSPAPER'                                           
         MVI   9(R2),CARET                                                      
         CLI   QMEDIA,C'N'                                                      
         BE    SBPR18                                                           
         MVC   0(10,R2),=C'NAT. VIDEO'                                          
         MVI   10(R2),CARET                                                     
         CLI   QMEDIA,C'V'                                                      
         BE    SBPR18                                                           
         MVC   0(10,R2),=C'LOC. VIDEO'                                          
         MVI   10(R2),CARET                                                     
         CLI   QMEDIA,C'W'                                                      
         BE    SBPR18                                                           
         MVC   0(11,R2),=C'INTERACTIVE'                                         
         MVI   11(R2),CARET                                                     
         CLI   QMEDIA,C'I'                                                      
         BE    SBPR18                                                           
         DC    H'0'          UNKNOWN MEDIA                                      
*                                                                               
SBPR18   AP    SBTOTAL,PBILLRCV                                                 
*        NEEDS DELIMITER AND MEDIA NAME                                         
*                                                                               
         AP    SBCOUNT,=P'1'         INVOICE COUNT                              
         CLI   QOPT7,C'Y'                                                       
         BNE   SBPR20                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(130),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,130,0                                       
         GOTO1 REPORT                                                           
*                                                                               
SBPR20   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    SBPR25                                                           
*                                                                               
         LA    R1,SBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
SBPR25   DS    0H                 INVOICE DETAIL                                
*                                                                               
SBPR27   DS    0H                                                               
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    SBPR28              YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
SBPR28   MVC   WORK(32),SPACES   USE TO SAVE GL ACCOUNT                         
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELD                                                       
         BNE   SBPR28P           ELEMENT NOT FOUND - TRY PRODUCT                
*                                                                               
         MVC   WORK(L'PEUSER1),PEUSER1                                          
         CLC   WORK(10),SPACES   IS DATA THERE?                                 
         BNH   SBPR28P           NO - TRY PRODUCT                               
         B     SBPR29                                                           
*                                                                               
SBPR28P  LA    R2,PPRDREC+33                                                    
         USING PPRDUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELD                                                       
         BNE   SBPR29                                                           
         MVC   WORK(L'PUSER1),PUSER1                                            
*                                                                               
         DROP  R2                                                               
*                                                                               
SBPR29   MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'D'                                                      
         MVI   PBIREC+1,CARET       DELIMITER                                   
         MVC   PBIREC+2(6),=C'127326'     SUPPLIER SITE CODE                    
         MVI   PBIREC+8,CARET       DELIMITER                                   
         MVC   PBIREC+09(09),=C'NEWYORK01'                                      
         MVI   PBIREC+18,CARET         DELIMITER                                
*                                                                               
         LA    R2,PBIREC+26                                                     
         MVC   PBIREC+19(7),SBINVN                                              
         CLI   SBINVN+6,C' '                                                    
         BH    SBPR29A                                                          
         LA    R2,PBIREC+27                                                     
         MVC   PBIREC+19(8),SBINVN                                              
         CLI   SBINVN+7,C' '                                                    
         BH    SBPR29A                                                          
         LA    R2,PBIREC+28                                                     
         MVC   PBIREC+19(09),SBINVN                                             
SBPR29A  MVI   0(R2),CARET             DELIMITER                                
         LA    R2,1(R2)                                                         
         MVC   0(8,R2),CTODAY        YYYMMDD                                    
         MVI   8(R2),CARET         DELIMITER                                    
         LA    R2,9(R2)                                                         
*                                                                               
         MVC   0(L'PUSER1,R2),WORK  WORK HAS PRD OR EST USER1 DATA              
*                                                                               
         LA    RE,37+L'PUSER1(R2)                                               
SBPR29B  CLI   0(RE),C' '           FLOAT DELIMITER                             
         BH    SBPR29C                                                          
         BCT   RE,SBPR29B                                                       
*                                                                               
SBPR29C  MVI   1(RE),CARET          DELIMITER                                   
         LA    RE,2(RE)                                                         
         EDIT  PBILLRCV,(13,0(RE)),2,ZERO=NOBLANK,FLOAT=-,ALIGN=LEFT            
         AR    RE,R0               ADDRESS OF FLOAT CHARACTER                   
         MVI   0(RE),CARET     DELIMITER                                        
         LA    RE,1(RE)                                                         
         MVC   0(4,RE),=C'ITEM'   YES 2 DELIMITERS-EMPTY FIELD                  
         MVI   4(RE),CARET                                                      
         MVI   5(RE),CARET                                                      
         LA    RE,6(RE)                                                         
         ST    RE,MYFULL                                                        
*                                                                               
         MVC   WORK(50),SPACES                                                  
         MVC   WORK(3),PPRDKPRD                                                 
         MVC   WORK+4(20),PESTNAME                                              
         OC    WORK+4(20),SPACES     JUST IN CASE                               
         LA    RF,WORK+24                                                       
SBPR29E  CLI   0(RF),C' '                                                       
         BH    SBPR29G                                                          
         BCT   RF,SBPR29E                                                       
*                                                                               
SBPR29G  DS    0H                                                               
         LA    R2,2(RF)                                                         
         GOTO1 DATCON,DMCB,(3,PBILKMOS),(9,0(R2))                               
         LA    R2,6(R2)                                                         
         MVC   0(09,R2),CARETS9                                                 
         L     RE,MYFULL                                                        
         MVC   0(50,RE),WORK                                                    
*******  AP    SBCOUNT,=P'1'     DON'T BUMP COUNT                               
*                                ONE DETAIL PER INVOICE                         
         CLI   QOPT7,C'Y'                                                       
         BNE   SBPR30                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(130),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,130,0                                       
         GOTO1 REPORT                                                           
*                                                                               
SBPR30   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    SBPR35                                                           
*                                                                               
         LA    R1,SBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
SBPR35   DS    0H                                                               
         B     SBX                                                              
*                                                                               
SBX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
SBPRL    DS    0H                                                               
*                              FILE TOTAL RECORD                                
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
*******  AP    SBCOUNT,=P'1'          DON'T COUNT THIS RECORD                   
         MVI   PBIREC,C'B'                                                      
         MVI   PBIREC+1,CARET         DELIMITER                                 
*                                                                               
*        RECORD COUNTS AND TOTAL $                                              
*                                                                               
*                                                                               
         LA    R2,PBIREC+2                                                      
         EDIT  SBCOUNT,(4,0(R2)),0,ALIGN=LEFT                                   
         AR    R2,R0                                                            
         MVI   0(R2),CARET          DELIMITER                                   
         LA    R2,1(R2)                                                         
         EDIT  SBCOUNT,(4,0(R2)),0,ALIGN=LEFT                                   
         AR    R2,R0                                                            
         MVI   0(R2),CARET          DELIMITER                                   
         LA    R2,1(R2)                                                         
         EDIT  SBTOTAL,(13,0(R2)),2,ZERO=NOBLANK,FLOAT=-,ALIGN=LEFT             
         AR    R2,R0                                                            
         MVI   0(R2),CARET          DELIMITER                                   
*                                                                               
         CLI   SVQOPT7,C'Y'                                                     
         BNE   SBPRL5                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(50),PBIREC                                                     
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,50,0                                        
         GOTO1 REPORT                                                           
*                                                                               
SBPRL5   DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'         TEST RUN - NO TAPE                          
         BE    SBPRL15                                                          
*                                                                               
         LA    R1,SBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
SBPRL15  DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'          TEST RUN - NO TAPE                         
         BE    SBX                                                              
*                                                                               
         LA    R2,SBPBIT1                                                       
         CLOSE ((2),)                                                           
         B     SBX                                                              
*                                                                               
         XIT                                                                    
*                                                                               
SBPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00130,                                            X        
               BLKSIZE=00130,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
CARET    EQU   X'B0'                                                            
CARETS9  DC    X'B0B0B0B0B0B0B0B0B0'                                            
*                                                                               
NEXTELB  NTR1  BASE=*,LABEL=*                                                   
NEXTELB1 ZIC   R0,1(R2)                                                         
         AR    R2,R0                                                            
         CLI   0(R2),0                                                          
         BE    NEXTELBX                                                         
         CLC   0(1,R2),MELCODE                                                  
         BE    *+10                                                             
         B     NEXTELB1                                                         
NEXTELBX LTR   RE,RE       NOT FOUND -                                          
*                                                                               
         XIT1  REGS=(R2)                                                        
*                                                                               
         LTORG                                                                  
*                                                                               
*        MSYNA - OB10 FORMAT COLGATE (C)                                        
*                                                                               
OBPROC   NMOD1 0,OBPROC                                                         
         L     RC,PPFILEC                                                       
*                                                                               
*                                                                               
         CLI   QOPT7,C'Y'             TEST RUN - NO TAPE                        
         BE    OBPR1                                                            
                                                                                
         BC    0,OBPR1                                                          
         OI    *-3,X'F0'                                                        
         GOTO1 DYNALLOC,DMCB,(0,DYNDDN),(0,DYNDSN)                              
         OPEN  (OBPBIT1,(OUTPUT))                                               
                                                                                
OBPR1    DS    0H                                                               
         CLI   MODE,RUNLAST                                                     
         BE    OBPRL                                                            
*                                                                               
         MVI   OBERRSW,0       CLEAR ERROR SWITCH                               
         MVI   OBISKIP,C'N'                                                     
         MVI   SVQOPT7,C'N'                                                     
         CLI   QOPT7,C'Y'                                                       
         BNE   *+8                                                              
         MVI   SVQOPT7,C'Y'    SAVE FOR RUNLAST                                 
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVC   WORK(12),PBILLREC                                                
         MVI   WORK+3,7                                                         
         CLC   PESTREC(12),WORK        TEST HAVE EST HDR                        
         BE    OBPR5               YES                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(12),PBILLREC                                                 
         MVI   KEY+3,7                                                          
         GOTO1 READ                                                             
         GOTO1 GETEST                                                           
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
OBPR5    DS    0H                                                               
         LA    R2,PESTREC+33                                                    
         USING PESTUDEF,R2                                                      
         MVI   MELCODE,X'08'     LOOK FOR USER ELEMENT                          
         BRAS  RE,NEXTELD                                                       
         BNE   OBESERR           ELEMENT NOT FOUND - SEND MESSAGE               
*                                                                               
         MVC   PBIREC+300(L'PEUSER1),PEUSER1                                    
         MVC   PBIREC+332(L'PEUSER2),PEUSER2                                    
         CLC   PBIREC+300(L'PEUSER1),SPACES   DATA PRESENT?                     
         BNH   OBESERR           NO - ERROR                                     
         CLC   PBIREC+332(L'PEUSER2),SPACES   DATA PRESENT?                     
         BNH   OBESERR           NO - ERROR                                     
         B     OBPR15      PROCESS                                              
*                                                                               
         DROP  R2                                                               
*                                                                               
OBESERR  DS    0H                                                               
         MVC   P(42),=C'*** MISSING USER DATA FOR ESTIMATE     ***'             
         MVC   HALF,PBILKEST                                                    
         LH    R0,HALF                                                          
         CVD   R0,DUB                                                           
         OI    DUB+7,X'0F'                                                      
         UNPK  P+35(3),DUB+6(2)                                                 
         MVC   PSECOND(23),=C'*** INVOICE SKIPPED ***'                          
         GOTO1 REPORT                                                           
*                                                                               
         MVI   OBERRSW,C'Y'        SET ERRORS ENCOUNTERED                       
         MVI   OBISKIP,C'Y'                                                     
         B     OBX                                                              
*                                  I NEED THE FIRST 3                           
OBPR15   DS    0H                INVOICE RECORD                                 
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'A'                                                      
         MVI   PBIREC+1,C','          DELIMITER                                 
         MVI   PBIREC+2,C'I'                                                    
         CP    PBILLRCV,=P'0'                                                   
         BNL   *+8                                                              
         MVI   PBIREC+2,C'C'          CREDIT INVOICE                            
         MVI   PBIREC+3,C','          DELIMITER                                 
         MVC   PBIREC+4(10),DINVFULL                                            
         MVI   PBIREC+14,C','         DELIMITER                                 
*                                                                               
*        ORIGINAL INV # FOR CREDIT GOES HERE?                                   
*        SEARCH FOR FIRST BILL FOR THIS MED/CLT/PRD/EST                         
*                                                                               
         LA    R2,PBIREC+15                                                     
*                                                                               
         CP    PBILLRCV,=P'0'      SEE IF A CREDIT                              
         BNL   OBPR15N                                                          
         MVC   WORK(64),KEY        SAVE KEY FOR SEQ                             
         XC    KEY,KEY                                                          
         MVC   KEY(14),PBILLREC  MED/CLT/PRD/EST/MOS                            
         GOTO1 HIGH                                                             
         CLC   KEY(14),KEYSAVE                                                  
         BNE   OBPR15N           DID I FIND ONE?                                
         LA    R2,KEY                                                           
         USING PBILLREC,R2                                                      
         MVC   OBWORK+6(2),PBILKBMN    YEAR/MTH OF FOUND BILL                   
         MVI   OBWORK+8,X'01'      SET DAY TO 1                                 
         GOTO1 DATCON,DMCB,(3,OBWORK+6),(0,OBWORK)  YYMMDD                      
*                                                                               
         GOTO1 =V(PPFMTINO),DMCB,OBWORK,(2,PBILKBNO),(PBILKMED,B1PROF),X        
               B1XPROF                                                          
         DROP  R2                                                               
*                                                                               
         L     RF,DMCB                                                          
         MVC   PBIREC+15(10),0(RF)  FULL INVOICE NUMBERR                        
         LA    R2,PBIREC+25                                                     
         MVC   KEY(64),WORK                                                     
         GOTO1 HIGH                                                             
*                                                                               
OBPR15N  MVI   0(R2),C','         DELIMITER                                     
         LA    R2,1(R2)                                                         
         GOTO1 DATCON,DMCB,(3,PBILINVD),(20,WORK)      INV DATE                 
         MVC   0(2,R2),WORK+4       MM                                          
         MVC   2(2,R2),WORK+6       DD                                          
         MVC   4(4,R2),WORK         YYYY                                        
         LA    R2,8(R2)                                                         
         MVI   0(R2),C','                                                       
         LA    R2,1(R2)                                                         
*                                                                               
         MVC   0(3,R2),=C',,,'      3 EMPTY FIELDS                              
         LA    R2,3(R2)                                                         
*                                                                               
         MVC   0(10,R2),PBIREC+332  SAVED EST USER 2                            
         MVI   10(R2),C','                                                      
         LA    R2,11(R2)                                                        
         MVC   0(2,R2),=C',,'    2 EMPTY FIELDS                                 
         LA    R2,2(R2)                                                         
         MVC   0(7,R2),=C'1310276'   BILL TO CUSTOMER                           
*                                                                               
*        1310276 FOR COLGATE - DIFFERENT FOR OTHERS?                            
*                                                                               
         MVI   7(R2),C','     DELIMITER                                         
         LA    R2,8(R2)                                                         
         MVC   0(27,R2),=C',,,,,,,,,,,,,,,,,,,,,,,,,,,'                         
         LA    R2,27(R2)                                                        
*                                                                               
*        LAST FIELD FOR A COMMENT?                                              
*                                                                               
         MVI   0(R2),C','     EMPTY FOR NOW                                     
*****************************************************                           
*****  END OF A RECORD                                                          
*****************************************************                           
         AP    OBCOUNT,=P'1'                                                    
         CLI   QOPT7,C'Y'                                                       
         BNE   OBPR20                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,100,0                                       
         GOTO1 REPORT                                                           
*                                                                               
OBPR20   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    OBPR25                                                           
*                                                                               
         LA    R1,OBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
OBPR25   DS    0H                 INVOICE LINE DETAIL                           
*                                                                               
*                                                                               
OBPR29   MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'B'                                                      
         MVI   PBIREC+1,C','        DELIMITER                                   
***                                                                             
***      PO LINE NUMBER HERE FIRST EST USER?                                    
***      FOLLOWED BY PRODUCT CODE, PRODUCT DESCRIPTION,                         
***                                                                             
         MVC   PBIREC+2(6),PBIREC+300   SAVED EST USER 1                        
         LA    R2,PBIREC+7                                                      
OBPR32   CLI   0(R2),C' '    SCAN BACKWARD FOR FIRST NON-SPACE                  
         BH    OBPR32X                                                          
         SH    R2,=H'1'                                                         
         B     OBPR32                                                           
*                                                                               
OBPR32X  DS    0H                                                               
         MVI   1(R2),C','     DELIMITER                                         
         LA    R2,1(R2)                                                         
         MVC   0(2,R2),=C',,'         2 EMPTY FIELDS                            
         LA    R2,2(R2)                                                         
         MVC   0(2,R2),=C'EA'   UNIT OF MEASURE - EACH?                         
         MVI   2(R2),C','        DELIMITER                                      
         LA    R2,3(R2)                                                         
         EDIT  PBILLRCV,(13,0(R2)),2,ZERO=NOBLANK,FLOAT=-,ALIGN=LEFT            
         AR    R2,R0       LENGTH OF FIELD                                      
         MVI   0(R2),C','  DELIMITER                                            
         MVI   1(R2),C'1'        QUANTITY IS 1                                  
         MVI   2(R2),C','        DELIMITER                                      
         MVI   3(R2),C','        EMPTY TAX FIELD                                
         LA    R2,4(R2)                                                         
         EDIT  PBILLRCV,(13,0(R2)),2,ZERO=NOBLANK,FLOAT=-,ALIGN=LEFT            
         AR    R2,R0       LENGTH OF FIELD                                      
         MVI   0(R2),C','  DELIMITER                                            
         MVC   1(2,R2),=C',,'      2 EMPTY FIELDS                               
*                                                                               
*         LAST COULD BE A COMMENT                                               
*                                                                               
*                                                                               
         AP    OBCOUNT,=P'1'                                                    
         CLI   QOPT7,C'Y'                                                       
         BNE   OBPR30                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,100,0                                       
         GOTO1 REPORT                                                           
*                                                                               
OBPR30   DS    0H                                                               
*                                                                               
         CLI   QOPT7,C'Y'         TEST RUN - NO TAPE                            
         BE    OBPR35                                                           
*                                                                               
         LA    R1,OBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
OBPR35   DS    0H                                                               
*                                                                               
         CP    OBCOUNT,=P'0' ANY RECORDS CREATED?                               
         BE    OBPR50                                                           
*                                                                               
         MVI   PBIREC,C' '                                                      
         MVC   PBIREC+1(L'PBIREC-1),PBIREC                                      
*                                                                               
         MVI   PBIREC,C'C'                                                      
         MVI   PBIREC+1,C','          DELIMITER                                 
         MVC   PBIREC+2(7),=C',,,,,,,'    7 EMPTY FIELDS                        
*                                                                               
         LA    R2,PBIREC+9                                                      
         EDIT  PBILLRCV,(13,0(R2)),2,ZERO=NOBLANK,FLOAT=-,ALIGN=LEFT            
         AR    R2,R0       LENGTH OF FIELD                                      
         MVI   0(R2),C','  DELIMITER                                            
         MVI   1(R2),C','       1 EMPTY FIELD                                   
*                                                                               
*        RECORD COUNTS AND TOTAL $                                              
*                                                                               
*******  EDIT  OBCOUNT,(10,PBIREC+2),0,FILL=0                                   
*******  MVI   PBIREC+12,C','          DELIMITER                                
*******  EDIT  OBTOTAL,(13,PBIREC+13),2,FILL=0,ZERO=NOBLANK,FLOAT=-             
*******                                                                         
         CLI   SVQOPT7,C'Y'                                                     
         BNE   OBPR45                                                           
         MVC   P(14),=C'***TAPE RECORD'                                         
         GOTO1 REPORT                                                           
         MVC   P(100),PBIREC                                                    
         GOTO1 REPORT                                                           
         MVC   P(20),=C'***TAPE RECORD - HEX'                                   
         GOTO1 REPORT                                                           
         GOTO1 HEXOUT,DMCB,PBIREC,P,100,0                                       
         GOTO1 REPORT                                                           
*                                                                               
OBPR45   DS    0H                                                               
*                                                                               
         CLI   SVQOPT7,C'Y'         TEST RUN - NO TAPE                          
         BE    OBPR50                                                           
*                                                                               
         LA    R1,OBPBIT1                                                       
         LA    R0,PBIREC                                                        
         PUT   (1),(0)                                                          
*                                                                               
OBPR50  DS   0H                                                                 
         B     OBX                                                              
*                                                                               
OBX      DS    0H                                                               
         XIT1                                                                   
*                                                                               
OBPRL    DS    0H                                                               
*                                                                               
*                                                                               
         CLI   OBERRSW,C'Y'          WERE ERRORS ECOUNTERED?                    
         BNE   OBPRL20                                                          
         MVC   P(34),=C'*** WARNING-ERRORS ENCOUNTERED ***'                     
         MVC   PSECOND(54),=C'*** PRODUCTS WITH MISSING UCOMM DATA NOT X        
               PROCESSED ***'                                                   
         MVI   SPACING,2                                                        
         GOTO1 REPORT                                                           
         CP    OBCOUNT,=P'0'         ANY RECORDS CREATED?                       
         BE    OBX                   NO - JUST EXIT                             
*                                                                               
OBPRL20  CLI   SVQOPT7,C'Y'          TEST RUN - NO TAPE                         
         BE    OBX                                                              
*                                                                               
         LA    R2,OBPBIT1                                                       
         CLOSE ((2),)                                                           
         B     OBX                                                              
*                                                                               
         XIT                                                                    
*                                                                               
OBPBIT1  DCB   DDNAME=P10TAPE,                                         X        
               DSORG=PS,                                               X        
               RECFM=FB,                                               X        
               LRECL=00100,                                            X        
               BLKSIZE=00100,                                          X        
               MACRF=PM                                                         
         LTORG                                                                  
*                                                                               
OBERRSW  DS    CL1                                                              
OBWORK   DS    CL20                                                             
*                                                                               
         LTORG                                                                  
*                                                                               
         TITLE 'DSECTS AND WORK AREAS'                                          
PP10WRKD DSECT                                                                  
PP10WRK  DS    0C                                                               
AOUTP    DS    A                                                                
VOFFICER DS    A                                                                
RELO     DS    A                                                                
AMQRPT   DS    A                                                                
AFMTAMTS DS    A                                                                
ADMASTC  DS    A           VMASTC                                               
*                                                                               
LOWINV   DS    H           START INVOICE NUMBER                                 
HIINV    DS    H           END INVOICE NUMBER                                   
*                                                                               
START    DS    CL6                                                              
END      DS    CL6                                                              
ZEROS    DS    CL30                                                             
DYNSW    DS    CL1                                                              
         DS    0D                                                               
DGCOUNT  DS    PL8                                                              
DGTOTAL  DS    PL8                                                              
DGISKIP  DS    CL1                                                              
*                                                                               
GMCOUNT  DS    PL8                                                              
GMISKIP  DS    CL1                                                              
*                                                                               
OBCOUNT  DS    PL8                                                              
OBTOTAL  DS    PL8                                                              
OBISKIP  DS    CL1                                                              
*                                                                               
DG2COUNT DS    PL8                                                              
DG2TOTAL DS    PL8                                                              
SBCOUNT  DS    PL8                                                              
SBTOTAL  DS    PL8                                                              
SBINVN   DS    CL10                                                             
MYGST    DS    PL8                                                              
MYPST    DS    PL8                                                              
MYHST    DS    PL8                                                              
MYDUB    DS    PL8                                                              
BIGDUB   DS    PL12                                                             
*                                                                               
FIRSTSW  DS    X                                                                
SAVCOFF  DS    CL2         OFFICE CODE (FROM OFFICER CALL)                      
REVSW    DS    CL1                 REVISION STATUS                              
RETAIL   DS    CL1                 'Y' IF RETAIL BILL                           
OACTSW   DS    CL1         SET TO 1 IF BILL FOR OFFICE PROCESSED                
RACTSW   DS    CL1         SET TO 1 IF BILL FOR REQUEST PROCESSED               
LSTBLKY  DS    XL25                                                             
         DS    0F                                                               
EATOTS   DS    XL16                                                             
TAPTYP   DS    C                                                                
LASTKEY  DS    0CL32                                                            
         DS    CL4                                                              
LASTKCLT DS    CL3                                                              
LASTKPRD DS    CL3                                                              
         DS    CL22                NOT SPARE - REST OF LASTKEY                  
*                                                                               
TESTMQ   DS    C                                                                
SCSFTP   DS    C                   SC JOHNSONN SFTP                             
MZSFTP   DS    C                   MAZDA SFTP                                   
BKSFTP   DS    C                   Y=DOING BURGER KING SFTP                     
*                                  FOR MINDSHARE BURGER KING MQ MSG             
BKOPENSW DS    C                   Y=BURGER KING FILE OPEN                      
*                                  NOTE - ALSO SET FOR SC JOHNSON               
*                                  AND MAZDA SFTP FILES                         
*                                                                               
BKFISCAL DS    CL4                 FISCAL YEAR                                  
BKBYR    DS    CL4                 BILLING MOS - YEAR                           
BKBMTH   DS    CL2                 BILLING MOS - MONTH                          
*                                                                               
CTODAY   DS    CL8                 YYYYMMDD                                     
TIMEOFD  DS    CL8                 HH.MM.SS                                     
*                                                                               
MTODAYB  DS    XL3                 YMD - TODAY BINARY                           
ELEM     DS    CL200                                                            
*                                                                               
MQMAPNM  DS    CL14                SFTPDISK.PROD.                               
*                                                                               
DSNAME   DS    CL35  DSN -  BIL.SYS.AGID.DYYYMMDD.THHMMSS                       
*                    FOR MINDSHARE BURGER KING AGID = H7PK                      
*                                                                               
         DS    CL22                                                             
*                                                                               
LASTPROF DS    XL16                                                             
*                                                                               
B1PROF   DS    XL16                                                             
B1XPROF  DS    XL16                                                             
DINVMED  DS    CL2                  INVOICE MEDIA PART                          
DINVNO   DS    CL6                                                              
DINVFULL DS    CL10                 FULL INVOICE NUMBER                         
*                                   ME-MN-NNNN                                  
*                               OR  MN-ME-NNNN                                  
DSINVNO  DS    CL7                  MN-NNNN (OR YMMNNNN)                        
*                                                                               
DYNDDN   DS    CL8                                                              
DYNDSN   DS    CL20                                                             
*                                                                               
MCMRECS  DS    PL2'0'                                                           
MCCRECS  DS    PL2'0'                                                           
OORECS   DS    PL2'0'                                                           
*                                                                               
BKCOM    DS    PL6                                                              
BKCOMACC DS    CL10                BK COMMISSION ACCOUNT                        
BKACCT   DS    CL10                BURGER KING ACCOUNT                          
BKCOSTC  DS    CL10                BURGER KING COST CENTER                      
BKMAR#   DS    CL23                BURGER KING MAR NUMBER                       
*                                                                               
FISCAL   DS    CL4                 BK FISCAL YEAR                               
*                                                                               
BILTOTS  DS    7PL6                                                             
PRDTOTS  DS    7PL6                                                             
CLTTOTS  DS    7PL6                                                             
OFFTOTS  DS    7PL6                                                             
REQTOTS  DS    7PL6                                                             
RUNTOTS  DS    7PL6                                                             
TRUNTOTS DS    7PL6                FOR TAPE REQS                                
*                                                                               
*                                                                               
INVPARS  DS    6F               FOR INVTAB BINSRCH                              
*                                                                               
INVMAX   EQU   10000            ALLOW 10000 INVOICES PER CLIENT                 
MYFULL   DS    F                                                                
SAVER1   DS    F                                                                
*                                                                               
CLTINVS  DS    F                INVOICE TOTALS                                  
OFFINVS  DS    F                                                                
REQINVS  DS    F                                                                
RUNINVS  DS    F                                                                
TRUNINVS DS    F                                                                
*                                                                               
STAGSW   DS    X                                                                
TOTSW    DS    X                                                                
SAVMAX   DS    X                                                                
SVCD     DS    PL8                                                              
*                                                                               
SVQOPT7  DS    CL1                                                              
NEWCLT   DS    CL1                                                              
MELCODE  DS    CL1                                                              
SH9PRD   DS    CL3                                                              
SVMID    DS    CL132                                                            
SVMID2   DS    CL132                                                            
*                                                                               
PHHDSW   DS    CL1                 Y= HEADER CREATED                            
*                                                                               
SMHDSW   DS    CL1                 Y= HEADER CREATED                            
*                                                                               
ELCODE3  DS    CL1                 ELEMENT CODE FOR GETEL3 MACRO                
*                                                                               
SVEDWARD DS    CL60     SAVED $ AMTS FOR EDWARD JONES TRAILER RECORD            
*                       (OOPROCE)                                               
UCOMBLK  DS    CL(UCOMDLNQ)     DDUCOM CONTROL BLOCK                            
*                                                                               
       ++INCLUDE PPBVALD                                                        
*                                                                               
PBIREC   DS    CL256                                                            
         DS    CL234            TO ALLOW FOR UP TO 500 BYTES                    
*                               FOR BIG RECORDS                                 
         DS    CL1000           FOR EVEN BIGGER RECORDS                         
*                                                                               
WID      DSECT                                                                  
WIOFFICE DS    CL1           1                                                  
WISYSTEM DS    CL1           2                                                  
WIMEDIA  DS    CL1           3                                                  
WICLICOD DS    CL3           4                                                  
WICLINAM DS    CL20          7                                                  
         DS    CL10                                                             
WIPRDCOD DS    CL3           37                                                 
WIESTNUM DS    CL3           40                                                 
         DS    CL3                                                              
WIESTNAM DS    CL20          46                                                 
         DS    CL15                                                             
WIINVNUM DS    CL6           81                                                 
         DS    CL4                                                              
WIINVDAT DS    CL6           91                                                 
WIDUEDAT DS    CL6           97                                                 
WIMONSER DS    CL4                                                              
WIACTBAM DS    CL11                                                             
WICASH   DS    CL11                                                             
WITAX    DS    CL11                                                             
WIGST    DS    CL11                                                             
WIPST    DS    CL11                                                             
WIAGENCY DS    CL2                                                              
WINET    DS    CL11                                                             
WISUBMED DS    CL1                                                              
WIPW#ACT DS    CL11                                                             
WIPW#NET DS    CL11                                                             
WIPW#TAX DS    CL11                                                             
WIPWBILL DS    CL1                                                              
WIAORNAM DS    CL30                                                             
WIPRDGCD DS    CL4                                                              
WIPRDGNM DS    CL24                                                             
WIUDEFP1 DS    CL32                                                             
WIUDEFP2 DS    CL16                                                             
WIUDEFE1 DS    CL32                                                             
WIUDEFE2 DS    CL16                                                             
WIBILLTP DS    CL3                                                              
         DS    CL1                                                              
WICLTNUM DS    CL6                                                              
         DS    CL2                                                              
WIARDAT  DS    CL4                                                              
WIGROSS  DS    CL11                                                             
WICLIPRD DS    CL5                                                              
WIPRDDES DS    CL20                                                             
WIAGYCOM DS    CL11                                                             
WIRETAIL DS    CL12                                                             
*                                                                               
PM50     DSECT                                                                  
PM50VEN  DS    CL6      VENDOR                                                  
PM50MED  DS    CL2      MEDIA                                                   
PM50TYP  DS    CL1      TYPE                                                    
PM50INV  DS    CL13     INVOICE NUMBER                                          
PM50EST  DS    CL12     ESTIMATE                                                
PM50FLL  DS    CL9      SPACES                                                  
PM50RTP  DS    CL2      RECORD TYPE                                             
PM50CGA  DS    PL6                                                              
PM50CDS  DS    PL6                                                              
PM50NCA  DS    PL6                                                              
PM50NCD  DS    PL6                                                              
PM50PSF  DS    PL6                                                              
*                                                                               
PM55     DSECT                                                                  
PM55VEN  DS    CL6      VENDOR                                                  
PM55MED  DS    CL2      MEDIA                                                   
PM55TYP  DS    CL1      TYPE                                                    
PM55INV  DS    CL13     INVOICE NUMBER                                          
PM55EST  DS    CL12     ESTIMATE                                                
PM55FLL  DS    CL6      SPACES                                                  
PM55PRD  DS    CL3                                                              
PM55RTP  DS    CL2      RECORD TYPE                                             
PM55CGA  DS    PL6                                                              
PM55CDS  DS    PL6                                                              
PM55NCA  DS    PL6                                                              
PM55NCD  DS    PL6                                                              
PM55PSF  DS    PL6                                                              
*                                                                               
BILLINED DSECT                                                                  
BLINE    DS    0C                                                               
BLPRD    DS    CL3                                                              
         DS    CL1                                                              
BLEST    DS    CL3                                                              
         DS    CL1                                                              
BLPER    DS    CL6                                                              
         DS    CL1                                                              
BLINO    DS    CL6                                                              
         DS    CL1                                                              
BLRDAT   DS    CL8                                                              
         DS    CL1                                                              
BLBDAT   DS    CL5                                                              
         DS    CL1                                                              
BLTYP    DS    CL6                                                              
BLGRS    DS    CL15                                                             
BLNET    DS    CL15                                                             
BLCD     DS    CL15                                                             
BLAC     DS    CL15                                                             
BLBIL    DS    CL15                                                             
BLGST    DS    CL13                                                             
         SPACE 3                                                                
BLESTD   EQU   BLEST-BLINE                                                      
BLPERD   EQU   BLPER-BLINE                                                      
BLRDATD  EQU   BLRDAT-BLINE                                                     
*                                                                               
*                                                                               
MQMSGD   DSECT                                                                  
MQHID    DS    CL6                 HUB RECORD ID                                
MQSYS    DS    CL3                 SYSTEM                                       
MQAGYID  DS    CL4                 AGENCY 1D 4-CHAR                             
MQQUAL   DS    CL16                QUALIFIER                                    
MQDATE   DS    CL6                 YYMMDD OF DSN                                
MQTIME   DS    CL6                 HHMMSS OF DSN                                
MQDATA1  DS    CL32                NOT USED                                     
MQDATA2  DS    CL32                NOT USED                                     
MQFILE   DS    CL64                DSN  (MINUS SFTPDISK.PROD.)                  
MQMSGLNQ EQU   *-MQMSGD                                                         
*                                                                               
*********************************************************************           
* DSECT TO COVER SMUCKERS CXML FOR DATA BUILT IN PBIREC+200                     
*********************************************************************           
SMUCKRSD DSECT                     SMUCKERS DSECT                               
SMINVDT  DS    CL10                INVOICE DATE (YYYY-MM-DD)                    
SMINVMOS DS    CL10                INVOICE MOS (YYYY-MM-DD)                     
SMINVNUM DS    CL9                 INVOICE NUMBER (L-83-5149)                   
SMCNAME  DS    CL20                CLIENT NAME                                  
SMADD    DS    CL61                CLIENT ADDRESS (PPRDBILL/PPRDLIN1)           
SMCITY   DS    CL24                CLIENT CITY (PPRDLIN2)                       
SMSTATE  DS    CL2                 CLIENT STATE (PPRDLIN2)                      
SMZIP    DS    CL10                CLIENT ZIP CODE (PPRDLIN2)                   
SMEUDEF2 DS    CL16                ESTIMATE UDEF 2                              
SMODATE  DS    CL10                ORDER DATE (YYYY-MM-DD)                      
SMEUDEF1 DS    CL32                ESTIMATE UDEF 1                              
SMBACT   DS    CL13                BILL ACTUAL                                  
SMEDESC  DS    CL20                EST DESCRIPTION (EDESC)                      
*                                                                               
         PRINT OFF                                                              
*                                                                               
       ++INCLUDE PPREPWORK                                                      
*                                                                               
*                                                                               
* START AND END INVOIVE NUMBERS COL 53(4), AND COL 57 (4)                       
*                                                                               
QINVNO1  EQU   QRECORD+52                                                       
QINVNO2  EQU   QRECORD+56                                                       
       ++INCLUDE PPREPWORK2                                                     
*                                                                               
       ++INCLUDE PPNEWFILE         HAVE NEW PBILLREC DSECT                      
*                                                                               
       ++INCLUDE PBLPSTEL                                                       
*                                                                               
BPLEQ    EQU   6                   LENGTH OF PBILLREC PACKS (PL6)               
*                                                                               
       ++INCLUDE PPMODEQU                                                       
*                                                                               
         PRINT ON                                                               
*                                                                               
       ++INCLUDE PAORREC                                                        
*                                                                               
       ++INCLUDE DDUCOMD                                                        
*                                                                               
       ++INCLUDE DDOFFICED                                                      
*                                                                               
         PRINT OFF                                                              
       ++INCLUDE DDMASTD                                                        
         PRINT ON                                                               
*                                                                               
INVTAB   CSECT                                                                  
         ORG   *+(INVMAX*4)                                                     
         DC    X'00'                                                            
*                                                                               
JWTTABLE CSECT                                                                  
         DS    2000CL147                                                        
*                                                                               
MCCTABLE CSECT                                                                  
         DS    1500CL353                                                        
*                                                                               
G7TABLE  CSECT                                                                  
         DS    6000CL212                                                        
*                                                                               
SCTABLE  CSECT                                                                  
         DS    2000CL212                                                        
*                                                                               
MZTABLE  CSECT                                                                  
         DS    1200CL390                                                        
*                                                                               
*                                                                               
*                                                                               
**PAN#1  CSECT                                                                  
**PAN#1  DC    CL21'014PPREP1002 05/28/20'                                      
         END                                                                    
